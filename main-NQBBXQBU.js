import{a as O,b as G,h as x_}from"./chunk-FU26YZD3.js";var Lp;function uu(){return Lp}function vi(n){let e=Lp;return Lp=n,e}var b_=Symbol("NotFound");function Io(n){return n===b_||n?.name==="\u0275NotFound"}var Yt=null,du=!1,Op=1,TS=null,Jt=Symbol("SIGNAL");function he(n){let e=Yt;return Yt=n,e}function fu(){return Yt}var Ar={version:0,lastCleanEpoch:0,dirty:!1,producers:void 0,producersTail:void 0,consumers:void 0,consumersTail:void 0,recomputing:!1,consumerAllowSignalWrites:!1,consumerIsAlwaysLive:!1,kind:"unknown",producerMustRecompute:()=>!1,producerRecomputeValue:()=>{},consumerMarkedDirty:()=>{},consumerOnSignalRead:()=>{}};function Mo(n){if(du)throw new Error("");if(Yt===null)return;Yt.consumerOnSignalRead(n);let e=Yt.producersTail;if(e!==void 0&&e.producer===n)return;let t,i=Yt.recomputing;if(i&&(t=e!==void 0?e.nextProducer:Yt.producers,t!==void 0&&t.producer===n)){Yt.producersTail=t,t.lastReadVersion=n.version;return}let r=n.consumersTail;if(r!==void 0&&r.consumer===Yt&&(!i||MS(r,Yt)))return;let o=No(Yt),a={producer:n,consumer:Yt,nextProducer:t,prevConsumer:r,lastReadVersion:n.version,nextConsumer:void 0};Yt.producersTail=a,e!==void 0?e.nextProducer=a:Yt.producers=a,o&&w_(n,a)}function E_(){Op++}function gu(n){if(!(No(n)&&!n.dirty)&&!(!n.dirty&&n.lastCleanEpoch===Op)){if(!n.producerMustRecompute(n)&&!Ro(n)){pu(n);return}n.producerRecomputeValue(n),pu(n)}}function Bp(n){if(n.consumers===void 0)return;let e=du;du=!0;try{for(let t=n.consumers;t!==void 0;t=t.nextConsumer){let i=t.consumer;i.dirty||IS(i)}}finally{du=e}}function Up(){return Yt?.consumerAllowSignalWrites!==!1}function IS(n){n.dirty=!0,Bp(n),n.consumerMarkedDirty?.(n)}function pu(n){n.dirty=!1,n.lastCleanEpoch=Op}function Rr(n){return n&&S_(n),he(n)}function S_(n){n.producersTail=void 0,n.recomputing=!0}function Ao(n,e){he(e),n&&D_(n)}function D_(n){n.recomputing=!1;let e=n.producersTail,t=e!==void 0?e.nextProducer:n.producers;if(t!==void 0){if(No(n))do t=$p(t);while(t!==void 0);e!==void 0?e.nextProducer=void 0:n.producers=void 0}}function Ro(n){for(let e=n.producers;e!==void 0;e=e.nextProducer){let t=e.producer,i=e.lastReadVersion;if(i!==t.version||(gu(t),i!==t.version))return!0}return!1}function Nr(n){if(No(n)){let e=n.producers;for(;e!==void 0;)e=$p(e)}n.producers=void 0,n.producersTail=void 0,n.consumers=void 0,n.consumersTail=void 0}function w_(n,e){let t=n.consumersTail,i=No(n);if(t!==void 0?(e.nextConsumer=t.nextConsumer,t.nextConsumer=e):(e.nextConsumer=void 0,n.consumers=e),e.prevConsumer=t,n.consumersTail=e,!i)for(let r=n.producers;r!==void 0;r=r.nextProducer)w_(r.producer,r)}function $p(n){let e=n.producer,t=n.nextProducer,i=n.nextConsumer,r=n.prevConsumer;if(n.nextConsumer=void 0,n.prevConsumer=void 0,i!==void 0?i.prevConsumer=r:e.consumersTail=r,r!==void 0)r.nextConsumer=i;else if(e.consumers=i,!No(e)){let o=e.producers;for(;o!==void 0;)o=$p(o)}return t}function No(n){return n.consumerIsAlwaysLive||n.consumers!==void 0}function hu(n){TS?.(n)}function MS(n,e){let t=e.producersTail;if(t!==void 0){let i=e.producers;do{if(i===n)return!0;if(i===t)break;i=i.nextProducer}while(i!==void 0)}return!1}function yu(n,e){return Object.is(n,e)}function _u(n,e){let t=Object.create(AS);t.computation=n,e!==void 0&&(t.equal=e);let i=()=>{if(gu(t),Mo(t),t.value===gs)throw t.error;return t.value};return i[Jt]=t,hu(t),i}var cu=Symbol("UNSET"),mu=Symbol("COMPUTING"),gs=Symbol("ERRORED"),AS=G(O({},Ar),{value:cu,dirty:!0,error:null,equal:yu,kind:"computed",producerMustRecompute(n){return n.value===cu||n.value===mu},producerRecomputeValue(n){if(n.value===mu)throw new Error("");let e=n.value;n.value=mu;let t=Rr(n),i,r=!1;try{i=n.computation(),he(null),r=e!==cu&&e!==gs&&i!==gs&&n.equal(e,i)}catch(o){i=gs,n.error=o}finally{Ao(n,t)}if(r){n.value=e;return}n.value=i,n.version++}});function RS(){throw new Error}var T_=RS;function I_(n){T_(n)}function Hp(n){T_=n}var NS=null;function Gp(n,e){let t=Object.create(vu);t.value=n,e!==void 0&&(t.equal=e);let i=()=>M_(t);return i[Jt]=t,hu(t),[i,a=>Fo(t,a),a=>qp(t,a)]}function M_(n){return Mo(n),n.value}function Fo(n,e){Up()||I_(n),n.equal(n.value,e)||(n.value=e,FS(n))}function qp(n,e){Up()||I_(n),Fo(n,e(n.value))}var vu=G(O({},Ar),{equal:yu,value:void 0,kind:"signal"});function FS(n){n.version++,E_(),Bp(n),NS?.(n)}function Ee(n){return typeof n=="function"}function Po(n){let t=n(i=>{Error.call(i),i.stack=new Error().stack});return t.prototype=Object.create(Error.prototype),t.prototype.constructor=t,t}var Cu=Po(n=>function(t){n(this),this.message=t?`${t.length} errors occurred during unsubscription:
${t.map((i,r)=>`${r+1}) ${i.toString()}`).join(`
  `)}`:"",this.name="UnsubscriptionError",this.errors=t});function hs(n,e){if(n){let t=n.indexOf(e);0<=t&&n.splice(t,1)}}var Tt=class n{constructor(e){this.initialTeardown=e,this.closed=!1,this._parentage=null,this._finalizers=null}unsubscribe(){let e;if(!this.closed){this.closed=!0;let{_parentage:t}=this;if(t)if(this._parentage=null,Array.isArray(t))for(let o of t)o.remove(this);else t.remove(this);let{initialTeardown:i}=this;if(Ee(i))try{i()}catch(o){e=o instanceof Cu?o.errors:[o]}let{_finalizers:r}=this;if(r){this._finalizers=null;for(let o of r)try{A_(o)}catch(a){e=e??[],a instanceof Cu?e=[...e,...a.errors]:e.push(a)}}if(e)throw new Cu(e)}}add(e){var t;if(e&&e!==this)if(this.closed)A_(e);else{if(e instanceof n){if(e.closed||e._hasParent(this))return;e._addParent(this)}(this._finalizers=(t=this._finalizers)!==null&&t!==void 0?t:[]).push(e)}}_hasParent(e){let{_parentage:t}=this;return t===e||Array.isArray(t)&&t.includes(e)}_addParent(e){let{_parentage:t}=this;this._parentage=Array.isArray(t)?(t.push(e),t):t?[t,e]:e}_removeParent(e){let{_parentage:t}=this;t===e?this._parentage=null:Array.isArray(t)&&hs(t,e)}remove(e){let{_finalizers:t}=this;t&&hs(t,e),e instanceof n&&e._removeParent(this)}};Tt.EMPTY=(()=>{let n=new Tt;return n.closed=!0,n})();var Wp=Tt.EMPTY;function xu(n){return n instanceof Tt||n&&"closed"in n&&Ee(n.remove)&&Ee(n.add)&&Ee(n.unsubscribe)}function A_(n){Ee(n)?n():n.unsubscribe()}var Yn={onUnhandledError:null,onStoppedNotification:null,Promise:void 0,useDeprecatedSynchronousErrorHandling:!1,useDeprecatedNextContext:!1};var ko={setTimeout(n,e,...t){let{delegate:i}=ko;return i?.setTimeout?i.setTimeout(n,e,...t):setTimeout(n,e,...t)},clearTimeout(n){let{delegate:e}=ko;return(e?.clearTimeout||clearTimeout)(n)},delegate:void 0};function bu(n){ko.setTimeout(()=>{let{onUnhandledError:e}=Yn;if(e)e(n);else throw n})}function ys(){}var R_=jp("C",void 0,void 0);function N_(n){return jp("E",void 0,n)}function F_(n){return jp("N",n,void 0)}function jp(n,e,t){return{kind:n,value:e,error:t}}var Fr=null;function Vo(n){if(Yn.useDeprecatedSynchronousErrorHandling){let e=!Fr;if(e&&(Fr={errorThrown:!1,error:null}),n(),e){let{errorThrown:t,error:i}=Fr;if(Fr=null,t)throw i}}else n()}function P_(n){Yn.useDeprecatedSynchronousErrorHandling&&Fr&&(Fr.errorThrown=!0,Fr.error=n)}var Pr=class extends Tt{constructor(e){super(),this.isStopped=!1,e?(this.destination=e,xu(e)&&e.add(this)):this.destination=VS}static create(e,t,i){return new nr(e,t,i)}next(e){this.isStopped?Yp(F_(e),this):this._next(e)}error(e){this.isStopped?Yp(N_(e),this):(this.isStopped=!0,this._error(e))}complete(){this.isStopped?Yp(R_,this):(this.isStopped=!0,this._complete())}unsubscribe(){this.closed||(this.isStopped=!0,super.unsubscribe(),this.destination=null)}_next(e){this.destination.next(e)}_error(e){try{this.destination.error(e)}finally{this.unsubscribe()}}_complete(){try{this.destination.complete()}finally{this.unsubscribe()}}},PS=Function.prototype.bind;function zp(n,e){return PS.call(n,e)}var Jp=class{constructor(e){this.partialObserver=e}next(e){let{partialObserver:t}=this;if(t.next)try{t.next(e)}catch(i){Eu(i)}}error(e){let{partialObserver:t}=this;if(t.error)try{t.error(e)}catch(i){Eu(i)}else Eu(e)}complete(){let{partialObserver:e}=this;if(e.complete)try{e.complete()}catch(t){Eu(t)}}},nr=class extends Pr{constructor(e,t,i){super();let r;if(Ee(e)||!e)r={next:e??void 0,error:t??void 0,complete:i??void 0};else{let o;this&&Yn.useDeprecatedNextContext?(o=Object.create(e),o.unsubscribe=()=>this.unsubscribe(),r={next:e.next&&zp(e.next,o),error:e.error&&zp(e.error,o),complete:e.complete&&zp(e.complete,o)}):r=e}this.destination=new Jp(r)}};function Eu(n){Yn.useDeprecatedSynchronousErrorHandling?P_(n):bu(n)}function kS(n){throw n}function Yp(n,e){let{onStoppedNotification:t}=Yn;t&&ko.setTimeout(()=>t(n,e))}var VS={closed:!0,next:ys,error:kS,complete:ys};var Lo=typeof Symbol=="function"&&Symbol.observable||"@@observable";function bn(n){return n}function Kp(...n){return Qp(n)}function Qp(n){return n.length===0?bn:n.length===1?n[0]:function(t){return n.reduce((i,r)=>r(i),t)}}var Ae=(()=>{class n{constructor(t){t&&(this._subscribe=t)}lift(t){let i=new n;return i.source=this,i.operator=t,i}subscribe(t,i,r){let o=OS(t)?t:new nr(t,i,r);return Vo(()=>{let{operator:a,source:u}=this;o.add(a?a.call(o,u):u?this._subscribe(o):this._trySubscribe(o))}),o}_trySubscribe(t){try{return this._subscribe(t)}catch(i){t.error(i)}}forEach(t,i){return i=k_(i),new i((r,o)=>{let a=new nr({next:u=>{try{t(u)}catch(c){o(c),a.unsubscribe()}},error:o,complete:r});this.subscribe(a)})}_subscribe(t){var i;return(i=this.source)===null||i===void 0?void 0:i.subscribe(t)}[Lo](){return this}pipe(...t){return Qp(t)(this)}toPromise(t){return t=k_(t),new t((i,r)=>{let o;this.subscribe(a=>o=a,a=>r(a),()=>i(o))})}}return n.create=e=>new n(e),n})();function k_(n){var e;return(e=n??Yn.Promise)!==null&&e!==void 0?e:Promise}function LS(n){return n&&Ee(n.next)&&Ee(n.error)&&Ee(n.complete)}function OS(n){return n&&n instanceof Pr||LS(n)&&xu(n)}function Zp(n){return Ee(n?.lift)}function Pe(n){return e=>{if(Zp(e))return e.lift(function(t){try{return n(t,this)}catch(i){this.error(i)}});throw new TypeError("Unable to lift unknown Observable type")}}function Re(n,e,t,i,r){return new Xp(n,e,t,i,r)}var Xp=class extends Pr{constructor(e,t,i,r,o,a){super(e),this.onFinalize=o,this.shouldUnsubscribe=a,this._next=t?function(u){try{t(u)}catch(c){e.error(c)}}:super._next,this._error=r?function(u){try{r(u)}catch(c){e.error(c)}finally{this.unsubscribe()}}:super._error,this._complete=i?function(){try{i()}catch(u){e.error(u)}finally{this.unsubscribe()}}:super._complete}unsubscribe(){var e;if(!this.shouldUnsubscribe||this.shouldUnsubscribe()){let{closed:t}=this;super.unsubscribe(),!t&&((e=this.onFinalize)===null||e===void 0||e.call(this))}}};function Oo(){return Pe((n,e)=>{let t=null;n._refCount++;let i=Re(e,void 0,void 0,void 0,()=>{if(!n||n._refCount<=0||0<--n._refCount){t=null;return}let r=n._connection,o=t;t=null,r&&(!o||r===o)&&r.unsubscribe(),e.unsubscribe()});n.subscribe(i),i.closed||(t=n.connect())})}var Bo=class extends Ae{constructor(e,t){super(),this.source=e,this.subjectFactory=t,this._subject=null,this._refCount=0,this._connection=null,Zp(e)&&(this.lift=e.lift)}_subscribe(e){return this.getSubject().subscribe(e)}getSubject(){let e=this._subject;return(!e||e.isStopped)&&(this._subject=this.subjectFactory()),this._subject}_teardown(){this._refCount=0;let{_connection:e}=this;this._subject=this._connection=null,e?.unsubscribe()}connect(){let e=this._connection;if(!e){e=this._connection=new Tt;let t=this.getSubject();e.add(this.source.subscribe(Re(t,void 0,()=>{this._teardown(),t.complete()},i=>{this._teardown(),t.error(i)},()=>this._teardown()))),e.closed&&(this._connection=null,e=Tt.EMPTY)}return e}refCount(){return Oo()(this)}};var V_=Po(n=>function(){n(this),this.name="ObjectUnsubscribedError",this.message="object unsubscribed"});var bt=(()=>{class n extends Ae{constructor(){super(),this.closed=!1,this.currentObservers=null,this.observers=[],this.isStopped=!1,this.hasError=!1,this.thrownError=null}lift(t){let i=new Su(this,this);return i.operator=t,i}_throwIfClosed(){if(this.closed)throw new V_}next(t){Vo(()=>{if(this._throwIfClosed(),!this.isStopped){this.currentObservers||(this.currentObservers=Array.from(this.observers));for(let i of this.currentObservers)i.next(t)}})}error(t){Vo(()=>{if(this._throwIfClosed(),!this.isStopped){this.hasError=this.isStopped=!0,this.thrownError=t;let{observers:i}=this;for(;i.length;)i.shift().error(t)}})}complete(){Vo(()=>{if(this._throwIfClosed(),!this.isStopped){this.isStopped=!0;let{observers:t}=this;for(;t.length;)t.shift().complete()}})}unsubscribe(){this.isStopped=this.closed=!0,this.observers=this.currentObservers=null}get observed(){var t;return((t=this.observers)===null||t===void 0?void 0:t.length)>0}_trySubscribe(t){return this._throwIfClosed(),super._trySubscribe(t)}_subscribe(t){return this._throwIfClosed(),this._checkFinalizedStatuses(t),this._innerSubscribe(t)}_innerSubscribe(t){let{hasError:i,isStopped:r,observers:o}=this;return i||r?Wp:(this.currentObservers=null,o.push(t),new Tt(()=>{this.currentObservers=null,hs(o,t)}))}_checkFinalizedStatuses(t){let{hasError:i,thrownError:r,isStopped:o}=this;i?t.error(r):o&&t.complete()}asObservable(){let t=new Ae;return t.source=this,t}}return n.create=(e,t)=>new Su(e,t),n})(),Su=class extends bt{constructor(e,t){super(),this.destination=e,this.source=t}next(e){var t,i;(i=(t=this.destination)===null||t===void 0?void 0:t.next)===null||i===void 0||i.call(t,e)}error(e){var t,i;(i=(t=this.destination)===null||t===void 0?void 0:t.error)===null||i===void 0||i.call(t,e)}complete(){var e,t;(t=(e=this.destination)===null||e===void 0?void 0:e.complete)===null||t===void 0||t.call(e)}_subscribe(e){var t,i;return(i=(t=this.source)===null||t===void 0?void 0:t.subscribe(e))!==null&&i!==void 0?i:Wp}};var Ht=class extends bt{constructor(e){super(),this._value=e}get value(){return this.getValue()}_subscribe(e){let t=super._subscribe(e);return!t.closed&&e.next(this._value),t}getValue(){let{hasError:e,thrownError:t,_value:i}=this;if(e)throw t;return this._throwIfClosed(),i}next(e){super.next(this._value=e)}};var hn=new Ae(n=>n.complete());function L_(n){return n&&Ee(n.schedule)}function O_(n){return n[n.length-1]}function Du(n){return Ee(O_(n))?n.pop():void 0}function ir(n){return L_(O_(n))?n.pop():void 0}function U_(n,e,t,i){function r(o){return o instanceof t?o:new t(function(a){a(o)})}return new(t||(t=Promise))(function(o,a){function u(g){try{p(i.next(g))}catch(y){a(y)}}function c(g){try{p(i.throw(g))}catch(y){a(y)}}function p(g){g.done?o(g.value):r(g.value).then(u,c)}p((i=i.apply(n,e||[])).next())})}function B_(n){var e=typeof Symbol=="function"&&Symbol.iterator,t=e&&n[e],i=0;if(t)return t.call(n);if(n&&typeof n.length=="number")return{next:function(){return n&&i>=n.length&&(n=void 0),{value:n&&n[i++],done:!n}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function kr(n){return this instanceof kr?(this.v=n,this):new kr(n)}function $_(n,e,t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var i=t.apply(n,e||[]),r,o=[];return r=Object.create((typeof AsyncIterator=="function"?AsyncIterator:Object).prototype),u("next"),u("throw"),u("return",a),r[Symbol.asyncIterator]=function(){return this},r;function a(C){return function(T){return Promise.resolve(T).then(C,y)}}function u(C,T){i[C]&&(r[C]=function(R){return new Promise(function(F,P){o.push([C,R,F,P])>1||c(C,R)})},T&&(r[C]=T(r[C])))}function c(C,T){try{p(i[C](T))}catch(R){v(o[0][3],R)}}function p(C){C.value instanceof kr?Promise.resolve(C.value.v).then(g,y):v(o[0][2],C)}function g(C){c("next",C)}function y(C){c("throw",C)}function v(C,T){C(T),o.shift(),o.length&&c(o[0][0],o[0][1])}}function H_(n){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e=n[Symbol.asyncIterator],t;return e?e.call(n):(n=typeof B_=="function"?B_(n):n[Symbol.iterator](),t={},i("next"),i("throw"),i("return"),t[Symbol.asyncIterator]=function(){return this},t);function i(o){t[o]=n[o]&&function(a){return new Promise(function(u,c){a=n[o](a),r(u,c,a.done,a.value)})}}function r(o,a,u,c){Promise.resolve(c).then(function(p){o({value:p,done:u})},a)}}var wu=n=>n&&typeof n.length=="number"&&typeof n!="function";function Tu(n){return Ee(n?.then)}function Iu(n){return Ee(n[Lo])}function Mu(n){return Symbol.asyncIterator&&Ee(n?.[Symbol.asyncIterator])}function Au(n){return new TypeError(`You provided ${n!==null&&typeof n=="object"?"an invalid object":`'${n}'`} where a stream was expected. You can provide an Observable, Promise, ReadableStream, Array, AsyncIterable, or Iterable.`)}function BS(){return typeof Symbol!="function"||!Symbol.iterator?"@@iterator":Symbol.iterator}var Ru=BS();function Nu(n){return Ee(n?.[Ru])}function Fu(n){return $_(this,arguments,function*(){let t=n.getReader();try{for(;;){let{value:i,done:r}=yield kr(t.read());if(r)return yield kr(void 0);yield yield kr(i)}}finally{t.releaseLock()}})}function Pu(n){return Ee(n?.getReader)}function It(n){if(n instanceof Ae)return n;if(n!=null){if(Iu(n))return US(n);if(wu(n))return $S(n);if(Tu(n))return HS(n);if(Mu(n))return G_(n);if(Nu(n))return GS(n);if(Pu(n))return qS(n)}throw Au(n)}function US(n){return new Ae(e=>{let t=n[Lo]();if(Ee(t.subscribe))return t.subscribe(e);throw new TypeError("Provided object does not correctly implement Symbol.observable")})}function $S(n){return new Ae(e=>{for(let t=0;t<n.length&&!e.closed;t++)e.next(n[t]);e.complete()})}function HS(n){return new Ae(e=>{n.then(t=>{e.closed||(e.next(t),e.complete())},t=>e.error(t)).then(null,bu)})}function GS(n){return new Ae(e=>{for(let t of n)if(e.next(t),e.closed)return;e.complete()})}function G_(n){return new Ae(e=>{WS(n,e).catch(t=>e.error(t))})}function qS(n){return G_(Fu(n))}function WS(n,e){var t,i,r,o;return U_(this,void 0,void 0,function*(){try{for(t=H_(n);i=yield t.next(),!i.done;){let a=i.value;if(e.next(a),e.closed)return}}catch(a){r={error:a}}finally{try{i&&!i.done&&(o=t.return)&&(yield o.call(t))}finally{if(r)throw r.error}}e.complete()})}function yn(n,e,t,i=0,r=!1){let o=e.schedule(function(){t(),r?n.add(this.schedule(null,i)):this.unsubscribe()},i);if(n.add(o),!r)return o}function ku(n,e=0){return Pe((t,i)=>{t.subscribe(Re(i,r=>yn(i,n,()=>i.next(r),e),()=>yn(i,n,()=>i.complete(),e),r=>yn(i,n,()=>i.error(r),e)))})}function Vu(n,e=0){return Pe((t,i)=>{i.add(n.schedule(()=>t.subscribe(i),e))})}function q_(n,e){return It(n).pipe(Vu(e),ku(e))}function W_(n,e){return It(n).pipe(Vu(e),ku(e))}function j_(n,e){return new Ae(t=>{let i=0;return e.schedule(function(){i===n.length?t.complete():(t.next(n[i++]),t.closed||this.schedule())})})}function z_(n,e){return new Ae(t=>{let i;return yn(t,e,()=>{i=n[Ru](),yn(t,e,()=>{let r,o;try{({value:r,done:o}=i.next())}catch(a){t.error(a);return}o?t.complete():t.next(r)},0,!0)}),()=>Ee(i?.return)&&i.return()})}function Lu(n,e){if(!n)throw new Error("Iterable cannot be null");return new Ae(t=>{yn(t,e,()=>{let i=n[Symbol.asyncIterator]();yn(t,e,()=>{i.next().then(r=>{r.done?t.complete():t.next(r.value)})},0,!0)})})}function Y_(n,e){return Lu(Fu(n),e)}function J_(n,e){if(n!=null){if(Iu(n))return q_(n,e);if(wu(n))return j_(n,e);if(Tu(n))return W_(n,e);if(Mu(n))return Lu(n,e);if(Nu(n))return z_(n,e);if(Pu(n))return Y_(n,e)}throw Au(n)}function mt(n,e){return e?J_(n,e):It(n)}function ce(...n){let e=ir(n);return mt(n,e)}function Jn(n,e){let t=Ee(n)?n:()=>n,i=r=>r.error(t());return new Ae(e?r=>e.schedule(i,0,r):i)}function e0(n){return!!n&&(n instanceof Ae||Ee(n.lift)&&Ee(n.subscribe))}var Kn=Po(n=>function(){n(this),this.name="EmptyError",this.message="no elements in sequence"});function W(n,e){let t=typeof e=="object";return new Promise((i,r)=>{let o=new nr({next:a=>{i(a),o.unsubscribe()},error:r,complete:()=>{t?i(e.defaultValue):r(new Kn)}});n.subscribe(o)})}function ve(n,e){return Pe((t,i)=>{let r=0;t.subscribe(Re(i,o=>{i.next(n.call(e,o,r++))}))})}var{isArray:jS}=Array;function zS(n,e){return jS(e)?n(...e):n(e)}function Ou(n){return ve(e=>zS(n,e))}var{isArray:YS}=Array,{getPrototypeOf:JS,prototype:KS,keys:QS}=Object;function Bu(n){if(n.length===1){let e=n[0];if(YS(e))return{args:e,keys:null};if(ZS(e)){let t=QS(e);return{args:t.map(i=>e[i]),keys:t}}}return{args:n,keys:null}}function ZS(n){return n&&typeof n=="object"&&JS(n)===KS}function Uu(n,e){return n.reduce((t,i,r)=>(t[i]=e[r],t),{})}function $u(...n){let e=ir(n),t=Du(n),{args:i,keys:r}=Bu(n);if(i.length===0)return mt([],e);let o=new Ae(XS(i,e,r?a=>Uu(r,a):bn));return t?o.pipe(Ou(t)):o}function XS(n,e,t=bn){return i=>{K_(e,()=>{let{length:r}=n,o=new Array(r),a=r,u=r;for(let c=0;c<r;c++)K_(e,()=>{let p=mt(n[c],e),g=!1;p.subscribe(Re(i,y=>{o[c]=y,g||(g=!0,u--),u||i.next(t(o.slice()))},()=>{--a||i.complete()}))},i)},i)}}function K_(n,e,t){n?yn(t,n,e):e()}function Q_(n,e,t,i,r,o,a,u){let c=[],p=0,g=0,y=!1,v=()=>{y&&!c.length&&!p&&e.complete()},C=R=>p<i?T(R):c.push(R),T=R=>{o&&e.next(R),p++;let F=!1;It(t(R,g++)).subscribe(Re(e,P=>{r?.(P),o?C(P):e.next(P)},()=>{F=!0},void 0,()=>{if(F)try{for(p--;c.length&&p<i;){let P=c.shift();a?yn(e,a,()=>T(P)):T(P)}v()}catch(P){e.error(P)}}))};return n.subscribe(Re(e,C,()=>{y=!0,v()})),()=>{u?.()}}function Mt(n,e,t=1/0){return Ee(e)?Mt((i,r)=>ve((o,a)=>e(i,o,r,a))(It(n(i,r))),t):(typeof e=="number"&&(t=e),Pe((i,r)=>Q_(i,r,n,t)))}function Uo(n=1/0){return Mt(bn,n)}function Z_(){return Uo(1)}function $o(...n){return Z_()(mt(n,ir(n)))}function _s(n){return new Ae(e=>{It(n()).subscribe(e)})}function t0(...n){let e=Du(n),{args:t,keys:i}=Bu(n),r=new Ae(o=>{let{length:a}=t;if(!a){o.complete();return}let u=new Array(a),c=a,p=a;for(let g=0;g<a;g++){let y=!1;It(t[g]).subscribe(Re(o,v=>{y||(y=!0,p--),u[g]=v},()=>c--,void 0,()=>{(!c||!y)&&(p||o.next(i?Uu(i,u):u),o.complete())}))}});return e?r.pipe(Ou(e)):r}function vt(n,e){return Pe((t,i)=>{let r=0;t.subscribe(Re(i,o=>n.call(e,o,r++)&&i.next(o)))})}function Qn(n){return Pe((e,t)=>{let i=null,r=!1,o;i=e.subscribe(Re(t,void 0,void 0,a=>{o=It(n(a,Qn(n)(e))),i?(i.unsubscribe(),i=null,o.subscribe(t)):r=!0})),r&&(i.unsubscribe(),i=null,o.subscribe(t))})}function X_(n,e,t,i,r){return(o,a)=>{let u=t,c=e,p=0;o.subscribe(Re(a,g=>{let y=p++;c=u?n(c,g,y):(u=!0,g),i&&a.next(c)},r&&(()=>{u&&a.next(c),a.complete()})))}}function Fi(n,e){return Ee(e)?Mt(n,e,1):Mt(n,1)}function rr(n){return Pe((e,t)=>{let i=!1;e.subscribe(Re(t,r=>{i=!0,t.next(r)},()=>{i||t.next(n),t.complete()}))})}function Pi(n){return n<=0?()=>hn:Pe((e,t)=>{let i=0;e.subscribe(Re(t,r=>{++i<=n&&(t.next(r),n<=i&&t.complete())}))})}function Hu(n=eD){return Pe((e,t)=>{let i=!1;e.subscribe(Re(t,r=>{i=!0,t.next(r)},()=>i?t.complete():t.error(n())))})}function eD(){return new Kn}function or(n){return Pe((e,t)=>{try{e.subscribe(t)}finally{t.add(n)}})}function ki(n,e){let t=arguments.length>=2;return i=>i.pipe(n?vt((r,o)=>n(r,o,i)):bn,Pi(1),t?rr(e):Hu(()=>new Kn))}function Ho(n){return n<=0?()=>hn:Pe((e,t)=>{let i=[];e.subscribe(Re(t,r=>{i.push(r),n<i.length&&i.shift()},()=>{for(let r of i)t.next(r);t.complete()},void 0,()=>{i=null}))})}function n0(n,e){let t=arguments.length>=2;return i=>i.pipe(n?vt((r,o)=>n(r,o,i)):bn,Ho(1),t?rr(e):Hu(()=>new Kn))}function i0(n,e){return Pe(X_(n,e,arguments.length>=2,!0))}function r0(...n){let e=ir(n);return Pe((t,i)=>{(e?$o(n,t,e):$o(n,t)).subscribe(i)})}function Kt(n,e){return Pe((t,i)=>{let r=null,o=0,a=!1,u=()=>a&&!r&&i.complete();t.subscribe(Re(i,c=>{r?.unsubscribe();let p=0,g=o++;It(n(c,g)).subscribe(r=Re(i,y=>i.next(e?e(c,y,g,p++):y),()=>{r=null,u()}))},()=>{a=!0,u()}))})}function Gu(n){return Pe((e,t)=>{It(n).subscribe(Re(t,()=>t.complete(),ys)),!t.closed&&e.subscribe(t)})}function lt(n,e,t){let i=Ee(n)||e||t?{next:n,error:e,complete:t}:n;return i?Pe((r,o)=>{var a;(a=i.subscribe)===null||a===void 0||a.call(i);let u=!0;r.subscribe(Re(o,c=>{var p;(p=i.next)===null||p===void 0||p.call(i,c),o.next(c)},()=>{var c;u=!1,(c=i.complete)===null||c===void 0||c.call(i),o.complete()},c=>{var p;u=!1,(p=i.error)===null||p===void 0||p.call(i,c),o.error(c)},()=>{var c,p;u&&((c=i.unsubscribe)===null||c===void 0||c.call(i)),(p=i.finalize)===null||p===void 0||p.call(i)}))}):bn}function e1(n){let e=he(null);try{return n()}finally{he(e)}}var t1=G(O({},Ar),{consumerIsAlwaysLive:!0,consumerAllowSignalWrites:!0,dirty:!0,kind:"effect"});function n1(n){if(n.dirty=!1,n.version>0&&!Ro(n))return;n.version++;let e=Rr(n);try{n.cleanup(),n.fn()}finally{Ao(n,e)}}var zu="https://angular.dev/best-practices/security#preventing-cross-site-scripting-xss",z=class extends Error{code;constructor(e,t){super(lr(e,t)),this.code=e}};function tD(n){return`NG0${Math.abs(n)}`}function lr(n,e){return`${tD(n)}${e?": "+e:""}`}var Zn=globalThis;function ze(n){for(let e in n)if(n[e]===ze)return e;throw Error("")}function o1(n,e){for(let t in e)e.hasOwnProperty(t)&&!n.hasOwnProperty(t)&&(n[t]=e[t])}function Li(n){if(typeof n=="string")return n;if(Array.isArray(n))return`[${n.map(Li).join(", ")}]`;if(n==null)return""+n;let e=n.overriddenName||n.name;if(e)return`${e}`;let t=n.toString();if(t==null)return""+t;let i=t.indexOf(`
`);return i>=0?t.slice(0,i):t}function Yu(n,e){return n?e?`${n} ${e}`:n:e||""}var nD=ze({__forward_ref__:ze});function Et(n){return n.__forward_ref__=Et,n.toString=function(){return Li(this())},n}function Gt(n){return g0(n)?n():n}function g0(n){return typeof n=="function"&&n.hasOwnProperty(nD)&&n.__forward_ref__===Et}function X(n){return{token:n.token,providedIn:n.providedIn||null,factory:n.factory,value:void 0}}function Mn(n){return{providers:n.providers||[],imports:n.imports||[]}}function Es(n){return iD(n,Ju)}function h0(n){return Es(n)!==null}function iD(n,e){return n.hasOwnProperty(e)&&n[e]||null}function rD(n){let e=n?.[Ju]??null;return e||null}function a0(n){return n&&n.hasOwnProperty(Wu)?n[Wu]:null}var Ju=ze({\u0275prov:ze}),Wu=ze({\u0275inj:ze}),ne=class{_desc;ngMetadataName="InjectionToken";\u0275prov;constructor(e,t){this._desc=e,this.\u0275prov=void 0,typeof t=="number"?this.__NG_ELEMENT_ID__=t:t!==void 0&&(this.\u0275prov=X({token:this,providedIn:t.providedIn||"root",factory:t.factory}))}get multi(){return this}toString(){return`InjectionToken ${this._desc}`}};function y0(n){return n&&!!n.\u0275providers}var _0=ze({\u0275cmp:ze}),v0=ze({\u0275dir:ze}),C0=ze({\u0275pipe:ze}),x0=ze({\u0275mod:ze}),Cs=ze({\u0275fac:ze}),Ur=ze({__NG_ELEMENT_ID__:ze}),i1=ze({__NG_ENV_ID__:ze});function Xn(n){return typeof n=="string"?n:n==null?"":String(n)}function a1(n){return typeof n=="function"?n.name||n.toString():typeof n=="object"&&n!=null&&typeof n.type=="function"?n.type.name||n.type.toString():Xn(n)}var s1=ze({ngErrorCode:ze}),oD=ze({ngErrorMessage:ze}),aD=ze({ngTokenPath:ze});function b0(n,e){return l1("",-200,e)}function Ku(n,e){throw new z(-201,!1)}function l1(n,e,t){let i=new z(e,n);return i[s1]=e,i[oD]=n,t&&(i[aD]=t),i}function sD(n){return n[s1]}var s0;function u1(){return s0}function rn(n){let e=s0;return s0=n,e}function E0(n,e,t){let i=Es(n);if(i&&i.providedIn=="root")return i.value===void 0?i.value=i.factory():i.value;if(t&8)return null;if(e!==void 0)return e;Ku(n,"Injector")}var lD={},Vr=lD,uD="__NG_DI_FLAG__",l0=class{injector;constructor(e){this.injector=e}retrieve(e,t){let i=Lr(t)||0;try{return this.injector.get(e,i&8?null:Vr,i)}catch(r){if(Io(r))return r;throw r}}};function dD(n,e=0){let t=uu();if(t===void 0)throw new z(-203,!1);if(t===null)return E0(n,void 0,e);{let i=cD(e),r=t.retrieve(n,i);if(Io(r)){if(i.optional)return null;throw r}return r}}function ae(n,e=0){return(u1()||dD)(Gt(n),e)}function k(n,e){return ae(n,Lr(e))}function Lr(n){return typeof n>"u"||typeof n=="number"?n:0|(n.optional&&8)|(n.host&&1)|(n.self&&2)|(n.skipSelf&&4)}function cD(n){return{optional:!!(n&8),host:!!(n&1),self:!!(n&2),skipSelf:!!(n&4)}}function u0(n){let e=[];for(let t=0;t<n.length;t++){let i=Gt(n[t]);if(Array.isArray(i)){if(i.length===0)throw new z(900,!1);let r,o=0;for(let a=0;a<i.length;a++){let u=i[a],c=mD(u);typeof c=="number"?c===-1?r=u.token:o|=c:r=u}e.push(ae(r,o))}else e.push(ae(i))}return e}function mD(n){return n[uD]}function ar(n,e){let t=n.hasOwnProperty(Cs);return t?n[Cs]:null}function d1(n,e,t){if(n.length!==e.length)return!1;for(let i=0;i<n.length;i++){let r=n[i],o=e[i];if(t&&(r=t(r),o=t(o)),o!==r)return!1}return!0}function c1(n){return n.flat(Number.POSITIVE_INFINITY)}function Qu(n,e){n.forEach(t=>Array.isArray(t)?Qu(t,e):e(t))}function S0(n,e,t){e>=n.length?n.push(t):n.splice(e,0,t)}function Ss(n,e){return e>=n.length-1?n.pop():n.splice(e,1)[0]}function m1(n,e,t,i){let r=n.length;if(r==e)n.push(t,i);else if(r===1)n.push(i,n[0]),n[0]=t;else{for(r--,n.push(n[r-1],n[r]);r>e;){let o=r-2;n[r]=n[o],r--}n[e]=t,n[e+1]=i}}function Zu(n,e,t){let i=qo(n,e);return i>=0?n[i|1]=t:(i=~i,m1(n,i,e,t)),i}function Xu(n,e){let t=qo(n,e);if(t>=0)return n[t|1]}function qo(n,e){return pD(n,e,1)}function pD(n,e,t){let i=0,r=n.length>>t;for(;r!==i;){let o=i+(r-i>>1),a=n[o<<t];if(e===a)return o<<t;a>e?r=o:i=o+1}return~(r<<t)}var ur={},on=[],dr=new ne(""),D0=new ne("",-1),w0=new ne(""),xs=class{get(e,t=Vr){if(t===Vr){let r=l1("",-201);throw r.name="\u0275NotFound",r}return t}};function T0(n){return n[x0]||null}function cr(n){return n[_0]||null}function I0(n){return n[v0]||null}function p1(n){return n[C0]||null}function $r(n){return{\u0275providers:n}}function f1(...n){return{\u0275providers:M0(!0,n),\u0275fromNgModule:!0}}function M0(n,...e){let t=[],i=new Set,r,o=a=>{t.push(a)};return Qu(e,a=>{let u=a;ju(u,o,[],i)&&(r||=[],r.push(u))}),r!==void 0&&g1(r,o),t}function g1(n,e){for(let t=0;t<n.length;t++){let{ngModule:i,providers:r}=n[t];A0(r,o=>{e(o,i)})}}function ju(n,e,t,i){if(n=Gt(n),!n)return!1;let r=null,o=a0(n),a=!o&&cr(n);if(!o&&!a){let c=n.ngModule;if(o=a0(c),o)r=c;else return!1}else{if(a&&!a.standalone)return!1;r=n}let u=i.has(r);if(a){if(u)return!1;if(i.add(r),a.dependencies){let c=typeof a.dependencies=="function"?a.dependencies():a.dependencies;for(let p of c)ju(p,e,t,i)}}else if(o){if(o.imports!=null&&!u){i.add(r);let p;try{Qu(o.imports,g=>{ju(g,e,t,i)&&(p||=[],p.push(g))})}finally{}p!==void 0&&g1(p,e)}if(!u){let p=ar(r)||(()=>new r);e({provide:r,useFactory:p,deps:on},r),e({provide:w0,useValue:r,multi:!0},r),e({provide:dr,useValue:()=>ae(r),multi:!0},r)}let c=o.providers;if(c!=null&&!u){let p=n;A0(c,g=>{e(g,p)})}}else return!1;return r!==n&&n.providers!==void 0}function A0(n,e){for(let t of n)y0(t)&&(t=t.\u0275providers),Array.isArray(t)?A0(t,e):e(t)}var fD=ze({provide:String,useValue:ze});function h1(n){return n!==null&&typeof n=="object"&&fD in n}function gD(n){return!!(n&&n.useExisting)}function hD(n){return!!(n&&n.useFactory)}function Or(n){return typeof n=="function"}function y1(n){return!!n.useClass}var Ds=new ne(""),qu={},r1={},o0;function ws(){return o0===void 0&&(o0=new xs),o0}var At=class{},Br=class extends At{parent;source;scopes;records=new Map;_ngOnDestroyHooks=new Set;_onDestroyHooks=[];get destroyed(){return this._destroyed}_destroyed=!1;injectorDefTypes;constructor(e,t,i,r){super(),this.parent=t,this.source=i,this.scopes=r,c0(e,a=>this.processProvider(a)),this.records.set(D0,Go(void 0,this)),r.has("environment")&&this.records.set(At,Go(void 0,this));let o=this.records.get(Ds);o!=null&&typeof o.value=="string"&&this.scopes.add(o.value),this.injectorDefTypes=new Set(this.get(w0,on,{self:!0}))}retrieve(e,t){let i=Lr(t)||0;try{return this.get(e,Vr,i)}catch(r){if(Io(r))return r;throw r}}destroy(){vs(this),this._destroyed=!0;let e=he(null);try{for(let i of this._ngOnDestroyHooks)i.ngOnDestroy();let t=this._onDestroyHooks;this._onDestroyHooks=[];for(let i of t)i()}finally{this.records.clear(),this._ngOnDestroyHooks.clear(),this.injectorDefTypes.clear(),he(e)}}onDestroy(e){return vs(this),this._onDestroyHooks.push(e),()=>this.removeOnDestroy(e)}runInContext(e){vs(this);let t=vi(this),i=rn(void 0),r;try{return e()}finally{vi(t),rn(i)}}get(e,t=Vr,i){if(vs(this),e.hasOwnProperty(i1))return e[i1](this);let r=Lr(i),o,a=vi(this),u=rn(void 0);try{if(!(r&4)){let p=this.records.get(e);if(p===void 0){let g=xD(e)&&Es(e);g&&this.injectableDefInScope(g)?p=Go(d0(e),qu):p=null,this.records.set(e,p)}if(p!=null)return this.hydrate(e,p,r)}let c=r&2?ws():this.parent;return t=r&8&&t===Vr?null:t,c.get(e,t)}catch(c){let p=sD(c);throw p===-200||p===-201?new z(p,null):c}finally{rn(u),vi(a)}}resolveInjectorInitializers(){let e=he(null),t=vi(this),i=rn(void 0),r;try{let o=this.get(dr,on,{self:!0});for(let a of o)a()}finally{vi(t),rn(i),he(e)}}toString(){let e=[],t=this.records;for(let i of t.keys())e.push(Li(i));return`R3Injector[${e.join(", ")}]`}processProvider(e){e=Gt(e);let t=Or(e)?e:Gt(e&&e.provide),i=_D(e);if(!Or(e)&&e.multi===!0){let r=this.records.get(t);r||(r=Go(void 0,qu,!0),r.factory=()=>u0(r.multi),this.records.set(t,r)),t=e,r.multi.push(e)}this.records.set(t,i)}hydrate(e,t,i){let r=he(null);try{if(t.value===r1)throw b0(Li(e));return t.value===qu&&(t.value=r1,t.value=t.factory(void 0,i)),typeof t.value=="object"&&t.value&&CD(t.value)&&this._ngOnDestroyHooks.add(t.value),t.value}finally{he(r)}}injectableDefInScope(e){if(!e.providedIn)return!1;let t=Gt(e.providedIn);return typeof t=="string"?t==="any"||this.scopes.has(t):this.injectorDefTypes.has(t)}removeOnDestroy(e){let t=this._onDestroyHooks.indexOf(e);t!==-1&&this._onDestroyHooks.splice(t,1)}};function d0(n){let e=Es(n),t=e!==null?e.factory:ar(n);if(t!==null)return t;if(n instanceof ne)throw new z(204,!1);if(n instanceof Function)return yD(n);throw new z(204,!1)}function yD(n){if(n.length>0)throw new z(204,!1);let t=rD(n);return t!==null?()=>t.factory(n):()=>new n}function _D(n){if(h1(n))return Go(void 0,n.useValue);{let e=R0(n);return Go(e,qu)}}function R0(n,e,t){let i;if(Or(n)){let r=Gt(n);return ar(r)||d0(r)}else if(h1(n))i=()=>Gt(n.useValue);else if(hD(n))i=()=>n.useFactory(...u0(n.deps||[]));else if(gD(n))i=(r,o)=>ae(Gt(n.useExisting),o!==void 0&&o&8?8:void 0);else{let r=Gt(n&&(n.useClass||n.provide));if(vD(n))i=()=>new r(...u0(n.deps));else return ar(r)||d0(r)}return i}function vs(n){if(n.destroyed)throw new z(205,!1)}function Go(n,e,t=!1){return{factory:n,value:e,multi:t?[]:void 0}}function vD(n){return!!n.deps}function CD(n){return n!==null&&typeof n=="object"&&typeof n.ngOnDestroy=="function"}function xD(n){return typeof n=="function"||typeof n=="object"&&n.ngMetadataName==="InjectionToken"}function c0(n,e){for(let t of n)Array.isArray(t)?c0(t,e):t&&y0(t)?c0(t.\u0275providers,e):e(t)}function kt(n,e){let t;n instanceof Br?(vs(n),t=n):t=new l0(n);let i,r=vi(t),o=rn(void 0);try{return e()}finally{vi(r),rn(o)}}function _1(){return u1()!==void 0||uu()!=null}var ei=0,ue=1,ye=2,Pt=3,An=4,Rn=5,Wo=6,jo=7,St=8,Oi=9,Ci=10,Xe=11,zo=12,N0=13,Hr=14,En=15,mr=16,Gr=17,xi=18,Ts=19,F0=20,Vi=21,ed=22,Bi=23,Sn=24,qr=25,Wr=26,pt=27,v1=1,P0=6,pr=7,Is=8,jr=9,Ct=10;function bi(n){return Array.isArray(n)&&typeof n[v1]=="object"}function ti(n){return Array.isArray(n)&&n[v1]===!0}function k0(n){return(n.flags&4)!==0}function fr(n){return n.componentOffset>-1}function Yo(n){return(n.flags&1)===1}function Ei(n){return!!n.template}function Jo(n){return(n[ye]&512)!==0}function zr(n){return(n[ye]&256)===256}var V0="svg",C1="math";function Nn(n){for(;Array.isArray(n);)n=n[ei];return n}function L0(n,e){return Nn(e[n])}function ni(n,e){return Nn(e[n.index])}function Ms(n,e){return n.data[e]}function td(n,e){return n[e]}function O0(n,e,t,i){t>=n.data.length&&(n.data[t]=null,n.blueprint[t]=null),e[t]=i}function Fn(n,e){let t=e[n];return bi(t)?t:t[ei]}function x1(n){return(n[ye]&4)===4}function nd(n){return(n[ye]&128)===128}function b1(n){return ti(n[Pt])}function Pn(n,e){return e==null?null:n[e]}function B0(n){n[Gr]=0}function U0(n){n[ye]&1024||(n[ye]|=1024,nd(n)&&gr(n))}function E1(n,e){for(;n>0;)e=e[Hr],n--;return e}function As(n){return!!(n[ye]&9216||n[Sn]?.dirty)}function id(n){n[Ci].changeDetectionScheduler?.notify(8),n[ye]&64&&(n[ye]|=1024),As(n)&&gr(n)}function gr(n){n[Ci].changeDetectionScheduler?.notify(0);let e=sr(n);for(;e!==null&&!(e[ye]&8192||(e[ye]|=8192,!nd(e)));)e=sr(e)}function $0(n,e){if(zr(n))throw new z(911,!1);n[Vi]===null&&(n[Vi]=[]),n[Vi].push(e)}function S1(n,e){if(n[Vi]===null)return;let t=n[Vi].indexOf(e);t!==-1&&n[Vi].splice(t,1)}function sr(n){let e=n[Pt];return ti(e)?e[Pt]:e}function H0(n){return n[jo]??=[]}function G0(n){return n.cleanup??=[]}function D1(n,e,t,i){let r=H0(e);r.push(t),n.firstCreatePass&&G0(n).push(i,r.length-1)}var Se={lFrame:O1(null),bindingsEnabled:!0,skipHydrationRootTNode:null};var m0=!1;function w1(){return Se.lFrame.elementDepthCount}function T1(){Se.lFrame.elementDepthCount++}function q0(){Se.lFrame.elementDepthCount--}function rd(){return Se.bindingsEnabled}function I1(){return Se.skipHydrationRootTNode!==null}function W0(n){return Se.skipHydrationRootTNode===n}function j0(){Se.skipHydrationRootTNode=null}function pe(){return Se.lFrame.lView}function dt(){return Se.lFrame.tView}function E(n){return Se.lFrame.contextLView=n,n[St]}function S(n){return Se.lFrame.contextLView=null,n}function Rt(){let n=z0();for(;n!==null&&n.type===64;)n=n.parent;return n}function z0(){return Se.lFrame.currentTNode}function M1(){let n=Se.lFrame,e=n.currentTNode;return n.isParent?e:e.parent}function Ko(n,e){let t=Se.lFrame;t.currentTNode=n,t.isParent=e}function Y0(){return Se.lFrame.isParent}function A1(){Se.lFrame.isParent=!1}function R1(){return Se.lFrame.contextLView}function J0(){return m0}function Qo(n){let e=m0;return m0=n,e}function od(){let n=Se.lFrame,e=n.bindingRootIndex;return e===-1&&(e=n.bindingRootIndex=n.tView.bindingStartIndex),e}function K0(){return Se.lFrame.bindingIndex}function N1(n){return Se.lFrame.bindingIndex=n}function hr(){return Se.lFrame.bindingIndex++}function Rs(n){let e=Se.lFrame,t=e.bindingIndex;return e.bindingIndex=e.bindingIndex+n,t}function F1(){return Se.lFrame.inI18n}function P1(n,e){let t=Se.lFrame;t.bindingIndex=t.bindingRootIndex=n,ad(e)}function k1(){return Se.lFrame.currentDirectiveIndex}function ad(n){Se.lFrame.currentDirectiveIndex=n}function V1(n){let e=Se.lFrame.currentDirectiveIndex;return e===-1?null:n[e]}function Q0(){return Se.lFrame.currentQueryIndex}function sd(n){Se.lFrame.currentQueryIndex=n}function bD(n){let e=n[ue];return e.type===2?e.declTNode:e.type===1?n[Rn]:null}function Z0(n,e,t){if(t&4){let r=e,o=n;for(;r=r.parent,r===null&&!(t&1);)if(r=bD(o),r===null||(o=o[Hr],r.type&10))break;if(r===null)return!1;e=r,n=o}let i=Se.lFrame=L1();return i.currentTNode=e,i.lView=n,!0}function ld(n){let e=L1(),t=n[ue];Se.lFrame=e,e.currentTNode=t.firstChild,e.lView=n,e.tView=t,e.contextLView=n,e.bindingIndex=t.bindingStartIndex,e.inI18n=!1}function L1(){let n=Se.lFrame,e=n===null?null:n.child;return e===null?O1(n):e}function O1(n){let e={currentTNode:null,isParent:!0,lView:null,tView:null,selectedIndex:-1,contextLView:null,elementDepthCount:0,currentNamespace:null,currentDirectiveIndex:-1,bindingRootIndex:-1,bindingIndex:-1,currentQueryIndex:0,parent:n,child:null,inI18n:!1};return n!==null&&(n.child=e),e}function B1(){let n=Se.lFrame;return Se.lFrame=n.parent,n.currentTNode=null,n.lView=null,n}var X0=B1;function ud(){let n=B1();n.isParent=!0,n.tView=null,n.selectedIndex=-1,n.contextLView=null,n.elementDepthCount=0,n.currentDirectiveIndex=-1,n.currentNamespace=null,n.bindingRootIndex=-1,n.bindingIndex=-1,n.currentQueryIndex=0}function U1(n){return(Se.lFrame.contextLView=E1(n,Se.lFrame.contextLView))[St]}function ii(){return Se.lFrame.selectedIndex}function yr(n){Se.lFrame.selectedIndex=n}function Ns(){let n=Se.lFrame;return Ms(n.tView,n.selectedIndex)}function Ui(){Se.lFrame.currentNamespace=V0}function Yr(){ED()}function ED(){Se.lFrame.currentNamespace=null}function $1(){return Se.lFrame.currentNamespace}var H1=!0;function dd(){return H1}function Fs(n){H1=n}function p0(n,e=null,t=null,i){let r=ef(n,e,t,i);return r.resolveInjectorInitializers(),r}function ef(n,e=null,t=null,i,r=new Set){let o=[t||on,f1(n)];return i=i||(typeof n=="object"?void 0:Li(n)),new Br(o,e||ws(),i||null,r)}var Qt=class n{static THROW_IF_NOT_FOUND=Vr;static NULL=new xs;static create(e,t){if(Array.isArray(e))return p0({name:""},t,e,"");{let i=e.name??"";return p0({name:i},e.parent,e.providers,i)}}static \u0275prov=X({token:n,providedIn:"any",factory:()=>ae(D0)});static __NG_ELEMENT_ID__=-1},Vt=new ne(""),kn=(()=>{class n{static __NG_ELEMENT_ID__=SD;static __NG_ENV_ID__=t=>t}return n})(),bs=class extends kn{_lView;constructor(e){super(),this._lView=e}get destroyed(){return zr(this._lView)}onDestroy(e){let t=this._lView;return $0(t,e),()=>S1(t,e)}};function SD(){return new bs(pe())}var Tn=class{_console=console;handleError(e){this._console.error("ERROR",e)}},_n=new ne("",{providedIn:"root",factory:()=>{let n=k(At),e;return t=>{n.destroyed&&!e?setTimeout(()=>{throw t}):(e??=n.get(Tn),e.handleError(t))}}}),G1={provide:dr,useValue:()=>void k(Tn),multi:!0};function tf(n){return typeof n=="function"&&n[Jt]!==void 0}function D(n,e){let[t,i,r]=Gp(n,e?.equal),o=t,a=o[Jt];return o.set=i,o.update=r,o.asReadonly=nf.bind(o),o}function nf(){let n=this[Jt];if(n.readonlyFn===void 0){let e=()=>this();e[Jt]=n,n.readonlyFn=e}return n.readonlyFn}function rf(n){return tf(n)&&typeof n.set=="function"}var Zo=(()=>{class n{view;node;constructor(t,i){this.view=t,this.node=i}static __NG_ELEMENT_ID__=DD}return n})();function DD(){return new Zo(pe(),Rt())}var In=class{},Ps=new ne("",{providedIn:"root",factory:()=>!1});var of=new ne(""),cd=new ne(""),Si=(()=>{class n{taskId=0;pendingTasks=new Set;destroyed=!1;pendingTask=new Ht(!1);get hasPendingTasks(){return this.destroyed?!1:this.pendingTask.value}get hasPendingTasksObservable(){return this.destroyed?new Ae(t=>{t.next(!1),t.complete()}):this.pendingTask}add(){!this.hasPendingTasks&&!this.destroyed&&this.pendingTask.next(!0);let t=this.taskId++;return this.pendingTasks.add(t),t}has(t){return this.pendingTasks.has(t)}remove(t){this.pendingTasks.delete(t),this.pendingTasks.size===0&&this.hasPendingTasks&&this.pendingTask.next(!1)}ngOnDestroy(){this.pendingTasks.clear(),this.hasPendingTasks&&this.pendingTask.next(!1),this.destroyed=!0,this.pendingTask.unsubscribe()}static \u0275prov=X({token:n,providedIn:"root",factory:()=>new n})}return n})(),Xo=(()=>{class n{internalPendingTasks=k(Si);scheduler=k(In);errorHandler=k(_n);add(){let t=this.internalPendingTasks.add();return()=>{this.internalPendingTasks.has(t)&&(this.scheduler.notify(11),this.internalPendingTasks.remove(t))}}run(t){let i=this.add();t().catch(this.errorHandler).finally(i)}static \u0275prov=X({token:n,providedIn:"root",factory:()=>new n})}return n})();function Jr(...n){}var ks=(()=>{class n{static \u0275prov=X({token:n,providedIn:"root",factory:()=>new f0})}return n})(),f0=class{dirtyEffectCount=0;queues=new Map;add(e){this.enqueue(e),this.schedule(e)}schedule(e){e.dirty&&this.dirtyEffectCount++}remove(e){let t=e.zone,i=this.queues.get(t);i.has(e)&&(i.delete(e),e.dirty&&this.dirtyEffectCount--)}enqueue(e){let t=e.zone;this.queues.has(t)||this.queues.set(t,new Set);let i=this.queues.get(t);i.has(e)||i.add(e)}flush(){for(;this.dirtyEffectCount>0;){let e=!1;for(let[t,i]of this.queues)t===null?e||=this.flushQueue(i):e||=t.run(()=>this.flushQueue(i));e||(this.dirtyEffectCount=0)}}flushQueue(e){let t=!1;for(let i of e)i.dirty&&(this.dirtyEffectCount--,t=!0,i.run());return t}};function js(n){return{toString:n}.toString()}function RD(n){return typeof n=="function"}var bd=class{previousValue;currentValue;firstChange;constructor(e,t,i){this.previousValue=e,this.currentValue=t,this.firstChange=i}isFirstChange(){return this.firstChange}};function Dv(n,e,t,i){e!==null?e.applyValueToInputSignal(e,i):n[t]=i}var Ln=(()=>{let n=()=>wv;return n.ngInherit=!0,n})();function wv(n){return n.type.prototype.ngOnChanges&&(n.setInput=FD),ND}function ND(){let n=Iv(this),e=n?.current;if(e){let t=n.previous;if(t===ur)n.previous=e;else for(let i in e)t[i]=e[i];n.current=null,this.ngOnChanges(e)}}function FD(n,e,t,i,r){let o=this.declaredInputs[i],a=Iv(n)||PD(n,{previous:ur,current:null}),u=a.current||(a.current={}),c=a.previous,p=c[o];u[o]=new bd(p&&p.currentValue,t,c===ur),Dv(n,e,r,t)}var Tv="__ngSimpleChanges__";function Iv(n){return n[Tv]||null}function PD(n,e){return n[Tv]=e}var q1=[];var Je=function(n,e=null,t){for(let i=0;i<q1.length;i++){let r=q1[i];r(n,e,t)}};function kD(n,e,t){let{ngOnChanges:i,ngOnInit:r,ngDoCheck:o}=e.type.prototype;if(i){let a=wv(e);(t.preOrderHooks??=[]).push(n,a),(t.preOrderCheckHooks??=[]).push(n,a)}r&&(t.preOrderHooks??=[]).push(0-n,r),o&&((t.preOrderHooks??=[]).push(n,o),(t.preOrderCheckHooks??=[]).push(n,o))}function Mv(n,e){for(let t=e.directiveStart,i=e.directiveEnd;t<i;t++){let o=n.data[t].type.prototype,{ngAfterContentInit:a,ngAfterContentChecked:u,ngAfterViewInit:c,ngAfterViewChecked:p,ngOnDestroy:g}=o;a&&(n.contentHooks??=[]).push(-t,a),u&&((n.contentHooks??=[]).push(t,u),(n.contentCheckHooks??=[]).push(t,u)),c&&(n.viewHooks??=[]).push(-t,c),p&&((n.viewHooks??=[]).push(t,p),(n.viewCheckHooks??=[]).push(t,p)),g!=null&&(n.destroyHooks??=[]).push(t,g)}}function yd(n,e,t){Av(n,e,3,t)}function _d(n,e,t,i){(n[ye]&3)===t&&Av(n,e,t,i)}function af(n,e){let t=n[ye];(t&3)===e&&(t&=16383,t+=1,n[ye]=t)}function Av(n,e,t,i){let r=i!==void 0?n[Gr]&65535:0,o=i??-1,a=e.length-1,u=0;for(let c=r;c<a;c++)if(typeof e[c+1]=="number"){if(u=e[c],i!=null&&u>=i)break}else e[c]<0&&(n[Gr]+=65536),(u<o||o==-1)&&(VD(n,t,e,c),n[Gr]=(n[Gr]&4294901760)+c+2),c++}function W1(n,e){Je(4,n,e);let t=he(null);try{e.call(n)}finally{he(t),Je(5,n,e)}}function VD(n,e,t,i){let r=t[i]<0,o=t[i+1],a=r?-t[i]:t[i],u=n[a];r?n[ye]>>14<n[Gr]>>16&&(n[ye]&3)===e&&(n[ye]+=16384,W1(u,o)):W1(u,o)}var ta=-1,Qr=class{factory;name;injectImpl;resolving=!1;canSeeViewProviders;multi;componentProviders;index;providerFactory;constructor(e,t,i,r){this.factory=e,this.name=r,this.canSeeViewProviders=t,this.injectImpl=i}};function LD(n){return(n.flags&8)!==0}function OD(n){return(n.flags&16)!==0}function BD(n,e,t){let i=0;for(;i<t.length;){let r=t[i];if(typeof r=="number"){if(r!==0)break;i++;let o=t[i++],a=t[i++],u=t[i++];n.setAttribute(e,a,u,o)}else{let o=r,a=t[++i];UD(o)?n.setProperty(e,o,a):n.setAttribute(e,o,a),i++}}return i}function Rv(n){return n===3||n===4||n===6}function UD(n){return n.charCodeAt(0)===64}function na(n,e){if(!(e===null||e.length===0))if(n===null||n.length===0)n=e.slice();else{let t=-1;for(let i=0;i<e.length;i++){let r=e[i];typeof r=="number"?t=r:t===0||(t===-1||t===2?j1(n,t,r,null,e[++i]):j1(n,t,r,null,null))}}return n}function j1(n,e,t,i,r){let o=0,a=n.length;if(e===-1)a=-1;else for(;o<n.length;){let u=n[o++];if(typeof u=="number"){if(u===e){a=-1;break}else if(u>e){a=o-1;break}}}for(;o<n.length;){let u=n[o];if(typeof u=="number")break;if(u===t){r!==null&&(n[o+1]=r);return}o++,r!==null&&o++}a!==-1&&(n.splice(a,0,e),o=a+1),n.splice(o++,0,t),r!==null&&n.splice(o++,0,r)}function Nv(n){return n!==ta}function Ed(n){return n&32767}function $D(n){return n>>16}function Sd(n,e){let t=$D(n),i=e;for(;t>0;)i=i[Hr],t--;return i}var yf=!0;function Dd(n){let e=yf;return yf=n,e}var HD=256,Fv=HD-1,Pv=5,GD=0,Di={};function qD(n,e,t){let i;typeof t=="string"?i=t.charCodeAt(0)||0:t.hasOwnProperty(Ur)&&(i=t[Ur]),i==null&&(i=t[Ur]=GD++);let r=i&Fv,o=1<<r;e.data[n+(r>>Pv)]|=o}function wd(n,e){let t=kv(n,e);if(t!==-1)return t;let i=e[ue];i.firstCreatePass&&(n.injectorIndex=e.length,sf(i.data,n),sf(e,null),sf(i.blueprint,null));let r=Qf(n,e),o=n.injectorIndex;if(Nv(r)){let a=Ed(r),u=Sd(r,e),c=u[ue].data;for(let p=0;p<8;p++)e[o+p]=u[a+p]|c[a+p]}return e[o+8]=r,o}function sf(n,e){n.push(0,0,0,0,0,0,0,0,e)}function kv(n,e){return n.injectorIndex===-1||n.parent&&n.parent.injectorIndex===n.injectorIndex||e[n.injectorIndex+8]===null?-1:n.injectorIndex}function Qf(n,e){if(n.parent&&n.parent.injectorIndex!==-1)return n.parent.injectorIndex;let t=0,i=null,r=e;for(;r!==null;){if(i=Uv(r),i===null)return ta;if(t++,r=r[Hr],i.injectorIndex!==-1)return i.injectorIndex|t<<16}return ta}function _f(n,e,t){qD(n,e,t)}function WD(n,e){if(e==="class")return n.classes;if(e==="style")return n.styles;let t=n.attrs;if(t){let i=t.length,r=0;for(;r<i;){let o=t[r];if(Rv(o))break;if(o===0)r=r+2;else if(typeof o=="number")for(r++;r<i&&typeof t[r]=="string";)r++;else{if(o===e)return t[r+1];r=r+2}}}return null}function Vv(n,e,t){if(t&8||n!==void 0)return n;Ku(e,"NodeInjector")}function Lv(n,e,t,i){if(t&8&&i===void 0&&(i=null),(t&3)===0){let r=n[Oi],o=rn(void 0);try{return r?r.get(e,i,t&8):E0(e,i,t&8)}finally{rn(o)}}return Vv(i,e,t)}function Ov(n,e,t,i=0,r){if(n!==null){if(e[ye]&2048&&!(i&2)){let a=JD(n,e,t,i,Di);if(a!==Di)return a}let o=Bv(n,e,t,i,Di);if(o!==Di)return o}return Lv(e,t,i,r)}function Bv(n,e,t,i,r){let o=zD(t);if(typeof o=="function"){if(!Z0(e,n,i))return i&1?Vv(r,t,i):Lv(e,t,i,r);try{let a;if(a=o(i),a==null&&!(i&8))Ku(t);else return a}finally{X0()}}else if(typeof o=="number"){let a=null,u=kv(n,e),c=ta,p=i&1?e[En][Rn]:null;for((u===-1||i&4)&&(c=u===-1?Qf(n,e):e[u+8],c===ta||!Y1(i,!1)?u=-1:(a=e[ue],u=Ed(c),e=Sd(c,e)));u!==-1;){let g=e[ue];if(z1(o,u,g.data)){let y=jD(u,e,t,a,i,p);if(y!==Di)return y}c=e[u+8],c!==ta&&Y1(i,e[ue].data[u+8]===p)&&z1(o,u,e)?(a=g,u=Ed(c),e=Sd(c,e)):u=-1}}return r}function jD(n,e,t,i,r,o){let a=e[ue],u=a.data[n+8],c=i==null?fr(u)&&yf:i!=a&&(u.type&3)!==0,p=r&1&&o===u,g=vd(u,a,t,c,p);return g!==null?Os(e,a,g,u,r):Di}function vd(n,e,t,i,r){let o=n.providerIndexes,a=e.data,u=o&1048575,c=n.directiveStart,p=n.directiveEnd,g=o>>20,y=i?u:u+g,v=r?u+g:p;for(let C=y;C<v;C++){let T=a[C];if(C<c&&t===T||C>=c&&T.type===t)return C}if(r){let C=a[c];if(C&&Ei(C)&&C.type===t)return c}return null}function Os(n,e,t,i,r){let o=n[t],a=e.data;if(o instanceof Qr){let u=o;if(u.resolving){let C=a1(a[t]);throw b0(C)}let c=Dd(u.canSeeViewProviders);u.resolving=!0;let p=a[t].type||a[t],g,y=u.injectImpl?rn(u.injectImpl):null,v=Z0(n,i,0);try{o=n[t]=u.factory(void 0,r,a,n,i),e.firstCreatePass&&t>=i.directiveStart&&kD(t,a[t],e)}finally{y!==null&&rn(y),Dd(c),u.resolving=!1,X0()}}return o}function zD(n){if(typeof n=="string")return n.charCodeAt(0)||0;let e=n.hasOwnProperty(Ur)?n[Ur]:void 0;return typeof e=="number"?e>=0?e&Fv:YD:e}function z1(n,e,t){let i=1<<n;return!!(t[e+(n>>Pv)]&i)}function Y1(n,e){return!(n&2)&&!(n&1&&e)}var Kr=class{_tNode;_lView;constructor(e,t){this._tNode=e,this._lView=t}get(e,t,i){return Ov(this._tNode,this._lView,e,Lr(i),t)}};function YD(){return new Kr(Rt(),pe())}function Zt(n){return js(()=>{let e=n.prototype.constructor,t=e[Cs]||vf(e),i=Object.prototype,r=Object.getPrototypeOf(n.prototype).constructor;for(;r&&r!==i;){let o=r[Cs]||vf(r);if(o&&o!==t)return o;r=Object.getPrototypeOf(r)}return o=>new o})}function vf(n){return g0(n)?()=>{let e=vf(Gt(n));return e&&e()}:ar(n)}function JD(n,e,t,i,r){let o=n,a=e;for(;o!==null&&a!==null&&a[ye]&2048&&!Jo(a);){let u=Bv(o,a,t,i|2,Di);if(u!==Di)return u;let c=o.parent;if(!c){let p=a[F0];if(p){let g=p.get(t,Di,i);if(g!==Di)return g}c=Uv(a),a=a[Hr]}o=c}return r}function Uv(n){let e=n[ue],t=e.type;return t===2?e.declTNode:t===1?n[Rn]:null}function zs(n){return WD(Rt(),n)}function KD(){return aa(Rt(),pe())}function aa(n,e){return new an(ni(n,e))}var an=(()=>{class n{nativeElement;constructor(t){this.nativeElement=t}static __NG_ELEMENT_ID__=KD}return n})();function QD(n){return n instanceof an?n.nativeElement:n}function ZD(){return this._results[Symbol.iterator]()}var Td=class{_emitDistinctChangesOnly;dirty=!0;_onDirty=void 0;_results=[];_changesDetected=!1;_changes=void 0;length=0;first=void 0;last=void 0;get changes(){return this._changes??=new bt}constructor(e=!1){this._emitDistinctChangesOnly=e}get(e){return this._results[e]}map(e){return this._results.map(e)}filter(e){return this._results.filter(e)}find(e){return this._results.find(e)}reduce(e,t){return this._results.reduce(e,t)}forEach(e){this._results.forEach(e)}some(e){return this._results.some(e)}toArray(){return this._results.slice()}toString(){return this._results.toString()}reset(e,t){this.dirty=!1;let i=c1(e);(this._changesDetected=!d1(this._results,i,t))&&(this._results=i,this.length=i.length,this.last=i[this.length-1],this.first=i[0])}notifyOnChanges(){this._changes!==void 0&&(this._changesDetected||!this._emitDistinctChangesOnly)&&this._changes.next(this)}onDirty(e){this._onDirty=e}setDirty(){this.dirty=!0,this._onDirty?.()}destroy(){this._changes!==void 0&&(this._changes.complete(),this._changes.unsubscribe())}[Symbol.iterator]=ZD};function $v(n){return(n.flags&128)===128}var Zf=(function(n){return n[n.OnPush=0]="OnPush",n[n.Default=1]="Default",n})(Zf||{}),Hv=new Map,XD=0;function ew(){return XD++}function tw(n){Hv.set(n[Ts],n)}function Cf(n){Hv.delete(n[Ts])}var J1="__ngContext__";function ia(n,e){bi(e)?(n[J1]=e[Ts],tw(e)):n[J1]=e}function Gv(n){return Wv(n[zo])}function qv(n){return Wv(n[An])}function Wv(n){for(;n!==null&&!ti(n);)n=n[An];return n}var xf;function Xf(n){xf=n}function eg(){if(xf!==void 0)return xf;if(typeof document<"u")return document;throw new z(210,!1)}var Gd=new ne("",{providedIn:"root",factory:()=>nw}),nw="ng",qd=new ne(""),Ys=new ne("",{providedIn:"platform",factory:()=>"unknown"});var Wd=new ne("",{providedIn:"root",factory:()=>eg().body?.querySelector("[ngCspNonce]")?.getAttribute("ngCspNonce")||null});var iw="h",rw="b";var jv="r";var zv="di";var Yv=!1,Jv=new ne("",{providedIn:"root",factory:()=>Yv});var ow=(n,e,t,i)=>{};function aw(n,e,t,i){ow(n,e,t,i)}function tg(n){return(n.flags&32)===32}var sw=()=>null;function Kv(n,e,t=!1){return sw(n,e,t)}function Qv(n,e){let t=n.contentQueries;if(t!==null){let i=he(null);try{for(let r=0;r<t.length;r+=2){let o=t[r],a=t[r+1];if(a!==-1){let u=n.data[a];sd(o),u.contentQueries(2,e[a],a)}}}finally{he(i)}}}function bf(n,e,t){sd(0);let i=he(null);try{e(n,t)}finally{he(i)}}function ng(n,e,t){if(k0(e)){let i=he(null);try{let r=e.directiveStart,o=e.directiveEnd;for(let a=r;a<o;a++){let u=n.data[a];if(u.contentQueries){let c=t[a];u.contentQueries(1,c,a)}}}finally{he(i)}}}var $i=(function(n){return n[n.Emulated=0]="Emulated",n[n.None=2]="None",n[n.ShadowDom=3]="ShadowDom",n})($i||{});var md;function lw(){if(md===void 0&&(md=null,Zn.trustedTypes))try{md=Zn.trustedTypes.createPolicy("angular",{createHTML:n=>n,createScript:n=>n,createScriptURL:n=>n})}catch{}return md}function jd(n){return lw()?.createHTML(n)||n}var pd;function Zv(){if(pd===void 0&&(pd=null,Zn.trustedTypes))try{pd=Zn.trustedTypes.createPolicy("angular#unsafe-bypass",{createHTML:n=>n,createScript:n=>n,createScriptURL:n=>n})}catch{}return pd}function K1(n){return Zv()?.createHTML(n)||n}function Q1(n){return Zv()?.createScriptURL(n)||n}var Id=class{changingThisBreaksApplicationSecurity;constructor(e){this.changingThisBreaksApplicationSecurity=e}toString(){return`SafeValue must use [property]=binding: ${this.changingThisBreaksApplicationSecurity} (see ${zu})`}};function sa(n){return n instanceof Id?n.changingThisBreaksApplicationSecurity:n}function zd(n,e){let t=Xv(n);if(t!=null&&t!==e){if(t==="ResourceURL"&&e==="URL")return!0;throw new Error(`Required a safe ${e}, got a ${t} (see ${zu})`)}return t===e}function Xv(n){return n instanceof Id&&n.getTypeName()||null}function uw(n){let e=new Sf(n);return dw()?new Ef(e):e}var Ef=class{inertDocumentHelper;constructor(e){this.inertDocumentHelper=e}getInertBodyElement(e){e="<body><remove></remove>"+e;try{let t=new window.DOMParser().parseFromString(jd(e),"text/html").body;return t===null?this.inertDocumentHelper.getInertBodyElement(e):(t.firstChild?.remove(),t)}catch{return null}}},Sf=class{defaultDoc;inertDocument;constructor(e){this.defaultDoc=e,this.inertDocument=this.defaultDoc.implementation.createHTMLDocument("sanitization-inert")}getInertBodyElement(e){let t=this.inertDocument.createElement("template");return t.innerHTML=jd(e),t}};function dw(){try{return!!new window.DOMParser().parseFromString(jd(""),"text/html")}catch{return!1}}var cw=/^(?!javascript:)(?:[a-z0-9+.-]+:|[^&:\/?#]*(?:[\/?#]|$))/i;function ig(n){return n=String(n),n.match(cw)?n:"unsafe:"+n}function Hi(n){let e={};for(let t of n.split(","))e[t]=!0;return e}function Js(...n){let e={};for(let t of n)for(let i in t)t.hasOwnProperty(i)&&(e[i]=!0);return e}var eC=Hi("area,br,col,hr,img,wbr"),tC=Hi("colgroup,dd,dt,li,p,tbody,td,tfoot,th,thead,tr"),nC=Hi("rp,rt"),mw=Js(nC,tC),pw=Js(tC,Hi("address,article,aside,blockquote,caption,center,del,details,dialog,dir,div,dl,figure,figcaption,footer,h1,h2,h3,h4,h5,h6,header,hgroup,hr,ins,main,map,menu,nav,ol,pre,section,summary,table,ul")),fw=Js(nC,Hi("a,abbr,acronym,audio,b,bdi,bdo,big,br,cite,code,del,dfn,em,font,i,img,ins,kbd,label,map,mark,picture,q,ruby,rp,rt,s,samp,small,source,span,strike,strong,sub,sup,time,track,tt,u,var,video")),Z1=Js(eC,pw,fw,mw),iC=Hi("background,cite,href,itemtype,longdesc,poster,src,xlink:href"),gw=Hi("abbr,accesskey,align,alt,autoplay,axis,bgcolor,border,cellpadding,cellspacing,class,clear,color,cols,colspan,compact,controls,coords,datetime,default,dir,download,face,headers,height,hidden,hreflang,hspace,ismap,itemscope,itemprop,kind,label,lang,language,loop,media,muted,nohref,nowrap,open,preload,rel,rev,role,rows,rowspan,rules,scope,scrolling,shape,size,sizes,span,srclang,srcset,start,summary,tabindex,target,title,translate,type,usemap,valign,value,vspace,width"),hw=Hi("aria-activedescendant,aria-atomic,aria-autocomplete,aria-busy,aria-checked,aria-colcount,aria-colindex,aria-colspan,aria-controls,aria-current,aria-describedby,aria-details,aria-disabled,aria-dropeffect,aria-errormessage,aria-expanded,aria-flowto,aria-grabbed,aria-haspopup,aria-hidden,aria-invalid,aria-keyshortcuts,aria-label,aria-labelledby,aria-level,aria-live,aria-modal,aria-multiline,aria-multiselectable,aria-orientation,aria-owns,aria-placeholder,aria-posinset,aria-pressed,aria-readonly,aria-relevant,aria-required,aria-roledescription,aria-rowcount,aria-rowindex,aria-rowspan,aria-selected,aria-setsize,aria-sort,aria-valuemax,aria-valuemin,aria-valuenow,aria-valuetext"),yw=Js(iC,gw,hw),_w=Hi("script,style,template"),Df=class{sanitizedSomething=!1;buf=[];sanitizeChildren(e){let t=e.firstChild,i=!0,r=[];for(;t;){if(t.nodeType===Node.ELEMENT_NODE?i=this.startElement(t):t.nodeType===Node.TEXT_NODE?this.chars(t.nodeValue):this.sanitizedSomething=!0,i&&t.firstChild){r.push(t),t=xw(t);continue}for(;t;){t.nodeType===Node.ELEMENT_NODE&&this.endElement(t);let o=Cw(t);if(o){t=o;break}t=r.pop()}}return this.buf.join("")}startElement(e){let t=X1(e).toLowerCase();if(!Z1.hasOwnProperty(t))return this.sanitizedSomething=!0,!_w.hasOwnProperty(t);this.buf.push("<"),this.buf.push(t);let i=e.attributes;for(let r=0;r<i.length;r++){let o=i.item(r),a=o.name,u=a.toLowerCase();if(!yw.hasOwnProperty(u)){this.sanitizedSomething=!0;continue}let c=o.value;iC[u]&&(c=ig(c)),this.buf.push(" ",a,'="',ev(c),'"')}return this.buf.push(">"),!0}endElement(e){let t=X1(e).toLowerCase();Z1.hasOwnProperty(t)&&!eC.hasOwnProperty(t)&&(this.buf.push("</"),this.buf.push(t),this.buf.push(">"))}chars(e){this.buf.push(ev(e))}};function vw(n,e){return(n.compareDocumentPosition(e)&Node.DOCUMENT_POSITION_CONTAINED_BY)!==Node.DOCUMENT_POSITION_CONTAINED_BY}function Cw(n){let e=n.nextSibling;if(e&&n!==e.previousSibling)throw rC(e);return e}function xw(n){let e=n.firstChild;if(e&&vw(n,e))throw rC(e);return e}function X1(n){let e=n.nodeName;return typeof e=="string"?e:"FORM"}function rC(n){return new Error(`Failed to sanitize html because the element is clobbered: ${n.outerHTML}`)}var bw=/[\uD800-\uDBFF][\uDC00-\uDFFF]/g,Ew=/([^\#-~ |!])/g;function ev(n){return n.replace(/&/g,"&amp;").replace(bw,function(e){let t=e.charCodeAt(0),i=e.charCodeAt(1);return"&#"+((t-55296)*1024+(i-56320)+65536)+";"}).replace(Ew,function(e){return"&#"+e.charCodeAt(0)+";"}).replace(/</g,"&lt;").replace(/>/g,"&gt;")}var fd;function oC(n,e){let t=null;try{fd=fd||uw(n);let i=e?String(e):"";t=fd.getInertBodyElement(i);let r=5,o=i;do{if(r===0)throw new Error("Failed to sanitize html because the input is unstable");r--,i=o,o=t.innerHTML,t=fd.getInertBodyElement(i)}while(i!==o);let u=new Df().sanitizeChildren(tv(t)||t);return jd(u)}finally{if(t){let i=tv(t)||t;for(;i.firstChild;)i.firstChild.remove()}}}function tv(n){return"content"in n&&Sw(n)?n.content:null}function Sw(n){return n.nodeType===Node.ELEMENT_NODE&&n.nodeName==="TEMPLATE"}var Dw=/^>|^->|<!--|-->|--!>|<!-$/g,ww=/(<|>)/g,Tw="\u200B$1\u200B";function Iw(n){return n.replace(Dw,e=>e.replace(ww,Tw))}function Mw(n,e){return n.createText(e)}function Aw(n,e,t){n.setValue(e,t)}function Rw(n,e){return n.createComment(Iw(e))}function aC(n,e,t){return n.createElement(e,t)}function Md(n,e,t,i,r){n.insertBefore(e,t,i,r)}function sC(n,e,t){n.appendChild(e,t)}function nv(n,e,t,i,r){i!==null?Md(n,e,t,i,r):sC(n,e,t)}function lC(n,e,t,i){n.removeChild(null,e,t,i)}function Nw(n,e,t){n.setAttribute(e,"style",t)}function Fw(n,e,t){t===""?n.removeAttribute(e,"class"):n.setAttribute(e,"class",t)}function uC(n,e,t){let{mergedAttrs:i,classes:r,styles:o}=t;i!==null&&BD(n,e,i),r!==null&&Fw(n,e,r),o!==null&&Nw(n,e,o)}var Ks=(function(n){return n[n.NONE=0]="NONE",n[n.HTML=1]="HTML",n[n.STYLE=2]="STYLE",n[n.SCRIPT=3]="SCRIPT",n[n.URL=4]="URL",n[n.RESOURCE_URL=5]="RESOURCE_URL",n})(Ks||{});function Gi(n){let e=og();return e?K1(e.sanitize(Ks.HTML,n)||""):zd(n,"HTML")?K1(sa(n)):oC(eg(),Xn(n))}function qt(n){let e=og();return e?e.sanitize(Ks.URL,n)||"":zd(n,"URL")?sa(n):ig(Xn(n))}function dC(n){let e=og();if(e)return Q1(e.sanitize(Ks.RESOURCE_URL,n)||"");if(zd(n,"ResourceURL"))return Q1(sa(n));throw new z(904,!1)}var Pw=new Set(["embed","frame","iframe","media","script"]),kw=new Set(["base","link","script"]);function Vw(n,e){return e==="src"&&Pw.has(n)||e==="href"&&kw.has(n)||e==="xlink:href"&&n==="script"?dC:qt}function rg(n,e,t){return Vw(e,t)(n)}function og(){let n=pe();return n&&n[Ci].sanitizer}function ag(n){return n.ownerDocument.defaultView}function cC(n){return n instanceof Function?n():n}function Lw(n,e,t){let i=n.length;for(;;){let r=n.indexOf(e,t);if(r===-1)return r;if(r===0||n.charCodeAt(r-1)<=32){let o=e.length;if(r+o===i||n.charCodeAt(r+o)<=32)return r}t=r+1}}var mC="ng-template";function Ow(n,e,t,i){let r=0;if(i){for(;r<e.length&&typeof e[r]=="string";r+=2)if(e[r]==="class"&&Lw(e[r+1].toLowerCase(),t,0)!==-1)return!0}else if(sg(n))return!1;if(r=e.indexOf(1,r),r>-1){let o;for(;++r<e.length&&typeof(o=e[r])=="string";)if(o.toLowerCase()===t)return!0}return!1}function sg(n){return n.type===4&&n.value!==mC}function Bw(n,e,t){let i=n.type===4&&!t?mC:n.value;return e===i}function Uw(n,e,t){let i=4,r=n.attrs,o=r!==null?Gw(r):0,a=!1;for(let u=0;u<e.length;u++){let c=e[u];if(typeof c=="number"){if(!a&&!ri(i)&&!ri(c))return!1;if(a&&ri(c))continue;a=!1,i=c|i&1;continue}if(!a)if(i&4){if(i=2|i&1,c!==""&&!Bw(n,c,t)||c===""&&e.length===1){if(ri(i))return!1;a=!0}}else if(i&8){if(r===null||!Ow(n,r,c,t)){if(ri(i))return!1;a=!0}}else{let p=e[++u],g=$w(c,r,sg(n),t);if(g===-1){if(ri(i))return!1;a=!0;continue}if(p!==""){let y;if(g>o?y="":y=r[g+1].toLowerCase(),i&2&&p!==y){if(ri(i))return!1;a=!0}}}}return ri(i)||a}function ri(n){return(n&1)===0}function $w(n,e,t,i){if(e===null)return-1;let r=0;if(i||!t){let o=!1;for(;r<e.length;){let a=e[r];if(a===n)return r;if(a===3||a===6)o=!0;else if(a===1||a===2){let u=e[++r];for(;typeof u=="string";)u=e[++r];continue}else{if(a===4)break;if(a===0){r+=4;continue}}r+=o?1:2}return-1}else return qw(e,n)}function Hw(n,e,t=!1){for(let i=0;i<e.length;i++)if(Uw(n,e[i],t))return!0;return!1}function Gw(n){for(let e=0;e<n.length;e++){let t=n[e];if(Rv(t))return e}return n.length}function qw(n,e){let t=n.indexOf(4);if(t>-1)for(t++;t<n.length;){let i=n[t];if(typeof i=="number")return-1;if(i===e)return t;t++}return-1}function iv(n,e){return n?":not("+e.trim()+")":e}function Ww(n){let e=n[0],t=1,i=2,r="",o=!1;for(;t<n.length;){let a=n[t];if(typeof a=="string")if(i&2){let u=n[++t];r+="["+a+(u.length>0?'="'+u+'"':"")+"]"}else i&8?r+="."+a:i&4&&(r+=" "+a);else r!==""&&!ri(a)&&(e+=iv(o,r),r=""),i=a,o=o||!ri(i);t++}return r!==""&&(e+=iv(o,r)),e}function jw(n){return n.map(Ww).join(",")}function zw(n){let e=[],t=[],i=1,r=2;for(;i<n.length;){let o=n[i];if(typeof o=="string")r===2?o!==""&&e.push(o,n[++i]):r===8&&t.push(o);else{if(!ri(r))break;r=o}i++}return t.length&&e.push(1,...t),e}var Wt={};function lg(n,e,t,i,r,o,a,u,c,p,g){let y=pt+i,v=y+r,C=Yw(y,v),T=typeof p=="function"?p():p;return C[ue]={type:n,blueprint:C,template:t,queries:null,viewQuery:u,declTNode:e,data:C.slice().fill(null,y),bindingStartIndex:y,expandoStartIndex:v,hostBindingOpCodes:null,firstCreatePass:!0,firstUpdatePass:!0,staticViewQueries:!1,staticContentQueries:!1,preOrderHooks:null,preOrderCheckHooks:null,contentHooks:null,contentCheckHooks:null,viewHooks:null,viewCheckHooks:null,destroyHooks:null,cleanup:null,contentQueries:null,components:null,directiveRegistry:typeof o=="function"?o():o,pipeRegistry:typeof a=="function"?a():a,firstChild:null,schemas:c,consts:T,incompleteFirstPass:!1,ssrId:g}}function Yw(n,e){let t=[];for(let i=0;i<e;i++)t.push(i<n?null:Wt);return t}function Jw(n){let e=n.tView;return e===null||e.incompleteFirstPass?n.tView=lg(1,null,n.template,n.decls,n.vars,n.directiveDefs,n.pipeDefs,n.viewQuery,n.schemas,n.consts,n.id):e}function ug(n,e,t,i,r,o,a,u,c,p,g){let y=e.blueprint.slice();return y[ei]=r,y[ye]=i|4|128|8|64|1024,(p!==null||n&&n[ye]&2048)&&(y[ye]|=2048),B0(y),y[Pt]=y[Hr]=n,y[St]=t,y[Ci]=a||n&&n[Ci],y[Xe]=u||n&&n[Xe],y[Oi]=c||n&&n[Oi]||null,y[Rn]=o,y[Ts]=ew(),y[Wo]=g,y[F0]=p,y[En]=e.type==2?n[En]:y,y}function Kw(n,e,t){let i=ni(e,n),r=Jw(t),o=n[Ci].rendererFactory,a=dg(n,ug(n,r,null,pC(t),i,e,null,o.createRenderer(i,t),null,null,null));return n[e.index]=a}function pC(n){let e=16;return n.signals?e=4096:n.onPush&&(e=64),e}function fC(n,e,t,i){if(t===0)return-1;let r=e.length;for(let o=0;o<t;o++)e.push(i),n.blueprint.push(i),n.data.push(null);return r}function dg(n,e){return n[zo]?n[N0][An]=e:n[zo]=e,n[N0]=e,e}function m(n=1){gC(dt(),pe(),ii()+n,!1)}function gC(n,e,t,i){if(!i)if((e[ye]&3)===3){let o=n.preOrderCheckHooks;o!==null&&yd(e,o,t)}else{let o=n.preOrderHooks;o!==null&&_d(e,o,0,t)}yr(t)}var Yd=(function(n){return n[n.None=0]="None",n[n.SignalBased=1]="SignalBased",n[n.HasDecoratorInputTransform=2]="HasDecoratorInputTransform",n})(Yd||{});function wf(n,e,t,i){let r=he(null);try{let[o,a,u]=n.inputs[t],c=null;(a&Yd.SignalBased)!==0&&(c=e[o][Jt]),c!==null&&c.transformFn!==void 0?i=c.transformFn(i):u!==null&&(i=u.call(e,i)),n.setInput!==null?n.setInput(e,c,i,t,o):Dv(e,c,o,i)}finally{he(r)}}var wi=(function(n){return n[n.Important=1]="Important",n[n.DashCase=2]="DashCase",n})(wi||{}),Qw;function cg(n,e){return Qw(n,e)}var Zr=new Set,Jd=(function(n){return n[n.CHANGE_DETECTION=0]="CHANGE_DETECTION",n[n.AFTER_NEXT_RENDER=1]="AFTER_NEXT_RENDER",n})(Jd||{}),no=new ne(""),rv=new Set;function qi(n){rv.has(n)||(rv.add(n),performance?.mark?.("mark_feature_usage",{detail:{feature:n}}))}var hC=!1,Tf=class extends bt{__isAsync;destroyRef=void 0;pendingTasks=void 0;constructor(e=!1){super(),this.__isAsync=e,_1()&&(this.destroyRef=k(kn,{optional:!0})??void 0,this.pendingTasks=k(Si,{optional:!0})??void 0)}emit(e){let t=he(null);try{super.next(e)}finally{he(t)}}subscribe(e,t,i){let r=e,o=t||(()=>null),a=i;if(e&&typeof e=="object"){let c=e;r=c.next?.bind(c),o=c.error?.bind(c),a=c.complete?.bind(c)}this.__isAsync&&(o=this.wrapInTimeout(o),r&&(r=this.wrapInTimeout(r)),a&&(a=this.wrapInTimeout(a)));let u=super.subscribe({next:r,error:o,complete:a});return e instanceof Tt&&e.add(u),u}wrapInTimeout(e){return t=>{let i=this.pendingTasks?.add();setTimeout(()=>{try{e(t)}finally{i!==void 0&&this.pendingTasks?.remove(i)}})}}},et=Tf;function yC(n){let e,t;function i(){n=Jr;try{t!==void 0&&typeof cancelAnimationFrame=="function"&&cancelAnimationFrame(t),e!==void 0&&clearTimeout(e)}catch{}}return e=setTimeout(()=>{n(),i()}),typeof requestAnimationFrame=="function"&&(t=requestAnimationFrame(()=>{n(),i()})),()=>i()}function ov(n){return queueMicrotask(()=>n()),()=>{n=Jr}}var mg="isAngularZone",Ad=mg+"_ID",Zw=0,Dt=class n{hasPendingMacrotasks=!1;hasPendingMicrotasks=!1;isStable=!0;onUnstable=new et(!1);onMicrotaskEmpty=new et(!1);onStable=new et(!1);onError=new et(!1);constructor(e){let{enableLongStackTrace:t=!1,shouldCoalesceEventChangeDetection:i=!1,shouldCoalesceRunChangeDetection:r=!1,scheduleInRootZone:o=hC}=e;if(typeof Zone>"u")throw new z(908,!1);Zone.assertZonePatched();let a=this;a._nesting=0,a._outer=a._inner=Zone.current,Zone.TaskTrackingZoneSpec&&(a._inner=a._inner.fork(new Zone.TaskTrackingZoneSpec)),t&&Zone.longStackTraceZoneSpec&&(a._inner=a._inner.fork(Zone.longStackTraceZoneSpec)),a.shouldCoalesceEventChangeDetection=!r&&i,a.shouldCoalesceRunChangeDetection=r,a.callbackScheduled=!1,a.scheduleInRootZone=o,tT(a)}static isInAngularZone(){return typeof Zone<"u"&&Zone.current.get(mg)===!0}static assertInAngularZone(){if(!n.isInAngularZone())throw new z(909,!1)}static assertNotInAngularZone(){if(n.isInAngularZone())throw new z(909,!1)}run(e,t,i){return this._inner.run(e,t,i)}runTask(e,t,i,r){let o=this._inner,a=o.scheduleEventTask("NgZoneEvent: "+r,e,Xw,Jr,Jr);try{return o.runTask(a,t,i)}finally{o.cancelTask(a)}}runGuarded(e,t,i){return this._inner.runGuarded(e,t,i)}runOutsideAngular(e){return this._outer.run(e)}},Xw={};function pg(n){if(n._nesting==0&&!n.hasPendingMicrotasks&&!n.isStable)try{n._nesting++,n.onMicrotaskEmpty.emit(null)}finally{if(n._nesting--,!n.hasPendingMicrotasks)try{n.runOutsideAngular(()=>n.onStable.emit(null))}finally{n.isStable=!0}}}function eT(n){if(n.isCheckStableRunning||n.callbackScheduled)return;n.callbackScheduled=!0;function e(){yC(()=>{n.callbackScheduled=!1,If(n),n.isCheckStableRunning=!0,pg(n),n.isCheckStableRunning=!1})}n.scheduleInRootZone?Zone.root.run(()=>{e()}):n._outer.run(()=>{e()}),If(n)}function tT(n){let e=()=>{eT(n)},t=Zw++;n._inner=n._inner.fork({name:"angular",properties:{[mg]:!0,[Ad]:t,[Ad+t]:!0},onInvokeTask:(i,r,o,a,u,c)=>{if(nT(c))return i.invokeTask(o,a,u,c);try{return av(n),i.invokeTask(o,a,u,c)}finally{(n.shouldCoalesceEventChangeDetection&&a.type==="eventTask"||n.shouldCoalesceRunChangeDetection)&&e(),sv(n)}},onInvoke:(i,r,o,a,u,c,p)=>{try{return av(n),i.invoke(o,a,u,c,p)}finally{n.shouldCoalesceRunChangeDetection&&!n.callbackScheduled&&!iT(c)&&e(),sv(n)}},onHasTask:(i,r,o,a)=>{i.hasTask(o,a),r===o&&(a.change=="microTask"?(n._hasPendingMicrotasks=a.microTask,If(n),pg(n)):a.change=="macroTask"&&(n.hasPendingMacrotasks=a.macroTask))},onHandleError:(i,r,o,a)=>(i.handleError(o,a),n.runOutsideAngular(()=>n.onError.emit(a)),!1)})}function If(n){n._hasPendingMicrotasks||(n.shouldCoalesceEventChangeDetection||n.shouldCoalesceRunChangeDetection)&&n.callbackScheduled===!0?n.hasPendingMicrotasks=!0:n.hasPendingMicrotasks=!1}function av(n){n._nesting++,n.isStable&&(n.isStable=!1,n.onUnstable.emit(null))}function sv(n){n._nesting--,pg(n)}var Bs=class{hasPendingMicrotasks=!1;hasPendingMacrotasks=!1;isStable=!0;onUnstable=new et;onMicrotaskEmpty=new et;onStable=new et;onError=new et;run(e,t,i){return e.apply(t,i)}runGuarded(e,t,i){return e.apply(t,i)}runOutsideAngular(e){return e()}runTask(e,t,i,r){return e.apply(t,i)}};function nT(n){return _C(n,"__ignore_ng_zone__")}function iT(n){return _C(n,"__scheduler_tick__")}function _C(n,e){return!Array.isArray(n)||n.length!==1?!1:n[0]?.data?.[e]===!0}var fg=(()=>{class n{impl=null;execute(){this.impl?.execute()}static \u0275prov=X({token:n,providedIn:"root",factory:()=>new n})}return n})(),vC=[0,1,2,3],CC=(()=>{class n{ngZone=k(Dt);scheduler=k(In);errorHandler=k(Tn,{optional:!0});sequences=new Set;deferredRegistrations=new Set;executing=!1;constructor(){k(no,{optional:!0})}execute(){let t=this.sequences.size>0;t&&Je(16),this.executing=!0;for(let i of vC)for(let r of this.sequences)if(!(r.erroredOrDestroyed||!r.hooks[i]))try{r.pipelinedValue=this.ngZone.runOutsideAngular(()=>this.maybeTrace(()=>{let o=r.hooks[i];return o(r.pipelinedValue)},r.snapshot))}catch(o){r.erroredOrDestroyed=!0,this.errorHandler?.handleError(o)}this.executing=!1;for(let i of this.sequences)i.afterRun(),i.once&&(this.sequences.delete(i),i.destroy());for(let i of this.deferredRegistrations)this.sequences.add(i);this.deferredRegistrations.size>0&&this.scheduler.notify(7),this.deferredRegistrations.clear(),t&&Je(17)}register(t){let{view:i}=t;i!==void 0?((i[qr]??=[]).push(t),gr(i),i[ye]|=8192):this.executing?this.deferredRegistrations.add(t):this.addSequence(t)}addSequence(t){this.sequences.add(t),this.scheduler.notify(7)}unregister(t){this.executing&&this.sequences.has(t)?(t.erroredOrDestroyed=!0,t.pipelinedValue=void 0,t.once=!0):(this.sequences.delete(t),this.deferredRegistrations.delete(t))}maybeTrace(t,i){return i?i.run(Jd.AFTER_NEXT_RENDER,t):t()}static \u0275prov=X({token:n,providedIn:"root",factory:()=>new n})}return n})(),Rd=class{impl;hooks;view;once;snapshot;erroredOrDestroyed=!1;pipelinedValue=void 0;unregisterOnDestroy;constructor(e,t,i,r,o,a=null){this.impl=e,this.hooks=t,this.view=i,this.once=r,this.snapshot=a,this.unregisterOnDestroy=o?.onDestroy(()=>this.destroy())}afterRun(){this.erroredOrDestroyed=!1,this.pipelinedValue=void 0,this.snapshot?.dispose(),this.snapshot=null}destroy(){this.impl.unregister(this),this.unregisterOnDestroy?.();let e=this.view?.[qr];e&&(this.view[qr]=e.filter(t=>t!==this))}};function Wi(n,e){let t=e?.injector??k(Qt);return qi("NgAfterNextRender"),oT(n,t,e,!0)}function rT(n){return n instanceof Function?[void 0,void 0,n,void 0]:[n.earlyRead,n.write,n.mixedReadWrite,n.read]}function oT(n,e,t,i){let r=e.get(fg);r.impl??=e.get(CC);let o=e.get(no,null,{optional:!0}),a=t?.manualCleanup!==!0?e.get(kn):null,u=e.get(Zo,null,{optional:!0}),c=new Rd(r.impl,rT(n),u?.view,i,a,o?.snapshot(null));return r.impl.register(c),c}var xC=new ne("",{providedIn:"root",factory:()=>({queue:new Set,isScheduled:!1,scheduler:null})});function bC(n,e,t){let i=n.get(xC);if(Array.isArray(e))for(let r of e)i.queue.add(r),t?.detachedLeaveAnimationFns?.push(r);else i.queue.add(e),t?.detachedLeaveAnimationFns?.push(e);i.scheduler&&i.scheduler(n)}function aT(n,e){let t=n.get(xC);if(e.detachedLeaveAnimationFns){for(let i of e.detachedLeaveAnimationFns)t.queue.delete(i);e.detachedLeaveAnimationFns=void 0}}function sT(n,e){for(let[t,i]of e)bC(n,i.animateFns)}function lv(n,e,t,i){let r=n?.[Wr]?.enter;e!==null&&r&&r.has(t.index)&&sT(i,r)}function ea(n,e,t,i,r,o,a,u){if(r!=null){let c,p=!1;ti(r)?c=r:bi(r)&&(p=!0,r=r[ei]);let g=Nn(r);n===0&&i!==null?(lv(u,i,o,t),a==null?sC(e,i,g):Md(e,i,g,a||null,!0)):n===1&&i!==null?(lv(u,i,o,t),Md(e,i,g,a||null,!0)):n===2?uv(u,o,t,y=>{lC(e,g,p,y)}):n===3&&uv(u,o,t,()=>{e.destroyNode(g)}),c!=null&&CT(e,n,t,c,o,i,a)}}function lT(n,e){EC(n,e),e[ei]=null,e[Rn]=null}function uT(n,e,t,i,r,o){i[ei]=r,i[Rn]=e,Qd(n,i,t,1,r,o)}function EC(n,e){e[Ci].changeDetectionScheduler?.notify(9),Qd(n,e,e[Xe],2,null,null)}function dT(n){let e=n[zo];if(!e)return lf(n[ue],n);for(;e;){let t=null;if(bi(e))t=e[zo];else{let i=e[Ct];i&&(t=i)}if(!t){for(;e&&!e[An]&&e!==n;)bi(e)&&lf(e[ue],e),e=e[Pt];e===null&&(e=n),bi(e)&&lf(e[ue],e),t=e&&e[An]}e=t}}function gg(n,e){let t=n[jr],i=t.indexOf(e);t.splice(i,1)}function Kd(n,e){if(zr(e))return;let t=e[Xe];t.destroyNode&&Qd(n,e,t,3,null,null),dT(e)}function lf(n,e){if(zr(e))return;let t=he(null);try{e[ye]&=-129,e[ye]|=256,e[Sn]&&Nr(e[Sn]),pT(n,e),mT(n,e),e[ue].type===1&&e[Xe].destroy();let i=e[mr];if(i!==null&&ti(e[Pt])){i!==e[Pt]&&gg(i,e);let r=e[xi];r!==null&&r.detachView(n)}Cf(e)}finally{he(t)}}function uv(n,e,t,i){let r=n?.[Wr];if(r==null||r.leave==null||!r.leave.has(e.index))return i(!1);n&&Zr.add(n),bC(t,()=>{if(r.leave&&r.leave.has(e.index)){let a=r.leave.get(e.index),u=[];if(a){for(let c=0;c<a.animateFns.length;c++){let p=a.animateFns[c],{promise:g}=p();u.push(g)}r.detachedLeaveAnimationFns=void 0}r.running=Promise.allSettled(u),cT(n,i)}else n&&Zr.delete(n),i(!1)},r)}function cT(n,e){let t=n[Wr]?.running;if(t){t.then(()=>{n[Wr].running=void 0,Zr.delete(n),e(!0)});return}e(!1)}function mT(n,e){let t=n.cleanup,i=e[jo];if(t!==null)for(let a=0;a<t.length-1;a+=2)if(typeof t[a]=="string"){let u=t[a+3];u>=0?i[u]():i[-u].unsubscribe(),a+=2}else{let u=i[t[a+1]];t[a].call(u)}i!==null&&(e[jo]=null);let r=e[Vi];if(r!==null){e[Vi]=null;for(let a=0;a<r.length;a++){let u=r[a];u()}}let o=e[Bi];if(o!==null){e[Bi]=null;for(let a of o)a.destroy()}}function pT(n,e){let t;if(n!=null&&(t=n.destroyHooks)!=null)for(let i=0;i<t.length;i+=2){let r=e[t[i]];if(!(r instanceof Qr)){let o=t[i+1];if(Array.isArray(o))for(let a=0;a<o.length;a+=2){let u=r[o[a]],c=o[a+1];Je(4,u,c);try{c.call(u)}finally{Je(5,u,c)}}else{Je(4,r,o);try{o.call(r)}finally{Je(5,r,o)}}}}}function fT(n,e,t){return gT(n,e.parent,t)}function gT(n,e,t){let i=e;for(;i!==null&&i.type&168;)e=i,i=e.parent;if(i===null)return t[ei];if(fr(i)){let{encapsulation:r}=n.data[i.directiveStart+i.componentOffset];if(r===$i.None||r===$i.Emulated)return null}return ni(i,t)}function hT(n,e,t){return _T(n,e,t)}function yT(n,e,t){return n.type&40?ni(n,t):null}var _T=yT,dv;function hg(n,e,t,i){let r=fT(n,i,e),o=e[Xe],a=i.parent||e[Rn],u=hT(a,i,e);if(r!=null)if(Array.isArray(t))for(let c=0;c<t.length;c++)nv(o,r,t[c],u,!1);else nv(o,r,t,u,!1);dv!==void 0&&dv(o,i,e,t,r)}function Vs(n,e){if(e!==null){let t=e.type;if(t&3)return ni(e,n);if(t&4)return Mf(-1,n[e.index]);if(t&8){let i=e.child;if(i!==null)return Vs(n,i);{let r=n[e.index];return ti(r)?Mf(-1,r):Nn(r)}}else{if(t&128)return Vs(n,e.next);if(t&32)return cg(e,n)()||Nn(n[e.index]);{let i=SC(n,e);if(i!==null){if(Array.isArray(i))return i[0];let r=sr(n[En]);return Vs(r,i)}else return Vs(n,e.next)}}}return null}function SC(n,e){if(e!==null){let i=n[En][Rn],r=e.projection;return i.projection[r]}return null}function Mf(n,e){let t=Ct+n+1;if(t<e.length){let i=e[t],r=i[ue].firstChild;if(r!==null)return Vs(i,r)}return e[pr]}function yg(n,e,t,i,r,o,a){for(;t!=null;){let u=i[Oi];if(t.type===128){t=t.next;continue}let c=i[t.index],p=t.type;if(a&&e===0&&(c&&ia(Nn(c),i),t.flags|=2),!tg(t))if(p&8)yg(n,e,t.child,i,r,o,!1),ea(e,n,u,r,c,t,o,i);else if(p&32){let g=cg(t,i),y;for(;y=g();)ea(e,n,u,r,y,t,o,i);ea(e,n,u,r,c,t,o,i)}else p&16?vT(n,e,i,t,r,o):ea(e,n,u,r,c,t,o,i);t=a?t.projectionNext:t.next}}function Qd(n,e,t,i,r,o){yg(t,i,n.firstChild,e,r,o,!1)}function vT(n,e,t,i,r,o){let a=t[En],c=a[Rn].projection[i.projection];if(Array.isArray(c))for(let p=0;p<c.length;p++){let g=c[p];ea(e,n,t[Oi],r,g,i,o,t)}else{let p=c,g=a[Pt];$v(i)&&(p.flags|=128),yg(n,e,p,g,r,o,!0)}}function CT(n,e,t,i,r,o,a){let u=i[pr],c=Nn(i);u!==c&&ea(e,n,t,o,u,r,a);for(let p=Ct;p<i.length;p++){let g=i[p];Qd(g[ue],g,n,e,o,u)}}function xT(n,e,t,i,r){if(e)r?n.addClass(t,i):n.removeClass(t,i);else{let o=i.indexOf("-")===-1?void 0:wi.DashCase;r==null?n.removeStyle(t,i,o):(typeof r=="string"&&r.endsWith("!important")&&(r=r.slice(0,-10),o|=wi.Important),n.setStyle(t,i,r,o))}}function DC(n,e,t,i,r){let o=ii(),a=i&2;try{yr(-1),a&&e.length>pt&&gC(n,e,pt,!1),Je(a?2:0,r,t),t(i,r)}finally{yr(o),Je(a?3:1,r,t)}}function Zd(n,e,t){TT(n,e,t),(t.flags&64)===64&&IT(n,e,t)}function Qs(n,e,t=ni){let i=e.localNames;if(i!==null){let r=e.index+1;for(let o=0;o<i.length;o+=2){let a=i[o+1],u=a===-1?t(e,n):n[a];n[r++]=u}}}function bT(n,e,t,i){let o=i.get(Jv,Yv)||t===$i.ShadowDom,a=n.selectRootElement(e,o);return ET(a),a}function ET(n){ST(n)}var ST=()=>null;function DT(n){return n==="class"?"className":n==="for"?"htmlFor":n==="formaction"?"formAction":n==="innerHtml"?"innerHTML":n==="readonly"?"readOnly":n==="tabindex"?"tabIndex":n}function wC(n,e,t,i,r,o){let a=e[ue];if(xg(n,a,e,t,i)){fr(n)&&wT(e,n.index);return}n.type&3&&(t=DT(t)),TC(n,e,t,i,r,o)}function TC(n,e,t,i,r,o){if(n.type&3){let a=ni(n,e);i=o!=null?o(i,n.value||"",t):i,r.setProperty(a,t,i)}else n.type&12}function wT(n,e){let t=Fn(e,n);t[ye]&16||(t[ye]|=64)}function TT(n,e,t){let i=t.directiveStart,r=t.directiveEnd;fr(t)&&Kw(e,t,n.data[i+t.componentOffset]),n.firstCreatePass||wd(t,e);let o=t.initialInputs;for(let a=i;a<r;a++){let u=n.data[a],c=Os(e,n,a,t);if(ia(c,e),o!==null&&NT(e,a-i,c,u,t,o),Ei(u)){let p=Fn(t.index,e);p[St]=Os(e,n,a,t)}}}function IT(n,e,t){let i=t.directiveStart,r=t.directiveEnd,o=t.index,a=k1();try{yr(o);for(let u=i;u<r;u++){let c=n.data[u],p=e[u];ad(u),(c.hostBindings!==null||c.hostVars!==0||c.hostAttrs!==null)&&MT(c,p)}}finally{yr(-1),ad(a)}}function MT(n,e){n.hostBindings!==null&&n.hostBindings(1,e)}function _g(n,e){let t=n.directiveRegistry,i=null;if(t)for(let r=0;r<t.length;r++){let o=t[r];Hw(e,o.selectors,!1)&&(i??=[],Ei(o)?i.unshift(o):i.push(o))}return i}function AT(n,e,t,i,r,o){let a=ni(n,e);RT(e[Xe],a,o,n.value,t,i,r)}function RT(n,e,t,i,r,o,a){if(o==null)n.removeAttribute(e,r,t);else{let u=a==null?Xn(o):a(o,i||"",r);n.setAttribute(e,r,u,t)}}function NT(n,e,t,i,r,o){let a=o[e];if(a!==null)for(let u=0;u<a.length;u+=2){let c=a[u],p=a[u+1];wf(i,t,c,p)}}function vg(n,e,t,i,r){let o=pt+t,a=e[ue],u=r(a,e,n,i,t);e[o]=u,Ko(n,!0);let c=n.type===2;return c?(uC(e[Xe],u,n),(w1()===0||Yo(n))&&ia(u,e),T1()):ia(u,e),dd()&&(!c||!tg(n))&&hg(a,e,u,n),n}function Cg(n){let e=n;return Y0()?A1():(e=e.parent,Ko(e,!1)),e}function FT(n,e){let t=n[Oi];if(!t)return;let i;try{i=t.get(_n,null)}catch{i=null}i?.(e)}function xg(n,e,t,i,r){let o=n.inputs?.[i],a=n.hostDirectiveInputs?.[i],u=!1;if(a)for(let c=0;c<a.length;c+=2){let p=a[c],g=a[c+1],y=e.data[p];wf(y,t[p],g,r),u=!0}if(o)for(let c of o){let p=t[c],g=e.data[c];wf(g,p,i,r),u=!0}return u}function PT(n,e){let t=Fn(e,n),i=t[ue];kT(i,t);let r=t[ei];r!==null&&t[Wo]===null&&(t[Wo]=Kv(r,t[Oi])),Je(18),bg(i,t,t[St]),Je(19,t[St])}function kT(n,e){for(let t=e.length;t<n.blueprint.length;t++)e.push(n.blueprint[t])}function bg(n,e,t){ld(e);try{let i=n.viewQuery;i!==null&&bf(1,i,t);let r=n.template;r!==null&&DC(n,e,r,1,t),n.firstCreatePass&&(n.firstCreatePass=!1),e[xi]?.finishViewCreation(n),n.staticContentQueries&&Qv(n,e),n.staticViewQueries&&bf(2,n.viewQuery,t);let o=n.components;o!==null&&VT(e,o)}catch(i){throw n.firstCreatePass&&(n.incompleteFirstPass=!0,n.firstCreatePass=!1),i}finally{e[ye]&=-5,ud()}}function VT(n,e){for(let t=0;t<e.length;t++)PT(n,e[t])}function Xd(n,e,t,i){let r=he(null);try{let o=e.tView,u=n[ye]&4096?4096:16,c=ug(n,o,t,u,null,e,null,null,i?.injector??null,i?.embeddedViewInjector??null,i?.dehydratedView??null),p=n[e.index];c[mr]=p;let g=n[xi];return g!==null&&(c[xi]=g.createEmbeddedView(o)),bg(o,c,t),c}finally{he(r)}}function Us(n,e){return!e||e.firstChild===null||$v(n)}function $s(n,e,t,i,r=!1){for(;t!==null;){if(t.type===128){t=r?t.projectionNext:t.next;continue}let o=e[t.index];o!==null&&i.push(Nn(o)),ti(o)&&IC(o,i);let a=t.type;if(a&8)$s(n,e,t.child,i);else if(a&32){let u=cg(t,e),c;for(;c=u();)i.push(c)}else if(a&16){let u=SC(e,t);if(Array.isArray(u))i.push(...u);else{let c=sr(e[En]);$s(c[ue],c,u,i,!0)}}t=r?t.projectionNext:t.next}return i}function IC(n,e){for(let t=Ct;t<n.length;t++){let i=n[t],r=i[ue].firstChild;r!==null&&$s(i[ue],i,r,e)}n[pr]!==n[ei]&&e.push(n[pr])}function MC(n){if(n[qr]!==null){for(let e of n[qr])e.impl.addSequence(e);n[qr].length=0}}var AC=[];function LT(n){return n[Sn]??OT(n)}function OT(n){let e=AC.pop()??Object.create(UT);return e.lView=n,e}function BT(n){n.lView[Sn]!==n&&(n.lView=null,AC.push(n))}var UT=G(O({},Ar),{consumerIsAlwaysLive:!0,kind:"template",consumerMarkedDirty:n=>{gr(n.lView)},consumerOnSignalRead(){this.lView[Sn]=this}});function $T(n){let e=n[Sn]??Object.create(HT);return e.lView=n,e}var HT=G(O({},Ar),{consumerIsAlwaysLive:!0,kind:"template",consumerMarkedDirty:n=>{let e=sr(n.lView);for(;e&&!RC(e[ue]);)e=sr(e);e&&U0(e)},consumerOnSignalRead(){this.lView[Sn]=this}});function RC(n){return n.type!==2}function NC(n){if(n[Bi]===null)return;let e=!0;for(;e;){let t=!1;for(let i of n[Bi])i.dirty&&(t=!0,i.zone===null||Zone.current===i.zone?i.run():i.zone.run(()=>i.run()));e=t&&!!(n[ye]&8192)}}var GT=100;function FC(n,e=0){let i=n[Ci].rendererFactory,r=!1;r||i.begin?.();try{qT(n,e)}finally{r||i.end?.()}}function qT(n,e){let t=J0();try{Qo(!0),Af(n,e);let i=0;for(;As(n);){if(i===GT)throw new z(103,!1);i++,Af(n,1)}}finally{Qo(t)}}function WT(n,e,t,i){if(zr(e))return;let r=e[ye],o=!1,a=!1;ld(e);let u=!0,c=null,p=null;o||(RC(n)?(p=LT(e),c=Rr(p)):fu()===null?(u=!1,p=$T(e),c=Rr(p)):e[Sn]&&(Nr(e[Sn]),e[Sn]=null));try{B0(e),N1(n.bindingStartIndex),t!==null&&DC(n,e,t,2,i);let g=(r&3)===3;if(!o)if(g){let C=n.preOrderCheckHooks;C!==null&&yd(e,C,null)}else{let C=n.preOrderHooks;C!==null&&_d(e,C,0,null),af(e,0)}if(a||jT(e),NC(e),PC(e,0),n.contentQueries!==null&&Qv(n,e),!o)if(g){let C=n.contentCheckHooks;C!==null&&yd(e,C)}else{let C=n.contentHooks;C!==null&&_d(e,C,1),af(e,1)}YT(n,e);let y=n.components;y!==null&&VC(e,y,0);let v=n.viewQuery;if(v!==null&&bf(2,v,i),!o)if(g){let C=n.viewCheckHooks;C!==null&&yd(e,C)}else{let C=n.viewHooks;C!==null&&_d(e,C,2),af(e,2)}if(n.firstUpdatePass===!0&&(n.firstUpdatePass=!1),e[ed]){for(let C of e[ed])C();e[ed]=null}o||(MC(e),e[ye]&=-73)}catch(g){throw o||gr(e),g}finally{p!==null&&(Ao(p,c),u&&BT(p)),ud()}}function PC(n,e){for(let t=Gv(n);t!==null;t=qv(t))for(let i=Ct;i<t.length;i++){let r=t[i];kC(r,e)}}function jT(n){for(let e=Gv(n);e!==null;e=qv(e)){if(!(e[ye]&2))continue;let t=e[jr];for(let i=0;i<t.length;i++){let r=t[i];U0(r)}}}function zT(n,e,t){Je(18);let i=Fn(e,n);kC(i,t),Je(19,i[St])}function kC(n,e){nd(n)&&Af(n,e)}function Af(n,e){let i=n[ue],r=n[ye],o=n[Sn],a=!!(e===0&&r&16);if(a||=!!(r&64&&e===0),a||=!!(r&1024),a||=!!(o?.dirty&&Ro(o)),a||=!1,o&&(o.dirty=!1),n[ye]&=-9217,a)WT(i,n,i.template,n[St]);else if(r&8192){let u=he(null);try{NC(n),PC(n,1);let c=i.components;c!==null&&VC(n,c,1),MC(n)}finally{he(u)}}}function VC(n,e,t){for(let i=0;i<e.length;i++)zT(n,e[i],t)}function YT(n,e){let t=n.hostBindingOpCodes;if(t!==null)try{for(let i=0;i<t.length;i++){let r=t[i];if(r<0)yr(~r);else{let o=r,a=t[++i],u=t[++i];P1(a,o);let c=e[o];Je(24,c),u(2,c),Je(25,c)}}}finally{yr(-1)}}function Eg(n,e){let t=J0()?64:1088;for(n[Ci].changeDetectionScheduler?.notify(e);n;){n[ye]|=t;let i=sr(n);if(Jo(n)&&!i)return n;n=i}return null}function LC(n,e,t,i){return[n,!0,0,e,null,i,null,t,null,null]}function OC(n,e){let t=Ct+e;if(t<n.length)return n[t]}function ec(n,e,t,i=!0){let r=e[ue];if(JT(r,e,n,t),i){let a=Mf(t,n),u=e[Xe],c=u.parentNode(n[pr]);c!==null&&uT(r,n[Rn],u,e,c,a)}let o=e[Wo];o!==null&&o.firstChild!==null&&(o.firstChild=null)}function BC(n,e){let t=Hs(n,e);return t!==void 0&&Kd(t[ue],t),t}function Hs(n,e){if(n.length<=Ct)return;let t=Ct+e,i=n[t];if(i){let r=i[mr];r!==null&&r!==n&&gg(r,i),e>0&&(n[t-1][An]=i[An]);let o=Ss(n,Ct+e);lT(i[ue],i);let a=o[xi];a!==null&&a.detachView(o[ue]),i[Pt]=null,i[An]=null,i[ye]&=-129}return i}function JT(n,e,t,i){let r=Ct+i,o=t.length;i>0&&(t[r-1][An]=e),i<o-Ct?(e[An]=t[r],S0(t,Ct+i,e)):(t.push(e),e[An]=null),e[Pt]=t;let a=e[mr];a!==null&&t!==a&&UC(a,e);let u=e[xi];u!==null&&u.insertView(n),id(e),e[ye]|=128}function UC(n,e){let t=n[jr],i=e[Pt];if(bi(i))n[ye]|=2;else{let r=i[Pt][En];e[En]!==r&&(n[ye]|=2)}t===null?n[jr]=[e]:t.push(e)}var _r=class{_lView;_cdRefInjectingView;_appRef=null;_attachedToViewContainer=!1;exhaustive;get rootNodes(){let e=this._lView,t=e[ue];return $s(t,e,t.firstChild,[])}constructor(e,t){this._lView=e,this._cdRefInjectingView=t}get context(){return this._lView[St]}set context(e){this._lView[St]=e}get destroyed(){return zr(this._lView)}destroy(){if(this._appRef)this._appRef.detachView(this);else if(this._attachedToViewContainer){let e=this._lView[Pt];if(ti(e)){let t=e[Is],i=t?t.indexOf(this):-1;i>-1&&(Hs(e,i),Ss(t,i))}this._attachedToViewContainer=!1}Kd(this._lView[ue],this._lView)}onDestroy(e){$0(this._lView,e)}markForCheck(){Eg(this._cdRefInjectingView||this._lView,4)}detach(){this._lView[ye]&=-129}reattach(){id(this._lView),this._lView[ye]|=128}detectChanges(){this._lView[ye]|=1024,FC(this._lView)}checkNoChanges(){}attachToViewContainerRef(){if(this._appRef)throw new z(902,!1);this._attachedToViewContainer=!0}detachFromAppRef(){this._appRef=null;let e=Jo(this._lView),t=this._lView[mr];t!==null&&!e&&gg(t,this._lView),EC(this._lView[ue],this._lView)}attachToAppRef(e){if(this._attachedToViewContainer)throw new z(902,!1);this._appRef=e;let t=Jo(this._lView),i=this._lView[mr];i!==null&&!t&&UC(i,this._lView),id(this._lView)}};var vr=(()=>{class n{_declarationLView;_declarationTContainer;elementRef;static __NG_ELEMENT_ID__=KT;constructor(t,i,r){this._declarationLView=t,this._declarationTContainer=i,this.elementRef=r}get ssrId(){return this._declarationTContainer.tView?.ssrId||null}createEmbeddedView(t,i){return this.createEmbeddedViewImpl(t,i)}createEmbeddedViewImpl(t,i,r){let o=Xd(this._declarationLView,this._declarationTContainer,t,{embeddedViewInjector:i,dehydratedView:r});return new _r(o)}}return n})();function KT(){return Sg(Rt(),pe())}function Sg(n,e){return n.type&4?new vr(e,n,aa(n,e)):null}function Zs(n,e,t,i,r){let o=n.data[e];if(o===null)o=QT(n,e,t,i,r),F1()&&(o.flags|=32);else if(o.type&64){o.type=t,o.value=i,o.attrs=r;let a=M1();o.injectorIndex=a===null?-1:a.injectorIndex}return Ko(o,!0),o}function QT(n,e,t,i,r){let o=z0(),a=Y0(),u=a?o:o&&o.parent,c=n.data[e]=XT(n,u,t,e,i,r);return ZT(n,c,o,a),c}function ZT(n,e,t,i){n.firstChild===null&&(n.firstChild=e),t!==null&&(i?t.child==null&&e.parent!==null&&(t.child=e):t.next===null&&(t.next=e,e.prev=t))}function XT(n,e,t,i,r,o){let a=e?e.injectorIndex:-1,u=0;return I1()&&(u|=128),{type:t,index:i,insertBeforeIndex:null,injectorIndex:a,directiveStart:-1,directiveEnd:-1,directiveStylingLast:-1,componentOffset:-1,propertyBindings:null,flags:u,providerIndexes:0,value:r,attrs:o,mergedAttrs:null,localNames:null,initialInputs:null,inputs:null,hostDirectiveInputs:null,outputs:null,hostDirectiveOutputs:null,directiveToIndex:null,tView:null,next:null,prev:null,projectionNext:null,child:null,parent:e,projection:null,styles:null,stylesWithoutHost:null,residualStyles:void 0,classes:null,classesWithoutHost:null,residualClasses:void 0,classBindings:0,styleBindings:0}}var WZ=new RegExp(`^(\\d+)*(${rw}|${iw})*(.*)`);function eI(n){let e=n[P0]??[],i=n[Pt][Xe],r=[];for(let o of e)o.data[zv]!==void 0?r.push(o):tI(o,i);n[P0]=r}function tI(n,e){let t=0,i=n.firstChild;if(i){let r=n.data[jv];for(;t<r;){let o=i.nextSibling;lC(e,i,!1),i=o,t++}}}var nI=()=>null,iI=()=>null;function Rf(n,e){return nI(n,e)}function $C(n,e,t){return iI(n,e,t)}var HC=class{},tc=class{},Nf=class{resolveComponentFactory(e){throw new z(917,!1)}},Xs=class{static NULL=new Nf},Xr=class{},ai=(()=>{class n{destroyNode=null;static __NG_ELEMENT_ID__=()=>rI()}return n})();function rI(){let n=pe(),e=Rt(),t=Fn(e.index,n);return(bi(t)?t:n)[Xe]}var GC=(()=>{class n{static \u0275prov=X({token:n,providedIn:"root",factory:()=>null})}return n})();var Cd={},Ff=class{injector;parentInjector;constructor(e,t){this.injector=e,this.parentInjector=t}get(e,t,i){let r=this.injector.get(e,Cd,i);return r!==Cd||t===Cd?r:this.parentInjector.get(e,t,i)}};function Nd(n,e,t){let i=t?n.styles:null,r=t?n.classes:null,o=0;if(e!==null)for(let a=0;a<e.length;a++){let u=e[a];if(typeof u=="number")o=u;else if(o==1)r=Yu(r,u);else if(o==2){let c=u,p=e[++a];i=Yu(i,c+": "+p+";")}}t?n.styles=i:n.stylesWithoutHost=i,t?n.classes=r:n.classesWithoutHost=r}function ee(n,e=0){let t=pe();if(t===null)return ae(n,e);let i=Rt();return Ov(i,t,Gt(n),e)}function qC(n,e,t,i,r){let o=i===null?null:{"":-1},a=r(n,t);if(a!==null){let u=a,c=null,p=null;for(let g of a)if(g.resolveHostDirectives!==null){[u,c,p]=g.resolveHostDirectives(a);break}sI(n,e,t,u,o,c,p)}o!==null&&i!==null&&oI(t,i,o)}function oI(n,e,t){let i=n.localNames=[];for(let r=0;r<e.length;r+=2){let o=t[e[r+1]];if(o==null)throw new z(-301,!1);i.push(e[r],o)}}function aI(n,e,t){e.componentOffset=t,(n.components??=[]).push(e.index)}function sI(n,e,t,i,r,o,a){let u=i.length,c=!1;for(let v=0;v<u;v++){let C=i[v];!c&&Ei(C)&&(c=!0,aI(n,t,v)),_f(wd(t,e),n,C.type)}pI(t,n.data.length,u);for(let v=0;v<u;v++){let C=i[v];C.providersResolver&&C.providersResolver(C)}let p=!1,g=!1,y=fC(n,e,u,null);u>0&&(t.directiveToIndex=new Map);for(let v=0;v<u;v++){let C=i[v];if(t.mergedAttrs=na(t.mergedAttrs,C.hostAttrs),uI(n,t,e,y,C),mI(y,C,r),a!==null&&a.has(C)){let[R,F]=a.get(C);t.directiveToIndex.set(C.type,[y,R+t.directiveStart,F+t.directiveStart])}else(o===null||!o.has(C))&&t.directiveToIndex.set(C.type,y);C.contentQueries!==null&&(t.flags|=4),(C.hostBindings!==null||C.hostAttrs!==null||C.hostVars!==0)&&(t.flags|=64);let T=C.type.prototype;!p&&(T.ngOnChanges||T.ngOnInit||T.ngDoCheck)&&((n.preOrderHooks??=[]).push(t.index),p=!0),!g&&(T.ngOnChanges||T.ngDoCheck)&&((n.preOrderCheckHooks??=[]).push(t.index),g=!0),y++}lI(n,t,o)}function lI(n,e,t){for(let i=e.directiveStart;i<e.directiveEnd;i++){let r=n.data[i];if(t===null||!t.has(r))cv(0,e,r,i),cv(1,e,r,i),pv(e,i,!1);else{let o=t.get(r);mv(0,e,o,i),mv(1,e,o,i),pv(e,i,!0)}}}function cv(n,e,t,i){let r=n===0?t.inputs:t.outputs;for(let o in r)if(r.hasOwnProperty(o)){let a;n===0?a=e.inputs??={}:a=e.outputs??={},a[o]??=[],a[o].push(i),WC(e,o)}}function mv(n,e,t,i){let r=n===0?t.inputs:t.outputs;for(let o in r)if(r.hasOwnProperty(o)){let a=r[o],u;n===0?u=e.hostDirectiveInputs??={}:u=e.hostDirectiveOutputs??={},u[a]??=[],u[a].push(i,o),WC(e,a)}}function WC(n,e){e==="class"?n.flags|=8:e==="style"&&(n.flags|=16)}function pv(n,e,t){let{attrs:i,inputs:r,hostDirectiveInputs:o}=n;if(i===null||!t&&r===null||t&&o===null||sg(n)){n.initialInputs??=[],n.initialInputs.push(null);return}let a=null,u=0;for(;u<i.length;){let c=i[u];if(c===0){u+=4;continue}else if(c===5){u+=2;continue}else if(typeof c=="number")break;if(!t&&r.hasOwnProperty(c)){let p=r[c];for(let g of p)if(g===e){a??=[],a.push(c,i[u+1]);break}}else if(t&&o.hasOwnProperty(c)){let p=o[c];for(let g=0;g<p.length;g+=2)if(p[g]===e){a??=[],a.push(p[g+1],i[u+1]);break}}u+=2}n.initialInputs??=[],n.initialInputs.push(a)}function uI(n,e,t,i,r){n.data[i]=r;let o=r.factory||(r.factory=ar(r.type,!0)),a=new Qr(o,Ei(r),ee,null);n.blueprint[i]=a,t[i]=a,dI(n,e,i,fC(n,t,r.hostVars,Wt),r)}function dI(n,e,t,i,r){let o=r.hostBindings;if(o){let a=n.hostBindingOpCodes;a===null&&(a=n.hostBindingOpCodes=[]);let u=~e.index;cI(a)!=u&&a.push(u),a.push(t,i,o)}}function cI(n){let e=n.length;for(;e>0;){let t=n[--e];if(typeof t=="number"&&t<0)return t}return 0}function mI(n,e,t){if(t){if(e.exportAs)for(let i=0;i<e.exportAs.length;i++)t[e.exportAs[i]]=n;Ei(e)&&(t[""]=n)}}function pI(n,e,t){n.flags|=1,n.directiveStart=e,n.directiveEnd=e+t,n.providerIndexes=e}function Dg(n,e,t,i,r,o,a,u){let c=e[ue],p=c.consts,g=Pn(p,a),y=Zs(c,n,t,i,g);return o&&qC(c,e,y,Pn(p,u),r),y.mergedAttrs=na(y.mergedAttrs,y.attrs),y.attrs!==null&&Nd(y,y.attrs,!1),y.mergedAttrs!==null&&Nd(y,y.mergedAttrs,!0),c.queries!==null&&c.queries.elementStart(c,y),y}function wg(n,e){Mv(n,e),k0(e)&&n.queries.elementEnd(e)}function fI(n,e,t,i,r,o){let a=e.consts,u=Pn(a,r),c=Zs(e,n,t,i,u);if(c.mergedAttrs=na(c.mergedAttrs,c.attrs),o!=null){let p=Pn(a,o);c.localNames=[];for(let g=0;g<p.length;g+=2)c.localNames.push(p[g],-1)}return c.attrs!==null&&Nd(c,c.attrs,!1),c.mergedAttrs!==null&&Nd(c,c.mergedAttrs,!0),e.queries!==null&&e.queries.elementStart(e,c),c}function Tg(n){return zC(n)?Array.isArray(n)||!(n instanceof Map)&&Symbol.iterator in n:!1}function jC(n,e){if(Array.isArray(n))for(let t=0;t<n.length;t++)e(n[t]);else{let t=n[Symbol.iterator](),i;for(;!(i=t.next()).done;)e(i.value)}}function zC(n){return n!==null&&(typeof n=="function"||typeof n=="object")}function Ig(n,e,t){return n[e]=t}function gI(n,e){return n[e]}function Vn(n,e,t){if(t===Wt)return!1;let i=n[e];return Object.is(i,t)?!1:(n[e]=t,!0)}function Gs(n,e,t,i){let r=Vn(n,e,t);return Vn(n,e+1,i)||r}function hI(n,e,t,i,r){let o=Gs(n,e,t,i);return Vn(n,e+2,r)||o}function yI(n,e,t,i,r,o){let a=Gs(n,e,t,i);return Gs(n,e+2,r,o)||a}function xd(n,e,t){return function i(r){let o=fr(n)?Fn(n.index,e):e;Eg(o,5);let a=e[St],u=fv(e,a,t,r),c=i.__ngNextListenerFn__;for(;c;)u=fv(e,a,c,r)&&u,c=c.__ngNextListenerFn__;return u}}function fv(n,e,t,i){let r=he(null);try{return Je(6,e,t),t(i)!==!1}catch(o){return FT(n,o),!1}finally{Je(7,e,t),he(r)}}function YC(n,e,t,i,r,o,a,u){let c=Yo(n),p=!1,g=null;if(!i&&c&&(g=vI(e,t,o,n.index)),g!==null){let y=g.__ngLastListenerFn__||g;y.__ngNextListenerFn__=a,g.__ngLastListenerFn__=a,p=!0}else{let y=ni(n,t),v=i?i(y):y;aw(t,v,o,u);let C=r.listen(v,o,u);if(!_I(o)){let T=i?R=>i(Nn(R[n.index])):n.index;JC(T,e,t,o,u,C,!1)}}return p}function _I(n){return n.startsWith("animation")||n.startsWith("transition")}function vI(n,e,t,i){let r=n.cleanup;if(r!=null)for(let o=0;o<r.length-1;o+=2){let a=r[o];if(a===t&&r[o+1]===i){let u=e[jo],c=r[o+2];return u&&u.length>c?u[c]:null}typeof a=="string"&&(o+=2)}return null}function JC(n,e,t,i,r,o,a){let u=e.firstCreatePass?G0(e):null,c=H0(t),p=c.length;c.push(r,o),u&&u.push(i,n,p,(p+1)*(a?-1:1))}function gv(n,e,t,i,r,o){let a=e[t],u=e[ue],p=u.data[t].outputs[i],y=a[p].subscribe(o);JC(n.index,u,e,r,o,y,!0)}var Pf=Symbol("BINDING");var Fd=class extends Xs{ngModule;constructor(e){super(),this.ngModule=e}resolveComponentFactory(e){let t=cr(e);return new ra(t,this.ngModule)}};function CI(n){return Object.keys(n).map(e=>{let[t,i,r]=n[e],o={propName:t,templateName:e,isSignal:(i&Yd.SignalBased)!==0};return r&&(o.transform=r),o})}function xI(n){return Object.keys(n).map(e=>({propName:n[e],templateName:e}))}function bI(n,e,t){let i=e instanceof At?e:e?.injector;return i&&n.getStandaloneInjector!==null&&(i=n.getStandaloneInjector(i)||i),i?new Ff(t,i):t}function EI(n){let e=n.get(Xr,null);if(e===null)throw new z(407,!1);let t=n.get(GC,null),i=n.get(In,null);return{rendererFactory:e,sanitizer:t,changeDetectionScheduler:i,ngReflect:!1}}function SI(n,e){let t=KC(n);return aC(e,t,t==="svg"?V0:t==="math"?C1:null)}function KC(n){return(n.selectors[0][0]||"div").toLowerCase()}var ra=class extends tc{componentDef;ngModule;selector;componentType;ngContentSelectors;isBoundToModule;cachedInputs=null;cachedOutputs=null;get inputs(){return this.cachedInputs??=CI(this.componentDef.inputs),this.cachedInputs}get outputs(){return this.cachedOutputs??=xI(this.componentDef.outputs),this.cachedOutputs}constructor(e,t){super(),this.componentDef=e,this.ngModule=t,this.componentType=e.type,this.selector=jw(e.selectors),this.ngContentSelectors=e.ngContentSelectors??[],this.isBoundToModule=!!t}create(e,t,i,r,o,a){Je(22);let u=he(null);try{let c=this.componentDef,p=DI(i,c,a,o),g=bI(c,r||this.ngModule,e),y=EI(g),v=y.rendererFactory.createRenderer(null,c),C=i?bT(v,i,c.encapsulation,g):SI(c,v),T=a?.some(hv)||o?.some(P=>typeof P!="function"&&P.bindings.some(hv)),R=ug(null,p,null,512|pC(c),null,null,y,v,g,null,Kv(C,g,!0));R[pt]=C,ld(R);let F=null;try{let P=Dg(pt,R,2,"#host",()=>p.directiveRegistry,!0,0);uC(v,C,P),ia(C,R),Zd(p,R,P),ng(p,P,R),wg(p,P),t!==void 0&&TI(P,this.ngContentSelectors,t),F=Fn(P.index,R),R[St]=F[St],bg(p,R,null)}catch(P){throw F!==null&&Cf(F),Cf(R),P}finally{Je(23),ud()}return new Pd(this.componentType,R,!!T)}finally{he(u)}}};function DI(n,e,t,i){let r=n?["ng-version","20.3.16"]:zw(e.selectors[0]),o=null,a=null,u=0;if(t)for(let g of t)u+=g[Pf].requiredVars,g.create&&(g.targetIdx=0,(o??=[]).push(g)),g.update&&(g.targetIdx=0,(a??=[]).push(g));if(i)for(let g=0;g<i.length;g++){let y=i[g];if(typeof y!="function")for(let v of y.bindings){u+=v[Pf].requiredVars;let C=g+1;v.create&&(v.targetIdx=C,(o??=[]).push(v)),v.update&&(v.targetIdx=C,(a??=[]).push(v))}}let c=[e];if(i)for(let g of i){let y=typeof g=="function"?g:g.type,v=I0(y);c.push(v)}return lg(0,null,wI(o,a),1,u,c,null,null,null,[r],null)}function wI(n,e){return!n&&!e?null:t=>{if(t&1&&n)for(let i of n)i.create();if(t&2&&e)for(let i of e)i.update()}}function hv(n){let e=n[Pf].kind;return e==="input"||e==="twoWay"}var Pd=class extends HC{_rootLView;_hasInputBindings;instance;hostView;changeDetectorRef;componentType;location;previousInputValues=null;_tNode;constructor(e,t,i){super(),this._rootLView=t,this._hasInputBindings=i,this._tNode=Ms(t[ue],pt),this.location=aa(this._tNode,t),this.instance=Fn(this._tNode.index,t)[St],this.hostView=this.changeDetectorRef=new _r(t,void 0),this.componentType=e}setInput(e,t){this._hasInputBindings;let i=this._tNode;if(this.previousInputValues??=new Map,this.previousInputValues.has(e)&&Object.is(this.previousInputValues.get(e),t))return;let r=this._rootLView,o=xg(i,r[ue],r,e,t);this.previousInputValues.set(e,t);let a=Fn(i.index,r);Eg(a,1)}get injector(){return new Kr(this._tNode,this._rootLView)}destroy(){this.hostView.destroy()}onDestroy(e){this.hostView.onDestroy(e)}};function TI(n,e,t){let i=n.projection=[];for(let r=0;r<e.length;r++){let o=t[r];i.push(o!=null&&o.length?Array.from(o):null)}}var ji=(()=>{class n{static __NG_ELEMENT_ID__=II}return n})();function II(){let n=Rt();return ZC(n,pe())}var MI=ji,QC=class extends MI{_lContainer;_hostTNode;_hostLView;constructor(e,t,i){super(),this._lContainer=e,this._hostTNode=t,this._hostLView=i}get element(){return aa(this._hostTNode,this._hostLView)}get injector(){return new Kr(this._hostTNode,this._hostLView)}get parentInjector(){let e=Qf(this._hostTNode,this._hostLView);if(Nv(e)){let t=Sd(e,this._hostLView),i=Ed(e),r=t[ue].data[i+8];return new Kr(r,t)}else return new Kr(null,this._hostLView)}clear(){for(;this.length>0;)this.remove(this.length-1)}get(e){let t=yv(this._lContainer);return t!==null&&t[e]||null}get length(){return this._lContainer.length-Ct}createEmbeddedView(e,t,i){let r,o;typeof i=="number"?r=i:i!=null&&(r=i.index,o=i.injector);let a=Rf(this._lContainer,e.ssrId),u=e.createEmbeddedViewImpl(t||{},o,a);return this.insertImpl(u,r,Us(this._hostTNode,a)),u}createComponent(e,t,i,r,o,a,u){let c=e&&!RD(e),p;if(c)p=t;else{let F=t||{};p=F.index,i=F.injector,r=F.projectableNodes,o=F.environmentInjector||F.ngModuleRef,a=F.directives,u=F.bindings}let g=c?e:new ra(cr(e)),y=i||this.parentInjector;if(!o&&g.ngModule==null){let P=(c?y:this.parentInjector).get(At,null);P&&(o=P)}let v=cr(g.componentType??{}),C=Rf(this._lContainer,v?.id??null),T=C?.firstChild??null,R=g.create(y,r,T,o,a,u);return this.insertImpl(R.hostView,p,Us(this._hostTNode,C)),R}insert(e,t){return this.insertImpl(e,t,!0)}insertImpl(e,t,i){let r=e._lView;if(b1(r)){let u=this.indexOf(e);if(u!==-1)this.detach(u);else{let c=r[Pt],p=new QC(c,c[Rn],c[Pt]);p.detach(p.indexOf(e))}}let o=this._adjustIndex(t),a=this._lContainer;return ec(a,r,o,i),e.attachToViewContainerRef(),S0(uf(a),o,e),e}move(e,t){return this.insert(e,t)}indexOf(e){let t=yv(this._lContainer);return t!==null?t.indexOf(e):-1}remove(e){let t=this._adjustIndex(e,-1),i=Hs(this._lContainer,t);i&&(Ss(uf(this._lContainer),t),Kd(i[ue],i))}detach(e){let t=this._adjustIndex(e,-1),i=Hs(this._lContainer,t);return i&&Ss(uf(this._lContainer),t)!=null?new _r(i):null}_adjustIndex(e,t=0){return e??this.length+t}};function yv(n){return n[Is]}function uf(n){return n[Is]||(n[Is]=[])}function ZC(n,e){let t,i=e[n.index];return ti(i)?t=i:(t=LC(i,e,null,n),e[n.index]=t,dg(e,t)),RI(t,e,n,i),new QC(t,n,e)}function AI(n,e){let t=n[Xe],i=t.createComment(""),r=ni(e,n),o=t.parentNode(r);return Md(t,o,i,t.nextSibling(r),!1),i}var RI=PI,NI=()=>!1;function FI(n,e,t){return NI(n,e,t)}function PI(n,e,t,i){if(n[pr])return;let r;t.type&8?r=Nn(i):r=AI(e,t),n[pr]=r}var kf=class n{queryList;matches=null;constructor(e){this.queryList=e}clone(){return new n(this.queryList)}setDirty(){this.queryList.setDirty()}},Vf=class n{queries;constructor(e=[]){this.queries=e}createEmbeddedView(e){let t=e.queries;if(t!==null){let i=e.contentQueries!==null?e.contentQueries[0]:t.length,r=[];for(let o=0;o<i;o++){let a=t.getByIndex(o),u=this.queries[a.indexInDeclarationView];r.push(u.clone())}return new n(r)}return null}insertView(e){this.dirtyQueriesWithMatches(e)}detachView(e){this.dirtyQueriesWithMatches(e)}finishViewCreation(e){this.dirtyQueriesWithMatches(e)}dirtyQueriesWithMatches(e){for(let t=0;t<this.queries.length;t++)Mg(e,t).matches!==null&&this.queries[t].setDirty()}},kd=class{flags;read;predicate;constructor(e,t,i=null){this.flags=t,this.read=i,typeof e=="string"?this.predicate=HI(e):this.predicate=e}},Lf=class n{queries;constructor(e=[]){this.queries=e}elementStart(e,t){for(let i=0;i<this.queries.length;i++)this.queries[i].elementStart(e,t)}elementEnd(e){for(let t=0;t<this.queries.length;t++)this.queries[t].elementEnd(e)}embeddedTView(e){let t=null;for(let i=0;i<this.length;i++){let r=t!==null?t.length:0,o=this.getByIndex(i).embeddedTView(e,r);o&&(o.indexInDeclarationView=i,t!==null?t.push(o):t=[o])}return t!==null?new n(t):null}template(e,t){for(let i=0;i<this.queries.length;i++)this.queries[i].template(e,t)}getByIndex(e){return this.queries[e]}get length(){return this.queries.length}track(e){this.queries.push(e)}},Of=class n{metadata;matches=null;indexInDeclarationView=-1;crossesNgTemplate=!1;_declarationNodeIndex;_appliesToNextNode=!0;constructor(e,t=-1){this.metadata=e,this._declarationNodeIndex=t}elementStart(e,t){this.isApplyingToNode(t)&&this.matchTNode(e,t)}elementEnd(e){this._declarationNodeIndex===e.index&&(this._appliesToNextNode=!1)}template(e,t){this.elementStart(e,t)}embeddedTView(e,t){return this.isApplyingToNode(e)?(this.crossesNgTemplate=!0,this.addMatch(-e.index,t),new n(this.metadata)):null}isApplyingToNode(e){if(this._appliesToNextNode&&(this.metadata.flags&1)!==1){let t=this._declarationNodeIndex,i=e.parent;for(;i!==null&&i.type&8&&i.index!==t;)i=i.parent;return t===(i!==null?i.index:-1)}return this._appliesToNextNode}matchTNode(e,t){let i=this.metadata.predicate;if(Array.isArray(i))for(let r=0;r<i.length;r++){let o=i[r];this.matchTNodeWithReadOption(e,t,kI(t,o)),this.matchTNodeWithReadOption(e,t,vd(t,e,o,!1,!1))}else i===vr?t.type&4&&this.matchTNodeWithReadOption(e,t,-1):this.matchTNodeWithReadOption(e,t,vd(t,e,i,!1,!1))}matchTNodeWithReadOption(e,t,i){if(i!==null){let r=this.metadata.read;if(r!==null)if(r===an||r===ji||r===vr&&t.type&4)this.addMatch(t.index,-2);else{let o=vd(t,e,r,!1,!1);o!==null&&this.addMatch(t.index,o)}else this.addMatch(t.index,i)}}addMatch(e,t){this.matches===null?this.matches=[e,t]:this.matches.push(e,t)}};function kI(n,e){let t=n.localNames;if(t!==null){for(let i=0;i<t.length;i+=2)if(t[i]===e)return t[i+1]}return null}function VI(n,e){return n.type&11?aa(n,e):n.type&4?Sg(n,e):null}function LI(n,e,t,i){return t===-1?VI(e,n):t===-2?OI(n,e,i):Os(n,n[ue],t,e)}function OI(n,e,t){if(t===an)return aa(e,n);if(t===vr)return Sg(e,n);if(t===ji)return ZC(e,n)}function XC(n,e,t,i){let r=e[xi].queries[i];if(r.matches===null){let o=n.data,a=t.matches,u=[];for(let c=0;a!==null&&c<a.length;c+=2){let p=a[c];if(p<0)u.push(null);else{let g=o[p];u.push(LI(e,g,a[c+1],t.metadata.read))}}r.matches=u}return r.matches}function Bf(n,e,t,i){let r=n.queries.getByIndex(t),o=r.matches;if(o!==null){let a=XC(n,e,r,t);for(let u=0;u<o.length;u+=2){let c=o[u];if(c>0)i.push(a[u/2]);else{let p=o[u+1],g=e[-c];for(let y=Ct;y<g.length;y++){let v=g[y];v[mr]===v[Pt]&&Bf(v[ue],v,p,i)}if(g[jr]!==null){let y=g[jr];for(let v=0;v<y.length;v++){let C=y[v];Bf(C[ue],C,p,i)}}}}}return i}function BI(n,e){return n[xi].queries[e].queryList}function ex(n,e,t){let i=new Td((t&4)===4);return D1(n,e,i,i.destroy),(e[xi]??=new Vf).queries.push(new kf(i))-1}function UI(n,e,t){let i=dt();return i.firstCreatePass&&(tx(i,new kd(n,e,t),-1),(e&2)===2&&(i.staticViewQueries=!0)),ex(i,pe(),e)}function $I(n,e,t,i){let r=dt();if(r.firstCreatePass){let o=Rt();tx(r,new kd(e,t,i),o.index),GI(r,n),(t&2)===2&&(r.staticContentQueries=!0)}return ex(r,pe(),t)}function HI(n){return n.split(",").map(e=>e.trim())}function tx(n,e,t){n.queries===null&&(n.queries=new Lf),n.queries.track(new Of(e,t))}function GI(n,e){let t=n.contentQueries||(n.contentQueries=[]),i=t.length?t[t.length-1]:-1;e!==i&&t.push(n.queries.length-1,e)}function Mg(n,e){return n.queries.getByIndex(e)}function qI(n,e){let t=n[ue],i=Mg(t,e);return i.crossesNgTemplate?Bf(t,n,e,[]):XC(t,n,i,e)}var eo=class{},nc=class{};var Vd=class extends eo{ngModuleType;_parent;_bootstrapComponents=[];_r3Injector;instance;destroyCbs=[];componentFactoryResolver=new Fd(this);constructor(e,t,i,r=!0){super(),this.ngModuleType=e,this._parent=t;let o=T0(e);this._bootstrapComponents=cC(o.bootstrap),this._r3Injector=ef(e,t,[{provide:eo,useValue:this},{provide:Xs,useValue:this.componentFactoryResolver},...i],Li(e),new Set(["environment"])),r&&this.resolveInjectorInitializers()}resolveInjectorInitializers(){this._r3Injector.resolveInjectorInitializers(),this.instance=this._r3Injector.get(this.ngModuleType)}get injector(){return this._r3Injector}destroy(){let e=this._r3Injector;!e.destroyed&&e.destroy(),this.destroyCbs.forEach(t=>t()),this.destroyCbs=null}onDestroy(e){this.destroyCbs.push(e)}},Ld=class extends nc{moduleType;constructor(e){super(),this.moduleType=e}create(e){return new Vd(this.moduleType,e,[])}};var qs=class extends eo{injector;componentFactoryResolver=new Fd(this);instance=null;constructor(e){super();let t=new Br([...e.providers,{provide:eo,useValue:this},{provide:Xs,useValue:this.componentFactoryResolver}],e.parent||ws(),e.debugName,new Set(["environment"]));this.injector=t,e.runEnvironmentInitializers&&t.resolveInjectorInitializers()}destroy(){this.injector.destroy()}onDestroy(e){this.injector.onDestroy(e)}};function el(n,e,t=null){return new qs({providers:n,parent:e,debugName:t,runEnvironmentInitializers:!0}).injector}var WI=(()=>{class n{_injector;cachedInjectors=new Map;constructor(t){this._injector=t}getOrCreateStandaloneInjector(t){if(!t.standalone)return null;if(!this.cachedInjectors.has(t)){let i=M0(!1,t.type),r=i.length>0?el([i],this._injector,`Standalone[${t.type.name}]`):null;this.cachedInjectors.set(t,r)}return this.cachedInjectors.get(t)}ngOnDestroy(){try{for(let t of this.cachedInjectors.values())t!==null&&t.destroy()}finally{this.cachedInjectors.clear()}}static \u0275prov=X({token:n,providedIn:"environment",factory:()=>new n(ae(At))})}return n})();function re(n){return js(()=>{let e=nx(n),t=G(O({},e),{decls:n.decls,vars:n.vars,template:n.template,consts:n.consts||null,ngContentSelectors:n.ngContentSelectors,onPush:n.changeDetection===Zf.OnPush,directiveDefs:null,pipeDefs:null,dependencies:e.standalone&&n.dependencies||null,getStandaloneInjector:e.standalone?r=>r.get(WI).getOrCreateStandaloneInjector(t):null,getExternalStyles:null,signals:n.signals??!1,data:n.data||{},encapsulation:n.encapsulation||$i.Emulated,styles:n.styles||on,_:null,schemas:n.schemas||null,tView:null,id:""});e.standalone&&qi("NgStandalone"),ix(t);let i=n.dependencies;return t.directiveDefs=_v(i,jI),t.pipeDefs=_v(i,p1),t.id=JI(t),t})}function jI(n){return cr(n)||I0(n)}function si(n){return js(()=>({type:n.type,bootstrap:n.bootstrap||on,declarations:n.declarations||on,imports:n.imports||on,exports:n.exports||on,transitiveCompileScopes:null,schemas:n.schemas||null,id:n.id||null}))}function zI(n,e){if(n==null)return ur;let t={};for(let i in n)if(n.hasOwnProperty(i)){let r=n[i],o,a,u,c;Array.isArray(r)?(u=r[0],o=r[1],a=r[2]??o,c=r[3]||null):(o=r,a=r,u=Yd.None,c=null),t[o]=[i,u,c],e[o]=a}return t}function YI(n){if(n==null)return ur;let e={};for(let t in n)n.hasOwnProperty(t)&&(e[n[t]]=t);return e}function Ne(n){return js(()=>{let e=nx(n);return ix(e),e})}function tl(n){return{type:n.type,name:n.name,factory:null,pure:n.pure!==!1,standalone:n.standalone??!0,onDestroy:n.type.prototype.ngOnDestroy||null}}function nx(n){let e={};return{type:n.type,providersResolver:null,factory:null,hostBindings:n.hostBindings||null,hostVars:n.hostVars||0,hostAttrs:n.hostAttrs||null,contentQueries:n.contentQueries||null,declaredInputs:e,inputConfig:n.inputs||ur,exportAs:n.exportAs||null,standalone:n.standalone??!0,signals:n.signals===!0,selectors:n.selectors||on,viewQuery:n.viewQuery||null,features:n.features||null,setInput:null,resolveHostDirectives:null,hostDirectives:null,inputs:zI(n.inputs,e),outputs:YI(n.outputs),debugInfo:null}}function ix(n){n.features?.forEach(e=>e(n))}function _v(n,e){return n?()=>{let t=typeof n=="function"?n():n,i=[];for(let r of t){let o=e(r);o!==null&&i.push(o)}return i}:null}function JI(n){let e=0,t=typeof n.consts=="function"?"":n.consts,i=[n.selectors,n.ngContentSelectors,n.hostVars,n.hostAttrs,t,n.vars,n.decls,n.encapsulation,n.standalone,n.signals,n.exportAs,JSON.stringify(n.inputs),JSON.stringify(n.outputs),Object.getOwnPropertyNames(n.type.prototype),!!n.contentQueries,!!n.viewQuery];for(let o of i.join("|"))e=Math.imul(31,e)+o.charCodeAt(0)<<0;return e+=2147483648,"c"+e}function KI(n){return Object.getPrototypeOf(n.prototype).constructor}function ft(n){let e=KI(n.type),t=!0,i=[n];for(;e;){let r;if(Ei(n))r=e.\u0275cmp||e.\u0275dir;else{if(e.\u0275cmp)throw new z(903,!1);r=e.\u0275dir}if(r){if(t){i.push(r);let a=n;a.inputs=df(n.inputs),a.declaredInputs=df(n.declaredInputs),a.outputs=df(n.outputs);let u=r.hostBindings;u&&tM(n,u);let c=r.viewQuery,p=r.contentQueries;if(c&&XI(n,c),p&&eM(n,p),QI(n,r),o1(n.outputs,r.outputs),Ei(r)&&r.data.animation){let g=n.data;g.animation=(g.animation||[]).concat(r.data.animation)}}let o=r.features;if(o)for(let a=0;a<o.length;a++){let u=o[a];u&&u.ngInherit&&u(n),u===ft&&(t=!1)}}e=Object.getPrototypeOf(e)}ZI(i)}function QI(n,e){for(let t in e.inputs){if(!e.inputs.hasOwnProperty(t)||n.inputs.hasOwnProperty(t))continue;let i=e.inputs[t];i!==void 0&&(n.inputs[t]=i,n.declaredInputs[t]=e.declaredInputs[t])}}function ZI(n){let e=0,t=null;for(let i=n.length-1;i>=0;i--){let r=n[i];r.hostVars=e+=r.hostVars,r.hostAttrs=na(r.hostAttrs,t=na(t,r.hostAttrs))}}function df(n){return n===ur?{}:n===on?[]:n}function XI(n,e){let t=n.viewQuery;t?n.viewQuery=(i,r)=>{e(i,r),t(i,r)}:n.viewQuery=e}function eM(n,e){let t=n.contentQueries;t?n.contentQueries=(i,r,o)=>{e(i,r,o),t(i,r,o)}:n.contentQueries=e}function tM(n,e){let t=n.hostBindings;t?n.hostBindings=(i,r)=>{e(i,r),t(i,r)}:n.hostBindings=e}function rx(n,e,t,i,r,o,a,u){if(t.firstCreatePass){n.mergedAttrs=na(n.mergedAttrs,n.attrs);let g=n.tView=lg(2,n,r,o,a,t.directiveRegistry,t.pipeRegistry,null,t.schemas,t.consts,null);t.queries!==null&&(t.queries.template(t,n),g.queries=t.queries.embeddedTView(n))}u&&(n.flags|=u),Ko(n,!1);let c=iM(t,e,n,i);dd()&&hg(t,e,c,n),ia(c,e);let p=LC(c,e,c,n);e[i+pt]=p,dg(e,p),FI(p,n,e)}function nM(n,e,t,i,r,o,a,u,c,p,g){let y=t+pt,v;return e.firstCreatePass?(v=Zs(e,y,4,a||null,u||null),rd()&&qC(e,n,v,Pn(e.consts,p),_g),Mv(e,v)):v=e.data[y],rx(v,n,e,t,i,r,o,c),Yo(v)&&Zd(e,n,v),p!=null&&Qs(n,v,g),v}function Od(n,e,t,i,r,o,a,u,c,p,g){let y=t+pt,v;if(e.firstCreatePass){if(v=Zs(e,y,4,a||null,u||null),p!=null){let C=Pn(e.consts,p);v.localNames=[];for(let T=0;T<C.length;T+=2)v.localNames.push(C[T],-1)}}else v=e.data[y];return rx(v,n,e,t,i,r,o,c),p!=null&&Qs(n,v,g),v}function xt(n,e,t,i,r,o,a,u){let c=pe(),p=dt(),g=Pn(p.consts,o);return nM(c,p,n,e,t,i,r,g,void 0,a,u),xt}var iM=rM;function rM(n,e,t,i){return Fs(!0),e[Xe].createComment("")}var Ag=(()=>{class n{log(t){console.log(t)}warn(t){console.warn(t)}static \u0275fac=function(i){return new(i||n)};static \u0275prov=X({token:n,factory:n.\u0275fac,providedIn:"platform"})}return n})();var Rg=new ne("");function Cr(n){return!!n&&typeof n.then=="function"}function Ng(n){return!!n&&typeof n.subscribe=="function"}var ox=new ne("");var Fg=(()=>{class n{resolve;reject;initialized=!1;done=!1;donePromise=new Promise((t,i)=>{this.resolve=t,this.reject=i});appInits=k(ox,{optional:!0})??[];injector=k(Qt);constructor(){}runInitializers(){if(this.initialized)return;let t=[];for(let r of this.appInits){let o=kt(this.injector,r);if(Cr(o))t.push(o);else if(Ng(o)){let a=new Promise((u,c)=>{o.subscribe({complete:u,error:c})});t.push(a)}}let i=()=>{this.done=!0,this.resolve()};Promise.all(t).then(()=>{i()}).catch(r=>{this.reject(r)}),t.length===0&&i(),this.initialized=!0}static \u0275fac=function(i){return new(i||n)};static \u0275prov=X({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})(),ic=new ne("");function ax(){Hp(()=>{let n="";throw new z(600,n)})}function sx(n){return n.isBoundToModule}var oM=10;var zi=(()=>{class n{_runningTick=!1;_destroyed=!1;_destroyListeners=[];_views=[];internalErrorHandler=k(_n);afterRenderManager=k(fg);zonelessEnabled=k(Ps);rootEffectScheduler=k(ks);dirtyFlags=0;tracingSnapshot=null;allTestViews=new Set;autoDetectTestViews=new Set;includeAllTestViews=!1;afterTick=new bt;get allViews(){return[...(this.includeAllTestViews?this.allTestViews:this.autoDetectTestViews).keys(),...this._views]}get destroyed(){return this._destroyed}componentTypes=[];components=[];internalPendingTask=k(Si);get isStable(){return this.internalPendingTask.hasPendingTasksObservable.pipe(ve(t=>!t))}constructor(){k(no,{optional:!0})}whenStable(){let t;return new Promise(i=>{t=this.isStable.subscribe({next:r=>{r&&i()}})}).finally(()=>{t.unsubscribe()})}_injector=k(At);_rendererFactory=null;get injector(){return this._injector}bootstrap(t,i){return this.bootstrapImpl(t,i)}bootstrapImpl(t,i,r=Qt.NULL){return this._injector.get(Dt).run(()=>{Je(10);let a=t instanceof tc;if(!this._injector.get(Fg).done){let T="";throw new z(405,T)}let c;a?c=t:c=this._injector.get(Xs).resolveComponentFactory(t),this.componentTypes.push(c.componentType);let p=sx(c)?void 0:this._injector.get(eo),g=i||c.selector,y=c.create(r,[],g,p),v=y.location.nativeElement,C=y.injector.get(Rg,null);return C?.registerApplication(v),y.onDestroy(()=>{this.detachView(y.hostView),Ls(this.components,y),C?.unregisterApplication(v)}),this._loadComponent(y),Je(11,y),y})}tick(){this.zonelessEnabled||(this.dirtyFlags|=1),this._tick()}_tick(){Je(12),this.tracingSnapshot!==null?this.tracingSnapshot.run(Jd.CHANGE_DETECTION,this.tickImpl):this.tickImpl()}tickImpl=()=>{if(this._runningTick)throw new z(101,!1);let t=he(null);try{this._runningTick=!0,this.synchronize()}finally{this._runningTick=!1,this.tracingSnapshot?.dispose(),this.tracingSnapshot=null,he(t),this.afterTick.next(),Je(13)}};synchronize(){this._rendererFactory===null&&!this._injector.destroyed&&(this._rendererFactory=this._injector.get(Xr,null,{optional:!0}));let t=0;for(;this.dirtyFlags!==0&&t++<oM;)Je(14),this.synchronizeOnce(),Je(15)}synchronizeOnce(){this.dirtyFlags&16&&(this.dirtyFlags&=-17,this.rootEffectScheduler.flush());let t=!1;if(this.dirtyFlags&7){let i=!!(this.dirtyFlags&1);this.dirtyFlags&=-8,this.dirtyFlags|=8;for(let{_lView:r}of this.allViews){if(!i&&!As(r))continue;let o=i&&!this.zonelessEnabled?0:1;FC(r,o),t=!0}if(this.dirtyFlags&=-5,this.syncDirtyFlagsWithViews(),this.dirtyFlags&23)return}t||(this._rendererFactory?.begin?.(),this._rendererFactory?.end?.()),this.dirtyFlags&8&&(this.dirtyFlags&=-9,this.afterRenderManager.execute()),this.syncDirtyFlagsWithViews()}syncDirtyFlagsWithViews(){if(this.allViews.some(({_lView:t})=>As(t))){this.dirtyFlags|=2;return}else this.dirtyFlags&=-8}attachView(t){let i=t;this._views.push(i),i.attachToAppRef(this)}detachView(t){let i=t;Ls(this._views,i),i.detachFromAppRef()}_loadComponent(t){this.attachView(t.hostView);try{this.tick()}catch(r){this.internalErrorHandler(r)}this.components.push(t),this._injector.get(ic,[]).forEach(r=>r(t))}ngOnDestroy(){if(!this._destroyed)try{this._destroyListeners.forEach(t=>t()),this._views.slice().forEach(t=>t.destroy())}finally{this._destroyed=!0,this._views=[],this._destroyListeners=[]}}onDestroy(t){return this._destroyListeners.push(t),()=>Ls(this._destroyListeners,t)}destroy(){if(this._destroyed)throw new z(406,!1);let t=this._injector;t.destroy&&!t.destroyed&&t.destroy()}get viewCount(){return this._views.length}static \u0275fac=function(i){return new(i||n)};static \u0275prov=X({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})();function Ls(n,e){let t=n.indexOf(e);t>-1&&n.splice(t,1)}function gt(n,e,t,i){let r=pe(),o=hr();if(Vn(r,o,e)){let a=dt(),u=Ns();AT(u,r,n,e,t,i)}return gt}var ZZ=typeof document<"u"&&typeof document?.documentElement?.getAnimations=="function";var Uf=class{destroy(e){}updateValue(e,t){}swap(e,t){let i=Math.min(e,t),r=Math.max(e,t),o=this.detach(r);if(r-i>1){let a=this.detach(i);this.attach(i,o),this.attach(r,a)}else this.attach(i,o)}move(e,t){this.attach(t,this.detach(e))}};function cf(n,e,t,i,r){return n===t&&Object.is(e,i)?1:Object.is(r(n,e),r(t,i))?-1:0}function aM(n,e,t){let i,r,o=0,a=n.length-1,u=void 0;if(Array.isArray(e)){let c=e.length-1;for(;o<=a&&o<=c;){let p=n.at(o),g=e[o],y=cf(o,p,o,g,t);if(y!==0){y<0&&n.updateValue(o,g),o++;continue}let v=n.at(a),C=e[c],T=cf(a,v,c,C,t);if(T!==0){T<0&&n.updateValue(a,C),a--,c--;continue}let R=t(o,p),F=t(a,v),P=t(o,g);if(Object.is(P,F)){let H=t(c,C);Object.is(H,R)?(n.swap(o,a),n.updateValue(a,C),c--,a--):n.move(a,o),n.updateValue(o,g),o++;continue}if(i??=new Bd,r??=Cv(n,o,a,t),$f(n,i,o,P))n.updateValue(o,g),o++,a++;else if(r.has(P))i.set(R,n.detach(o)),a--;else{let H=n.create(o,e[o]);n.attach(o,H),o++,a++}}for(;o<=c;)vv(n,i,t,o,e[o]),o++}else if(e!=null){let c=e[Symbol.iterator](),p=c.next();for(;!p.done&&o<=a;){let g=n.at(o),y=p.value,v=cf(o,g,o,y,t);if(v!==0)v<0&&n.updateValue(o,y),o++,p=c.next();else{i??=new Bd,r??=Cv(n,o,a,t);let C=t(o,y);if($f(n,i,o,C))n.updateValue(o,y),o++,a++,p=c.next();else if(!r.has(C))n.attach(o,n.create(o,y)),o++,a++,p=c.next();else{let T=t(o,g);i.set(T,n.detach(o)),a--}}}for(;!p.done;)vv(n,i,t,n.length,p.value),p=c.next()}for(;o<=a;)n.destroy(n.detach(a--));i?.forEach(c=>{n.destroy(c)})}function $f(n,e,t,i){return e!==void 0&&e.has(i)?(n.attach(t,e.get(i)),e.delete(i),!0):!1}function vv(n,e,t,i,r){if($f(n,e,i,t(i,r)))n.updateValue(i,r);else{let o=n.create(i,r);n.attach(i,o)}}function Cv(n,e,t,i){let r=new Set;for(let o=e;o<=t;o++)r.add(i(o,n.at(o)));return r}var Bd=class{kvMap=new Map;_vMap=void 0;has(e){return this.kvMap.has(e)}delete(e){if(!this.has(e))return!1;let t=this.kvMap.get(e);return this._vMap!==void 0&&this._vMap.has(t)?(this.kvMap.set(e,this._vMap.get(t)),this._vMap.delete(t)):this.kvMap.delete(e),!0}get(e){return this.kvMap.get(e)}set(e,t){if(this.kvMap.has(e)){let i=this.kvMap.get(e);this._vMap===void 0&&(this._vMap=new Map);let r=this._vMap;for(;r.has(i);)i=r.get(i);r.set(i,t)}else this.kvMap.set(e,t)}forEach(e){for(let[t,i]of this.kvMap)if(e(i,t),this._vMap!==void 0){let r=this._vMap;for(;r.has(i);)i=r.get(i),e(i,t)}}};function M(n,e,t,i,r,o,a,u){qi("NgControlFlow");let c=pe(),p=dt(),g=Pn(p.consts,o);return Od(c,p,n,e,t,i,r,g,256,a,u),Pg}function Pg(n,e,t,i,r,o,a,u){qi("NgControlFlow");let c=pe(),p=dt(),g=Pn(p.consts,o);return Od(c,p,n,e,t,i,r,g,512,a,u),Pg}function A(n,e){qi("NgControlFlow");let t=pe(),i=hr(),r=t[i]!==Wt?t[i]:-1,o=r!==-1?Ud(t,pt+r):void 0,a=0;if(Vn(t,i,n)){let u=he(null);try{if(o!==void 0&&BC(o,a),n!==-1){let c=pt+n,p=Ud(t,c),g=Wf(t[ue],c),y=$C(p,g,t),v=Xd(t,g,e,{dehydratedView:y});ec(p,v,a,Us(g,y))}}finally{he(u)}}else if(o!==void 0){let u=OC(o,a);u!==void 0&&(u[St]=e)}}var Hf=class{lContainer;$implicit;$index;constructor(e,t,i){this.lContainer=e,this.$implicit=t,this.$index=i}get $count(){return this.lContainer.length-Ct}};function sn(n){return n}function Y(n,e){return e}var Gf=class{hasEmptyBlock;trackByFn;liveCollection;constructor(e,t,i){this.hasEmptyBlock=e,this.trackByFn=t,this.liveCollection=i}};function V(n,e,t,i,r,o,a,u,c,p,g,y,v){qi("NgControlFlow");let C=pe(),T=dt(),R=c!==void 0,F=pe(),P=u?a.bind(F[En][St]):a,H=new Gf(R,P);F[pt+n]=H,Od(C,T,n+1,e,t,i,r,Pn(T.consts,o),256),R&&Od(C,T,n+2,c,p,g,y,Pn(T.consts,v),512)}var qf=class extends Uf{lContainer;hostLView;templateTNode;operationsCounter=void 0;needsIndexUpdate=!1;constructor(e,t,i){super(),this.lContainer=e,this.hostLView=t,this.templateTNode=i}get length(){return this.lContainer.length-Ct}at(e){return this.getLView(e)[St].$implicit}attach(e,t){let i=t[Wo];this.needsIndexUpdate||=e!==this.length,ec(this.lContainer,t,e,Us(this.templateTNode,i)),sM(this.lContainer,e)}detach(e){return this.needsIndexUpdate||=e!==this.length-1,lM(this.lContainer,e),uM(this.lContainer,e)}create(e,t){let i=Rf(this.lContainer,this.templateTNode.tView.ssrId),r=Xd(this.hostLView,this.templateTNode,new Hf(this.lContainer,t,e),{dehydratedView:i});return this.operationsCounter?.recordCreate(),r}destroy(e){Kd(e[ue],e),this.operationsCounter?.recordDestroy()}updateValue(e,t){this.getLView(e)[St].$implicit=t}reset(){this.needsIndexUpdate=!1,this.operationsCounter?.reset()}updateIndexes(){if(this.needsIndexUpdate)for(let e=0;e<this.length;e++)this.getLView(e)[St].$index=e}getLView(e){return dM(this.lContainer,e)}};function L(n){let e=he(null),t=ii();try{let i=pe(),r=i[ue],o=i[t],a=t+1,u=Ud(i,a);if(o.liveCollection===void 0){let p=Wf(r,a);o.liveCollection=new qf(u,i,p)}else o.liveCollection.reset();let c=o.liveCollection;if(aM(c,n,o.trackByFn),c.updateIndexes(),o.hasEmptyBlock){let p=hr(),g=c.length===0;if(Vn(i,p,g)){let y=t+2,v=Ud(i,y);if(g){let C=Wf(r,y),T=$C(v,C,i),R=Xd(i,C,void 0,{dehydratedView:T});ec(v,R,0,Us(C,T))}else r.firstUpdatePass&&eI(v),BC(v,0)}}}finally{he(e)}}function Ud(n,e){return n[e]}function sM(n,e){if(n.length<=Ct)return;let t=Ct+e,i=n[t],r=i?i[Wr]:void 0;if(i&&r&&r.detachedLeaveAnimationFns&&r.detachedLeaveAnimationFns.length>0){let o=i[Oi];aT(o,r),Zr.delete(i),r.detachedLeaveAnimationFns=void 0}}function lM(n,e){if(n.length<=Ct)return;let t=Ct+e,i=n[t],r=i?i[Wr]:void 0;r&&r.leave&&r.leave.size>0&&(r.detachedLeaveAnimationFns=[])}function uM(n,e){return Hs(n,e)}function dM(n,e){return OC(n,e)}function Wf(n,e){return Ms(n,e)}function I(n,e,t){let i=pe(),r=hr();if(Vn(i,r,e)){let o=dt(),a=Ns();wC(a,i,n,e,i[Xe],t)}return I}function jf(n,e,t,i,r){xg(e,n,t,r?"class":"style",i)}function l(n,e,t,i){let r=pe(),o=r[ue],a=n+pt,u=o.firstCreatePass?Dg(a,r,2,e,_g,rd(),t,i):o.data[a];if(vg(u,r,n,e,lx),Yo(u)){let c=r[ue];Zd(c,r,u),ng(c,u,r)}return i!=null&&Qs(r,u),l}function s(){let n=dt(),e=Rt(),t=Cg(e);return n.firstCreatePass&&wg(n,t),W0(t)&&j0(),q0(),t.classesWithoutHost!=null&&LD(t)&&jf(n,t,pe(),t.classesWithoutHost,!0),t.stylesWithoutHost!=null&&OD(t)&&jf(n,t,pe(),t.stylesWithoutHost,!1),s}function x(n,e,t,i){return l(n,e,t,i),s(),x}function rt(n,e,t,i){let r=pe(),o=r[ue],a=n+pt,u=o.firstCreatePass?fI(a,o,2,e,t,i):o.data[a];return vg(u,r,n,e,lx),i!=null&&Qs(r,u),rt}function ot(){let n=Rt(),e=Cg(n);return W0(e)&&j0(),q0(),ot}function Ti(n,e,t,i){return rt(n,e,t,i),ot(),Ti}var lx=(n,e,t,i,r)=>(Fs(!0),aC(e[Xe],i,$1()));function rc(n,e,t){let i=pe(),r=i[ue],o=n+pt,a=r.firstCreatePass?Dg(o,i,8,"ng-container",_g,rd(),e,t):r.data[o];if(vg(a,i,n,"ng-container",cM),Yo(a)){let u=i[ue];Zd(u,i,a),ng(u,a,i)}return t!=null&&Qs(i,a),rc}function oc(){let n=dt(),e=Rt(),t=Cg(e);return n.firstCreatePass&&wg(n,t),oc}var cM=(n,e,t,i,r)=>(Fs(!0),Rw(e[Xe],""));function B(){return pe()}function ac(n,e,t){let i=pe(),r=hr();if(Vn(i,r,e)){let o=dt(),a=Ns();TC(a,i,n,e,i[Xe],t)}return ac}var gd=void 0;function mM(n){let e=Math.floor(Math.abs(n)),t=n.toString().replace(/^[^.]*\.?/,"").length;return e===1&&t===0?1:5}var pM=["en",[["a","p"],["AM","PM"]],[["AM","PM"]],[["S","M","T","W","T","F","S"],["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],["Su","Mo","Tu","We","Th","Fr","Sa"]],gd,[["J","F","M","A","M","J","J","A","S","O","N","D"],["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],["January","February","March","April","May","June","July","August","September","October","November","December"]],gd,[["B","A"],["BC","AD"],["Before Christ","Anno Domini"]],0,[6,0],["M/d/yy","MMM d, y","MMMM d, y","EEEE, MMMM d, y"],["h:mm a","h:mm:ss a","h:mm:ss a z","h:mm:ss a zzzz"],["{1}, {0}",gd,"{1} 'at' {0}",gd],[".",",",";","%","+","-","E","\xD7","\u2030","\u221E","NaN",":"],["#,##0.###","#,##0%","\xA4#,##0.00","#E0"],"USD","$","US Dollar",{},"ltr",mM],mf={};function ln(n){let e=fM(n),t=xv(e);if(t)return t;let i=e.split("-")[0];if(t=xv(i),t)return t;if(i==="en")return pM;throw new z(701,!1)}function xv(n){return n in mf||(mf[n]=Zn.ng&&Zn.ng.common&&Zn.ng.common.locales&&Zn.ng.common.locales[n]),mf[n]}var ht=(function(n){return n[n.LocaleId=0]="LocaleId",n[n.DayPeriodsFormat=1]="DayPeriodsFormat",n[n.DayPeriodsStandalone=2]="DayPeriodsStandalone",n[n.DaysFormat=3]="DaysFormat",n[n.DaysStandalone=4]="DaysStandalone",n[n.MonthsFormat=5]="MonthsFormat",n[n.MonthsStandalone=6]="MonthsStandalone",n[n.Eras=7]="Eras",n[n.FirstDayOfWeek=8]="FirstDayOfWeek",n[n.WeekendRange=9]="WeekendRange",n[n.DateFormat=10]="DateFormat",n[n.TimeFormat=11]="TimeFormat",n[n.DateTimeFormat=12]="DateTimeFormat",n[n.NumberSymbols=13]="NumberSymbols",n[n.NumberFormats=14]="NumberFormats",n[n.CurrencyCode=15]="CurrencyCode",n[n.CurrencySymbol=16]="CurrencySymbol",n[n.CurrencyName=17]="CurrencyName",n[n.Currencies=18]="Currencies",n[n.Directionality=19]="Directionality",n[n.PluralCase=20]="PluralCase",n[n.ExtraData=21]="ExtraData",n})(ht||{});function fM(n){return n.toLowerCase().replace(/_/g,"-")}var nl="en-US",gM="USD";var hM=nl;function ux(n){typeof n=="string"&&(hM=n.toLowerCase().replace(/_/g,"-"))}function b(n,e,t){let i=pe(),r=dt(),o=Rt();return dx(r,i,i[Xe],o,n,e,t),b}function xr(n,e,t){let i=pe(),r=dt(),o=Rt();return(o.type&3||t)&&YC(o,r,i,t,i[Xe],n,e,xd(o,i,e)),xr}function dx(n,e,t,i,r,o,a){let u=!0,c=null;if((i.type&3||a)&&(c??=xd(i,e,o),YC(i,n,e,a,t,r,o,c)&&(u=!1)),u){let p=i.outputs?.[r],g=i.hostDirectiveOutputs?.[r];if(g&&g.length)for(let y=0;y<g.length;y+=2){let v=g[y],C=g[y+1];c??=xd(i,e,o),gv(i,e,v,C,r,c)}if(p&&p.length)for(let y of p)c??=xd(i,e,o),gv(i,e,y,r,r,c)}}function _(n=1){return U1(n)}function kg(n,e,t,i){$I(n,e,t,i)}function ut(n,e,t){UI(n,e,t)}function tt(n){let e=pe(),t=dt(),i=Q0();sd(i+1);let r=Mg(t,i);if(n.dirty&&x1(e)===((r.metadata.flags&2)===2)){if(r.matches===null)n.reset([]);else{let o=qI(e,i);n.reset(o,QD),n.notifyOnChanges()}return!0}return!1}function nt(){return BI(pe(),Q0())}function oe(n){let e=R1();return td(e,pt+n)}function hd(n,e){return n<<17|e<<2}function to(n){return n>>17&32767}function yM(n){return(n&2)==2}function _M(n,e){return n&131071|e<<17}function zf(n){return n|2}function oa(n){return(n&131068)>>2}function pf(n,e){return n&-131069|e<<2}function vM(n){return(n&1)===1}function Yf(n){return n|1}function CM(n,e,t,i,r,o){let a=o?e.classBindings:e.styleBindings,u=to(a),c=oa(a);n[i]=t;let p=!1,g;if(Array.isArray(t)){let y=t;g=y[1],(g===null||qo(y,g)>0)&&(p=!0)}else g=t;if(r)if(c!==0){let v=to(n[u+1]);n[i+1]=hd(v,u),v!==0&&(n[v+1]=pf(n[v+1],i)),n[u+1]=_M(n[u+1],i)}else n[i+1]=hd(u,0),u!==0&&(n[u+1]=pf(n[u+1],i)),u=i;else n[i+1]=hd(c,0),u===0?u=i:n[c+1]=pf(n[c+1],i),c=i;p&&(n[i+1]=zf(n[i+1])),bv(n,g,i,!0),bv(n,g,i,!1),xM(e,g,n,i,o),a=hd(u,c),o?e.classBindings=a:e.styleBindings=a}function xM(n,e,t,i,r){let o=r?n.residualClasses:n.residualStyles;o!=null&&typeof e=="string"&&qo(o,e)>=0&&(t[i+1]=Yf(t[i+1]))}function bv(n,e,t,i){let r=n[t+1],o=e===null,a=i?to(r):oa(r),u=!1;for(;a!==0&&(u===!1||o);){let c=n[a],p=n[a+1];bM(c,e)&&(u=!0,n[a+1]=i?Yf(p):zf(p)),a=i?to(p):oa(p)}u&&(n[t+1]=i?zf(r):Yf(r))}function bM(n,e){return n===null||e==null||(Array.isArray(n)?n[1]:n)===e?!0:Array.isArray(n)&&typeof e=="string"?qo(n,e)>=0:!1}var oi={textEnd:0,key:0,keyEnd:0,value:0,valueEnd:0};function EM(n){return n.substring(oi.key,oi.keyEnd)}function SM(n){return DM(n),cx(n,mx(n,0,oi.textEnd))}function cx(n,e){let t=oi.textEnd;return t===e?-1:(e=oi.keyEnd=wM(n,oi.key=e,t),mx(n,e,t))}function DM(n){oi.key=0,oi.keyEnd=0,oi.value=0,oi.valueEnd=0,oi.textEnd=n.length}function mx(n,e,t){for(;e<t&&n.charCodeAt(e)<=32;)e++;return e}function wM(n,e,t){for(;e<t&&n.charCodeAt(e)>32;)e++;return e}function Xt(n,e,t){return px(n,e,t,!1),Xt}function j(n,e){return px(n,e,null,!0),j}function Te(n){IM(PM,TM,n,!0)}function TM(n,e){for(let t=SM(e);t>=0;t=cx(e,t))Zu(n,EM(e),!0)}function px(n,e,t,i){let r=pe(),o=dt(),a=Rs(2);if(o.firstUpdatePass&&gx(o,n,a,i),e!==Wt&&Vn(r,a,e)){let u=o.data[ii()];hx(o,u,r,r[Xe],n,r[a+1]=VM(e,t),i,a)}}function IM(n,e,t,i){let r=dt(),o=Rs(2);r.firstUpdatePass&&gx(r,null,o,i);let a=pe();if(t!==Wt&&Vn(a,o,t)){let u=r.data[ii()];if(yx(u,i)&&!fx(r,o)){let c=i?u.classesWithoutHost:u.stylesWithoutHost;c!==null&&(t=Yu(c,t||"")),jf(r,u,a,t,i)}else kM(r,u,a,a[Xe],a[o+1],a[o+1]=FM(n,e,t),i,o)}}function fx(n,e){return e>=n.expandoStartIndex}function gx(n,e,t,i){let r=n.data;if(r[t+1]===null){let o=r[ii()],a=fx(n,t);yx(o,i)&&e===null&&!a&&(e=!1),e=MM(r,o,e,i),CM(r,o,e,t,a,i)}}function MM(n,e,t,i){let r=V1(n),o=i?e.residualClasses:e.residualStyles;if(r===null)(i?e.classBindings:e.styleBindings)===0&&(t=ff(null,n,e,t,i),t=Ws(t,e.attrs,i),o=null);else{let a=e.directiveStylingLast;if(a===-1||n[a]!==r)if(t=ff(r,n,e,t,i),o===null){let c=AM(n,e,i);c!==void 0&&Array.isArray(c)&&(c=ff(null,n,e,c[1],i),c=Ws(c,e.attrs,i),RM(n,e,i,c))}else o=NM(n,e,i)}return o!==void 0&&(i?e.residualClasses=o:e.residualStyles=o),t}function AM(n,e,t){let i=t?e.classBindings:e.styleBindings;if(oa(i)!==0)return n[to(i)]}function RM(n,e,t,i){let r=t?e.classBindings:e.styleBindings;n[to(r)]=i}function NM(n,e,t){let i,r=e.directiveEnd;for(let o=1+e.directiveStylingLast;o<r;o++){let a=n[o].hostAttrs;i=Ws(i,a,t)}return Ws(i,e.attrs,t)}function ff(n,e,t,i,r){let o=null,a=t.directiveEnd,u=t.directiveStylingLast;for(u===-1?u=t.directiveStart:u++;u<a&&(o=e[u],i=Ws(i,o.hostAttrs,r),o!==n);)u++;return n!==null&&(t.directiveStylingLast=u),i}function Ws(n,e,t){let i=t?1:2,r=-1;if(e!==null)for(let o=0;o<e.length;o++){let a=e[o];typeof a=="number"?r=a:r===i&&(Array.isArray(n)||(n=n===void 0?[]:["",n]),Zu(n,a,t?!0:e[++o]))}return n===void 0?null:n}function FM(n,e,t){if(t==null||t==="")return on;let i=[],r=sa(t);if(Array.isArray(r))for(let o=0;o<r.length;o++)n(i,r[o],!0);else if(typeof r=="object")for(let o in r)r.hasOwnProperty(o)&&n(i,o,r[o]);else typeof r=="string"&&e(i,r);return i}function PM(n,e,t){let i=String(e);i!==""&&!i.includes(" ")&&Zu(n,i,t)}function kM(n,e,t,i,r,o,a,u){r===Wt&&(r=on);let c=0,p=0,g=0<r.length?r[0]:null,y=0<o.length?o[0]:null;for(;g!==null||y!==null;){let v=c<r.length?r[c+1]:void 0,C=p<o.length?o[p+1]:void 0,T=null,R;g===y?(c+=2,p+=2,v!==C&&(T=y,R=C)):y===null||g!==null&&g<y?(c+=2,T=g):(p+=2,T=y,R=C),T!==null&&hx(n,e,t,i,T,R,a,u),g=c<r.length?r[c]:null,y=p<o.length?o[p]:null}}function hx(n,e,t,i,r,o,a,u){if(!(e.type&3))return;let c=n.data,p=c[u+1],g=vM(p)?Ev(c,e,t,r,oa(p),a):void 0;if(!$d(g)){$d(o)||yM(p)&&(o=Ev(c,null,t,r,u,a));let y=L0(ii(),t);xT(i,a,y,r,o)}}function Ev(n,e,t,i,r,o){let a=e===null,u;for(;r>0;){let c=n[r],p=Array.isArray(c),g=p?c[1]:c,y=g===null,v=t[r+1];v===Wt&&(v=y?on:void 0);let C=y?Xu(v,i):g===i?v:void 0;if(p&&!$d(C)&&(C=Xu(c,i)),$d(C)&&(u=C,a))return u;let T=n[r+1];r=a?to(T):oa(T)}if(e!==null){let c=o?e.residualClasses:e.residualStyles;c!=null&&(u=Xu(c,i))}return u}function $d(n){return n!==void 0}function VM(n,e){return n==null||n===""||(typeof e=="string"?n=n+e:typeof n=="object"&&(n=Li(sa(n)))),n}function yx(n,e){return(n.flags&(e?8:16))!==0}function d(n,e=""){let t=pe(),i=dt(),r=n+pt,o=i.firstCreatePass?Zs(i,r,1,e,null):i.data[r],a=LM(i,t,o,e,n);t[r]=a,dd()&&hg(i,t,a,o),Ko(o,!1)}var LM=(n,e,t,i,r)=>(Fs(!0),Mw(e[Xe],i));function _x(n,e,t,i=""){return Vn(n,hr(),t)?e+Xn(t)+i:Wt}function OM(n,e,t,i,r,o=""){let a=K0(),u=Gs(n,a,t,r);return Rs(2),u?e+Xn(t)+i+Xn(r)+o:Wt}function BM(n,e,t,i,r,o,a,u=""){let c=K0(),p=hI(n,c,t,r,a);return Rs(3),p?e+Xn(t)+i+Xn(r)+o+Xn(a)+u:Wt}function w(n){return N("",n),w}function N(n,e,t){let i=pe(),r=_x(i,n,e,t);return r!==Wt&&Vg(i,ii(),r),N}function Qe(n,e,t,i,r){let o=pe(),a=OM(o,n,e,t,i,r);return a!==Wt&&Vg(o,ii(),a),Qe}function Lt(n,e,t,i,r,o,a){let u=pe(),c=BM(u,n,e,t,i,r,o,a);return c!==Wt&&Vg(u,ii(),c),Lt}function Vg(n,e,t){let i=L0(e,n);Aw(n[Xe],i,t)}function J(n,e,t){rf(e)&&(e=e());let i=pe(),r=hr();if(Vn(i,r,e)){let o=dt(),a=Ns();wC(a,i,n,e,i[Xe],t)}return J}function Q(n,e){let t=rf(n);return t&&n.set(e),t}function K(n,e){let t=pe(),i=dt(),r=Rt();return dx(i,t,t[Xe],r,n,e),K}function On(n,e,t=""){return _x(pe(),n,e,t)}function UM(n,e,t){let i=dt();if(i.firstCreatePass){let r=Ei(n);Jf(t,i.data,i.blueprint,r,!0),Jf(e,i.data,i.blueprint,r,!1)}}function Jf(n,e,t,i,r){if(n=Gt(n),Array.isArray(n))for(let o=0;o<n.length;o++)Jf(n[o],e,t,i,r);else{let o=dt(),a=pe(),u=Rt(),c=Or(n)?n:Gt(n.provide),p=R0(n),g=u.providerIndexes&1048575,y=u.directiveStart,v=u.providerIndexes>>20;if(Or(n)||!n.multi){let C=new Qr(p,r,ee,null),T=hf(c,e,r?g:g+v,y);T===-1?(_f(wd(u,a),o,c),gf(o,n,e.length),e.push(c),u.directiveStart++,u.directiveEnd++,r&&(u.providerIndexes+=1048576),t.push(C),a.push(C)):(t[T]=C,a[T]=C)}else{let C=hf(c,e,g+v,y),T=hf(c,e,g,g+v),R=C>=0&&t[C],F=T>=0&&t[T];if(r&&!F||!r&&!R){_f(wd(u,a),o,c);let P=GM(r?HM:$M,t.length,r,i,p,n);!r&&F&&(t[T].providerFactory=P),gf(o,n,e.length,0),e.push(c),u.directiveStart++,u.directiveEnd++,r&&(u.providerIndexes+=1048576),t.push(P),a.push(P)}else{let P=vx(t[r?T:C],p,!r&&i);gf(o,n,C>-1?C:T,P)}!r&&i&&F&&t[T].componentProviders++}}}function gf(n,e,t,i){let r=Or(e),o=y1(e);if(r||o){let c=(o?Gt(e.useClass):e).prototype.ngOnDestroy;if(c){let p=n.destroyHooks||(n.destroyHooks=[]);if(!r&&e.multi){let g=p.indexOf(t);g===-1?p.push(t,[i,c]):p[g+1].push(i,c)}else p.push(t,c)}}}function vx(n,e,t){return t&&n.componentProviders++,n.multi.push(e)-1}function hf(n,e,t,i){for(let r=t;r<i;r++)if(e[r]===n)return r;return-1}function $M(n,e,t,i,r){return Kf(this.multi,[])}function HM(n,e,t,i,r){let o=this.multi,a;if(this.providerFactory){let u=this.providerFactory.componentProviders,c=Os(i,i[ue],this.providerFactory.index,r);a=c.slice(0,u),Kf(o,a);for(let p=u;p<c.length;p++)a.push(c[p])}else a=[],Kf(o,a);return a}function Kf(n,e){for(let t=0;t<n.length;t++){let i=n[t];e.push(i())}return e}function GM(n,e,t,i,r,o){let a=new Qr(n,t,ee,null);return a.multi=[],a.index=e,a.componentProviders=0,vx(a,r,i&&!t),a}function Ut(n,e=[]){return t=>{t.providersResolver=(i,r)=>UM(i,r?r(n):n,e)}}function Ke(n,e,t){let i=od()+n,r=pe();return r[i]===Wt?Ig(r,i,t?e.call(t):e()):gI(r,i)}function Cx(n,e){let t=n[e];return t===Wt?void 0:t}function qM(n,e,t,i,r,o,a){let u=e+t;return Gs(n,u,r,o)?Ig(n,u+2,a?i.call(a,r,o):i(r,o)):Cx(n,u+2)}function WM(n,e,t,i,r,o,a,u,c){let p=e+t;return yI(n,p,r,o,a,u)?Ig(n,p+4,c?i.call(c,r,o,a,u):i(r,o,a,u)):Cx(n,p+4)}function jt(n,e){let t=dt(),i,r=n+pt;t.firstCreatePass?(i=jM(e,t.pipeRegistry),t.data[r]=i,i.onDestroy&&(t.destroyHooks??=[]).push(r,i.onDestroy)):i=t.data[r];let o=i.factory||(i.factory=ar(i.type,!0)),a,u=rn(ee);try{let c=Dd(!1),p=o();return Dd(c),O0(t,pe(),r,p),p}finally{rn(u)}}function jM(n,e){if(e)for(let t=e.length-1;t>=0;t--){let i=e[t];if(n===i.name)return i}}function un(n,e,t,i){let r=n+pt,o=pe(),a=td(o,r);return xx(o,r)?qM(o,od(),e,a.transform,t,i,a):a.transform(t,i)}function sc(n,e,t,i,r,o){let a=n+pt,u=pe(),c=td(u,a);return xx(u,a)?WM(u,od(),e,c.transform,t,i,r,o,c):c.transform(t,i,r,o)}function xx(n,e){return n[ue].data[e].pure}var Hd=class{ngModuleFactory;componentFactories;constructor(e,t){this.ngModuleFactory=e,this.componentFactories=t}},Lg=(()=>{class n{compileModuleSync(t){return new Ld(t)}compileModuleAsync(t){return Promise.resolve(this.compileModuleSync(t))}compileModuleAndAllComponentsSync(t){let i=this.compileModuleSync(t),r=T0(t),o=cC(r.declarations).reduce((a,u)=>{let c=cr(u);return c&&a.push(new ra(c)),a},[]);return new Hd(i,o)}compileModuleAndAllComponentsAsync(t){return Promise.resolve(this.compileModuleAndAllComponentsSync(t))}clearCache(){}clearCacheFor(t){}getModuleId(t){}static \u0275fac=function(i){return new(i||n)};static \u0275prov=X({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})();var zM=(()=>{class n{zone=k(Dt);changeDetectionScheduler=k(In);applicationRef=k(zi);applicationErrorHandler=k(_n);_onMicrotaskEmptySubscription;initialize(){this._onMicrotaskEmptySubscription||(this._onMicrotaskEmptySubscription=this.zone.onMicrotaskEmpty.subscribe({next:()=>{this.changeDetectionScheduler.runningTick||this.zone.run(()=>{try{this.applicationRef.dirtyFlags|=1,this.applicationRef._tick()}catch(t){this.applicationErrorHandler(t)}})}}))}ngOnDestroy(){this._onMicrotaskEmptySubscription?.unsubscribe()}static \u0275fac=function(i){return new(i||n)};static \u0275prov=X({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})();function bx({ngZoneFactory:n,ignoreChangesOutsideZone:e,scheduleInRootZone:t}){return n??=()=>new Dt(G(O({},Ex()),{scheduleInRootZone:t})),[{provide:Dt,useFactory:n},{provide:dr,multi:!0,useFactory:()=>{let i=k(zM,{optional:!0});return()=>i.initialize()}},{provide:dr,multi:!0,useFactory:()=>{let i=k(YM);return()=>{i.initialize()}}},e===!0?{provide:of,useValue:!0}:[],{provide:cd,useValue:t??hC},{provide:_n,useFactory:()=>{let i=k(Dt),r=k(At),o;return a=>{i.runOutsideAngular(()=>{r.destroyed&&!o?setTimeout(()=>{throw a}):(o??=r.get(Tn),o.handleError(a))})}}}]}function Ex(n){return{enableLongStackTrace:!1,shouldCoalesceEventChangeDetection:n?.eventCoalescing??!1,shouldCoalesceRunChangeDetection:n?.runCoalescing??!1}}var YM=(()=>{class n{subscription=new Tt;initialized=!1;zone=k(Dt);pendingTasks=k(Si);initialize(){if(this.initialized)return;this.initialized=!0;let t=null;!this.zone.isStable&&!this.zone.hasPendingMacrotasks&&!this.zone.hasPendingMicrotasks&&(t=this.pendingTasks.add()),this.zone.runOutsideAngular(()=>{this.subscription.add(this.zone.onStable.subscribe(()=>{Dt.assertNotInAngularZone(),queueMicrotask(()=>{t!==null&&!this.zone.hasPendingMacrotasks&&!this.zone.hasPendingMicrotasks&&(this.pendingTasks.remove(t),t=null)})}))}),this.subscription.add(this.zone.onUnstable.subscribe(()=>{Dt.assertInAngularZone(),t??=this.pendingTasks.add()}))}ngOnDestroy(){this.subscription.unsubscribe()}static \u0275fac=function(i){return new(i||n)};static \u0275prov=X({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})();var Og=(()=>{class n{applicationErrorHandler=k(_n);appRef=k(zi);taskService=k(Si);ngZone=k(Dt);zonelessEnabled=k(Ps);tracing=k(no,{optional:!0});disableScheduling=k(of,{optional:!0})??!1;zoneIsDefined=typeof Zone<"u"&&!!Zone.root.run;schedulerTickApplyArgs=[{data:{__scheduler_tick__:!0}}];subscriptions=new Tt;angularZoneId=this.zoneIsDefined?this.ngZone._inner?.get(Ad):null;scheduleInRootZone=!this.zonelessEnabled&&this.zoneIsDefined&&(k(cd,{optional:!0})??!1);cancelScheduledCallback=null;useMicrotaskScheduler=!1;runningTick=!1;pendingRenderTaskId=null;constructor(){this.subscriptions.add(this.appRef.afterTick.subscribe(()=>{this.runningTick||this.cleanup()})),this.subscriptions.add(this.ngZone.onUnstable.subscribe(()=>{this.runningTick||this.cleanup()})),this.disableScheduling||=!this.zonelessEnabled&&(this.ngZone instanceof Bs||!this.zoneIsDefined)}notify(t){if(!this.zonelessEnabled&&t===5)return;let i=!1;switch(t){case 0:{this.appRef.dirtyFlags|=2;break}case 3:case 2:case 4:case 5:case 1:{this.appRef.dirtyFlags|=4;break}case 6:{this.appRef.dirtyFlags|=2,i=!0;break}case 12:{this.appRef.dirtyFlags|=16,i=!0;break}case 13:{this.appRef.dirtyFlags|=2,i=!0;break}case 11:{i=!0;break}case 9:case 8:case 7:case 10:default:this.appRef.dirtyFlags|=8}if(this.appRef.tracingSnapshot=this.tracing?.snapshot(this.appRef.tracingSnapshot)??null,!this.shouldScheduleTick(i))return;let r=this.useMicrotaskScheduler?ov:yC;this.pendingRenderTaskId=this.taskService.add(),this.scheduleInRootZone?this.cancelScheduledCallback=Zone.root.run(()=>r(()=>this.tick())):this.cancelScheduledCallback=this.ngZone.runOutsideAngular(()=>r(()=>this.tick()))}shouldScheduleTick(t){return!(this.disableScheduling&&!t||this.appRef.destroyed||this.pendingRenderTaskId!==null||this.runningTick||this.appRef._runningTick||!this.zonelessEnabled&&this.zoneIsDefined&&Zone.current.get(Ad+this.angularZoneId))}tick(){if(this.runningTick||this.appRef.destroyed)return;if(this.appRef.dirtyFlags===0){this.cleanup();return}!this.zonelessEnabled&&this.appRef.dirtyFlags&7&&(this.appRef.dirtyFlags|=1);let t=this.taskService.add();try{this.ngZone.run(()=>{this.runningTick=!0,this.appRef._tick()},void 0,this.schedulerTickApplyArgs)}catch(i){this.taskService.remove(t),this.applicationErrorHandler(i)}finally{this.cleanup()}this.useMicrotaskScheduler=!0,ov(()=>{this.useMicrotaskScheduler=!1,this.taskService.remove(t)})}ngOnDestroy(){this.subscriptions.unsubscribe(),this.cleanup()}cleanup(){if(this.runningTick=!1,this.cancelScheduledCallback?.(),this.cancelScheduledCallback=null,this.pendingRenderTaskId!==null){let t=this.pendingRenderTaskId;this.pendingRenderTaskId=null,this.taskService.remove(t)}}static \u0275fac=function(i){return new(i||n)};static \u0275prov=X({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})();function Bg(){return qi("NgZoneless"),$r([{provide:In,useExisting:Og},{provide:Dt,useClass:Bs},{provide:Ps,useValue:!0},{provide:cd,useValue:!1},[]])}function JM(){return typeof $localize<"u"&&$localize.locale||nl}var io=new ne("",{providedIn:"root",factory:()=>k(io,{optional:!0,skipSelf:!0})||JM()}),Ug=new ne("",{providedIn:"root",factory:()=>gM});function Ot(n){return e1(n)}function $(n,e){return _u(n,e?.equal)}var $g=class{[Jt];constructor(e){this[Jt]=e}destroy(){this[Jt].destroy()}};function Bn(n,e){let t=e?.injector??k(Qt),i=e?.manualCleanup!==!0?t.get(kn):null,r,o=t.get(Zo,null,{optional:!0}),a=t.get(In);return o!==null?(r=ZM(o.view,a,n),i instanceof bs&&i._lView===o.view&&(i=null)):r=XM(n,t.get(ks),a),r.injector=t,i!==null&&(r.onDestroyFn=i.onDestroy(()=>r.destroy())),new $g(r)}var Sx=G(O({},t1),{cleanupFns:void 0,zone:null,onDestroyFn:Jr,run(){let n=Qo(!1);try{n1(this)}finally{Qo(n)}},cleanup(){if(!this.cleanupFns?.length)return;let n=he(null);try{for(;this.cleanupFns.length;)this.cleanupFns.pop()()}finally{this.cleanupFns=[],he(n)}}}),KM=G(O({},Sx),{consumerMarkedDirty(){this.scheduler.schedule(this),this.notifier.notify(12)},destroy(){Nr(this),this.onDestroyFn(),this.cleanup(),this.scheduler.remove(this)}}),QM=G(O({},Sx),{consumerMarkedDirty(){this.view[ye]|=8192,gr(this.view),this.notifier.notify(13)},destroy(){Nr(this),this.onDestroyFn(),this.cleanup(),this.view[Bi]?.delete(this)}});function ZM(n,e,t){let i=Object.create(QM);return i.view=n,i.zone=typeof Zone<"u"?Zone.current:null,i.notifier=e,i.fn=Dx(i,t),n[Bi]??=new Set,n[Bi].add(i),i.consumerMarkedDirty(i),i}function XM(n,e,t){let i=Object.create(KM);return i.fn=Dx(i,n),i.scheduler=e,i.notifier=t,i.zone=typeof Zone<"u"?Zone.current:null,i.scheduler.add(i),i.notifier.notify(12),i}function Dx(n,e){return()=>{e(t=>(n.cleanupFns??=[]).push(t))}}var Mx=Symbol("InputSignalNode#UNSET"),pA=G(O({},vu),{transformFn:void 0,applyValueToInputSignal(n,e){Fo(n,e)}});function Ax(n,e){let t=Object.create(pA);t.value=n,t.transformFn=e?.transform;function i(){if(Mo(t),t.value===Mx){let r=null;throw new z(-950,r)}return t.value}return i[Jt]=t,i}var uc=class{attributeName;constructor(e){this.attributeName=e}__NG_ELEMENT_ID__=()=>zs(this.attributeName);toString(){return`HostAttributeToken ${this.attributeName}`}},fA=new ne("");fA.__NG_ELEMENT_ID__=n=>{let e=Rt();if(e===null)throw new z(204,!1);if(e.type&2)return e.value;if(n&8)return null;throw new z(204,!1)};function wx(n,e){return Ax(n,e)}function gA(n){return Ax(Mx,n)}var cc=(wx.required=gA,wx);var Hg=new ne(""),hA=new ne("");function il(n){return!n.moduleRef}function yA(n){let e=il(n)?n.r3Injector:n.moduleRef.injector,t=e.get(Dt);return t.run(()=>{il(n)?n.r3Injector.resolveInjectorInitializers():n.moduleRef.resolveInjectorInitializers();let i=e.get(_n),r;if(t.runOutsideAngular(()=>{r=t.onError.subscribe({next:i})}),il(n)){let o=()=>e.destroy(),a=n.platformInjector.get(Hg);a.add(o),e.onDestroy(()=>{r.unsubscribe(),a.delete(o)})}else{let o=()=>n.moduleRef.destroy(),a=n.platformInjector.get(Hg);a.add(o),n.moduleRef.onDestroy(()=>{Ls(n.allPlatformModules,n.moduleRef),r.unsubscribe(),a.delete(o)})}return vA(i,t,()=>{let o=e.get(Si),a=o.add(),u=e.get(Fg);return u.runInitializers(),u.donePromise.then(()=>{let c=e.get(io,nl);if(ux(c||nl),!e.get(hA,!0))return il(n)?e.get(zi):(n.allPlatformModules.push(n.moduleRef),n.moduleRef);if(il(n)){let g=e.get(zi);return n.rootComponent!==void 0&&g.bootstrap(n.rootComponent),g}else return _A?.(n.moduleRef,n.allPlatformModules),n.moduleRef}).finally(()=>void o.remove(a))})})}var _A;function vA(n,e,t){try{let i=t();return Cr(i)?i.catch(r=>{throw e.runOutsideAngular(()=>n(r)),r}):i}catch(i){throw e.runOutsideAngular(()=>n(i)),i}}var lc=null;function CA(n=[],e){return Qt.create({name:e,providers:[{provide:Ds,useValue:"platform"},{provide:Hg,useValue:new Set([()=>lc=null])},...n]})}function xA(n=[]){if(lc)return lc;let e=CA(n);return lc=e,ax(),bA(e),e}function bA(n){let e=n.get(qd,null);kt(n,()=>{e?.forEach(t=>t())})}var br=(()=>{class n{static __NG_ELEMENT_ID__=EA}return n})();function EA(n){return SA(Rt(),pe(),(n&16)===16)}function SA(n,e,t){if(fr(n)&&!t){let i=Fn(n.index,e);return new _r(i,i)}else if(n.type&175){let i=e[En];return new _r(i,e)}return null}var Gg=class{constructor(){}supports(e){return Tg(e)}create(e){return new qg(e)}},DA=(n,e)=>e,qg=class{length=0;collection;_linkedRecords=null;_unlinkedRecords=null;_previousItHead=null;_itHead=null;_itTail=null;_additionsHead=null;_additionsTail=null;_movesHead=null;_movesTail=null;_removalsHead=null;_removalsTail=null;_identityChangesHead=null;_identityChangesTail=null;_trackByFn;constructor(e){this._trackByFn=e||DA}forEachItem(e){let t;for(t=this._itHead;t!==null;t=t._next)e(t)}forEachOperation(e){let t=this._itHead,i=this._removalsHead,r=0,o=null;for(;t||i;){let a=!i||t&&t.currentIndex<Tx(i,r,o)?t:i,u=Tx(a,r,o),c=a.currentIndex;if(a===i)r--,i=i._nextRemoved;else if(t=t._next,a.previousIndex==null)r++;else{o||(o=[]);let p=u-r,g=c-r;if(p!=g){for(let v=0;v<p;v++){let C=v<o.length?o[v]:o[v]=0,T=C+v;g<=T&&T<p&&(o[v]=C+1)}let y=a.previousIndex;o[y]=g-p}}u!==c&&e(a,u,c)}}forEachPreviousItem(e){let t;for(t=this._previousItHead;t!==null;t=t._nextPrevious)e(t)}forEachAddedItem(e){let t;for(t=this._additionsHead;t!==null;t=t._nextAdded)e(t)}forEachMovedItem(e){let t;for(t=this._movesHead;t!==null;t=t._nextMoved)e(t)}forEachRemovedItem(e){let t;for(t=this._removalsHead;t!==null;t=t._nextRemoved)e(t)}forEachIdentityChange(e){let t;for(t=this._identityChangesHead;t!==null;t=t._nextIdentityChange)e(t)}diff(e){if(e==null&&(e=[]),!Tg(e))throw new z(900,!1);return this.check(e)?this:null}onDestroy(){}check(e){this._reset();let t=this._itHead,i=!1,r,o,a;if(Array.isArray(e)){this.length=e.length;for(let u=0;u<this.length;u++)o=e[u],a=this._trackByFn(u,o),t===null||!Object.is(t.trackById,a)?(t=this._mismatch(t,o,a,u),i=!0):(i&&(t=this._verifyReinsertion(t,o,a,u)),Object.is(t.item,o)||this._addIdentityChange(t,o)),t=t._next}else r=0,jC(e,u=>{a=this._trackByFn(r,u),t===null||!Object.is(t.trackById,a)?(t=this._mismatch(t,u,a,r),i=!0):(i&&(t=this._verifyReinsertion(t,u,a,r)),Object.is(t.item,u)||this._addIdentityChange(t,u)),t=t._next,r++}),this.length=r;return this._truncate(t),this.collection=e,this.isDirty}get isDirty(){return this._additionsHead!==null||this._movesHead!==null||this._removalsHead!==null||this._identityChangesHead!==null}_reset(){if(this.isDirty){let e;for(e=this._previousItHead=this._itHead;e!==null;e=e._next)e._nextPrevious=e._next;for(e=this._additionsHead;e!==null;e=e._nextAdded)e.previousIndex=e.currentIndex;for(this._additionsHead=this._additionsTail=null,e=this._movesHead;e!==null;e=e._nextMoved)e.previousIndex=e.currentIndex;this._movesHead=this._movesTail=null,this._removalsHead=this._removalsTail=null,this._identityChangesHead=this._identityChangesTail=null}}_mismatch(e,t,i,r){let o;return e===null?o=this._itTail:(o=e._prev,this._remove(e)),e=this._unlinkedRecords===null?null:this._unlinkedRecords.get(i,null),e!==null?(Object.is(e.item,t)||this._addIdentityChange(e,t),this._reinsertAfter(e,o,r)):(e=this._linkedRecords===null?null:this._linkedRecords.get(i,r),e!==null?(Object.is(e.item,t)||this._addIdentityChange(e,t),this._moveAfter(e,o,r)):e=this._addAfter(new Wg(t,i),o,r)),e}_verifyReinsertion(e,t,i,r){let o=this._unlinkedRecords===null?null:this._unlinkedRecords.get(i,null);return o!==null?e=this._reinsertAfter(o,e._prev,r):e.currentIndex!=r&&(e.currentIndex=r,this._addToMoves(e,r)),e}_truncate(e){for(;e!==null;){let t=e._next;this._addToRemovals(this._unlink(e)),e=t}this._unlinkedRecords!==null&&this._unlinkedRecords.clear(),this._additionsTail!==null&&(this._additionsTail._nextAdded=null),this._movesTail!==null&&(this._movesTail._nextMoved=null),this._itTail!==null&&(this._itTail._next=null),this._removalsTail!==null&&(this._removalsTail._nextRemoved=null),this._identityChangesTail!==null&&(this._identityChangesTail._nextIdentityChange=null)}_reinsertAfter(e,t,i){this._unlinkedRecords!==null&&this._unlinkedRecords.remove(e);let r=e._prevRemoved,o=e._nextRemoved;return r===null?this._removalsHead=o:r._nextRemoved=o,o===null?this._removalsTail=r:o._prevRemoved=r,this._insertAfter(e,t,i),this._addToMoves(e,i),e}_moveAfter(e,t,i){return this._unlink(e),this._insertAfter(e,t,i),this._addToMoves(e,i),e}_addAfter(e,t,i){return this._insertAfter(e,t,i),this._additionsTail===null?this._additionsTail=this._additionsHead=e:this._additionsTail=this._additionsTail._nextAdded=e,e}_insertAfter(e,t,i){let r=t===null?this._itHead:t._next;return e._next=r,e._prev=t,r===null?this._itTail=e:r._prev=e,t===null?this._itHead=e:t._next=e,this._linkedRecords===null&&(this._linkedRecords=new dc),this._linkedRecords.put(e),e.currentIndex=i,e}_remove(e){return this._addToRemovals(this._unlink(e))}_unlink(e){this._linkedRecords!==null&&this._linkedRecords.remove(e);let t=e._prev,i=e._next;return t===null?this._itHead=i:t._next=i,i===null?this._itTail=t:i._prev=t,e}_addToMoves(e,t){return e.previousIndex===t||(this._movesTail===null?this._movesTail=this._movesHead=e:this._movesTail=this._movesTail._nextMoved=e),e}_addToRemovals(e){return this._unlinkedRecords===null&&(this._unlinkedRecords=new dc),this._unlinkedRecords.put(e),e.currentIndex=null,e._nextRemoved=null,this._removalsTail===null?(this._removalsTail=this._removalsHead=e,e._prevRemoved=null):(e._prevRemoved=this._removalsTail,this._removalsTail=this._removalsTail._nextRemoved=e),e}_addIdentityChange(e,t){return e.item=t,this._identityChangesTail===null?this._identityChangesTail=this._identityChangesHead=e:this._identityChangesTail=this._identityChangesTail._nextIdentityChange=e,e}},Wg=class{item;trackById;currentIndex=null;previousIndex=null;_nextPrevious=null;_prev=null;_next=null;_prevDup=null;_nextDup=null;_prevRemoved=null;_nextRemoved=null;_nextAdded=null;_nextMoved=null;_nextIdentityChange=null;constructor(e,t){this.item=e,this.trackById=t}},jg=class{_head=null;_tail=null;add(e){this._head===null?(this._head=this._tail=e,e._nextDup=null,e._prevDup=null):(this._tail._nextDup=e,e._prevDup=this._tail,e._nextDup=null,this._tail=e)}get(e,t){let i;for(i=this._head;i!==null;i=i._nextDup)if((t===null||t<=i.currentIndex)&&Object.is(i.trackById,e))return i;return null}remove(e){let t=e._prevDup,i=e._nextDup;return t===null?this._head=i:t._nextDup=i,i===null?this._tail=t:i._prevDup=t,this._head===null}},dc=class{map=new Map;put(e){let t=e.trackById,i=this.map.get(t);i||(i=new jg,this.map.set(t,i)),i.add(e)}get(e,t){let i=e,r=this.map.get(i);return r?r.get(e,t):null}remove(e){let t=e.trackById;return this.map.get(t).remove(e)&&this.map.delete(t),e}get isEmpty(){return this.map.size===0}clear(){this.map.clear()}};function Tx(n,e,t){let i=n.previousIndex;if(i===null)return i;let r=0;return t&&i<t.length&&(r=t[i]),i+e+r}function Ix(){return new zg([new Gg])}var zg=(()=>{class n{factories;static \u0275prov=X({token:n,providedIn:"root",factory:Ix});constructor(t){this.factories=t}static create(t,i){if(i!=null){let r=i.factories.slice();t=t.concat(r)}return new n(t)}static extend(t){return{provide:n,useFactory:()=>{let i=k(n,{optional:!0,skipSelf:!0});return n.create(t,i||Ix())}}}find(t){let i=this.factories.find(r=>r.supports(t));if(i!=null)return i;throw new z(901,!1)}}return n})();function Rx(n){let{rootComponent:e,appProviders:t,platformProviders:i,platformRef:r}=n;Je(8);try{let o=r?.injector??xA(i),a=[bx({}),{provide:In,useExisting:Og},G1,...t||[]],u=new qs({providers:a,parent:o,debugName:"",runEnvironmentInitializers:!1});return yA({r3Injector:u.injector,platformInjector:o,rootComponent:e})}catch(o){return Promise.reject(o)}finally{Je(9)}}function ro(n){return typeof n=="boolean"?n:n!=null&&n!=="false"}var Px=null;function Un(){return Px}function Yg(n){Px??=n}var rl=class{},ol=(()=>{class n{historyGo(t){throw new Error("")}static \u0275fac=function(i){return new(i||n)};static \u0275prov=X({token:n,factory:()=>k(kx),providedIn:"platform"})}return n})();var kx=(()=>{class n extends ol{_location;_history;_doc=k(Vt);constructor(){super(),this._location=window.location,this._history=window.history}getBaseHrefFromDOM(){return Un().getBaseHref(this._doc)}onPopState(t){let i=Un().getGlobalEventTarget(this._doc,"window");return i.addEventListener("popstate",t,!1),()=>i.removeEventListener("popstate",t)}onHashChange(t){let i=Un().getGlobalEventTarget(this._doc,"window");return i.addEventListener("hashchange",t,!1),()=>i.removeEventListener("hashchange",t)}get href(){return this._location.href}get protocol(){return this._location.protocol}get hostname(){return this._location.hostname}get port(){return this._location.port}get pathname(){return this._location.pathname}get search(){return this._location.search}get hash(){return this._location.hash}set pathname(t){this._location.pathname=t}pushState(t,i,r){this._history.pushState(t,i,r)}replaceState(t,i,r){this._history.replaceState(t,i,r)}forward(){this._history.forward()}back(){this._history.back()}historyGo(t=0){this._history.go(t)}getState(){return this._history.state}static \u0275fac=function(i){return new(i||n)};static \u0275prov=X({token:n,factory:()=>new n,providedIn:"platform"})}return n})();function mc(n,e){return n?e?n.endsWith("/")?e.startsWith("/")?n+e.slice(1):n+e:e.startsWith("/")?n+e:`${n}/${e}`:n:e}function Nx(n){let e=n.search(/#|\?|$/);return n[e-1]==="/"?n.slice(0,e-1)+n.slice(e):n}function li(n){return n&&n[0]!=="?"?`?${n}`:n}var Ii=(()=>{class n{historyGo(t){throw new Error("")}static \u0275fac=function(i){return new(i||n)};static \u0275prov=X({token:n,factory:()=>k(Jg),providedIn:"root"})}return n})(),pc=new ne(""),Jg=(()=>{class n extends Ii{_platformLocation;_baseHref;_removeListenerFns=[];constructor(t,i){super(),this._platformLocation=t,this._baseHref=i??this._platformLocation.getBaseHrefFromDOM()??k(Vt).location?.origin??""}ngOnDestroy(){for(;this._removeListenerFns.length;)this._removeListenerFns.pop()()}onPopState(t){this._removeListenerFns.push(this._platformLocation.onPopState(t),this._platformLocation.onHashChange(t))}getBaseHref(){return this._baseHref}prepareExternalUrl(t){return mc(this._baseHref,t)}path(t=!1){let i=this._platformLocation.pathname+li(this._platformLocation.search),r=this._platformLocation.hash;return r&&t?`${i}${r}`:i}pushState(t,i,r,o){let a=this.prepareExternalUrl(r+li(o));this._platformLocation.pushState(t,i,a)}replaceState(t,i,r,o){let a=this.prepareExternalUrl(r+li(o));this._platformLocation.replaceState(t,i,a)}forward(){this._platformLocation.forward()}back(){this._platformLocation.back()}getState(){return this._platformLocation.getState()}historyGo(t=0){this._platformLocation.historyGo?.(t)}static \u0275fac=function(i){return new(i||n)(ae(ol),ae(pc,8))};static \u0275prov=X({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})(),oo=(()=>{class n{_subject=new bt;_basePath;_locationStrategy;_urlChangeListeners=[];_urlChangeSubscription=null;constructor(t){this._locationStrategy=t;let i=this._locationStrategy.getBaseHref();this._basePath=IA(Nx(Fx(i))),this._locationStrategy.onPopState(r=>{this._subject.next({url:this.path(!0),pop:!0,state:r.state,type:r.type})})}ngOnDestroy(){this._urlChangeSubscription?.unsubscribe(),this._urlChangeListeners=[]}path(t=!1){return this.normalize(this._locationStrategy.path(t))}getState(){return this._locationStrategy.getState()}isCurrentPathEqualTo(t,i=""){return this.path()==this.normalize(t+li(i))}normalize(t){return n.stripTrailingSlash(TA(this._basePath,Fx(t)))}prepareExternalUrl(t){return t&&t[0]!=="/"&&(t="/"+t),this._locationStrategy.prepareExternalUrl(t)}go(t,i="",r=null){this._locationStrategy.pushState(r,"",t,i),this._notifyUrlChangeListeners(this.prepareExternalUrl(t+li(i)),r)}replaceState(t,i="",r=null){this._locationStrategy.replaceState(r,"",t,i),this._notifyUrlChangeListeners(this.prepareExternalUrl(t+li(i)),r)}forward(){this._locationStrategy.forward()}back(){this._locationStrategy.back()}historyGo(t=0){this._locationStrategy.historyGo?.(t)}onUrlChange(t){return this._urlChangeListeners.push(t),this._urlChangeSubscription??=this.subscribe(i=>{this._notifyUrlChangeListeners(i.url,i.state)}),()=>{let i=this._urlChangeListeners.indexOf(t);this._urlChangeListeners.splice(i,1),this._urlChangeListeners.length===0&&(this._urlChangeSubscription?.unsubscribe(),this._urlChangeSubscription=null)}}_notifyUrlChangeListeners(t="",i){this._urlChangeListeners.forEach(r=>r(t,i))}subscribe(t,i,r){return this._subject.subscribe({next:t,error:i??void 0,complete:r??void 0})}static normalizeQueryParams=li;static joinWithSlash=mc;static stripTrailingSlash=Nx;static \u0275fac=function(i){return new(i||n)(ae(Ii))};static \u0275prov=X({token:n,factory:()=>wA(),providedIn:"root"})}return n})();function wA(){return new oo(ae(Ii))}function TA(n,e){if(!n||!e.startsWith(n))return e;let t=e.substring(n.length);return t===""||["/",";","?","#"].includes(t[0])?t:e}function Fx(n){return n.replace(/\/index.html$/,"")}function IA(n){if(new RegExp("^(https?:)?//").test(n)){let[,t]=n.split(/\/\/[^\/]+/);return t}return n}var nh=(()=>{class n extends Ii{_platformLocation;_baseHref="";_removeListenerFns=[];constructor(t,i){super(),this._platformLocation=t,i!=null&&(this._baseHref=i)}ngOnDestroy(){for(;this._removeListenerFns.length;)this._removeListenerFns.pop()()}onPopState(t){this._removeListenerFns.push(this._platformLocation.onPopState(t),this._platformLocation.onHashChange(t))}getBaseHref(){return this._baseHref}path(t=!1){let i=this._platformLocation.hash??"#";return i.length>0?i.substring(1):i}prepareExternalUrl(t){let i=mc(this._baseHref,t);return i.length>0?"#"+i:i}pushState(t,i,r,o){let a=this.prepareExternalUrl(r+li(o))||this._platformLocation.pathname;this._platformLocation.pushState(t,i,a)}replaceState(t,i,r,o){let a=this.prepareExternalUrl(r+li(o))||this._platformLocation.pathname;this._platformLocation.replaceState(t,i,a)}forward(){this._platformLocation.forward()}back(){this._platformLocation.back()}getState(){return this._platformLocation.getState()}historyGo(t=0){this._platformLocation.historyGo?.(t)}static \u0275fac=function(i){return new(i||n)(ae(ol),ae(pc,8))};static \u0275prov=X({token:n,factory:n.\u0275fac})}return n})(),Hx={ADP:[void 0,void 0,0],AFN:[void 0,"\u060B",0],ALL:[void 0,void 0,0],AMD:[void 0,"\u058F",2],AOA:[void 0,"Kz"],ARS:[void 0,"$"],AUD:["A$","$"],AZN:[void 0,"\u20BC"],BAM:[void 0,"KM"],BBD:[void 0,"$"],BDT:[void 0,"\u09F3"],BHD:[void 0,void 0,3],BIF:[void 0,void 0,0],BMD:[void 0,"$"],BND:[void 0,"$"],BOB:[void 0,"Bs"],BRL:["R$"],BSD:[void 0,"$"],BWP:[void 0,"P"],BYN:[void 0,void 0,2],BYR:[void 0,void 0,0],BZD:[void 0,"$"],CAD:["CA$","$",2],CHF:[void 0,void 0,2],CLF:[void 0,void 0,4],CLP:[void 0,"$",0],CNY:["CN\xA5","\xA5"],COP:[void 0,"$",2],CRC:[void 0,"\u20A1",2],CUC:[void 0,"$"],CUP:[void 0,"$"],CZK:[void 0,"K\u010D",2],DJF:[void 0,void 0,0],DKK:[void 0,"kr",2],DOP:[void 0,"$"],EGP:[void 0,"E\xA3"],ESP:[void 0,"\u20A7",0],EUR:["\u20AC"],FJD:[void 0,"$"],FKP:[void 0,"\xA3"],GBP:["\xA3"],GEL:[void 0,"\u20BE"],GHS:[void 0,"GH\u20B5"],GIP:[void 0,"\xA3"],GNF:[void 0,"FG",0],GTQ:[void 0,"Q"],GYD:[void 0,"$",2],HKD:["HK$","$"],HNL:[void 0,"L"],HRK:[void 0,"kn"],HUF:[void 0,"Ft",2],IDR:[void 0,"Rp",2],ILS:["\u20AA"],INR:["\u20B9"],IQD:[void 0,void 0,0],IRR:[void 0,void 0,0],ISK:[void 0,"kr",0],ITL:[void 0,void 0,0],JMD:[void 0,"$"],JOD:[void 0,void 0,3],JPY:["\xA5",void 0,0],KHR:[void 0,"\u17DB"],KMF:[void 0,"CF",0],KPW:[void 0,"\u20A9",0],KRW:["\u20A9",void 0,0],KWD:[void 0,void 0,3],KYD:[void 0,"$"],KZT:[void 0,"\u20B8"],LAK:[void 0,"\u20AD",0],LBP:[void 0,"L\xA3",0],LKR:[void 0,"Rs"],LRD:[void 0,"$"],LTL:[void 0,"Lt"],LUF:[void 0,void 0,0],LVL:[void 0,"Ls"],LYD:[void 0,void 0,3],MGA:[void 0,"Ar",0],MGF:[void 0,void 0,0],MMK:[void 0,"K",0],MNT:[void 0,"\u20AE",2],MRO:[void 0,void 0,0],MUR:[void 0,"Rs",2],MXN:["MX$","$"],MYR:[void 0,"RM"],NAD:[void 0,"$"],NGN:[void 0,"\u20A6"],NIO:[void 0,"C$"],NOK:[void 0,"kr",2],NPR:[void 0,"Rs"],NZD:["NZ$","$"],OMR:[void 0,void 0,3],PHP:["\u20B1"],PKR:[void 0,"Rs",2],PLN:[void 0,"z\u0142"],PYG:[void 0,"\u20B2",0],RON:[void 0,"lei"],RSD:[void 0,void 0,0],RUB:[void 0,"\u20BD"],RWF:[void 0,"RF",0],SBD:[void 0,"$"],SEK:[void 0,"kr",2],SGD:[void 0,"$"],SHP:[void 0,"\xA3"],SLE:[void 0,void 0,2],SLL:[void 0,void 0,0],SOS:[void 0,void 0,0],SRD:[void 0,"$"],SSP:[void 0,"\xA3"],STD:[void 0,void 0,0],STN:[void 0,"Db"],SYP:[void 0,"\xA3",0],THB:[void 0,"\u0E3F"],TMM:[void 0,void 0,0],TND:[void 0,void 0,3],TOP:[void 0,"T$"],TRL:[void 0,void 0,0],TRY:[void 0,"\u20BA"],TTD:[void 0,"$"],TWD:["NT$","$",2],TZS:[void 0,void 0,2],UAH:[void 0,"\u20B4"],UGX:[void 0,void 0,0],USD:["$"],UYI:[void 0,void 0,0],UYU:[void 0,"$"],UYW:[void 0,void 0,4],UZS:[void 0,void 0,2],VEF:[void 0,"Bs",2],VND:["\u20AB",void 0,0],VUV:[void 0,void 0,0],XAF:["FCFA",void 0,0],XCD:["EC$","$"],XOF:["F\u202FCFA",void 0,0],XPF:["CFPF",void 0,0],XXX:["\xA4"],YER:[void 0,void 0,0],ZAR:[void 0,"R"],ZMK:[void 0,void 0,0],ZMW:[void 0,"ZK"],ZWD:[void 0,void 0,0]},Ec=(function(n){return n[n.Decimal=0]="Decimal",n[n.Percent=1]="Percent",n[n.Currency=2]="Currency",n[n.Scientific=3]="Scientific",n})(Ec||{});var en=(function(n){return n[n.Format=0]="Format",n[n.Standalone=1]="Standalone",n})(en||{}),Ze=(function(n){return n[n.Narrow=0]="Narrow",n[n.Abbreviated=1]="Abbreviated",n[n.Wide=2]="Wide",n[n.Short=3]="Short",n})(Ze||{}),vn=(function(n){return n[n.Short=0]="Short",n[n.Medium=1]="Medium",n[n.Long=2]="Long",n[n.Full=3]="Full",n})(vn||{}),zt={Decimal:0,Group:1,List:2,PercentSign:3,PlusSign:4,MinusSign:5,Exponential:6,SuperscriptingExponent:7,PerMille:8,Infinity:9,NaN:10,TimeSeparator:11,CurrencyDecimal:12,CurrencyGroup:13};function Gx(n){return ln(n)[ht.LocaleId]}function qx(n,e,t){let i=ln(n),r=[i[ht.DayPeriodsFormat],i[ht.DayPeriodsStandalone]],o=$n(r,e);return $n(o,t)}function Wx(n,e,t){let i=ln(n),r=[i[ht.DaysFormat],i[ht.DaysStandalone]],o=$n(r,e);return $n(o,t)}function jx(n,e,t){let i=ln(n),r=[i[ht.MonthsFormat],i[ht.MonthsStandalone]],o=$n(r,e);return $n(o,t)}function zx(n,e){let i=ln(n)[ht.Eras];return $n(i,e)}function al(n,e){let t=ln(n);return $n(t[ht.DateFormat],e)}function sl(n,e){let t=ln(n);return $n(t[ht.TimeFormat],e)}function ll(n,e){let i=ln(n)[ht.DateTimeFormat];return $n(i,e)}function di(n,e){let t=ln(n),i=t[ht.NumberSymbols][e];if(typeof i>"u"){if(e===zt.CurrencyDecimal)return t[ht.NumberSymbols][zt.Decimal];if(e===zt.CurrencyGroup)return t[ht.NumberSymbols][zt.Group]}return i}function ih(n,e){return ln(n)[ht.NumberFormats][e]}function MA(n){return ln(n)[ht.Currencies]}function Yx(n){if(!n[ht.ExtraData])throw new z(2303,!1)}function Jx(n){let e=ln(n);return Yx(e),(e[ht.ExtraData][2]||[]).map(i=>typeof i=="string"?Kg(i):[Kg(i[0]),Kg(i[1])])}function Kx(n,e,t){let i=ln(n);Yx(i);let r=[i[ht.ExtraData][0],i[ht.ExtraData][1]],o=$n(r,e)||[];return $n(o,t)||[]}function $n(n,e){for(let t=e;t>-1;t--)if(typeof n[t]<"u")return n[t];throw new z(2304,!1)}function Kg(n){let[e,t]=n.split(":");return{hours:+e,minutes:+t}}function Qx(n,e,t="en"){let i=MA(t)[n]||Hx[n]||[],r=i[1];return e==="narrow"&&typeof r=="string"?r:i[0]||n}var AA=2;function Zx(n){let e,t=Hx[n];return t&&(e=t[2]),typeof e=="number"?e:AA}var RA=/^(\d{4,})-?(\d\d)-?(\d\d)(?:T(\d\d)(?::?(\d\d)(?::?(\d\d)(?:\.(\d+))?)?)?(Z|([+-])(\d\d):?(\d\d))?)?$/,fc={},NA=/((?:[^BEGHLMOSWYZabcdhmswyz']+)|(?:'(?:[^']|'')*')|(?:G{1,5}|y{1,4}|Y{1,4}|M{1,5}|L{1,5}|w{1,2}|W{1}|d{1,2}|E{1,6}|c{1,6}|a{1,5}|b{1,5}|B{1,5}|h{1,2}|H{1,2}|m{1,2}|s{1,2}|S{1,3}|z{1,4}|Z{1,5}|O{1,4}))([\s\S]*)/;function Xx(n,e,t,i){let r=$A(n);e=Yi(t,e)||e;let a=[],u;for(;e;)if(u=NA.exec(e),u){a=a.concat(u.slice(1));let g=a.pop();if(!g)break;e=g}else{a.push(e);break}let c=r.getTimezoneOffset();i&&(c=tb(i,c),r=UA(r,i));let p="";return a.forEach(g=>{let y=OA(g);p+=y?y(r,t,c):g==="''"?"'":g.replace(/(^'|'$)/g,"").replace(/''/g,"'")}),p}function vc(n,e,t){let i=new Date(0);return i.setFullYear(n,e,t),i.setHours(0,0,0),i}function Yi(n,e){let t=Gx(n);if(fc[t]??={},fc[t][e])return fc[t][e];let i="";switch(e){case"shortDate":i=al(n,vn.Short);break;case"mediumDate":i=al(n,vn.Medium);break;case"longDate":i=al(n,vn.Long);break;case"fullDate":i=al(n,vn.Full);break;case"shortTime":i=sl(n,vn.Short);break;case"mediumTime":i=sl(n,vn.Medium);break;case"longTime":i=sl(n,vn.Long);break;case"fullTime":i=sl(n,vn.Full);break;case"short":let r=Yi(n,"shortTime"),o=Yi(n,"shortDate");i=gc(ll(n,vn.Short),[r,o]);break;case"medium":let a=Yi(n,"mediumTime"),u=Yi(n,"mediumDate");i=gc(ll(n,vn.Medium),[a,u]);break;case"long":let c=Yi(n,"longTime"),p=Yi(n,"longDate");i=gc(ll(n,vn.Long),[c,p]);break;case"full":let g=Yi(n,"fullTime"),y=Yi(n,"fullDate");i=gc(ll(n,vn.Full),[g,y]);break}return i&&(fc[t][e]=i),i}function gc(n,e){return e&&(n=n.replace(/\{([^}]+)}/g,function(t,i){return e!=null&&i in e?e[i]:t})),n}function ui(n,e,t="-",i,r){let o="";(n<0||r&&n<=0)&&(r?n=-n+1:(n=-n,o=t));let a=String(n);for(;a.length<e;)a="0"+a;return i&&(a=a.slice(a.length-e)),o+a}function FA(n,e){return ui(n,3).substring(0,e)}function Nt(n,e,t=0,i=!1,r=!1){return function(o,a){let u=PA(n,o);if((t>0||u>-t)&&(u+=t),n===3)u===0&&t===-12&&(u=12);else if(n===6)return FA(u,e);let c=di(a,zt.MinusSign);return ui(u,e,c,i,r)}}function PA(n,e){switch(n){case 0:return e.getFullYear();case 1:return e.getMonth();case 2:return e.getDate();case 3:return e.getHours();case 4:return e.getMinutes();case 5:return e.getSeconds();case 6:return e.getMilliseconds();case 7:return e.getDay();default:throw new z(2301,!1)}}function at(n,e,t=en.Format,i=!1){return function(r,o){return kA(r,o,n,e,t,i)}}function kA(n,e,t,i,r,o){switch(t){case 2:return jx(e,r,i)[n.getMonth()];case 1:return Wx(e,r,i)[n.getDay()];case 0:let a=n.getHours(),u=n.getMinutes();if(o){let p=Jx(e),g=Kx(e,r,i),y=p.findIndex(v=>{if(Array.isArray(v)){let[C,T]=v,R=a>=C.hours&&u>=C.minutes,F=a<T.hours||a===T.hours&&u<T.minutes;if(C.hours<T.hours){if(R&&F)return!0}else if(R||F)return!0}else if(v.hours===a&&v.minutes===u)return!0;return!1});if(y!==-1)return g[y]}return qx(e,r,i)[a<12?0:1];case 3:return zx(e,i)[n.getFullYear()<=0?0:1];default:let c=t;throw new z(2302,!1)}}function hc(n){return function(e,t,i){let r=-1*i,o=di(t,zt.MinusSign),a=r>0?Math.floor(r/60):Math.ceil(r/60);switch(n){case 0:return(r>=0?"+":"")+ui(a,2,o)+ui(Math.abs(r%60),2,o);case 1:return"GMT"+(r>=0?"+":"")+ui(a,1,o);case 2:return"GMT"+(r>=0?"+":"")+ui(a,2,o)+":"+ui(Math.abs(r%60),2,o);case 3:return i===0?"Z":(r>=0?"+":"")+ui(a,2,o)+":"+ui(Math.abs(r%60),2,o);default:throw new z(2310,!1)}}}var VA=0,_c=4;function LA(n){let e=vc(n,VA,1).getDay();return vc(n,0,1+(e<=_c?_c:_c+7)-e)}function eb(n){let e=n.getDay(),t=e===0?-3:_c-e;return vc(n.getFullYear(),n.getMonth(),n.getDate()+t)}function Qg(n,e=!1){return function(t,i){let r;if(e){let o=new Date(t.getFullYear(),t.getMonth(),1).getDay()-1,a=t.getDate();r=1+Math.floor((a+o)/7)}else{let o=eb(t),a=LA(o.getFullYear()),u=o.getTime()-a.getTime();r=1+Math.round(u/6048e5)}return ui(r,n,di(i,zt.MinusSign))}}function yc(n,e=!1){return function(t,i){let o=eb(t).getFullYear();return ui(o,n,di(i,zt.MinusSign),e)}}var Zg={};function OA(n){if(Zg[n])return Zg[n];let e;switch(n){case"G":case"GG":case"GGG":e=at(3,Ze.Abbreviated);break;case"GGGG":e=at(3,Ze.Wide);break;case"GGGGG":e=at(3,Ze.Narrow);break;case"y":e=Nt(0,1,0,!1,!0);break;case"yy":e=Nt(0,2,0,!0,!0);break;case"yyy":e=Nt(0,3,0,!1,!0);break;case"yyyy":e=Nt(0,4,0,!1,!0);break;case"Y":e=yc(1);break;case"YY":e=yc(2,!0);break;case"YYY":e=yc(3);break;case"YYYY":e=yc(4);break;case"M":case"L":e=Nt(1,1,1);break;case"MM":case"LL":e=Nt(1,2,1);break;case"MMM":e=at(2,Ze.Abbreviated);break;case"MMMM":e=at(2,Ze.Wide);break;case"MMMMM":e=at(2,Ze.Narrow);break;case"LLL":e=at(2,Ze.Abbreviated,en.Standalone);break;case"LLLL":e=at(2,Ze.Wide,en.Standalone);break;case"LLLLL":e=at(2,Ze.Narrow,en.Standalone);break;case"w":e=Qg(1);break;case"ww":e=Qg(2);break;case"W":e=Qg(1,!0);break;case"d":e=Nt(2,1);break;case"dd":e=Nt(2,2);break;case"c":case"cc":e=Nt(7,1);break;case"ccc":e=at(1,Ze.Abbreviated,en.Standalone);break;case"cccc":e=at(1,Ze.Wide,en.Standalone);break;case"ccccc":e=at(1,Ze.Narrow,en.Standalone);break;case"cccccc":e=at(1,Ze.Short,en.Standalone);break;case"E":case"EE":case"EEE":e=at(1,Ze.Abbreviated);break;case"EEEE":e=at(1,Ze.Wide);break;case"EEEEE":e=at(1,Ze.Narrow);break;case"EEEEEE":e=at(1,Ze.Short);break;case"a":case"aa":case"aaa":e=at(0,Ze.Abbreviated);break;case"aaaa":e=at(0,Ze.Wide);break;case"aaaaa":e=at(0,Ze.Narrow);break;case"b":case"bb":case"bbb":e=at(0,Ze.Abbreviated,en.Standalone,!0);break;case"bbbb":e=at(0,Ze.Wide,en.Standalone,!0);break;case"bbbbb":e=at(0,Ze.Narrow,en.Standalone,!0);break;case"B":case"BB":case"BBB":e=at(0,Ze.Abbreviated,en.Format,!0);break;case"BBBB":e=at(0,Ze.Wide,en.Format,!0);break;case"BBBBB":e=at(0,Ze.Narrow,en.Format,!0);break;case"h":e=Nt(3,1,-12);break;case"hh":e=Nt(3,2,-12);break;case"H":e=Nt(3,1);break;case"HH":e=Nt(3,2);break;case"m":e=Nt(4,1);break;case"mm":e=Nt(4,2);break;case"s":e=Nt(5,1);break;case"ss":e=Nt(5,2);break;case"S":e=Nt(6,1);break;case"SS":e=Nt(6,2);break;case"SSS":e=Nt(6,3);break;case"Z":case"ZZ":case"ZZZ":e=hc(0);break;case"ZZZZZ":e=hc(3);break;case"O":case"OO":case"OOO":case"z":case"zz":case"zzz":e=hc(1);break;case"OOOO":case"ZZZZ":case"zzzz":e=hc(2);break;default:return null}return Zg[n]=e,e}function tb(n,e){n=n.replace(/:/g,"");let t=Date.parse("Jan 01, 1970 00:00:00 "+n)/6e4;return isNaN(t)?e:t}function BA(n,e){return n=new Date(n.getTime()),n.setMinutes(n.getMinutes()+e),n}function UA(n,e,t){let r=n.getTimezoneOffset(),o=tb(e,r);return BA(n,-1*(o-r))}function $A(n){if(Vx(n))return n;if(typeof n=="number"&&!isNaN(n))return new Date(n);if(typeof n=="string"){if(n=n.trim(),/^(\d{4}(-\d{1,2}(-\d{1,2})?)?)$/.test(n)){let[r,o=1,a=1]=n.split("-").map(u=>+u);return vc(r,o-1,a)}let t=parseFloat(n);if(!isNaN(n-t))return new Date(t);let i;if(i=n.match(RA))return HA(i)}let e=new Date(n);if(!Vx(e))throw new z(2311,!1);return e}function HA(n){let e=new Date(0),t=0,i=0,r=n[8]?e.setUTCFullYear:e.setFullYear,o=n[8]?e.setUTCHours:e.setHours;n[9]&&(t=Number(n[9]+n[10]),i=Number(n[9]+n[11])),r.call(e,Number(n[1]),Number(n[2])-1,Number(n[3]));let a=Number(n[4]||0)-t,u=Number(n[5]||0)-i,c=Number(n[6]||0),p=Math.floor(parseFloat("0."+(n[7]||0))*1e3);return o.call(e,a,u,c,p),e}function Vx(n){return n instanceof Date&&!isNaN(n.valueOf())}var GA=/^(\d+)?\.((\d+)(-(\d+))?)?$/,Lx=22,Cc=".",ul="0",qA=";",WA=",",Xg="#",Ox="\xA4";function nb(n,e,t,i,r,o,a=!1){let u="",c=!1;if(!isFinite(n))u=di(t,zt.Infinity);else{let p=zA(n);a&&(p=jA(p));let g=e.minInt,y=e.minFrac,v=e.maxFrac;if(o){let H=o.match(GA);if(H===null)throw new z(2306,!1);let q=H[1],Z=H[3],ie=H[5];q!=null&&(g=eh(q)),Z!=null&&(y=eh(Z)),ie!=null?v=eh(ie):Z!=null&&y>v&&(v=y)}YA(p,y,v);let C=p.digits,T=p.integerLen,R=p.exponent,F=[];for(c=C.every(H=>!H);T<g;T++)C.unshift(0);for(;T<0;T++)C.unshift(0);T>0?F=C.splice(T,C.length):(F=C,C=[0]);let P=[];for(C.length>=e.lgSize&&P.unshift(C.splice(-e.lgSize,C.length).join(""));C.length>e.gSize;)P.unshift(C.splice(-e.gSize,C.length).join(""));C.length&&P.unshift(C.join("")),u=P.join(di(t,i)),F.length&&(u+=di(t,r)+F.join("")),R&&(u+=di(t,zt.Exponential)+"+"+R)}return n<0&&!c?u=e.negPre+u+e.negSuf:u=e.posPre+u+e.posSuf,u}function ib(n,e,t,i,r){let o=ih(e,Ec.Currency),a=ob(o,di(e,zt.MinusSign));return a.minFrac=Zx(i),a.maxFrac=a.minFrac,nb(n,a,e,zt.CurrencyGroup,zt.CurrencyDecimal,r).replace(Ox,t).replace(Ox,"").trim()}function rb(n,e,t){let i=ih(e,Ec.Decimal),r=ob(i,di(e,zt.MinusSign));return nb(n,r,e,zt.Group,zt.Decimal,t)}function ob(n,e="-"){let t={minInt:1,minFrac:0,maxFrac:0,posPre:"",posSuf:"",negPre:"",negSuf:"",gSize:0,lgSize:0},i=n.split(qA),r=i[0],o=i[1],a=r.indexOf(Cc)!==-1?r.split(Cc):[r.substring(0,r.lastIndexOf(ul)+1),r.substring(r.lastIndexOf(ul)+1)],u=a[0],c=a[1]||"";t.posPre=u.substring(0,u.indexOf(Xg));for(let g=0;g<c.length;g++){let y=c.charAt(g);y===ul?t.minFrac=t.maxFrac=g+1:y===Xg?t.maxFrac=g+1:t.posSuf+=y}let p=u.split(WA);if(t.gSize=p[1]?p[1].length:0,t.lgSize=p[2]||p[1]?(p[2]||p[1]).length:0,o){let g=r.length-t.posPre.length-t.posSuf.length,y=o.indexOf(Xg);t.negPre=o.substring(0,y).replace(/'/g,""),t.negSuf=o.slice(y+g).replace(/'/g,"")}else t.negPre=e+t.posPre,t.negSuf=t.posSuf;return t}function jA(n){if(n.digits[0]===0)return n;let e=n.digits.length-n.integerLen;return n.exponent?n.exponent+=2:(e===0?n.digits.push(0,0):e===1&&n.digits.push(0),n.integerLen+=2),n}function zA(n){let e=Math.abs(n)+"",t=0,i,r,o,a,u;for((r=e.indexOf(Cc))>-1&&(e=e.replace(Cc,"")),(o=e.search(/e/i))>0?(r<0&&(r=o),r+=+e.slice(o+1),e=e.substring(0,o)):r<0&&(r=e.length),o=0;e.charAt(o)===ul;o++);if(o===(u=e.length))i=[0],r=1;else{for(u--;e.charAt(u)===ul;)u--;for(r-=o,i=[],a=0;o<=u;o++,a++)i[a]=Number(e.charAt(o))}return r>Lx&&(i=i.splice(0,Lx-1),t=r-1,r=1),{digits:i,exponent:t,integerLen:r}}function YA(n,e,t){if(e>t)throw new z(2307,!1);let i=n.digits,r=i.length-n.integerLen,o=Math.min(Math.max(e,r),t),a=o+n.integerLen,u=i[a];if(a>0){i.splice(Math.max(n.integerLen,a));for(let y=a;y<i.length;y++)i[y]=0}else{r=Math.max(0,r),n.integerLen=1,i.length=Math.max(1,a=o+1),i[0]=0;for(let y=1;y<a;y++)i[y]=0}if(u>=5)if(a-1<0){for(let y=0;y>a;y--)i.unshift(0),n.integerLen++;i.unshift(1),n.integerLen++}else i[a-1]++;for(;r<Math.max(0,o);r++)i.push(0);let c=o!==0,p=e+n.integerLen,g=i.reduceRight(function(y,v,C,T){return v=v+y,T[C]=v<10?v:v-10,c&&(T[C]===0&&C>=p?T.pop():c=!1),v>=10?1:0},0);g&&(i.unshift(g),n.integerLen++)}function eh(n){let e=parseInt(n);if(isNaN(e))throw new z(2305,!1);return e}var th=/\s+/,Bx=[],rh=(()=>{class n{_ngEl;_renderer;initialClasses=Bx;rawClass;stateMap=new Map;constructor(t,i){this._ngEl=t,this._renderer=i}set klass(t){this.initialClasses=t!=null?t.trim().split(th):Bx}set ngClass(t){this.rawClass=typeof t=="string"?t.trim().split(th):t}ngDoCheck(){for(let i of this.initialClasses)this._updateState(i,!0);let t=this.rawClass;if(Array.isArray(t)||t instanceof Set)for(let i of t)this._updateState(i,!0);else if(t!=null)for(let i of Object.keys(t))this._updateState(i,!!t[i]);this._applyStateDiff()}_updateState(t,i){let r=this.stateMap.get(t);r!==void 0?(r.enabled!==i&&(r.changed=!0,r.enabled=i),r.touched=!0):this.stateMap.set(t,{enabled:i,changed:!0,touched:!0})}_applyStateDiff(){for(let t of this.stateMap){let i=t[0],r=t[1];r.changed?(this._toggleClass(i,r.enabled),r.changed=!1):r.touched||(r.enabled&&this._toggleClass(i,!1),this.stateMap.delete(i)),r.touched=!1}}_toggleClass(t,i){t=t.trim(),t.length>0&&t.split(th).forEach(r=>{i?this._renderer.addClass(this._ngEl.nativeElement,r):this._renderer.removeClass(this._ngEl.nativeElement,r)})}static \u0275fac=function(i){return new(i||n)(ee(an),ee(ai))};static \u0275dir=Ne({type:n,selectors:[["","ngClass",""]],inputs:{klass:[0,"class","klass"],ngClass:"ngClass"}})}return n})();var xc=class{$implicit;ngForOf;index;count;constructor(e,t,i,r){this.$implicit=e,this.ngForOf=t,this.index=i,this.count=r}get first(){return this.index===0}get last(){return this.index===this.count-1}get even(){return this.index%2===0}get odd(){return!this.even}},la=(()=>{class n{_viewContainer;_template;_differs;set ngForOf(t){this._ngForOf=t,this._ngForOfDirty=!0}set ngForTrackBy(t){this._trackByFn=t}get ngForTrackBy(){return this._trackByFn}_ngForOf=null;_ngForOfDirty=!0;_differ=null;_trackByFn;constructor(t,i,r){this._viewContainer=t,this._template=i,this._differs=r}set ngForTemplate(t){t&&(this._template=t)}ngDoCheck(){if(this._ngForOfDirty){this._ngForOfDirty=!1;let t=this._ngForOf;!this._differ&&t&&(this._differ=this._differs.find(t).create(this.ngForTrackBy))}if(this._differ){let t=this._differ.diff(this._ngForOf);t&&this._applyChanges(t)}}_applyChanges(t){let i=this._viewContainer;t.forEachOperation((r,o,a)=>{if(r.previousIndex==null)i.createEmbeddedView(this._template,new xc(r.item,this._ngForOf,-1,-1),a===null?void 0:a);else if(a==null)i.remove(o===null?void 0:o);else if(o!==null){let u=i.get(o);i.move(u,a),Ux(u,r)}});for(let r=0,o=i.length;r<o;r++){let u=i.get(r).context;u.index=r,u.count=o,u.ngForOf=this._ngForOf}t.forEachIdentityChange(r=>{let o=i.get(r.currentIndex);Ux(o,r)})}static ngTemplateContextGuard(t,i){return!0}static \u0275fac=function(i){return new(i||n)(ee(ji),ee(vr),ee(zg))};static \u0275dir=Ne({type:n,selectors:[["","ngFor","","ngForOf",""]],inputs:{ngForOf:"ngForOf",ngForTrackBy:"ngForTrackBy",ngForTemplate:"ngForTemplate"}})}return n})();function Ux(n,e){n.context.$implicit=e.item}var Ji=(()=>{class n{_viewContainer;_context=new bc;_thenTemplateRef=null;_elseTemplateRef=null;_thenViewRef=null;_elseViewRef=null;constructor(t,i){this._viewContainer=t,this._thenTemplateRef=i}set ngIf(t){this._context.$implicit=this._context.ngIf=t,this._updateView()}set ngIfThen(t){$x(t,!1),this._thenTemplateRef=t,this._thenViewRef=null,this._updateView()}set ngIfElse(t){$x(t,!1),this._elseTemplateRef=t,this._elseViewRef=null,this._updateView()}_updateView(){this._context.$implicit?this._thenViewRef||(this._viewContainer.clear(),this._elseViewRef=null,this._thenTemplateRef&&(this._thenViewRef=this._viewContainer.createEmbeddedView(this._thenTemplateRef,this._context))):this._elseViewRef||(this._viewContainer.clear(),this._thenViewRef=null,this._elseTemplateRef&&(this._elseViewRef=this._viewContainer.createEmbeddedView(this._elseTemplateRef,this._context)))}static ngIfUseIfTypeGuard;static ngTemplateGuard_ngIf;static ngTemplateContextGuard(t,i){return!0}static \u0275fac=function(i){return new(i||n)(ee(ji),ee(vr))};static \u0275dir=Ne({type:n,selectors:[["","ngIf",""]],inputs:{ngIf:"ngIf",ngIfThen:"ngIfThen",ngIfElse:"ngIfElse"}})}return n})(),bc=class{$implicit=null;ngIf=null};function $x(n,e){if(n&&!n.createEmbeddedView)throw new z(2020,!1)}function oh(n,e){return new z(2100,!1)}var JA="mediumDate",ab=new ne(""),sb=new ne(""),ao=(()=>{class n{locale;defaultTimezone;defaultOptions;constructor(t,i,r){this.locale=t,this.defaultTimezone=i,this.defaultOptions=r}transform(t,i,r,o){if(t==null||t===""||t!==t)return null;try{let a=i??this.defaultOptions?.dateFormat??JA,u=r??this.defaultOptions?.timezone??this.defaultTimezone??void 0;return Xx(t,a,o||this.locale,u)}catch(a){throw oh(n,a.message)}}static \u0275fac=function(i){return new(i||n)(ee(io,16),ee(ab,24),ee(sb,24))};static \u0275pipe=tl({name:"date",type:n,pure:!0})}return n})();var dl=(()=>{class n{_locale;constructor(t){this._locale=t}transform(t,i,r){if(!lb(t))return null;r||=this._locale;try{let o=ub(t);return rb(o,r,i)}catch(o){throw oh(n,o.message)}}static \u0275fac=function(i){return new(i||n)(ee(io,16))};static \u0275pipe=tl({name:"number",type:n,pure:!0})}return n})();var ah=(()=>{class n{_locale;_defaultCurrencyCode;constructor(t,i="USD"){this._locale=t,this._defaultCurrencyCode=i}transform(t,i=this._defaultCurrencyCode,r="symbol",o,a){if(!lb(t))return null;a||=this._locale,typeof r=="boolean"&&(r=r?"symbol":"code");let u=i||this._defaultCurrencyCode;r!=="code"&&(r==="symbol"||r==="symbol-narrow"?u=Qx(u,r==="symbol"?"wide":"narrow",a):u=r);try{let c=ub(t);return ib(c,a,u,i,o)}catch(c){throw oh(n,c.message)}}static \u0275fac=function(i){return new(i||n)(ee(io,16),ee(Ug,16))};static \u0275pipe=tl({name:"currency",type:n,pure:!0})}return n})();function lb(n){return!(n==null||n===""||n!==n)}function ub(n){if(typeof n=="string"&&!isNaN(Number(n)-parseFloat(n)))return Number(n);if(typeof n!="number")throw new z(2309,!1);return n}var se=(()=>{class n{static \u0275fac=function(i){return new(i||n)};static \u0275mod=si({type:n});static \u0275inj=Mn({})}return n})();function cl(n,e){e=encodeURIComponent(e);for(let t of n.split(";")){let i=t.indexOf("="),[r,o]=i==-1?[t,""]:[t.slice(0,i),t.slice(i+1)];if(r.trim()===e)return decodeURIComponent(o)}return null}var so=class{};var db="browser";var ml=class{_doc;constructor(e){this._doc=e}manager},Sc=(()=>{class n extends ml{constructor(t){super(t)}supports(t){return!0}addEventListener(t,i,r,o){return t.addEventListener(i,r,o),()=>this.removeEventListener(t,i,r,o)}removeEventListener(t,i,r,o){return t.removeEventListener(i,r,o)}static \u0275fac=function(i){return new(i||n)(ae(Vt))};static \u0275prov=X({token:n,factory:n.\u0275fac})}return n})(),wc=new ne(""),ch=(()=>{class n{_zone;_plugins;_eventNameToPlugin=new Map;constructor(t,i){this._zone=i,t.forEach(a=>{a.manager=this});let r=t.filter(a=>!(a instanceof Sc));this._plugins=r.slice().reverse();let o=t.find(a=>a instanceof Sc);o&&this._plugins.push(o)}addEventListener(t,i,r,o){return this._findPluginFor(i).addEventListener(t,i,r,o)}getZone(){return this._zone}_findPluginFor(t){let i=this._eventNameToPlugin.get(t);if(i)return i;if(i=this._plugins.find(o=>o.supports(t)),!i)throw new z(5101,!1);return this._eventNameToPlugin.set(t,i),i}static \u0275fac=function(i){return new(i||n)(ae(wc),ae(Dt))};static \u0275prov=X({token:n,factory:n.\u0275fac})}return n})(),sh="ng-app-id";function cb(n){for(let e of n)e.remove()}function mb(n,e){let t=e.createElement("style");return t.textContent=n,t}function QA(n,e,t,i){let r=n.head?.querySelectorAll(`style[${sh}="${e}"],link[${sh}="${e}"]`);if(r)for(let o of r)o.removeAttribute(sh),o instanceof HTMLLinkElement?i.set(o.href.slice(o.href.lastIndexOf("/")+1),{usage:0,elements:[o]}):o.textContent&&t.set(o.textContent,{usage:0,elements:[o]})}function uh(n,e){let t=e.createElement("link");return t.setAttribute("rel","stylesheet"),t.setAttribute("href",n),t}var mh=(()=>{class n{doc;appId;nonce;inline=new Map;external=new Map;hosts=new Set;constructor(t,i,r,o={}){this.doc=t,this.appId=i,this.nonce=r,QA(t,i,this.inline,this.external),this.hosts.add(t.head)}addStyles(t,i){for(let r of t)this.addUsage(r,this.inline,mb);i?.forEach(r=>this.addUsage(r,this.external,uh))}removeStyles(t,i){for(let r of t)this.removeUsage(r,this.inline);i?.forEach(r=>this.removeUsage(r,this.external))}addUsage(t,i,r){let o=i.get(t);o?o.usage++:i.set(t,{usage:1,elements:[...this.hosts].map(a=>this.addElement(a,r(t,this.doc)))})}removeUsage(t,i){let r=i.get(t);r&&(r.usage--,r.usage<=0&&(cb(r.elements),i.delete(t)))}ngOnDestroy(){for(let[,{elements:t}]of[...this.inline,...this.external])cb(t);this.hosts.clear()}addHost(t){this.hosts.add(t);for(let[i,{elements:r}]of this.inline)r.push(this.addElement(t,mb(i,this.doc)));for(let[i,{elements:r}]of this.external)r.push(this.addElement(t,uh(i,this.doc)))}removeHost(t){this.hosts.delete(t)}addElement(t,i){return this.nonce&&i.setAttribute("nonce",this.nonce),t.appendChild(i)}static \u0275fac=function(i){return new(i||n)(ae(Vt),ae(Gd),ae(Wd,8),ae(Ys))};static \u0275prov=X({token:n,factory:n.\u0275fac})}return n})(),lh={svg:"http://www.w3.org/2000/svg",xhtml:"http://www.w3.org/1999/xhtml",xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/",math:"http://www.w3.org/1998/Math/MathML"},ph=/%COMP%/g;var fb="%COMP%",ZA=`_nghost-${fb}`,XA=`_ngcontent-${fb}`,e5=!0,t5=new ne("",{providedIn:"root",factory:()=>e5});function n5(n){return XA.replace(ph,n)}function i5(n){return ZA.replace(ph,n)}function gb(n,e){return e.map(t=>t.replace(ph,n))}var fh=(()=>{class n{eventManager;sharedStylesHost;appId;removeStylesOnCompDestroy;doc;ngZone;nonce;tracingService;rendererByCompId=new Map;defaultRenderer;platformIsServer;constructor(t,i,r,o,a,u,c=null,p=null){this.eventManager=t,this.sharedStylesHost=i,this.appId=r,this.removeStylesOnCompDestroy=o,this.doc=a,this.ngZone=u,this.nonce=c,this.tracingService=p,this.platformIsServer=!1,this.defaultRenderer=new pl(t,a,u,this.platformIsServer,this.tracingService)}createRenderer(t,i){if(!t||!i)return this.defaultRenderer;let r=this.getOrCreateRenderer(t,i);return r instanceof Dc?r.applyToHost(t):r instanceof fl&&r.applyStyles(),r}getOrCreateRenderer(t,i){let r=this.rendererByCompId,o=r.get(i.id);if(!o){let a=this.doc,u=this.ngZone,c=this.eventManager,p=this.sharedStylesHost,g=this.removeStylesOnCompDestroy,y=this.platformIsServer,v=this.tracingService;switch(i.encapsulation){case $i.Emulated:o=new Dc(c,p,i,this.appId,g,a,u,y,v);break;case $i.ShadowDom:return new dh(c,p,t,i,a,u,this.nonce,y,v);default:o=new fl(c,p,i,g,a,u,y,v);break}r.set(i.id,o)}return o}ngOnDestroy(){this.rendererByCompId.clear()}componentReplaced(t){this.rendererByCompId.delete(t)}static \u0275fac=function(i){return new(i||n)(ae(ch),ae(mh),ae(Gd),ae(t5),ae(Vt),ae(Dt),ae(Wd),ae(no,8))};static \u0275prov=X({token:n,factory:n.\u0275fac})}return n})(),pl=class{eventManager;doc;ngZone;platformIsServer;tracingService;data=Object.create(null);throwOnSyntheticProps=!0;constructor(e,t,i,r,o){this.eventManager=e,this.doc=t,this.ngZone=i,this.platformIsServer=r,this.tracingService=o}destroy(){}destroyNode=null;createElement(e,t){return t?this.doc.createElementNS(lh[t]||t,e):this.doc.createElement(e)}createComment(e){return this.doc.createComment(e)}createText(e){return this.doc.createTextNode(e)}appendChild(e,t){(pb(e)?e.content:e).appendChild(t)}insertBefore(e,t,i){e&&(pb(e)?e.content:e).insertBefore(t,i)}removeChild(e,t){t.remove()}selectRootElement(e,t){let i=typeof e=="string"?this.doc.querySelector(e):e;if(!i)throw new z(-5104,!1);return t||(i.textContent=""),i}parentNode(e){return e.parentNode}nextSibling(e){return e.nextSibling}setAttribute(e,t,i,r){if(r){t=r+":"+t;let o=lh[r];o?e.setAttributeNS(o,t,i):e.setAttribute(t,i)}else e.setAttribute(t,i)}removeAttribute(e,t,i){if(i){let r=lh[i];r?e.removeAttributeNS(r,t):e.removeAttribute(`${i}:${t}`)}else e.removeAttribute(t)}addClass(e,t){e.classList.add(t)}removeClass(e,t){e.classList.remove(t)}setStyle(e,t,i,r){r&(wi.DashCase|wi.Important)?e.style.setProperty(t,i,r&wi.Important?"important":""):e.style[t]=i}removeStyle(e,t,i){i&wi.DashCase?e.style.removeProperty(t):e.style[t]=""}setProperty(e,t,i){e!=null&&(e[t]=i)}setValue(e,t){e.nodeValue=t}listen(e,t,i,r){if(typeof e=="string"&&(e=Un().getGlobalEventTarget(this.doc,e),!e))throw new z(5102,!1);let o=this.decoratePreventDefault(i);return this.tracingService?.wrapEventListener&&(o=this.tracingService.wrapEventListener(e,t,o)),this.eventManager.addEventListener(e,t,o,r)}decoratePreventDefault(e){return t=>{if(t==="__ngUnwrap__")return e;e(t)===!1&&t.preventDefault()}}};function pb(n){return n.tagName==="TEMPLATE"&&n.content!==void 0}var dh=class extends pl{sharedStylesHost;hostEl;shadowRoot;constructor(e,t,i,r,o,a,u,c,p){super(e,o,a,c,p),this.sharedStylesHost=t,this.hostEl=i,this.shadowRoot=i.attachShadow({mode:"open"}),this.sharedStylesHost.addHost(this.shadowRoot);let g=r.styles;g=gb(r.id,g);for(let v of g){let C=document.createElement("style");u&&C.setAttribute("nonce",u),C.textContent=v,this.shadowRoot.appendChild(C)}let y=r.getExternalStyles?.();if(y)for(let v of y){let C=uh(v,o);u&&C.setAttribute("nonce",u),this.shadowRoot.appendChild(C)}}nodeOrShadowRoot(e){return e===this.hostEl?this.shadowRoot:e}appendChild(e,t){return super.appendChild(this.nodeOrShadowRoot(e),t)}insertBefore(e,t,i){return super.insertBefore(this.nodeOrShadowRoot(e),t,i)}removeChild(e,t){return super.removeChild(null,t)}parentNode(e){return this.nodeOrShadowRoot(super.parentNode(this.nodeOrShadowRoot(e)))}destroy(){this.sharedStylesHost.removeHost(this.shadowRoot)}},fl=class extends pl{sharedStylesHost;removeStylesOnCompDestroy;styles;styleUrls;constructor(e,t,i,r,o,a,u,c,p){super(e,o,a,u,c),this.sharedStylesHost=t,this.removeStylesOnCompDestroy=r;let g=i.styles;this.styles=p?gb(p,g):g,this.styleUrls=i.getExternalStyles?.(p)}applyStyles(){this.sharedStylesHost.addStyles(this.styles,this.styleUrls)}destroy(){this.removeStylesOnCompDestroy&&Zr.size===0&&this.sharedStylesHost.removeStyles(this.styles,this.styleUrls)}},Dc=class extends fl{contentAttr;hostAttr;constructor(e,t,i,r,o,a,u,c,p){let g=r+"-"+i.id;super(e,t,i,o,a,u,c,p,g),this.contentAttr=n5(g),this.hostAttr=i5(g)}applyToHost(e){this.applyStyles(),this.setAttribute(e,this.hostAttr,"")}createElement(e,t){let i=super.createElement(e,t);return super.setAttribute(i,this.contentAttr,""),i}};var Tc=class n extends rl{supportsDOMEvents=!0;static makeCurrent(){Yg(new n)}onAndCancel(e,t,i,r){return e.addEventListener(t,i,r),()=>{e.removeEventListener(t,i,r)}}dispatchEvent(e,t){e.dispatchEvent(t)}remove(e){e.remove()}createElement(e,t){return t=t||this.getDefaultDocument(),t.createElement(e)}createHtmlDocument(){return document.implementation.createHTMLDocument("fakeTitle")}getDefaultDocument(){return document}isElementNode(e){return e.nodeType===Node.ELEMENT_NODE}isShadowRoot(e){return e instanceof DocumentFragment}getGlobalEventTarget(e,t){return t==="window"?window:t==="document"?e:t==="body"?e.body:null}getBaseHref(e){let t=r5();return t==null?null:o5(t)}resetBaseElement(){gl=null}getUserAgent(){return window.navigator.userAgent}getCookie(e){return cl(document.cookie,e)}},gl=null;function r5(){return gl=gl||document.head.querySelector("base"),gl?gl.getAttribute("href"):null}function o5(n){return new URL(n,document.baseURI).pathname}var a5=(()=>{class n{build(){return new XMLHttpRequest}static \u0275fac=function(i){return new(i||n)};static \u0275prov=X({token:n,factory:n.\u0275fac})}return n})(),hb=["alt","control","meta","shift"],s5={"\b":"Backspace","	":"Tab","\x7F":"Delete","\x1B":"Escape",Del:"Delete",Esc:"Escape",Left:"ArrowLeft",Right:"ArrowRight",Up:"ArrowUp",Down:"ArrowDown",Menu:"ContextMenu",Scroll:"ScrollLock",Win:"OS"},l5={alt:n=>n.altKey,control:n=>n.ctrlKey,meta:n=>n.metaKey,shift:n=>n.shiftKey},yb=(()=>{class n extends ml{constructor(t){super(t)}supports(t){return n.parseEventName(t)!=null}addEventListener(t,i,r,o){let a=n.parseEventName(i),u=n.eventCallback(a.fullKey,r,this.manager.getZone());return this.manager.getZone().runOutsideAngular(()=>Un().onAndCancel(t,a.domEventName,u,o))}static parseEventName(t){let i=t.toLowerCase().split("."),r=i.shift();if(i.length===0||!(r==="keydown"||r==="keyup"))return null;let o=n._normalizeKey(i.pop()),a="",u=i.indexOf("code");if(u>-1&&(i.splice(u,1),a="code."),hb.forEach(p=>{let g=i.indexOf(p);g>-1&&(i.splice(g,1),a+=p+".")}),a+=o,i.length!=0||o.length===0)return null;let c={};return c.domEventName=r,c.fullKey=a,c}static matchEventFullKeyCode(t,i){let r=s5[t.key]||t.key,o="";return i.indexOf("code.")>-1&&(r=t.code,o="code."),r==null||!r?!1:(r=r.toLowerCase(),r===" "?r="space":r==="."&&(r="dot"),hb.forEach(a=>{if(a!==r){let u=l5[a];u(t)&&(o+=a+".")}}),o+=r,o===i)}static eventCallback(t,i,r){return o=>{n.matchEventFullKeyCode(o,t)&&r.runGuarded(()=>i(o))}}static _normalizeKey(t){return t==="esc"?"escape":t}static \u0275fac=function(i){return new(i||n)(ae(Vt))};static \u0275prov=X({token:n,factory:n.\u0275fac})}return n})();function gh(n,e,t){let i=O({rootComponent:n,platformRef:t?.platformRef},u5(e));return Rx(i)}function u5(n){return{appProviders:[...f5,...n?.providers??[]],platformProviders:p5}}function d5(){Tc.makeCurrent()}function c5(){return new Tn}function m5(){return Xf(document),document}var p5=[{provide:Ys,useValue:db},{provide:qd,useValue:d5,multi:!0},{provide:Vt,useFactory:m5}];var f5=[{provide:Ds,useValue:"root"},{provide:Tn,useFactory:c5},{provide:wc,useClass:Sc,multi:!0,deps:[Vt]},{provide:wc,useClass:yb,multi:!0,deps:[Vt]},fh,mh,ch,{provide:Xr,useExisting:fh},{provide:so,useClass:a5},[]];var da=class{},hl=class{},tn=class n{headers;normalizedNames=new Map;lazyInit;lazyUpdate=null;constructor(e){e?typeof e=="string"?this.lazyInit=()=>{this.headers=new Map,e.split(`
`).forEach(t=>{let i=t.indexOf(":");if(i>0){let r=t.slice(0,i),o=t.slice(i+1).trim();this.addHeaderEntry(r,o)}})}:typeof Headers<"u"&&e instanceof Headers?(this.headers=new Map,e.forEach((t,i)=>{this.addHeaderEntry(i,t)})):this.lazyInit=()=>{this.headers=new Map,Object.entries(e).forEach(([t,i])=>{this.setHeaderEntries(t,i)})}:this.headers=new Map}has(e){return this.init(),this.headers.has(e.toLowerCase())}get(e){this.init();let t=this.headers.get(e.toLowerCase());return t&&t.length>0?t[0]:null}keys(){return this.init(),Array.from(this.normalizedNames.values())}getAll(e){return this.init(),this.headers.get(e.toLowerCase())||null}append(e,t){return this.clone({name:e,value:t,op:"a"})}set(e,t){return this.clone({name:e,value:t,op:"s"})}delete(e,t){return this.clone({name:e,value:t,op:"d"})}maybeSetNormalizedName(e,t){this.normalizedNames.has(t)||this.normalizedNames.set(t,e)}init(){this.lazyInit&&(this.lazyInit instanceof n?this.copyFrom(this.lazyInit):this.lazyInit(),this.lazyInit=null,this.lazyUpdate&&(this.lazyUpdate.forEach(e=>this.applyUpdate(e)),this.lazyUpdate=null))}copyFrom(e){e.init(),Array.from(e.headers.keys()).forEach(t=>{this.headers.set(t,e.headers.get(t)),this.normalizedNames.set(t,e.normalizedNames.get(t))})}clone(e){let t=new n;return t.lazyInit=this.lazyInit&&this.lazyInit instanceof n?this.lazyInit:this,t.lazyUpdate=(this.lazyUpdate||[]).concat([e]),t}applyUpdate(e){let t=e.name.toLowerCase();switch(e.op){case"a":case"s":let i=e.value;if(typeof i=="string"&&(i=[i]),i.length===0)return;this.maybeSetNormalizedName(e.name,t);let r=(e.op==="a"?this.headers.get(t):void 0)||[];r.push(...i),this.headers.set(t,r);break;case"d":let o=e.value;if(!o)this.headers.delete(t),this.normalizedNames.delete(t);else{let a=this.headers.get(t);if(!a)return;a=a.filter(u=>o.indexOf(u)===-1),a.length===0?(this.headers.delete(t),this.normalizedNames.delete(t)):this.headers.set(t,a)}break}}addHeaderEntry(e,t){let i=e.toLowerCase();this.maybeSetNormalizedName(e,i),this.headers.has(i)?this.headers.get(i).push(t):this.headers.set(i,[t])}setHeaderEntries(e,t){let i=(Array.isArray(t)?t:[t]).map(o=>o.toString()),r=e.toLowerCase();this.headers.set(r,i),this.maybeSetNormalizedName(e,r)}forEach(e){this.init(),Array.from(this.normalizedNames.keys()).forEach(t=>e(this.normalizedNames.get(t),this.headers.get(t)))}};var Mc=class{encodeKey(e){return _b(e)}encodeValue(e){return _b(e)}decodeKey(e){return decodeURIComponent(e)}decodeValue(e){return decodeURIComponent(e)}};function g5(n,e){let t=new Map;return n.length>0&&n.replace(/^\?/,"").split("&").forEach(r=>{let o=r.indexOf("="),[a,u]=o==-1?[e.decodeKey(r),""]:[e.decodeKey(r.slice(0,o)),e.decodeValue(r.slice(o+1))],c=t.get(a)||[];c.push(u),t.set(a,c)}),t}var h5=/%(\d[a-f0-9])/gi,y5={40:"@","3A":":",24:"$","2C":",","3B":";","3D":"=","3F":"?","2F":"/"};function _b(n){return encodeURIComponent(n).replace(h5,(e,t)=>y5[t]??e)}function Ic(n){return`${n}`}var le=class n{map;encoder;updates=null;cloneFrom=null;constructor(e={}){if(this.encoder=e.encoder||new Mc,e.fromString){if(e.fromObject)throw new z(2805,!1);this.map=g5(e.fromString,this.encoder)}else e.fromObject?(this.map=new Map,Object.keys(e.fromObject).forEach(t=>{let i=e.fromObject[t],r=Array.isArray(i)?i.map(Ic):[Ic(i)];this.map.set(t,r)})):this.map=null}has(e){return this.init(),this.map.has(e)}get(e){this.init();let t=this.map.get(e);return t?t[0]:null}getAll(e){return this.init(),this.map.get(e)||null}keys(){return this.init(),Array.from(this.map.keys())}append(e,t){return this.clone({param:e,value:t,op:"a"})}appendAll(e){let t=[];return Object.keys(e).forEach(i=>{let r=e[i];Array.isArray(r)?r.forEach(o=>{t.push({param:i,value:o,op:"a"})}):t.push({param:i,value:r,op:"a"})}),this.clone(t)}set(e,t){return this.clone({param:e,value:t,op:"s"})}delete(e,t){return this.clone({param:e,value:t,op:"d"})}toString(){return this.init(),this.keys().map(e=>{let t=this.encoder.encodeKey(e);return this.map.get(e).map(i=>t+"="+this.encoder.encodeValue(i)).join("&")}).filter(e=>e!=="").join("&")}clone(e){let t=new n({encoder:this.encoder});return t.cloneFrom=this.cloneFrom||this,t.updates=(this.updates||[]).concat(e),t}init(){this.map===null&&(this.map=new Map),this.cloneFrom!==null&&(this.cloneFrom.init(),this.cloneFrom.keys().forEach(e=>this.map.set(e,this.cloneFrom.map.get(e))),this.updates.forEach(e=>{switch(e.op){case"a":case"s":let t=(e.op==="a"?this.map.get(e.param):void 0)||[];t.push(Ic(e.value)),this.map.set(e.param,t);break;case"d":if(e.value!==void 0){let i=this.map.get(e.param)||[],r=i.indexOf(Ic(e.value));r!==-1&&i.splice(r,1),i.length>0?this.map.set(e.param,i):this.map.delete(e.param)}else{this.map.delete(e.param);break}}}),this.cloneFrom=this.updates=null)}};var Ac=class{map=new Map;set(e,t){return this.map.set(e,t),this}get(e){return this.map.has(e)||this.map.set(e,e.defaultValue()),this.map.get(e)}delete(e){return this.map.delete(e),this}has(e){return this.map.has(e)}keys(){return this.map.keys()}};function _5(n){switch(n){case"DELETE":case"GET":case"HEAD":case"OPTIONS":case"JSONP":return!1;default:return!0}}function vb(n){return typeof ArrayBuffer<"u"&&n instanceof ArrayBuffer}function Cb(n){return typeof Blob<"u"&&n instanceof Blob}function xb(n){return typeof FormData<"u"&&n instanceof FormData}function v5(n){return typeof URLSearchParams<"u"&&n instanceof URLSearchParams}var bb="Content-Type",Eb="Accept",Db="X-Request-URL",wb="text/plain",Tb="application/json",C5=`${Tb}, ${wb}, */*`,ua=class n{url;body=null;headers;context;reportProgress=!1;withCredentials=!1;credentials;keepalive=!1;cache;priority;mode;redirect;referrer;integrity;responseType="json";method;params;urlWithParams;transferCache;timeout;constructor(e,t,i,r){this.url=t,this.method=e.toUpperCase();let o;if(_5(this.method)||r?(this.body=i!==void 0?i:null,o=r):o=i,o){if(this.reportProgress=!!o.reportProgress,this.withCredentials=!!o.withCredentials,this.keepalive=!!o.keepalive,o.responseType&&(this.responseType=o.responseType),o.headers&&(this.headers=o.headers),o.context&&(this.context=o.context),o.params&&(this.params=o.params),o.priority&&(this.priority=o.priority),o.cache&&(this.cache=o.cache),o.credentials&&(this.credentials=o.credentials),typeof o.timeout=="number"){if(o.timeout<1||!Number.isInteger(o.timeout))throw new z(2822,"");this.timeout=o.timeout}o.mode&&(this.mode=o.mode),o.redirect&&(this.redirect=o.redirect),o.integrity&&(this.integrity=o.integrity),o.referrer&&(this.referrer=o.referrer),this.transferCache=o.transferCache}if(this.headers??=new tn,this.context??=new Ac,!this.params)this.params=new le,this.urlWithParams=t;else{let a=this.params.toString();if(a.length===0)this.urlWithParams=t;else{let u=t.indexOf("?"),c=u===-1?"?":u<t.length-1?"&":"";this.urlWithParams=t+c+a}}}serializeBody(){return this.body===null?null:typeof this.body=="string"||vb(this.body)||Cb(this.body)||xb(this.body)||v5(this.body)?this.body:this.body instanceof le?this.body.toString():typeof this.body=="object"||typeof this.body=="boolean"||Array.isArray(this.body)?JSON.stringify(this.body):this.body.toString()}detectContentTypeHeader(){return this.body===null||xb(this.body)?null:Cb(this.body)?this.body.type||null:vb(this.body)?null:typeof this.body=="string"?wb:this.body instanceof le?"application/x-www-form-urlencoded;charset=UTF-8":typeof this.body=="object"||typeof this.body=="number"||typeof this.body=="boolean"?Tb:null}clone(e={}){let t=e.method||this.method,i=e.url||this.url,r=e.responseType||this.responseType,o=e.keepalive??this.keepalive,a=e.priority||this.priority,u=e.cache||this.cache,c=e.mode||this.mode,p=e.redirect||this.redirect,g=e.credentials||this.credentials,y=e.referrer||this.referrer,v=e.integrity||this.integrity,C=e.transferCache??this.transferCache,T=e.timeout??this.timeout,R=e.body!==void 0?e.body:this.body,F=e.withCredentials??this.withCredentials,P=e.reportProgress??this.reportProgress,H=e.headers||this.headers,q=e.params||this.params,Z=e.context??this.context;return e.setHeaders!==void 0&&(H=Object.keys(e.setHeaders).reduce((ie,me)=>ie.set(me,e.setHeaders[me]),H)),e.setParams&&(q=Object.keys(e.setParams).reduce((ie,me)=>ie.set(me,e.setParams[me]),q)),new n(t,i,R,{params:q,headers:H,context:Z,reportProgress:P,responseType:r,withCredentials:F,transferCache:C,keepalive:o,cache:u,priority:a,timeout:T,mode:c,redirect:p,credentials:g,referrer:y,integrity:v})}},lo=(function(n){return n[n.Sent=0]="Sent",n[n.UploadProgress=1]="UploadProgress",n[n.ResponseHeader=2]="ResponseHeader",n[n.DownloadProgress=3]="DownloadProgress",n[n.Response=4]="Response",n[n.User=5]="User",n})(lo||{}),ca=class{headers;status;statusText;url;ok;type;redirected;constructor(e,t=200,i="OK"){this.headers=e.headers||new tn,this.status=e.status!==void 0?e.status:t,this.statusText=e.statusText||i,this.url=e.url||null,this.redirected=e.redirected,this.ok=this.status>=200&&this.status<300}},Rc=class n extends ca{constructor(e={}){super(e)}type=lo.ResponseHeader;clone(e={}){return new n({headers:e.headers||this.headers,status:e.status!==void 0?e.status:this.status,statusText:e.statusText||this.statusText,url:e.url||this.url||void 0})}},yl=class n extends ca{body;constructor(e={}){super(e),this.body=e.body!==void 0?e.body:null}type=lo.Response;clone(e={}){return new n({body:e.body!==void 0?e.body:this.body,headers:e.headers||this.headers,status:e.status!==void 0?e.status:this.status,statusText:e.statusText||this.statusText,url:e.url||this.url||void 0,redirected:e.redirected??this.redirected})}},Er=class extends ca{name="HttpErrorResponse";message;error;ok=!1;constructor(e){super(e,0,"Unknown Error"),this.status>=200&&this.status<300?this.message=`Http failure during parsing for ${e.url||"(unknown url)"}`:this.message=`Http failure response for ${e.url||"(unknown url)"}: ${e.status} ${e.statusText}`,this.error=e.error||null}},x5=200,b5=204;function hh(n,e){return{body:e,headers:n.headers,context:n.context,observe:n.observe,params:n.params,reportProgress:n.reportProgress,responseType:n.responseType,withCredentials:n.withCredentials,credentials:n.credentials,transferCache:n.transferCache,timeout:n.timeout,keepalive:n.keepalive,priority:n.priority,cache:n.cache,mode:n.mode,redirect:n.redirect,integrity:n.integrity,referrer:n.referrer}}var Hn=(()=>{class n{handler;constructor(t){this.handler=t}request(t,i,r={}){let o;if(t instanceof ua)o=t;else{let c;r.headers instanceof tn?c=r.headers:c=new tn(r.headers);let p;r.params&&(r.params instanceof le?p=r.params:p=new le({fromObject:r.params})),o=new ua(t,i,r.body!==void 0?r.body:null,{headers:c,context:r.context,params:p,reportProgress:r.reportProgress,responseType:r.responseType||"json",withCredentials:r.withCredentials,transferCache:r.transferCache,keepalive:r.keepalive,priority:r.priority,cache:r.cache,mode:r.mode,redirect:r.redirect,credentials:r.credentials,referrer:r.referrer,integrity:r.integrity,timeout:r.timeout})}let a=ce(o).pipe(Fi(c=>this.handler.handle(c)));if(t instanceof ua||r.observe==="events")return a;let u=a.pipe(vt(c=>c instanceof yl));switch(r.observe||"body"){case"body":switch(o.responseType){case"arraybuffer":return u.pipe(ve(c=>{if(c.body!==null&&!(c.body instanceof ArrayBuffer))throw new z(2806,!1);return c.body}));case"blob":return u.pipe(ve(c=>{if(c.body!==null&&!(c.body instanceof Blob))throw new z(2807,!1);return c.body}));case"text":return u.pipe(ve(c=>{if(c.body!==null&&typeof c.body!="string")throw new z(2808,!1);return c.body}));case"json":default:return u.pipe(ve(c=>c.body))}case"response":return u;default:throw new z(2809,!1)}}delete(t,i={}){return this.request("DELETE",t,i)}get(t,i={}){return this.request("GET",t,i)}head(t,i={}){return this.request("HEAD",t,i)}jsonp(t,i){return this.request("JSONP",t,{params:new le().append(i,"JSONP_CALLBACK"),observe:"body",responseType:"json"})}options(t,i={}){return this.request("OPTIONS",t,i)}patch(t,i,r={}){return this.request("PATCH",t,hh(r,i))}post(t,i,r={}){return this.request("POST",t,hh(r,i))}put(t,i,r={}){return this.request("PUT",t,hh(r,i))}static \u0275fac=function(i){return new(i||n)(ae(da))};static \u0275prov=X({token:n,factory:n.\u0275fac})}return n})();var E5=new ne("");function Ib(n,e){return e(n)}function S5(n,e){return(t,i)=>e.intercept(t,{handle:r=>n(r,i)})}function D5(n,e,t){return(i,r)=>kt(t,()=>e(i,o=>n(o,r)))}var vl=new ne(""),_h=new ne(""),Mb=new ne(""),vh=new ne("",{providedIn:"root",factory:()=>!0});function w5(){let n=null;return(e,t)=>{n===null&&(n=(k(vl,{optional:!0})??[]).reduceRight(S5,Ib));let i=k(Xo);if(k(vh)){let o=i.add();return n(e,t).pipe(or(o))}else return n(e,t)}}var Nc=(()=>{class n extends da{backend;injector;chain=null;pendingTasks=k(Xo);contributeToStability=k(vh);constructor(t,i){super(),this.backend=t,this.injector=i}handle(t){if(this.chain===null){let i=Array.from(new Set([...this.injector.get(_h),...this.injector.get(Mb,[])]));this.chain=i.reduceRight((r,o)=>D5(r,o,this.injector),Ib)}if(this.contributeToStability){let i=this.pendingTasks.add();return this.chain(t,r=>this.backend.handle(r)).pipe(or(i))}else return this.chain(t,i=>this.backend.handle(i))}static \u0275fac=function(i){return new(i||n)(ae(hl),ae(At))};static \u0275prov=X({token:n,factory:n.\u0275fac})}return n})();var T5=/^\)\]\}',?\n/,I5=RegExp(`^${Db}:`,"m");function M5(n){return"responseURL"in n&&n.responseURL?n.responseURL:I5.test(n.getAllResponseHeaders())?n.getResponseHeader(Db):null}var yh=(()=>{class n{xhrFactory;constructor(t){this.xhrFactory=t}handle(t){if(t.method==="JSONP")throw new z(-2800,!1);let i=this.xhrFactory;return ce(null).pipe(Kt(()=>new Ae(o=>{let a=i.build();if(a.open(t.method,t.urlWithParams),t.withCredentials&&(a.withCredentials=!0),t.headers.forEach((F,P)=>a.setRequestHeader(F,P.join(","))),t.headers.has(Eb)||a.setRequestHeader(Eb,C5),!t.headers.has(bb)){let F=t.detectContentTypeHeader();F!==null&&a.setRequestHeader(bb,F)}if(t.timeout&&(a.timeout=t.timeout),t.responseType){let F=t.responseType.toLowerCase();a.responseType=F!=="json"?F:"text"}let u=t.serializeBody(),c=null,p=()=>{if(c!==null)return c;let F=a.statusText||"OK",P=new tn(a.getAllResponseHeaders()),H=M5(a)||t.url;return c=new Rc({headers:P,status:a.status,statusText:F,url:H}),c},g=()=>{let{headers:F,status:P,statusText:H,url:q}=p(),Z=null;P!==b5&&(Z=typeof a.response>"u"?a.responseText:a.response),P===0&&(P=Z?x5:0);let ie=P>=200&&P<300;if(t.responseType==="json"&&typeof Z=="string"){let me=Z;Z=Z.replace(T5,"");try{Z=Z!==""?JSON.parse(Z):null}catch(de){Z=me,ie&&(ie=!1,Z={error:de,text:Z})}}ie?(o.next(new yl({body:Z,headers:F,status:P,statusText:H,url:q||void 0})),o.complete()):o.error(new Er({error:Z,headers:F,status:P,statusText:H,url:q||void 0}))},y=F=>{let{url:P}=p(),H=new Er({error:F,status:a.status||0,statusText:a.statusText||"Unknown Error",url:P||void 0});o.error(H)},v=y;t.timeout&&(v=F=>{let{url:P}=p(),H=new Er({error:new DOMException("Request timed out","TimeoutError"),status:a.status||0,statusText:a.statusText||"Request timeout",url:P||void 0});o.error(H)});let C=!1,T=F=>{C||(o.next(p()),C=!0);let P={type:lo.DownloadProgress,loaded:F.loaded};F.lengthComputable&&(P.total=F.total),t.responseType==="text"&&a.responseText&&(P.partialText=a.responseText),o.next(P)},R=F=>{let P={type:lo.UploadProgress,loaded:F.loaded};F.lengthComputable&&(P.total=F.total),o.next(P)};return a.addEventListener("load",g),a.addEventListener("error",y),a.addEventListener("timeout",v),a.addEventListener("abort",y),t.reportProgress&&(a.addEventListener("progress",T),u!==null&&a.upload&&a.upload.addEventListener("progress",R)),a.send(u),o.next({type:lo.Sent}),()=>{a.removeEventListener("error",y),a.removeEventListener("abort",y),a.removeEventListener("load",g),a.removeEventListener("timeout",v),t.reportProgress&&(a.removeEventListener("progress",T),u!==null&&a.upload&&a.upload.removeEventListener("progress",R)),a.readyState!==a.DONE&&a.abort()}})))}static \u0275fac=function(i){return new(i||n)(ae(so))};static \u0275prov=X({token:n,factory:n.\u0275fac})}return n})(),Ab=new ne(""),A5="XSRF-TOKEN",R5=new ne("",{providedIn:"root",factory:()=>A5}),N5="X-XSRF-TOKEN",F5=new ne("",{providedIn:"root",factory:()=>N5}),_l=class{},P5=(()=>{class n{doc;cookieName;lastCookieString="";lastToken=null;parseCount=0;constructor(t,i){this.doc=t,this.cookieName=i}getToken(){let t=this.doc.cookie||"";return t!==this.lastCookieString&&(this.parseCount++,this.lastToken=cl(t,this.cookieName),this.lastCookieString=t),this.lastToken}static \u0275fac=function(i){return new(i||n)(ae(Vt),ae(R5))};static \u0275prov=X({token:n,factory:n.\u0275fac})}return n})(),k5=/^(?:https?:)?\/\//i;function V5(n,e){if(!k(Ab)||n.method==="GET"||n.method==="HEAD"||k5.test(n.url))return e(n);let t=k(_l).getToken(),i=k(F5);return t!=null&&!n.headers.has(i)&&(n=n.clone({headers:n.headers.set(i,t)})),e(n)}var Ch=(function(n){return n[n.Interceptors=0]="Interceptors",n[n.LegacyInterceptors=1]="LegacyInterceptors",n[n.CustomXsrfConfiguration=2]="CustomXsrfConfiguration",n[n.NoXsrfProtection=3]="NoXsrfProtection",n[n.JsonpSupport=4]="JsonpSupport",n[n.RequestsMadeViaParent=5]="RequestsMadeViaParent",n[n.Fetch=6]="Fetch",n})(Ch||{});function L5(n,e){return{\u0275kind:n,\u0275providers:e}}function xh(...n){let e=[Hn,yh,Nc,{provide:da,useExisting:Nc},{provide:hl,useFactory:()=>k(E5,{optional:!0})??k(yh)},{provide:_h,useValue:V5,multi:!0},{provide:Ab,useValue:!0},{provide:_l,useClass:P5}];for(let t of n)e.push(...t.\u0275providers);return $r(e)}var Sb=new ne("");function bh(){return L5(Ch.LegacyInterceptors,[{provide:Sb,useFactory:w5},{provide:_h,useExisting:Sb,multi:!0}])}var Rb=(()=>{class n{_doc;constructor(t){this._doc=t}getTitle(){return this._doc.title}setTitle(t){this._doc.title=t||""}static \u0275fac=function(i){return new(i||n)(ae(Vt))};static \u0275prov=X({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})();var xe="primary",Pl=Symbol("RouteTitle"),Ih=class{params;constructor(e){this.params=e||{}}has(e){return Object.prototype.hasOwnProperty.call(this.params,e)}get(e){if(this.has(e)){let t=this.params[e];return Array.isArray(t)?t[0]:t}return null}getAll(e){if(this.has(e)){let t=this.params[e];return Array.isArray(t)?t:[t]}return[]}get keys(){return Object.keys(this.params)}};function mo(n){return new Ih(n)}function Bb(n,e,t){let i=t.path.split("/");if(i.length>n.length||t.pathMatch==="full"&&(e.hasChildren()||i.length<n.length))return null;let r={};for(let o=0;o<i.length;o++){let a=i[o],u=n[o];if(a[0]===":")r[a.substring(1)]=u;else if(a!==u.path)return null}return{consumed:n.slice(0,i.length),posParams:r}}function B5(n,e){if(n.length!==e.length)return!1;for(let t=0;t<n.length;++t)if(!Mi(n[t],e[t]))return!1;return!0}function Mi(n,e){let t=n?Mh(n):void 0,i=e?Mh(e):void 0;if(!t||!i||t.length!=i.length)return!1;let r;for(let o=0;o<t.length;o++)if(r=t[o],!Ub(n[r],e[r]))return!1;return!0}function Mh(n){return[...Object.keys(n),...Object.getOwnPropertySymbols(n)]}function Ub(n,e){if(Array.isArray(n)&&Array.isArray(e)){if(n.length!==e.length)return!1;let t=[...n].sort(),i=[...e].sort();return t.every((r,o)=>i[o]===r)}else return n===e}function $b(n){return n.length>0?n[n.length-1]:null}function Zi(n){return e0(n)?n:Cr(n)?mt(Promise.resolve(n)):ce(n)}var U5={exact:Gb,subset:qb},Hb={exact:$5,subset:H5,ignored:()=>!0};function Nb(n,e,t){return U5[t.paths](n.root,e.root,t.matrixParams)&&Hb[t.queryParams](n.queryParams,e.queryParams)&&!(t.fragment==="exact"&&n.fragment!==e.fragment)}function $5(n,e){return Mi(n,e)}function Gb(n,e,t){if(!uo(n.segments,e.segments)||!kc(n.segments,e.segments,t)||n.numberOfChildren!==e.numberOfChildren)return!1;for(let i in e.children)if(!n.children[i]||!Gb(n.children[i],e.children[i],t))return!1;return!0}function H5(n,e){return Object.keys(e).length<=Object.keys(n).length&&Object.keys(e).every(t=>Ub(n[t],e[t]))}function qb(n,e,t){return Wb(n,e,e.segments,t)}function Wb(n,e,t,i){if(n.segments.length>t.length){let r=n.segments.slice(0,t.length);return!(!uo(r,t)||e.hasChildren()||!kc(r,t,i))}else if(n.segments.length===t.length){if(!uo(n.segments,t)||!kc(n.segments,t,i))return!1;for(let r in e.children)if(!n.children[r]||!qb(n.children[r],e.children[r],i))return!1;return!0}else{let r=t.slice(0,n.segments.length),o=t.slice(n.segments.length);return!uo(n.segments,r)||!kc(n.segments,r,i)||!n.children[xe]?!1:Wb(n.children[xe],e,o,i)}}function kc(n,e,t){return e.every((i,r)=>Hb[t](n[r].parameters,i.parameters))}var Ri=class{root;queryParams;fragment;_queryParamMap;constructor(e=new je([],{}),t={},i=null){this.root=e,this.queryParams=t,this.fragment=i}get queryParamMap(){return this._queryParamMap??=mo(this.queryParams),this._queryParamMap}toString(){return W5.serialize(this)}},je=class{segments;children;parent=null;constructor(e,t){this.segments=e,this.children=t,Object.values(t).forEach(i=>i.parent=this)}hasChildren(){return this.numberOfChildren>0}get numberOfChildren(){return Object.keys(this.children).length}toString(){return Vc(this)}},Sr=class{path;parameters;_parameterMap;constructor(e,t){this.path=e,this.parameters=t}get parameterMap(){return this._parameterMap??=mo(this.parameters),this._parameterMap}toString(){return zb(this)}};function G5(n,e){return uo(n,e)&&n.every((t,i)=>Mi(t.parameters,e[i].parameters))}function uo(n,e){return n.length!==e.length?!1:n.every((t,i)=>t.path===e[i].path)}function q5(n,e){let t=[];return Object.entries(n.children).forEach(([i,r])=>{i===xe&&(t=t.concat(e(r,i)))}),Object.entries(n.children).forEach(([i,r])=>{i!==xe&&(t=t.concat(e(r,i)))}),t}var kl=(()=>{class n{static \u0275fac=function(i){return new(i||n)};static \u0275prov=X({token:n,factory:()=>new po,providedIn:"root"})}return n})(),po=class{parse(e){let t=new Rh(e);return new Ri(t.parseRootSegment(),t.parseQueryParams(),t.parseFragment())}serialize(e){let t=`/${Cl(e.root,!0)}`,i=Y5(e.queryParams),r=typeof e.fragment=="string"?`#${j5(e.fragment)}`:"";return`${t}${i}${r}`}},W5=new po;function Vc(n){return n.segments.map(e=>zb(e)).join("/")}function Cl(n,e){if(!n.hasChildren())return Vc(n);if(e){let t=n.children[xe]?Cl(n.children[xe],!1):"",i=[];return Object.entries(n.children).forEach(([r,o])=>{r!==xe&&i.push(`${r}:${Cl(o,!1)}`)}),i.length>0?`${t}(${i.join("//")})`:t}else{let t=q5(n,(i,r)=>r===xe?[Cl(n.children[xe],!1)]:[`${r}:${Cl(i,!1)}`]);return Object.keys(n.children).length===1&&n.children[xe]!=null?`${Vc(n)}/${t[0]}`:`${Vc(n)}/(${t.join("//")})`}}function jb(n){return encodeURIComponent(n).replace(/%40/g,"@").replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",")}function Fc(n){return jb(n).replace(/%3B/gi,";")}function j5(n){return encodeURI(n)}function Ah(n){return jb(n).replace(/\(/g,"%28").replace(/\)/g,"%29").replace(/%26/gi,"&")}function Lc(n){return decodeURIComponent(n)}function Fb(n){return Lc(n.replace(/\+/g,"%20"))}function zb(n){return`${Ah(n.path)}${z5(n.parameters)}`}function z5(n){return Object.entries(n).map(([e,t])=>`;${Ah(e)}=${Ah(t)}`).join("")}function Y5(n){let e=Object.entries(n).map(([t,i])=>Array.isArray(i)?i.map(r=>`${Fc(t)}=${Fc(r)}`).join("&"):`${Fc(t)}=${Fc(i)}`).filter(t=>t);return e.length?`?${e.join("&")}`:""}var J5=/^[^\/()?;#]+/;function Sh(n){let e=n.match(J5);return e?e[0]:""}var K5=/^[^\/()?;=#]+/;function Q5(n){let e=n.match(K5);return e?e[0]:""}var Z5=/^[^=?&#]+/;function X5(n){let e=n.match(Z5);return e?e[0]:""}var e3=/^[^&#]+/;function t3(n){let e=n.match(e3);return e?e[0]:""}var Rh=class{url;remaining;constructor(e){this.url=e,this.remaining=e}parseRootSegment(){return this.consumeOptional("/"),this.remaining===""||this.peekStartsWith("?")||this.peekStartsWith("#")?new je([],{}):new je([],this.parseChildren())}parseQueryParams(){let e={};if(this.consumeOptional("?"))do this.parseQueryParam(e);while(this.consumeOptional("&"));return e}parseFragment(){return this.consumeOptional("#")?decodeURIComponent(this.remaining):null}parseChildren(){if(this.remaining==="")return{};this.consumeOptional("/");let e=[];for(this.peekStartsWith("(")||e.push(this.parseSegment());this.peekStartsWith("/")&&!this.peekStartsWith("//")&&!this.peekStartsWith("/(");)this.capture("/"),e.push(this.parseSegment());let t={};this.peekStartsWith("/(")&&(this.capture("/"),t=this.parseParens(!0));let i={};return this.peekStartsWith("(")&&(i=this.parseParens(!1)),(e.length>0||Object.keys(t).length>0)&&(i[xe]=new je(e,t)),i}parseSegment(){let e=Sh(this.remaining);if(e===""&&this.peekStartsWith(";"))throw new z(4009,!1);return this.capture(e),new Sr(Lc(e),this.parseMatrixParams())}parseMatrixParams(){let e={};for(;this.consumeOptional(";");)this.parseParam(e);return e}parseParam(e){let t=Q5(this.remaining);if(!t)return;this.capture(t);let i="";if(this.consumeOptional("=")){let r=Sh(this.remaining);r&&(i=r,this.capture(i))}e[Lc(t)]=Lc(i)}parseQueryParam(e){let t=X5(this.remaining);if(!t)return;this.capture(t);let i="";if(this.consumeOptional("=")){let a=t3(this.remaining);a&&(i=a,this.capture(i))}let r=Fb(t),o=Fb(i);if(e.hasOwnProperty(r)){let a=e[r];Array.isArray(a)||(a=[a],e[r]=a),a.push(o)}else e[r]=o}parseParens(e){let t={};for(this.capture("(");!this.consumeOptional(")")&&this.remaining.length>0;){let i=Sh(this.remaining),r=this.remaining[i.length];if(r!=="/"&&r!==")"&&r!==";")throw new z(4010,!1);let o;i.indexOf(":")>-1?(o=i.slice(0,i.indexOf(":")),this.capture(o),this.capture(":")):e&&(o=xe);let a=this.parseChildren();t[o??xe]=Object.keys(a).length===1&&a[xe]?a[xe]:new je([],a),this.consumeOptional("//")}return t}peekStartsWith(e){return this.remaining.startsWith(e)}consumeOptional(e){return this.peekStartsWith(e)?(this.remaining=this.remaining.substring(e.length),!0):!1}capture(e){if(!this.consumeOptional(e))throw new z(4011,!1)}};function Yb(n){return n.segments.length>0?new je([],{[xe]:n}):n}function Jb(n){let e={};for(let[i,r]of Object.entries(n.children)){let o=Jb(r);if(i===xe&&o.segments.length===0&&o.hasChildren())for(let[a,u]of Object.entries(o.children))e[a]=u;else(o.segments.length>0||o.hasChildren())&&(e[i]=o)}let t=new je(n.segments,e);return n3(t)}function n3(n){if(n.numberOfChildren===1&&n.children[xe]){let e=n.children[xe];return new je(n.segments.concat(e.segments),e.children)}return n}function Dr(n){return n instanceof Ri}function Kb(n,e,t=null,i=null){let r=Qb(n);return Zb(r,e,t,i)}function Qb(n){let e;function t(o){let a={};for(let c of o.children){let p=t(c);a[c.outlet]=p}let u=new je(o.url,a);return o===n&&(e=u),u}let i=t(n.root),r=Yb(i);return e??r}function Zb(n,e,t,i){let r=n;for(;r.parent;)r=r.parent;if(e.length===0)return Dh(r,r,r,t,i);let o=i3(e);if(o.toRoot())return Dh(r,r,new je([],{}),t,i);let a=r3(o,r,n),u=a.processChildren?bl(a.segmentGroup,a.index,o.commands):eE(a.segmentGroup,a.index,o.commands);return Dh(r,a.segmentGroup,u,t,i)}function Oc(n){return typeof n=="object"&&n!=null&&!n.outlets&&!n.segmentPath}function Dl(n){return typeof n=="object"&&n!=null&&n.outlets}function Dh(n,e,t,i,r){let o={};i&&Object.entries(i).forEach(([c,p])=>{o[c]=Array.isArray(p)?p.map(g=>`${g}`):`${p}`});let a;n===e?a=t:a=Xb(n,e,t);let u=Yb(Jb(a));return new Ri(u,o,r)}function Xb(n,e,t){let i={};return Object.entries(n.children).forEach(([r,o])=>{o===e?i[r]=t:i[r]=Xb(o,e,t)}),new je(n.segments,i)}var Bc=class{isAbsolute;numberOfDoubleDots;commands;constructor(e,t,i){if(this.isAbsolute=e,this.numberOfDoubleDots=t,this.commands=i,e&&i.length>0&&Oc(i[0]))throw new z(4003,!1);let r=i.find(Dl);if(r&&r!==$b(i))throw new z(4004,!1)}toRoot(){return this.isAbsolute&&this.commands.length===1&&this.commands[0]=="/"}};function i3(n){if(typeof n[0]=="string"&&n.length===1&&n[0]==="/")return new Bc(!0,0,n);let e=0,t=!1,i=n.reduce((r,o,a)=>{if(typeof o=="object"&&o!=null){if(o.outlets){let u={};return Object.entries(o.outlets).forEach(([c,p])=>{u[c]=typeof p=="string"?p.split("/"):p}),[...r,{outlets:u}]}if(o.segmentPath)return[...r,o.segmentPath]}return typeof o!="string"?[...r,o]:a===0?(o.split("/").forEach((u,c)=>{c==0&&u==="."||(c==0&&u===""?t=!0:u===".."?e++:u!=""&&r.push(u))}),r):[...r,o]},[]);return new Bc(t,e,i)}var fa=class{segmentGroup;processChildren;index;constructor(e,t,i){this.segmentGroup=e,this.processChildren=t,this.index=i}};function r3(n,e,t){if(n.isAbsolute)return new fa(e,!0,0);if(!t)return new fa(e,!1,NaN);if(t.parent===null)return new fa(t,!0,0);let i=Oc(n.commands[0])?0:1,r=t.segments.length-1+i;return o3(t,r,n.numberOfDoubleDots)}function o3(n,e,t){let i=n,r=e,o=t;for(;o>r;){if(o-=r,i=i.parent,!i)throw new z(4005,!1);r=i.segments.length}return new fa(i,!1,r-o)}function a3(n){return Dl(n[0])?n[0].outlets:{[xe]:n}}function eE(n,e,t){if(n??=new je([],{}),n.segments.length===0&&n.hasChildren())return bl(n,e,t);let i=s3(n,e,t),r=t.slice(i.commandIndex);if(i.match&&i.pathIndex<n.segments.length){let o=new je(n.segments.slice(0,i.pathIndex),{});return o.children[xe]=new je(n.segments.slice(i.pathIndex),n.children),bl(o,0,r)}else return i.match&&r.length===0?new je(n.segments,{}):i.match&&!n.hasChildren()?Nh(n,e,t):i.match?bl(n,0,r):Nh(n,e,t)}function bl(n,e,t){if(t.length===0)return new je(n.segments,{});{let i=a3(t),r={};if(Object.keys(i).some(o=>o!==xe)&&n.children[xe]&&n.numberOfChildren===1&&n.children[xe].segments.length===0){let o=bl(n.children[xe],e,t);return new je(n.segments,o.children)}return Object.entries(i).forEach(([o,a])=>{typeof a=="string"&&(a=[a]),a!==null&&(r[o]=eE(n.children[o],e,a))}),Object.entries(n.children).forEach(([o,a])=>{i[o]===void 0&&(r[o]=a)}),new je(n.segments,r)}}function s3(n,e,t){let i=0,r=e,o={match:!1,pathIndex:0,commandIndex:0};for(;r<n.segments.length;){if(i>=t.length)return o;let a=n.segments[r],u=t[i];if(Dl(u))break;let c=`${u}`,p=i<t.length-1?t[i+1]:null;if(r>0&&c===void 0)break;if(c&&p&&typeof p=="object"&&p.outlets===void 0){if(!kb(c,p,a))return o;i+=2}else{if(!kb(c,{},a))return o;i++}r++}return{match:!0,pathIndex:r,commandIndex:i}}function Nh(n,e,t){let i=n.segments.slice(0,e),r=0;for(;r<t.length;){let o=t[r];if(Dl(o)){let c=l3(o.outlets);return new je(i,c)}if(r===0&&Oc(t[0])){let c=n.segments[e];i.push(new Sr(c.path,Pb(t[0]))),r++;continue}let a=Dl(o)?o.outlets[xe]:`${o}`,u=r<t.length-1?t[r+1]:null;a&&u&&Oc(u)?(i.push(new Sr(a,Pb(u))),r+=2):(i.push(new Sr(a,{})),r++)}return new je(i,{})}function l3(n){let e={};return Object.entries(n).forEach(([t,i])=>{typeof i=="string"&&(i=[i]),i!==null&&(e[t]=Nh(new je([],{}),0,i))}),e}function Pb(n){let e={};return Object.entries(n).forEach(([t,i])=>e[t]=`${i}`),e}function kb(n,e,t){return n==t.path&&Mi(e,t.parameters)}var El="imperative",$t=(function(n){return n[n.NavigationStart=0]="NavigationStart",n[n.NavigationEnd=1]="NavigationEnd",n[n.NavigationCancel=2]="NavigationCancel",n[n.NavigationError=3]="NavigationError",n[n.RoutesRecognized=4]="RoutesRecognized",n[n.ResolveStart=5]="ResolveStart",n[n.ResolveEnd=6]="ResolveEnd",n[n.GuardsCheckStart=7]="GuardsCheckStart",n[n.GuardsCheckEnd=8]="GuardsCheckEnd",n[n.RouteConfigLoadStart=9]="RouteConfigLoadStart",n[n.RouteConfigLoadEnd=10]="RouteConfigLoadEnd",n[n.ChildActivationStart=11]="ChildActivationStart",n[n.ChildActivationEnd=12]="ChildActivationEnd",n[n.ActivationStart=13]="ActivationStart",n[n.ActivationEnd=14]="ActivationEnd",n[n.Scroll=15]="Scroll",n[n.NavigationSkipped=16]="NavigationSkipped",n})($t||{}),wn=class{id;url;constructor(e,t){this.id=e,this.url=t}},fo=class extends wn{type=$t.NavigationStart;navigationTrigger;restoredState;constructor(e,t,i="imperative",r=null){super(e,t),this.navigationTrigger=i,this.restoredState=r}toString(){return`NavigationStart(id: ${this.id}, url: '${this.url}')`}},cn=class extends wn{urlAfterRedirects;type=$t.NavigationEnd;constructor(e,t,i){super(e,t),this.urlAfterRedirects=i}toString(){return`NavigationEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}')`}},dn=(function(n){return n[n.Redirect=0]="Redirect",n[n.SupersededByNewNavigation=1]="SupersededByNewNavigation",n[n.NoDataFromResolver=2]="NoDataFromResolver",n[n.GuardRejected=3]="GuardRejected",n[n.Aborted=4]="Aborted",n})(dn||{}),wl=(function(n){return n[n.IgnoredSameUrlNavigation=0]="IgnoredSameUrlNavigation",n[n.IgnoredByUrlHandlingStrategy=1]="IgnoredByUrlHandlingStrategy",n})(wl||{}),Ai=class extends wn{reason;code;type=$t.NavigationCancel;constructor(e,t,i,r){super(e,t),this.reason=i,this.code=r}toString(){return`NavigationCancel(id: ${this.id}, url: '${this.url}')`}},Qi=class extends wn{reason;code;type=$t.NavigationSkipped;constructor(e,t,i,r){super(e,t),this.reason=i,this.code=r}},ha=class extends wn{error;target;type=$t.NavigationError;constructor(e,t,i,r){super(e,t),this.error=i,this.target=r}toString(){return`NavigationError(id: ${this.id}, url: '${this.url}', error: ${this.error})`}},Tl=class extends wn{urlAfterRedirects;state;type=$t.RoutesRecognized;constructor(e,t,i,r){super(e,t),this.urlAfterRedirects=i,this.state=r}toString(){return`RoutesRecognized(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}},Uc=class extends wn{urlAfterRedirects;state;type=$t.GuardsCheckStart;constructor(e,t,i,r){super(e,t),this.urlAfterRedirects=i,this.state=r}toString(){return`GuardsCheckStart(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}},$c=class extends wn{urlAfterRedirects;state;shouldActivate;type=$t.GuardsCheckEnd;constructor(e,t,i,r,o){super(e,t),this.urlAfterRedirects=i,this.state=r,this.shouldActivate=o}toString(){return`GuardsCheckEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state}, shouldActivate: ${this.shouldActivate})`}},Hc=class extends wn{urlAfterRedirects;state;type=$t.ResolveStart;constructor(e,t,i,r){super(e,t),this.urlAfterRedirects=i,this.state=r}toString(){return`ResolveStart(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}},Gc=class extends wn{urlAfterRedirects;state;type=$t.ResolveEnd;constructor(e,t,i,r){super(e,t),this.urlAfterRedirects=i,this.state=r}toString(){return`ResolveEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}},qc=class{route;type=$t.RouteConfigLoadStart;constructor(e){this.route=e}toString(){return`RouteConfigLoadStart(path: ${this.route.path})`}},Wc=class{route;type=$t.RouteConfigLoadEnd;constructor(e){this.route=e}toString(){return`RouteConfigLoadEnd(path: ${this.route.path})`}},jc=class{snapshot;type=$t.ChildActivationStart;constructor(e){this.snapshot=e}toString(){return`ChildActivationStart(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}},zc=class{snapshot;type=$t.ChildActivationEnd;constructor(e){this.snapshot=e}toString(){return`ChildActivationEnd(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}},Yc=class{snapshot;type=$t.ActivationStart;constructor(e){this.snapshot=e}toString(){return`ActivationStart(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}},Jc=class{snapshot;type=$t.ActivationEnd;constructor(e){this.snapshot=e}toString(){return`ActivationEnd(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}};var Il=class{},ya=class{url;navigationBehaviorOptions;constructor(e,t){this.url=e,this.navigationBehaviorOptions=t}};function u3(n){return!(n instanceof Il)&&!(n instanceof ya)}function d3(n,e){return n.providers&&!n._injector&&(n._injector=el(n.providers,e,`Route: ${n.path}`)),n._injector??e}function ci(n){return n.outlet||xe}function c3(n,e){let t=n.filter(i=>ci(i)===e);return t.push(...n.filter(i=>ci(i)!==e)),t}function Ca(n){if(!n)return null;if(n.routeConfig?._injector)return n.routeConfig._injector;for(let e=n.parent;e;e=e.parent){let t=e.routeConfig;if(t?._loadedInjector)return t._loadedInjector;if(t?._injector)return t._injector}return null}var Kc=class{rootInjector;outlet=null;route=null;children;attachRef=null;get injector(){return Ca(this.route?.snapshot)??this.rootInjector}constructor(e){this.rootInjector=e,this.children=new xa(this.rootInjector)}},xa=(()=>{class n{rootInjector;contexts=new Map;constructor(t){this.rootInjector=t}onChildOutletCreated(t,i){let r=this.getOrCreateContext(t);r.outlet=i,this.contexts.set(t,r)}onChildOutletDestroyed(t){let i=this.getContext(t);i&&(i.outlet=null,i.attachRef=null)}onOutletDeactivated(){let t=this.contexts;return this.contexts=new Map,t}onOutletReAttached(t){this.contexts=t}getOrCreateContext(t){let i=this.getContext(t);return i||(i=new Kc(this.rootInjector),this.contexts.set(t,i)),i}getContext(t){return this.contexts.get(t)||null}static \u0275fac=function(i){return new(i||n)(ae(At))};static \u0275prov=X({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})(),Qc=class{_root;constructor(e){this._root=e}get root(){return this._root.value}parent(e){let t=this.pathFromRoot(e);return t.length>1?t[t.length-2]:null}children(e){let t=Fh(e,this._root);return t?t.children.map(i=>i.value):[]}firstChild(e){let t=Fh(e,this._root);return t&&t.children.length>0?t.children[0].value:null}siblings(e){let t=Ph(e,this._root);return t.length<2?[]:t[t.length-2].children.map(r=>r.value).filter(r=>r!==e)}pathFromRoot(e){return Ph(e,this._root).map(t=>t.value)}};function Fh(n,e){if(n===e.value)return e;for(let t of e.children){let i=Fh(n,t);if(i)return i}return null}function Ph(n,e){if(n===e.value)return[e];for(let t of e.children){let i=Ph(n,t);if(i.length)return i.unshift(e),i}return[]}var Dn=class{value;children;constructor(e,t){this.value=e,this.children=t}toString(){return`TreeNode(${this.value})`}};function pa(n){let e={};return n&&n.children.forEach(t=>e[t.value.outlet]=t),e}var Ml=class extends Qc{snapshot;constructor(e,t){super(e),this.snapshot=t,Hh(this,e)}toString(){return this.snapshot.toString()}};function tE(n){let e=m3(n),t=new Ht([new Sr("",{})]),i=new Ht({}),r=new Ht({}),o=new Ht({}),a=new Ht(""),u=new mn(t,i,o,a,r,xe,n,e.root);return u.snapshot=e.root,new Ml(new Dn(u,[]),e)}function m3(n){let e={},t={},i={},o=new co([],e,i,"",t,xe,n,null,{});return new Al("",new Dn(o,[]))}var mn=class{urlSubject;paramsSubject;queryParamsSubject;fragmentSubject;dataSubject;outlet;component;snapshot;_futureSnapshot;_routerState;_paramMap;_queryParamMap;title;url;params;queryParams;fragment;data;constructor(e,t,i,r,o,a,u,c){this.urlSubject=e,this.paramsSubject=t,this.queryParamsSubject=i,this.fragmentSubject=r,this.dataSubject=o,this.outlet=a,this.component=u,this._futureSnapshot=c,this.title=this.dataSubject?.pipe(ve(p=>p[Pl]))??ce(void 0),this.url=e,this.params=t,this.queryParams=i,this.fragment=r,this.data=o}get routeConfig(){return this._futureSnapshot.routeConfig}get root(){return this._routerState.root}get parent(){return this._routerState.parent(this)}get firstChild(){return this._routerState.firstChild(this)}get children(){return this._routerState.children(this)}get pathFromRoot(){return this._routerState.pathFromRoot(this)}get paramMap(){return this._paramMap??=this.params.pipe(ve(e=>mo(e))),this._paramMap}get queryParamMap(){return this._queryParamMap??=this.queryParams.pipe(ve(e=>mo(e))),this._queryParamMap}toString(){return this.snapshot?this.snapshot.toString():`Future(${this._futureSnapshot})`}};function Zc(n,e,t="emptyOnly"){let i,{routeConfig:r}=n;return e!==null&&(t==="always"||r?.path===""||!e.component&&!e.routeConfig?.loadComponent)?i={params:O(O({},e.params),n.params),data:O(O({},e.data),n.data),resolve:O(O(O(O({},n.data),e.data),r?.data),n._resolvedData)}:i={params:O({},n.params),data:O({},n.data),resolve:O(O({},n.data),n._resolvedData??{})},r&&iE(r)&&(i.resolve[Pl]=r.title),i}var co=class{url;params;queryParams;fragment;data;outlet;component;routeConfig;_resolve;_resolvedData;_routerState;_paramMap;_queryParamMap;get title(){return this.data?.[Pl]}constructor(e,t,i,r,o,a,u,c,p){this.url=e,this.params=t,this.queryParams=i,this.fragment=r,this.data=o,this.outlet=a,this.component=u,this.routeConfig=c,this._resolve=p}get root(){return this._routerState.root}get parent(){return this._routerState.parent(this)}get firstChild(){return this._routerState.firstChild(this)}get children(){return this._routerState.children(this)}get pathFromRoot(){return this._routerState.pathFromRoot(this)}get paramMap(){return this._paramMap??=mo(this.params),this._paramMap}get queryParamMap(){return this._queryParamMap??=mo(this.queryParams),this._queryParamMap}toString(){let e=this.url.map(i=>i.toString()).join("/"),t=this.routeConfig?this.routeConfig.path:"";return`Route(url:'${e}', path:'${t}')`}},Al=class extends Qc{url;constructor(e,t){super(t),this.url=e,Hh(this,t)}toString(){return nE(this._root)}};function Hh(n,e){e.value._routerState=n,e.children.forEach(t=>Hh(n,t))}function nE(n){let e=n.children.length>0?` { ${n.children.map(nE).join(", ")} } `:"";return`${n.value}${e}`}function wh(n){if(n.snapshot){let e=n.snapshot,t=n._futureSnapshot;n.snapshot=t,Mi(e.queryParams,t.queryParams)||n.queryParamsSubject.next(t.queryParams),e.fragment!==t.fragment&&n.fragmentSubject.next(t.fragment),Mi(e.params,t.params)||n.paramsSubject.next(t.params),B5(e.url,t.url)||n.urlSubject.next(t.url),Mi(e.data,t.data)||n.dataSubject.next(t.data)}else n.snapshot=n._futureSnapshot,n.dataSubject.next(n._futureSnapshot.data)}function kh(n,e){let t=Mi(n.params,e.params)&&G5(n.url,e.url),i=!n.parent!=!e.parent;return t&&!i&&(!n.parent||kh(n.parent,e.parent))}function iE(n){return typeof n.title=="string"||n.title===null}var rE=new ne(""),Vl=(()=>{class n{activated=null;get activatedComponentRef(){return this.activated}_activatedRoute=null;name=xe;activateEvents=new et;deactivateEvents=new et;attachEvents=new et;detachEvents=new et;routerOutletData=cc();parentContexts=k(xa);location=k(ji);changeDetector=k(br);inputBinder=k(nm,{optional:!0});supportsBindingToComponentInputs=!0;ngOnChanges(t){if(t.name){let{firstChange:i,previousValue:r}=t.name;if(i)return;this.isTrackedInParentContexts(r)&&(this.deactivate(),this.parentContexts.onChildOutletDestroyed(r)),this.initializeOutletWithName()}}ngOnDestroy(){this.isTrackedInParentContexts(this.name)&&this.parentContexts.onChildOutletDestroyed(this.name),this.inputBinder?.unsubscribeFromRouteData(this)}isTrackedInParentContexts(t){return this.parentContexts.getContext(t)?.outlet===this}ngOnInit(){this.initializeOutletWithName()}initializeOutletWithName(){if(this.parentContexts.onChildOutletCreated(this.name,this),this.activated)return;let t=this.parentContexts.getContext(this.name);t?.route&&(t.attachRef?this.attach(t.attachRef,t.route):this.activateWith(t.route,t.injector))}get isActivated(){return!!this.activated}get component(){if(!this.activated)throw new z(4012,!1);return this.activated.instance}get activatedRoute(){if(!this.activated)throw new z(4012,!1);return this._activatedRoute}get activatedRouteData(){return this._activatedRoute?this._activatedRoute.snapshot.data:{}}detach(){if(!this.activated)throw new z(4012,!1);this.location.detach();let t=this.activated;return this.activated=null,this._activatedRoute=null,this.detachEvents.emit(t.instance),t}attach(t,i){this.activated=t,this._activatedRoute=i,this.location.insert(t.hostView),this.inputBinder?.bindActivatedRouteToOutletComponent(this),this.attachEvents.emit(t.instance)}deactivate(){if(this.activated){let t=this.component;this.activated.destroy(),this.activated=null,this._activatedRoute=null,this.deactivateEvents.emit(t)}}activateWith(t,i){if(this.isActivated)throw new z(4013,!1);this._activatedRoute=t;let r=this.location,a=t.snapshot.component,u=this.parentContexts.getOrCreateContext(this.name).children,c=new Vh(t,u,r.injector,this.routerOutletData);this.activated=r.createComponent(a,{index:r.length,injector:c,environmentInjector:i}),this.changeDetector.markForCheck(),this.inputBinder?.bindActivatedRouteToOutletComponent(this),this.activateEvents.emit(this.activated.instance)}static \u0275fac=function(i){return new(i||n)};static \u0275dir=Ne({type:n,selectors:[["router-outlet"]],inputs:{name:"name",routerOutletData:[1,"routerOutletData"]},outputs:{activateEvents:"activate",deactivateEvents:"deactivate",attachEvents:"attach",detachEvents:"detach"},exportAs:["outlet"],features:[Ln]})}return n})(),Vh=class{route;childContexts;parent;outletData;constructor(e,t,i,r){this.route=e,this.childContexts=t,this.parent=i,this.outletData=r}get(e,t){return e===mn?this.route:e===xa?this.childContexts:e===rE?this.outletData:this.parent.get(e,t)}},nm=new ne("");var Gh=(()=>{class n{static \u0275fac=function(i){return new(i||n)};static \u0275cmp=re({type:n,selectors:[["ng-component"]],exportAs:["emptyRouterOutlet"],decls:1,vars:0,template:function(i,r){i&1&&x(0,"router-outlet")},dependencies:[Vl],encapsulation:2})}return n})();function qh(n){let e=n.children&&n.children.map(qh),t=e?G(O({},n),{children:e}):O({},n);return!t.component&&!t.loadComponent&&(e||t.loadChildren)&&t.outlet&&t.outlet!==xe&&(t.component=Gh),t}function p3(n,e,t){let i=Rl(n,e._root,t?t._root:void 0);return new Ml(i,e)}function Rl(n,e,t){if(t&&n.shouldReuseRoute(e.value,t.value.snapshot)){let i=t.value;i._futureSnapshot=e.value;let r=f3(n,e,t);return new Dn(i,r)}else{if(n.shouldAttach(e.value)){let o=n.retrieve(e.value);if(o!==null){let a=o.route;return a.value._futureSnapshot=e.value,a.children=e.children.map(u=>Rl(n,u)),a}}let i=g3(e.value),r=e.children.map(o=>Rl(n,o));return new Dn(i,r)}}function f3(n,e,t){return e.children.map(i=>{for(let r of t.children)if(n.shouldReuseRoute(i.value,r.value.snapshot))return Rl(n,i,r);return Rl(n,i)})}function g3(n){return new mn(new Ht(n.url),new Ht(n.params),new Ht(n.queryParams),new Ht(n.fragment),new Ht(n.data),n.outlet,n.component,n)}var _a=class{redirectTo;navigationBehaviorOptions;constructor(e,t){this.redirectTo=e,this.navigationBehaviorOptions=t}},oE="ngNavigationCancelingError";function Xc(n,e){let{redirectTo:t,navigationBehaviorOptions:i}=Dr(e)?{redirectTo:e,navigationBehaviorOptions:void 0}:e,r=aE(!1,dn.Redirect);return r.url=t,r.navigationBehaviorOptions=i,r}function aE(n,e){let t=new Error(`NavigationCancelingError: ${n||""}`);return t[oE]=!0,t.cancellationCode=e,t}function h3(n){return sE(n)&&Dr(n.url)}function sE(n){return!!n&&n[oE]}var y3=(n,e,t,i)=>ve(r=>(new Lh(e,r.targetRouterState,r.currentRouterState,t,i).activate(n),r)),Lh=class{routeReuseStrategy;futureState;currState;forwardEvent;inputBindingEnabled;constructor(e,t,i,r,o){this.routeReuseStrategy=e,this.futureState=t,this.currState=i,this.forwardEvent=r,this.inputBindingEnabled=o}activate(e){let t=this.futureState._root,i=this.currState?this.currState._root:null;this.deactivateChildRoutes(t,i,e),wh(this.futureState.root),this.activateChildRoutes(t,i,e)}deactivateChildRoutes(e,t,i){let r=pa(t);e.children.forEach(o=>{let a=o.value.outlet;this.deactivateRoutes(o,r[a],i),delete r[a]}),Object.values(r).forEach(o=>{this.deactivateRouteAndItsChildren(o,i)})}deactivateRoutes(e,t,i){let r=e.value,o=t?t.value:null;if(r===o)if(r.component){let a=i.getContext(r.outlet);a&&this.deactivateChildRoutes(e,t,a.children)}else this.deactivateChildRoutes(e,t,i);else o&&this.deactivateRouteAndItsChildren(t,i)}deactivateRouteAndItsChildren(e,t){e.value.component&&this.routeReuseStrategy.shouldDetach(e.value.snapshot)?this.detachAndStoreRouteSubtree(e,t):this.deactivateRouteAndOutlet(e,t)}detachAndStoreRouteSubtree(e,t){let i=t.getContext(e.value.outlet),r=i&&e.value.component?i.children:t,o=pa(e);for(let a of Object.values(o))this.deactivateRouteAndItsChildren(a,r);if(i&&i.outlet){let a=i.outlet.detach(),u=i.children.onOutletDeactivated();this.routeReuseStrategy.store(e.value.snapshot,{componentRef:a,route:e,contexts:u})}}deactivateRouteAndOutlet(e,t){let i=t.getContext(e.value.outlet),r=i&&e.value.component?i.children:t,o=pa(e);for(let a of Object.values(o))this.deactivateRouteAndItsChildren(a,r);i&&(i.outlet&&(i.outlet.deactivate(),i.children.onOutletDeactivated()),i.attachRef=null,i.route=null)}activateChildRoutes(e,t,i){let r=pa(t);e.children.forEach(o=>{this.activateRoutes(o,r[o.value.outlet],i),this.forwardEvent(new Jc(o.value.snapshot))}),e.children.length&&this.forwardEvent(new zc(e.value.snapshot))}activateRoutes(e,t,i){let r=e.value,o=t?t.value:null;if(wh(r),r===o)if(r.component){let a=i.getOrCreateContext(r.outlet);this.activateChildRoutes(e,t,a.children)}else this.activateChildRoutes(e,t,i);else if(r.component){let a=i.getOrCreateContext(r.outlet);if(this.routeReuseStrategy.shouldAttach(r.snapshot)){let u=this.routeReuseStrategy.retrieve(r.snapshot);this.routeReuseStrategy.store(r.snapshot,null),a.children.onOutletReAttached(u.contexts),a.attachRef=u.componentRef,a.route=u.route.value,a.outlet&&a.outlet.attach(u.componentRef,u.route.value),wh(u.route.value),this.activateChildRoutes(e,null,a.children)}else a.attachRef=null,a.route=r,a.outlet&&a.outlet.activateWith(r,a.injector),this.activateChildRoutes(e,null,a.children)}else this.activateChildRoutes(e,null,i)}},em=class{path;route;constructor(e){this.path=e,this.route=this.path[this.path.length-1]}},ga=class{component;route;constructor(e,t){this.component=e,this.route=t}};function _3(n,e,t){let i=n._root,r=e?e._root:null;return xl(i,r,t,[i.value])}function v3(n){let e=n.routeConfig?n.routeConfig.canActivateChild:null;return!e||e.length===0?null:{node:n,guards:e}}function ba(n,e){let t=Symbol(),i=e.get(n,t);return i===t?typeof n=="function"&&!h0(n)?n:e.get(n):i}function xl(n,e,t,i,r={canDeactivateChecks:[],canActivateChecks:[]}){let o=pa(e);return n.children.forEach(a=>{C3(a,o[a.value.outlet],t,i.concat([a.value]),r),delete o[a.value.outlet]}),Object.entries(o).forEach(([a,u])=>Sl(u,t.getContext(a),r)),r}function C3(n,e,t,i,r={canDeactivateChecks:[],canActivateChecks:[]}){let o=n.value,a=e?e.value:null,u=t?t.getContext(n.value.outlet):null;if(a&&o.routeConfig===a.routeConfig){let c=x3(a,o,o.routeConfig.runGuardsAndResolvers);c?r.canActivateChecks.push(new em(i)):(o.data=a.data,o._resolvedData=a._resolvedData),o.component?xl(n,e,u?u.children:null,i,r):xl(n,e,t,i,r),c&&u&&u.outlet&&u.outlet.isActivated&&r.canDeactivateChecks.push(new ga(u.outlet.component,a))}else a&&Sl(e,u,r),r.canActivateChecks.push(new em(i)),o.component?xl(n,null,u?u.children:null,i,r):xl(n,null,t,i,r);return r}function x3(n,e,t){if(typeof t=="function")return t(n,e);switch(t){case"pathParamsChange":return!uo(n.url,e.url);case"pathParamsOrQueryParamsChange":return!uo(n.url,e.url)||!Mi(n.queryParams,e.queryParams);case"always":return!0;case"paramsOrQueryParamsChange":return!kh(n,e)||!Mi(n.queryParams,e.queryParams);case"paramsChange":default:return!kh(n,e)}}function Sl(n,e,t){let i=pa(n),r=n.value;Object.entries(i).forEach(([o,a])=>{r.component?e?Sl(a,e.children.getContext(o),t):Sl(a,null,t):Sl(a,e,t)}),r.component?e&&e.outlet&&e.outlet.isActivated?t.canDeactivateChecks.push(new ga(e.outlet.component,r)):t.canDeactivateChecks.push(new ga(null,r)):t.canDeactivateChecks.push(new ga(null,r))}function Ll(n){return typeof n=="function"}function b3(n){return typeof n=="boolean"}function E3(n){return n&&Ll(n.canLoad)}function S3(n){return n&&Ll(n.canActivate)}function D3(n){return n&&Ll(n.canActivateChild)}function w3(n){return n&&Ll(n.canDeactivate)}function T3(n){return n&&Ll(n.canMatch)}function lE(n){return n instanceof Kn||n?.name==="EmptyError"}var Pc=Symbol("INITIAL_VALUE");function va(){return Kt(n=>$u(n.map(e=>e.pipe(Pi(1),r0(Pc)))).pipe(ve(e=>{for(let t of e)if(t!==!0){if(t===Pc)return Pc;if(t===!1||I3(t))return t}return!0}),vt(e=>e!==Pc),Pi(1)))}function I3(n){return Dr(n)||n instanceof _a}function M3(n,e){return Mt(t=>{let{targetSnapshot:i,currentSnapshot:r,guards:{canActivateChecks:o,canDeactivateChecks:a}}=t;return a.length===0&&o.length===0?ce(G(O({},t),{guardsResult:!0})):A3(a,i,r,n).pipe(Mt(u=>u&&b3(u)?R3(i,o,n,e):ce(u)),ve(u=>G(O({},t),{guardsResult:u})))})}function A3(n,e,t,i){return mt(n).pipe(Mt(r=>V3(r.component,r.route,t,e,i)),ki(r=>r!==!0,!0))}function R3(n,e,t,i){return mt(e).pipe(Fi(r=>$o(F3(r.route.parent,i),N3(r.route,i),k3(n,r.path,t),P3(n,r.route,t))),ki(r=>r!==!0,!0))}function N3(n,e){return n!==null&&e&&e(new Yc(n)),ce(!0)}function F3(n,e){return n!==null&&e&&e(new jc(n)),ce(!0)}function P3(n,e,t){let i=e.routeConfig?e.routeConfig.canActivate:null;if(!i||i.length===0)return ce(!0);let r=i.map(o=>_s(()=>{let a=Ca(e)??t,u=ba(o,a),c=S3(u)?u.canActivate(e,n):kt(a,()=>u(e,n));return Zi(c).pipe(ki())}));return ce(r).pipe(va())}function k3(n,e,t){let i=e[e.length-1],o=e.slice(0,e.length-1).reverse().map(a=>v3(a)).filter(a=>a!==null).map(a=>_s(()=>{let u=a.guards.map(c=>{let p=Ca(a.node)??t,g=ba(c,p),y=D3(g)?g.canActivateChild(i,n):kt(p,()=>g(i,n));return Zi(y).pipe(ki())});return ce(u).pipe(va())}));return ce(o).pipe(va())}function V3(n,e,t,i,r){let o=e&&e.routeConfig?e.routeConfig.canDeactivate:null;if(!o||o.length===0)return ce(!0);let a=o.map(u=>{let c=Ca(e)??r,p=ba(u,c),g=w3(p)?p.canDeactivate(n,e,t,i):kt(c,()=>p(n,e,t,i));return Zi(g).pipe(ki())});return ce(a).pipe(va())}function L3(n,e,t,i){let r=e.canLoad;if(r===void 0||r.length===0)return ce(!0);let o=r.map(a=>{let u=ba(a,n),c=E3(u)?u.canLoad(e,t):kt(n,()=>u(e,t));return Zi(c)});return ce(o).pipe(va(),uE(i))}function uE(n){return Kp(lt(e=>{if(typeof e!="boolean")throw Xc(n,e)}),ve(e=>e===!0))}function O3(n,e,t,i){let r=e.canMatch;if(!r||r.length===0)return ce(!0);let o=r.map(a=>{let u=ba(a,n),c=T3(u)?u.canMatch(e,t):kt(n,()=>u(e,t));return Zi(c)});return ce(o).pipe(va(),uE(i))}var Nl=class{segmentGroup;constructor(e){this.segmentGroup=e||null}},Fl=class extends Error{urlTree;constructor(e){super(),this.urlTree=e}};function ma(n){return Jn(new Nl(n))}function B3(n){return Jn(new z(4e3,!1))}function U3(n){return Jn(aE(!1,dn.GuardRejected))}var Oh=class{urlSerializer;urlTree;constructor(e,t){this.urlSerializer=e,this.urlTree=t}lineralizeSegments(e,t){let i=[],r=t.root;for(;;){if(i=i.concat(r.segments),r.numberOfChildren===0)return ce(i);if(r.numberOfChildren>1||!r.children[xe])return B3(`${e.redirectTo}`);r=r.children[xe]}}applyRedirectCommands(e,t,i,r,o){return $3(t,r,o).pipe(ve(a=>{if(a instanceof Ri)throw new Fl(a);let u=this.applyRedirectCreateUrlTree(a,this.urlSerializer.parse(a),e,i);if(a[0]==="/")throw new Fl(u);return u}))}applyRedirectCreateUrlTree(e,t,i,r){let o=this.createSegmentGroup(e,t.root,i,r);return new Ri(o,this.createQueryParams(t.queryParams,this.urlTree.queryParams),t.fragment)}createQueryParams(e,t){let i={};return Object.entries(e).forEach(([r,o])=>{if(typeof o=="string"&&o[0]===":"){let u=o.substring(1);i[r]=t[u]}else i[r]=o}),i}createSegmentGroup(e,t,i,r){let o=this.createSegments(e,t.segments,i,r),a={};return Object.entries(t.children).forEach(([u,c])=>{a[u]=this.createSegmentGroup(e,c,i,r)}),new je(o,a)}createSegments(e,t,i,r){return t.map(o=>o.path[0]===":"?this.findPosParam(e,o,r):this.findOrReturn(o,i))}findPosParam(e,t,i){let r=i[t.path.substring(1)];if(!r)throw new z(4001,!1);return r}findOrReturn(e,t){let i=0;for(let r of t){if(r.path===e.path)return t.splice(i),r;i++}return e}};function $3(n,e,t){if(typeof n=="string")return ce(n);let i=n,{queryParams:r,fragment:o,routeConfig:a,url:u,outlet:c,params:p,data:g,title:y}=e;return Zi(kt(t,()=>i({params:p,data:g,queryParams:r,fragment:o,routeConfig:a,url:u,outlet:c,title:y})))}var Bh={matched:!1,consumedSegments:[],remainingSegments:[],parameters:{},positionalParamSegments:{}};function H3(n,e,t,i,r){let o=dE(n,e,t);return o.matched?(i=d3(e,i),O3(i,e,t,r).pipe(ve(a=>a===!0?o:O({},Bh)))):ce(o)}function dE(n,e,t){if(e.path==="**")return G3(t);if(e.path==="")return e.pathMatch==="full"&&(n.hasChildren()||t.length>0)?O({},Bh):{matched:!0,consumedSegments:[],remainingSegments:t,parameters:{},positionalParamSegments:{}};let r=(e.matcher||Bb)(t,n,e);if(!r)return O({},Bh);let o={};Object.entries(r.posParams??{}).forEach(([u,c])=>{o[u]=c.path});let a=r.consumed.length>0?O(O({},o),r.consumed[r.consumed.length-1].parameters):o;return{matched:!0,consumedSegments:r.consumed,remainingSegments:t.slice(r.consumed.length),parameters:a,positionalParamSegments:r.posParams??{}}}function G3(n){return{matched:!0,parameters:n.length>0?$b(n).parameters:{},consumedSegments:n,remainingSegments:[],positionalParamSegments:{}}}function Vb(n,e,t,i){return t.length>0&&j3(n,t,i)?{segmentGroup:new je(e,W3(i,new je(t,n.children))),slicedSegments:[]}:t.length===0&&z3(n,t,i)?{segmentGroup:new je(n.segments,q3(n,t,i,n.children)),slicedSegments:t}:{segmentGroup:new je(n.segments,n.children),slicedSegments:t}}function q3(n,e,t,i){let r={};for(let o of t)if(im(n,e,o)&&!i[ci(o)]){let a=new je([],{});r[ci(o)]=a}return O(O({},i),r)}function W3(n,e){let t={};t[xe]=e;for(let i of n)if(i.path===""&&ci(i)!==xe){let r=new je([],{});t[ci(i)]=r}return t}function j3(n,e,t){return t.some(i=>im(n,e,i)&&ci(i)!==xe)}function z3(n,e,t){return t.some(i=>im(n,e,i))}function im(n,e,t){return(n.hasChildren()||e.length>0)&&t.pathMatch==="full"?!1:t.path===""}function Y3(n,e,t){return e.length===0&&!n.children[t]}var Uh=class{};function J3(n,e,t,i,r,o,a="emptyOnly"){return new $h(n,e,t,i,r,a,o).recognize()}var K3=31,$h=class{injector;configLoader;rootComponentType;config;urlTree;paramsInheritanceStrategy;urlSerializer;applyRedirects;absoluteRedirectCount=0;allowRedirects=!0;constructor(e,t,i,r,o,a,u){this.injector=e,this.configLoader=t,this.rootComponentType=i,this.config=r,this.urlTree=o,this.paramsInheritanceStrategy=a,this.urlSerializer=u,this.applyRedirects=new Oh(this.urlSerializer,this.urlTree)}noMatchError(e){return new z(4002,`'${e.segmentGroup}'`)}recognize(){let e=Vb(this.urlTree.root,[],[],this.config).segmentGroup;return this.match(e).pipe(ve(({children:t,rootSnapshot:i})=>{let r=new Dn(i,t),o=new Al("",r),a=Kb(i,[],this.urlTree.queryParams,this.urlTree.fragment);return a.queryParams=this.urlTree.queryParams,o.url=this.urlSerializer.serialize(a),{state:o,tree:a}}))}match(e){let t=new co([],Object.freeze({}),Object.freeze(O({},this.urlTree.queryParams)),this.urlTree.fragment,Object.freeze({}),xe,this.rootComponentType,null,{});return this.processSegmentGroup(this.injector,this.config,e,xe,t).pipe(ve(i=>({children:i,rootSnapshot:t})),Qn(i=>{if(i instanceof Fl)return this.urlTree=i.urlTree,this.match(i.urlTree.root);throw i instanceof Nl?this.noMatchError(i):i}))}processSegmentGroup(e,t,i,r,o){return i.segments.length===0&&i.hasChildren()?this.processChildren(e,t,i,o):this.processSegment(e,t,i,i.segments,r,!0,o).pipe(ve(a=>a instanceof Dn?[a]:[]))}processChildren(e,t,i,r){let o=[];for(let a of Object.keys(i.children))a==="primary"?o.unshift(a):o.push(a);return mt(o).pipe(Fi(a=>{let u=i.children[a],c=c3(t,a);return this.processSegmentGroup(e,c,u,a,r)}),i0((a,u)=>(a.push(...u),a)),rr(null),n0(),Mt(a=>{if(a===null)return ma(i);let u=cE(a);return Q3(u),ce(u)}))}processSegment(e,t,i,r,o,a,u){return mt(t).pipe(Fi(c=>this.processSegmentAgainstRoute(c._injector??e,t,c,i,r,o,a,u).pipe(Qn(p=>{if(p instanceof Nl)return ce(null);throw p}))),ki(c=>!!c),Qn(c=>{if(lE(c))return Y3(i,r,o)?ce(new Uh):ma(i);throw c}))}processSegmentAgainstRoute(e,t,i,r,o,a,u,c){return ci(i)!==a&&(a===xe||!im(r,o,i))?ma(r):i.redirectTo===void 0?this.matchSegmentAgainstRoute(e,r,i,o,a,c):this.allowRedirects&&u?this.expandSegmentAgainstRouteUsingRedirect(e,r,t,i,o,a,c):ma(r)}expandSegmentAgainstRouteUsingRedirect(e,t,i,r,o,a,u){let{matched:c,parameters:p,consumedSegments:g,positionalParamSegments:y,remainingSegments:v}=dE(t,r,o);if(!c)return ma(t);typeof r.redirectTo=="string"&&r.redirectTo[0]==="/"&&(this.absoluteRedirectCount++,this.absoluteRedirectCount>K3&&(this.allowRedirects=!1));let C=new co(o,p,Object.freeze(O({},this.urlTree.queryParams)),this.urlTree.fragment,Lb(r),ci(r),r.component??r._loadedComponent??null,r,Ob(r)),T=Zc(C,u,this.paramsInheritanceStrategy);return C.params=Object.freeze(T.params),C.data=Object.freeze(T.data),this.applyRedirects.applyRedirectCommands(g,r.redirectTo,y,C,e).pipe(Kt(F=>this.applyRedirects.lineralizeSegments(r,F)),Mt(F=>this.processSegment(e,i,t,F.concat(v),a,!1,u)))}matchSegmentAgainstRoute(e,t,i,r,o,a){let u=H3(t,i,r,e,this.urlSerializer);return i.path==="**"&&(t.children={}),u.pipe(Kt(c=>c.matched?(e=i._injector??e,this.getChildConfig(e,i,r).pipe(Kt(({routes:p})=>{let g=i._loadedInjector??e,{parameters:y,consumedSegments:v,remainingSegments:C}=c,T=new co(v,y,Object.freeze(O({},this.urlTree.queryParams)),this.urlTree.fragment,Lb(i),ci(i),i.component??i._loadedComponent??null,i,Ob(i)),R=Zc(T,a,this.paramsInheritanceStrategy);T.params=Object.freeze(R.params),T.data=Object.freeze(R.data);let{segmentGroup:F,slicedSegments:P}=Vb(t,v,C,p);if(P.length===0&&F.hasChildren())return this.processChildren(g,p,F,T).pipe(ve(q=>new Dn(T,q)));if(p.length===0&&P.length===0)return ce(new Dn(T,[]));let H=ci(i)===o;return this.processSegment(g,p,F,P,H?xe:o,!0,T).pipe(ve(q=>new Dn(T,q instanceof Dn?[q]:[])))}))):ma(t)))}getChildConfig(e,t,i){return t.children?ce({routes:t.children,injector:e}):t.loadChildren?t._loadedRoutes!==void 0?ce({routes:t._loadedRoutes,injector:t._loadedInjector}):L3(e,t,i,this.urlSerializer).pipe(Mt(r=>r?this.configLoader.loadChildren(e,t).pipe(lt(o=>{t._loadedRoutes=o.routes,t._loadedInjector=o.injector})):U3(t))):ce({routes:[],injector:e})}};function Q3(n){n.sort((e,t)=>e.value.outlet===xe?-1:t.value.outlet===xe?1:e.value.outlet.localeCompare(t.value.outlet))}function Z3(n){let e=n.value.routeConfig;return e&&e.path===""}function cE(n){let e=[],t=new Set;for(let i of n){if(!Z3(i)){e.push(i);continue}let r=e.find(o=>i.value.routeConfig===o.value.routeConfig);r!==void 0?(r.children.push(...i.children),t.add(r)):e.push(i)}for(let i of t){let r=cE(i.children);e.push(new Dn(i.value,r))}return e.filter(i=>!t.has(i))}function Lb(n){return n.data||{}}function Ob(n){return n.resolve||{}}function X3(n,e,t,i,r,o){return Mt(a=>J3(n,e,t,i,a.extractedUrl,r,o).pipe(ve(({state:u,tree:c})=>G(O({},a),{targetSnapshot:u,urlAfterRedirects:c}))))}function e6(n,e){return Mt(t=>{let{targetSnapshot:i,guards:{canActivateChecks:r}}=t;if(!r.length)return ce(t);let o=new Set(r.map(c=>c.route)),a=new Set;for(let c of o)if(!a.has(c))for(let p of mE(c))a.add(p);let u=0;return mt(a).pipe(Fi(c=>o.has(c)?t6(c,i,n,e):(c.data=Zc(c,c.parent,n).resolve,ce(void 0))),lt(()=>u++),Ho(1),Mt(c=>u===a.size?ce(t):hn))})}function mE(n){let e=n.children.map(t=>mE(t)).flat();return[n,...e]}function t6(n,e,t,i){let r=n.routeConfig,o=n._resolve;return r?.title!==void 0&&!iE(r)&&(o[Pl]=r.title),_s(()=>(n.data=Zc(n,n.parent,t).resolve,n6(o,n,e,i).pipe(ve(a=>(n._resolvedData=a,n.data=O(O({},n.data),a),null)))))}function n6(n,e,t,i){let r=Mh(n);if(r.length===0)return ce({});let o={};return mt(r).pipe(Mt(a=>i6(n[a],e,t,i).pipe(ki(),lt(u=>{if(u instanceof _a)throw Xc(new po,u);o[a]=u}))),Ho(1),ve(()=>o),Qn(a=>lE(a)?hn:Jn(a)))}function i6(n,e,t,i){let r=Ca(e)??i,o=ba(n,r),a=o.resolve?o.resolve(e,t):kt(r,()=>o(e,t));return Zi(a)}function Th(n){return Kt(e=>{let t=n(e);return t?mt(t).pipe(ve(()=>e)):ce(e)})}var Wh=(()=>{class n{buildTitle(t){let i,r=t.root;for(;r!==void 0;)i=this.getResolvedTitleForRoute(r)??i,r=r.children.find(o=>o.outlet===xe);return i}getResolvedTitleForRoute(t){return t.data[Pl]}static \u0275fac=function(i){return new(i||n)};static \u0275prov=X({token:n,factory:()=>k(pE),providedIn:"root"})}return n})(),pE=(()=>{class n extends Wh{title;constructor(t){super(),this.title=t}updateTitle(t){let i=this.buildTitle(t);i!==void 0&&this.title.setTitle(i)}static \u0275fac=function(i){return new(i||n)(ae(Rb))};static \u0275prov=X({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})(),Ea=new ne("",{providedIn:"root",factory:()=>({})}),Ol=new ne(""),fE=(()=>{class n{componentLoaders=new WeakMap;childrenLoaders=new WeakMap;onLoadStartListener;onLoadEndListener;compiler=k(Lg);loadComponent(t,i){if(this.componentLoaders.get(i))return this.componentLoaders.get(i);if(i._loadedComponent)return ce(i._loadedComponent);this.onLoadStartListener&&this.onLoadStartListener(i);let r=Zi(kt(t,()=>i.loadComponent())).pipe(ve(hE),Kt(yE),lt(a=>{this.onLoadEndListener&&this.onLoadEndListener(i),i._loadedComponent=a}),or(()=>{this.componentLoaders.delete(i)})),o=new Bo(r,()=>new bt).pipe(Oo());return this.componentLoaders.set(i,o),o}loadChildren(t,i){if(this.childrenLoaders.get(i))return this.childrenLoaders.get(i);if(i._loadedRoutes)return ce({routes:i._loadedRoutes,injector:i._loadedInjector});this.onLoadStartListener&&this.onLoadStartListener(i);let o=gE(i,this.compiler,t,this.onLoadEndListener).pipe(or(()=>{this.childrenLoaders.delete(i)})),a=new Bo(o,()=>new bt).pipe(Oo());return this.childrenLoaders.set(i,a),a}static \u0275fac=function(i){return new(i||n)};static \u0275prov=X({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})();function gE(n,e,t,i){return Zi(kt(t,()=>n.loadChildren())).pipe(ve(hE),Kt(yE),Mt(r=>r instanceof nc||Array.isArray(r)?ce(r):mt(e.compileModuleAsync(r))),ve(r=>{i&&i(n);let o,a,u=!1;return Array.isArray(r)?(a=r,u=!0):(o=r.create(t).injector,a=o.get(Ol,[],{optional:!0,self:!0}).flat()),{routes:a.map(qh),injector:o}}))}function r6(n){return n&&typeof n=="object"&&"default"in n}function hE(n){return r6(n)?n.default:n}function yE(n){return ce(n)}var rm=(()=>{class n{static \u0275fac=function(i){return new(i||n)};static \u0275prov=X({token:n,factory:()=>k(o6),providedIn:"root"})}return n})(),o6=(()=>{class n{shouldProcessUrl(t){return!0}extract(t){return t}merge(t,i){return t}static \u0275fac=function(i){return new(i||n)};static \u0275prov=X({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})(),_E=new ne("");var vE=new ne(""),CE=(()=>{class n{currentNavigation=D(null,{equal:()=>!1});currentTransition=null;lastSuccessfulNavigation=null;events=new bt;transitionAbortWithErrorSubject=new bt;configLoader=k(fE);environmentInjector=k(At);destroyRef=k(kn);urlSerializer=k(kl);rootContexts=k(xa);location=k(oo);inputBindingEnabled=k(nm,{optional:!0})!==null;titleStrategy=k(Wh);options=k(Ea,{optional:!0})||{};paramsInheritanceStrategy=this.options.paramsInheritanceStrategy||"emptyOnly";urlHandlingStrategy=k(rm);createViewTransition=k(_E,{optional:!0});navigationErrorHandler=k(vE,{optional:!0});navigationId=0;get hasRequestedNavigation(){return this.navigationId!==0}transitions;afterPreactivation=()=>ce(void 0);rootComponentType=null;destroyed=!1;constructor(){let t=r=>this.events.next(new qc(r)),i=r=>this.events.next(new Wc(r));this.configLoader.onLoadEndListener=i,this.configLoader.onLoadStartListener=t,this.destroyRef.onDestroy(()=>{this.destroyed=!0})}complete(){this.transitions?.complete()}handleNavigationRequest(t){let i=++this.navigationId;Ot(()=>{this.transitions?.next(G(O({},t),{extractedUrl:this.urlHandlingStrategy.extract(t.rawUrl),targetSnapshot:null,targetRouterState:null,guards:{canActivateChecks:[],canDeactivateChecks:[]},guardsResult:null,abortController:new AbortController,id:i}))})}setupNavigations(t){return this.transitions=new Ht(null),this.transitions.pipe(vt(i=>i!==null),Kt(i=>{let r=!1;return ce(i).pipe(Kt(o=>{if(this.navigationId>i.id)return this.cancelNavigationTransition(i,"",dn.SupersededByNewNavigation),hn;this.currentTransition=i,this.currentNavigation.set({id:o.id,initialUrl:o.rawUrl,extractedUrl:o.extractedUrl,targetBrowserUrl:typeof o.extras.browserUrl=="string"?this.urlSerializer.parse(o.extras.browserUrl):o.extras.browserUrl,trigger:o.source,extras:o.extras,previousNavigation:this.lastSuccessfulNavigation?G(O({},this.lastSuccessfulNavigation),{previousNavigation:null}):null,abort:()=>o.abortController.abort()});let a=!t.navigated||this.isUpdatingInternalState()||this.isUpdatedBrowserUrl(),u=o.extras.onSameUrlNavigation??t.onSameUrlNavigation;if(!a&&u!=="reload")return this.events.next(new Qi(o.id,this.urlSerializer.serialize(o.rawUrl),"",wl.IgnoredSameUrlNavigation)),o.resolve(!1),hn;if(this.urlHandlingStrategy.shouldProcessUrl(o.rawUrl))return ce(o).pipe(Kt(c=>(this.events.next(new fo(c.id,this.urlSerializer.serialize(c.extractedUrl),c.source,c.restoredState)),c.id!==this.navigationId?hn:Promise.resolve(c))),X3(this.environmentInjector,this.configLoader,this.rootComponentType,t.config,this.urlSerializer,this.paramsInheritanceStrategy),lt(c=>{i.targetSnapshot=c.targetSnapshot,i.urlAfterRedirects=c.urlAfterRedirects,this.currentNavigation.update(g=>(g.finalUrl=c.urlAfterRedirects,g));let p=new Tl(c.id,this.urlSerializer.serialize(c.extractedUrl),this.urlSerializer.serialize(c.urlAfterRedirects),c.targetSnapshot);this.events.next(p)}));if(a&&this.urlHandlingStrategy.shouldProcessUrl(o.currentRawUrl)){let{id:c,extractedUrl:p,source:g,restoredState:y,extras:v}=o,C=new fo(c,this.urlSerializer.serialize(p),g,y);this.events.next(C);let T=tE(this.rootComponentType).snapshot;return this.currentTransition=i=G(O({},o),{targetSnapshot:T,urlAfterRedirects:p,extras:G(O({},v),{skipLocationChange:!1,replaceUrl:!1})}),this.currentNavigation.update(R=>(R.finalUrl=p,R)),ce(i)}else return this.events.next(new Qi(o.id,this.urlSerializer.serialize(o.extractedUrl),"",wl.IgnoredByUrlHandlingStrategy)),o.resolve(!1),hn}),lt(o=>{let a=new Uc(o.id,this.urlSerializer.serialize(o.extractedUrl),this.urlSerializer.serialize(o.urlAfterRedirects),o.targetSnapshot);this.events.next(a)}),ve(o=>(this.currentTransition=i=G(O({},o),{guards:_3(o.targetSnapshot,o.currentSnapshot,this.rootContexts)}),i)),M3(this.environmentInjector,o=>this.events.next(o)),lt(o=>{if(i.guardsResult=o.guardsResult,o.guardsResult&&typeof o.guardsResult!="boolean")throw Xc(this.urlSerializer,o.guardsResult);let a=new $c(o.id,this.urlSerializer.serialize(o.extractedUrl),this.urlSerializer.serialize(o.urlAfterRedirects),o.targetSnapshot,!!o.guardsResult);this.events.next(a)}),vt(o=>o.guardsResult?!0:(this.cancelNavigationTransition(o,"",dn.GuardRejected),!1)),Th(o=>{if(o.guards.canActivateChecks.length!==0)return ce(o).pipe(lt(a=>{let u=new Hc(a.id,this.urlSerializer.serialize(a.extractedUrl),this.urlSerializer.serialize(a.urlAfterRedirects),a.targetSnapshot);this.events.next(u)}),Kt(a=>{let u=!1;return ce(a).pipe(e6(this.paramsInheritanceStrategy,this.environmentInjector),lt({next:()=>u=!0,complete:()=>{u||this.cancelNavigationTransition(a,"",dn.NoDataFromResolver)}}))}),lt(a=>{let u=new Gc(a.id,this.urlSerializer.serialize(a.extractedUrl),this.urlSerializer.serialize(a.urlAfterRedirects),a.targetSnapshot);this.events.next(u)}))}),Th(o=>{let a=u=>{let c=[];if(u.routeConfig?.loadComponent){let p=Ca(u)??this.environmentInjector;c.push(this.configLoader.loadComponent(p,u.routeConfig).pipe(lt(g=>{u.component=g}),ve(()=>{})))}for(let p of u.children)c.push(...a(p));return c};return $u(a(o.targetSnapshot.root)).pipe(rr(null),Pi(1))}),Th(()=>this.afterPreactivation()),Kt(()=>{let{currentSnapshot:o,targetSnapshot:a}=i,u=this.createViewTransition?.(this.environmentInjector,o.root,a.root);return u?mt(u).pipe(ve(()=>i)):ce(i)}),ve(o=>{let a=p3(t.routeReuseStrategy,o.targetSnapshot,o.currentRouterState);return this.currentTransition=i=G(O({},o),{targetRouterState:a}),this.currentNavigation.update(u=>(u.targetRouterState=a,u)),i}),lt(()=>{this.events.next(new Il)}),y3(this.rootContexts,t.routeReuseStrategy,o=>this.events.next(o),this.inputBindingEnabled),Pi(1),Gu(new Ae(o=>{let a=i.abortController.signal,u=()=>o.next();return a.addEventListener("abort",u),()=>a.removeEventListener("abort",u)}).pipe(vt(()=>!r&&!i.targetRouterState),lt(()=>{this.cancelNavigationTransition(i,i.abortController.signal.reason+"",dn.Aborted)}))),lt({next:o=>{r=!0,this.lastSuccessfulNavigation=Ot(this.currentNavigation),this.events.next(new cn(o.id,this.urlSerializer.serialize(o.extractedUrl),this.urlSerializer.serialize(o.urlAfterRedirects))),this.titleStrategy?.updateTitle(o.targetRouterState.snapshot),o.resolve(!0)},complete:()=>{r=!0}}),Gu(this.transitionAbortWithErrorSubject.pipe(lt(o=>{throw o}))),or(()=>{r||this.cancelNavigationTransition(i,"",dn.SupersededByNewNavigation),this.currentTransition?.id===i.id&&(this.currentNavigation.set(null),this.currentTransition=null)}),Qn(o=>{if(this.destroyed)return i.resolve(!1),hn;if(r=!0,sE(o))this.events.next(new Ai(i.id,this.urlSerializer.serialize(i.extractedUrl),o.message,o.cancellationCode)),h3(o)?this.events.next(new ya(o.url,o.navigationBehaviorOptions)):i.resolve(!1);else{let a=new ha(i.id,this.urlSerializer.serialize(i.extractedUrl),o,i.targetSnapshot??void 0);try{let u=kt(this.environmentInjector,()=>this.navigationErrorHandler?.(a));if(u instanceof _a){let{message:c,cancellationCode:p}=Xc(this.urlSerializer,u);this.events.next(new Ai(i.id,this.urlSerializer.serialize(i.extractedUrl),c,p)),this.events.next(new ya(u.redirectTo,u.navigationBehaviorOptions))}else throw this.events.next(a),o}catch(u){this.options.resolveNavigationPromiseOnError?i.resolve(!1):i.reject(u)}}return hn}))}))}cancelNavigationTransition(t,i,r){let o=new Ai(t.id,this.urlSerializer.serialize(t.extractedUrl),i,r);this.events.next(o),t.resolve(!1)}isUpdatingInternalState(){return this.currentTransition?.extractedUrl.toString()!==this.currentTransition?.currentUrlTree.toString()}isUpdatedBrowserUrl(){let t=this.urlHandlingStrategy.extract(this.urlSerializer.parse(this.location.path(!0))),i=Ot(this.currentNavigation),r=i?.targetBrowserUrl??i?.extractedUrl;return t.toString()!==r?.toString()&&!i?.extras.skipLocationChange}static \u0275fac=function(i){return new(i||n)};static \u0275prov=X({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})();function a6(n){return n!==El}var xE=(()=>{class n{static \u0275fac=function(i){return new(i||n)};static \u0275prov=X({token:n,factory:()=>k(s6),providedIn:"root"})}return n})(),tm=class{shouldDetach(e){return!1}store(e,t){}shouldAttach(e){return!1}retrieve(e){return null}shouldReuseRoute(e,t){return e.routeConfig===t.routeConfig}},s6=(()=>{class n extends tm{static \u0275fac=(()=>{let t;return function(r){return(t||(t=Zt(n)))(r||n)}})();static \u0275prov=X({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})(),bE=(()=>{class n{urlSerializer=k(kl);options=k(Ea,{optional:!0})||{};canceledNavigationResolution=this.options.canceledNavigationResolution||"replace";location=k(oo);urlHandlingStrategy=k(rm);urlUpdateStrategy=this.options.urlUpdateStrategy||"deferred";currentUrlTree=new Ri;getCurrentUrlTree(){return this.currentUrlTree}rawUrlTree=this.currentUrlTree;getRawUrlTree(){return this.rawUrlTree}createBrowserPath({finalUrl:t,initialUrl:i,targetBrowserUrl:r}){let o=t!==void 0?this.urlHandlingStrategy.merge(t,i):i,a=r??o;return a instanceof Ri?this.urlSerializer.serialize(a):a}commitTransition({targetRouterState:t,finalUrl:i,initialUrl:r}){i&&t?(this.currentUrlTree=i,this.rawUrlTree=this.urlHandlingStrategy.merge(i,r),this.routerState=t):this.rawUrlTree=r}routerState=tE(null);getRouterState(){return this.routerState}stateMemento=this.createStateMemento();updateStateMemento(){this.stateMemento=this.createStateMemento()}createStateMemento(){return{rawUrlTree:this.rawUrlTree,currentUrlTree:this.currentUrlTree,routerState:this.routerState}}resetInternalState({finalUrl:t}){this.routerState=this.stateMemento.routerState,this.currentUrlTree=this.stateMemento.currentUrlTree,this.rawUrlTree=this.urlHandlingStrategy.merge(this.currentUrlTree,t??this.rawUrlTree)}static \u0275fac=function(i){return new(i||n)};static \u0275prov=X({token:n,factory:()=>k(l6),providedIn:"root"})}return n})(),l6=(()=>{class n extends bE{currentPageId=0;lastSuccessfulId=-1;restoredState(){return this.location.getState()}get browserPageId(){return this.canceledNavigationResolution!=="computed"?this.currentPageId:this.restoredState()?.\u0275routerPageId??this.currentPageId}registerNonRouterCurrentEntryChangeListener(t){return this.location.subscribe(i=>{i.type==="popstate"&&setTimeout(()=>{t(i.url,i.state,"popstate")})})}handleRouterEvent(t,i){t instanceof fo?this.updateStateMemento():t instanceof Qi?this.commitTransition(i):t instanceof Tl?this.urlUpdateStrategy==="eager"&&(i.extras.skipLocationChange||this.setBrowserUrl(this.createBrowserPath(i),i)):t instanceof Il?(this.commitTransition(i),this.urlUpdateStrategy==="deferred"&&!i.extras.skipLocationChange&&this.setBrowserUrl(this.createBrowserPath(i),i)):t instanceof Ai&&t.code!==dn.SupersededByNewNavigation&&t.code!==dn.Redirect?this.restoreHistory(i):t instanceof ha?this.restoreHistory(i,!0):t instanceof cn&&(this.lastSuccessfulId=t.id,this.currentPageId=this.browserPageId)}setBrowserUrl(t,{extras:i,id:r}){let{replaceUrl:o,state:a}=i;if(this.location.isCurrentPathEqualTo(t)||o){let u=this.browserPageId,c=O(O({},a),this.generateNgRouterState(r,u));this.location.replaceState(t,"",c)}else{let u=O(O({},a),this.generateNgRouterState(r,this.browserPageId+1));this.location.go(t,"",u)}}restoreHistory(t,i=!1){if(this.canceledNavigationResolution==="computed"){let r=this.browserPageId,o=this.currentPageId-r;o!==0?this.location.historyGo(o):this.getCurrentUrlTree()===t.finalUrl&&o===0&&(this.resetInternalState(t),this.resetUrlToCurrentUrlTree())}else this.canceledNavigationResolution==="replace"&&(i&&this.resetInternalState(t),this.resetUrlToCurrentUrlTree())}resetUrlToCurrentUrlTree(){this.location.replaceState(this.urlSerializer.serialize(this.getRawUrlTree()),"",this.generateNgRouterState(this.lastSuccessfulId,this.currentPageId))}generateNgRouterState(t,i){return this.canceledNavigationResolution==="computed"?{navigationId:t,\u0275routerPageId:i}:{navigationId:t}}static \u0275fac=(()=>{let t;return function(r){return(t||(t=Zt(n)))(r||n)}})();static \u0275prov=X({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})();function jh(n,e){n.events.pipe(vt(t=>t instanceof cn||t instanceof Ai||t instanceof ha||t instanceof Qi),ve(t=>t instanceof cn||t instanceof Qi?0:(t instanceof Ai?t.code===dn.Redirect||t.code===dn.SupersededByNewNavigation:!1)?2:1),vt(t=>t!==2),Pi(1)).subscribe(()=>{e()})}var u6={paths:"exact",fragment:"ignored",matrixParams:"ignored",queryParams:"exact"},d6={paths:"subset",fragment:"ignored",matrixParams:"ignored",queryParams:"subset"},Fe=(()=>{class n{get currentUrlTree(){return this.stateManager.getCurrentUrlTree()}get rawUrlTree(){return this.stateManager.getRawUrlTree()}disposed=!1;nonRouterCurrentEntryChangeSubscription;console=k(Ag);stateManager=k(bE);options=k(Ea,{optional:!0})||{};pendingTasks=k(Si);urlUpdateStrategy=this.options.urlUpdateStrategy||"deferred";navigationTransitions=k(CE);urlSerializer=k(kl);location=k(oo);urlHandlingStrategy=k(rm);injector=k(At);_events=new bt;get events(){return this._events}get routerState(){return this.stateManager.getRouterState()}navigated=!1;routeReuseStrategy=k(xE);onSameUrlNavigation=this.options.onSameUrlNavigation||"ignore";config=k(Ol,{optional:!0})?.flat()??[];componentInputBindingEnabled=!!k(nm,{optional:!0});currentNavigation=this.navigationTransitions.currentNavigation.asReadonly();constructor(){this.resetConfig(this.config),this.navigationTransitions.setupNavigations(this).subscribe({error:t=>{this.console.warn(t)}}),this.subscribeToNavigationEvents()}eventsSubscription=new Tt;subscribeToNavigationEvents(){let t=this.navigationTransitions.events.subscribe(i=>{try{let r=this.navigationTransitions.currentTransition,o=Ot(this.navigationTransitions.currentNavigation);if(r!==null&&o!==null){if(this.stateManager.handleRouterEvent(i,o),i instanceof Ai&&i.code!==dn.Redirect&&i.code!==dn.SupersededByNewNavigation)this.navigated=!0;else if(i instanceof cn)this.navigated=!0;else if(i instanceof ya){let a=i.navigationBehaviorOptions,u=this.urlHandlingStrategy.merge(i.url,r.currentRawUrl),c=O({browserUrl:r.extras.browserUrl,info:r.extras.info,skipLocationChange:r.extras.skipLocationChange,replaceUrl:r.extras.replaceUrl||this.urlUpdateStrategy==="eager"||a6(r.source)},a);this.scheduleNavigation(u,El,null,c,{resolve:r.resolve,reject:r.reject,promise:r.promise})}}u3(i)&&this._events.next(i)}catch(r){this.navigationTransitions.transitionAbortWithErrorSubject.next(r)}});this.eventsSubscription.add(t)}resetRootComponentType(t){this.routerState.root.component=t,this.navigationTransitions.rootComponentType=t}initialNavigation(){this.setUpLocationChangeListener(),this.navigationTransitions.hasRequestedNavigation||this.navigateToSyncWithBrowser(this.location.path(!0),El,this.stateManager.restoredState())}setUpLocationChangeListener(){this.nonRouterCurrentEntryChangeSubscription??=this.stateManager.registerNonRouterCurrentEntryChangeListener((t,i,r)=>{this.navigateToSyncWithBrowser(t,r,i)})}navigateToSyncWithBrowser(t,i,r){let o={replaceUrl:!0},a=r?.navigationId?r:null;if(r){let c=O({},r);delete c.navigationId,delete c.\u0275routerPageId,Object.keys(c).length!==0&&(o.state=c)}let u=this.parseUrl(t);this.scheduleNavigation(u,i,a,o).catch(c=>{this.disposed||this.injector.get(_n)(c)})}get url(){return this.serializeUrl(this.currentUrlTree)}getCurrentNavigation(){return Ot(this.navigationTransitions.currentNavigation)}get lastSuccessfulNavigation(){return this.navigationTransitions.lastSuccessfulNavigation}resetConfig(t){this.config=t.map(qh),this.navigated=!1}ngOnDestroy(){this.dispose()}dispose(){this._events.unsubscribe(),this.navigationTransitions.complete(),this.nonRouterCurrentEntryChangeSubscription&&(this.nonRouterCurrentEntryChangeSubscription.unsubscribe(),this.nonRouterCurrentEntryChangeSubscription=void 0),this.disposed=!0,this.eventsSubscription.unsubscribe()}createUrlTree(t,i={}){let{relativeTo:r,queryParams:o,fragment:a,queryParamsHandling:u,preserveFragment:c}=i,p=c?this.currentUrlTree.fragment:a,g=null;switch(u??this.options.defaultQueryParamsHandling){case"merge":g=O(O({},this.currentUrlTree.queryParams),o);break;case"preserve":g=this.currentUrlTree.queryParams;break;default:g=o||null}g!==null&&(g=this.removeEmptyProps(g));let y;try{let v=r?r.snapshot:this.routerState.snapshot.root;y=Qb(v)}catch{(typeof t[0]!="string"||t[0][0]!=="/")&&(t=[]),y=this.currentUrlTree.root}return Zb(y,t,g,p??null)}navigateByUrl(t,i={skipLocationChange:!1}){let r=Dr(t)?t:this.parseUrl(t),o=this.urlHandlingStrategy.merge(r,this.rawUrlTree);return this.scheduleNavigation(o,El,null,i)}navigate(t,i={skipLocationChange:!1}){return c6(t),this.navigateByUrl(this.createUrlTree(t,i),i)}serializeUrl(t){return this.urlSerializer.serialize(t)}parseUrl(t){try{return this.urlSerializer.parse(t)}catch{return this.console.warn(lr(4018,!1)),this.urlSerializer.parse("/")}}isActive(t,i){let r;if(i===!0?r=O({},u6):i===!1?r=O({},d6):r=i,Dr(t))return Nb(this.currentUrlTree,t,r);let o=this.parseUrl(t);return Nb(this.currentUrlTree,o,r)}removeEmptyProps(t){return Object.entries(t).reduce((i,[r,o])=>(o!=null&&(i[r]=o),i),{})}scheduleNavigation(t,i,r,o,a){if(this.disposed)return Promise.resolve(!1);let u,c,p;a?(u=a.resolve,c=a.reject,p=a.promise):p=new Promise((y,v)=>{u=y,c=v});let g=this.pendingTasks.add();return jh(this,()=>{queueMicrotask(()=>this.pendingTasks.remove(g))}),this.navigationTransitions.handleNavigationRequest({source:i,restoredState:r,currentUrlTree:this.currentUrlTree,currentRawUrl:this.currentUrlTree,rawUrl:t,extras:o,resolve:u,reject:c,promise:p,currentSnapshot:this.routerState.snapshot,currentRouterState:this.routerState}),p.catch(y=>Promise.reject(y))}static \u0275fac=function(i){return new(i||n)};static \u0275prov=X({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})();function c6(n){for(let e=0;e<n.length;e++)if(n[e]==null)throw new z(4008,!1)}var wr=(()=>{class n{router;route;tabIndexAttribute;renderer;el;locationStrategy;reactiveHref=D(null);get href(){return Ot(this.reactiveHref)}set href(t){this.reactiveHref.set(t)}target;queryParams;fragment;queryParamsHandling;state;info;relativeTo;isAnchorElement;subscription;onChanges=new bt;applicationErrorHandler=k(_n);options=k(Ea,{optional:!0});constructor(t,i,r,o,a,u){this.router=t,this.route=i,this.tabIndexAttribute=r,this.renderer=o,this.el=a,this.locationStrategy=u,this.reactiveHref.set(k(new uc("href"),{optional:!0}));let c=a.nativeElement.tagName?.toLowerCase();this.isAnchorElement=c==="a"||c==="area"||!!(typeof customElements=="object"&&customElements.get(c)?.observedAttributes?.includes?.("href")),this.isAnchorElement?this.setTabIndexIfNotOnNativeEl("0"):this.subscribeToNavigationEventsIfNecessary()}subscribeToNavigationEventsIfNecessary(){if(this.subscription!==void 0||!this.isAnchorElement)return;let t=this.preserveFragment,i=r=>r==="merge"||r==="preserve";t||=i(this.queryParamsHandling),t||=!this.queryParamsHandling&&!i(this.options?.defaultQueryParamsHandling),t&&(this.subscription=this.router.events.subscribe(r=>{r instanceof cn&&this.updateHref()}))}preserveFragment=!1;skipLocationChange=!1;replaceUrl=!1;setTabIndexIfNotOnNativeEl(t){this.tabIndexAttribute!=null||this.isAnchorElement||this.applyAttributeValue("tabindex",t)}ngOnChanges(t){this.isAnchorElement&&(this.updateHref(),this.subscribeToNavigationEventsIfNecessary()),this.onChanges.next(this)}routerLinkInput=null;set routerLink(t){t==null?(this.routerLinkInput=null,this.setTabIndexIfNotOnNativeEl(null)):(Dr(t)?this.routerLinkInput=t:this.routerLinkInput=Array.isArray(t)?t:[t],this.setTabIndexIfNotOnNativeEl("0"))}onClick(t,i,r,o,a){let u=this.urlTree;if(u===null||this.isAnchorElement&&(t!==0||i||r||o||a||typeof this.target=="string"&&this.target!="_self"))return!0;let c={skipLocationChange:this.skipLocationChange,replaceUrl:this.replaceUrl,state:this.state,info:this.info};return this.router.navigateByUrl(u,c)?.catch(p=>{this.applicationErrorHandler(p)}),!this.isAnchorElement}ngOnDestroy(){this.subscription?.unsubscribe()}updateHref(){let t=this.urlTree;this.reactiveHref.set(t!==null&&this.locationStrategy?this.locationStrategy?.prepareExternalUrl(this.router.serializeUrl(t))??"":null)}applyAttributeValue(t,i){let r=this.renderer,o=this.el.nativeElement;i!==null?r.setAttribute(o,t,i):r.removeAttribute(o,t)}get urlTree(){return this.routerLinkInput===null?null:Dr(this.routerLinkInput)?this.routerLinkInput:this.router.createUrlTree(this.routerLinkInput,{relativeTo:this.relativeTo!==void 0?this.relativeTo:this.route,queryParams:this.queryParams,fragment:this.fragment,queryParamsHandling:this.queryParamsHandling,preserveFragment:this.preserveFragment})}static \u0275fac=function(i){return new(i||n)(ee(Fe),ee(mn),zs("tabindex"),ee(ai),ee(an),ee(Ii))};static \u0275dir=Ne({type:n,selectors:[["","routerLink",""]],hostVars:2,hostBindings:function(i,r){i&1&&b("click",function(a){return r.onClick(a.button,a.ctrlKey,a.shiftKey,a.altKey,a.metaKey)}),i&2&&gt("href",r.reactiveHref(),rg)("target",r.target)},inputs:{target:"target",queryParams:"queryParams",fragment:"fragment",queryParamsHandling:"queryParamsHandling",state:"state",info:"info",relativeTo:"relativeTo",preserveFragment:[2,"preserveFragment","preserveFragment",ro],skipLocationChange:[2,"skipLocationChange","skipLocationChange",ro],replaceUrl:[2,"replaceUrl","replaceUrl",ro],routerLink:"routerLink"},features:[Ln]})}return n})(),zh=(()=>{class n{router;element;renderer;cdr;link;links;classes=[];routerEventsSubscription;linkInputChangesSubscription;_isActive=!1;get isActive(){return this._isActive}routerLinkActiveOptions={exact:!1};ariaCurrentWhenActive;isActiveChange=new et;constructor(t,i,r,o,a){this.router=t,this.element=i,this.renderer=r,this.cdr=o,this.link=a,this.routerEventsSubscription=t.events.subscribe(u=>{u instanceof cn&&this.update()})}ngAfterContentInit(){ce(this.links.changes,ce(null)).pipe(Uo()).subscribe(t=>{this.update(),this.subscribeToEachLinkOnChanges()})}subscribeToEachLinkOnChanges(){this.linkInputChangesSubscription?.unsubscribe();let t=[...this.links.toArray(),this.link].filter(i=>!!i).map(i=>i.onChanges);this.linkInputChangesSubscription=mt(t).pipe(Uo()).subscribe(i=>{this._isActive!==this.isLinkActive(this.router)(i)&&this.update()})}set routerLinkActive(t){let i=Array.isArray(t)?t:t.split(" ");this.classes=i.filter(r=>!!r)}ngOnChanges(t){this.update()}ngOnDestroy(){this.routerEventsSubscription.unsubscribe(),this.linkInputChangesSubscription?.unsubscribe()}update(){!this.links||!this.router.navigated||queueMicrotask(()=>{let t=this.hasActiveLinks();this.classes.forEach(i=>{t?this.renderer.addClass(this.element.nativeElement,i):this.renderer.removeClass(this.element.nativeElement,i)}),t&&this.ariaCurrentWhenActive!==void 0?this.renderer.setAttribute(this.element.nativeElement,"aria-current",this.ariaCurrentWhenActive.toString()):this.renderer.removeAttribute(this.element.nativeElement,"aria-current"),this._isActive!==t&&(this._isActive=t,this.cdr.markForCheck(),this.isActiveChange.emit(t))})}isLinkActive(t){let i=p6(this.routerLinkActiveOptions)?this.routerLinkActiveOptions:this.routerLinkActiveOptions.exact||!1;return r=>{let o=r.urlTree;return o?t.isActive(o,i):!1}}hasActiveLinks(){let t=this.isLinkActive(this.router);return this.link&&t(this.link)||this.links.some(t)}static \u0275fac=function(i){return new(i||n)(ee(Fe),ee(an),ee(ai),ee(br),ee(wr,8))};static \u0275dir=Ne({type:n,selectors:[["","routerLinkActive",""]],contentQueries:function(i,r,o){if(i&1&&kg(o,wr,5),i&2){let a;tt(a=nt())&&(r.links=a)}},inputs:{routerLinkActiveOptions:"routerLinkActiveOptions",ariaCurrentWhenActive:"ariaCurrentWhenActive",routerLinkActive:"routerLinkActive"},outputs:{isActiveChange:"isActiveChange"},exportAs:["routerLinkActive"],features:[Ln]})}return n})();function p6(n){return!!n.paths}var f6=new ne("");function Yh(n,...e){return $r([{provide:Ol,multi:!0,useValue:n},[],{provide:mn,useFactory:g6,deps:[Fe]},{provide:ic,multi:!0,useFactory:y6},e.map(t=>t.\u0275providers)])}function g6(n){return n.routerState.root}function h6(n,e){return{\u0275kind:n,\u0275providers:e}}function y6(){let n=k(Qt);return e=>{let t=n.get(zi);if(e!==t.components[0])return;let i=n.get(Fe),r=n.get(_6);n.get(v6)===1&&i.initialNavigation(),n.get(C6,null,{optional:!0})?.setUpPreloading(),n.get(f6,null,{optional:!0})?.init(),i.resetRootComponentType(t.componentTypes[0]),r.closed||(r.next(),r.complete(),r.unsubscribe())}}var _6=new ne("",{factory:()=>new bt}),v6=new ne("",{providedIn:"root",factory:()=>1});var C6=new ne("");function Jh(){return h6(6,[{provide:Ii,useClass:nh}])}var Gn={production:!1,apiUrl:"https://galaxyhouse-finance.zeabur.app/api",googleClientId:"957974561982-c8gfted5logjoglj8hspaiad8q8jpl1g.apps.googleusercontent.com"};var go=class go{constructor(e,t){this.http=e;this.router=t;this.baseUrl=`${Gn.apiUrl}/admin`;this.tokenKey="gh_finance_auth_token";this.adminKey="gh_finance_admin_data";this.expiryKey="gh_finance_token_expiry";this.currentAdmin=D(null);this.isAuthenticated=D(!1);this.isLoading=D(!1);this.error=D(null);this.isSuperAdmin=$(()=>this.currentAdmin()?.roles.some(t=>t.role_name==="super_admin")??!1);this.isManagedAdmin=$(()=>this.currentAdmin()?.roles.some(t=>["super_admin","user_manager"].includes(t.role_name))??!1);this.initializeAuth()}initializeAuth(){let e=this.getToken(),t=this.getTokenExpiry();if(e&&t)if(new Date().getTime()<t){let i=localStorage.getItem(this.adminKey);i&&(this.currentAdmin.set(JSON.parse(i)),this.isAuthenticated.set(!0),this.validateStoredSession(e))}else this.clearAuth()}async validateStoredSession(e){try{let t=new tn({Authorization:`Bearer ${e}`,"Content-Type":"application/json"});await W(this.http.get(`${this.baseUrl}/auth`,{headers:t}))}catch{this.clearAuth(),this.router.navigate(["/login"])}}async loginWithGoogle(e){try{this.isLoading.set(!0),this.error.set(null);let t=await W(this.http.post(`${this.baseUrl}/auth/google`,{idToken:e}));if(t.success&&t.data){let{token:i,admin:r}=t.data;return this.saveToken(i),this.saveAdmin(r),this.currentAdmin.set(r),this.isAuthenticated.set(!0),!0}else return this.error.set(t.error||"Login failed"),!1}catch(t){let i=t.error?.error||"Authentication failed";return this.error.set(i),!1}finally{this.isLoading.set(!1)}}logout(){this.clearAuth(),this.router.navigate(["/login"])}hasPermission(e){return this.currentAdmin()?.permissions.includes(e)??!1}hasRole(e){return this.currentAdmin()?.roles.some(i=>i.role_name===e)??!1}hasAnyRole(e){return this.currentAdmin()?.roles.some(i=>e.includes(i.role_name))??!1}getToken(){return localStorage.getItem(this.tokenKey)}getTokenExpiry(){let e=localStorage.getItem(this.expiryKey);return e?parseInt(e):null}saveToken(e){let t=new Date().getTime()+6048e5;localStorage.setItem(this.tokenKey,e),localStorage.setItem(this.expiryKey,t.toString())}saveAdmin(e){localStorage.setItem(this.adminKey,JSON.stringify(e))}clearAuth(){localStorage.removeItem(this.tokenKey),localStorage.removeItem(this.adminKey),localStorage.removeItem(this.expiryKey),this.currentAdmin.set(null),this.isAuthenticated.set(!1)}refreshTokenExpiry(){let e=this.getToken();e&&this.saveToken(e)}getCurrentAdmin(){return this.currentAdmin()}isTokenExpiringSoon(){let e=this.getTokenExpiry();if(!e)return!0;let t=new Date().getTime(),i=3600*1e3;return e-t<i}};go.\u0275fac=function(t){return new(t||go)(ae(Hn),ae(Fe))},go.\u0275prov=X({token:go,factory:go.\u0275fac,providedIn:"root"});var st=go;var EE=()=>({exact:!0}),x6=(n,e)=>e.name,b6=(n,e)=>e.path;function E6(n,e){if(n&1){let t=B();l(0,"button",10),b("click",function(){E(t);let r=_();return S(r.toggleCollapse())}),x(1,"ion-icon",11),s()}if(n&2){let t=_();m(),I("name",t.isCollapsed()?"chevron-forward-outline":"chevron-back-outline")}}function S6(n,e){if(n&1){let t=B();l(0,"a",20),b("click",function(){E(t);let r=_(4);return S(r.onNavigate())}),x(1,"ion-icon",21),l(2,"span",22),d(3),s()()}if(n&2){let t=e.$implicit;I("routerLink",t.path)("routerLinkActiveOptions",Ke(4,EE)),m(),I("name",t.icon),m(2),w(t.name)}}function D6(n,e){if(n&1&&(l(0,"div",18),V(1,S6,4,5,"a",19,b6),s()),n&2){let t=_(2).$implicit;m(),L(t.children)}}function w6(n,e){if(n&1){let t=B();l(0,"div")(1,"button",13),b("click",function(){E(t);let r=_().$implicit,o=_();return S(o.toggleMenu(r.name))}),l(2,"div",14),x(3,"ion-icon",15),l(4,"span",16),d(5),s()(),x(6,"ion-icon",17),s(),M(7,D6,3,0,"div",18),s()}if(n&2){let t=_().$implicit,i=_();m(),j("text-indigo-600",i.isMenuActive(t.children))("font-semibold",i.isMenuActive(t.children)),I("title",i.isCollapsed()?t.name:""),m(2),I("name",t.icon),m(),j("hidden",!i.isMobile&&i.isCollapsed()),m(),w(t.name),m(),j("rotate-180",i.openMenu()===t.name)("hidden",!i.isMobile&&i.isCollapsed()),m(),A(i.openMenu()===t.name&&(i.isMobile||!i.isCollapsed())?7:-1)}}function T6(n,e){if(n&1){let t=B();l(0,"a",23),b("click",function(){E(t);let r=_(2);return S(r.onNavigate())}),x(1,"ion-icon",15),l(2,"span",16),d(3),s()()}if(n&2){let t=_().$implicit,i=_();I("routerLink",t.path)("title",i.isCollapsed()?t.name:"")("routerLinkActiveOptions",Ke(7,EE)),m(),I("name",t.icon),m(),j("hidden",!i.isMobile&&i.isCollapsed()),m(),w(t.name)}}function I6(n,e){if(n&1&&M(0,w6,8,14,"div")(1,T6,4,8,"a",12),n&2){let t=e.$implicit;A(t.children&&t.children.length>0?0:1)}}var Sa=class Sa{constructor(){this.isMobile=!1;this.isMobileOpen=!1;this.closeMobile=new et;this.router=k(Fe);this.authService=k(st);this.openMenu=D(null);this.isSuperAdmin=D(!1);this.isCollapsed=D(!1);this.allNavLinks=[{path:"/dashboard",icon:"grid-outline",name:"\u5100\u8868\u677F"},{name:"\u8CA1\u52D9\u8207\u5206\u6790",icon:"analytics-outline",children:[{path:"/daily-revenue",icon:"stats-chart-outline",name:"\u7576\u65E5\u71DF\u6536"},{path:"/financial-statements",icon:"document-text-outline",name:"\u8CA1\u52D9\u5831\u8868"},{path:"/customer-analysis",icon:"people-outline",name:"\u9867\u5BA2\u7BA1\u7406"},{path:"/product-analysis",icon:"cube-outline",name:"\u5546\u54C1\u5206\u6790"},{path:"/monthly-targets",icon:"trending-up-outline",name:"\u71DF\u6536\u76EE\u6A19"}]},{name:"\u6210\u672C\u8207\u5EE0\u5546",icon:"wallet-outline",children:[{path:"/product-cost",icon:"pricetags-outline",name:"\u5546\u54C1\u6210\u672C"},{path:"/purchase-orders",icon:"receipt-outline",name:"\u9032\u8CA8\u55AE\u7BA1\u7406"},{path:"/vendors",icon:"briefcase-outline",name:"\u5EE0\u5546\u7BA1\u7406"}]},{name:"\u4EA4\u6613\u8207\u5E33\u52D9",icon:"reader-outline",children:[{path:"/ledger",icon:"reader-outline",name:"\u6D41\u6C34\u5E33"}]},{name:"\u884C\u92B7\u8207\u6D3B\u52D5",icon:"megaphone-outline",children:[{path:"/events",icon:"calendar-outline",name:"\u6D3B\u52D5\u7BA1\u7406"}]},{name:"\u80A1\u6771\u8207\u85AA\u8CC7",icon:"people-circle-outline",children:[{path:"/payroll",icon:"card-outline",name:"\u6253\u5361\u85AA\u8CC7"},{path:"/company-profile",icon:"person-outline",name:"\u516C\u53F8\u500B\u4EBA\u8CC7\u6599"},{path:"/shareholder-rebates",icon:"diamond-outline",name:"\u80A1\u6771\u56DE\u994B\u91D1"}]},{name:"\u5354\u4F5C\u7A7A\u9593",icon:"people-outline",children:[{path:"/goal-setting",icon:"trophy-outline",name:"\u5718\u968A\u76EE\u6A19\u8A2D\u5B9A"},{path:"/goal-progress",icon:"flag-outline",name:"\u500B\u4EBA\u76EE\u6A19\u9032\u5EA6"},{path:"/shareholder-records",icon:"document-text-outline",name:"\u500B\u4EBA\u6BCF\u5468\u9032\u5EA6\u7D00\u9304"},{path:"/meeting",icon:"chatbubbles-outline",name:"\u6BCF\u5468\u6703\u8B70\u7D00\u9304"},{path:"/decision-log",icon:"key-outline",name:"\u91CD\u5927\u4E8B\u9805\u4F48\u9054"}]},{name:"\u5E33\u865F\u7BA1\u7406",icon:"person-circle-outline",children:[{path:"/account",icon:"settings-outline",name:"\u5E33\u865F\u8A2D\u5B9A"},{path:"/user-management",icon:"shield-checkmark-outline",name:"\u4F7F\u7528\u8005\u7BA1\u7406"}]}];this.navLinks=$(()=>{if(!this.authService.isAuthenticated())return[];let e=this.allNavLinks.map(t=>{if(t.name!=="\u5E33\u865F\u7BA1\u7406"||!t.children)return t;let i=this.isSuperAdmin()?t.children:t.children.filter(r=>r.path!=="/role-permissions"&&r.path!=="/company-profile"&&r.path!=="/user-management");return G(O({},t),{children:i})});return this.isSuperAdmin()?[...e.slice(0,e.length-1),{name:"\u5E33\u865F\u7BA1\u7406",icon:"person-circle-outline",children:[{path:"/account",icon:"settings-outline",name:"\u5E33\u865F\u8A2D\u5B9A"},{path:"/user-management",icon:"shield-checkmark-outline",name:"\u4F7F\u7528\u8005\u7BA1\u7406"},{path:"/role-permissions",icon:"lock-closed-outline",name:"\u89D2\u8272\u6B0A\u9650\u63A7\u7BA1"}]}]:e})}ngOnInit(){this.isSuperAdmin.set(this.authService.hasRole("super_admin")),this.router.events.pipe(vt(e=>e instanceof cn)).subscribe(()=>{let e=this.navLinks().find(t=>this.isMenuActive(t.children));e&&this.openMenu.set(e.name)})}toggleMenu(e){this.openMenu.update(t=>t===e?null:e)}toggleCollapse(){this.isMobile||this.isCollapsed.update(e=>!e)}onNavigate(){this.isMobile&&this.closeMobile.emit()}isMenuActive(e){return e?e.some(t=>t.path&&this.router.isActive(t.path,{paths:"exact",queryParams:"subset",fragment:"ignored",matrixParams:"ignored"})):!1}};Sa.\u0275fac=function(t){return new(t||Sa)},Sa.\u0275cmp=re({type:Sa,selectors:[["app-sidebar"]],inputs:{isMobile:"isMobile",isMobileOpen:"isMobileOpen"},outputs:{closeMobile:"closeMobile"},decls:14,vars:33,consts:[[1,"flex-shrink-0","bg-white","border-r","border-gray-200","flex","flex-col","overflow-hidden","transition-all","duration-300","ease-in-out"],[1,"h-16","flex","items-center","justify-between","px-4","border-b","border-gray-200","flex-shrink-0"],[1,"flex","items-center","space-x-2"],["src","favicon.png","alt","Galaxy House Finance",1,"w-8","h-8","rounded-md","object-cover"],[1,"text-xl","font-semibold","text-gray-800","whitespace-nowrap"],[1,"p-2","rounded-lg","hover:bg-gray-100","transition-colors","duration-200","flex-shrink-0"],[1,"flex-1","flex","flex-col","overflow-y-auto"],[1,"flex-1","px-2","py-6","space-y-1"],[1,"px-4","py-6","border-t","border-gray-200","flex-shrink-0"],[1,"text-xs","text-center","text-gray-500"],[1,"p-2","rounded-lg","hover:bg-gray-100","transition-colors","duration-200","flex-shrink-0",3,"click"],[1,"text-xl","text-gray-600",3,"name"],["routerLinkActive","bg-indigo-50 text-indigo-600",1,"flex","items-center","px-4","py-2.5","text-gray-600","transition-colors","duration-200","transform","rounded-lg","hover:bg-gray-100","hover:text-gray-800",3,"routerLink","title","routerLinkActiveOptions"],[1,"w-full","flex","items-center","justify-between","px-4","py-2.5","text-gray-600","transition-colors","duration-200","transform","rounded-lg","hover:bg-gray-100","hover:text-gray-800",3,"click","title"],[1,"flex","items-center","flex-1"],[1,"text-xl","flex-shrink-0",3,"name"],[1,"mx-4","font-medium","whitespace-nowrap"],["name","chevron-down-outline",1,"text-sm","transition-transform","duration-300","flex-shrink-0"],[1,"mt-1","ml-4","pl-2","space-y-1","border-l","border-gray-200"],["routerLinkActive","bg-indigo-50 text-indigo-600 font-semibold",1,"flex","items-center","w-full","px-4","py-2","text-sm","text-gray-600","transition-colors","duration-200","transform","rounded-lg","hover:bg-gray-100","hover:text-gray-800",3,"routerLink","routerLinkActiveOptions"],["routerLinkActive","bg-indigo-50 text-indigo-600 font-semibold",1,"flex","items-center","w-full","px-4","py-2","text-sm","text-gray-600","transition-colors","duration-200","transform","rounded-lg","hover:bg-gray-100","hover:text-gray-800",3,"click","routerLink","routerLinkActiveOptions"],[1,"text-lg","flex-shrink-0",3,"name"],[1,"mx-4","font-normal","whitespace-nowrap"],["routerLinkActive","bg-indigo-50 text-indigo-600",1,"flex","items-center","px-4","py-2.5","text-gray-600","transition-colors","duration-200","transform","rounded-lg","hover:bg-gray-100","hover:text-gray-800",3,"click","routerLink","title","routerLinkActiveOptions"]],template:function(t,i){t&1&&(l(0,"aside",0)(1,"div",1)(2,"div",2),x(3,"img",3),l(4,"h1",4),d(5,"GH Finance"),s()(),M(6,E6,2,1,"button",5),s(),l(7,"div",6)(8,"nav",7),V(9,I6,2,1,null,null,x6),s()(),l(11,"div",8)(12,"p",9),d(13,"\xA9 2024 \u5167\u90E8\u7CFB\u7D71"),s()()()),t&2&&(j("fixed",i.isMobile)("inset-y-0",i.isMobile)("left-0",i.isMobile)("h-dvh",i.isMobile)("w-72",i.isMobile)("max-w-[85vw]",i.isMobile)("shadow-2xl",i.isMobile)("-translate-x-full",i.isMobile&&!i.isMobileOpen)("translate-x-0",!i.isMobile||i.isMobileOpen)("relative",!i.isMobile)("h-full",!i.isMobile)("w-64",!i.isMobile&&!i.isCollapsed())("w-20",!i.isMobile&&i.isCollapsed()),m(2),j("opacity-0",i.isCollapsed())("w-0",i.isCollapsed()),m(4),A(i.isMobile?-1:6),m(3),L(i.navLinks()),m(3),j("hidden",!i.isMobile&&i.isCollapsed()))},dependencies:[wr,zh],encapsulation:2,changeDetection:0});var am=Sa;function M6(n,e){if(n&1){let t=B();rt(0,"button",3),xr("click",function(){E(t);let r=_();return S(r.menuToggle.emit())}),Ti(1,"ion-icon",4),ot()}}function A6(n,e){if(n&1&&(rt(0,"div",2)(1,"div",5)(2,"p",6),d(3),ot(),rt(4,"p",7),d(5),ot()(),rt(6,"div",8),Ti(7,"ion-icon",9),ot()()),n&2){let t=e,i=_();m(3),w(t.name),m(),Te(i.getRoleClass((t.roles[0]==null?null:t.roles[0].role_name)||"")),m(),N(" ",(t.roles[0]==null?null:t.roles[0].display_name)||"User"," ")}}var Da=class Da{constructor(){this.isMobile=!1;this.menuToggle=new et;this.authService=k(st)}getRoleClass(e){switch(e){case"super_admin":return"bg-red-100 text-red-800";case"user_manager":return"bg-blue-100 text-blue-800";case"finance_manager":return"bg-green-100 text-green-800";case"operation_manager":return"bg-yellow-100 text-yellow-800";case"viewer":return"bg-gray-100 text-gray-800";default:return"bg-gray-100 text-gray-800"}}};Da.\u0275fac=function(t){return new(t||Da)},Da.\u0275cmp=re({type:Da,selectors:[["app-header"]],inputs:{isMobile:"isMobile"},outputs:{menuToggle:"menuToggle"},decls:3,vars:2,consts:[[1,"h-16","flex-shrink-0","bg-white","border-b","border-gray-200","flex","items-center","justify-between","px-4","sm:px-6"],["type","button","aria-label","\u5207\u63DB\u5074\u908A\u9078\u55AE",1,"inline-flex","items-center","justify-center","rounded-lg","p-2","text-gray-600","transition-colors","hover:bg-gray-100","lg:hidden"],[1,"ml-auto","flex","items-center","gap-3","sm:gap-4"],["type","button","aria-label","\u5207\u63DB\u5074\u908A\u9078\u55AE",1,"inline-flex","items-center","justify-center","rounded-lg","p-2","text-gray-600","transition-colors","hover:bg-gray-100","lg:hidden",3,"click"],["name","menu-outline",1,"text-2xl"],[1,"text-right"],[1,"text-sm","font-semibold","text-gray-800"],[1,"text-xs","font-medium","px-2","py-0.5","rounded-full","inline-block"],[1,"flex","items-center","gap-2"],["name","person-circle-outline",1,"text-3xl","text-gray-500"]],template:function(t,i){if(t&1&&(rt(0,"header",0),M(1,M6,2,0,"button",1),M(2,A6,8,4,"div",2),ot()),t&2){let r;m(),A(i.isMobile?1:-1),m(),A((r=i.authService.currentAdmin())?2:-1,r)}},dependencies:[se],encapsulation:2,changeDetection:0});var sm=Da;function R6(n,e){if(n&1){let t=B();l(0,"button",7),b("click",function(){E(t);let r=_(2);return S(r.closeSidebar())}),s()}}function N6(n,e){if(n&1){let t=B();l(0,"div",0),M(1,R6,1,0,"button",1),l(2,"app-sidebar",2),b("closeMobile",function(){E(t);let r=_();return S(r.closeSidebar())}),s(),l(3,"div",3)(4,"app-header",4),b("menuToggle",function(){E(t);let r=_();return S(r.toggleSidebar())}),s(),l(5,"main",5)(6,"div",6),x(7,"router-outlet"),s()()()()}if(n&2){let t=_();m(),A(t.isMobile()&&t.isSidebarOpen()?1:-1),m(),I("isMobile",t.isMobile())("isMobileOpen",t.isSidebarOpen()),m(2),I("isMobile",t.isMobile())}}function F6(n,e){n&1&&x(0,"router-outlet")}var wa=class wa{constructor(){this.authService=k(st);this.router=k(Fe);this.mobileBreakpoint=1024;this.lastBlockedAt=0;this.pointerDownCaptureHandler=e=>this.onGlobalClickCapture(e);this.captureHandler=e=>this.onGlobalClickCapture(e);this.isMobile=D(!1);this.isSidebarOpen=D(!1)}ngOnInit(){this.updateViewportState(),document.addEventListener("pointerdown",this.pointerDownCaptureHandler,!0),document.addEventListener("click",this.captureHandler,!0),this.routeSub=this.router.events.pipe(vt(e=>e instanceof cn)).subscribe(()=>this.applyViewerUiRestrictions()),this.mutationObserver=new MutationObserver(()=>this.applyViewerUiRestrictions()),this.mutationObserver.observe(document.body,{childList:!0,subtree:!0}),this.applyViewerUiRestrictions()}onResize(){this.updateViewportState()}ngOnDestroy(){document.removeEventListener("pointerdown",this.pointerDownCaptureHandler,!0),document.removeEventListener("click",this.captureHandler,!0),this.routeSub?.unsubscribe(),this.mutationObserver?.disconnect()}toggleSidebar(){this.isMobile()&&this.isSidebarOpen.update(e=>!e)}closeSidebar(){this.isSidebarOpen.set(!1)}updateViewportState(){let e=window.innerWidth<this.mobileBreakpoint;this.isMobile.set(e),e||this.isSidebarOpen.set(!1)}onGlobalClickCapture(e){if(!this.authService.isAuthenticated()||!this.authService.hasRole("viewer"))return;let i=e.target?.closest('button, a, [role="button"]');if(!i||i.closest("app-sidebar")||i.closest("app-header")||this.isViewerAllowedControl(i)||this.isDismissControl(i)||!this.isBlockedInContentArea(i)||i instanceof HTMLButtonElement&&i.disabled)return;e.preventDefault(),e.stopPropagation(),e.stopImmediatePropagation?.();let r=Date.now();r-this.lastBlockedAt>1500&&(this.lastBlockedAt=r,alert("\u6AA2\u8996\u8005\u50C5\u53EF\u8B80\u53D6\u8CC7\u6599\uFF0C\u7121\u6CD5\u57F7\u884C\u65B0\u589E\u3001\u7DE8\u8F2F\u6216\u522A\u9664\u64CD\u4F5C"))}applyViewerUiRestrictions(){if(!this.authService.isAuthenticated()||!this.authService.hasRole("viewer"))return;let e=document.querySelector("main");if(!e)return;e.querySelectorAll('button, a, [role="button"]').forEach(i=>{if(this.isViewerAllowedControl(i)||this.isDismissControl(i)){i.removeAttribute("data-viewer-blocked"),i instanceof HTMLButtonElement&&i.hasAttribute("data-viewer-forced-disabled")&&(i.disabled=!1,i.classList.remove("cursor-not-allowed","opacity-50"),i.removeAttribute("data-viewer-forced-disabled"));return}i instanceof HTMLButtonElement?(i.disabled=!0,i.classList.add("cursor-not-allowed","opacity-50"),i.setAttribute("data-viewer-forced-disabled","true")):i.setAttribute("data-viewer-blocked","true")})}isBlockedInContentArea(e){return!e.closest("main")?!1:!!e.closest('button, a, [role="button"]')}isDismissControl(e){let t=this.getControlText(e),i=(e.getAttribute("title")||"").trim(),r=Array.from(e.querySelectorAll("ion-icon")).map(a=>a.getAttribute("name")||"");if(/||||/.test(t)||/|/.test(i))return!0;let o=["close-outline","close-circle-outline","arrow-back-outline"];return r.some(a=>o.includes(a))}isViewerAllowedControl(e){let t=this.getControlText(e),i=(e.getAttribute("title")||"").trim(),r=e.getAttribute?.("href")||"";return!!(e.closest('[data-viewer-allow="true"]')||/|||||||/.test(t)||/|||/.test(i)||r.includes("/login")||r.includes("/dashboard"))}isMutationAction(e){let t=this.getControlText(e),i=(e.getAttribute("title")||"").trim(),r=e.getAttribute?.("href")||"",o=Array.from(e.querySelectorAll("ion-icon")).map(c=>c.getAttribute("name")||"");if(["\u65B0\u589E","\u7DE8\u8F2F","\u522A\u9664","\u5132\u5B58","\u4FDD\u5B58","\u66F4\u65B0","\u78BA\u8A8D\u522A\u9664","\u63D0\u4EA4","\u9001\u51FA","\u5EFA\u7ACB","\u767C\u653E","\u652F\u4ED8","\u91CB\u653E"].some(c=>t.includes(c)||i.includes(c))||r.includes("/new")||r.includes("/edit/"))return!0;let u=["add-outline","create-outline","trash-outline","save-outline","checkmark-outline"];return o.some(c=>u.includes(c))}getControlText(e){return(e.textContent||"").replace(/\s+/g,"").trim()}};wa.\u0275fac=function(t){return new(t||wa)},wa.\u0275cmp=re({type:wa,selectors:[["app-root"]],hostBindings:function(t,i){t&1&&b("resize",function(){return i.onResize()},ag)},decls:2,vars:1,consts:[[1,"relative","flex","h-dvh","bg-gray-100","overflow-hidden"],["type","button","aria-label","\u95DC\u9589\u5074\u908A\u9078\u55AE",1,"fixed","inset-0","z-30","bg-black/40","lg:hidden"],[1,"z-40",3,"closeMobile","isMobile","isMobileOpen"],[1,"flex","min-w-0","flex-1","flex-col","overflow-hidden"],[3,"menuToggle","isMobile"],[1,"flex-1","overflow-x-auto","overflow-y-auto","bg-gray-50"],[1,"container","mx-auto","max-w-full","px-4","py-4","sm:px-6","sm:py-6","lg:px-8","lg:py-8"],["type","button","aria-label","\u95DC\u9589\u5074\u908A\u9078\u55AE",1,"fixed","inset-0","z-30","bg-black/40","lg:hidden",3,"click"]],template:function(t,i){t&1&&M(0,N6,8,4,"div",0)(1,F6,1,0,"router-outlet"),t&2&&A(i.authService.isAuthenticated()?0:1)},dependencies:[Vl,am,sm,se],encapsulation:2,changeDetection:0});var lm=wa;var FE=(()=>{class n{_renderer;_elementRef;onChange=t=>{};onTouched=()=>{};constructor(t,i){this._renderer=t,this._elementRef=i}setProperty(t,i){this._renderer.setProperty(this._elementRef.nativeElement,t,i)}registerOnTouched(t){this.onTouched=t}registerOnChange(t){this.onChange=t}setDisabledState(t){this.setProperty("disabled",t)}static \u0275fac=function(i){return new(i||n)(ee(ai),ee(an))};static \u0275dir=Ne({type:n})}return n})(),jl=(()=>{class n extends FE{static \u0275fac=(()=>{let t;return function(r){return(t||(t=Zt(n)))(r||n)}})();static \u0275dir=Ne({type:n,features:[ft]})}return n})(),yo=new ne(""),P6={provide:yo,useExisting:Et(()=>Xi),multi:!0},Xi=(()=>{class n extends jl{writeValue(t){this.setProperty("checked",t)}static \u0275fac=(()=>{let t;return function(r){return(t||(t=Zt(n)))(r||n)}})();static \u0275dir=Ne({type:n,selectors:[["input","type","checkbox","formControlName",""],["input","type","checkbox","formControl",""],["input","type","checkbox","ngModel",""]],hostBindings:function(i,r){i&1&&b("change",function(a){return r.onChange(a.target.checked)})("blur",function(){return r.onTouched()})},standalone:!1,features:[Ut([P6]),ft]})}return n})(),k6={provide:yo,useExisting:Et(()=>be),multi:!0};function V6(){let n=Un()?Un().getUserAgent():"";return/android (\d+)/.test(n.toLowerCase())}var L6=new ne(""),be=(()=>{class n extends FE{_compositionMode;_composing=!1;constructor(t,i,r){super(t,i),this._compositionMode=r,this._compositionMode==null&&(this._compositionMode=!V6())}writeValue(t){let i=t??"";this.setProperty("value",i)}_handleInput(t){(!this._compositionMode||this._compositionMode&&!this._composing)&&this.onChange(t)}_compositionStart(){this._composing=!0}_compositionEnd(t){this._composing=!1,this._compositionMode&&this.onChange(t)}static \u0275fac=function(i){return new(i||n)(ee(ai),ee(an),ee(L6,8))};static \u0275dir=Ne({type:n,selectors:[["input","formControlName","",3,"type","checkbox"],["textarea","formControlName",""],["input","formControl","",3,"type","checkbox"],["textarea","formControl",""],["input","ngModel","",3,"type","checkbox"],["textarea","ngModel",""],["","ngDefaultControl",""]],hostBindings:function(i,r){i&1&&b("input",function(a){return r._handleInput(a.target.value)})("blur",function(){return r.onTouched()})("compositionstart",function(){return r._compositionStart()})("compositionend",function(a){return r._compositionEnd(a.target.value)})},standalone:!1,features:[Ut([k6]),ft]})}return n})();function ey(n){return n==null||ty(n)===0}function ty(n){return n==null?null:Array.isArray(n)||typeof n=="string"?n.length:n instanceof Set?n.size:null}var mi=new ne(""),Ra=new ne(""),O6=/^(?=.{1,254}$)(?=.{1,64}@)[a-zA-Z0-9!#$%&'*+/=?^_`{|}~-]+(?:\.[a-zA-Z0-9!#$%&'*+/=?^_`{|}~-]+)*@[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)*$/,U=class{static min(e){return PE(e)}static max(e){return kE(e)}static required(e){return VE(e)}static requiredTrue(e){return B6(e)}static email(e){return U6(e)}static minLength(e){return $6(e)}static maxLength(e){return LE(e)}static pattern(e){return OE(e)}static nullValidator(e){return dm()}static compose(e){return qE(e)}static composeAsync(e){return WE(e)}};function PE(n){return e=>{if(e.value==null||n==null)return null;let t=parseFloat(e.value);return!isNaN(t)&&t<n?{min:{min:n,actual:e.value}}:null}}function kE(n){return e=>{if(e.value==null||n==null)return null;let t=parseFloat(e.value);return!isNaN(t)&&t>n?{max:{max:n,actual:e.value}}:null}}function VE(n){return ey(n.value)?{required:!0}:null}function B6(n){return n.value===!0?null:{required:!0}}function U6(n){return ey(n.value)||O6.test(n.value)?null:{email:!0}}function $6(n){return e=>{let t=e.value?.length??ty(e.value);return t===null||t===0?null:t<n?{minlength:{requiredLength:n,actualLength:t}}:null}}function LE(n){return e=>{let t=e.value?.length??ty(e.value);return t!==null&&t>n?{maxlength:{requiredLength:n,actualLength:t}}:null}}function OE(n){if(!n)return dm;let e,t;return typeof n=="string"?(t="",n.charAt(0)!=="^"&&(t+="^"),t+=n,n.charAt(n.length-1)!=="$"&&(t+="$"),e=new RegExp(t)):(t=n.toString(),e=n),i=>{if(ey(i.value))return null;let r=i.value;return e.test(r)?null:{pattern:{requiredPattern:t,actualValue:r}}}}function dm(n){return null}function BE(n){return n!=null}function UE(n){return Cr(n)?mt(n):n}function $E(n){let e={};return n.forEach(t=>{e=t!=null?O(O({},e),t):e}),Object.keys(e).length===0?null:e}function HE(n,e){return e.map(t=>t(n))}function H6(n){return!n.validate}function GE(n){return n.map(e=>H6(e)?e:t=>e.validate(t))}function qE(n){if(!n)return null;let e=n.filter(BE);return e.length==0?null:function(t){return $E(HE(t,e))}}function ny(n){return n!=null?qE(GE(n)):null}function WE(n){if(!n)return null;let e=n.filter(BE);return e.length==0?null:function(t){let i=HE(t,e).map(UE);return t0(i).pipe(ve($E))}}function iy(n){return n!=null?WE(GE(n)):null}function SE(n,e){return n===null?[e]:Array.isArray(n)?[...n,e]:[n,e]}function jE(n){return n._rawValidators}function zE(n){return n._rawAsyncValidators}function Qh(n){return n?Array.isArray(n)?n:[n]:[]}function cm(n,e){return Array.isArray(n)?n.includes(e):n===e}function DE(n,e){let t=Qh(e);return Qh(n).forEach(r=>{cm(t,r)||t.push(r)}),t}function wE(n,e){return Qh(e).filter(t=>!cm(n,t))}var mm=class{get value(){return this.control?this.control.value:null}get valid(){return this.control?this.control.valid:null}get invalid(){return this.control?this.control.invalid:null}get pending(){return this.control?this.control.pending:null}get disabled(){return this.control?this.control.disabled:null}get enabled(){return this.control?this.control.enabled:null}get errors(){return this.control?this.control.errors:null}get pristine(){return this.control?this.control.pristine:null}get dirty(){return this.control?this.control.dirty:null}get touched(){return this.control?this.control.touched:null}get status(){return this.control?this.control.status:null}get untouched(){return this.control?this.control.untouched:null}get statusChanges(){return this.control?this.control.statusChanges:null}get valueChanges(){return this.control?this.control.valueChanges:null}get path(){return null}_composedValidatorFn;_composedAsyncValidatorFn;_rawValidators=[];_rawAsyncValidators=[];_setValidators(e){this._rawValidators=e||[],this._composedValidatorFn=ny(this._rawValidators)}_setAsyncValidators(e){this._rawAsyncValidators=e||[],this._composedAsyncValidatorFn=iy(this._rawAsyncValidators)}get validator(){return this._composedValidatorFn||null}get asyncValidator(){return this._composedAsyncValidatorFn||null}_onDestroyCallbacks=[];_registerOnDestroy(e){this._onDestroyCallbacks.push(e)}_invokeOnDestroyCallbacks(){this._onDestroyCallbacks.forEach(e=>e()),this._onDestroyCallbacks=[]}reset(e=void 0){this.control&&this.control.reset(e)}hasError(e,t){return this.control?this.control.hasError(e,t):!1}getError(e,t){return this.control?this.control.getError(e,t):null}},pn=class extends mm{name;get formDirective(){return null}get path(){return null}},ho=class extends mm{_parent=null;name=null;valueAccessor=null},pm=class{_cd;constructor(e){this._cd=e}get isTouched(){return this._cd?.control?._touched?.(),!!this._cd?.control?.touched}get isUntouched(){return!!this._cd?.control?.untouched}get isPristine(){return this._cd?.control?._pristine?.(),!!this._cd?.control?.pristine}get isDirty(){return!!this._cd?.control?.dirty}get isValid(){return this._cd?.control?._status?.(),!!this._cd?.control?.valid}get isInvalid(){return!!this._cd?.control?.invalid}get isPending(){return!!this._cd?.control?.pending}get isSubmitted(){return this._cd?._submitted?.(),!!this._cd?.submitted}},G6={"[class.ng-untouched]":"isUntouched","[class.ng-touched]":"isTouched","[class.ng-pristine]":"isPristine","[class.ng-dirty]":"isDirty","[class.ng-valid]":"isValid","[class.ng-invalid]":"isInvalid","[class.ng-pending]":"isPending"},yue=G(O({},G6),{"[class.ng-submitted]":"isSubmitted"}),fe=(()=>{class n extends pm{constructor(t){super(t)}static \u0275fac=function(i){return new(i||n)(ee(ho,2))};static \u0275dir=Ne({type:n,selectors:[["","formControlName",""],["","ngModel",""],["","formControl",""]],hostVars:14,hostBindings:function(i,r){i&2&&j("ng-untouched",r.isUntouched)("ng-touched",r.isTouched)("ng-pristine",r.isPristine)("ng-dirty",r.isDirty)("ng-valid",r.isValid)("ng-invalid",r.isInvalid)("ng-pending",r.isPending)},standalone:!1,features:[ft]})}return n})(),ke=(()=>{class n extends pm{constructor(t){super(t)}static \u0275fac=function(i){return new(i||n)(ee(pn,10))};static \u0275dir=Ne({type:n,selectors:[["","formGroupName",""],["","formArrayName",""],["","ngModelGroup",""],["","formGroup",""],["form",3,"ngNoForm",""],["","ngForm",""]],hostVars:16,hostBindings:function(i,r){i&2&&j("ng-untouched",r.isUntouched)("ng-touched",r.isTouched)("ng-pristine",r.isPristine)("ng-dirty",r.isDirty)("ng-valid",r.isValid)("ng-invalid",r.isInvalid)("ng-pending",r.isPending)("ng-submitted",r.isSubmitted)},standalone:!1,features:[ft]})}return n})();var Bl="VALID",um="INVALID",Ta="PENDING",Ul="DISABLED",Tr=class{},fm=class extends Tr{value;source;constructor(e,t){super(),this.value=e,this.source=t}},Hl=class extends Tr{pristine;source;constructor(e,t){super(),this.pristine=e,this.source=t}},Gl=class extends Tr{touched;source;constructor(e,t){super(),this.touched=e,this.source=t}},Ia=class extends Tr{status;source;constructor(e,t){super(),this.status=e,this.source=t}},gm=class extends Tr{source;constructor(e){super(),this.source=e}},Wl=class extends Tr{source;constructor(e){super(),this.source=e}};function ry(n){return(vm(n)?n.validators:n)||null}function q6(n){return Array.isArray(n)?ny(n):n||null}function oy(n,e){return(vm(e)?e.asyncValidators:n)||null}function W6(n){return Array.isArray(n)?iy(n):n||null}function vm(n){return n!=null&&!Array.isArray(n)&&typeof n=="object"}function YE(n,e,t){let i=n.controls;if(!(e?Object.keys(i):i).length)throw new z(1e3,"");if(!i[t])throw new z(1001,"")}function JE(n,e,t){n._forEachChild((i,r)=>{if(t[r]===void 0)throw new z(1002,"")})}var Ma=class{_pendingDirty=!1;_hasOwnPendingAsyncValidator=null;_pendingTouched=!1;_onCollectionChange=()=>{};_updateOn;_parent=null;_asyncValidationSubscription;_composedValidatorFn;_composedAsyncValidatorFn;_rawValidators;_rawAsyncValidators;value;constructor(e,t){this._assignValidators(e),this._assignAsyncValidators(t)}get validator(){return this._composedValidatorFn}set validator(e){this._rawValidators=this._composedValidatorFn=e}get asyncValidator(){return this._composedAsyncValidatorFn}set asyncValidator(e){this._rawAsyncValidators=this._composedAsyncValidatorFn=e}get parent(){return this._parent}get status(){return Ot(this.statusReactive)}set status(e){Ot(()=>this.statusReactive.set(e))}_status=$(()=>this.statusReactive());statusReactive=D(void 0);get valid(){return this.status===Bl}get invalid(){return this.status===um}get pending(){return this.status==Ta}get disabled(){return this.status===Ul}get enabled(){return this.status!==Ul}errors;get pristine(){return Ot(this.pristineReactive)}set pristine(e){Ot(()=>this.pristineReactive.set(e))}_pristine=$(()=>this.pristineReactive());pristineReactive=D(!0);get dirty(){return!this.pristine}get touched(){return Ot(this.touchedReactive)}set touched(e){Ot(()=>this.touchedReactive.set(e))}_touched=$(()=>this.touchedReactive());touchedReactive=D(!1);get untouched(){return!this.touched}_events=new bt;events=this._events.asObservable();valueChanges;statusChanges;get updateOn(){return this._updateOn?this._updateOn:this.parent?this.parent.updateOn:"change"}setValidators(e){this._assignValidators(e)}setAsyncValidators(e){this._assignAsyncValidators(e)}addValidators(e){this.setValidators(DE(e,this._rawValidators))}addAsyncValidators(e){this.setAsyncValidators(DE(e,this._rawAsyncValidators))}removeValidators(e){this.setValidators(wE(e,this._rawValidators))}removeAsyncValidators(e){this.setAsyncValidators(wE(e,this._rawAsyncValidators))}hasValidator(e){return cm(this._rawValidators,e)}hasAsyncValidator(e){return cm(this._rawAsyncValidators,e)}clearValidators(){this.validator=null}clearAsyncValidators(){this.asyncValidator=null}markAsTouched(e={}){let t=this.touched===!1;this.touched=!0;let i=e.sourceControl??this;this._parent&&!e.onlySelf&&this._parent.markAsTouched(G(O({},e),{sourceControl:i})),t&&e.emitEvent!==!1&&this._events.next(new Gl(!0,i))}markAllAsDirty(e={}){this.markAsDirty({onlySelf:!0,emitEvent:e.emitEvent,sourceControl:this}),this._forEachChild(t=>t.markAllAsDirty(e))}markAllAsTouched(e={}){this.markAsTouched({onlySelf:!0,emitEvent:e.emitEvent,sourceControl:this}),this._forEachChild(t=>t.markAllAsTouched(e))}markAsUntouched(e={}){let t=this.touched===!0;this.touched=!1,this._pendingTouched=!1;let i=e.sourceControl??this;this._forEachChild(r=>{r.markAsUntouched({onlySelf:!0,emitEvent:e.emitEvent,sourceControl:i})}),this._parent&&!e.onlySelf&&this._parent._updateTouched(e,i),t&&e.emitEvent!==!1&&this._events.next(new Gl(!1,i))}markAsDirty(e={}){let t=this.pristine===!0;this.pristine=!1;let i=e.sourceControl??this;this._parent&&!e.onlySelf&&this._parent.markAsDirty(G(O({},e),{sourceControl:i})),t&&e.emitEvent!==!1&&this._events.next(new Hl(!1,i))}markAsPristine(e={}){let t=this.pristine===!1;this.pristine=!0,this._pendingDirty=!1;let i=e.sourceControl??this;this._forEachChild(r=>{r.markAsPristine({onlySelf:!0,emitEvent:e.emitEvent})}),this._parent&&!e.onlySelf&&this._parent._updatePristine(e,i),t&&e.emitEvent!==!1&&this._events.next(new Hl(!0,i))}markAsPending(e={}){this.status=Ta;let t=e.sourceControl??this;e.emitEvent!==!1&&(this._events.next(new Ia(this.status,t)),this.statusChanges.emit(this.status)),this._parent&&!e.onlySelf&&this._parent.markAsPending(G(O({},e),{sourceControl:t}))}disable(e={}){let t=this._parentMarkedDirty(e.onlySelf);this.status=Ul,this.errors=null,this._forEachChild(r=>{r.disable(G(O({},e),{onlySelf:!0}))}),this._updateValue();let i=e.sourceControl??this;e.emitEvent!==!1&&(this._events.next(new fm(this.value,i)),this._events.next(new Ia(this.status,i)),this.valueChanges.emit(this.value),this.statusChanges.emit(this.status)),this._updateAncestors(G(O({},e),{skipPristineCheck:t}),this),this._onDisabledChange.forEach(r=>r(!0))}enable(e={}){let t=this._parentMarkedDirty(e.onlySelf);this.status=Bl,this._forEachChild(i=>{i.enable(G(O({},e),{onlySelf:!0}))}),this.updateValueAndValidity({onlySelf:!0,emitEvent:e.emitEvent}),this._updateAncestors(G(O({},e),{skipPristineCheck:t}),this),this._onDisabledChange.forEach(i=>i(!1))}_updateAncestors(e,t){this._parent&&!e.onlySelf&&(this._parent.updateValueAndValidity(e),e.skipPristineCheck||this._parent._updatePristine({},t),this._parent._updateTouched({},t))}setParent(e){this._parent=e}getRawValue(){return this.value}updateValueAndValidity(e={}){if(this._setInitialStatus(),this._updateValue(),this.enabled){let i=this._cancelExistingSubscription();this.errors=this._runValidator(),this.status=this._calculateStatus(),(this.status===Bl||this.status===Ta)&&this._runAsyncValidator(i,e.emitEvent)}let t=e.sourceControl??this;e.emitEvent!==!1&&(this._events.next(new fm(this.value,t)),this._events.next(new Ia(this.status,t)),this.valueChanges.emit(this.value),this.statusChanges.emit(this.status)),this._parent&&!e.onlySelf&&this._parent.updateValueAndValidity(G(O({},e),{sourceControl:t}))}_updateTreeValidity(e={emitEvent:!0}){this._forEachChild(t=>t._updateTreeValidity(e)),this.updateValueAndValidity({onlySelf:!0,emitEvent:e.emitEvent})}_setInitialStatus(){this.status=this._allControlsDisabled()?Ul:Bl}_runValidator(){return this.validator?this.validator(this):null}_runAsyncValidator(e,t){if(this.asyncValidator){this.status=Ta,this._hasOwnPendingAsyncValidator={emitEvent:t!==!1,shouldHaveEmitted:e!==!1};let i=UE(this.asyncValidator(this));this._asyncValidationSubscription=i.subscribe(r=>{this._hasOwnPendingAsyncValidator=null,this.setErrors(r,{emitEvent:t,shouldHaveEmitted:e})})}}_cancelExistingSubscription(){if(this._asyncValidationSubscription){this._asyncValidationSubscription.unsubscribe();let e=(this._hasOwnPendingAsyncValidator?.emitEvent||this._hasOwnPendingAsyncValidator?.shouldHaveEmitted)??!1;return this._hasOwnPendingAsyncValidator=null,e}return!1}setErrors(e,t={}){this.errors=e,this._updateControlsErrors(t.emitEvent!==!1,this,t.shouldHaveEmitted)}get(e){let t=e;return t==null||(Array.isArray(t)||(t=t.split(".")),t.length===0)?null:t.reduce((i,r)=>i&&i._find(r),this)}getError(e,t){let i=t?this.get(t):this;return i&&i.errors?i.errors[e]:null}hasError(e,t){return!!this.getError(e,t)}get root(){let e=this;for(;e._parent;)e=e._parent;return e}_updateControlsErrors(e,t,i){this.status=this._calculateStatus(),e&&this.statusChanges.emit(this.status),(e||i)&&this._events.next(new Ia(this.status,t)),this._parent&&this._parent._updateControlsErrors(e,t,i)}_initObservables(){this.valueChanges=new et,this.statusChanges=new et}_calculateStatus(){return this._allControlsDisabled()?Ul:this.errors?um:this._hasOwnPendingAsyncValidator||this._anyControlsHaveStatus(Ta)?Ta:this._anyControlsHaveStatus(um)?um:Bl}_anyControlsHaveStatus(e){return this._anyControls(t=>t.status===e)}_anyControlsDirty(){return this._anyControls(e=>e.dirty)}_anyControlsTouched(){return this._anyControls(e=>e.touched)}_updatePristine(e,t){let i=!this._anyControlsDirty(),r=this.pristine!==i;this.pristine=i,this._parent&&!e.onlySelf&&this._parent._updatePristine(e,t),r&&this._events.next(new Hl(this.pristine,t))}_updateTouched(e={},t){this.touched=this._anyControlsTouched(),this._events.next(new Gl(this.touched,t)),this._parent&&!e.onlySelf&&this._parent._updateTouched(e,t)}_onDisabledChange=[];_registerOnCollectionChange(e){this._onCollectionChange=e}_setUpdateStrategy(e){vm(e)&&e.updateOn!=null&&(this._updateOn=e.updateOn)}_parentMarkedDirty(e){let t=this._parent&&this._parent.dirty;return!e&&!!t&&!this._parent._anyControlsDirty()}_find(e){return null}_assignValidators(e){this._rawValidators=Array.isArray(e)?e.slice():e,this._composedValidatorFn=q6(this._rawValidators)}_assignAsyncValidators(e){this._rawAsyncValidators=Array.isArray(e)?e.slice():e,this._composedAsyncValidatorFn=W6(this._rawAsyncValidators)}},Aa=class extends Ma{constructor(e,t,i){super(ry(t),oy(i,t)),this.controls=e,this._initObservables(),this._setUpdateStrategy(t),this._setUpControls(),this.updateValueAndValidity({onlySelf:!0,emitEvent:!!this.asyncValidator})}controls;registerControl(e,t){return this.controls[e]?this.controls[e]:(this.controls[e]=t,t.setParent(this),t._registerOnCollectionChange(this._onCollectionChange),t)}addControl(e,t,i={}){this.registerControl(e,t),this.updateValueAndValidity({emitEvent:i.emitEvent}),this._onCollectionChange()}removeControl(e,t={}){this.controls[e]&&this.controls[e]._registerOnCollectionChange(()=>{}),delete this.controls[e],this.updateValueAndValidity({emitEvent:t.emitEvent}),this._onCollectionChange()}setControl(e,t,i={}){this.controls[e]&&this.controls[e]._registerOnCollectionChange(()=>{}),delete this.controls[e],t&&this.registerControl(e,t),this.updateValueAndValidity({emitEvent:i.emitEvent}),this._onCollectionChange()}contains(e){return this.controls.hasOwnProperty(e)&&this.controls[e].enabled}setValue(e,t={}){JE(this,!0,e),Object.keys(e).forEach(i=>{YE(this,!0,i),this.controls[i].setValue(e[i],{onlySelf:!0,emitEvent:t.emitEvent})}),this.updateValueAndValidity(t)}patchValue(e,t={}){e!=null&&(Object.keys(e).forEach(i=>{let r=this.controls[i];r&&r.patchValue(e[i],{onlySelf:!0,emitEvent:t.emitEvent})}),this.updateValueAndValidity(t))}reset(e={},t={}){this._forEachChild((i,r)=>{i.reset(e?e[r]:null,{onlySelf:!0,emitEvent:t.emitEvent})}),this._updatePristine(t,this),this._updateTouched(t,this),this.updateValueAndValidity(t),t?.emitEvent!==!1&&this._events.next(new Wl(this))}getRawValue(){return this._reduceChildren({},(e,t,i)=>(e[i]=t.getRawValue(),e))}_syncPendingControls(){let e=this._reduceChildren(!1,(t,i)=>i._syncPendingControls()?!0:t);return e&&this.updateValueAndValidity({onlySelf:!0}),e}_forEachChild(e){Object.keys(this.controls).forEach(t=>{let i=this.controls[t];i&&e(i,t)})}_setUpControls(){this._forEachChild(e=>{e.setParent(this),e._registerOnCollectionChange(this._onCollectionChange)})}_updateValue(){this.value=this._reduceValue()}_anyControls(e){for(let[t,i]of Object.entries(this.controls))if(this.contains(t)&&e(i))return!0;return!1}_reduceValue(){let e={};return this._reduceChildren(e,(t,i,r)=>((i.enabled||this.disabled)&&(t[r]=i.value),t))}_reduceChildren(e,t){let i=e;return this._forEachChild((r,o)=>{i=t(i,r,o)}),i}_allControlsDisabled(){for(let e of Object.keys(this.controls))if(this.controls[e].enabled)return!1;return Object.keys(this.controls).length>0||this.disabled}_find(e){return this.controls.hasOwnProperty(e)?this.controls[e]:null}};var Zh=class extends Aa{};var zl=new ne("",{providedIn:"root",factory:()=>Cm}),Cm="always";function xm(n,e){return[...e.path,n]}function hm(n,e,t=Cm){ay(n,e),e.valueAccessor.writeValue(n.value),(n.disabled||t==="always")&&e.valueAccessor.setDisabledState?.(n.disabled),z6(n,e),J6(n,e),Y6(n,e),j6(n,e)}function TE(n,e,t=!0){let i=()=>{};e.valueAccessor&&(e.valueAccessor.registerOnChange(i),e.valueAccessor.registerOnTouched(i)),_m(n,e),n&&(e._invokeOnDestroyCallbacks(),n._registerOnCollectionChange(()=>{}))}function ym(n,e){n.forEach(t=>{t.registerOnValidatorChange&&t.registerOnValidatorChange(e)})}function j6(n,e){if(e.valueAccessor.setDisabledState){let t=i=>{e.valueAccessor.setDisabledState(i)};n.registerOnDisabledChange(t),e._registerOnDestroy(()=>{n._unregisterOnDisabledChange(t)})}}function ay(n,e){let t=jE(n);e.validator!==null?n.setValidators(SE(t,e.validator)):typeof t=="function"&&n.setValidators([t]);let i=zE(n);e.asyncValidator!==null?n.setAsyncValidators(SE(i,e.asyncValidator)):typeof i=="function"&&n.setAsyncValidators([i]);let r=()=>n.updateValueAndValidity();ym(e._rawValidators,r),ym(e._rawAsyncValidators,r)}function _m(n,e){let t=!1;if(n!==null){if(e.validator!==null){let r=jE(n);if(Array.isArray(r)&&r.length>0){let o=r.filter(a=>a!==e.validator);o.length!==r.length&&(t=!0,n.setValidators(o))}}if(e.asyncValidator!==null){let r=zE(n);if(Array.isArray(r)&&r.length>0){let o=r.filter(a=>a!==e.asyncValidator);o.length!==r.length&&(t=!0,n.setAsyncValidators(o))}}}let i=()=>{};return ym(e._rawValidators,i),ym(e._rawAsyncValidators,i),t}function z6(n,e){e.valueAccessor.registerOnChange(t=>{n._pendingValue=t,n._pendingChange=!0,n._pendingDirty=!0,n.updateOn==="change"&&KE(n,e)})}function Y6(n,e){e.valueAccessor.registerOnTouched(()=>{n._pendingTouched=!0,n.updateOn==="blur"&&n._pendingChange&&KE(n,e),n.updateOn!=="submit"&&n.markAsTouched()})}function KE(n,e){n._pendingDirty&&n.markAsDirty(),n.setValue(n._pendingValue,{emitModelToViewChange:!1}),e.viewToModelUpdate(n._pendingValue),n._pendingChange=!1}function J6(n,e){let t=(i,r)=>{e.valueAccessor.writeValue(i),r&&e.viewToModelUpdate(i)};n.registerOnChange(t),e._registerOnDestroy(()=>{n._unregisterOnChange(t)})}function QE(n,e){n==null,ay(n,e)}function K6(n,e){return _m(n,e)}function ZE(n,e){if(!n.hasOwnProperty("model"))return!1;let t=n.model;return t.isFirstChange()?!0:!Object.is(e,t.currentValue)}function Q6(n){return Object.getPrototypeOf(n.constructor)===jl}function XE(n,e){n._syncPendingControls(),e.forEach(t=>{let i=t.control;i.updateOn==="submit"&&i._pendingChange&&(t.viewToModelUpdate(i._pendingValue),i._pendingChange=!1)})}function e2(n,e){if(!e)return null;Array.isArray(e);let t,i,r;return e.forEach(o=>{o.constructor===be?t=o:Q6(o)?i=o:r=o}),r||i||t||null}function Z6(n,e){let t=n.indexOf(e);t>-1&&n.splice(t,1)}var X6={provide:pn,useExisting:Et(()=>Yl)},$l=Promise.resolve(),Yl=(()=>{class n extends pn{callSetDisabledState;get submitted(){return Ot(this.submittedReactive)}_submitted=$(()=>this.submittedReactive());submittedReactive=D(!1);_directives=new Set;form;ngSubmit=new et;options;constructor(t,i,r){super(),this.callSetDisabledState=r,this.form=new Aa({},ny(t),iy(i))}ngAfterViewInit(){this._setUpdateStrategy()}get formDirective(){return this}get control(){return this.form}get path(){return[]}get controls(){return this.form.controls}addControl(t){$l.then(()=>{let i=this._findContainer(t.path);t.control=i.registerControl(t.name,t.control),hm(t.control,t,this.callSetDisabledState),t.control.updateValueAndValidity({emitEvent:!1}),this._directives.add(t)})}getControl(t){return this.form.get(t.path)}removeControl(t){$l.then(()=>{let i=this._findContainer(t.path);i&&i.removeControl(t.name),this._directives.delete(t)})}addFormGroup(t){$l.then(()=>{let i=this._findContainer(t.path),r=new Aa({});QE(r,t),i.registerControl(t.name,r),r.updateValueAndValidity({emitEvent:!1})})}removeFormGroup(t){$l.then(()=>{let i=this._findContainer(t.path);i&&i.removeControl(t.name)})}getFormGroup(t){return this.form.get(t.path)}updateModel(t,i){$l.then(()=>{this.form.get(t.path).setValue(i)})}setValue(t){this.control.setValue(t)}onSubmit(t){return this.submittedReactive.set(!0),XE(this.form,this._directives),this.ngSubmit.emit(t),this.form._events.next(new gm(this.control)),t?.target?.method==="dialog"}onReset(){this.resetForm()}resetForm(t=void 0){this.form.reset(t),this.submittedReactive.set(!1)}_setUpdateStrategy(){this.options&&this.options.updateOn!=null&&(this.form._updateOn=this.options.updateOn)}_findContainer(t){return t.pop(),t.length?this.form.get(t):this.form}static \u0275fac=function(i){return new(i||n)(ee(mi,10),ee(Ra,10),ee(zl,8))};static \u0275dir=Ne({type:n,selectors:[["form",3,"ngNoForm","",3,"formGroup",""],["ng-form"],["","ngForm",""]],hostBindings:function(i,r){i&1&&b("submit",function(a){return r.onSubmit(a)})("reset",function(){return r.onReset()})},inputs:{options:[0,"ngFormOptions","options"]},outputs:{ngSubmit:"ngSubmit"},exportAs:["ngForm"],standalone:!1,features:[Ut([X6]),ft]})}return n})();function IE(n,e){let t=n.indexOf(e);t>-1&&n.splice(t,1)}function ME(n){return typeof n=="object"&&n!==null&&Object.keys(n).length===2&&"value"in n&&"disabled"in n}var ql=class extends Ma{defaultValue=null;_onChange=[];_pendingValue;_pendingChange=!1;constructor(e=null,t,i){super(ry(t),oy(i,t)),this._applyFormState(e),this._setUpdateStrategy(t),this._initObservables(),this.updateValueAndValidity({onlySelf:!0,emitEvent:!!this.asyncValidator}),vm(t)&&(t.nonNullable||t.initialValueIsDefault)&&(ME(e)?this.defaultValue=e.value:this.defaultValue=e)}setValue(e,t={}){this.value=this._pendingValue=e,this._onChange.length&&t.emitModelToViewChange!==!1&&this._onChange.forEach(i=>i(this.value,t.emitViewToModelChange!==!1)),this.updateValueAndValidity(t)}patchValue(e,t={}){this.setValue(e,t)}reset(e=this.defaultValue,t={}){this._applyFormState(e),this.markAsPristine(t),this.markAsUntouched(t),this.setValue(this.value,t),this._pendingChange=!1,t?.emitEvent!==!1&&this._events.next(new Wl(this))}_updateValue(){}_anyControls(e){return!1}_allControlsDisabled(){return this.disabled}registerOnChange(e){this._onChange.push(e)}_unregisterOnChange(e){IE(this._onChange,e)}registerOnDisabledChange(e){this._onDisabledChange.push(e)}_unregisterOnDisabledChange(e){IE(this._onDisabledChange,e)}_forEachChild(e){}_syncPendingControls(){return this.updateOn==="submit"&&(this._pendingDirty&&this.markAsDirty(),this._pendingTouched&&this.markAsTouched(),this._pendingChange)?(this.setValue(this._pendingValue,{onlySelf:!0,emitModelToViewChange:!1}),!0):!1}_applyFormState(e){ME(e)?(this.value=this._pendingValue=e.value,e.disabled?this.disable({onlySelf:!0,emitEvent:!1}):this.enable({onlySelf:!0,emitEvent:!1})):this.value=this._pendingValue=e}};var e4=n=>n instanceof ql,t4=(()=>{class n extends pn{_parent;ngOnInit(){this._checkParentType(),this.formDirective.addFormGroup(this)}ngOnDestroy(){this.formDirective&&this.formDirective.removeFormGroup(this)}get control(){return this.formDirective.getFormGroup(this)}get path(){return xm(this.name==null?this.name:this.name.toString(),this._parent)}get formDirective(){return this._parent?this._parent.formDirective:null}_checkParentType(){}static \u0275fac=(()=>{let t;return function(r){return(t||(t=Zt(n)))(r||n)}})();static \u0275dir=Ne({type:n,standalone:!1,features:[ft]})}return n})();var n4={provide:ho,useExisting:Et(()=>Ie)},AE=Promise.resolve(),Ie=(()=>{class n extends ho{_changeDetectorRef;callSetDisabledState;control=new ql;static ngAcceptInputType_isDisabled;_registered=!1;viewModel;name="";isDisabled;model;options;update=new et;constructor(t,i,r,o,a,u){super(),this._changeDetectorRef=a,this.callSetDisabledState=u,this._parent=t,this._setValidators(i),this._setAsyncValidators(r),this.valueAccessor=e2(this,o)}ngOnChanges(t){if(this._checkForErrors(),!this._registered||"name"in t){if(this._registered&&(this._checkName(),this.formDirective)){let i=t.name.previousValue;this.formDirective.removeControl({name:i,path:this._getPath(i)})}this._setUpControl()}"isDisabled"in t&&this._updateDisabled(t),ZE(t,this.viewModel)&&(this._updateValue(this.model),this.viewModel=this.model)}ngOnDestroy(){this.formDirective&&this.formDirective.removeControl(this)}get path(){return this._getPath(this.name)}get formDirective(){return this._parent?this._parent.formDirective:null}viewToModelUpdate(t){this.viewModel=t,this.update.emit(t)}_setUpControl(){this._setUpdateStrategy(),this._isStandalone()?this._setUpStandalone():this.formDirective.addControl(this),this._registered=!0}_setUpdateStrategy(){this.options&&this.options.updateOn!=null&&(this.control._updateOn=this.options.updateOn)}_isStandalone(){return!this._parent||!!(this.options&&this.options.standalone)}_setUpStandalone(){hm(this.control,this,this.callSetDisabledState),this.control.updateValueAndValidity({emitEvent:!1})}_checkForErrors(){this._checkName()}_checkName(){this.options&&this.options.name&&(this.name=this.options.name),!this._isStandalone()&&this.name}_updateValue(t){AE.then(()=>{this.control.setValue(t,{emitViewToModelChange:!1}),this._changeDetectorRef?.markForCheck()})}_updateDisabled(t){let i=t.isDisabled.currentValue,r=i!==0&&ro(i);AE.then(()=>{r&&!this.control.disabled?this.control.disable():!r&&this.control.disabled&&this.control.enable(),this._changeDetectorRef?.markForCheck()})}_getPath(t){return this._parent?xm(t,this._parent):[t]}static \u0275fac=function(i){return new(i||n)(ee(pn,9),ee(mi,10),ee(Ra,10),ee(yo,10),ee(br,8),ee(zl,8))};static \u0275dir=Ne({type:n,selectors:[["","ngModel","",3,"formControlName","",3,"formControl",""]],inputs:{name:"name",isDisabled:[0,"disabled","isDisabled"],model:[0,"ngModel","model"],options:[0,"ngModelOptions","options"]},outputs:{update:"ngModelChange"},exportAs:["ngModel"],standalone:!1,features:[Ut([n4]),ft,Ln]})}return n})();var Ve=(()=>{class n{static \u0275fac=function(i){return new(i||n)};static \u0275dir=Ne({type:n,selectors:[["form",3,"ngNoForm","",3,"ngNativeValidate",""]],hostAttrs:["novalidate",""],standalone:!1})}return n})(),i4={provide:yo,useExisting:Et(()=>Bt),multi:!0},Bt=(()=>{class n extends jl{writeValue(t){let i=t??"";this.setProperty("value",i)}registerOnChange(t){this.onChange=i=>{t(i==""?null:parseFloat(i))}}static \u0275fac=(()=>{let t;return function(r){return(t||(t=Zt(n)))(r||n)}})();static \u0275dir=Ne({type:n,selectors:[["input","type","number","formControlName",""],["input","type","number","formControl",""],["input","type","number","ngModel",""]],hostBindings:function(i,r){i&1&&b("input",function(a){return r.onChange(a.target.value)})("blur",function(){return r.onTouched()})},standalone:!1,features:[Ut([i4]),ft]})}return n})();var t2=new ne("");var r4={provide:pn,useExisting:Et(()=>Le)},Le=(()=>{class n extends pn{callSetDisabledState;get submitted(){return Ot(this._submittedReactive)}set submitted(t){this._submittedReactive.set(t)}_submitted=$(()=>this._submittedReactive());_submittedReactive=D(!1);_oldForm;_onCollectionChange=()=>this._updateDomValue();directives=[];form=null;ngSubmit=new et;constructor(t,i,r){super(),this.callSetDisabledState=r,this._setValidators(t),this._setAsyncValidators(i)}ngOnChanges(t){t.hasOwnProperty("form")&&(this._updateValidators(),this._updateDomValue(),this._updateRegistrations(),this._oldForm=this.form)}ngOnDestroy(){this.form&&(_m(this.form,this),this.form._onCollectionChange===this._onCollectionChange&&this.form._registerOnCollectionChange(()=>{}))}get formDirective(){return this}get control(){return this.form}get path(){return[]}addControl(t){let i=this.form.get(t.path);return hm(i,t,this.callSetDisabledState),i.updateValueAndValidity({emitEvent:!1}),this.directives.push(t),i}getControl(t){return this.form.get(t.path)}removeControl(t){TE(t.control||null,t,!1),Z6(this.directives,t)}addFormGroup(t){this._setUpFormContainer(t)}removeFormGroup(t){this._cleanUpFormContainer(t)}getFormGroup(t){return this.form.get(t.path)}addFormArray(t){this._setUpFormContainer(t)}removeFormArray(t){this._cleanUpFormContainer(t)}getFormArray(t){return this.form.get(t.path)}updateModel(t,i){this.form.get(t.path).setValue(i)}onSubmit(t){return this._submittedReactive.set(!0),XE(this.form,this.directives),this.ngSubmit.emit(t),this.form._events.next(new gm(this.control)),t?.target?.method==="dialog"}onReset(){this.resetForm()}resetForm(t=void 0,i={}){this.form.reset(t,i),this._submittedReactive.set(!1)}_updateDomValue(){this.directives.forEach(t=>{let i=t.control,r=this.form.get(t.path);i!==r&&(TE(i||null,t),e4(r)&&(hm(r,t,this.callSetDisabledState),t.control=r))}),this.form._updateTreeValidity({emitEvent:!1})}_setUpFormContainer(t){let i=this.form.get(t.path);QE(i,t),i.updateValueAndValidity({emitEvent:!1})}_cleanUpFormContainer(t){if(this.form){let i=this.form.get(t.path);i&&K6(i,t)&&i.updateValueAndValidity({emitEvent:!1})}}_updateRegistrations(){this.form._registerOnCollectionChange(this._onCollectionChange),this._oldForm&&this._oldForm._registerOnCollectionChange(()=>{})}_updateValidators(){ay(this.form,this),this._oldForm&&_m(this._oldForm,this)}static \u0275fac=function(i){return new(i||n)(ee(mi,10),ee(Ra,10),ee(zl,8))};static \u0275dir=Ne({type:n,selectors:[["","formGroup",""]],hostBindings:function(i,r){i&1&&b("submit",function(a){return r.onSubmit(a)})("reset",function(){return r.onReset()})},inputs:{form:[0,"formGroup","form"]},outputs:{ngSubmit:"ngSubmit"},exportAs:["ngForm"],standalone:!1,features:[Ut([r4]),ft,Ln]})}return n})(),o4={provide:pn,useExisting:Et(()=>qn)},qn=(()=>{class n extends t4{name=null;constructor(t,i,r){super(),this._parent=t,this._setValidators(i),this._setAsyncValidators(r)}_checkParentType(){n2(this._parent)}static \u0275fac=function(i){return new(i||n)(ee(pn,13),ee(mi,10),ee(Ra,10))};static \u0275dir=Ne({type:n,selectors:[["","formGroupName",""]],inputs:{name:[0,"formGroupName","name"]},standalone:!1,features:[Ut([o4]),ft]})}return n})(),a4={provide:pn,useExisting:Et(()=>Wn)},Wn=(()=>{class n extends pn{_parent;name=null;constructor(t,i,r){super(),this._parent=t,this._setValidators(i),this._setAsyncValidators(r)}ngOnInit(){n2(this._parent),this.formDirective.addFormArray(this)}ngOnDestroy(){this.formDirective?.removeFormArray(this)}get control(){return this.formDirective.getFormArray(this)}get formDirective(){return this._parent?this._parent.formDirective:null}get path(){return xm(this.name==null?this.name:this.name.toString(),this._parent)}static \u0275fac=function(i){return new(i||n)(ee(pn,13),ee(mi,10),ee(Ra,10))};static \u0275dir=Ne({type:n,selectors:[["","formArrayName",""]],inputs:{name:[0,"formArrayName","name"]},standalone:!1,features:[Ut([a4]),ft]})}return n})();function n2(n){return!(n instanceof qn)&&!(n instanceof Le)&&!(n instanceof Wn)}var s4={provide:ho,useExisting:Et(()=>Ue)},Ue=(()=>{class n extends ho{_ngModelWarningConfig;_added=!1;viewModel;control;name=null;set isDisabled(t){}model;update=new et;static _ngModelWarningSentOnce=!1;_ngModelWarningSent=!1;constructor(t,i,r,o,a){super(),this._ngModelWarningConfig=a,this._parent=t,this._setValidators(i),this._setAsyncValidators(r),this.valueAccessor=e2(this,o)}ngOnChanges(t){this._added||this._setUpControl(),ZE(t,this.viewModel)&&(this.viewModel=this.model,this.formDirective.updateModel(this,this.model))}ngOnDestroy(){this.formDirective&&this.formDirective.removeControl(this)}viewToModelUpdate(t){this.viewModel=t,this.update.emit(t)}get path(){return xm(this.name==null?this.name:this.name.toString(),this._parent)}get formDirective(){return this._parent?this._parent.formDirective:null}_setUpControl(){this.control=this.formDirective.addControl(this),this._added=!0}static \u0275fac=function(i){return new(i||n)(ee(pn,13),ee(mi,10),ee(Ra,10),ee(yo,10),ee(t2,8))};static \u0275dir=Ne({type:n,selectors:[["","formControlName",""]],inputs:{name:[0,"formControlName","name"],isDisabled:[0,"disabled","isDisabled"],model:[0,"ngModel","model"]},outputs:{update:"ngModelChange"},standalone:!1,features:[Ut([s4]),ft,Ln]})}return n})();var l4={provide:yo,useExisting:Et(()=>Oe),multi:!0};function i2(n,e){return n==null?`${e}`:(e&&typeof e=="object"&&(e="Object"),`${n}: ${e}`.slice(0,50))}function u4(n){return n.split(":")[0]}var Oe=(()=>{class n extends jl{value;_optionMap=new Map;_idCounter=0;set compareWith(t){this._compareWith=t}_compareWith=Object.is;appRefInjector=k(zi).injector;destroyRef=k(kn);cdr=k(br);_queuedWrite=!1;_writeValueAfterRender(){this._queuedWrite||this.appRefInjector.destroyed||(this._queuedWrite=!0,Wi({write:()=>{this.destroyRef.destroyed||(this._queuedWrite=!1,this.writeValue(this.value))}},{injector:this.appRefInjector}))}writeValue(t){this.cdr.markForCheck(),this.value=t;let i=this._getOptionId(t),r=i2(i,t);this.setProperty("value",r)}registerOnChange(t){this.onChange=i=>{this.value=this._getOptionValue(i),t(this.value)}}_registerOption(){return(this._idCounter++).toString()}_getOptionId(t){for(let i of this._optionMap.keys())if(this._compareWith(this._optionMap.get(i),t))return i;return null}_getOptionValue(t){let i=u4(t);return this._optionMap.has(i)?this._optionMap.get(i):t}static \u0275fac=(()=>{let t;return function(r){return(t||(t=Zt(n)))(r||n)}})();static \u0275dir=Ne({type:n,selectors:[["select","formControlName","",3,"multiple",""],["select","formControl","",3,"multiple",""],["select","ngModel","",3,"multiple",""]],hostBindings:function(i,r){i&1&&b("change",function(a){return r.onChange(a.target.value)})("blur",function(){return r.onTouched()})},inputs:{compareWith:"compareWith"},standalone:!1,features:[Ut([l4]),ft]})}return n})(),He=(()=>{class n{_element;_renderer;_select;id;constructor(t,i,r){this._element=t,this._renderer=i,this._select=r,this._select&&(this.id=this._select._registerOption())}set ngValue(t){this._select!=null&&(this._select._optionMap.set(this.id,t),this._setElementValue(i2(this.id,t)),this._select._writeValueAfterRender())}set value(t){this._setElementValue(t),this._select&&this._select._writeValueAfterRender()}_setElementValue(t){this._renderer.setProperty(this._element.nativeElement,"value",t)}ngOnDestroy(){this._select&&(this._select._optionMap.delete(this.id),this._select._writeValueAfterRender())}static \u0275fac=function(i){return new(i||n)(ee(an),ee(ai),ee(Oe,9))};static \u0275dir=Ne({type:n,selectors:[["option"]],inputs:{ngValue:"ngValue",value:"value"},standalone:!1})}return n})(),d4={provide:yo,useExisting:Et(()=>r2),multi:!0};function RE(n,e){return n==null?`${e}`:(typeof e=="string"&&(e=`'${e}'`),e&&typeof e=="object"&&(e="Object"),`${n}: ${e}`.slice(0,50))}function c4(n){return n.split(":")[0]}var r2=(()=>{class n extends jl{value;_optionMap=new Map;_idCounter=0;set compareWith(t){this._compareWith=t}_compareWith=Object.is;writeValue(t){this.value=t;let i;if(Array.isArray(t)){let r=t.map(o=>this._getOptionId(o));i=(o,a)=>{o._setSelected(r.indexOf(a.toString())>-1)}}else i=(r,o)=>{r._setSelected(!1)};this._optionMap.forEach(i)}registerOnChange(t){this.onChange=i=>{let r=[],o=i.selectedOptions;if(o!==void 0){let a=o;for(let u=0;u<a.length;u++){let c=a[u],p=this._getOptionValue(c.value);r.push(p)}}else{let a=i.options;for(let u=0;u<a.length;u++){let c=a[u];if(c.selected){let p=this._getOptionValue(c.value);r.push(p)}}}this.value=r,t(r)}}_registerOption(t){let i=(this._idCounter++).toString();return this._optionMap.set(i,t),i}_getOptionId(t){for(let i of this._optionMap.keys())if(this._compareWith(this._optionMap.get(i)._value,t))return i;return null}_getOptionValue(t){let i=c4(t);return this._optionMap.has(i)?this._optionMap.get(i)._value:t}static \u0275fac=(()=>{let t;return function(r){return(t||(t=Zt(n)))(r||n)}})();static \u0275dir=Ne({type:n,selectors:[["select","multiple","","formControlName",""],["select","multiple","","formControl",""],["select","multiple","","ngModel",""]],hostBindings:function(i,r){i&1&&b("change",function(a){return r.onChange(a.target)})("blur",function(){return r.onTouched()})},inputs:{compareWith:"compareWith"},standalone:!1,features:[Ut([d4]),ft]})}return n})(),Ge=(()=>{class n{_element;_renderer;_select;id;_value;constructor(t,i,r){this._element=t,this._renderer=i,this._select=r,this._select&&(this.id=this._select._registerOption(this))}set ngValue(t){this._select!=null&&(this._value=t,this._setElementValue(RE(this.id,t)),this._select.writeValue(this._select.value))}set value(t){this._select?(this._value=t,this._setElementValue(RE(this.id,t)),this._select.writeValue(this._select.value)):this._setElementValue(t)}_setElementValue(t){this._renderer.setProperty(this._element.nativeElement,"value",t)}_setSelected(t){this._renderer.setProperty(this._element.nativeElement,"selected",t)}ngOnDestroy(){this._select&&(this._select._optionMap.delete(this.id),this._select.writeValue(this._select.value))}static \u0275fac=function(i){return new(i||n)(ee(an),ee(ai),ee(r2,9))};static \u0275dir=Ne({type:n,selectors:[["option"]],inputs:{ngValue:"ngValue",value:"value"},standalone:!1})}return n})();function m4(n){return typeof n=="number"?n:parseInt(n,10)}function o2(n){return typeof n=="number"?n:parseFloat(n)}var Jl=(()=>{class n{_validator=dm;_onChange;_enabled;ngOnChanges(t){if(this.inputName in t){let i=this.normalizeInput(t[this.inputName].currentValue);this._enabled=this.enabled(i),this._validator=this._enabled?this.createValidator(i):dm,this._onChange&&this._onChange()}}validate(t){return this._validator(t)}registerOnValidatorChange(t){this._onChange=t}enabled(t){return t!=null}static \u0275fac=function(i){return new(i||n)};static \u0275dir=Ne({type:n,features:[Ln]})}return n})(),p4={provide:mi,useExisting:Et(()=>Kl),multi:!0},Kl=(()=>{class n extends Jl{max;inputName="max";normalizeInput=t=>o2(t);createValidator=t=>kE(t);static \u0275fac=(()=>{let t;return function(r){return(t||(t=Zt(n)))(r||n)}})();static \u0275dir=Ne({type:n,selectors:[["input","type","number","max","","formControlName",""],["input","type","number","max","","formControl",""],["input","type","number","max","","ngModel",""]],hostVars:1,hostBindings:function(i,r){i&2&&gt("max",r._enabled?r.max:null)},inputs:{max:"max"},standalone:!1,features:[Ut([p4]),ft]})}return n})(),f4={provide:mi,useExisting:Et(()=>_o),multi:!0},_o=(()=>{class n extends Jl{min;inputName="min";normalizeInput=t=>o2(t);createValidator=t=>PE(t);static \u0275fac=(()=>{let t;return function(r){return(t||(t=Zt(n)))(r||n)}})();static \u0275dir=Ne({type:n,selectors:[["input","type","number","min","","formControlName",""],["input","type","number","min","","formControl",""],["input","type","number","min","","ngModel",""]],hostVars:1,hostBindings:function(i,r){i&2&&gt("min",r._enabled?r.min:null)},inputs:{min:"min"},standalone:!1,features:[Ut([f4]),ft]})}return n})(),g4={provide:mi,useExisting:Et(()=>sy),multi:!0};var sy=(()=>{class n extends Jl{required;inputName="required";normalizeInput=ro;createValidator=t=>VE;enabled(t){return t}static \u0275fac=(()=>{let t;return function(r){return(t||(t=Zt(n)))(r||n)}})();static \u0275dir=Ne({type:n,selectors:[["","required","","formControlName","",3,"type","checkbox"],["","required","","formControl","",3,"type","checkbox"],["","required","","ngModel","",3,"type","checkbox"]],hostVars:1,hostBindings:function(i,r){i&2&&gt("required",r._enabled?"":null)},inputs:{required:"required"},standalone:!1,features:[Ut([g4]),ft]})}return n})();var h4={provide:mi,useExisting:Et(()=>Ql),multi:!0},Ql=(()=>{class n extends Jl{maxlength;inputName="maxlength";normalizeInput=t=>m4(t);createValidator=t=>LE(t);static \u0275fac=(()=>{let t;return function(r){return(t||(t=Zt(n)))(r||n)}})();static \u0275dir=Ne({type:n,selectors:[["","maxlength","","formControlName",""],["","maxlength","","formControl",""],["","maxlength","","ngModel",""]],hostVars:1,hostBindings:function(i,r){i&2&&gt("maxlength",r._enabled?r.maxlength:null)},inputs:{maxlength:"maxlength"},standalone:!1,features:[Ut([h4]),ft]})}return n})(),y4={provide:mi,useExisting:Et(()=>Zl),multi:!0},Zl=(()=>{class n extends Jl{pattern;inputName="pattern";normalizeInput=t=>t;createValidator=t=>OE(t);static \u0275fac=(()=>{let t;return function(r){return(t||(t=Zt(n)))(r||n)}})();static \u0275dir=Ne({type:n,selectors:[["","pattern","","formControlName",""],["","pattern","","formControl",""],["","pattern","","ngModel",""]],hostVars:1,hostBindings:function(i,r){i&2&&gt("pattern",r._enabled?r.pattern:null)},inputs:{pattern:"pattern"},standalone:!1,features:[Ut([y4]),ft]})}return n})();var a2=(()=>{class n{static \u0275fac=function(i){return new(i||n)};static \u0275mod=si({type:n});static \u0275inj=Mn({})}return n})(),Xh=class extends Ma{constructor(e,t,i){super(ry(t),oy(i,t)),this.controls=e,this._initObservables(),this._setUpdateStrategy(t),this._setUpControls(),this.updateValueAndValidity({onlySelf:!0,emitEvent:!!this.asyncValidator})}controls;at(e){return this.controls[this._adjustIndex(e)]}push(e,t={}){Array.isArray(e)?e.forEach(i=>{this.controls.push(i),this._registerControl(i)}):(this.controls.push(e),this._registerControl(e)),this.updateValueAndValidity({emitEvent:t.emitEvent}),this._onCollectionChange()}insert(e,t,i={}){this.controls.splice(e,0,t),this._registerControl(t),this.updateValueAndValidity({emitEvent:i.emitEvent})}removeAt(e,t={}){let i=this._adjustIndex(e);i<0&&(i=0),this.controls[i]&&this.controls[i]._registerOnCollectionChange(()=>{}),this.controls.splice(i,1),this.updateValueAndValidity({emitEvent:t.emitEvent})}setControl(e,t,i={}){let r=this._adjustIndex(e);r<0&&(r=0),this.controls[r]&&this.controls[r]._registerOnCollectionChange(()=>{}),this.controls.splice(r,1),t&&(this.controls.splice(r,0,t),this._registerControl(t)),this.updateValueAndValidity({emitEvent:i.emitEvent}),this._onCollectionChange()}get length(){return this.controls.length}setValue(e,t={}){JE(this,!1,e),e.forEach((i,r)=>{YE(this,!1,r),this.at(r).setValue(i,{onlySelf:!0,emitEvent:t.emitEvent})}),this.updateValueAndValidity(t)}patchValue(e,t={}){e!=null&&(e.forEach((i,r)=>{this.at(r)&&this.at(r).patchValue(i,{onlySelf:!0,emitEvent:t.emitEvent})}),this.updateValueAndValidity(t))}reset(e=[],t={}){this._forEachChild((i,r)=>{i.reset(e[r],{onlySelf:!0,emitEvent:t.emitEvent})}),this._updatePristine(t,this),this._updateTouched(t,this),this.updateValueAndValidity(t),t?.emitEvent!==!1&&this._events.next(new Wl(this))}getRawValue(){return this.controls.map(e=>e.getRawValue())}clear(e={}){this.controls.length<1||(this._forEachChild(t=>t._registerOnCollectionChange(()=>{})),this.controls.splice(0),this.updateValueAndValidity({emitEvent:e.emitEvent}))}_adjustIndex(e){return e<0?e+this.length:e}_syncPendingControls(){let e=this.controls.reduce((t,i)=>i._syncPendingControls()?!0:t,!1);return e&&this.updateValueAndValidity({onlySelf:!0}),e}_forEachChild(e){this.controls.forEach((t,i)=>{e(t,i)})}_updateValue(){this.value=this.controls.filter(e=>e.enabled||this.disabled).map(e=>e.value)}_anyControls(e){return this.controls.some(t=>t.enabled&&e(t))}_setUpControls(){this._forEachChild(e=>this._registerControl(e))}_allControlsDisabled(){for(let e of this.controls)if(e.enabled)return!1;return this.controls.length>0||this.disabled}_registerControl(e){e.setParent(this),e._registerOnCollectionChange(this._onCollectionChange)}_find(e){return this.at(e)??null}};function NE(n){return!!n&&(n.asyncValidators!==void 0||n.validators!==void 0||n.updateOn!==void 0)}var qe=(()=>{class n{useNonNullable=!1;get nonNullable(){let t=new n;return t.useNonNullable=!0,t}group(t,i=null){let r=this._reduceControls(t),o={};return NE(i)?o=i:i!==null&&(o.validators=i.validator,o.asyncValidators=i.asyncValidator),new Aa(r,o)}record(t,i=null){let r=this._reduceControls(t);return new Zh(r,i)}control(t,i,r){let o={};return this.useNonNullable?(NE(i)?o=i:(o.validators=i,o.asyncValidators=r),new ql(t,G(O({},o),{nonNullable:!0}))):new ql(t,i,r)}array(t,i,r){let o=t.map(a=>this._createControl(a));return new Xh(o,i,r)}_reduceControls(t){let i={};return Object.keys(t).forEach(r=>{i[r]=this._createControl(t[r])}),i}_createControl(t){if(t instanceof ql)return t;if(t instanceof Ma)return t;if(Array.isArray(t)){let i=t[0],r=t.length>1?t[1]:null,o=t.length>2?t[2]:null;return this.control(i,r,o)}else return this.control(t)}static \u0275fac=function(i){return new(i||n)};static \u0275prov=X({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})();var De=(()=>{class n{static withConfig(t){return{ngModule:n,providers:[{provide:zl,useValue:t.callSetDisabledState??Cm}]}}static \u0275fac=function(i){return new(i||n)};static \u0275mod=si({type:n});static \u0275inj=Mn({imports:[a2]})}return n})(),Be=(()=>{class n{static withConfig(t){return{ngModule:n,providers:[{provide:t2,useValue:t.warnOnNgModelWithFormControl??"always"},{provide:zl,useValue:t.callSetDisabledState??Cm}]}}static \u0275fac=function(i){return new(i||n)};static \u0275mod=si({type:n});static \u0275inj=Mn({imports:[a2]})}return n})();var vo=class vo{constructor(e){this.http=e;this.baseUrl=Gn.apiUrl}getLedgerEntries(e){let t=new le;return e&&Object.entries(e).forEach(([i,r])=>{r!=null&&r!==""&&(t=t.set(i,r.toString()))}),W(this.http.get(`${this.baseUrl}/ledger`,{params:t}))}createLedgerEntry(e){return W(this.http.post(`${this.baseUrl}/ledger`,e))}updateLedgerEntry(e){return W(this.http.put(`${this.baseUrl}/ledger`,e))}deleteLedgerEntry(e){let t=new le().set("id",e.toString());return W(this.http.delete(`${this.baseUrl}/ledger`,{params:t}))}checkLedgerShipmentItems(e){let t=new le().set("id",e.toString());return W(this.http.get(`${this.baseUrl}/ledger/check-shipment`,{params:t}))}getVendors(){return W(this.http.get(`${this.baseUrl}/vendors`))}updateVendor(e){return W(this.http.put(`${this.baseUrl}/vendors`,e))}deleteVendor(e){let t=new le().set("id",e.toString());return W(this.http.delete(`${this.baseUrl}/vendors`,{params:t}))}getVendorByTaxId(e){let t=new le().set("tax_id",e);return W(this.http.get(`${this.baseUrl}/vendors`,{params:t}))}getGLAccounts(e){let t=new le;return e&&Object.entries(e).forEach(([i,r])=>{r!=null&&(t=t.set(i,r.toString()))}),W(this.http.get(`${this.baseUrl}/gl-accounts`,{params:t}))}resolveGLAccount(e,t){let i=new le().set("itemGroup",e).set("subjectName",t);return W(this.http.get(`${this.baseUrl}/gl-accounts/resolve`,{params:i}))}async getAnnualSummary(e,t){let i=new le().set("type","summary").set("startYear",e.toString()).set("endYear",t.toString()),r=await W(this.http.get(`${this.baseUrl}/financial-statements`,{params:i}));return r.success&&r.data&&(r.data=this.normalizeAnnualSummary(r.data)),r}getIncomeStatement(e,t){let i=new le().set("type","income").set("year",e.toString()).set("quarter",t.toString());return W(this.http.get(`${this.baseUrl}/financial-statements`,{params:i}))}getBalanceSheet(e,t){let i=new le().set("type","balance").set("year",e.toString()).set("quarter",t.toString());return W(this.http.get(`${this.baseUrl}/financial-statements`,{params:i}))}async getFinancialStatementsDetails(e,t){let i=new le().set("year",e.toString()).set("type",t),r=await W(this.http.get(`${this.baseUrl}/financial-statements/details`,{params:i}));return r.success&&r.data&&(r.data=this.normalizeMonthlyDetail(r.data)),r}parseNumeric(e){if(e==null)return 0;let t=typeof e=="string"?parseFloat(e):e;return isNaN(t)?0:t}convertYearTotalsToNumbers(e){let t={};return Object.entries(e).forEach(([i,r])=>{if(i==="total")t.total=this.parseNumeric(r);else{let o=parseInt(i);isNaN(o)||(t[o]=this.parseNumeric(r))}}),t}normalizeAnnualSummary(e){return{years:e.years||[],revenue:this.convertYearTotalsToNumbers(e.revenue||{total:0}),expense:this.convertYearTotalsToNumbers(e.expense||{total:0}),net:this.convertYearTotalsToNumbers(e.net||{total:0}),unpaid:this.convertYearTotalsToNumbers(e.unpaid||{total:0})}}normalizeMonthlyDetail(e){let t=(e.data||[]).map(i=>({month:i.month,total:this.parseNumeric(i.total),items:(i.items||[]).map(r=>({name:r.name,amount:this.parseNumeric(r.amount)}))}));return{year:e.year,type:e.type,data:t}}createCustomer(e){return W(this.http.post(`${this.baseUrl}/customers`,e))}updateCustomer(e){return W(this.http.put(`${this.baseUrl}/customers`,e))}deleteCustomer(e){let t=new le().set("id",e);return W(this.http.delete(`${this.baseUrl}/customers`,{params:t}))}getDailyRevenue(e){let t=new le().set("date",e);return W(this.http.get(`${this.baseUrl}/daily-revenue`,{params:t}))}getMonthlyRevenue(e,t){let i=new le().set("year",e.toString()).set("month",t.toString());return W(this.http.get(`${this.baseUrl}/daily-revenue`,{params:i}))}getEvents(e){let t=new le;return e&&Object.entries(e).forEach(([i,r])=>{r!=null&&r!==""&&(t=t.set(i,r.toString()))}),W(this.http.get(`${this.baseUrl}/events`,{params:t}))}createEvent(e){return W(this.http.post(`${this.baseUrl}/events/create`,e))}getEventById(e){return W(this.http.get(`${this.baseUrl}/events/${e}`))}updateEvent(e,t){return W(this.http.put(`${this.baseUrl}/events/${e}`,t))}deleteEvent(e){return W(this.http.delete(`${this.baseUrl}/events/${e}`))}getCustomers(e){let t=new le;return e?.search&&(t=t.set("search",e.search)),e?.limit&&(t=t.set("limit",e.limit.toString())),e?.offset&&(t=t.set("offset",e.offset.toString())),W(this.http.get(`${this.baseUrl}/customers`,{params:t}))}getProductSales(e){let t=new le().set("startMonth",e.startMonth).set("endMonth",e.endMonth);return e.category&&(t=t.set("category",e.category)),e.limit&&(t=t.set("limit",e.limit.toString())),e.offset&&(t=t.set("offset",e.offset.toString())),W(this.http.get(`${this.baseUrl}/product-sales`,{params:t}))}getPurchaseCosts(e){let t=new le().set("startMonth",e.startMonth).set("endMonth",e.endMonth);return W(this.http.get(`${this.baseUrl}/purchase-costs`,{params:t}))}getShipmentItems(e){let t=new le;return e?.startDate&&(t=t.set("startDate",e.startDate)),e?.endDate&&(t=t.set("endDate",e.endDate)),e?.vendorId&&(t=t.set("vendorId",e.vendorId.toString())),e?.entryId&&(t=t.set("entryId",e.entryId.toString())),e?.documentNo&&(t=t.set("documentNo",e.documentNo)),e?.itemName&&(t=t.set("itemName",e.itemName)),e?.limit&&(t=t.set("limit",e.limit.toString())),e?.offset&&(t=t.set("offset",e.offset.toString())),W(this.http.get(`${this.baseUrl}/shipment-items`,{params:t}))}updateShipmentItem(e,t){let i=O({shipmentId:e},t);return W(this.http.put(`${this.baseUrl}/shipment-items`,i))}createShipmentItem(e){return W(this.http.post(`${this.baseUrl}/shipment-items`,e))}deleteShipmentItem(e){let t=new le().set("id",e.toString());return W(this.http.delete(`${this.baseUrl}/shipment-items`,{params:t}))}getMonthlyTargets(e){let t=new le;return e?.startMonth&&(t=t.set("startMonth",e.startMonth)),e?.endMonth&&(t=t.set("endMonth",e.endMonth)),W(this.http.get(`${this.baseUrl}/monthly-targets`,{params:t}))}createMonthlyTarget(e){return W(this.http.post(`${this.baseUrl}/monthly-targets`,e))}updateMonthlyTarget(e){return W(this.http.put(`${this.baseUrl}/monthly-targets`,e))}deleteMonthlyTarget(e){let t=new le().set("targetId",e.toString());return W(this.http.delete(`${this.baseUrl}/monthly-targets`,{params:t}))}getDailySummaries(e){let t=new le;return e&&Object.entries(e).forEach(([i,r])=>{r!=null&&(t=t.set(i,r.toString()))}),W(this.http.get(`${this.baseUrl}/payroll/daily-summaries`,{params:t}))}createDailySummary(e){return W(this.http.post(`${this.baseUrl}/payroll/daily-summaries`,e))}updateDailySummary(e,t){return W(this.http.put(`${this.baseUrl}/payroll/daily-summaries`,O({id:e},t)))}getMonthlySummaries(e){let t=new le().set("year",e.year.toString()).set("month",e.month.toString());return e.user_id!==void 0&&(t=t.set("user_id",e.user_id.toString())),W(this.http.get(`${this.baseUrl}/payroll/monthly-summaries`,{params:t}))}updateMonthlySummary(e){return W(this.http.put(`${this.baseUrl}/payroll/monthly-summaries`,e))}batchReleasePayroll(e){return W(this.http.post(`${this.baseUrl}/payroll/batch-release`,{daily_summary_ids:e}))}verifyMonthlySalarySummary(e){return W(this.http.post(`${this.baseUrl}/payroll/verify-monthly-salary`,e))}releaseMonthlySalarySummary(e){return W(this.http.post(`${this.baseUrl}/payroll/release-monthly-salary`,e))}deleteDailySummary(e){let t=new le().set("id",e.toString());return W(this.http.delete(`${this.baseUrl}/payroll/daily-summaries`,{params:t}))}getEmployeeWages(e){let t=new le;return e&&Object.entries(e).forEach(([i,r])=>{r!=null&&(t=t.set(i,r.toString()))}),W(this.http.get(`${this.baseUrl}/payroll/employee-wages`,{params:t}))}createEmployeeWage(e){return W(this.http.post(`${this.baseUrl}/payroll/employee-wages`,e))}updateEmployeeWage(e,t){return W(this.http.put(`${this.baseUrl}/payroll/employee-wages`,O({id:e},t)))}deleteEmployeeWage(e){let t=new le().set("id",e.toString());return W(this.http.delete(`${this.baseUrl}/payroll/employee-wages`,{params:t}))}getSpecialDates(e){let t=new le;return e&&Object.entries(e).forEach(([i,r])=>{r!=null&&(t=t.set(i,r.toString()))}),W(this.http.get(`${this.baseUrl}/payroll/special-dates`,{params:t}))}createSpecialDate(e){return W(this.http.post(`${this.baseUrl}/payroll/special-dates`,e))}updateSpecialDate(e,t){return W(this.http.put(`${this.baseUrl}/payroll/special-dates`,O({id:e},t)))}deleteSpecialDate(e){let t=new le().set("id",e.toString());return W(this.http.delete(`${this.baseUrl}/payroll/special-dates`,{params:t}))}async downloadLaborReport(e,t){let i=new le().set("user_id",e.toString()).set("year_month",t);return W(this.http.get(`${this.baseUrl}/payroll/labor-report`,{params:i,responseType:"blob",observe:"response"}))}async downloadLaborReportByEmployeeId(e,t){let i=new le().set("employee_id",e.toString()).set("year_month",t);return W(this.http.get(`${this.baseUrl}/payroll/labor-report`,{params:i,responseType:"blob",observe:"response"}))}getEmployeeInfo(){return W(this.http.get(`${this.baseUrl}/payroll/employee-info`))}createEmployeeInfo(e){return W(this.http.post(`${this.baseUrl}/payroll/employee-info`,e))}updateEmployeeInfo(e,t){let i=new le().set("employee_number",e.toString());return W(this.http.put(`${this.baseUrl}/payroll/employee-info`,t,{params:i}))}uploadIdCardImage(e,t,i){let r=new FormData;return r.append("file",e),r.append("employee_id",t.toString()),r.append("card_side",i),W(this.http.post(`${this.baseUrl}/payroll/upload-id-card`,r))}updateEmployeeIdCardPath(e,t,i){let r=t==="front"?"id_card_front":"id_card_back",o=new le().set("employee_number",e.toString());return W(this.http.put(`${this.baseUrl}/payroll/employee-info`,{[r]:i},{params:o}))}verifyMonthlySalary(e,t,i){return this.verifyMonthlySalarySummary({user_id:e,year:t,month:i})}releaseMonthlySalary(e,t,i,r,o,a,u){return this.releaseMonthlySalarySummary({user_id:e,year:t,month:i,display_name:a,total_wage:r,total_work_hours:o,release_amount:u})}getPayrollPayablesSummary(){return W(this.http.get(`${this.baseUrl}/payroll/payables-summary`))}getPayrollPayablesDetails(e){let t=new le().set("employee_id",e.toString());return W(this.http.get(`${this.baseUrl}/payroll/payables-details`,{params:t}))}payPayrollPayables(e){return W(this.http.post(`${this.baseUrl}/payroll/payables-pay`,e))}getShareholderMonthlySummary(e){let t=new le().set("year",e.year.toString()).set("month",e.month.toString());return W(this.http.get(`${this.baseUrl}/shareholder-rebates/monthly-summary`,{params:t}))}getShareholderMonthlyStats(e){let t=new le().set("year",e.year.toString()).set("month",e.month.toString());return W(this.http.get(`${this.baseUrl}/shareholder-rebates/monthly-stats`,{params:t}))}getShareholderMonthlyDetail(e,t){let i=new le().set("year",t.year.toString()).set("month",t.month.toString());return W(this.http.get(`${this.baseUrl}/shareholder-rebates/monthly-detail/${e}`,{params:i}))}updateShareholderRebateRecord(e,t){return W(this.http.patch(`${this.baseUrl}/shareholder-rebates/record/${e}`,t))}createShareholderRebateRecord(e){return W(this.http.post(`${this.baseUrl}/shareholder-rebates/record`,e))}deleteShareholderRebateRecord(e){return W(this.http.delete(`${this.baseUrl}/shareholder-rebates/record/${e}`))}verifyShareholderRebate(e){return W(this.http.post(`${this.baseUrl}/shareholder-rebates/verify`,e))}releaseShareholderRebate(e){return W(this.http.post(`${this.baseUrl}/shareholder-rebates/release`,e))}payShareholderRebatePayables(e){return W(this.http.post(`${this.baseUrl}/shareholder-rebates/payables-pay`,e))}getShareholderPayablesSummary(){return W(this.http.get(`${this.baseUrl}/shareholder-rebates/payables-summary`))}getShareholderPayablesDetail(e){return W(this.http.get(`${this.baseUrl}/shareholder-rebates/payables-detail/${e}`))}getCollaborationGoals(e){let t=new le;return e?.includeKeyResults!==void 0&&(t=t.set("includeKeyResults",String(e.includeKeyResults))),e?.ownerEmployeeId!==void 0&&(t=t.set("ownerEmployeeId",String(e.ownerEmployeeId))),W(this.http.get(`${this.baseUrl}/collaboration/goals`,{params:t}))}createCollaborationGoal(e){return W(this.http.post(`${this.baseUrl}/collaboration/goals`,e))}updateCollaborationGoal(e){return W(this.http.put(`${this.baseUrl}/collaboration/goals`,e))}deleteCollaborationGoal(e){let t=new le().set("id",String(e));return W(this.http.delete(`${this.baseUrl}/collaboration/goals`,{params:t}))}getCollaborationKeyResults(e){let t=new le;return e!==void 0&&(t=t.set("goalId",String(e))),W(this.http.get(`${this.baseUrl}/collaboration/key-results`,{params:t}))}createCollaborationKeyResult(e){return W(this.http.post(`${this.baseUrl}/collaboration/key-results`,e))}updateCollaborationKeyResult(e){return W(this.http.put(`${this.baseUrl}/collaboration/key-results`,e))}deleteCollaborationKeyResult(e){let t=new le().set("id",String(e));return W(this.http.delete(`${this.baseUrl}/collaboration/key-results`,{params:t}))}getCollaborationWeeklyProgress(e){let t=new le;return e?.ownerEmployeeId!==void 0&&(t=t.set("ownerEmployeeId",String(e.ownerEmployeeId))),e?.weekStartDate&&(t=t.set("weekStartDate",e.weekStartDate)),W(this.http.get(`${this.baseUrl}/collaboration/weekly-progress`,{params:t}))}createCollaborationWeeklyProgress(e){return W(this.http.post(`${this.baseUrl}/collaboration/weekly-progress`,e))}updateCollaborationWeeklyProgress(e){return W(this.http.put(`${this.baseUrl}/collaboration/weekly-progress`,e))}deleteCollaborationWeeklyProgress(e){let t=new le().set("id",String(e));return W(this.http.delete(`${this.baseUrl}/collaboration/weekly-progress`,{params:t}))}getCollaborationMeetings(e){let t=new le;return e?.startDate&&(t=t.set("startDate",e.startDate)),e?.endDate&&(t=t.set("endDate",e.endDate)),W(this.http.get(`${this.baseUrl}/collaboration/meetings`,{params:t}))}createCollaborationMeeting(e){return W(this.http.post(`${this.baseUrl}/collaboration/meetings`,e))}updateCollaborationMeeting(e){return W(this.http.put(`${this.baseUrl}/collaboration/meetings`,e))}deleteCollaborationMeeting(e){let t=new le().set("id",String(e));return W(this.http.delete(`${this.baseUrl}/collaboration/meetings`,{params:t}))}getCollaborationAnnouncements(){return W(this.http.get(`${this.baseUrl}/collaboration/announcements`))}createCollaborationAnnouncement(e){return W(this.http.post(`${this.baseUrl}/collaboration/announcements`,e))}updateCollaborationAnnouncement(e){return W(this.http.put(`${this.baseUrl}/collaboration/announcements`,e))}deleteCollaborationAnnouncement(e){let t=new le().set("id",String(e));return W(this.http.delete(`${this.baseUrl}/collaboration/announcements`,{params:t}))}};vo.\u0275fac=function(t){return new(t||vo)(ae(Hn))},vo.\u0275prov=X({token:vo,factory:vo.\u0275fac,providedIn:"root"});var we=vo;var _4=["monthlyChart"],v4=["purchaseChart"],C4=["dailyRevenueChart"],fn=()=>({style:"currency",currency:"TWD",minimumFractionDigits:0}),s2=(n,e)=>e.employee_id,x4=(n,e)=>e.monthLabel;function b4(n,e){if(n&1&&(l(0,"div",17)(1,"div",38)(2,"div",39),x(3,"ion-icon",40),s(),l(4,"div")(5,"p",26),d(6,"\u6536\u5165"),s(),l(7,"p",41),d(8),s()()(),l(9,"div",38)(10,"div",42),x(11,"ion-icon",43),s(),l(12,"div")(13,"p",26),d(14,"\u5E73\u5747\u6BCF\u65E5\u6536\u5165"),s(),l(15,"p",41),d(16),s()()(),l(17,"div",38)(18,"div",44),x(19,"ion-icon",45),s(),l(20,"div")(21,"p",26),d(22,"\u8CBB\u7528"),s(),l(23,"p",41),d(24),s()()(),l(25,"div",38)(26,"div",46),x(27,"ion-icon",47),s(),l(28,"div")(29,"p",26),d(30,"\u6298\u8B93"),s(),l(31,"p",41),d(32),s()()(),l(33,"div",38)(34,"div",48),x(35,"ion-icon",49),s(),l(36,"div")(37,"p",26),d(38,"\u9032\u8CA8"),s(),l(39,"p",41),d(40),s()()(),l(41,"div",38)(42,"div",50),x(43,"ion-icon",51),s(),l(44,"div")(45,"p",26),d(46,"\u6BDB\u5229"),s(),l(47,"p",41),d(48),s()()()()),n&2){let t=e,i=_();m(8),w(t.revenue.toLocaleString("zh-TW",Ke(6,fn))),m(8),w(i.averageDailyRevenue().toLocaleString("zh-TW",Ke(7,fn))),m(8),w(t.expenses.toLocaleString("zh-TW",Ke(8,fn))),m(8),w(t.allowance.toLocaleString("zh-TW",Ke(9,fn))),m(8),w(t.purchases.toLocaleString("zh-TW",Ke(10,fn))),m(8),w(i.grossProfit().toLocaleString("zh-TW",Ke(11,fn)))}}function E4(n,e){n&1&&(l(0,"div",18),d(1,"\u5728\u6B64\u65E5\u671F\u7BC4\u570D\u5167\u6C92\u6709\u6578\u64DA\u3002"),s())}function S4(n,e){if(n&1&&(l(0,"div",52)(1,"span",53),d(2),s(),l(3,"span",54),d(4),s()()),n&2){let t=e.$implicit;m(2),w(t.employee_name),m(2),w(t.display_amount.toLocaleString("zh-TW",Ke(2,fn)))}}function D4(n,e){if(n&1&&(l(0,"div",33),V(1,S4,5,3,"div",52,s2),s()),n&2){let t=_();m(),L(t.payablesData().salaryEmployees)}}function w4(n,e){n&1&&(l(0,"p",26),d(1,"\u76EE\u524D\u7121\u61C9\u4ED8\u85AA\u8CC7"),s())}function T4(n,e){if(n&1&&(l(0,"div",52)(1,"span",53),d(2),s(),l(3,"span",54),d(4),s()()),n&2){let t=e.$implicit;m(2),w(t.employee_name),m(2),w(t.display_amount.toLocaleString("zh-TW",Ke(2,fn)))}}function I4(n,e){if(n&1&&(l(0,"div",33),V(1,T4,5,3,"div",52,s2),s()),n&2){let t=_();m(),L(t.payablesData().shareholderEmployees)}}function M4(n,e){n&1&&(l(0,"p",26),d(1,"\u76EE\u524D\u7121\u61C9\u4ED8\u80A1\u6771\u56DE\u994B\u91D1"),s())}function A4(n,e){if(n&1&&(l(0,"tr",65)(1,"td",66),d(2),s(),l(3,"td",64),d(4),s()()),n&2){let t=e.$implicit;m(2),w(t.monthLabel),m(2),w(t.amount.toLocaleString("zh-TW",Ke(2,fn)))}}function R4(n,e){if(n&1){let t=B();l(0,"div",37)(1,"div",55)(2,"div",56)(3,"h3",57),d(4),s(),l(5,"button",58),b("click",function(){E(t);let r=_();return S(r.closePayableDetail())}),x(6,"ion-icon",59),s()(),l(7,"div",60)(8,"table",61)(9,"thead",62)(10,"tr")(11,"th",63),d(12,"\u6708\u4EFD"),s(),l(13,"th",64),d(14,"\u91D1\u984D"),s()()(),l(15,"tbody"),V(16,A4,5,3,"tr",65,x4),s()()()()()}if(n&2){let t=_();m(4),Qe("",t.payableDetailModalTitle(),"\uFF08\u7E3D\u8A08\uFF1A",t.payableDetailTotal().toLocaleString("zh-TW",Ke(2,fn)),"\uFF09"),m(12),L(t.payableDetailRows())}}var Na=class Na{constructor(){this.apiService=k(we);this.formatDate=e=>{let t=e.getFullYear(),i=String(e.getMonth()+1).padStart(2,"0"),r=String(e.getDate()).padStart(2,"0");return`${t}-${i}-${r}`};this.today=new Date;this.firstDayOfMonth=new Date(this.today.getFullYear(),this.today.getMonth(),1);this.startDate=D(this.formatDate(this.firstDayOfMonth));this.endDate=D(this.formatDate(this.today));this.filterStartDate=this.formatDate(this.firstDayOfMonth);this.filterEndDate=this.formatDate(this.today);this.dashboardData=D(null);this.monthlyPerformance=D([]);this.dailyRevenueTrend=D([]);this.payablesData=D({accountsPayableTotal:0,salaryEmployees:[],shareholderEmployees:[],cigarPurchaseTotal:0,renovationTotal:0,accountsPayableMonthly:[],cigarPurchaseMonthly:[]});this.payableDetailModalVisible=D(!1);this.payableDetailModalTitle=D("");this.payableDetailRows=D([]);this.payableDetailTotal=$(()=>this.payableDetailRows().reduce((e,t)=>e+Number(t.amount||0),0));this.salaryPayableTotal=$(()=>this.payablesData().salaryEmployees.reduce((e,t)=>e+Number(t.display_amount||0),0));this.shareholderPayableTotal=$(()=>this.payablesData().shareholderEmployees.reduce((e,t)=>e+Number(t.display_amount||0),0));this.isLoading=D(!1);this.errorMessage=D(null);this.averageDailyRevenue=$(()=>{let e=this.dashboardData();if(!e||!this.startDate()||!this.endDate())return 0;let t=new Date(this.startDate()),i=new Date(this.endDate());if(isNaN(t.getTime())||isNaN(i.getTime())||t>i)return 0;let r=i.getTime()-t.getTime(),o=Math.round(r/(1e3*60*60*24))+1;return o<=0?e.revenue:e.revenue/o});this.grossProfit=$(()=>{let e=this.dashboardData();return e?e.revenue-e.purchases-e.allowance-e.expenses:0});this.purchaseChartData=$(()=>{let e=this.dashboardData();return e?[{category:"\u9152\u6C34",amount:e.beveragePurchase},{category:"\u9910\u98F2",amount:e.foodPurchase},{category:"\u96EA\u8304(\u542B\u61C9\u4ED8)",amount:e.cigarPurchase}]:[]});this.loadData(this.startDate(),this.endDate()),Bn(()=>{let e=this.monthlyPerformance(),t=this.purchaseChartData(),i=this.dailyRevenueTrend();this.monthlyChart&&this.purchaseChart&&this.dailyRevenueChart&&this.updateCharts(e,t,i)}),Wi(()=>{this.createCharts()})}async loadData(e,t){this.isLoading.set(!0),this.errorMessage.set(null);try{let i=e||this.startDate(),r=t||this.endDate(),[o,a]=await Promise.all([this.apiService.getLedgerEntries({startDate:i,endDate:r,limit:1e4}),this.apiService.getLedgerEntries({startDate:this.calculateMonthsBack(12),endDate:r,limit:1e4})]);o.success&&o.data&&(this.dashboardData.set(this.calculateDashboardMetrics(o.data)),this.dailyRevenueTrend.set(this.calculateDailyRevenueTrend(o.data,i,r))),a.success&&a.data&&this.monthlyPerformance.set(this.calculateMonthlyPerformance(a.data)),await this.loadPayablesData()}catch(i){console.error("\u8F09\u5165\u5100\u8868\u677F\u6578\u64DA\u6642\u767C\u751F\u932F\u8AA4:",i);let r=i instanceof Error?i.message:"\u7121\u6CD5\u8F09\u5165\u6578\u64DA\uFF0C\u8ACB\u7A0D\u5F8C\u518D\u8A66";this.errorMessage.set(r)}finally{this.isLoading.set(!1)}}async loadPayablesData(){let[e,t,i,r,o]=await Promise.allSettled([this.apiService.getPayrollPayablesSummary(),this.apiService.getShareholderPayablesSummary(),this.fetchAllLedgerEntriesBySubject("\u61C9\u4ED8\u5E33\u6B3E"),this.fetchAllLedgerEntriesBySubject("\u61C9\u4ED8\u96EA\u8304\u9032\u8CA8"),this.fetchAllLedgerEntriesBySubject("\u61C9\u4ED8\u88DD\u6F62\u6B3E")]),a=e.status==="fulfilled"&&e.value.success&&e.value.data?.employees?e.value.data.employees.map(C=>({employee_id:Number(C.employee_id||0),employee_name:C.employee_name||"",pending_amount:Number(C.pending_amount||0),total_payable:Number(C.total_payable||0),display_amount:Number(C.pending_amount||0)>0?Number(C.pending_amount||0):Number(C.total_payable||0)})):[],u=t.status==="fulfilled"&&t.value.success&&t.value.data?.employees?t.value.data.employees.map(C=>({employee_id:Number(C.employee_id||0),employee_name:C.employee_name||"",pending_amount:Number(C.pending_amount||0),total_payable:Number(C.total_payable||0),display_amount:Number(C.pending_amount||0)>0?Number(C.pending_amount||0):Number(C.total_payable||0)})):[],c=i.status==="fulfilled"?i.value:[],p=r.status==="fulfilled"?r.value:[],g=o.status==="fulfilled"?o.value:[],y=this.buildMonthlyPayableRows(c),v=this.buildMonthlyPayableRows(p);this.payablesData.set({accountsPayableTotal:this.sumLedgerAmounts(c),salaryEmployees:a,shareholderEmployees:u,cigarPurchaseTotal:this.sumLedgerAmounts(p),renovationTotal:this.sumLedgerAmounts(g),accountsPayableMonthly:y,cigarPurchaseMonthly:v})}async fetchAllLedgerEntriesBySubject(e){let t=[],i=1,r=1e3;for(;;){let o=await this.apiService.getLedgerEntries({subjectName:e,page:i,limit:r,sortBy:"entry_date",sortOrder:"asc"});if(!o.success||!o.data||(t.push(...o.data),!!!o.pagination?.hasNext||o.data.length===0)||(i+=1,i>200))break}return t}sumLedgerAmounts(e){return e.reduce((t,i)=>t+Math.abs(Number(i.amount)||0),0)}buildMonthlyPayableRows(e){let t=new Map;return e.forEach(i=>{let o=String(i.entry_date||"").slice(0,7);if(!o)return;let a=Math.abs(Number(i.amount)||0);t.set(o,(t.get(o)||0)+a)}),Array.from(t.entries()).map(([i,r])=>({monthLabel:i,amount:r})).sort((i,r)=>r.monthLabel.localeCompare(i.monthLabel))}calculateDailyRevenueTrend(e,t,i){let r=new Map;return e.forEach(o=>{if((o.subject_name||"")!=="\u92B7\u8CA8\u6536\u5165")return;let a=Math.abs(Number(o.amount)||0),u=String(o.entry_date||"").slice(0,10);if(!u)return;let c=r.get(u)||0;r.set(u,c+a)}),this.buildDateRange(t,i).map(o=>({date:o,amount:r.get(o)||0}))}buildDateRange(e,t){let i=new Date(e),r=new Date(t);if(isNaN(i.getTime())||isNaN(r.getTime())||i>r)return[];let o=[],a=new Date(i);for(;a<=r;)o.push(this.formatDate(a)),a.setDate(a.getDate()+1);return o}calculateMonthsBack(e){let t=new Date(this.endDate()),i=new Date(t.getFullYear(),t.getMonth()-e,1);return this.formatDate(i)}calculateDashboardMetrics(e){let t={revenue:0,expenses:0,allowance:0,purchases:0,beveragePurchase:0,foodPurchase:0,cigarPurchase:0};console.log("=== \u8A08\u7B97\u5100\u8868\u677F\u6307\u6A19 ==="),console.log("\u6D41\u6C34\u5E33\u7B46\u6578:",e.length),console.log("\u6D41\u6C34\u5E33\u6A23\u672C\u524D3\u7B46:"),e.slice(0,3).forEach((y,v)=>{console.log(`  [${v}]`,{amount:y.amount,item_group:y.item_group,subject_name:y.subject_name})});let i=0,r=0,o=0,a=0,u=0,c=0,p=0,g=0;return e.forEach((y,v)=>{let C=Math.abs(Number(y.amount)||0),T=y.item_group||"",R=y.subject_name||"";g+=C,R==="\u92B7\u8CA8\u6536\u5165"&&(t.revenue+=C,i++,i<=3&&console.log(`\u6536\u5165[${i}]: amount=${C}, subject=${R}`)),T==="\u71DF\u696D\u8CBB\u7528"&&(t.expenses+=C,r++,r<=3&&console.log(`\u8CBB\u7528[${r}]: amount=${C}, itemGroup=${T}`)),R==="-\u92B7\u6216\u6298\u8B93"&&(t.allowance+=C,o++,o<=3&&console.log(`\u6298\u8B93[${o}]: amount=${C}, subject=${R}`)),R==="\u5B58\u8CA8-\u9910\u98F2"?(t.foodPurchase+=C,t.purchases+=C,c++):R==="\u5B58\u8CA8-\u9152\u6C34"?(t.beveragePurchase+=C,t.purchases+=C,u++):(R==="\u5B58\u8CA8-\u96EA\u8304"||R==="\u61C9\u4ED8\u96EA\u8304\u9032\u8CA8")&&(t.cigarPurchase+=C,t.purchases+=C,p++)}),console.log("=== \u6700\u7D42\u8A08\u7B97\u7D50\u679C ==="),console.log("\u6536\u5165\u8A08\u6578:",i,"\u7E3D\u984D:",t.revenue),console.log("\u8CBB\u7528\u8A08\u6578:",r,"\u7E3D\u984D:",t.expenses),console.log("\u6298\u8B93\u8A08\u6578:",o,"\u7E3D\u984D:",t.allowance),console.log("\u9032\u8CA8\u8A08\u6578 - \u98DF\u54C1:",c,"\u9152\u6C34:",u,"\u96EA\u8304:",p),console.log("\u9032\u8CA8\u7E3D\u984D:",t.purchases),console.log("\u6BDB\u5229:",t.revenue-t.purchases-t.allowance-t.expenses),console.log("\u9A57\u8B49 - \u7E3D\u8655\u7406\u91D1\u984D:",g),console.log("\u6700\u7D42\u6307\u6A19:",t),t}calculateMonthlyPerformance(e){let t=new Map;for(let i=11;i>=0;i--){let r=new Date(new Date(this.endDate()).getFullYear(),new Date(this.endDate()).getMonth()-i,1),o=`${r.getFullYear()}-${String(r.getMonth()+1).padStart(2,"0")}`;t.set(o,{revenue:0,expenses:0,allowance:0,purchases:0,beveragePurchase:0,foodPurchase:0,cigarPurchase:0})}return e.forEach(i=>{if(!i.entry_date)return;let r=new Date(i.entry_date),o=`${r.getFullYear()}-${String(r.getMonth()+1).padStart(2,"0")}`;if(!t.has(o))return;let a=Math.abs(Number(i.amount)||0),u=i.item_group||"",c=i.subject_name||"",p=t.get(o);c==="\u92B7\u8CA8\u6536\u5165"&&(p.revenue+=a),u==="\u71DF\u696D\u8CBB\u7528"&&(p.expenses+=a),c==="-\u92B7\u6216\u6298\u8B93"&&(p.allowance+=a),(c==="\u5B58\u8CA8-\u9910\u98F2"||c==="\u5B58\u8CA8-\u9152\u6C34"||c==="\u5B58\u8CA8-\u96EA\u8304"||c==="\u61C9\u4ED8\u96EA\u8304\u9032\u8CA8")&&(p.purchases+=a)}),Array.from(t.entries()).map(([i,r])=>({month:i,revenue:r.revenue,expenses:r.expenses,allowance:r.allowance,purchases:r.purchases}))}applyFilter(){let e=this.filterStartDate,t=this.filterEndDate;if(e&&t&&e>t){alert("\u8D77\u59CB\u65E5\u671F\u4E0D\u80FD\u665A\u65BC\u7D50\u675F\u65E5\u671F\u3002");return}this.startDate.set(e),this.endDate.set(t),this.loadData(e,t)}resetFilter(){let e=this.formatDate(this.firstDayOfMonth),t=this.formatDate(this.today);this.filterStartDate=e,this.filterEndDate=t,this.startDate.set(e),this.endDate.set(t),this.loadData(e,t)}formatCurrency(e){return e.toLocaleString("zh-TW",{style:"currency",currency:"TWD",minimumFractionDigits:0})}createCharts(){let e=this.monthlyChartRef.nativeElement.getContext("2d"),t=this.monthlyPerformance();this.monthlyChart=new Chart(e,{type:"line",data:{labels:t.map(u=>u.month),datasets:[{label:"\u92B7\u8CA8\u6536\u5165",data:t.map(u=>u.revenue),borderColor:"#4f46e5",backgroundColor:"rgba(79, 70, 229, 0.1)",fill:!0,tension:.4},{label:"\u8CBB\u7528",data:t.map(u=>u.expenses),borderColor:"#f43f5e",backgroundColor:"rgba(244, 63, 94, 0.1)",fill:!0,tension:.4},{label:"\u6298\u8B93",data:t.map(u=>u.allowance),borderColor:"#f59e0b",backgroundColor:"rgba(245, 158, 11, 0.1)",fill:!0,tension:.4},{label:"\u9032\u8CA8",data:t.map(u=>u.purchases),borderColor:"#8b5cf6",backgroundColor:"rgba(139, 92, 246, 0.1)",fill:!0,tension:.4}]},options:{responsive:!0,maintainAspectRatio:!1,scales:{y:{beginAtZero:!0,ticks:{callback:u=>this.formatCurrency(u)}}}}});let i=this.purchaseChartRef.nativeElement.getContext("2d"),r=this.purchaseChartData();this.purchaseChart=new Chart(i,{type:"doughnut",data:{labels:r.map(u=>u.category),datasets:[{label:"\u9032\u8CA8\u5206\u985E",data:r.map(u=>u.amount),backgroundColor:["#3b82f6","#10b981","#f59e0b"],hoverOffset:4}]},options:{responsive:!0,maintainAspectRatio:!1,plugins:{tooltip:{callbacks:{label:u=>{let c=u.label||"",p=u.raw||0,g=r.reduce((v,C)=>v+C.amount,0);if(g===0)return`${c}: ${this.formatCurrency(p)} (0.00%)`;let y=(p/g*100).toFixed(2);return`${c}: ${this.formatCurrency(p)} (${y}%)`}}}}}});let o=this.dailyRevenueChartRef.nativeElement.getContext("2d"),a=this.dailyRevenueTrend();this.dailyRevenueChart=new Chart(o,{type:"line",data:{labels:a.map(u=>u.date.slice(8,10)),datasets:[{label:"\u6BCF\u65E5\u71DF\u6536",data:a.map(u=>u.amount),borderColor:"#4f46e5",backgroundColor:"rgba(79, 70, 229, 0.1)",fill:!0,tension:.35,pointRadius:3,pointBackgroundColor:"#4f46e5"}]},options:{responsive:!0,maintainAspectRatio:!1,scales:{y:{beginAtZero:!0,ticks:{callback:u=>this.formatCurrency(u)}},x:{title:{display:!0,text:"\u65E5\u671F"}}}}})}updateCharts(e,t,i){this.monthlyChart&&(this.monthlyChart.data.labels=e.map(r=>r.month),this.monthlyChart.data.datasets[0].data=e.map(r=>r.revenue),this.monthlyChart.data.datasets[1].data=e.map(r=>r.expenses),this.monthlyChart.data.datasets[2].data=e.map(r=>r.allowance),this.monthlyChart.data.datasets[3].data=e.map(r=>r.purchases),this.monthlyChart.update()),this.purchaseChart&&(this.purchaseChart.data.labels=t.map(r=>r.category),this.purchaseChart.data.datasets[0].data=t.map(r=>r.amount),this.purchaseChart.update()),this.dailyRevenueChart&&(this.dailyRevenueChart.data.labels=i.map(r=>r.date.slice(8,10)),this.dailyRevenueChart.data.datasets[0].data=i.map(r=>r.amount),this.dailyRevenueChart.update())}openPayableDetail(e){e==="accountsPayable"?(this.payableDetailModalTitle.set("\u61C9\u4ED8\u5E33\u6B3E\u660E\u7D30"),this.payableDetailRows.set(this.payablesData().accountsPayableMonthly)):(this.payableDetailModalTitle.set("\u61C9\u4ED8\u96EA\u8304\u9032\u8CA8\u6BCF\u6708\u660E\u7D30"),this.payableDetailRows.set(this.payablesData().cigarPurchaseMonthly)),this.payableDetailModalVisible.set(!0)}closePayableDetail(){this.payableDetailModalVisible.set(!1),this.payableDetailRows.set([]),this.payableDetailModalTitle.set("")}};Na.\u0275fac=function(t){return new(t||Na)},Na.\u0275cmp=re({type:Na,selectors:[["app-dashboard"]],viewQuery:function(t,i){if(t&1&&(ut(_4,5),ut(v4,5),ut(C4,5)),t&2){let r;tt(r=nt())&&(i.monthlyChartRef=r.first),tt(r=nt())&&(i.purchaseChartRef=r.first),tt(r=nt())&&(i.dailyRevenueChartRef=r.first)}},decls:78,vars:16,consts:[["dailyRevenueChart",""],["monthlyChart",""],["purchaseChart",""],[1,"space-y-8"],[1,"flex","flex-wrap","items-center","justify-between","gap-4"],[1,"text-3xl","font-bold","text-gray-900"],[1,"flex","flex-col","sm:flex-row","items-center","gap-2","bg-white","p-3","rounded-xl","shadow-md","border","border-gray-200"],[1,"flex","items-center","gap-2"],["for","startDate",1,"text-sm","font-medium","text-gray-600"],["type","date","id","startDate",1,"border-gray-300","rounded-lg","shadow-sm","focus:ring-indigo-500","focus:border-indigo-500","text-sm","p-2","bg-gray-100",3,"ngModelChange","ngModel"],["for","endDate",1,"text-sm","font-medium","text-gray-600"],["type","date","id","endDate",1,"border-gray-300","rounded-lg","shadow-sm","focus:ring-indigo-500","focus:border-indigo-500","text-sm","p-2","bg-gray-100",3,"ngModelChange","ngModel"],[1,"flex","items-center","gap-2","mt-2","sm:mt-0"],[1,"bg-indigo-600","text-white","px-4","py-2","rounded-lg","font-medium","hover:bg-indigo-700","transition-colors","flex","items-center","gap-2","text-sm",3,"click"],["name","filter-outline"],["title","\u91CD\u8A2D\u7BE9\u9078",1,"text-gray-500","hover:text-gray-800","transition-colors","p-2","rounded-full","bg-gray-100","hover:bg-gray-200",3,"click"],["name","refresh-outline",1,"text-xl"],[1,"grid","grid-cols-1","sm:grid-cols-2","md:grid-cols-3","gap-6"],[1,"text-center","py-8","text-gray-500"],[1,"bg-white","p-6","rounded-xl","shadow-md"],[1,"text-lg","font-semibold","text-gray-800","mb-4"],[1,"h-80"],[1,"bg-white","p-6","rounded-xl","shadow-md","space-y-6"],[1,"text-lg","font-semibold","text-gray-800"],[1,"grid","grid-cols-1","md:grid-cols-2","lg:grid-cols-3","gap-4"],["type","button",1,"text-left","border","border-gray-200","rounded-lg","p-4","hover:bg-gray-50","transition-colors",3,"click"],[1,"text-sm","text-gray-500"],[1,"text-xl","font-semibold","text-gray-900","mt-2"],[1,"border","border-gray-200","rounded-lg","p-4"],[1,"grid","grid-cols-1","lg:grid-cols-2","gap-6"],[1,"flex","items-center","justify-between","mb-3"],[1,"font-semibold","text-gray-800"],[1,"text-sm","font-semibold","text-gray-900"],[1,"space-y-2"],[1,"grid","grid-cols-1","lg:grid-cols-5","gap-6"],[1,"lg:col-span-3","bg-white","p-6","rounded-xl","shadow-md"],[1,"lg:col-span-2","bg-white","p-6","rounded-xl","shadow-md"],[1,"fixed","inset-0","bg-black","bg-opacity-50","flex","items-center","justify-center","z-50","transition-opacity"],[1,"bg-white","p-6","rounded-xl","shadow-md","flex","items-center","space-x-4"],[1,"bg-green-100","p-3","rounded-full"],["name","cash-outline",1,"text-2xl","text-green-600"],[1,"text-2xl","font-semibold","text-gray-900"],[1,"bg-blue-100","p-3","rounded-full"],["name","calendar-outline",1,"text-2xl","text-blue-600"],[1,"bg-red-100","p-3","rounded-full"],["name","trending-down-outline",1,"text-2xl","text-red-600"],[1,"bg-yellow-100","p-3","rounded-full"],["name","pricetag-outline",1,"text-2xl","text-yellow-600"],[1,"bg-purple-100","p-3","rounded-full"],["name","cart-outline",1,"text-2xl","text-purple-600"],[1,"bg-indigo-100","p-3","rounded-full"],["name","pie-chart-outline",1,"text-2xl","text-indigo-600"],[1,"flex","items-center","justify-between","text-sm","border-b","border-gray-100","pb-2"],[1,"text-gray-700"],[1,"font-medium","text-gray-900"],[1,"bg-white","rounded-xl","shadow-2xl","w-full","max-w-2xl","max-h-[85vh]","flex","flex-col","m-4"],[1,"flex","justify-between","items-center","p-4","border-b"],[1,"text-lg","font-semibold"],[1,"text-gray-400","hover:text-gray-600","p-1","rounded-full","hover:bg-gray-100",3,"click"],["name","close-outline",1,"text-2xl"],[1,"p-4","overflow-y-auto"],[1,"w-full","text-sm"],[1,"bg-gray-50","text-gray-700","uppercase","text-xs"],[1,"px-4","py-2","text-left"],[1,"px-4","py-2","text-right"],[1,"border-b","border-gray-100"],[1,"px-4","py-2"]],template:function(t,i){if(t&1){let r=B();l(0,"div",3)(1,"div",4)(2,"h1",5),d(3,"\u5100\u8868\u677F"),s(),l(4,"div",6)(5,"div",7)(6,"label",8),d(7,"\u5F9E:"),s(),l(8,"input",9),K("ngModelChange",function(a){return E(r),Q(i.filterStartDate,a)||(i.filterStartDate=a),S(a)}),s()(),l(9,"div",7)(10,"label",10),d(11,"\u81F3:"),s(),l(12,"input",11),K("ngModelChange",function(a){return E(r),Q(i.filterEndDate,a)||(i.filterEndDate=a),S(a)}),s()(),l(13,"div",12)(14,"button",13),b("click",function(){return E(r),S(i.applyFilter())}),x(15,"ion-icon",14),l(16,"span"),d(17,"\u5957\u7528"),s()(),l(18,"button",15),b("click",function(){return E(r),S(i.resetFilter())}),x(19,"ion-icon",16),s()()()(),M(20,b4,49,12,"div",17)(21,E4,2,0,"div",18),l(22,"div",19)(23,"h3",20),d(24,"\u6BCF\u65E5\u71DF\u6536\u8DA8\u52E2"),s(),l(25,"div",21),x(26,"canvas",null,0),s()(),l(28,"div",22)(29,"h3",23),d(30,"\u61C9\u4ED8\u5E33\u6B3E"),s(),l(31,"div",24)(32,"button",25),b("click",function(){return E(r),S(i.openPayableDetail("accountsPayable"))}),l(33,"p",26),d(34,"\u61C9\u4ED8\u5E33\u6B3E\uFF08\u9EDE\u64CA\u67E5\u770B\u660E\u7D30\uFF09"),s(),l(35,"p",27),d(36),s()(),l(37,"button",25),b("click",function(){return E(r),S(i.openPayableDetail("cigarPurchase"))}),l(38,"p",26),d(39,"\u61C9\u4ED8\u96EA\u8304\u9032\u8CA8\uFF08\u9EDE\u64CA\u67E5\u770B\u6BCF\u6708\u660E\u7D30\uFF09"),s(),l(40,"p",27),d(41),s()(),l(42,"div",28)(43,"p",26),d(44,"\u61C9\u4ED8\u88DD\u6F62\u6B3E"),s(),l(45,"p",27),d(46),s()()(),l(47,"div",29)(48,"div",28)(49,"div",30)(50,"h4",31),d(51,"\u61C9\u4ED8\u85AA\u8CC7\uFF08\u6BCF\u4F4D\u54E1\u5DE5\uFF09"),s(),l(52,"span",32),d(53),s()(),M(54,D4,3,0,"div",33)(55,w4,2,0,"p",26),s(),l(56,"div",28)(57,"div",30)(58,"h4",31),d(59,"\u61C9\u4ED8\u80A1\u6771\u56DE\u994B\u91D1\uFF08\u6BCF\u4F4D\u80A1\u6771\uFF09"),s(),l(60,"span",32),d(61),s()(),M(62,I4,3,0,"div",33)(63,M4,2,0,"p",26),s()()(),l(64,"div",34)(65,"div",35)(66,"h3",20),d(67,"\u6708\u5EA6\u8868\u73FE"),s(),l(68,"div",21),x(69,"canvas",null,1),s()(),l(71,"div",36)(72,"h3",20),d(73,"\u7E3D\u9032\u8CA8\u5206\u6790"),s(),l(74,"div",21),x(75,"canvas",null,2),s()()()(),M(77,R4,18,3,"div",37)}if(t&2){let r;m(8),J("ngModel",i.filterStartDate),m(4),J("ngModel",i.filterEndDate),m(8),A((r=i.dashboardData())?20:21,r),m(16),w(i.payablesData().accountsPayableTotal.toLocaleString("zh-TW",Ke(11,fn))),m(5),w(i.payablesData().cigarPurchaseTotal.toLocaleString("zh-TW",Ke(12,fn))),m(5),w(i.payablesData().renovationTotal.toLocaleString("zh-TW",Ke(13,fn))),m(7),N("\u7E3D\u8A08\uFF1A",i.salaryPayableTotal().toLocaleString("zh-TW",Ke(14,fn))),m(),A(i.payablesData().salaryEmployees.length>0?54:55),m(7),N("\u7E3D\u8A08\uFF1A",i.shareholderPayableTotal().toLocaleString("zh-TW",Ke(15,fn))),m(),A(i.payablesData().shareholderEmployees.length>0?62:63),m(15),A(i.payableDetailModalVisible()?77:-1)}},dependencies:[se,De,be,fe,Ie],encapsulation:2,changeDetection:0});var bm=Na;var N4=["detailChart"],F4=(n,e)=>e.value,Xl=(n,e)=>e.account,ly=(n,e)=>e.name,Sm=(n,e)=>e.month;function P4(n,e){n&1&&(l(0,"div",2),x(1,"ion-icon",13),l(2,"span",14),d(3,"\u6B63\u5728\u52A0\u8F09\u6578\u64DA..."),s()())}function k4(n,e){if(n&1&&(l(0,"div",3),x(1,"ion-icon",15),l(2,"span",16),d(3),s()()),n&2){let t=_();m(3),w(t.errorMessage())}}function V4(n,e){if(n&1&&(l(0,"option",20),d(1),s()),n&2){let t=e.$implicit;I("value",t),m(),N("",t,"\u5E74")}}function L4(n,e){if(n&1&&(l(0,"option",20),d(1),s()),n&2){let t=e.$implicit;I("value",t),m(),N("",t,"\u5E74")}}function O4(n,e){n&1&&(x(0,"ion-icon",27),l(1,"span"),d(2,"\u5957\u7528\u4E2D..."),s())}function B4(n,e){n&1&&(x(0,"ion-icon",28),l(1,"span"),d(2,"\u5957\u7528"),s())}function U4(n,e){if(n&1){let t=B();l(0,"div",6)(1,"div",17)(2,"label",18),d(3,"\u5F9E:"),s(),l(4,"select",19),K("ngModelChange",function(r){E(t);let o=_();return Q(o.selectedStartYearSummary,r)||(o.selectedStartYearSummary=r),S(r)}),V(5,V4,2,2,"option",20,Y),s()(),l(7,"div",17)(8,"label",21),d(9,"\u81F3:"),s(),l(10,"select",22),K("ngModelChange",function(r){E(t);let o=_();return Q(o.selectedEndYearSummary,r)||(o.selectedEndYearSummary=r),S(r)}),V(11,L4,2,2,"option",20,Y),s()(),l(13,"div",23)(14,"button",24),b("click",function(){E(t);let r=_();return S(r.applySummaryFilter())}),M(15,O4,3,0)(16,B4,3,0),s(),l(17,"button",25),b("click",function(){E(t);let r=_();return S(r.resetSummaryFilter())}),x(18,"ion-icon",26),s()()()}if(n&2){let t=_();m(4),J("ngModel",t.selectedStartYearSummary),m(),L(t.years()),m(5),J("ngModel",t.selectedEndYearSummary),m(),L(t.years()),m(3),I("disabled",t.isLoading()),m(),A(t.isLoading()?15:16)}}function $4(n,e){if(n&1&&(l(0,"option",20),d(1),s()),n&2){let t=e.$implicit;I("value",t),m(),w(t)}}function H4(n,e){if(n&1&&(l(0,"option",20),d(1),s()),n&2){let t=e.$implicit;I("value",t.value),m(),w(t.label)}}function G4(n,e){n&1&&(x(0,"ion-icon",27),l(1,"span"),d(2,"\u5957\u7528\u4E2D..."),s())}function q4(n,e){n&1&&(x(0,"ion-icon",28),l(1,"span"),d(2,"\u5957\u7528"),s())}function W4(n,e){if(n&1){let t=B();l(0,"div",6)(1,"div",17)(2,"label",29),d(3,"\u5E74\u5EA6:"),s(),l(4,"select",30),K("ngModelChange",function(r){E(t);let o=_();return Q(o.selectedYear,r)||(o.selectedYear=r),S(r)}),V(5,$4,2,2,"option",20,Y),s()(),l(7,"div",17)(8,"label",31),d(9,"\u5B63\u5EA6:"),s(),l(10,"select",32),K("ngModelChange",function(r){E(t);let o=_();return Q(o.selectedQuarter,r)||(o.selectedQuarter=r),S(r)}),V(11,H4,2,2,"option",20,F4),s()(),l(13,"div",23)(14,"button",24),b("click",function(){E(t);let r=_();return S(r.applyFilter())}),M(15,G4,3,0)(16,q4,3,0),s(),l(17,"button",25),b("click",function(){E(t);let r=_();return S(r.resetFilter())}),x(18,"ion-icon",26),s()()()}if(n&2){let t=_();m(4),J("ngModel",t.selectedYear),m(),L(t.years()),m(5),J("ngModel",t.selectedQuarter),m(),L(t.quarters()),m(3),I("disabled",t.isLoading()),m(),A(t.isLoading()?15:16)}}function j4(n,e){if(n&1&&(l(0,"th",37),d(1),s()),n&2){let t=e.$implicit;m(),N("",t,"\u5E74")}}function z4(n,e){if(n&1){let t=B();l(0,"td",51),b("click",function(){let r=E(t).$implicit,o=_(3);return S(o.openDetailModal(r,"revenue"))}),d(1),s()}if(n&2){let t=e.$implicit,i=_(),r=_(2);m(),w(r.formatCurrency(i.revenue[t]))}}function Y4(n,e){if(n&1&&(l(0,"td",54),d(1),s()),n&2){let t=e.$implicit,i=_(2),r=_(2);m(),N(" (",r.formatCurrency(i.salesDiscount[t]),") ")}}function J4(n,e){if(n&1&&(l(0,"tr",43)(1,"td",52),x(2,"ion-icon",53),d(3,"-\u92B7\u8CA8\u6298\u8B93 "),s(),V(4,Y4,2,1,"td",54,Y),l(6,"td",55),d(7),s()()),n&2){let t=_(),i=_(2);m(4),L(t.years),m(3),N(" (",i.formatCurrency(t.salesDiscount.total),") ")}}function K4(n,e){if(n&1){let t=B();l(0,"td",56),b("click",function(){let r=E(t).$implicit,o=_(3);return S(o.openDetailModal(r,"expense"))}),d(1),s()}if(n&2){let t=e.$implicit,i=_(),r=_(2);m(),w(r.formatCurrency(i.expense[t]))}}function Q4(n,e){if(n&1&&(l(0,"td",37),d(1),s()),n&2){let t=e.$implicit,i=_(),r=_(2);j("text-red-600",i.net[t]<0),m(),w(r.formatCurrency(i.net[t]))}}function Z4(n,e){if(n&1){let t=B();l(0,"td",57),b("click",function(){let r=E(t).$implicit,o=_(3);return S(o.openDetailModal(r,"unpaid"))}),d(1),s()}if(n&2){let t=e.$implicit,i=_(),r=_(2);m(),w(r.formatCurrency(i.unpaid[t]))}}function X4(n,e){if(n&1&&(l(0,"table",33)(1,"thead",35)(2,"tr")(3,"th",36),d(4,"\u9805\u76EE"),s(),V(5,j4,2,1,"th",37,Y),l(7,"th",37),d(8,"\u7E3D\u8A08"),s()()(),l(9,"tbody")(10,"tr",38)(11,"td",39),x(12,"ion-icon",40),d(13,"\u6536\u5165 "),s(),V(14,z4,2,1,"td",41,Y),l(16,"td",42),d(17),s()(),M(18,J4,8,1,"tr",43),l(19,"tr",44)(20,"td",39),x(21,"ion-icon",40),d(22,"\u652F\u51FA "),s(),V(23,K4,2,1,"td",45,Y),l(25,"td",42),d(26),s()(),l(27,"tr",46)(28,"td",36),d(29,"\u7E3D\u8A08"),s(),V(30,Q4,2,3,"td",47,Y),l(32,"td",37),d(33),s()(),l(34,"tr",48)(35,"td",39),x(36,"ion-icon",40),d(37,"\u672A\u4ED8 "),s(),V(38,Z4,2,1,"td",49,Y),l(40,"td",50),d(41),s()()()()),n&2){let t=e,i=_(2);m(5),L(t.years),m(9),L(t.years),m(3),w(i.formatCurrency(t.revenue.total)),m(),A(t.salesDiscount?18:-1),m(5),L(t.years),m(3),w(i.formatCurrency(t.expense.total)),m(4),L(t.years),m(2),j("text-red-600",t.net.total<0),m(),w(i.formatCurrency(t.net.total)),m(5),L(t.years),m(3),w(i.formatCurrency(t.unpaid.total))}}function eR(n,e){n&1&&(l(0,"div",34),d(1,"\u7121\u6CD5\u8F09\u5165\u7E3D\u8868\u6578\u64DA\u3002"),s())}function tR(n,e){if(n&1&&M(0,X4,42,7,"table",33)(1,eR,2,0,"div",34),n&2){let t,i=_();A((t=i.annualSummary())?0:1,t)}}function nR(n,e){if(n&1&&(l(0,"th",63),d(1),s()),n&2){let t=e.$implicit,i=_(3);m(),w(i.formatMonth(t))}}function iR(n,e){if(n&1&&(l(0,"td",82),d(1),s()),n&2){let t=e.$implicit,i=_().$implicit,r=_(3);m(),w(r.formatCurrency(i.monthlyAmounts[t]||0))}}function rR(n,e){if(n&1&&(l(0,"tr",66),x(1,"td",78),l(2,"td",79),d(3),s(),l(4,"td",80),d(5),s(),l(6,"td",81),d(7),s(),V(8,iR,2,1,"td",82,Y),s()),n&2){let t=e.$implicit,i=_(),r=_(2);m(3),w(t.account),m(2),w(r.formatCurrency(t.total)),m(2),N("",t.percentage==null?null:t.percentage.toFixed(2),"%"),m(),L(i.months)}}function oR(n,e){if(n&1&&(l(0,"td",71),d(1),s()),n&2){let t=e.$implicit,i=_(),r=_(2);m(),w(r.formatCurrency(i.operatingRevenue.monthlyTotals[t]||0))}}function aR(n,e){if(n&1&&(l(0,"td",82),d(1),s()),n&2){let t=e.$implicit,i=_().$implicit,r=_(3);m(),w(r.formatCurrency(i.monthlyAmounts[t]||0))}}function sR(n,e){if(n&1&&(l(0,"tr",66),x(1,"td",78),l(2,"td",79),d(3),s(),l(4,"td",80),d(5),s(),l(6,"td",81),d(7),s(),V(8,aR,2,1,"td",82,Y),s()),n&2){let t=e.$implicit,i=_(),r=_(2);m(3),w(t.account),m(2),w(r.formatCurrency(t.total)),m(2),N("",t.percentage==null?null:t.percentage.toFixed(2),"%"),m(),L(i.months)}}function lR(n,e){if(n&1&&(l(0,"td",71),d(1),s()),n&2){let t=e.$implicit,i=_(),r=_(2);m(),w(r.formatCurrency(i.operatingExpenses.monthlyTotals[t]||0))}}function uR(n,e){if(n&1&&(l(0,"td",77),d(1),s()),n&2){let t=e.$implicit,i=_(),r=_(2);m(),w(r.formatCurrency(i.netIncome.monthlyTotals[t]||0))}}function dR(n,e){if(n&1&&(l(0,"div",58)(1,"table",33)(2,"thead",35)(3,"tr")(4,"th",59),d(5,"\u9805\u76EE"),s(),l(6,"th",60),d(7,"\u79D1\u76EE"),s(),l(8,"th",61),d(9,"\u7E3D\u8A08"),s(),l(10,"th",62),d(11,"%"),s(),V(12,nR,2,1,"th",63,Y),s()(),l(14,"tbody")(15,"tr",64)(16,"td",65),d(17,"\u71DF\u696D\u6536\u5165"),s(),x(18,"td"),s(),V(19,rR,10,3,"tr",66,Xl),l(21,"tr",67)(22,"td",68),d(23,"\u71DF\u696D\u6536\u5165\u5C0F\u8A08"),s(),l(24,"td",69),d(25),s(),l(26,"td",70),d(27,"100.00%"),s(),V(28,oR,2,1,"td",71,Y),s(),l(30,"tr"),x(31,"td",72),s(),l(32,"tr",64)(33,"td",65),d(34,"\u71DF\u696D\u8CBB\u7528"),s(),x(35,"td"),s(),V(36,sR,10,3,"tr",66,Xl),l(38,"tr",67)(39,"td",68),d(40,"\u71DF\u696D\u8CBB\u7528\u5C0F\u8A08"),s(),l(41,"td",69),d(42),s(),l(43,"td",70),d(44,"100.00%"),s(),V(45,lR,2,1,"td",71,Y),s(),l(47,"tr"),x(48,"td",72),s(),l(49,"tr",73)(50,"td",74),d(51,"\u7E3D\u8A08 (\u672C\u671F\u640D\u76CA)"),s(),l(52,"td",75),d(53),s(),x(54,"td",76),V(55,uR,2,1,"td",77,Y),s()()()()),n&2){let t=e,i=_(2);m(12),L(t.months),m(6),gt("colspan",t.months.length+1),m(),L(t.operatingRevenue.items),m(6),w(i.formatCurrency(t.operatingRevenue.grandTotal)),m(3),L(t.months),m(3),gt("colspan",t.months.length+4),m(4),gt("colspan",t.months.length+1),m(),L(t.operatingExpenses.items),m(6),w(i.formatCurrency(t.operatingExpenses.grandTotal)),m(3),L(t.months),m(3),gt("colspan",t.months.length+4),m(5),w(i.formatCurrency(t.netIncome.grandTotal)),m(2),L(t.months)}}function cR(n,e){n&1&&(l(0,"div",34),d(1,"\u7121\u6CD5\u8F09\u5165\u640D\u76CA\u8868\u6578\u64DA\u3002"),s())}function mR(n,e){if(n&1&&M(0,dR,57,7,"div",58)(1,cR,2,0,"div",34),n&2){let t,i=_();A((t=i.monthlyIncomeStatement())?0:1,t)}}function pR(n,e){if(n&1&&(l(0,"th",63),d(1),s()),n&2){let t=e.$implicit,i=_(3);m(),w(i.formatMonth(t))}}function fR(n,e){if(n&1&&(l(0,"td",82),d(1),s()),n&2){let t=e.$implicit,i=_().$implicit,r=_(3);m(),w(r.formatCurrency(i.monthlyAmounts[t]||0))}}function gR(n,e){if(n&1&&(l(0,"tr",66),x(1,"td",78),l(2,"td",79),d(3),s(),l(4,"td",80),d(5),s(),l(6,"td",81),d(7),s(),V(8,fR,2,1,"td",82,Y),s()),n&2){let t=e.$implicit,i=_(),r=_(2);m(3),w(t.account),m(2),w(r.formatCurrency(t.total)),m(2),N("",t.percentage==null?null:t.percentage.toFixed(2),"%"),m(),L(i.months)}}function hR(n,e){if(n&1&&(l(0,"td",71),d(1),s()),n&2){let t=e.$implicit,i=_(),r=_(2);m(),w(r.formatCurrency(i.assets.monthlyTotals[t]||0))}}function yR(n,e){if(n&1&&(l(0,"td",82),d(1),s()),n&2){let t=e.$implicit,i=_().$implicit,r=_(3);m(),w(r.formatCurrency(i.monthlyAmounts[t]||0))}}function _R(n,e){if(n&1&&(l(0,"tr",66),x(1,"td",78),l(2,"td",79),d(3),s(),l(4,"td",80),d(5),s(),l(6,"td",81),d(7),s(),V(8,yR,2,1,"td",82,Y),s()),n&2){let t=e.$implicit,i=_(),r=_(2);m(3),w(t.account),m(2),w(r.formatCurrency(t.total)),m(2),N("",t.percentage==null?null:t.percentage.toFixed(2),"%"),m(),L(i.months)}}function vR(n,e){if(n&1&&(l(0,"td",71),d(1),s()),n&2){let t=e.$implicit,i=_(),r=_(2);m(),w(r.formatCurrency(i.liabilities.monthlyTotals[t]||0))}}function CR(n,e){if(n&1&&(l(0,"td",82),d(1),s()),n&2){let t=e.$implicit,i=_().$implicit,r=_(3);m(),w(r.formatCurrency(i.monthlyAmounts[t]||0))}}function xR(n,e){if(n&1&&(l(0,"tr",66),x(1,"td",78),l(2,"td",79),d(3),s(),l(4,"td",80),d(5),s(),l(6,"td",81),d(7),s(),V(8,CR,2,1,"td",82,Y),s()),n&2){let t=e.$implicit,i=_(),r=_(2);m(3),w(t.account),m(2),w(r.formatCurrency(t.total)),m(2),N("",t.percentage==null?null:t.percentage.toFixed(2),"%"),m(),L(i.months)}}function bR(n,e){if(n&1&&(l(0,"td",71),d(1),s()),n&2){let t=e.$implicit,i=_(),r=_(2);m(),w(r.formatCurrency(i.equity.monthlyTotals[t]||0))}}function ER(n,e){if(n&1&&(l(0,"td",88),d(1),s()),n&2){let t=e.$implicit,i=_(),r=_(2);m(),w(r.formatCurrency(i.totalLiabilitiesAndEquity.monthlyTotals[t]||0))}}function SR(n,e){if(n&1&&(l(0,"div",58)(1,"table",33)(2,"thead",35)(3,"tr")(4,"th",59),d(5,"\u9805\u76EE"),s(),l(6,"th",60),d(7,"\u79D1\u76EE"),s(),l(8,"th",61),d(9,"\u7E3D\u8A08"),s(),l(10,"th",62),d(11,"%"),s(),V(12,pR,2,1,"th",63,Y),s()(),l(14,"tbody")(15,"tr",64)(16,"td",65),d(17,"\u8CC7\u7522"),s(),x(18,"td"),s(),V(19,gR,10,3,"tr",66,Xl),l(21,"tr",67)(22,"td",68),d(23,"\u8CC7\u7522\u5C0F\u8A08"),s(),l(24,"td",83),d(25),s(),l(26,"td",70),d(27,"100.00%"),s(),V(28,hR,2,1,"td",71,Y),s(),l(30,"tr"),x(31,"td",72),s(),l(32,"tr",64)(33,"td",65),d(34,"\u8CA0\u50B5"),s(),x(35,"td"),s(),V(36,_R,10,3,"tr",66,Xl),l(38,"tr",84)(39,"td",85),d(40,"\u8CA0\u50B5\u5C0F\u8A08"),s(),l(41,"td",86),d(42),s(),x(43,"td",87),V(44,vR,2,1,"td",71,Y),s(),l(46,"tr"),x(47,"td",72),s(),l(48,"tr",64)(49,"td",65),d(50,"\u696D\u4E3B\u6B0A\u76CA"),s(),x(51,"td"),s(),V(52,xR,10,3,"tr",66,Xl),l(54,"tr",84)(55,"td",85),d(56,"\u696D\u4E3B\u6B0A\u76CA\u5C0F\u8A08"),s(),l(57,"td",86),d(58),s(),x(59,"td",87),V(60,bR,2,1,"td",71,Y),s(),l(62,"tr"),x(63,"td",72),s(),l(64,"tr",67)(65,"td",68),d(66,"\u8CA0\u50B5\u53CA\u696D\u4E3B\u6B0A\u76CA\u7E3D\u8A08"),s(),l(67,"td",83),d(68),s(),x(69,"td",70),V(70,ER,2,1,"td",88,Y),s()()()()),n&2){let t=e,i=_(2);m(12),L(t.months),m(6),gt("colspan",t.months.length+1),m(),L(t.assets.items),m(6),w(i.formatCurrency(t.assets.grandTotal)),m(3),L(t.months),m(3),gt("colspan",t.months.length+4),m(4),gt("colspan",t.months.length+1),m(),L(t.liabilities.items),m(6),w(i.formatCurrency(t.liabilities.grandTotal)),m(2),L(t.months),m(3),gt("colspan",t.months.length+4),m(4),gt("colspan",t.months.length+1),m(),L(t.equity.items),m(6),w(i.formatCurrency(t.equity.grandTotal)),m(2),L(t.months),m(3),gt("colspan",t.months.length+4),m(5),w(i.formatCurrency(t.totalLiabilitiesAndEquity.grandTotal)),m(2),L(t.months)}}function DR(n,e){n&1&&(l(0,"div",34),d(1,"\u7121\u6CD5\u8F09\u5165\u8CC7\u7522\u8CA0\u50B5\u8868\u6578\u64DA\u3002"),s())}function wR(n,e){if(n&1&&M(0,SR,72,10,"div",58)(1,DR,2,0,"div",34),n&2){let t,i=_();A((t=i.monthlyBalanceSheet())?0:1,t)}}function TR(n,e){n&1&&(l(0,"tr")(1,"th",100),d(2,"\u6708\u4EFD"),s(),l(3,"th",101),d(4,"\u7E3D\u8A08\u91D1\u984D"),s(),l(5,"th",101),d(6,"\u92B7\u8CA8\u6536\u5165"),s(),l(7,"th",101),d(8,"\u5176\u4ED6\u6536\u5165"),s(),l(9,"th",101),d(10,"-\u92B7\u8CA8\u6298\u8B93"),s()())}function IR(n,e){n&1&&(l(0,"tr")(1,"th",100),d(2,"\u6708\u4EFD"),s(),l(3,"th",101),d(4,"\u7E3D\u8A08\u91D1\u984D"),s(),l(5,"th",101),d(6,"\u5546\u54C1"),s(),l(7,"th",101),d(8,"\u96DC\u9805\u8B8A\u52D5"),s()())}function MR(n,e){n&1&&(l(0,"tr")(1,"th",100),d(2,"\u6708\u4EFD"),s(),l(3,"th",101),d(4,"\u7E3D\u8A08\u91D1\u984D"),s(),l(5,"th",101),d(6,"\u61C9\u4ED8\u5E33\u6B3E"),s(),l(7,"th",101),d(8,"\u61C9\u4ED8\u88DD\u6F62\u6B3E"),s(),l(9,"th",101),d(10,"\u61C9\u4ED8\u85AA\u8CC7"),s(),l(11,"th",101),d(12,"\u61C9\u4ED8\u80A1\u6771\u56DE\u994B\u91D1"),s(),l(13,"th",101),d(14,"\u61C9\u4ED8\u96EA\u8304\u9032\u8CA8"),s()())}function AR(n,e){if(n&1&&(l(0,"th",100),d(1),s(),l(2,"th",101),d(3,"\u91D1\u984D"),s()),n&2){let t=e.$implicit;m(),w(t.name)}}function RR(n,e){if(n&1&&(l(0,"tr")(1,"th",100),d(2,"\u6708\u4EFD"),s(),l(3,"th",101),d(4,"\u91D1\u984D"),s(),V(5,AR,4,1,null,null,ly),s()),n&2){let t=_();m(5),L(t.data[0].items)}}function NR(n,e){if(n&1&&(l(0,"tr",102)(1,"td",103),d(2),s(),l(3,"td",104),d(4),s(),l(5,"td",101),d(6),s(),l(7,"td",101),d(8),s(),l(9,"td",105),d(10),s()()),n&2){let t=e.$implicit,i=_(4);m(2),N("",t.month,"\u6708"),m(2),w(i.formatCurrency(t.total)),m(2),w(i.formatCurrency(i.getDetailItemAmount(t,"\u92B7\u8CA8\u6536\u5165"))),m(2),w(i.formatCurrency(i.getDetailItemAmount(t,"\u5176\u4ED6\u6536\u5165"))),m(2),N(" (",i.formatCurrency(i.getDetailItemAmount(t,"-\u92B7\u8CA8\u6298\u8B93")),") ")}}function FR(n,e){if(n&1&&V(0,NR,11,5,"tr",102,Sm),n&2){let t=_();L(t.data)}}function PR(n,e){if(n&1&&(l(0,"tr",102)(1,"td",103),d(2),s(),l(3,"td",104),d(4),s(),l(5,"td",101),d(6),s(),l(7,"td",101),d(8),s()()),n&2){let t=e.$implicit,i=_(4);m(2),N("",t.month,"\u6708"),m(2),w(i.formatCurrency(t.total)),m(2),w(i.formatCurrency(i.getDetailItemAmount(t,"\u5546\u54C1"))),m(2),w(i.formatCurrency(i.getDetailItemAmount(t,"\u96DC\u9805\u8B8A\u52D5")))}}function kR(n,e){if(n&1&&V(0,PR,9,4,"tr",102,Sm),n&2){let t=_();L(t.data)}}function VR(n,e){if(n&1&&(l(0,"tr",102)(1,"td",103),d(2),s(),l(3,"td",104),d(4),s(),l(5,"td",101),d(6),s(),l(7,"td",101),d(8),s(),l(9,"td",101),d(10),s(),l(11,"td",101),d(12),s(),l(13,"td",101),d(14),s()()),n&2){let t=e.$implicit,i=_(4);m(2),N("",t.month,"\u6708"),m(2),w(i.formatCurrency(t.total)),m(2),w(i.formatCurrency(i.getDetailItemAmount(t,"\u61C9\u4ED8\u5E33\u6B3E"))),m(2),w(i.formatCurrency(i.getDetailItemAmount(t,"\u61C9\u4ED8\u88DD\u6F62\u6B3E"))),m(2),w(i.formatCurrency(i.getDetailItemAmount(t,"\u61C9\u4ED8\u85AA\u8CC7"))),m(2),w(i.formatCurrency(i.getDetailItemAmount(t,"\u61C9\u4ED8\u80A1\u6771\u56DE\u994B\u91D1"))),m(2),w(i.formatCurrency(i.getDetailItemAmount(t,"\u61C9\u4ED8\u96EA\u8304\u9032\u8CA8")))}}function LR(n,e){if(n&1&&V(0,VR,15,7,"tr",102,Sm),n&2){let t=_();L(t.data)}}function OR(n,e){if(n&1&&(l(0,"td",100),d(1),s(),l(2,"td",101),d(3),s()),n&2){let t=e.$implicit,i=_(5);m(),w(t.name),m(2),w(i.formatCurrency(t.amount))}}function BR(n,e){if(n&1&&(l(0,"tr",102)(1,"td",103),d(2),s(),l(3,"td",104),d(4),s(),V(5,OR,4,2,null,null,ly),s()),n&2){let t=e.$implicit,i=_(4);m(2),N("",t.month,"\u6708"),m(2),w(i.formatCurrency(t.total)),m(),L(t.items)}}function UR(n,e){if(n&1&&V(0,BR,7,2,"tr",102,Sm),n&2){let t=_();L(t.data)}}function $R(n,e){if(n&1&&(l(0,"tr",99)(1,"td",106),d(2,"\u5C0F\u8A08"),s(),l(3,"td",107),d(4),s(),l(5,"td",107),d(6),s(),l(7,"td",107),d(8),s(),l(9,"td",108),d(10),s()()),n&2){let t=_(3);m(4),w(t.formatCurrency(t.detailModalTotal())),m(2),w(t.formatCurrency(t.calculateMonthlyItemTotal("\u92B7\u8CA8\u6536\u5165"))),m(2),w(t.formatCurrency(t.calculateMonthlyItemTotal("\u5176\u4ED6\u6536\u5165"))),m(2),N(" (",t.formatCurrency(t.calculateMonthlyItemTotal("-\u92B7\u8CA8\u6298\u8B93")),") ")}}function HR(n,e){if(n&1&&(l(0,"tr",99)(1,"td",106),d(2,"\u5C0F\u8A08"),s(),l(3,"td",107),d(4),s(),l(5,"td",107),d(6),s(),l(7,"td",107),d(8),s()()),n&2){let t=_(3);m(4),w(t.formatCurrency(t.detailModalTotal())),m(2),w(t.formatCurrency(t.calculateMonthlyItemTotal("\u5546\u54C1"))),m(2),w(t.formatCurrency(t.calculateMonthlyItemTotal("\u96DC\u9805\u8B8A\u52D5")))}}function GR(n,e){if(n&1&&(l(0,"tr",99)(1,"td",106),d(2,"\u5C0F\u8A08"),s(),l(3,"td",107),d(4),s(),l(5,"td",107),d(6),s(),l(7,"td",107),d(8),s(),l(9,"td",107),d(10),s(),l(11,"td",107),d(12),s(),l(13,"td",107),d(14),s()()),n&2){let t=_(3);m(4),w(t.formatCurrency(t.detailModalTotal())),m(2),w(t.formatCurrency(t.calculateMonthlyItemTotal("\u61C9\u4ED8\u5E33\u6B3E"))),m(2),w(t.formatCurrency(t.calculateMonthlyItemTotal("\u61C9\u4ED8\u88DD\u6F62\u6B3E"))),m(2),w(t.formatCurrency(t.calculateMonthlyItemTotal("\u61C9\u4ED8\u85AA\u8CC7"))),m(2),w(t.formatCurrency(t.calculateMonthlyItemTotal("\u61C9\u4ED8\u80A1\u6771\u56DE\u994B\u91D1"))),m(2),w(t.formatCurrency(t.calculateMonthlyItemTotal("\u61C9\u4ED8\u96EA\u8304\u9032\u8CA8")))}}function qR(n,e){if(n&1&&(l(0,"td",106),d(1),s(),l(2,"td",107),d(3),s()),n&2){let t=e.$implicit,i=_(4);m(),w(t.name),m(2),w(i.formatCurrency(i.calculateMonthlyItemTotal(t.name)))}}function WR(n,e){if(n&1&&(l(0,"tr",99)(1,"td",106),d(2,"\u5C0F\u8A08"),s(),l(3,"td",107),d(4),s(),V(5,qR,4,2,null,null,ly),s()),n&2){let t=_(),i=_(2);m(4),w(i.formatCurrency(i.detailModalTotal())),m(),L(t.data[0].items)}}function jR(n,e){if(n&1){let t=B();l(0,"div",89)(1,"div",90)(2,"h3",91),d(3),s(),l(4,"button",92),b("click",function(){E(t);let r=_(2);return S(r.closeDetailModal())}),x(5,"ion-icon",93),s()(),l(6,"div",94)(7,"div",95),x(8,"canvas",null,0),s(),l(10,"div",96)(11,"table",33)(12,"thead",97),M(13,TR,11,0,"tr")(14,IR,9,0,"tr")(15,MR,15,0,"tr")(16,RR,7,0,"tr"),s(),l(17,"tbody"),M(18,FR,2,0)(19,kR,2,0)(20,LR,2,0)(21,UR,2,0),s(),l(22,"tfoot",98),M(23,$R,11,4,"tr",99)(24,HR,9,3,"tr",99)(25,GR,15,6,"tr",99)(26,WR,7,1,"tr",99),s()()()()()}if(n&2){let t=e,i=_(2);m(3),Lt("",t.year," \u5E74 ",t.type,"\u660E\u7D30 (\u7E3D\u8A08: ",i.formatCurrency(i.detailModalTotal()),")"),m(10),A(t.type==="\u6536\u5165"?13:t.type==="\u652F\u51FA"?14:t.type==="\u672A\u4ED8"?15:16),m(5),A(t.type==="\u6536\u5165"?18:t.type==="\u652F\u51FA"?19:t.type==="\u672A\u4ED8"?20:21),m(5),A(t.type==="\u6536\u5165"?23:t.type==="\u652F\u51FA"?24:t.type==="\u672A\u4ED8"?25:26)}}function zR(n,e){if(n&1&&(l(0,"div",12),M(1,jR,27,6,"div",89),s()),n&2){let t,i=_();m(),A((t=i.detailModalData())?1:-1,t)}}var Fa=class Fa{constructor(){this.apiService=k(we);this.activeStatement=D("summary");this.annualSummary=D(null);this.monthlyIncomeStatement=D(null);this.monthlyBalanceSheet=D(null);this.isLoading=D(!1);this.errorMessage=D(null);this.isDetailModalOpen=D(!1);this.detailModalData=D(null);this.years=D([2026,2025,2024]);this.quarters=D([{value:"all",label:"\u5168\u5E74"},{value:1,label:"\u7B2C\u4E00\u5B63"},{value:2,label:"\u7B2C\u4E8C\u5B63"},{value:3,label:"\u7B2C\u4E09\u5B63"},{value:4,label:"\u7B2C\u56DB\u5B63"}]);this.selectedYear=D(2026);this.selectedQuarter=D("all");this.selectedStartYearSummary=D(2024);this.selectedEndYearSummary=D(2026);this.selectedYearForDetail=D(2026);this.detailModalTotal=$(()=>{let e=this.detailModalData();return e?e.data.reduce((t,i)=>t+i.total,0):0});this.applySummaryFilter(),this.applyFilter()}set detailChartRef(e){this.destroyDetailChart(),e&&this.detailModalData()&&this.createDetailChart(e)}setActiveStatement(e){this.activeStatement.set(e)}convertToNumber(e){if(e==null)return 0;if(typeof e=="number")return e;if(typeof e=="string"){let t=parseFloat(e.replace(/[^0-9.-]/g,""));return isNaN(t)?0:t}return 0}normalizeIncomeStatement(e){if(!e)return e;let t=(i,r)=>{let o=i.items.map(g=>{let y={},v=0;return Object.entries(g.monthlyAmounts||{}).forEach(([C,T])=>{let R=this.convertToNumber(T);y[C]=R,v+=R}),G(O({},g),{monthlyAmounts:y,total:v})}),a=0,u={},c=o;if(r==="operatingRevenue"){o.some(T=>T.account?.includes("-\u92B7\u8CA8\u6298\u8B93"))&&(c=o.filter(T=>T.account!=="\u92B7\u8CA8\u6298\u8B93"));let y=c.find(T=>T.account.includes("\u92B7\u8CA8\u6536\u5165")),v=c.find(T=>T.account.includes("\u5176\u4ED6\u6536\u5165")),C=c.find(T=>T.account.includes("\u92B7\u8CA8\u6298\u8B93"));a=(y?.total||0)+(v?.total||0)-(C?.total||0),e.months&&e.months.forEach(T=>{let R=(y?.monthlyAmounts?.[T]||0)+(v?.monthlyAmounts?.[T]||0)-(C?.monthlyAmounts?.[T]||0);u[T]=Math.max(0,R)})}else r==="operatingExpenses"?(a=c.reduce((g,y)=>g+(y.total||0),0),e.months&&e.months.forEach(g=>{let y=c.reduce((v,C)=>v+(C.monthlyAmounts?.[g]||0),0);u[g]=y})):(a=c.reduce((g,y)=>g+(y.total||0),0),e.months&&e.months.forEach(g=>{let y=c.reduce((v,C)=>v+(C.monthlyAmounts?.[g]||0),0);u[g]=y}));let p=c.map(g=>{let y=a>0?g.total/a*100:0;return G(O({},g),{percentage:y})});return G(O({},i),{items:p,monthlyTotals:u,grandTotal:a})};return G(O({},e),{operatingRevenue:t(e.operatingRevenue,"operatingRevenue"),operatingExpenses:t(e.operatingExpenses,"operatingExpenses"),netIncome:{monthlyTotals:Object.entries(e.netIncome.monthlyTotals||{}).reduce((i,[r,o])=>(i[r]=this.convertToNumber(o),i),{}),grandTotal:this.convertToNumber(e.netIncome.grandTotal)}})}normalizeBalanceSheet(e){if(!e)return e;let t=i=>{let r=i.items.map(c=>{let p={},g=0;return Object.entries(c.monthlyAmounts||{}).forEach(([y,v])=>{let C=this.convertToNumber(v);p[y]=C,g+=C}),G(O({},c),{monthlyAmounts:p,total:g})}),o=r.reduce((c,p)=>c+(p.total||0),0),a=r.map(c=>{let p=o>0?c.total/o*100:0;return G(O({},c),{percentage:p})}),u={};return e.months&&e.months.forEach(c=>{let p=r.reduce((g,y)=>g+(y.monthlyAmounts?.[c]||0),0);u[c]=p}),G(O({},i),{items:a,monthlyTotals:u,grandTotal:o})};return G(O({},e),{assets:t(e.assets),liabilities:t(e.liabilities),equity:t(e.equity),totalLiabilitiesAndEquity:t(e.totalLiabilitiesAndEquity)})}async applyFilter(){let e=this.selectedYear(),t=this.selectedQuarter();this.isLoading.set(!0),this.errorMessage.set(null);try{let i=await this.apiService.getIncomeStatement(e,t);if(i.success&&i.data){let o=this.normalizeIncomeStatement(i.data);this.monthlyIncomeStatement.set(o)}else this.errorMessage.set(i.error||"\u7121\u6CD5\u53D6\u5F97\u640D\u76CA\u8868\u8CC7\u6599");let r=await this.apiService.getBalanceSheet(e,t);if(r.success&&r.data){let o=this.normalizeBalanceSheet(r.data);this.monthlyBalanceSheet.set(o)}else this.errorMessage.set(r.error||"\u7121\u6CD5\u53D6\u5F97\u8CC7\u7522\u8CA0\u50B5\u8868\u8CC7\u6599")}catch(i){console.error("Error loading financial statements:",i),this.errorMessage.set("\u53D6\u5F97\u8CA1\u52D9\u5831\u8868\u8CC7\u6599\u5931\u6557\uFF0C\u8ACB\u7A0D\u5F8C\u91CD\u8A66")}finally{this.isLoading.set(!1)}}resetFilter(){this.selectedYear.set(2026),this.selectedQuarter.set("all"),this.applyFilter()}async applySummaryFilter(){let e=this.selectedStartYearSummary(),t=this.selectedEndYearSummary();e>t&&(this.selectedStartYearSummary.set(t),this.selectedEndYearSummary.set(e)),this.selectedYearForDetail.set(this.selectedEndYearSummary()),this.isLoading.set(!0),this.errorMessage.set(null);try{let i=await this.apiService.getAnnualSummary(this.selectedStartYearSummary(),this.selectedEndYearSummary());if(i.success&&i.data){let r=this.normalizeAnnualSummary(i.data);this.annualSummary.set(r)}else this.errorMessage.set(i.error||"\u7121\u6CD5\u53D6\u5F97\u5E74\u5EA6\u7E3D\u8868\u8CC7\u6599")}catch(i){console.error("Error loading annual summary:",i),this.errorMessage.set("\u53D6\u5F97\u5E74\u5EA6\u7E3D\u8868\u8CC7\u6599\u5931\u6557\uFF0C\u8ACB\u7A0D\u5F8C\u91CD\u8A66")}finally{this.isLoading.set(!1)}}calculateRevenueBreakdown(e){let t={total:0},i={total:0};return Object.entries(e).forEach(([r,o])=>{if(r!=="total"){let a=parseInt(r,10);if(!isNaN(a)){let u=this.convertToNumber(o),c=Math.round(u*.9),p=u-c;t[a]=c,t.total+=c,i[a]=p,i.total+=p}}}),{salesRevenue:t,otherRevenue:i}}calculateExpenseBreakdown(e){let t={total:0},i={total:0};return Object.entries(e).forEach(([r,o])=>{if(r!=="total"){let a=parseInt(r,10);if(!isNaN(a)){let u=this.convertToNumber(o),c=Math.round(u*.35),p=u-c;t[a]=c,t.total+=c,i[a]=p,i.total+=p}}}),{merchandise:t,miscellaneous:i}}calculateUnpaidBreakdown(e){let t={total:0},i={total:0},r={total:0},o={total:0},a={total:0};return Object.entries(e).forEach(([u,c])=>{if(u!=="total"){let p=parseInt(u,10);if(!isNaN(p)){let g=this.convertToNumber(c),y=Math.round(g/5);t[p]=y,t.total+=y,i[p]=y,i.total+=y,r[p]=y,r.total+=y,o[p]=y,o.total+=y,a[p]=g-y*4,a.total+=g-y*4}}}),{accountsPayable:t,payableForRenovation:i,payableSalary:r,payableShareholderRebate:o,payableForGoods:a}}normalizeAnnualSummary(e){if(!e)return e;let t=G(O({},e),{revenue:Object.entries(e.revenue||{}).reduce((i,[r,o])=>{if(r==="total")i.total=this.convertToNumber(o);else{let a=parseInt(r,10);isNaN(a)||(i[a]=this.convertToNumber(o))}return i},{}),expense:Object.entries(e.expense||{}).reduce((i,[r,o])=>{if(r==="total")i.total=this.convertToNumber(o);else{let a=parseInt(r,10);isNaN(a)||(i[a]=this.convertToNumber(o))}return i},{}),net:Object.entries(e.net||{}).reduce((i,[r,o])=>{if(r==="total")i.total=this.convertToNumber(o);else{let a=parseInt(r,10);isNaN(a)||(i[a]=this.convertToNumber(o))}return i},{}),unpaid:Object.entries(e.unpaid||{}).reduce((i,[r,o])=>{if(r==="total")i.total=this.convertToNumber(o);else{let a=parseInt(r,10);isNaN(a)||(i[a]=this.convertToNumber(o))}return i},{})});return!t.revenueBreakdown&&t.revenue&&(t.revenueBreakdown=this.calculateRevenueBreakdown(t.revenue)),!t.expenseBreakdown&&t.expense&&(t.expenseBreakdown=this.calculateExpenseBreakdown(t.expense)),!t.unpaidBreakdown&&t.unpaid&&(t.unpaidBreakdown=this.calculateUnpaidBreakdown(t.unpaid)),t}resetSummaryFilter(){this.selectedStartYearSummary.set(2024),this.selectedEndYearSummary.set(2026),this.applySummaryFilter()}async openDetailModal(e,t){this.isLoading.set(!0),this.errorMessage.set(null);try{let i=await this.apiService.getFinancialStatementsDetails(e,t);i.success&&i.data?(this.detailModalData.set(i.data),this.isDetailModalOpen.set(!0)):(console.warn(`No detail data available for ${e} - ${t}`),this.errorMessage.set("\u7121\u6CD5\u53D6\u5F97\u660E\u7D30\u8CC7\u6599"))}catch(i){console.error("Error loading detail data:",i),this.errorMessage.set("\u53D6\u5F97\u660E\u7D30\u8CC7\u6599\u5931\u6557\uFF0C\u8ACB\u7A0D\u5F8C\u91CD\u8A66")}finally{this.isLoading.set(!1)}}closeDetailModal(){this.isDetailModalOpen.set(!1),this.detailModalData.set(null),this.destroyDetailChart()}createDetailChart(e){let t=this.detailModalData();if(!e||!t||t.data.length===0)return;let i=t.data,r=i.map(p=>`${p.month}\u6708`),o=[];t.type==="\u6536\u5165"?o=["\u92B7\u8CA8\u6536\u5165","\u5176\u4ED6\u6536\u5165","-\u92B7\u8CA8\u6298\u8B93"]:t.type==="\u652F\u51FA"?o=["\u5546\u54C1","\u96DC\u9805\u8B8A\u52D5"]:t.type==="\u672A\u4ED8"?o=["\u61C9\u4ED8\u5E33\u6B3E","\u61C9\u4ED8\u88DD\u6F62\u6B3E","\u61C9\u4ED8\u85AA\u8CC7","\u61C9\u4ED8\u80A1\u6771\u56DE\u994B\u91D1","\u61C9\u4ED8\u96EA\u8304\u9032\u8CA8"]:o=t.data[0]?.items.map(p=>p.name)||[];let a=["#4f46e5","#ef4444","#f59e0b","#10b981","#3b82f6","#8b5cf6"],u=[{label:"\u6708\u5EA6\u7E3D\u8A08",data:i.map(p=>p.total),borderColor:a[0],backgroundColor:"rgba(79, 70, 229, 0.1)",fill:!0,tension:.4,borderWidth:3,pointRadius:4}];o.forEach((p,g)=>{let y=i.map(v=>v.items.find(T=>T.name===p)?.amount||0);u.push({label:p,data:y,borderColor:a[(g+1)%a.length],backgroundColor:"transparent",fill:!1,tension:.4,borderDash:[5,5],borderWidth:2,pointRadius:3})});let c=e.nativeElement.getContext("2d");this.detailChart=new Chart(c,{type:"line",data:{labels:r,datasets:u},options:{responsive:!0,maintainAspectRatio:!1,scales:{y:{beginAtZero:!1,ticks:{callback:p=>this.formatCurrency(p)}}},plugins:{tooltip:{callbacks:{label:p=>`${p.dataset.label}: ${this.formatCurrency(p.raw)}`}}}}})}destroyDetailChart(){this.detailChart&&(this.detailChart.destroy(),this.detailChart=null)}calculateMonthlyItemTotal(e){let t=this.detailModalData();return t?t.data.reduce((i,r)=>{let o=r.items.find(a=>a.name===e);return i+(o?.amount||0)},0):0}getDetailItemAmount(e,t){let i=e.items.find(r=>r.name===t);return i?this.convertToNumber(i.amount):0}formatCurrency(e){return e==null?"NT$0":e.toLocaleString("zh-TW",{style:"currency",currency:"TWD",minimumFractionDigits:0})}formatMonth(e){return`${parseInt(e.split("-")[1],10)}\u6708`}calculateColumnWidth(e){let i=this.formatCurrency(e).length;return`${Math.max(5.5,2+i*.5)}rem`}getMaxMonthColumnWidth(e){let t=6;return e.forEach(r=>{if(r!=null){let o=this.formatCurrency(r);t=Math.max(t,o.length)}}),`${Math.max(5.5,2+t*.5)}rem`}};Fa.\u0275fac=function(t){return new(t||Fa)},Fa.\u0275cmp=re({type:Fa,selectors:[["app-financial-statements"]],viewQuery:function(t,i){if(t&1&&ut(N4,5),t&2){let r;tt(r=nt())&&(i.detailChartRef=r.first)}},decls:22,vars:12,consts:[["detailChart",""],[1,"space-y-6"],[1,"bg-blue-50","border","border-blue-200","rounded-lg","p-4","flex","items-center","gap-3"],[1,"bg-red-50","border","border-red-200","rounded-lg","p-4","flex","items-center","gap-3"],[1,"flex","flex-wrap","items-center","justify-between","gap-4"],[1,"text-3xl","font-bold","text-gray-900"],[1,"flex","flex-col","sm:flex-row","items-center","gap-2","bg-white","p-3","rounded-xl","shadow-md","border","border-gray-200"],[1,"bg-white","p-6","rounded-xl","shadow-md"],[1,"border-b","border-gray-200"],["aria-label","Tabs",1,"-mb-px","flex","space-x-6"],[1,"whitespace-nowrap","py-4","px-1","border-b-2","font-medium","text-sm",3,"click"],[1,"pt-6","overflow-x-auto"],[1,"fixed","inset-0","bg-black","bg-opacity-50","flex","items-center","justify-center","z-50","transition-opacity"],["name","hourglass-outline",1,"text-blue-600","text-xl","animate-spin"],[1,"text-blue-700"],["name","alert-circle-outline",1,"text-red-600","text-xl"],[1,"text-red-700"],[1,"flex","items-center","gap-2"],["for","startYear",1,"text-sm","font-medium","text-gray-600"],["id","startYear",1,"border-gray-300","rounded-lg","shadow-sm","focus:ring-indigo-500","focus:border-indigo-500","text-sm","p-2","bg-gray-100","pr-8",3,"ngModelChange","ngModel"],[3,"value"],["for","endYear",1,"text-sm","font-medium","text-gray-600"],["id","endYear",1,"border-gray-300","rounded-lg","shadow-sm","focus:ring-indigo-500","focus:border-indigo-500","text-sm","p-2","bg-gray-100","pr-8",3,"ngModelChange","ngModel"],[1,"flex","items-center","gap-2","mt-2","sm:mt-0"],[1,"bg-indigo-600","text-white","px-4","py-2","rounded-lg","font-medium","hover:bg-indigo-700","transition-colors","flex","items-center","gap-2","text-sm","disabled:opacity-50","disabled:cursor-not-allowed",3,"click","disabled"],["title","\u91CD\u8A2D\u7BE9\u9078",1,"text-gray-500","hover:text-gray-800","transition-colors","p-2","rounded-full","bg-gray-100","hover:bg-gray-200",3,"click"],["name","refresh-outline",1,"text-xl"],["name","hourglass-outline",1,"animate-spin"],["name","filter-outline"],["for","year",1,"text-sm","font-medium","text-gray-600"],["id","year",1,"border-gray-300","rounded-lg","shadow-sm","focus:ring-indigo-500","focus:border-indigo-500","text-sm","p-2","bg-gray-100","pr-8",3,"ngModelChange","ngModel"],["for","quarter",1,"text-sm","font-medium","text-gray-600"],["id","quarter",1,"border-gray-300","rounded-lg","shadow-sm","focus:ring-indigo-500","focus:border-indigo-500","text-sm","p-2","bg-gray-100","pr-8",3,"ngModelChange","ngModel"],[1,"w-full","text-sm","text-left","whitespace-nowrap"],[1,"text-center","py-8","text-gray-500"],[1,"text-xs","text-gray-700","uppercase","bg-gray-50"],[1,"py-3","px-4"],[1,"py-3","px-4","text-right"],[1,"border-b","border-gray-100","bg-blue-50","font-semibold"],[1,"py-3","px-4","text-gray-800"],["name","folder-open-outline",1,"align-middle","mr-2"],[1,"py-3","px-4","text-right","font-medium","text-blue-600","cursor-pointer","hover:underline","hover:bg-blue-100"],[1,"py-3","px-4","text-right","font-bold"],[1,"border-b","border-gray-100","bg-red-50"],[1,"border-b","border-gray-100","bg-red-50","font-semibold"],[1,"py-3","px-4","text-right","font-medium","text-red-600","cursor-pointer","hover:underline","hover:bg-red-100"],[1,"border-b-2","border-gray-200","bg-gray-50","font-bold"],[1,"py-3","px-4","text-right",3,"text-red-600"],[1,"border-b","border-gray-100","bg-orange-50","font-semibold"],[1,"py-3","px-4","text-right","font-medium","text-orange-600","cursor-pointer","hover:underline","hover:bg-orange-100"],[1,"py-3","px-4","text-right","font-bold","hover:underline"],[1,"py-3","px-4","text-right","font-medium","text-blue-600","cursor-pointer","hover:underline","hover:bg-blue-100",3,"click"],[1,"py-3","px-4","text-gray-800","pl-8"],["name","remove-circle-outline",1,"align-middle","mr-2","text-red-500"],[1,"py-3","px-4","text-right","font-medium","text-red-600"],[1,"py-3","px-4","text-right","font-bold","text-red-600"],[1,"py-3","px-4","text-right","font-medium","text-red-600","cursor-pointer","hover:underline","hover:bg-red-100",3,"click"],[1,"py-3","px-4","text-right","font-medium","text-orange-600","cursor-pointer","hover:underline","hover:bg-orange-100",3,"click"],[1,"relative","overflow-x-auto"],[1,"py-3","px-2","w-16","sticky","left-0","bg-gray-50","z-20","shadow-[2px_0_5px_-2px_rgba(0,0,0,0.1)]"],[1,"py-3","px-2","w-24","sticky","bg-gray-50","z-20","shadow-[2px_0_5px_-2px_rgba(0,0,0,0.1)]",2,"left","4rem"],[1,"py-3","px-2","w-20","text-right","tabular-nums","sticky","bg-gray-50","z-20","shadow-[2px_0_5px_-2px_rgba(0,0,0,0.1)]",2,"left","10rem"],[1,"py-3","px-2","w-12","text-right","tabular-nums","sticky","bg-gray-50","z-20","shadow-[2px_0_5px_-2px_rgba(0,0,0,0.1)]",2,"left","16rem"],[1,"py-3","px-2","text-right","text-xs","w-fit"],[1,"font-semibold","text-gray-800","bg-gray-100"],["colspan","4",1,"py-2","px-2","sticky","left-0","bg-gray-100","z-10","shadow-[2px_0_5px_-2px_rgba(0,0,0,0.1)]"],[1,"border-b","border-gray-100","hover:bg-gray-50"],[1,"font-semibold","text-gray-900","bg-gray-50","border-t-2","border-gray-200"],["colspan","2",1,"py-2","px-2","sticky","left-0","bg-gray-50","z-10","shadow-[2px_0_5px_-2px_rgba(0,0,0,0.1)]"],[1,"py-2","px-2","text-right","tabular-nums","font-medium","sticky","bg-gray-50","z-10","shadow-[2px_0_5px_-2px_rgba(0,0,0,0.1)]",2,"left","10rem"],[1,"py-2","px-2","text-right","tabular-nums","sticky","bg-gray-50","z-10","shadow-[2px_0_5px_-2px_rgba(0,0,0,0.1)]",2,"left","16rem"],[1,"py-2","px-2","text-right","text-xs","font-semibold","w-fit"],[1,"py-2"],[1,"font-bold","text-base","text-white","bg-indigo-600"],["colspan","2",1,"py-3","px-2","sticky","left-0","bg-indigo-600","z-10","shadow-[2px_0_5px_-2px_rgba(0,0,0,0.3)]"],[1,"py-3","px-2","text-right","tabular-nums","sticky","bg-indigo-600","z-10","shadow-[2px_0_5px_-2px_rgba(0,0,0,0.3)]",2,"left","10rem"],[1,"py-3","px-2","sticky","bg-indigo-600","z-10","shadow-[2px_0_5px_-2px_rgba(0,0,0,0.3)]",2,"left","16rem"],[1,"py-3","px-2","text-right","text-xs","font-bold","w-fit"],[1,"py-2","px-2","sticky","left-0","bg-white","hover:bg-gray-50","z-10","shadow-[2px_0_5px_-2px_rgba(0,0,0,0.1)]"],[1,"py-2","px-2","sticky","bg-white","hover:bg-gray-50","z-10","shadow-[2px_0_5px_-2px_rgba(0,0,0,0.1)]",2,"left","4rem"],[1,"py-2","px-2","text-right","tabular-nums","font-medium","sticky","bg-white","hover:bg-gray-50","z-10","shadow-[2px_0_5px_-2px_rgba(0,0,0,0.1)]",2,"left","10rem"],[1,"py-2","px-2","text-right","tabular-nums","sticky","bg-white","hover:bg-gray-50","z-10","shadow-[2px_0_5px_-2px_rgba(0,0,0,0.1)]",2,"left","16rem"],[1,"py-2","px-2","text-right","text-xs","w-fit"],[1,"py-2","px-2","text-right","tabular-nums","font-bold","text-indigo-600","sticky","bg-gray-50","z-10","shadow-[2px_0_5px_-2px_rgba(0,0,0,0.1)]",2,"left","10rem"],[1,"font-semibold","text-gray-900","border-t-2","border-gray-200"],["colspan","2",1,"py-2","px-2","sticky","left-0","bg-white","z-10","shadow-[2px_0_5px_-2px_rgba(0,0,0,0.1)]"],[1,"py-2","px-2","text-right","tabular-nums","font-medium","sticky","bg-white","z-10","shadow-[2px_0_5px_-2px_rgba(0,0,0,0.1)]",2,"left","10rem"],[1,"py-2","px-2","text-right","tabular-nums","sticky","bg-white","z-10","shadow-[2px_0_5px_-2px_rgba(0,0,0,0.1)]",2,"left","16rem"],[1,"py-2","px-2","text-right","text-xs","font-bold","w-fit"],[1,"bg-white","rounded-xl","shadow-2xl","w-full","max-w-6xl","max-h-[90vh]","flex","flex-col","m-4"],[1,"flex","justify-between","items-center","p-4","border-b"],[1,"text-lg","font-semibold"],[1,"text-gray-400","hover:text-gray-600","p-1","rounded-full","hover:bg-gray-100",3,"click"],["name","close-outline",1,"text-2xl"],[1,"flex-1","flex","flex-col","p-6","overflow-hidden"],[1,"h-64","mb-6"],[1,"flex-1","overflow-y-auto"],[1,"text-xs","text-gray-700","uppercase","bg-gray-50","sticky","top-0"],[1,"font-bold","bg-gray-100","sticky","bottom-0"],[1,"border-t-2"],[1,"px-4","py-2"],[1,"px-4","py-2","text-right"],[1,"border-b","hover:bg-gray-50"],[1,"px-4","py-2","font-medium"],[1,"px-4","py-2","text-right","font-semibold"],[1,"px-4","py-2","text-right","text-red-600"],[1,"px-4","py-3"],[1,"px-4","py-3","text-right"],[1,"px-4","py-3","text-right","text-red-600"]],template:function(t,i){if(t&1&&(l(0,"div",1),M(1,P4,4,0,"div",2),M(2,k4,4,1,"div",3),l(3,"div",4)(4,"h1",5),d(5,"\u8CA1\u52D9\u5831\u8868"),s(),M(6,U4,19,4,"div",6),M(7,W4,19,4,"div",6),s(),l(8,"div",7)(9,"div",8)(10,"nav",9)(11,"button",10),b("click",function(){return i.setActiveStatement("summary")}),d(12," \u7E3D\u8868 "),s(),l(13,"button",10),b("click",function(){return i.setActiveStatement("income")}),d(14," \u640D\u76CA\u8868 "),s(),l(15,"button",10),b("click",function(){return i.setActiveStatement("balance")}),d(16," \u8CC7\u7522\u8CA0\u50B5\u8868 "),s()()(),l(17,"div",11),M(18,tR,2,1)(19,mR,2,1)(20,wR,2,1),s()()(),M(21,zR,2,1,"div",12)),t&2){let r;m(),A(i.isLoading()?1:-1),m(),A(i.errorMessage()?2:-1),m(4),A(i.activeStatement()==="summary"?6:-1),m(),A(i.activeStatement()==="income"||i.activeStatement()==="balance"?7:-1),m(4),Te(i.activeStatement()==="summary"?"border-indigo-500 text-indigo-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"),m(2),Te(i.activeStatement()==="income"?"border-indigo-500 text-indigo-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"),m(2),Te(i.activeStatement()==="balance"?"border-indigo-500 text-indigo-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"),m(3),A((r=i.activeStatement())==="summary"?18:r==="income"?19:r==="balance"?20:-1),m(3),A(i.isDetailModalOpen()?21:-1)}},dependencies:[se,De,He,Ge,Oe,fe,Ie],encapsulation:2,changeDetection:0});var Em=Fa;var YR,JR;function KR(){return{geminiUrl:YR,vertexUrl:JR}}function QR(n,e,t,i){var r,o;if(!n?.baseUrl){let a=KR();return e?(r=a.vertexUrl)!==null&&r!==void 0?r:t:(o=a.geminiUrl)!==null&&o!==void 0?o:i}return n.baseUrl}var gi=class{};function te(n,e){let t=/\{([^}]+)\}/g;return n.replace(t,(i,r)=>{if(Object.prototype.hasOwnProperty.call(e,r)){let o=e[r];return o!=null?String(o):""}else throw new Error(`Key '${r}' not found in valueMap.`)})}function h(n,e,t){for(let o=0;o<e.length-1;o++){let a=e[o];if(a.endsWith("[]")){let u=a.slice(0,-2);if(!(u in n))if(Array.isArray(t))n[u]=Array.from({length:t.length},()=>({}));else throw new Error(`Value must be a list given an array path ${a}`);if(Array.isArray(n[u])){let c=n[u];if(Array.isArray(t))for(let p=0;p<c.length;p++){let g=c[p];h(g,e.slice(o+1),t[p])}else for(let p of c)h(p,e.slice(o+1),t)}return}else if(a.endsWith("[0]")){let u=a.slice(0,-3);u in n||(n[u]=[{}]);let c=n[u];h(c[0],e.slice(o+1),t);return}(!n[a]||typeof n[a]!="object")&&(n[a]={}),n=n[a]}let i=e[e.length-1],r=n[i];if(r!==void 0){if(!t||typeof t=="object"&&Object.keys(t).length===0||t===r)return;if(typeof r=="object"&&typeof t=="object"&&r!==null&&t!==null)Object.assign(r,t);else throw new Error(`Cannot set value for an existing key. Key: ${i}`)}else i==="_self"&&typeof t=="object"&&t!==null&&!Array.isArray(t)?Object.assign(n,t):n[i]=t}function f(n,e,t=void 0){try{if(e.length===1&&e[0]==="_self")return n;for(let i=0;i<e.length;i++){if(typeof n!="object"||n===null)return t;let r=e[i];if(r.endsWith("[]")){let o=r.slice(0,-2);if(o in n){let a=n[o];return Array.isArray(a)?a.map(u=>f(u,e.slice(i+1),t)):t}else return t}else n=n[r]}return n}catch(i){if(i instanceof TypeError)return t;throw i}}function ZR(n,e){for(let[t,i]of Object.entries(e)){let r=t.split("."),o=i.split("."),a=new Set,u=-1;for(let c=0;c<r.length;c++)if(r[c]==="*"){u=c;break}if(u!==-1&&o.length>u)for(let c=u;c<o.length;c++){let p=o[c];p!=="*"&&!p.endsWith("[]")&&!p.endsWith("[0]")&&a.add(p)}cy(n,r,o,0,a)}}function cy(n,e,t,i,r){if(i>=e.length||typeof n!="object"||n===null)return;let o=e[i];if(o.endsWith("[]")){let a=o.slice(0,-2),u=n;if(a in u&&Array.isArray(u[a]))for(let c of u[a])cy(c,e,t,i+1,r)}else if(o==="*"){if(typeof n=="object"&&n!==null&&!Array.isArray(n)){let a=n,u=Object.keys(a).filter(p=>!p.startsWith("_")&&!r.has(p)),c={};for(let p of u)c[p]=a[p];for(let[p,g]of Object.entries(c)){let y=[];for(let v of t.slice(i))v==="*"?y.push(p):y.push(v);h(a,y,g)}for(let p of u)delete a[p]}}else{let a=n;o in a&&cy(a[o],e,t,i+1,r)}}function u_(n){if(typeof n!="string")throw new Error("fromImageBytes must be a string");return n}function XR(n){let e={},t=f(n,["operationName"]);t!=null&&h(e,["operationName"],t);let i=f(n,["resourceName"]);return i!=null&&h(e,["_url","resourceName"],i),e}function eN(n){let e={},t=f(n,["name"]);t!=null&&h(e,["name"],t);let i=f(n,["metadata"]);i!=null&&h(e,["metadata"],i);let r=f(n,["done"]);r!=null&&h(e,["done"],r);let o=f(n,["error"]);o!=null&&h(e,["error"],o);let a=f(n,["response","generateVideoResponse"]);return a!=null&&h(e,["response"],nN(a)),e}function tN(n){let e={},t=f(n,["name"]);t!=null&&h(e,["name"],t);let i=f(n,["metadata"]);i!=null&&h(e,["metadata"],i);let r=f(n,["done"]);r!=null&&h(e,["done"],r);let o=f(n,["error"]);o!=null&&h(e,["error"],o);let a=f(n,["response"]);return a!=null&&h(e,["response"],iN(a)),e}function nN(n){let e={},t=f(n,["generatedSamples"]);if(t!=null){let o=t;Array.isArray(o)&&(o=o.map(a=>rN(a))),h(e,["generatedVideos"],o)}let i=f(n,["raiMediaFilteredCount"]);i!=null&&h(e,["raiMediaFilteredCount"],i);let r=f(n,["raiMediaFilteredReasons"]);return r!=null&&h(e,["raiMediaFilteredReasons"],r),e}function iN(n){let e={},t=f(n,["videos"]);if(t!=null){let o=t;Array.isArray(o)&&(o=o.map(a=>oN(a))),h(e,["generatedVideos"],o)}let i=f(n,["raiMediaFilteredCount"]);i!=null&&h(e,["raiMediaFilteredCount"],i);let r=f(n,["raiMediaFilteredReasons"]);return r!=null&&h(e,["raiMediaFilteredReasons"],r),e}function rN(n){let e={},t=f(n,["video"]);return t!=null&&h(e,["video"],cN(t)),e}function oN(n){let e={},t=f(n,["_self"]);return t!=null&&h(e,["video"],mN(t)),e}function aN(n){let e={},t=f(n,["operationName"]);return t!=null&&h(e,["_url","operationName"],t),e}function sN(n){let e={},t=f(n,["operationName"]);return t!=null&&h(e,["_url","operationName"],t),e}function lN(n){let e={},t=f(n,["name"]);t!=null&&h(e,["name"],t);let i=f(n,["metadata"]);i!=null&&h(e,["metadata"],i);let r=f(n,["done"]);r!=null&&h(e,["done"],r);let o=f(n,["error"]);o!=null&&h(e,["error"],o);let a=f(n,["response"]);return a!=null&&h(e,["response"],uN(a)),e}function uN(n){let e={},t=f(n,["sdkHttpResponse"]);t!=null&&h(e,["sdkHttpResponse"],t);let i=f(n,["parent"]);i!=null&&h(e,["parent"],i);let r=f(n,["documentName"]);return r!=null&&h(e,["documentName"],r),e}function F2(n){let e={},t=f(n,["name"]);t!=null&&h(e,["name"],t);let i=f(n,["metadata"]);i!=null&&h(e,["metadata"],i);let r=f(n,["done"]);r!=null&&h(e,["done"],r);let o=f(n,["error"]);o!=null&&h(e,["error"],o);let a=f(n,["response"]);return a!=null&&h(e,["response"],dN(a)),e}function dN(n){let e={},t=f(n,["sdkHttpResponse"]);t!=null&&h(e,["sdkHttpResponse"],t);let i=f(n,["parent"]);i!=null&&h(e,["parent"],i);let r=f(n,["documentName"]);return r!=null&&h(e,["documentName"],r),e}function cN(n){let e={},t=f(n,["uri"]);t!=null&&h(e,["uri"],t);let i=f(n,["encodedVideo"]);i!=null&&h(e,["videoBytes"],u_(i));let r=f(n,["encoding"]);return r!=null&&h(e,["mimeType"],r),e}function mN(n){let e={},t=f(n,["gcsUri"]);t!=null&&h(e,["uri"],t);let i=f(n,["bytesBase64Encoded"]);i!=null&&h(e,["videoBytes"],u_(i));let r=f(n,["mimeType"]);return r!=null&&h(e,["mimeType"],r),e}var yt=(function(n){return n.TYPE_UNSPECIFIED="TYPE_UNSPECIFIED",n.STRING="STRING",n.NUMBER="NUMBER",n.INTEGER="INTEGER",n.BOOLEAN="BOOLEAN",n.ARRAY="ARRAY",n.OBJECT="OBJECT",n.NULL="NULL",n})(yt||{});var my=(function(n){return n.MODALITY_UNSPECIFIED="MODALITY_UNSPECIFIED",n.TEXT="TEXT",n.IMAGE="IMAGE",n.AUDIO="AUDIO",n})(my||{});var P2=(function(n){return n.JOB_STATE_UNSPECIFIED="JOB_STATE_UNSPECIFIED",n.JOB_STATE_QUEUED="JOB_STATE_QUEUED",n.JOB_STATE_PENDING="JOB_STATE_PENDING",n.JOB_STATE_RUNNING="JOB_STATE_RUNNING",n.JOB_STATE_SUCCEEDED="JOB_STATE_SUCCEEDED",n.JOB_STATE_FAILED="JOB_STATE_FAILED",n.JOB_STATE_CANCELLING="JOB_STATE_CANCELLING",n.JOB_STATE_CANCELLED="JOB_STATE_CANCELLED",n.JOB_STATE_PAUSED="JOB_STATE_PAUSED",n.JOB_STATE_EXPIRED="JOB_STATE_EXPIRED",n.JOB_STATE_UPDATING="JOB_STATE_UPDATING",n.JOB_STATE_PARTIALLY_SUCCEEDED="JOB_STATE_PARTIALLY_SUCCEEDED",n})(P2||{});var k2=(function(n){return n.COLLECTION="COLLECTION",n})(k2||{});var tu=(function(n){return n.PLAYBACK_CONTROL_UNSPECIFIED="PLAYBACK_CONTROL_UNSPECIFIED",n.PLAY="PLAY",n.PAUSE="PAUSE",n.STOP="STOP",n.RESET_CONTEXT="RESET_CONTEXT",n})(tu||{});var iu=class{constructor(e){let t={};for(let i of e.headers.entries())t[i[0]]=i[1];this.headers=t,this.responseInternal=e}json(){return this.responseInternal.json()}};var xo=class{get text(){var e,t,i,r,o,a,u,c;if(((r=(i=(t=(e=this.candidates)===null||e===void 0?void 0:e[0])===null||t===void 0?void 0:t.content)===null||i===void 0?void 0:i.parts)===null||r===void 0?void 0:r.length)===0)return;this.candidates&&this.candidates.length>1&&console.warn("there are multiple candidates in the response, returning text from the first one.");let p="",g=!1,y=[];for(let v of(c=(u=(a=(o=this.candidates)===null||o===void 0?void 0:o[0])===null||a===void 0?void 0:a.content)===null||u===void 0?void 0:u.parts)!==null&&c!==void 0?c:[]){for(let[C,T]of Object.entries(v))C!=="text"&&C!=="thought"&&C!=="thoughtSignature"&&(T!==null||T!==void 0)&&y.push(C);if(typeof v.text=="string"){if(typeof v.thought=="boolean"&&v.thought)continue;g=!0,p+=v.text}}return y.length>0&&console.warn(`there are non-text parts ${y} in the response, returning concatenation of all text parts. Please refer to the non text parts for a full response from model.`),g?p:void 0}get data(){var e,t,i,r,o,a,u,c;if(((r=(i=(t=(e=this.candidates)===null||e===void 0?void 0:e[0])===null||t===void 0?void 0:t.content)===null||i===void 0?void 0:i.parts)===null||r===void 0?void 0:r.length)===0)return;this.candidates&&this.candidates.length>1&&console.warn("there are multiple candidates in the response, returning data from the first one.");let p="",g=[];for(let y of(c=(u=(a=(o=this.candidates)===null||o===void 0?void 0:o[0])===null||a===void 0?void 0:a.content)===null||u===void 0?void 0:u.parts)!==null&&c!==void 0?c:[]){for(let[v,C]of Object.entries(y))v!=="inlineData"&&(C!==null||C!==void 0)&&g.push(v);y.inlineData&&typeof y.inlineData.data=="string"&&(p+=atob(y.inlineData.data))}return g.length>0&&console.warn(`there are non-data parts ${g} in the response, returning concatenation of all data parts. Please refer to the non data parts for a full response from model.`),p.length>0?btoa(p):void 0}get functionCalls(){var e,t,i,r,o,a,u,c;if(((r=(i=(t=(e=this.candidates)===null||e===void 0?void 0:e[0])===null||t===void 0?void 0:t.content)===null||i===void 0?void 0:i.parts)===null||r===void 0?void 0:r.length)===0)return;this.candidates&&this.candidates.length>1&&console.warn("there are multiple candidates in the response, returning function calls from the first one.");let p=(c=(u=(a=(o=this.candidates)===null||o===void 0?void 0:o[0])===null||a===void 0?void 0:a.content)===null||u===void 0?void 0:u.parts)===null||c===void 0?void 0:c.filter(g=>g.functionCall).map(g=>g.functionCall).filter(g=>g!==void 0);if(p?.length!==0)return p}get executableCode(){var e,t,i,r,o,a,u,c,p;if(((r=(i=(t=(e=this.candidates)===null||e===void 0?void 0:e[0])===null||t===void 0?void 0:t.content)===null||i===void 0?void 0:i.parts)===null||r===void 0?void 0:r.length)===0)return;this.candidates&&this.candidates.length>1&&console.warn("there are multiple candidates in the response, returning executable code from the first one.");let g=(c=(u=(a=(o=this.candidates)===null||o===void 0?void 0:o[0])===null||a===void 0?void 0:a.content)===null||u===void 0?void 0:u.parts)===null||c===void 0?void 0:c.filter(y=>y.executableCode).map(y=>y.executableCode).filter(y=>y!==void 0);if(g?.length!==0)return(p=g?.[0])===null||p===void 0?void 0:p.code}get codeExecutionResult(){var e,t,i,r,o,a,u,c,p;if(((r=(i=(t=(e=this.candidates)===null||e===void 0?void 0:e[0])===null||t===void 0?void 0:t.content)===null||i===void 0?void 0:i.parts)===null||r===void 0?void 0:r.length)===0)return;this.candidates&&this.candidates.length>1&&console.warn("there are multiple candidates in the response, returning code execution result from the first one.");let g=(c=(u=(a=(o=this.candidates)===null||o===void 0?void 0:o[0])===null||a===void 0?void 0:a.content)===null||u===void 0?void 0:u.parts)===null||c===void 0?void 0:c.filter(y=>y.codeExecutionResult).map(y=>y.codeExecutionResult).filter(y=>y!==void 0);if(g?.length!==0)return(p=g?.[0])===null||p===void 0?void 0:p.output}},Nm=class{},Fm=class{},py=class{},fy=class{},gy=class{},hy=class{},Pm=class{},km=class{},Vm=class{},yy=class{};var Lm=class n{_fromAPIResponse({apiResponse:e,_isVertexAI:t}){let i=new n,r,o=e;return t?r=tN(o):r=eN(o),Object.assign(i,r),i}},Om=class{},Bm=class{},Um=class{},$m=class{},_y=class{},vy=class{},Cy=class{};var xy=class n{_fromAPIResponse({apiResponse:e,_isVertexAI:t}){let i=new n,o=lN(e);return Object.assign(i,o),i}},by=class{},Ey=class{},Sy=class{};var Hm=class{};var Dy=class{get text(){var e,t,i;let r="",o=!1,a=[];for(let u of(i=(t=(e=this.serverContent)===null||e===void 0?void 0:e.modelTurn)===null||t===void 0?void 0:t.parts)!==null&&i!==void 0?i:[]){for(let[c,p]of Object.entries(u))c!=="text"&&c!=="thought"&&p!==null&&a.push(c);if(typeof u.text=="string"){if(typeof u.thought=="boolean"&&u.thought)continue;o=!0,r+=u.text}}return a.length>0&&console.warn(`there are non-text parts ${a} in the response, returning concatenation of all text parts. Please refer to the non text parts for a full response from model.`),o?r:void 0}get data(){var e,t,i;let r="",o=[];for(let a of(i=(t=(e=this.serverContent)===null||e===void 0?void 0:e.modelTurn)===null||t===void 0?void 0:t.parts)!==null&&i!==void 0?i:[]){for(let[u,c]of Object.entries(a))u!=="inlineData"&&c!==null&&o.push(u);a.inlineData&&typeof a.inlineData.data=="string"&&(r+=atob(a.inlineData.data))}return o.length>0&&console.warn(`there are non-data parts ${o} in the response, returning concatenation of all data parts. Please refer to the non data parts for a full response from model.`),r.length>0?btoa(r):void 0}};var wy=class{get audioChunk(){if(this.serverContent&&this.serverContent.audioChunks&&this.serverContent.audioChunks.length>0)return this.serverContent.audioChunks[0]}};var Ty=class n{_fromAPIResponse({apiResponse:e,_isVertexAI:t}){let i=new n,o=F2(e);return Object.assign(i,o),i}};function We(n,e){if(!e||typeof e!="string")throw new Error("model is required and must be a string");if(e.includes("..")||e.includes("?")||e.includes("&"))throw new Error("invalid model parameter");if(n.isVertexAI()){if(e.startsWith("publishers/")||e.startsWith("projects/")||e.startsWith("models/"))return e;if(e.indexOf("/")>=0){let t=e.split("/",2);return`publishers/${t[0]}/models/${t[1]}`}else return`publishers/google/models/${e}`}else return e.startsWith("models/")||e.startsWith("tunedModels/")?e:`models/${e}`}function V2(n,e){let t=We(n,e);return t?t.startsWith("publishers/")&&n.isVertexAI()?`projects/${n.getProject()}/locations/${n.getLocation()}/${t}`:t.startsWith("models/")&&n.isVertexAI()?`projects/${n.getProject()}/locations/${n.getLocation()}/publishers/google/${t}`:t:""}function L2(n){return Array.isArray(n)?n.map(e=>Gm(e)):[Gm(n)]}function Gm(n){if(typeof n=="object"&&n!==null)return n;throw new Error(`Could not parse input as Blob. Unsupported blob type: ${typeof n}`)}function O2(n){let e=Gm(n);if(e.mimeType&&e.mimeType.startsWith("image/"))return e;throw new Error(`Unsupported mime type: ${e.mimeType}`)}function B2(n){let e=Gm(n);if(e.mimeType&&e.mimeType.startsWith("audio/"))return e;throw new Error(`Unsupported mime type: ${e.mimeType}`)}function l2(n){if(n==null)throw new Error("PartUnion is required");if(typeof n=="object")return n;if(typeof n=="string")return{text:n};throw new Error(`Unsupported part type: ${typeof n}`)}function U2(n){if(n==null||Array.isArray(n)&&n.length===0)throw new Error("PartListUnion is required");return Array.isArray(n)?n.map(e=>l2(e)):[l2(n)]}function Iy(n){return n!=null&&typeof n=="object"&&"parts"in n&&Array.isArray(n.parts)}function u2(n){return n!=null&&typeof n=="object"&&"functionCall"in n}function d2(n){return n!=null&&typeof n=="object"&&"functionResponse"in n}function nn(n){if(n==null)throw new Error("ContentUnion is required");return Iy(n)?n:{role:"user",parts:U2(n)}}function d_(n,e){if(!e)return[];if(n.isVertexAI()&&Array.isArray(e))return e.flatMap(t=>{let i=nn(t);return i.parts&&i.parts.length>0&&i.parts[0].text!==void 0?[i.parts[0].text]:[]});if(n.isVertexAI()){let t=nn(e);return t.parts&&t.parts.length>0&&t.parts[0].text!==void 0?[t.parts[0].text]:[]}return Array.isArray(e)?e.map(t=>nn(t)):[nn(e)]}function jn(n){if(n==null||Array.isArray(n)&&n.length===0)throw new Error("contents are required");if(!Array.isArray(n)){if(u2(n)||d2(n))throw new Error("To specify functionCall or functionResponse parts, please wrap them in a Content object, specifying the role for them");return[nn(n)]}let e=[],t=[],i=Iy(n[0]);for(let r of n){let o=Iy(r);if(o!=i)throw new Error("Mixing Content and Parts is not supported, please group the parts into a the appropriate Content objects and specify the roles for them");if(o)e.push(r);else{if(u2(r)||d2(r))throw new Error("To specify functionCall or functionResponse parts, please wrap them, and any other parts, in Content objects as appropriate, specifying the role for them");t.push(r)}}return i||e.push({role:"user",parts:U2(t)}),e}function pN(n,e){n.includes("null")&&(e.nullable=!0);let t=n.filter(i=>i!=="null");if(t.length===1)e.type=Object.values(yt).includes(t[0].toUpperCase())?t[0].toUpperCase():yt.TYPE_UNSPECIFIED;else{e.anyOf=[];for(let i of t)e.anyOf.push({type:Object.values(yt).includes(i.toUpperCase())?i.toUpperCase():yt.TYPE_UNSPECIFIED})}}function ka(n){let e={},t=["items"],i=["anyOf"],r=["properties"];if(n.type&&n.anyOf)throw new Error("type and anyOf cannot be both populated.");let o=n.anyOf;o!=null&&o.length==2&&(o[0].type==="null"?(e.nullable=!0,n=o[1]):o[1].type==="null"&&(e.nullable=!0,n=o[0])),n.type instanceof Array&&pN(n.type,e);for(let[a,u]of Object.entries(n))if(u!=null)if(a=="type"){if(u==="null")throw new Error("type: null can not be the only possible type for the field.");if(u instanceof Array)continue;e.type=Object.values(yt).includes(u.toUpperCase())?u.toUpperCase():yt.TYPE_UNSPECIFIED}else if(t.includes(a))e[a]=ka(u);else if(i.includes(a)){let c=[];for(let p of u){if(p.type=="null"){e.nullable=!0;continue}c.push(ka(p))}e[a]=c}else if(r.includes(a)){let c={};for(let[p,g]of Object.entries(u))c[p]=ka(g);e[a]=c}else{if(a==="additionalProperties")continue;e[a]=u}return e}function c_(n){return ka(n)}function m_(n){if(typeof n=="object")return n;if(typeof n=="string")return{voiceConfig:{prebuiltVoiceConfig:{voiceName:n}}};throw new Error(`Unsupported speechConfig type: ${typeof n}`)}function p_(n){if("multiSpeakerVoiceConfig"in n)throw new Error("multiSpeakerVoiceConfig is not supported in the live API.");return n}function Ba(n){if(n.functionDeclarations)for(let e of n.functionDeclarations)e.parameters&&(Object.keys(e.parameters).includes("$schema")?e.parametersJsonSchema||(e.parametersJsonSchema=e.parameters,delete e.parameters):e.parameters=ka(e.parameters)),e.response&&(Object.keys(e.response).includes("$schema")?e.responseJsonSchema||(e.responseJsonSchema=e.response,delete e.response):e.response=ka(e.response));return n}function Ua(n){if(n==null)throw new Error("tools is required");if(!Array.isArray(n))throw new Error("tools is required and must be an array of Tools");let e=[];for(let t of n)e.push(t);return e}function fN(n,e,t,i=1){let r=!e.startsWith(`${t}/`)&&e.split("/").length===i;return n.isVertexAI()?e.startsWith("projects/")?e:e.startsWith("locations/")?`projects/${n.getProject()}/${e}`:e.startsWith(`${t}/`)?`projects/${n.getProject()}/locations/${n.getLocation()}/${e}`:r?`projects/${n.getProject()}/locations/${n.getLocation()}/${t}/${e}`:e:r?`${t}/${e}`:e}function tr(n,e){if(typeof e!="string")throw new Error("name must be a string");return fN(n,e,"cachedContents")}function $2(n){switch(n){case"STATE_UNSPECIFIED":return"JOB_STATE_UNSPECIFIED";case"CREATING":return"JOB_STATE_RUNNING";case"ACTIVE":return"JOB_STATE_SUCCEEDED";case"FAILED":return"JOB_STATE_FAILED";default:return n}}function Ir(n){return u_(n)}function gN(n){return n!=null&&typeof n=="object"&&"name"in n}function hN(n){return n!=null&&typeof n=="object"&&"video"in n}function yN(n){return n!=null&&typeof n=="object"&&"uri"in n}function H2(n){var e;let t;if(gN(n)&&(t=n.name),!(yN(n)&&(t=n.uri,t===void 0))&&!(hN(n)&&(t=(e=n.video)===null||e===void 0?void 0:e.uri,t===void 0))){if(typeof n=="string"&&(t=n),t===void 0)throw new Error("Could not extract file name from the provided input.");if(t.startsWith("https://")){let r=t.split("files/")[1].match(/[a-z0-9]+/);if(r===null)throw new Error(`Could not extract file name from URI ${t}`);t=r[0]}else t.startsWith("files/")&&(t=t.split("files/")[1]);return t}}function G2(n,e){let t;return n.isVertexAI()?t=e?"publishers/google/models":"models":t=e?"models":"tunedModels",t}function q2(n){for(let e of["models","tunedModels","publisherModels"])if(_N(n,e))return n[e];return[]}function _N(n,e){return n!==null&&typeof n=="object"&&e in n}function vN(n,e={}){let t=n,i={name:t.name,description:t.description,parametersJsonSchema:t.inputSchema};return t.outputSchema&&(i.responseJsonSchema=t.outputSchema),e.behavior&&(i.behavior=e.behavior),{functionDeclarations:[i]}}function CN(n,e={}){let t=[],i=new Set;for(let r of n){let o=r.name;if(i.has(o))throw new Error(`Duplicate function name ${o} found in MCP tools. Please ensure function names are unique.`);i.add(o);let a=vN(r,e);a.functionDeclarations&&t.push(...a.functionDeclarations)}return{functionDeclarations:t}}function W2(n,e){let t;if(typeof e=="string")if(n.isVertexAI())if(e.startsWith("gs://"))t={format:"jsonl",gcsUri:[e]};else if(e.startsWith("bq://"))t={format:"bigquery",bigqueryUri:e};else throw new Error(`Unsupported string source for Vertex AI: ${e}`);else if(e.startsWith("files/"))t={fileName:e};else throw new Error(`Unsupported string source for Gemini API: ${e}`);else if(Array.isArray(e)){if(n.isVertexAI())throw new Error("InlinedRequest[] is not supported in Vertex AI.");t={inlinedRequests:e}}else t=e;let i=[t.gcsUri,t.bigqueryUri].filter(Boolean).length,r=[t.inlinedRequests,t.fileName].filter(Boolean).length;if(n.isVertexAI()){if(r>0||i!==1)throw new Error("Exactly one of `gcsUri` or `bigqueryUri` must be set for Vertex AI.")}else if(i>0||r!==1)throw new Error("Exactly one of `inlinedRequests`, `fileName`, must be set for Gemini API.");return t}function xN(n){if(typeof n!="string")return n;let e=n;if(e.startsWith("gs://"))return{format:"jsonl",gcsUri:e};if(e.startsWith("bq://"))return{format:"bigquery",bigqueryUri:e};throw new Error(`Unsupported destination: ${e}`)}function j2(n){if(typeof n!="object"||n===null)return{};let e=n,t=e.inlinedResponses;if(typeof t!="object"||t===null)return n;let r=t.inlinedResponses;if(!Array.isArray(r)||r.length===0)return n;let o=!1;for(let a of r){if(typeof a!="object"||a===null)continue;let c=a.response;if(typeof c!="object"||c===null)continue;if(c.embedding!==void 0){o=!0;break}}return o&&(e.inlinedEmbedContentResponses=e.inlinedResponses,delete e.inlinedResponses),n}function $a(n,e){let t=e;if(!n.isVertexAI()){if(/batches\/[^/]+$/.test(t))return t.split("/").pop();throw new Error(`Invalid batch job name: ${t}.`)}if(/^projects\/[^/]+\/locations\/[^/]+\/batchPredictionJobs\/[^/]+$/.test(t))return t.split("/").pop();if(/^\d+$/.test(t))return t;throw new Error(`Invalid batch job name: ${t}.`)}function z2(n){let e=n;return e==="BATCH_STATE_UNSPECIFIED"?"JOB_STATE_UNSPECIFIED":e==="BATCH_STATE_PENDING"?"JOB_STATE_PENDING":e==="BATCH_STATE_RUNNING"?"JOB_STATE_RUNNING":e==="BATCH_STATE_SUCCEEDED"?"JOB_STATE_SUCCEEDED":e==="BATCH_STATE_FAILED"?"JOB_STATE_FAILED":e==="BATCH_STATE_CANCELLED"?"JOB_STATE_CANCELLED":e==="BATCH_STATE_EXPIRED"?"JOB_STATE_EXPIRED":e}function bN(n){let e={},t=f(n,["responsesFile"]);t!=null&&h(e,["fileName"],t);let i=f(n,["inlinedResponses","inlinedResponses"]);if(i!=null){let o=i;Array.isArray(o)&&(o=o.map(a=>nF(a))),h(e,["inlinedResponses"],o)}let r=f(n,["inlinedEmbedContentResponses","inlinedResponses"]);if(r!=null){let o=r;Array.isArray(o)&&(o=o.map(a=>a)),h(e,["inlinedEmbedContentResponses"],o)}return e}function EN(n){let e={},t=f(n,["predictionsFormat"]);t!=null&&h(e,["format"],t);let i=f(n,["gcsDestination","outputUriPrefix"]);i!=null&&h(e,["gcsUri"],i);let r=f(n,["bigqueryDestination","outputUri"]);return r!=null&&h(e,["bigqueryUri"],r),e}function SN(n){let e={},t=f(n,["format"]);t!=null&&h(e,["predictionsFormat"],t);let i=f(n,["gcsUri"]);i!=null&&h(e,["gcsDestination","outputUriPrefix"],i);let r=f(n,["bigqueryUri"]);if(r!=null&&h(e,["bigqueryDestination","outputUri"],r),f(n,["fileName"])!==void 0)throw new Error("fileName parameter is not supported in Vertex AI.");if(f(n,["inlinedResponses"])!==void 0)throw new Error("inlinedResponses parameter is not supported in Vertex AI.");if(f(n,["inlinedEmbedContentResponses"])!==void 0)throw new Error("inlinedEmbedContentResponses parameter is not supported in Vertex AI.");return e}function Am(n){let e={},t=f(n,["name"]);t!=null&&h(e,["name"],t);let i=f(n,["metadata","displayName"]);i!=null&&h(e,["displayName"],i);let r=f(n,["metadata","state"]);r!=null&&h(e,["state"],z2(r));let o=f(n,["metadata","createTime"]);o!=null&&h(e,["createTime"],o);let a=f(n,["metadata","endTime"]);a!=null&&h(e,["endTime"],a);let u=f(n,["metadata","updateTime"]);u!=null&&h(e,["updateTime"],u);let c=f(n,["metadata","model"]);c!=null&&h(e,["model"],c);let p=f(n,["metadata","output"]);return p!=null&&h(e,["dest"],bN(j2(p))),e}function My(n){let e={},t=f(n,["name"]);t!=null&&h(e,["name"],t);let i=f(n,["displayName"]);i!=null&&h(e,["displayName"],i);let r=f(n,["state"]);r!=null&&h(e,["state"],z2(r));let o=f(n,["error"]);o!=null&&h(e,["error"],o);let a=f(n,["createTime"]);a!=null&&h(e,["createTime"],a);let u=f(n,["startTime"]);u!=null&&h(e,["startTime"],u);let c=f(n,["endTime"]);c!=null&&h(e,["endTime"],c);let p=f(n,["updateTime"]);p!=null&&h(e,["updateTime"],p);let g=f(n,["model"]);g!=null&&h(e,["model"],g);let y=f(n,["inputConfig"]);y!=null&&h(e,["src"],DN(y));let v=f(n,["outputConfig"]);v!=null&&h(e,["dest"],EN(j2(v)));let C=f(n,["completionStats"]);return C!=null&&h(e,["completionStats"],C),e}function DN(n){let e={},t=f(n,["instancesFormat"]);t!=null&&h(e,["format"],t);let i=f(n,["gcsSource","uris"]);i!=null&&h(e,["gcsUri"],i);let r=f(n,["bigquerySource","inputUri"]);return r!=null&&h(e,["bigqueryUri"],r),e}function wN(n,e){let t={};if(f(e,["format"])!==void 0)throw new Error("format parameter is not supported in Gemini API.");if(f(e,["gcsUri"])!==void 0)throw new Error("gcsUri parameter is not supported in Gemini API.");if(f(e,["bigqueryUri"])!==void 0)throw new Error("bigqueryUri parameter is not supported in Gemini API.");let i=f(e,["fileName"]);i!=null&&h(t,["fileName"],i);let r=f(e,["inlinedRequests"]);if(r!=null){let o=r;Array.isArray(o)&&(o=o.map(a=>tF(n,a))),h(t,["requests","requests"],o)}return t}function TN(n){let e={},t=f(n,["format"]);t!=null&&h(e,["instancesFormat"],t);let i=f(n,["gcsUri"]);i!=null&&h(e,["gcsSource","uris"],i);let r=f(n,["bigqueryUri"]);if(r!=null&&h(e,["bigquerySource","inputUri"],r),f(n,["fileName"])!==void 0)throw new Error("fileName parameter is not supported in Vertex AI.");if(f(n,["inlinedRequests"])!==void 0)throw new Error("inlinedRequests parameter is not supported in Vertex AI.");return e}function IN(n){let e={},t=f(n,["data"]);if(t!=null&&h(e,["data"],t),f(n,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");let i=f(n,["mimeType"]);return i!=null&&h(e,["mimeType"],i),e}function MN(n,e){let t={},i=f(e,["name"]);return i!=null&&h(t,["_url","name"],$a(n,i)),t}function AN(n,e){let t={},i=f(e,["name"]);return i!=null&&h(t,["_url","name"],$a(n,i)),t}function RN(n){let e={},t=f(n,["content"]);t!=null&&h(e,["content"],t);let i=f(n,["citationMetadata"]);i!=null&&h(e,["citationMetadata"],NN(i));let r=f(n,["tokenCount"]);r!=null&&h(e,["tokenCount"],r);let o=f(n,["finishReason"]);o!=null&&h(e,["finishReason"],o);let a=f(n,["avgLogprobs"]);a!=null&&h(e,["avgLogprobs"],a);let u=f(n,["groundingMetadata"]);u!=null&&h(e,["groundingMetadata"],u);let c=f(n,["index"]);c!=null&&h(e,["index"],c);let p=f(n,["logprobsResult"]);p!=null&&h(e,["logprobsResult"],p);let g=f(n,["safetyRatings"]);if(g!=null){let v=g;Array.isArray(v)&&(v=v.map(C=>C)),h(e,["safetyRatings"],v)}let y=f(n,["urlContextMetadata"]);return y!=null&&h(e,["urlContextMetadata"],y),e}function NN(n){let e={},t=f(n,["citationSources"]);if(t!=null){let i=t;Array.isArray(i)&&(i=i.map(r=>r)),h(e,["citations"],i)}return e}function Y2(n){let e={},t=f(n,["parts"]);if(t!=null){let r=t;Array.isArray(r)&&(r=r.map(o=>uF(o))),h(e,["parts"],r)}let i=f(n,["role"]);return i!=null&&h(e,["role"],i),e}function FN(n,e){let t={},i=f(n,["displayName"]);if(e!==void 0&&i!=null&&h(e,["batch","displayName"],i),f(n,["dest"])!==void 0)throw new Error("dest parameter is not supported in Gemini API.");return t}function PN(n,e){let t={},i=f(n,["displayName"]);e!==void 0&&i!=null&&h(e,["displayName"],i);let r=f(n,["dest"]);return e!==void 0&&r!=null&&h(e,["outputConfig"],SN(xN(r))),t}function c2(n,e){let t={},i=f(e,["model"]);i!=null&&h(t,["_url","model"],We(n,i));let r=f(e,["src"]);r!=null&&h(t,["batch","inputConfig"],wN(n,W2(n,r)));let o=f(e,["config"]);return o!=null&&FN(o,t),t}function kN(n,e){let t={},i=f(e,["model"]);i!=null&&h(t,["model"],We(n,i));let r=f(e,["src"]);r!=null&&h(t,["inputConfig"],TN(W2(n,r)));let o=f(e,["config"]);return o!=null&&PN(o,t),t}function VN(n,e){let t={},i=f(n,["displayName"]);return e!==void 0&&i!=null&&h(e,["batch","displayName"],i),t}function LN(n,e){let t={},i=f(e,["model"]);i!=null&&h(t,["_url","model"],We(n,i));let r=f(e,["src"]);r!=null&&h(t,["batch","inputConfig"],qN(n,r));let o=f(e,["config"]);return o!=null&&VN(o,t),t}function ON(n,e){let t={},i=f(e,["name"]);return i!=null&&h(t,["_url","name"],$a(n,i)),t}function BN(n,e){let t={},i=f(e,["name"]);return i!=null&&h(t,["_url","name"],$a(n,i)),t}function UN(n){let e={},t=f(n,["sdkHttpResponse"]);t!=null&&h(e,["sdkHttpResponse"],t);let i=f(n,["name"]);i!=null&&h(e,["name"],i);let r=f(n,["done"]);r!=null&&h(e,["done"],r);let o=f(n,["error"]);return o!=null&&h(e,["error"],o),e}function $N(n){let e={},t=f(n,["sdkHttpResponse"]);t!=null&&h(e,["sdkHttpResponse"],t);let i=f(n,["name"]);i!=null&&h(e,["name"],i);let r=f(n,["done"]);r!=null&&h(e,["done"],r);let o=f(n,["error"]);return o!=null&&h(e,["error"],o),e}function HN(n,e){let t={},i=f(e,["contents"]);if(i!=null){let o=d_(n,i);Array.isArray(o)&&(o=o.map(a=>a)),h(t,["requests[]","request","content"],o)}let r=f(e,["config"]);return r!=null&&(h(t,["_self"],GN(r,t)),ZR(t,{"requests[].*":"requests[].request.*"})),t}function GN(n,e){let t={},i=f(n,["taskType"]);e!==void 0&&i!=null&&h(e,["requests[]","taskType"],i);let r=f(n,["title"]);e!==void 0&&r!=null&&h(e,["requests[]","title"],r);let o=f(n,["outputDimensionality"]);if(e!==void 0&&o!=null&&h(e,["requests[]","outputDimensionality"],o),f(n,["mimeType"])!==void 0)throw new Error("mimeType parameter is not supported in Gemini API.");if(f(n,["autoTruncate"])!==void 0)throw new Error("autoTruncate parameter is not supported in Gemini API.");return t}function qN(n,e){let t={},i=f(e,["fileName"]);i!=null&&h(t,["file_name"],i);let r=f(e,["inlinedRequests"]);return r!=null&&h(t,["requests"],HN(n,r)),t}function WN(n){let e={};if(f(n,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");let t=f(n,["fileUri"]);t!=null&&h(e,["fileUri"],t);let i=f(n,["mimeType"]);return i!=null&&h(e,["mimeType"],i),e}function jN(n){let e={},t=f(n,["id"]);t!=null&&h(e,["id"],t);let i=f(n,["args"]);i!=null&&h(e,["args"],i);let r=f(n,["name"]);if(r!=null&&h(e,["name"],r),f(n,["partialArgs"])!==void 0)throw new Error("partialArgs parameter is not supported in Gemini API.");if(f(n,["willContinue"])!==void 0)throw new Error("willContinue parameter is not supported in Gemini API.");return e}function zN(n){let e={},t=f(n,["allowedFunctionNames"]);t!=null&&h(e,["allowedFunctionNames"],t);let i=f(n,["mode"]);if(i!=null&&h(e,["mode"],i),f(n,["streamFunctionCallArguments"])!==void 0)throw new Error("streamFunctionCallArguments parameter is not supported in Gemini API.");return e}function YN(n,e,t){let i={},r=f(e,["systemInstruction"]);t!==void 0&&r!=null&&h(t,["systemInstruction"],Y2(nn(r)));let o=f(e,["temperature"]);o!=null&&h(i,["temperature"],o);let a=f(e,["topP"]);a!=null&&h(i,["topP"],a);let u=f(e,["topK"]);u!=null&&h(i,["topK"],u);let c=f(e,["candidateCount"]);c!=null&&h(i,["candidateCount"],c);let p=f(e,["maxOutputTokens"]);p!=null&&h(i,["maxOutputTokens"],p);let g=f(e,["stopSequences"]);g!=null&&h(i,["stopSequences"],g);let y=f(e,["responseLogprobs"]);y!=null&&h(i,["responseLogprobs"],y);let v=f(e,["logprobs"]);v!=null&&h(i,["logprobs"],v);let C=f(e,["presencePenalty"]);C!=null&&h(i,["presencePenalty"],C);let T=f(e,["frequencyPenalty"]);T!=null&&h(i,["frequencyPenalty"],T);let R=f(e,["seed"]);R!=null&&h(i,["seed"],R);let F=f(e,["responseMimeType"]);F!=null&&h(i,["responseMimeType"],F);let P=f(e,["responseSchema"]);P!=null&&h(i,["responseSchema"],c_(P));let H=f(e,["responseJsonSchema"]);if(H!=null&&h(i,["responseJsonSchema"],H),f(e,["routingConfig"])!==void 0)throw new Error("routingConfig parameter is not supported in Gemini API.");if(f(e,["modelSelectionConfig"])!==void 0)throw new Error("modelSelectionConfig parameter is not supported in Gemini API.");let q=f(e,["safetySettings"]);if(t!==void 0&&q!=null){let _t=q;Array.isArray(_t)&&(_t=_t.map(_i=>dF(_i))),h(t,["safetySettings"],_t)}let Z=f(e,["tools"]);if(t!==void 0&&Z!=null){let _t=Ua(Z);Array.isArray(_t)&&(_t=_t.map(_i=>mF(Ba(_i)))),h(t,["tools"],_t)}let ie=f(e,["toolConfig"]);if(t!==void 0&&ie!=null&&h(t,["toolConfig"],cF(ie)),f(e,["labels"])!==void 0)throw new Error("labels parameter is not supported in Gemini API.");let me=f(e,["cachedContent"]);t!==void 0&&me!=null&&h(t,["cachedContent"],tr(n,me));let de=f(e,["responseModalities"]);de!=null&&h(i,["responseModalities"],de);let $e=f(e,["mediaResolution"]);$e!=null&&h(i,["mediaResolution"],$e);let ge=f(e,["speechConfig"]);if(ge!=null&&h(i,["speechConfig"],m_(ge)),f(e,["audioTimestamp"])!==void 0)throw new Error("audioTimestamp parameter is not supported in Gemini API.");let Me=f(e,["thinkingConfig"]);Me!=null&&h(i,["thinkingConfig"],Me);let wt=f(e,["imageConfig"]);wt!=null&&h(i,["imageConfig"],eF(wt));let yi=f(e,["enableEnhancedCivicAnswers"]);if(yi!=null&&h(i,["enableEnhancedCivicAnswers"],yi),f(e,["modelArmorConfig"])!==void 0)throw new Error("modelArmorConfig parameter is not supported in Gemini API.");return i}function JN(n){let e={},t=f(n,["sdkHttpResponse"]);t!=null&&h(e,["sdkHttpResponse"],t);let i=f(n,["candidates"]);if(i!=null){let c=i;Array.isArray(c)&&(c=c.map(p=>RN(p))),h(e,["candidates"],c)}let r=f(n,["modelVersion"]);r!=null&&h(e,["modelVersion"],r);let o=f(n,["promptFeedback"]);o!=null&&h(e,["promptFeedback"],o);let a=f(n,["responseId"]);a!=null&&h(e,["responseId"],a);let u=f(n,["usageMetadata"]);return u!=null&&h(e,["usageMetadata"],u),e}function KN(n,e){let t={},i=f(e,["name"]);return i!=null&&h(t,["_url","name"],$a(n,i)),t}function QN(n,e){let t={},i=f(e,["name"]);return i!=null&&h(t,["_url","name"],$a(n,i)),t}function ZN(n){let e={};if(f(n,["authConfig"])!==void 0)throw new Error("authConfig parameter is not supported in Gemini API.");let t=f(n,["enableWidget"]);return t!=null&&h(e,["enableWidget"],t),e}function XN(n){let e={};if(f(n,["excludeDomains"])!==void 0)throw new Error("excludeDomains parameter is not supported in Gemini API.");if(f(n,["blockingConfidence"])!==void 0)throw new Error("blockingConfidence parameter is not supported in Gemini API.");let t=f(n,["timeRangeFilter"]);return t!=null&&h(e,["timeRangeFilter"],t),e}function eF(n){let e={},t=f(n,["aspectRatio"]);t!=null&&h(e,["aspectRatio"],t);let i=f(n,["imageSize"]);if(i!=null&&h(e,["imageSize"],i),f(n,["personGeneration"])!==void 0)throw new Error("personGeneration parameter is not supported in Gemini API.");if(f(n,["outputMimeType"])!==void 0)throw new Error("outputMimeType parameter is not supported in Gemini API.");if(f(n,["outputCompressionQuality"])!==void 0)throw new Error("outputCompressionQuality parameter is not supported in Gemini API.");return e}function tF(n,e){let t={},i=f(e,["model"]);i!=null&&h(t,["request","model"],We(n,i));let r=f(e,["contents"]);if(r!=null){let u=jn(r);Array.isArray(u)&&(u=u.map(c=>Y2(c))),h(t,["request","contents"],u)}let o=f(e,["metadata"]);o!=null&&h(t,["metadata"],o);let a=f(e,["config"]);return a!=null&&h(t,["request","generationConfig"],YN(n,a,f(t,["request"],{}))),t}function nF(n){let e={},t=f(n,["response"]);t!=null&&h(e,["response"],JN(t));let i=f(n,["error"]);return i!=null&&h(e,["error"],i),e}function iF(n,e){let t={},i=f(n,["pageSize"]);e!==void 0&&i!=null&&h(e,["_query","pageSize"],i);let r=f(n,["pageToken"]);if(e!==void 0&&r!=null&&h(e,["_query","pageToken"],r),f(n,["filter"])!==void 0)throw new Error("filter parameter is not supported in Gemini API.");return t}function rF(n,e){let t={},i=f(n,["pageSize"]);e!==void 0&&i!=null&&h(e,["_query","pageSize"],i);let r=f(n,["pageToken"]);e!==void 0&&r!=null&&h(e,["_query","pageToken"],r);let o=f(n,["filter"]);return e!==void 0&&o!=null&&h(e,["_query","filter"],o),t}function oF(n){let e={},t=f(n,["config"]);return t!=null&&iF(t,e),e}function aF(n){let e={},t=f(n,["config"]);return t!=null&&rF(t,e),e}function sF(n){let e={},t=f(n,["sdkHttpResponse"]);t!=null&&h(e,["sdkHttpResponse"],t);let i=f(n,["nextPageToken"]);i!=null&&h(e,["nextPageToken"],i);let r=f(n,["operations"]);if(r!=null){let o=r;Array.isArray(o)&&(o=o.map(a=>Am(a))),h(e,["batchJobs"],o)}return e}function lF(n){let e={},t=f(n,["sdkHttpResponse"]);t!=null&&h(e,["sdkHttpResponse"],t);let i=f(n,["nextPageToken"]);i!=null&&h(e,["nextPageToken"],i);let r=f(n,["batchPredictionJobs"]);if(r!=null){let o=r;Array.isArray(o)&&(o=o.map(a=>My(a))),h(e,["batchJobs"],o)}return e}function uF(n){let e={},t=f(n,["mediaResolution"]);t!=null&&h(e,["mediaResolution"],t);let i=f(n,["codeExecutionResult"]);i!=null&&h(e,["codeExecutionResult"],i);let r=f(n,["executableCode"]);r!=null&&h(e,["executableCode"],r);let o=f(n,["fileData"]);o!=null&&h(e,["fileData"],WN(o));let a=f(n,["functionCall"]);a!=null&&h(e,["functionCall"],jN(a));let u=f(n,["functionResponse"]);u!=null&&h(e,["functionResponse"],u);let c=f(n,["inlineData"]);c!=null&&h(e,["inlineData"],IN(c));let p=f(n,["text"]);p!=null&&h(e,["text"],p);let g=f(n,["thought"]);g!=null&&h(e,["thought"],g);let y=f(n,["thoughtSignature"]);y!=null&&h(e,["thoughtSignature"],y);let v=f(n,["videoMetadata"]);return v!=null&&h(e,["videoMetadata"],v),e}function dF(n){let e={},t=f(n,["category"]);if(t!=null&&h(e,["category"],t),f(n,["method"])!==void 0)throw new Error("method parameter is not supported in Gemini API.");let i=f(n,["threshold"]);return i!=null&&h(e,["threshold"],i),e}function cF(n){let e={},t=f(n,["retrievalConfig"]);t!=null&&h(e,["retrievalConfig"],t);let i=f(n,["functionCallingConfig"]);return i!=null&&h(e,["functionCallingConfig"],zN(i)),e}function mF(n){let e={};if(f(n,["retrieval"])!==void 0)throw new Error("retrieval parameter is not supported in Gemini API.");let t=f(n,["computerUse"]);t!=null&&h(e,["computerUse"],t);let i=f(n,["fileSearch"]);i!=null&&h(e,["fileSearch"],i);let r=f(n,["codeExecution"]);if(r!=null&&h(e,["codeExecution"],r),f(n,["enterpriseWebSearch"])!==void 0)throw new Error("enterpriseWebSearch parameter is not supported in Gemini API.");let o=f(n,["functionDeclarations"]);if(o!=null){let g=o;Array.isArray(g)&&(g=g.map(y=>y)),h(e,["functionDeclarations"],g)}let a=f(n,["googleMaps"]);a!=null&&h(e,["googleMaps"],ZN(a));let u=f(n,["googleSearch"]);u!=null&&h(e,["googleSearch"],XN(u));let c=f(n,["googleSearchRetrieval"]);c!=null&&h(e,["googleSearchRetrieval"],c);let p=f(n,["urlContext"]);return p!=null&&h(e,["urlContext"],p),e}var Mr=(function(n){return n.PAGED_ITEM_BATCH_JOBS="batchJobs",n.PAGED_ITEM_MODELS="models",n.PAGED_ITEM_TUNING_JOBS="tuningJobs",n.PAGED_ITEM_FILES="files",n.PAGED_ITEM_CACHED_CONTENTS="cachedContents",n.PAGED_ITEM_FILE_SEARCH_STORES="fileSearchStores",n.PAGED_ITEM_DOCUMENTS="documents",n})(Mr||{}),er=class{constructor(e,t,i,r){this.pageInternal=[],this.paramsInternal={},this.requestInternal=t,this.init(e,i,r)}init(e,t,i){var r,o;this.nameInternal=e,this.pageInternal=t[this.nameInternal]||[],this.sdkHttpResponseInternal=t?.sdkHttpResponse,this.idxInternal=0;let a={config:{}};!i||Object.keys(i).length===0?a={config:{}}:typeof i=="object"?a=Object.assign({},i):a=i,a.config&&(a.config.pageToken=t.nextPageToken),this.paramsInternal=a,this.pageInternalSize=(o=(r=a.config)===null||r===void 0?void 0:r.pageSize)!==null&&o!==void 0?o:this.pageInternal.length}initNextPage(e){this.init(this.nameInternal,e,this.paramsInternal)}get page(){return this.pageInternal}get name(){return this.nameInternal}get pageSize(){return this.pageInternalSize}get sdkHttpResponse(){return this.sdkHttpResponseInternal}get params(){return this.paramsInternal}get pageLength(){return this.pageInternal.length}getItem(e){return this.pageInternal[e]}[Symbol.asyncIterator](){return{next:async()=>{if(this.idxInternal>=this.pageLength)if(this.hasNextPage())await this.nextPage();else return{value:void 0,done:!0};let e=this.getItem(this.idxInternal);return this.idxInternal+=1,{value:e,done:!1}},return:async()=>({value:void 0,done:!0})}}async nextPage(){if(!this.hasNextPage())throw new Error("No more pages to fetch.");let e=await this.requestInternal(this.params);return this.initNextPage(e),this.page}hasNextPage(){var e;return((e=this.params.config)===null||e===void 0?void 0:e.pageToken)!==void 0}};var Ay=class extends gi{constructor(e){super(),this.apiClient=e,this.list=async(t={})=>new er(Mr.PAGED_ITEM_BATCH_JOBS,i=>this.listInternal(i),await this.listInternal(t),t),this.create=async t=>(this.apiClient.isVertexAI()&&(t.config=this.formatDestination(t.src,t.config)),this.createInternal(t)),this.createEmbeddings=async t=>{if(console.warn("batches.createEmbeddings() is experimental and may change without notice."),this.apiClient.isVertexAI())throw new Error("Vertex AI does not support batches.createEmbeddings.");return this.createEmbeddingsInternal(t)}}createInlinedGenerateContentRequest(e){let t=c2(this.apiClient,e),i=t._url,r=te("{model}:batchGenerateContent",i),u=t.batch.inputConfig.requests,c=u.requests,p=[];for(let g of c){let y=Object.assign({},g);if(y.systemInstruction){let v=y.systemInstruction;delete y.systemInstruction;let C=y.request;C.systemInstruction=v,y.request=C}p.push(y)}return u.requests=p,delete t.config,delete t._url,delete t._query,{path:r,body:t}}getGcsUri(e){if(typeof e=="string")return e.startsWith("gs://")?e:void 0;if(!Array.isArray(e)&&e.gcsUri&&e.gcsUri.length>0)return e.gcsUri[0]}getBigqueryUri(e){if(typeof e=="string")return e.startsWith("bq://")?e:void 0;if(!Array.isArray(e))return e.bigqueryUri}formatDestination(e,t){let i=t?Object.assign({},t):{},r=Date.now().toString();if(i.displayName||(i.displayName=`genaiBatchJob_${r}`),i.dest===void 0){let o=this.getGcsUri(e),a=this.getBigqueryUri(e);if(o)o.endsWith(".jsonl")?i.dest=`${o.slice(0,-6)}/dest`:i.dest=`${o}_dest_${r}`;else if(a)i.dest=`${a}_dest_${r}`;else throw new Error("Unsupported source for Vertex AI: No GCS or BigQuery URI found.")}return i}async createInternal(e){var t,i,r,o;let a,u="",c={};if(this.apiClient.isVertexAI()){let p=kN(this.apiClient,e);return u=te("batchPredictionJobs",p._url),c=p._query,delete p._url,delete p._query,a=this.apiClient.request({path:u,queryParams:c,body:JSON.stringify(p),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(g=>g.json()),a.then(g=>My(g))}else{let p=c2(this.apiClient,e);return u=te("{model}:batchGenerateContent",p._url),c=p._query,delete p._url,delete p._query,a=this.apiClient.request({path:u,queryParams:c,body:JSON.stringify(p),httpMethod:"POST",httpOptions:(r=e.config)===null||r===void 0?void 0:r.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(g=>g.json()),a.then(g=>Am(g))}}async createEmbeddingsInternal(e){var t,i;let r,o="",a={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{let u=LN(this.apiClient,e);return o=te("{model}:asyncBatchEmbedContent",u._url),a=u._query,delete u._url,delete u._query,r=this.apiClient.request({path:o,queryParams:a,body:JSON.stringify(u),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(c=>c.json()),r.then(c=>Am(c))}}async get(e){var t,i,r,o;let a,u="",c={};if(this.apiClient.isVertexAI()){let p=QN(this.apiClient,e);return u=te("batchPredictionJobs/{name}",p._url),c=p._query,delete p._url,delete p._query,a=this.apiClient.request({path:u,queryParams:c,body:JSON.stringify(p),httpMethod:"GET",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(g=>g.json()),a.then(g=>My(g))}else{let p=KN(this.apiClient,e);return u=te("batches/{name}",p._url),c=p._query,delete p._url,delete p._query,a=this.apiClient.request({path:u,queryParams:c,body:JSON.stringify(p),httpMethod:"GET",httpOptions:(r=e.config)===null||r===void 0?void 0:r.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(g=>g.json()),a.then(g=>Am(g))}}async cancel(e){var t,i,r,o;let a="",u={};if(this.apiClient.isVertexAI()){let c=AN(this.apiClient,e);a=te("batchPredictionJobs/{name}:cancel",c._url),u=c._query,delete c._url,delete c._query,await this.apiClient.request({path:a,queryParams:u,body:JSON.stringify(c),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal})}else{let c=MN(this.apiClient,e);a=te("batches/{name}:cancel",c._url),u=c._query,delete c._url,delete c._query,await this.apiClient.request({path:a,queryParams:u,body:JSON.stringify(c),httpMethod:"POST",httpOptions:(r=e.config)===null||r===void 0?void 0:r.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal})}}async listInternal(e){var t,i,r,o;let a,u="",c={};if(this.apiClient.isVertexAI()){let p=aF(e);return u=te("batchPredictionJobs",p._url),c=p._query,delete p._url,delete p._query,a=this.apiClient.request({path:u,queryParams:c,body:JSON.stringify(p),httpMethod:"GET",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(g=>g.json().then(y=>{let v=y;return v.sdkHttpResponse={headers:g.headers},v})),a.then(g=>{let y=lF(g),v=new Hm;return Object.assign(v,y),v})}else{let p=oF(e);return u=te("batches",p._url),c=p._query,delete p._url,delete p._query,a=this.apiClient.request({path:u,queryParams:c,body:JSON.stringify(p),httpMethod:"GET",httpOptions:(r=e.config)===null||r===void 0?void 0:r.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(g=>g.json().then(y=>{let v=y;return v.sdkHttpResponse={headers:g.headers},v})),a.then(g=>{let y=sF(g),v=new Hm;return Object.assign(v,y),v})}}async delete(e){var t,i,r,o;let a,u="",c={};if(this.apiClient.isVertexAI()){let p=BN(this.apiClient,e);return u=te("batchPredictionJobs/{name}",p._url),c=p._query,delete p._url,delete p._query,a=this.apiClient.request({path:u,queryParams:c,body:JSON.stringify(p),httpMethod:"DELETE",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(g=>g.json().then(y=>{let v=y;return v.sdkHttpResponse={headers:g.headers},v})),a.then(g=>$N(g))}else{let p=ON(this.apiClient,e);return u=te("batches/{name}",p._url),c=p._query,delete p._url,delete p._query,a=this.apiClient.request({path:u,queryParams:c,body:JSON.stringify(p),httpMethod:"DELETE",httpOptions:(r=e.config)===null||r===void 0?void 0:r.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(g=>g.json().then(y=>{let v=y;return v.sdkHttpResponse={headers:g.headers},v})),a.then(g=>UN(g))}}};function pF(n){let e={},t=f(n,["data"]);if(t!=null&&h(e,["data"],t),f(n,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");let i=f(n,["mimeType"]);return i!=null&&h(e,["mimeType"],i),e}function m2(n){let e={},t=f(n,["parts"]);if(t!=null){let r=t;Array.isArray(r)&&(r=r.map(o=>VF(o))),h(e,["parts"],r)}let i=f(n,["role"]);return i!=null&&h(e,["role"],i),e}function fF(n,e){let t={},i=f(n,["ttl"]);e!==void 0&&i!=null&&h(e,["ttl"],i);let r=f(n,["expireTime"]);e!==void 0&&r!=null&&h(e,["expireTime"],r);let o=f(n,["displayName"]);e!==void 0&&o!=null&&h(e,["displayName"],o);let a=f(n,["contents"]);if(e!==void 0&&a!=null){let g=jn(a);Array.isArray(g)&&(g=g.map(y=>m2(y))),h(e,["contents"],g)}let u=f(n,["systemInstruction"]);e!==void 0&&u!=null&&h(e,["systemInstruction"],m2(nn(u)));let c=f(n,["tools"]);if(e!==void 0&&c!=null){let g=c;Array.isArray(g)&&(g=g.map(y=>OF(y))),h(e,["tools"],g)}let p=f(n,["toolConfig"]);if(e!==void 0&&p!=null&&h(e,["toolConfig"],LF(p)),f(n,["kmsKeyName"])!==void 0)throw new Error("kmsKeyName parameter is not supported in Gemini API.");return t}function gF(n,e){let t={},i=f(n,["ttl"]);e!==void 0&&i!=null&&h(e,["ttl"],i);let r=f(n,["expireTime"]);e!==void 0&&r!=null&&h(e,["expireTime"],r);let o=f(n,["displayName"]);e!==void 0&&o!=null&&h(e,["displayName"],o);let a=f(n,["contents"]);if(e!==void 0&&a!=null){let y=jn(a);Array.isArray(y)&&(y=y.map(v=>v)),h(e,["contents"],y)}let u=f(n,["systemInstruction"]);e!==void 0&&u!=null&&h(e,["systemInstruction"],nn(u));let c=f(n,["tools"]);if(e!==void 0&&c!=null){let y=c;Array.isArray(y)&&(y=y.map(v=>BF(v))),h(e,["tools"],y)}let p=f(n,["toolConfig"]);e!==void 0&&p!=null&&h(e,["toolConfig"],p);let g=f(n,["kmsKeyName"]);return e!==void 0&&g!=null&&h(e,["encryption_spec","kmsKeyName"],g),t}function hF(n,e){let t={},i=f(e,["model"]);i!=null&&h(t,["model"],V2(n,i));let r=f(e,["config"]);return r!=null&&fF(r,t),t}function yF(n,e){let t={},i=f(e,["model"]);i!=null&&h(t,["model"],V2(n,i));let r=f(e,["config"]);return r!=null&&gF(r,t),t}function _F(n,e){let t={},i=f(e,["name"]);return i!=null&&h(t,["_url","name"],tr(n,i)),t}function vF(n,e){let t={},i=f(e,["name"]);return i!=null&&h(t,["_url","name"],tr(n,i)),t}function CF(n){let e={},t=f(n,["sdkHttpResponse"]);return t!=null&&h(e,["sdkHttpResponse"],t),e}function xF(n){let e={},t=f(n,["sdkHttpResponse"]);return t!=null&&h(e,["sdkHttpResponse"],t),e}function bF(n){let e={};if(f(n,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");let t=f(n,["fileUri"]);t!=null&&h(e,["fileUri"],t);let i=f(n,["mimeType"]);return i!=null&&h(e,["mimeType"],i),e}function EF(n){let e={},t=f(n,["id"]);t!=null&&h(e,["id"],t);let i=f(n,["args"]);i!=null&&h(e,["args"],i);let r=f(n,["name"]);if(r!=null&&h(e,["name"],r),f(n,["partialArgs"])!==void 0)throw new Error("partialArgs parameter is not supported in Gemini API.");if(f(n,["willContinue"])!==void 0)throw new Error("willContinue parameter is not supported in Gemini API.");return e}function SF(n){let e={},t=f(n,["allowedFunctionNames"]);t!=null&&h(e,["allowedFunctionNames"],t);let i=f(n,["mode"]);if(i!=null&&h(e,["mode"],i),f(n,["streamFunctionCallArguments"])!==void 0)throw new Error("streamFunctionCallArguments parameter is not supported in Gemini API.");return e}function DF(n){let e={},t=f(n,["description"]);t!=null&&h(e,["description"],t);let i=f(n,["name"]);i!=null&&h(e,["name"],i);let r=f(n,["parameters"]);r!=null&&h(e,["parameters"],r);let o=f(n,["parametersJsonSchema"]);o!=null&&h(e,["parametersJsonSchema"],o);let a=f(n,["response"]);a!=null&&h(e,["response"],a);let u=f(n,["responseJsonSchema"]);if(u!=null&&h(e,["responseJsonSchema"],u),f(n,["behavior"])!==void 0)throw new Error("behavior parameter is not supported in Vertex AI.");return e}function wF(n,e){let t={},i=f(e,["name"]);return i!=null&&h(t,["_url","name"],tr(n,i)),t}function TF(n,e){let t={},i=f(e,["name"]);return i!=null&&h(t,["_url","name"],tr(n,i)),t}function IF(n){let e={};if(f(n,["authConfig"])!==void 0)throw new Error("authConfig parameter is not supported in Gemini API.");let t=f(n,["enableWidget"]);return t!=null&&h(e,["enableWidget"],t),e}function MF(n){let e={};if(f(n,["excludeDomains"])!==void 0)throw new Error("excludeDomains parameter is not supported in Gemini API.");if(f(n,["blockingConfidence"])!==void 0)throw new Error("blockingConfidence parameter is not supported in Gemini API.");let t=f(n,["timeRangeFilter"]);return t!=null&&h(e,["timeRangeFilter"],t),e}function AF(n,e){let t={},i=f(n,["pageSize"]);e!==void 0&&i!=null&&h(e,["_query","pageSize"],i);let r=f(n,["pageToken"]);return e!==void 0&&r!=null&&h(e,["_query","pageToken"],r),t}function RF(n,e){let t={},i=f(n,["pageSize"]);e!==void 0&&i!=null&&h(e,["_query","pageSize"],i);let r=f(n,["pageToken"]);return e!==void 0&&r!=null&&h(e,["_query","pageToken"],r),t}function NF(n){let e={},t=f(n,["config"]);return t!=null&&AF(t,e),e}function FF(n){let e={},t=f(n,["config"]);return t!=null&&RF(t,e),e}function PF(n){let e={},t=f(n,["sdkHttpResponse"]);t!=null&&h(e,["sdkHttpResponse"],t);let i=f(n,["nextPageToken"]);i!=null&&h(e,["nextPageToken"],i);let r=f(n,["cachedContents"]);if(r!=null){let o=r;Array.isArray(o)&&(o=o.map(a=>a)),h(e,["cachedContents"],o)}return e}function kF(n){let e={},t=f(n,["sdkHttpResponse"]);t!=null&&h(e,["sdkHttpResponse"],t);let i=f(n,["nextPageToken"]);i!=null&&h(e,["nextPageToken"],i);let r=f(n,["cachedContents"]);if(r!=null){let o=r;Array.isArray(o)&&(o=o.map(a=>a)),h(e,["cachedContents"],o)}return e}function VF(n){let e={},t=f(n,["mediaResolution"]);t!=null&&h(e,["mediaResolution"],t);let i=f(n,["codeExecutionResult"]);i!=null&&h(e,["codeExecutionResult"],i);let r=f(n,["executableCode"]);r!=null&&h(e,["executableCode"],r);let o=f(n,["fileData"]);o!=null&&h(e,["fileData"],bF(o));let a=f(n,["functionCall"]);a!=null&&h(e,["functionCall"],EF(a));let u=f(n,["functionResponse"]);u!=null&&h(e,["functionResponse"],u);let c=f(n,["inlineData"]);c!=null&&h(e,["inlineData"],pF(c));let p=f(n,["text"]);p!=null&&h(e,["text"],p);let g=f(n,["thought"]);g!=null&&h(e,["thought"],g);let y=f(n,["thoughtSignature"]);y!=null&&h(e,["thoughtSignature"],y);let v=f(n,["videoMetadata"]);return v!=null&&h(e,["videoMetadata"],v),e}function LF(n){let e={},t=f(n,["retrievalConfig"]);t!=null&&h(e,["retrievalConfig"],t);let i=f(n,["functionCallingConfig"]);return i!=null&&h(e,["functionCallingConfig"],SF(i)),e}function OF(n){let e={};if(f(n,["retrieval"])!==void 0)throw new Error("retrieval parameter is not supported in Gemini API.");let t=f(n,["computerUse"]);t!=null&&h(e,["computerUse"],t);let i=f(n,["fileSearch"]);i!=null&&h(e,["fileSearch"],i);let r=f(n,["codeExecution"]);if(r!=null&&h(e,["codeExecution"],r),f(n,["enterpriseWebSearch"])!==void 0)throw new Error("enterpriseWebSearch parameter is not supported in Gemini API.");let o=f(n,["functionDeclarations"]);if(o!=null){let g=o;Array.isArray(g)&&(g=g.map(y=>y)),h(e,["functionDeclarations"],g)}let a=f(n,["googleMaps"]);a!=null&&h(e,["googleMaps"],IF(a));let u=f(n,["googleSearch"]);u!=null&&h(e,["googleSearch"],MF(u));let c=f(n,["googleSearchRetrieval"]);c!=null&&h(e,["googleSearchRetrieval"],c);let p=f(n,["urlContext"]);return p!=null&&h(e,["urlContext"],p),e}function BF(n){let e={},t=f(n,["retrieval"]);t!=null&&h(e,["retrieval"],t);let i=f(n,["computerUse"]);if(i!=null&&h(e,["computerUse"],i),f(n,["fileSearch"])!==void 0)throw new Error("fileSearch parameter is not supported in Vertex AI.");let r=f(n,["codeExecution"]);r!=null&&h(e,["codeExecution"],r);let o=f(n,["enterpriseWebSearch"]);o!=null&&h(e,["enterpriseWebSearch"],o);let a=f(n,["functionDeclarations"]);if(a!=null){let y=a;Array.isArray(y)&&(y=y.map(v=>DF(v))),h(e,["functionDeclarations"],y)}let u=f(n,["googleMaps"]);u!=null&&h(e,["googleMaps"],u);let c=f(n,["googleSearch"]);c!=null&&h(e,["googleSearch"],c);let p=f(n,["googleSearchRetrieval"]);p!=null&&h(e,["googleSearchRetrieval"],p);let g=f(n,["urlContext"]);return g!=null&&h(e,["urlContext"],g),e}function UF(n,e){let t={},i=f(n,["ttl"]);e!==void 0&&i!=null&&h(e,["ttl"],i);let r=f(n,["expireTime"]);return e!==void 0&&r!=null&&h(e,["expireTime"],r),t}function $F(n,e){let t={},i=f(n,["ttl"]);e!==void 0&&i!=null&&h(e,["ttl"],i);let r=f(n,["expireTime"]);return e!==void 0&&r!=null&&h(e,["expireTime"],r),t}function HF(n,e){let t={},i=f(e,["name"]);i!=null&&h(t,["_url","name"],tr(n,i));let r=f(e,["config"]);return r!=null&&UF(r,t),t}function GF(n,e){let t={},i=f(e,["name"]);i!=null&&h(t,["_url","name"],tr(n,i));let r=f(e,["config"]);return r!=null&&$F(r,t),t}var Ry=class extends gi{constructor(e){super(),this.apiClient=e,this.list=async(t={})=>new er(Mr.PAGED_ITEM_CACHED_CONTENTS,i=>this.listInternal(i),await this.listInternal(t),t)}async create(e){var t,i,r,o;let a,u="",c={};if(this.apiClient.isVertexAI()){let p=yF(this.apiClient,e);return u=te("cachedContents",p._url),c=p._query,delete p._url,delete p._query,a=this.apiClient.request({path:u,queryParams:c,body:JSON.stringify(p),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(g=>g.json()),a.then(g=>g)}else{let p=hF(this.apiClient,e);return u=te("cachedContents",p._url),c=p._query,delete p._url,delete p._query,a=this.apiClient.request({path:u,queryParams:c,body:JSON.stringify(p),httpMethod:"POST",httpOptions:(r=e.config)===null||r===void 0?void 0:r.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(g=>g.json()),a.then(g=>g)}}async get(e){var t,i,r,o;let a,u="",c={};if(this.apiClient.isVertexAI()){let p=TF(this.apiClient,e);return u=te("{name}",p._url),c=p._query,delete p._url,delete p._query,a=this.apiClient.request({path:u,queryParams:c,body:JSON.stringify(p),httpMethod:"GET",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(g=>g.json()),a.then(g=>g)}else{let p=wF(this.apiClient,e);return u=te("{name}",p._url),c=p._query,delete p._url,delete p._query,a=this.apiClient.request({path:u,queryParams:c,body:JSON.stringify(p),httpMethod:"GET",httpOptions:(r=e.config)===null||r===void 0?void 0:r.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(g=>g.json()),a.then(g=>g)}}async delete(e){var t,i,r,o;let a,u="",c={};if(this.apiClient.isVertexAI()){let p=vF(this.apiClient,e);return u=te("{name}",p._url),c=p._query,delete p._url,delete p._query,a=this.apiClient.request({path:u,queryParams:c,body:JSON.stringify(p),httpMethod:"DELETE",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(g=>g.json().then(y=>{let v=y;return v.sdkHttpResponse={headers:g.headers},v})),a.then(g=>{let y=xF(g),v=new Um;return Object.assign(v,y),v})}else{let p=_F(this.apiClient,e);return u=te("{name}",p._url),c=p._query,delete p._url,delete p._query,a=this.apiClient.request({path:u,queryParams:c,body:JSON.stringify(p),httpMethod:"DELETE",httpOptions:(r=e.config)===null||r===void 0?void 0:r.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(g=>g.json().then(y=>{let v=y;return v.sdkHttpResponse={headers:g.headers},v})),a.then(g=>{let y=CF(g),v=new Um;return Object.assign(v,y),v})}}async update(e){var t,i,r,o;let a,u="",c={};if(this.apiClient.isVertexAI()){let p=GF(this.apiClient,e);return u=te("{name}",p._url),c=p._query,delete p._url,delete p._query,a=this.apiClient.request({path:u,queryParams:c,body:JSON.stringify(p),httpMethod:"PATCH",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(g=>g.json()),a.then(g=>g)}else{let p=HF(this.apiClient,e);return u=te("{name}",p._url),c=p._query,delete p._url,delete p._query,a=this.apiClient.request({path:u,queryParams:c,body:JSON.stringify(p),httpMethod:"PATCH",httpOptions:(r=e.config)===null||r===void 0?void 0:r.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(g=>g.json()),a.then(g=>g)}}async listInternal(e){var t,i,r,o;let a,u="",c={};if(this.apiClient.isVertexAI()){let p=FF(e);return u=te("cachedContents",p._url),c=p._query,delete p._url,delete p._query,a=this.apiClient.request({path:u,queryParams:c,body:JSON.stringify(p),httpMethod:"GET",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(g=>g.json().then(y=>{let v=y;return v.sdkHttpResponse={headers:g.headers},v})),a.then(g=>{let y=kF(g),v=new $m;return Object.assign(v,y),v})}else{let p=NF(e);return u=te("cachedContents",p._url),c=p._query,delete p._url,delete p._query,a=this.apiClient.request({path:u,queryParams:c,body:JSON.stringify(p),httpMethod:"GET",httpOptions:(r=e.config)===null||r===void 0?void 0:r.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(g=>g.json().then(y=>{let v=y;return v.sdkHttpResponse={headers:g.headers},v})),a.then(g=>{let y=PF(g),v=new $m;return Object.assign(v,y),v})}}};function qm(n,e){var t={};for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&e.indexOf(i)<0&&(t[i]=n[i]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,i=Object.getOwnPropertySymbols(n);r<i.length;r++)e.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(n,i[r])&&(t[i[r]]=n[i[r]]);return t}function p2(n){var e=typeof Symbol=="function"&&Symbol.iterator,t=e&&n[e],i=0;if(t)return t.call(n);if(n&&typeof n.length=="number")return{next:function(){return n&&i>=n.length&&(n=void 0),{value:n&&n[i++],done:!n}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function Ce(n){return this instanceof Ce?(this.v=n,this):new Ce(n)}function pi(n,e,t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var i=t.apply(n,e||[]),r,o=[];return r=Object.create((typeof AsyncIterator=="function"?AsyncIterator:Object).prototype),u("next"),u("throw"),u("return",a),r[Symbol.asyncIterator]=function(){return this},r;function a(C){return function(T){return Promise.resolve(T).then(C,y)}}function u(C,T){i[C]&&(r[C]=function(R){return new Promise(function(F,P){o.push([C,R,F,P])>1||c(C,R)})},T&&(r[C]=T(r[C])))}function c(C,T){try{p(i[C](T))}catch(R){v(o[0][3],R)}}function p(C){C.value instanceof Ce?Promise.resolve(C.value.v).then(g,y):v(o[0][2],C)}function g(C){c("next",C)}function y(C){c("throw",C)}function v(C,T){C(T),o.shift(),o.length&&c(o[0][0],o[0][1])}}function fi(n){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e=n[Symbol.asyncIterator],t;return e?e.call(n):(n=typeof p2=="function"?p2(n):n[Symbol.iterator](),t={},i("next"),i("throw"),i("return"),t[Symbol.asyncIterator]=function(){return this},t);function i(o){t[o]=n[o]&&function(a){return new Promise(function(u,c){a=n[o](a),r(u,c,a.done,a.value)})}}function r(o,a,u,c){Promise.resolve(c).then(function(p){o({value:p,done:u})},a)}}function qF(n){var e;if(n.candidates==null||n.candidates.length===0)return!1;let t=(e=n.candidates[0])===null||e===void 0?void 0:e.content;return t===void 0?!1:J2(t)}function J2(n){if(n.parts===void 0||n.parts.length===0)return!1;for(let e of n.parts)if(e===void 0||Object.keys(e).length===0)return!1;return!0}function WF(n){if(n.length!==0){for(let e of n)if(e.role!=="user"&&e.role!=="model")throw new Error(`Role must be user or model, but got ${e.role}.`)}}function f2(n){if(n===void 0||n.length===0)return[];let e=[],t=n.length,i=0;for(;i<t;)if(n[i].role==="user")e.push(n[i]),i++;else{let r=[],o=!0;for(;i<t&&n[i].role==="model";)r.push(n[i]),o&&!J2(n[i])&&(o=!1),i++;o?e.push(...r):e.pop()}return e}var Ny=class{constructor(e,t){this.modelsModule=e,this.apiClient=t}create(e){return new Fy(this.apiClient,this.modelsModule,e.model,e.config,structuredClone(e.history))}},Fy=class{constructor(e,t,i,r={},o=[]){this.apiClient=e,this.modelsModule=t,this.model=i,this.config=r,this.history=o,this.sendPromise=Promise.resolve(),WF(o)}async sendMessage(e){var t;await this.sendPromise;let i=nn(e.message),r=this.modelsModule.generateContent({model:this.model,contents:this.getHistory(!0).concat(i),config:(t=e.config)!==null&&t!==void 0?t:this.config});return this.sendPromise=(async()=>{var o,a,u;let c=await r,p=(a=(o=c.candidates)===null||o===void 0?void 0:o[0])===null||a===void 0?void 0:a.content,g=c.automaticFunctionCallingHistory,y=this.getHistory(!0).length,v=[];g!=null&&(v=(u=g.slice(y))!==null&&u!==void 0?u:[]);let C=p?[p]:[];this.recordHistory(i,C,v)})(),await this.sendPromise.catch(()=>{this.sendPromise=Promise.resolve()}),r}async sendMessageStream(e){var t;await this.sendPromise;let i=nn(e.message),r=this.modelsModule.generateContentStream({model:this.model,contents:this.getHistory(!0).concat(i),config:(t=e.config)!==null&&t!==void 0?t:this.config});this.sendPromise=r.then(()=>{}).catch(()=>{});let o=await r;return this.processStreamResponse(o,i)}getHistory(e=!1){let t=e?f2(this.history):this.history;return structuredClone(t)}processStreamResponse(e,t){return pi(this,arguments,function*(){var r,o,a,u,c,p;let g=[];try{for(var y=!0,v=fi(e),C;C=yield Ce(v.next()),r=C.done,!r;y=!0){u=C.value,y=!1;let T=u;if(qF(T)){let R=(p=(c=T.candidates)===null||c===void 0?void 0:c[0])===null||p===void 0?void 0:p.content;R!==void 0&&g.push(R)}yield yield Ce(T)}}catch(T){o={error:T}}finally{try{!y&&!r&&(a=v.return)&&(yield Ce(a.call(v)))}finally{if(o)throw o.error}}this.recordHistory(t,g)})}recordHistory(e,t,i){let r=[];t.length>0&&t.every(o=>o.role!==void 0)?r=t:r.push({role:"model",parts:[]}),i&&i.length>0?this.history.push(...f2(i)):this.history.push(e),this.history.push(...r)}};var ru=class n extends Error{constructor(e){super(e.message),this.name="ApiError",this.status=e.status,Object.setPrototypeOf(this,n.prototype)}};function jF(n){let e={},t=f(n,["file"]);return t!=null&&h(e,["file"],t),e}function zF(n){let e={},t=f(n,["sdkHttpResponse"]);return t!=null&&h(e,["sdkHttpResponse"],t),e}function YF(n){let e={},t=f(n,["name"]);return t!=null&&h(e,["_url","file"],H2(t)),e}function JF(n){let e={},t=f(n,["sdkHttpResponse"]);return t!=null&&h(e,["sdkHttpResponse"],t),e}function KF(n){let e={},t=f(n,["name"]);return t!=null&&h(e,["_url","file"],H2(t)),e}function QF(n,e){let t={},i=f(n,["pageSize"]);e!==void 0&&i!=null&&h(e,["_query","pageSize"],i);let r=f(n,["pageToken"]);return e!==void 0&&r!=null&&h(e,["_query","pageToken"],r),t}function ZF(n){let e={},t=f(n,["config"]);return t!=null&&QF(t,e),e}function XF(n){let e={},t=f(n,["sdkHttpResponse"]);t!=null&&h(e,["sdkHttpResponse"],t);let i=f(n,["nextPageToken"]);i!=null&&h(e,["nextPageToken"],i);let r=f(n,["files"]);if(r!=null){let o=r;Array.isArray(o)&&(o=o.map(a=>a)),h(e,["files"],o)}return e}var Py=class extends gi{constructor(e){super(),this.apiClient=e,this.list=async(t={})=>new er(Mr.PAGED_ITEM_FILES,i=>this.listInternal(i),await this.listInternal(t),t)}async upload(e){if(this.apiClient.isVertexAI())throw new Error("Vertex AI does not support uploading files. You can share files through a GCS bucket.");return this.apiClient.uploadFile(e.file,e.config).then(t=>t)}async download(e){await this.apiClient.downloadFile(e)}async listInternal(e){var t,i;let r,o="",a={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{let u=ZF(e);return o=te("files",u._url),a=u._query,delete u._url,delete u._query,r=this.apiClient.request({path:o,queryParams:a,body:JSON.stringify(u),httpMethod:"GET",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(c=>c.json().then(p=>{let g=p;return g.sdkHttpResponse={headers:c.headers},g})),r.then(c=>{let p=XF(c),g=new by;return Object.assign(g,p),g})}}async createInternal(e){var t,i;let r,o="",a={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{let u=jF(e);return o=te("upload/v1beta/files",u._url),a=u._query,delete u._url,delete u._query,r=this.apiClient.request({path:o,queryParams:a,body:JSON.stringify(u),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(c=>c.json()),r.then(c=>{let p=zF(c),g=new Ey;return Object.assign(g,p),g})}}async get(e){var t,i;let r,o="",a={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{let u=KF(e);return o=te("files/{file}",u._url),a=u._query,delete u._url,delete u._query,r=this.apiClient.request({path:o,queryParams:a,body:JSON.stringify(u),httpMethod:"GET",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(c=>c.json()),r.then(c=>c)}}async delete(e){var t,i;let r,o="",a={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{let u=YF(e);return o=te("files/{file}",u._url),a=u._query,delete u._url,delete u._query,r=this.apiClient.request({path:o,queryParams:a,body:JSON.stringify(u),httpMethod:"DELETE",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(c=>c.json().then(p=>{let g=p;return g.sdkHttpResponse={headers:c.headers},g})),r.then(c=>{let p=JF(c),g=new Sy;return Object.assign(g,p),g})}}};function Rm(n){let e={},t=f(n,["data"]);if(t!=null&&h(e,["data"],t),f(n,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");let i=f(n,["mimeType"]);return i!=null&&h(e,["mimeType"],i),e}function eP(n){let e={},t=f(n,["parts"]);if(t!=null){let r=t;Array.isArray(r)&&(r=r.map(o=>hP(o))),h(e,["parts"],r)}let i=f(n,["role"]);return i!=null&&h(e,["role"],i),e}function tP(n){let e={};if(f(n,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");let t=f(n,["fileUri"]);t!=null&&h(e,["fileUri"],t);let i=f(n,["mimeType"]);return i!=null&&h(e,["mimeType"],i),e}function nP(n){let e={},t=f(n,["id"]);t!=null&&h(e,["id"],t);let i=f(n,["args"]);i!=null&&h(e,["args"],i);let r=f(n,["name"]);if(r!=null&&h(e,["name"],r),f(n,["partialArgs"])!==void 0)throw new Error("partialArgs parameter is not supported in Gemini API.");if(f(n,["willContinue"])!==void 0)throw new Error("willContinue parameter is not supported in Gemini API.");return e}function iP(n){let e={},t=f(n,["description"]);t!=null&&h(e,["description"],t);let i=f(n,["name"]);i!=null&&h(e,["name"],i);let r=f(n,["parameters"]);r!=null&&h(e,["parameters"],r);let o=f(n,["parametersJsonSchema"]);o!=null&&h(e,["parametersJsonSchema"],o);let a=f(n,["response"]);a!=null&&h(e,["response"],a);let u=f(n,["responseJsonSchema"]);if(u!=null&&h(e,["responseJsonSchema"],u),f(n,["behavior"])!==void 0)throw new Error("behavior parameter is not supported in Vertex AI.");return e}function rP(n){let e={},t=f(n,["modelSelectionConfig"]);t!=null&&h(e,["modelConfig"],t);let i=f(n,["responseJsonSchema"]);i!=null&&h(e,["responseJsonSchema"],i);let r=f(n,["audioTimestamp"]);r!=null&&h(e,["audioTimestamp"],r);let o=f(n,["candidateCount"]);o!=null&&h(e,["candidateCount"],o);let a=f(n,["enableAffectiveDialog"]);a!=null&&h(e,["enableAffectiveDialog"],a);let u=f(n,["frequencyPenalty"]);u!=null&&h(e,["frequencyPenalty"],u);let c=f(n,["logprobs"]);c!=null&&h(e,["logprobs"],c);let p=f(n,["maxOutputTokens"]);p!=null&&h(e,["maxOutputTokens"],p);let g=f(n,["mediaResolution"]);g!=null&&h(e,["mediaResolution"],g);let y=f(n,["presencePenalty"]);y!=null&&h(e,["presencePenalty"],y);let v=f(n,["responseLogprobs"]);v!=null&&h(e,["responseLogprobs"],v);let C=f(n,["responseMimeType"]);C!=null&&h(e,["responseMimeType"],C);let T=f(n,["responseModalities"]);T!=null&&h(e,["responseModalities"],T);let R=f(n,["responseSchema"]);R!=null&&h(e,["responseSchema"],R);let F=f(n,["routingConfig"]);F!=null&&h(e,["routingConfig"],F);let P=f(n,["seed"]);P!=null&&h(e,["seed"],P);let H=f(n,["speechConfig"]);H!=null&&h(e,["speechConfig"],H);let q=f(n,["stopSequences"]);q!=null&&h(e,["stopSequences"],q);let Z=f(n,["temperature"]);Z!=null&&h(e,["temperature"],Z);let ie=f(n,["thinkingConfig"]);ie!=null&&h(e,["thinkingConfig"],ie);let me=f(n,["topK"]);me!=null&&h(e,["topK"],me);let de=f(n,["topP"]);if(de!=null&&h(e,["topP"],de),f(n,["enableEnhancedCivicAnswers"])!==void 0)throw new Error("enableEnhancedCivicAnswers parameter is not supported in Vertex AI.");return e}function oP(n){let e={};if(f(n,["authConfig"])!==void 0)throw new Error("authConfig parameter is not supported in Gemini API.");let t=f(n,["enableWidget"]);return t!=null&&h(e,["enableWidget"],t),e}function aP(n){let e={};if(f(n,["excludeDomains"])!==void 0)throw new Error("excludeDomains parameter is not supported in Gemini API.");if(f(n,["blockingConfidence"])!==void 0)throw new Error("blockingConfidence parameter is not supported in Gemini API.");let t=f(n,["timeRangeFilter"]);return t!=null&&h(e,["timeRangeFilter"],t),e}function sP(n,e){let t={},i=f(n,["generationConfig"]);e!==void 0&&i!=null&&h(e,["setup","generationConfig"],i);let r=f(n,["responseModalities"]);e!==void 0&&r!=null&&h(e,["setup","generationConfig","responseModalities"],r);let o=f(n,["temperature"]);e!==void 0&&o!=null&&h(e,["setup","generationConfig","temperature"],o);let a=f(n,["topP"]);e!==void 0&&a!=null&&h(e,["setup","generationConfig","topP"],a);let u=f(n,["topK"]);e!==void 0&&u!=null&&h(e,["setup","generationConfig","topK"],u);let c=f(n,["maxOutputTokens"]);e!==void 0&&c!=null&&h(e,["setup","generationConfig","maxOutputTokens"],c);let p=f(n,["mediaResolution"]);e!==void 0&&p!=null&&h(e,["setup","generationConfig","mediaResolution"],p);let g=f(n,["seed"]);e!==void 0&&g!=null&&h(e,["setup","generationConfig","seed"],g);let y=f(n,["speechConfig"]);e!==void 0&&y!=null&&h(e,["setup","generationConfig","speechConfig"],p_(y));let v=f(n,["thinkingConfig"]);e!==void 0&&v!=null&&h(e,["setup","generationConfig","thinkingConfig"],v);let C=f(n,["enableAffectiveDialog"]);e!==void 0&&C!=null&&h(e,["setup","generationConfig","enableAffectiveDialog"],C);let T=f(n,["systemInstruction"]);e!==void 0&&T!=null&&h(e,["setup","systemInstruction"],eP(nn(T)));let R=f(n,["tools"]);if(e!==void 0&&R!=null){let me=Ua(R);Array.isArray(me)&&(me=me.map(de=>_P(Ba(de)))),h(e,["setup","tools"],me)}let F=f(n,["sessionResumption"]);e!==void 0&&F!=null&&h(e,["setup","sessionResumption"],yP(F));let P=f(n,["inputAudioTranscription"]);e!==void 0&&P!=null&&h(e,["setup","inputAudioTranscription"],P);let H=f(n,["outputAudioTranscription"]);e!==void 0&&H!=null&&h(e,["setup","outputAudioTranscription"],H);let q=f(n,["realtimeInputConfig"]);e!==void 0&&q!=null&&h(e,["setup","realtimeInputConfig"],q);let Z=f(n,["contextWindowCompression"]);e!==void 0&&Z!=null&&h(e,["setup","contextWindowCompression"],Z);let ie=f(n,["proactivity"]);if(e!==void 0&&ie!=null&&h(e,["setup","proactivity"],ie),f(n,["explicitVadSignal"])!==void 0)throw new Error("explicitVadSignal parameter is not supported in Gemini API.");return t}function lP(n,e){let t={},i=f(n,["generationConfig"]);e!==void 0&&i!=null&&h(e,["setup","generationConfig"],rP(i));let r=f(n,["responseModalities"]);e!==void 0&&r!=null&&h(e,["setup","generationConfig","responseModalities"],r);let o=f(n,["temperature"]);e!==void 0&&o!=null&&h(e,["setup","generationConfig","temperature"],o);let a=f(n,["topP"]);e!==void 0&&a!=null&&h(e,["setup","generationConfig","topP"],a);let u=f(n,["topK"]);e!==void 0&&u!=null&&h(e,["setup","generationConfig","topK"],u);let c=f(n,["maxOutputTokens"]);e!==void 0&&c!=null&&h(e,["setup","generationConfig","maxOutputTokens"],c);let p=f(n,["mediaResolution"]);e!==void 0&&p!=null&&h(e,["setup","generationConfig","mediaResolution"],p);let g=f(n,["seed"]);e!==void 0&&g!=null&&h(e,["setup","generationConfig","seed"],g);let y=f(n,["speechConfig"]);e!==void 0&&y!=null&&h(e,["setup","generationConfig","speechConfig"],p_(y));let v=f(n,["thinkingConfig"]);e!==void 0&&v!=null&&h(e,["setup","generationConfig","thinkingConfig"],v);let C=f(n,["enableAffectiveDialog"]);e!==void 0&&C!=null&&h(e,["setup","generationConfig","enableAffectiveDialog"],C);let T=f(n,["systemInstruction"]);e!==void 0&&T!=null&&h(e,["setup","systemInstruction"],nn(T));let R=f(n,["tools"]);if(e!==void 0&&R!=null){let de=Ua(R);Array.isArray(de)&&(de=de.map($e=>vP(Ba($e)))),h(e,["setup","tools"],de)}let F=f(n,["sessionResumption"]);e!==void 0&&F!=null&&h(e,["setup","sessionResumption"],F);let P=f(n,["inputAudioTranscription"]);e!==void 0&&P!=null&&h(e,["setup","inputAudioTranscription"],P);let H=f(n,["outputAudioTranscription"]);e!==void 0&&H!=null&&h(e,["setup","outputAudioTranscription"],H);let q=f(n,["realtimeInputConfig"]);e!==void 0&&q!=null&&h(e,["setup","realtimeInputConfig"],q);let Z=f(n,["contextWindowCompression"]);e!==void 0&&Z!=null&&h(e,["setup","contextWindowCompression"],Z);let ie=f(n,["proactivity"]);e!==void 0&&ie!=null&&h(e,["setup","proactivity"],ie);let me=f(n,["explicitVadSignal"]);return e!==void 0&&me!=null&&h(e,["setup","explicitVadSignal"],me),t}function uP(n,e){let t={},i=f(e,["model"]);i!=null&&h(t,["setup","model"],We(n,i));let r=f(e,["config"]);return r!=null&&h(t,["config"],sP(r,t)),t}function dP(n,e){let t={},i=f(e,["model"]);i!=null&&h(t,["setup","model"],We(n,i));let r=f(e,["config"]);return r!=null&&h(t,["config"],lP(r,t)),t}function cP(n){let e={},t=f(n,["musicGenerationConfig"]);return t!=null&&h(e,["musicGenerationConfig"],t),e}function mP(n){let e={},t=f(n,["weightedPrompts"]);if(t!=null){let i=t;Array.isArray(i)&&(i=i.map(r=>r)),h(e,["weightedPrompts"],i)}return e}function pP(n){let e={},t=f(n,["media"]);if(t!=null){let p=L2(t);Array.isArray(p)&&(p=p.map(g=>Rm(g))),h(e,["mediaChunks"],p)}let i=f(n,["audio"]);i!=null&&h(e,["audio"],Rm(B2(i)));let r=f(n,["audioStreamEnd"]);r!=null&&h(e,["audioStreamEnd"],r);let o=f(n,["video"]);o!=null&&h(e,["video"],Rm(O2(o)));let a=f(n,["text"]);a!=null&&h(e,["text"],a);let u=f(n,["activityStart"]);u!=null&&h(e,["activityStart"],u);let c=f(n,["activityEnd"]);return c!=null&&h(e,["activityEnd"],c),e}function fP(n){let e={},t=f(n,["media"]);if(t!=null){let p=L2(t);Array.isArray(p)&&(p=p.map(g=>g)),h(e,["mediaChunks"],p)}let i=f(n,["audio"]);i!=null&&h(e,["audio"],B2(i));let r=f(n,["audioStreamEnd"]);r!=null&&h(e,["audioStreamEnd"],r);let o=f(n,["video"]);o!=null&&h(e,["video"],O2(o));let a=f(n,["text"]);a!=null&&h(e,["text"],a);let u=f(n,["activityStart"]);u!=null&&h(e,["activityStart"],u);let c=f(n,["activityEnd"]);return c!=null&&h(e,["activityEnd"],c),e}function gP(n){let e={},t=f(n,["setupComplete"]);t!=null&&h(e,["setupComplete"],t);let i=f(n,["serverContent"]);i!=null&&h(e,["serverContent"],i);let r=f(n,["toolCall"]);r!=null&&h(e,["toolCall"],r);let o=f(n,["toolCallCancellation"]);o!=null&&h(e,["toolCallCancellation"],o);let a=f(n,["usageMetadata"]);a!=null&&h(e,["usageMetadata"],CP(a));let u=f(n,["goAway"]);u!=null&&h(e,["goAway"],u);let c=f(n,["sessionResumptionUpdate"]);c!=null&&h(e,["sessionResumptionUpdate"],c);let p=f(n,["voiceActivityDetectionSignal"]);p!=null&&h(e,["voiceActivityDetectionSignal"],p);let g=f(n,["voiceActivity"]);return g!=null&&h(e,["voiceActivity"],xP(g)),e}function hP(n){let e={},t=f(n,["mediaResolution"]);t!=null&&h(e,["mediaResolution"],t);let i=f(n,["codeExecutionResult"]);i!=null&&h(e,["codeExecutionResult"],i);let r=f(n,["executableCode"]);r!=null&&h(e,["executableCode"],r);let o=f(n,["fileData"]);o!=null&&h(e,["fileData"],tP(o));let a=f(n,["functionCall"]);a!=null&&h(e,["functionCall"],nP(a));let u=f(n,["functionResponse"]);u!=null&&h(e,["functionResponse"],u);let c=f(n,["inlineData"]);c!=null&&h(e,["inlineData"],Rm(c));let p=f(n,["text"]);p!=null&&h(e,["text"],p);let g=f(n,["thought"]);g!=null&&h(e,["thought"],g);let y=f(n,["thoughtSignature"]);y!=null&&h(e,["thoughtSignature"],y);let v=f(n,["videoMetadata"]);return v!=null&&h(e,["videoMetadata"],v),e}function yP(n){let e={},t=f(n,["handle"]);if(t!=null&&h(e,["handle"],t),f(n,["transparent"])!==void 0)throw new Error("transparent parameter is not supported in Gemini API.");return e}function _P(n){let e={};if(f(n,["retrieval"])!==void 0)throw new Error("retrieval parameter is not supported in Gemini API.");let t=f(n,["computerUse"]);t!=null&&h(e,["computerUse"],t);let i=f(n,["fileSearch"]);i!=null&&h(e,["fileSearch"],i);let r=f(n,["codeExecution"]);if(r!=null&&h(e,["codeExecution"],r),f(n,["enterpriseWebSearch"])!==void 0)throw new Error("enterpriseWebSearch parameter is not supported in Gemini API.");let o=f(n,["functionDeclarations"]);if(o!=null){let g=o;Array.isArray(g)&&(g=g.map(y=>y)),h(e,["functionDeclarations"],g)}let a=f(n,["googleMaps"]);a!=null&&h(e,["googleMaps"],oP(a));let u=f(n,["googleSearch"]);u!=null&&h(e,["googleSearch"],aP(u));let c=f(n,["googleSearchRetrieval"]);c!=null&&h(e,["googleSearchRetrieval"],c);let p=f(n,["urlContext"]);return p!=null&&h(e,["urlContext"],p),e}function vP(n){let e={},t=f(n,["retrieval"]);t!=null&&h(e,["retrieval"],t);let i=f(n,["computerUse"]);if(i!=null&&h(e,["computerUse"],i),f(n,["fileSearch"])!==void 0)throw new Error("fileSearch parameter is not supported in Vertex AI.");let r=f(n,["codeExecution"]);r!=null&&h(e,["codeExecution"],r);let o=f(n,["enterpriseWebSearch"]);o!=null&&h(e,["enterpriseWebSearch"],o);let a=f(n,["functionDeclarations"]);if(a!=null){let y=a;Array.isArray(y)&&(y=y.map(v=>iP(v))),h(e,["functionDeclarations"],y)}let u=f(n,["googleMaps"]);u!=null&&h(e,["googleMaps"],u);let c=f(n,["googleSearch"]);c!=null&&h(e,["googleSearch"],c);let p=f(n,["googleSearchRetrieval"]);p!=null&&h(e,["googleSearchRetrieval"],p);let g=f(n,["urlContext"]);return g!=null&&h(e,["urlContext"],g),e}function CP(n){let e={},t=f(n,["promptTokenCount"]);t!=null&&h(e,["promptTokenCount"],t);let i=f(n,["cachedContentTokenCount"]);i!=null&&h(e,["cachedContentTokenCount"],i);let r=f(n,["candidatesTokenCount"]);r!=null&&h(e,["responseTokenCount"],r);let o=f(n,["toolUsePromptTokenCount"]);o!=null&&h(e,["toolUsePromptTokenCount"],o);let a=f(n,["thoughtsTokenCount"]);a!=null&&h(e,["thoughtsTokenCount"],a);let u=f(n,["totalTokenCount"]);u!=null&&h(e,["totalTokenCount"],u);let c=f(n,["promptTokensDetails"]);if(c!=null){let C=c;Array.isArray(C)&&(C=C.map(T=>T)),h(e,["promptTokensDetails"],C)}let p=f(n,["cacheTokensDetails"]);if(p!=null){let C=p;Array.isArray(C)&&(C=C.map(T=>T)),h(e,["cacheTokensDetails"],C)}let g=f(n,["candidatesTokensDetails"]);if(g!=null){let C=g;Array.isArray(C)&&(C=C.map(T=>T)),h(e,["responseTokensDetails"],C)}let y=f(n,["toolUsePromptTokensDetails"]);if(y!=null){let C=y;Array.isArray(C)&&(C=C.map(T=>T)),h(e,["toolUsePromptTokensDetails"],C)}let v=f(n,["trafficType"]);return v!=null&&h(e,["trafficType"],v),e}function xP(n){let e={},t=f(n,["type"]);return t!=null&&h(e,["voiceActivityType"],t),e}function bP(n){let e={},t=f(n,["data"]);if(t!=null&&h(e,["data"],t),f(n,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");let i=f(n,["mimeType"]);return i!=null&&h(e,["mimeType"],i),e}function EP(n){let e={},t=f(n,["content"]);t!=null&&h(e,["content"],t);let i=f(n,["citationMetadata"]);i!=null&&h(e,["citationMetadata"],SP(i));let r=f(n,["tokenCount"]);r!=null&&h(e,["tokenCount"],r);let o=f(n,["finishReason"]);o!=null&&h(e,["finishReason"],o);let a=f(n,["avgLogprobs"]);a!=null&&h(e,["avgLogprobs"],a);let u=f(n,["groundingMetadata"]);u!=null&&h(e,["groundingMetadata"],u);let c=f(n,["index"]);c!=null&&h(e,["index"],c);let p=f(n,["logprobsResult"]);p!=null&&h(e,["logprobsResult"],p);let g=f(n,["safetyRatings"]);if(g!=null){let v=g;Array.isArray(v)&&(v=v.map(C=>C)),h(e,["safetyRatings"],v)}let y=f(n,["urlContextMetadata"]);return y!=null&&h(e,["urlContextMetadata"],y),e}function SP(n){let e={},t=f(n,["citationSources"]);if(t!=null){let i=t;Array.isArray(i)&&(i=i.map(r=>r)),h(e,["citations"],i)}return e}function DP(n,e){let t={},i=f(e,["model"]);i!=null&&h(t,["_url","model"],We(n,i));let r=f(e,["contents"]);if(r!=null){let o=jn(r);Array.isArray(o)&&(o=o.map(a=>a)),h(t,["contents"],o)}return t}function wP(n){let e={},t=f(n,["sdkHttpResponse"]);t!=null&&h(e,["sdkHttpResponse"],t);let i=f(n,["tokensInfo"]);if(i!=null){let r=i;Array.isArray(r)&&(r=r.map(o=>o)),h(e,["tokensInfo"],r)}return e}function TP(n){let e={},t=f(n,["values"]);t!=null&&h(e,["values"],t);let i=f(n,["statistics"]);return i!=null&&h(e,["statistics"],IP(i)),e}function IP(n){let e={},t=f(n,["truncated"]);t!=null&&h(e,["truncated"],t);let i=f(n,["token_count"]);return i!=null&&h(e,["tokenCount"],i),e}function op(n){let e={},t=f(n,["parts"]);if(t!=null){let r=t;Array.isArray(r)&&(r=r.map(o=>Lk(o))),h(e,["parts"],r)}let i=f(n,["role"]);return i!=null&&h(e,["role"],i),e}function MP(n){let e={},t=f(n,["controlType"]);t!=null&&h(e,["controlType"],t);let i=f(n,["enableControlImageComputation"]);return i!=null&&h(e,["computeControl"],i),e}function AP(n){let e={};if(f(n,["systemInstruction"])!==void 0)throw new Error("systemInstruction parameter is not supported in Gemini API.");if(f(n,["tools"])!==void 0)throw new Error("tools parameter is not supported in Gemini API.");if(f(n,["generationConfig"])!==void 0)throw new Error("generationConfig parameter is not supported in Gemini API.");return e}function RP(n,e){let t={},i=f(n,["systemInstruction"]);e!==void 0&&i!=null&&h(e,["systemInstruction"],nn(i));let r=f(n,["tools"]);if(e!==void 0&&r!=null){let a=r;Array.isArray(a)&&(a=a.map(u=>X2(u))),h(e,["tools"],a)}let o=f(n,["generationConfig"]);return e!==void 0&&o!=null&&h(e,["generationConfig"],bk(o)),t}function NP(n,e){let t={},i=f(e,["model"]);i!=null&&h(t,["_url","model"],We(n,i));let r=f(e,["contents"]);if(r!=null){let a=jn(r);Array.isArray(a)&&(a=a.map(u=>op(u))),h(t,["contents"],a)}let o=f(e,["config"]);return o!=null&&AP(o),t}function FP(n,e){let t={},i=f(e,["model"]);i!=null&&h(t,["_url","model"],We(n,i));let r=f(e,["contents"]);if(r!=null){let a=jn(r);Array.isArray(a)&&(a=a.map(u=>u)),h(t,["contents"],a)}let o=f(e,["config"]);return o!=null&&RP(o,t),t}function PP(n){let e={},t=f(n,["sdkHttpResponse"]);t!=null&&h(e,["sdkHttpResponse"],t);let i=f(n,["totalTokens"]);i!=null&&h(e,["totalTokens"],i);let r=f(n,["cachedContentTokenCount"]);return r!=null&&h(e,["cachedContentTokenCount"],r),e}function kP(n){let e={},t=f(n,["sdkHttpResponse"]);t!=null&&h(e,["sdkHttpResponse"],t);let i=f(n,["totalTokens"]);return i!=null&&h(e,["totalTokens"],i),e}function VP(n,e){let t={},i=f(e,["model"]);return i!=null&&h(t,["_url","name"],We(n,i)),t}function LP(n,e){let t={},i=f(e,["model"]);return i!=null&&h(t,["_url","name"],We(n,i)),t}function OP(n){let e={},t=f(n,["sdkHttpResponse"]);return t!=null&&h(e,["sdkHttpResponse"],t),e}function BP(n){let e={},t=f(n,["sdkHttpResponse"]);return t!=null&&h(e,["sdkHttpResponse"],t),e}function UP(n,e){let t={},i=f(n,["outputGcsUri"]);e!==void 0&&i!=null&&h(e,["parameters","storageUri"],i);let r=f(n,["negativePrompt"]);e!==void 0&&r!=null&&h(e,["parameters","negativePrompt"],r);let o=f(n,["numberOfImages"]);e!==void 0&&o!=null&&h(e,["parameters","sampleCount"],o);let a=f(n,["aspectRatio"]);e!==void 0&&a!=null&&h(e,["parameters","aspectRatio"],a);let u=f(n,["guidanceScale"]);e!==void 0&&u!=null&&h(e,["parameters","guidanceScale"],u);let c=f(n,["seed"]);e!==void 0&&c!=null&&h(e,["parameters","seed"],c);let p=f(n,["safetyFilterLevel"]);e!==void 0&&p!=null&&h(e,["parameters","safetySetting"],p);let g=f(n,["personGeneration"]);e!==void 0&&g!=null&&h(e,["parameters","personGeneration"],g);let y=f(n,["includeSafetyAttributes"]);e!==void 0&&y!=null&&h(e,["parameters","includeSafetyAttributes"],y);let v=f(n,["includeRaiReason"]);e!==void 0&&v!=null&&h(e,["parameters","includeRaiReason"],v);let C=f(n,["language"]);e!==void 0&&C!=null&&h(e,["parameters","language"],C);let T=f(n,["outputMimeType"]);e!==void 0&&T!=null&&h(e,["parameters","outputOptions","mimeType"],T);let R=f(n,["outputCompressionQuality"]);e!==void 0&&R!=null&&h(e,["parameters","outputOptions","compressionQuality"],R);let F=f(n,["addWatermark"]);e!==void 0&&F!=null&&h(e,["parameters","addWatermark"],F);let P=f(n,["labels"]);e!==void 0&&P!=null&&h(e,["labels"],P);let H=f(n,["editMode"]);e!==void 0&&H!=null&&h(e,["parameters","editMode"],H);let q=f(n,["baseSteps"]);return e!==void 0&&q!=null&&h(e,["parameters","editConfig","baseSteps"],q),t}function $P(n,e){let t={},i=f(e,["model"]);i!=null&&h(t,["_url","model"],We(n,i));let r=f(e,["prompt"]);r!=null&&h(t,["instances[0]","prompt"],r);let o=f(e,["referenceImages"]);if(o!=null){let u=o;Array.isArray(u)&&(u=u.map(c=>Gk(c))),h(t,["instances[0]","referenceImages"],u)}let a=f(e,["config"]);return a!=null&&UP(a,t),t}function HP(n){let e={},t=f(n,["sdkHttpResponse"]);t!=null&&h(e,["sdkHttpResponse"],t);let i=f(n,["predictions"]);if(i!=null){let r=i;Array.isArray(r)&&(r=r.map(o=>ap(o))),h(e,["generatedImages"],r)}return e}function GP(n,e){let t={},i=f(n,["taskType"]);e!==void 0&&i!=null&&h(e,["requests[]","taskType"],i);let r=f(n,["title"]);e!==void 0&&r!=null&&h(e,["requests[]","title"],r);let o=f(n,["outputDimensionality"]);if(e!==void 0&&o!=null&&h(e,["requests[]","outputDimensionality"],o),f(n,["mimeType"])!==void 0)throw new Error("mimeType parameter is not supported in Gemini API.");if(f(n,["autoTruncate"])!==void 0)throw new Error("autoTruncate parameter is not supported in Gemini API.");return t}function qP(n,e){let t={},i=f(n,["taskType"]);e!==void 0&&i!=null&&h(e,["instances[]","task_type"],i);let r=f(n,["title"]);e!==void 0&&r!=null&&h(e,["instances[]","title"],r);let o=f(n,["outputDimensionality"]);e!==void 0&&o!=null&&h(e,["parameters","outputDimensionality"],o);let a=f(n,["mimeType"]);e!==void 0&&a!=null&&h(e,["instances[]","mimeType"],a);let u=f(n,["autoTruncate"]);return e!==void 0&&u!=null&&h(e,["parameters","autoTruncate"],u),t}function WP(n,e){let t={},i=f(e,["model"]);i!=null&&h(t,["_url","model"],We(n,i));let r=f(e,["contents"]);if(r!=null){let u=d_(n,r);Array.isArray(u)&&(u=u.map(c=>c)),h(t,["requests[]","content"],u)}let o=f(e,["config"]);o!=null&&GP(o,t);let a=f(e,["model"]);return a!==void 0&&h(t,["requests[]","model"],We(n,a)),t}function jP(n,e){let t={},i=f(e,["model"]);i!=null&&h(t,["_url","model"],We(n,i));let r=f(e,["contents"]);if(r!=null){let a=d_(n,r);Array.isArray(a)&&(a=a.map(u=>u)),h(t,["instances[]","content"],a)}let o=f(e,["config"]);return o!=null&&qP(o,t),t}function zP(n){let e={},t=f(n,["sdkHttpResponse"]);t!=null&&h(e,["sdkHttpResponse"],t);let i=f(n,["embeddings"]);if(i!=null){let o=i;Array.isArray(o)&&(o=o.map(a=>a)),h(e,["embeddings"],o)}let r=f(n,["metadata"]);return r!=null&&h(e,["metadata"],r),e}function YP(n){let e={},t=f(n,["sdkHttpResponse"]);t!=null&&h(e,["sdkHttpResponse"],t);let i=f(n,["predictions[]","embeddings"]);if(i!=null){let o=i;Array.isArray(o)&&(o=o.map(a=>TP(a))),h(e,["embeddings"],o)}let r=f(n,["metadata"]);return r!=null&&h(e,["metadata"],r),e}function JP(n){let e={},t=f(n,["endpoint"]);t!=null&&h(e,["name"],t);let i=f(n,["deployedModelId"]);return i!=null&&h(e,["deployedModelId"],i),e}function KP(n){let e={};if(f(n,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");let t=f(n,["fileUri"]);t!=null&&h(e,["fileUri"],t);let i=f(n,["mimeType"]);return i!=null&&h(e,["mimeType"],i),e}function QP(n){let e={},t=f(n,["id"]);t!=null&&h(e,["id"],t);let i=f(n,["args"]);i!=null&&h(e,["args"],i);let r=f(n,["name"]);if(r!=null&&h(e,["name"],r),f(n,["partialArgs"])!==void 0)throw new Error("partialArgs parameter is not supported in Gemini API.");if(f(n,["willContinue"])!==void 0)throw new Error("willContinue parameter is not supported in Gemini API.");return e}function ZP(n){let e={},t=f(n,["allowedFunctionNames"]);t!=null&&h(e,["allowedFunctionNames"],t);let i=f(n,["mode"]);if(i!=null&&h(e,["mode"],i),f(n,["streamFunctionCallArguments"])!==void 0)throw new Error("streamFunctionCallArguments parameter is not supported in Gemini API.");return e}function XP(n){let e={},t=f(n,["description"]);t!=null&&h(e,["description"],t);let i=f(n,["name"]);i!=null&&h(e,["name"],i);let r=f(n,["parameters"]);r!=null&&h(e,["parameters"],r);let o=f(n,["parametersJsonSchema"]);o!=null&&h(e,["parametersJsonSchema"],o);let a=f(n,["response"]);a!=null&&h(e,["response"],a);let u=f(n,["responseJsonSchema"]);if(u!=null&&h(e,["responseJsonSchema"],u),f(n,["behavior"])!==void 0)throw new Error("behavior parameter is not supported in Vertex AI.");return e}function ek(n,e,t){let i={},r=f(e,["systemInstruction"]);t!==void 0&&r!=null&&h(t,["systemInstruction"],op(nn(r)));let o=f(e,["temperature"]);o!=null&&h(i,["temperature"],o);let a=f(e,["topP"]);a!=null&&h(i,["topP"],a);let u=f(e,["topK"]);u!=null&&h(i,["topK"],u);let c=f(e,["candidateCount"]);c!=null&&h(i,["candidateCount"],c);let p=f(e,["maxOutputTokens"]);p!=null&&h(i,["maxOutputTokens"],p);let g=f(e,["stopSequences"]);g!=null&&h(i,["stopSequences"],g);let y=f(e,["responseLogprobs"]);y!=null&&h(i,["responseLogprobs"],y);let v=f(e,["logprobs"]);v!=null&&h(i,["logprobs"],v);let C=f(e,["presencePenalty"]);C!=null&&h(i,["presencePenalty"],C);let T=f(e,["frequencyPenalty"]);T!=null&&h(i,["frequencyPenalty"],T);let R=f(e,["seed"]);R!=null&&h(i,["seed"],R);let F=f(e,["responseMimeType"]);F!=null&&h(i,["responseMimeType"],F);let P=f(e,["responseSchema"]);P!=null&&h(i,["responseSchema"],c_(P));let H=f(e,["responseJsonSchema"]);if(H!=null&&h(i,["responseJsonSchema"],H),f(e,["routingConfig"])!==void 0)throw new Error("routingConfig parameter is not supported in Gemini API.");if(f(e,["modelSelectionConfig"])!==void 0)throw new Error("modelSelectionConfig parameter is not supported in Gemini API.");let q=f(e,["safetySettings"]);if(t!==void 0&&q!=null){let _t=q;Array.isArray(_t)&&(_t=_t.map(_i=>qk(_i))),h(t,["safetySettings"],_t)}let Z=f(e,["tools"]);if(t!==void 0&&Z!=null){let _t=Ua(Z);Array.isArray(_t)&&(_t=_t.map(_i=>Qk(Ba(_i)))),h(t,["tools"],_t)}let ie=f(e,["toolConfig"]);if(t!==void 0&&ie!=null&&h(t,["toolConfig"],Kk(ie)),f(e,["labels"])!==void 0)throw new Error("labels parameter is not supported in Gemini API.");let me=f(e,["cachedContent"]);t!==void 0&&me!=null&&h(t,["cachedContent"],tr(n,me));let de=f(e,["responseModalities"]);de!=null&&h(i,["responseModalities"],de);let $e=f(e,["mediaResolution"]);$e!=null&&h(i,["mediaResolution"],$e);let ge=f(e,["speechConfig"]);if(ge!=null&&h(i,["speechConfig"],m_(ge)),f(e,["audioTimestamp"])!==void 0)throw new Error("audioTimestamp parameter is not supported in Gemini API.");let Me=f(e,["thinkingConfig"]);Me!=null&&h(i,["thinkingConfig"],Me);let wt=f(e,["imageConfig"]);wt!=null&&h(i,["imageConfig"],Tk(wt));let yi=f(e,["enableEnhancedCivicAnswers"]);if(yi!=null&&h(i,["enableEnhancedCivicAnswers"],yi),f(e,["modelArmorConfig"])!==void 0)throw new Error("modelArmorConfig parameter is not supported in Gemini API.");return i}function tk(n,e,t){let i={},r=f(e,["systemInstruction"]);t!==void 0&&r!=null&&h(t,["systemInstruction"],nn(r));let o=f(e,["temperature"]);o!=null&&h(i,["temperature"],o);let a=f(e,["topP"]);a!=null&&h(i,["topP"],a);let u=f(e,["topK"]);u!=null&&h(i,["topK"],u);let c=f(e,["candidateCount"]);c!=null&&h(i,["candidateCount"],c);let p=f(e,["maxOutputTokens"]);p!=null&&h(i,["maxOutputTokens"],p);let g=f(e,["stopSequences"]);g!=null&&h(i,["stopSequences"],g);let y=f(e,["responseLogprobs"]);y!=null&&h(i,["responseLogprobs"],y);let v=f(e,["logprobs"]);v!=null&&h(i,["logprobs"],v);let C=f(e,["presencePenalty"]);C!=null&&h(i,["presencePenalty"],C);let T=f(e,["frequencyPenalty"]);T!=null&&h(i,["frequencyPenalty"],T);let R=f(e,["seed"]);R!=null&&h(i,["seed"],R);let F=f(e,["responseMimeType"]);F!=null&&h(i,["responseMimeType"],F);let P=f(e,["responseSchema"]);P!=null&&h(i,["responseSchema"],c_(P));let H=f(e,["responseJsonSchema"]);H!=null&&h(i,["responseJsonSchema"],H);let q=f(e,["routingConfig"]);q!=null&&h(i,["routingConfig"],q);let Z=f(e,["modelSelectionConfig"]);Z!=null&&h(i,["modelConfig"],Z);let ie=f(e,["safetySettings"]);if(t!==void 0&&ie!=null){let Ni=ie;Array.isArray(Ni)&&(Ni=Ni.map(Vp=>Vp)),h(t,["safetySettings"],Ni)}let me=f(e,["tools"]);if(t!==void 0&&me!=null){let Ni=Ua(me);Array.isArray(Ni)&&(Ni=Ni.map(Vp=>X2(Ba(Vp)))),h(t,["tools"],Ni)}let de=f(e,["toolConfig"]);t!==void 0&&de!=null&&h(t,["toolConfig"],de);let $e=f(e,["labels"]);t!==void 0&&$e!=null&&h(t,["labels"],$e);let ge=f(e,["cachedContent"]);t!==void 0&&ge!=null&&h(t,["cachedContent"],tr(n,ge));let Me=f(e,["responseModalities"]);Me!=null&&h(i,["responseModalities"],Me);let wt=f(e,["mediaResolution"]);wt!=null&&h(i,["mediaResolution"],wt);let yi=f(e,["speechConfig"]);yi!=null&&h(i,["speechConfig"],m_(yi));let _t=f(e,["audioTimestamp"]);_t!=null&&h(i,["audioTimestamp"],_t);let _i=f(e,["thinkingConfig"]);_i!=null&&h(i,["thinkingConfig"],_i);let v_=f(e,["imageConfig"]);if(v_!=null&&h(i,["imageConfig"],Ik(v_)),f(e,["enableEnhancedCivicAnswers"])!==void 0)throw new Error("enableEnhancedCivicAnswers parameter is not supported in Vertex AI.");let C_=f(e,["modelArmorConfig"]);return t!==void 0&&C_!=null&&h(t,["modelArmorConfig"],C_),i}function g2(n,e){let t={},i=f(e,["model"]);i!=null&&h(t,["_url","model"],We(n,i));let r=f(e,["contents"]);if(r!=null){let a=jn(r);Array.isArray(a)&&(a=a.map(u=>op(u))),h(t,["contents"],a)}let o=f(e,["config"]);return o!=null&&h(t,["generationConfig"],ek(n,o,t)),t}function h2(n,e){let t={},i=f(e,["model"]);i!=null&&h(t,["_url","model"],We(n,i));let r=f(e,["contents"]);if(r!=null){let a=jn(r);Array.isArray(a)&&(a=a.map(u=>u)),h(t,["contents"],a)}let o=f(e,["config"]);return o!=null&&h(t,["generationConfig"],tk(n,o,t)),t}function y2(n){let e={},t=f(n,["sdkHttpResponse"]);t!=null&&h(e,["sdkHttpResponse"],t);let i=f(n,["candidates"]);if(i!=null){let c=i;Array.isArray(c)&&(c=c.map(p=>EP(p))),h(e,["candidates"],c)}let r=f(n,["modelVersion"]);r!=null&&h(e,["modelVersion"],r);let o=f(n,["promptFeedback"]);o!=null&&h(e,["promptFeedback"],o);let a=f(n,["responseId"]);a!=null&&h(e,["responseId"],a);let u=f(n,["usageMetadata"]);return u!=null&&h(e,["usageMetadata"],u),e}function _2(n){let e={},t=f(n,["sdkHttpResponse"]);t!=null&&h(e,["sdkHttpResponse"],t);let i=f(n,["candidates"]);if(i!=null){let p=i;Array.isArray(p)&&(p=p.map(g=>g)),h(e,["candidates"],p)}let r=f(n,["createTime"]);r!=null&&h(e,["createTime"],r);let o=f(n,["modelVersion"]);o!=null&&h(e,["modelVersion"],o);let a=f(n,["promptFeedback"]);a!=null&&h(e,["promptFeedback"],a);let u=f(n,["responseId"]);u!=null&&h(e,["responseId"],u);let c=f(n,["usageMetadata"]);return c!=null&&h(e,["usageMetadata"],c),e}function nk(n,e){let t={};if(f(n,["outputGcsUri"])!==void 0)throw new Error("outputGcsUri parameter is not supported in Gemini API.");if(f(n,["negativePrompt"])!==void 0)throw new Error("negativePrompt parameter is not supported in Gemini API.");let i=f(n,["numberOfImages"]);e!==void 0&&i!=null&&h(e,["parameters","sampleCount"],i);let r=f(n,["aspectRatio"]);e!==void 0&&r!=null&&h(e,["parameters","aspectRatio"],r);let o=f(n,["guidanceScale"]);if(e!==void 0&&o!=null&&h(e,["parameters","guidanceScale"],o),f(n,["seed"])!==void 0)throw new Error("seed parameter is not supported in Gemini API.");let a=f(n,["safetyFilterLevel"]);e!==void 0&&a!=null&&h(e,["parameters","safetySetting"],a);let u=f(n,["personGeneration"]);e!==void 0&&u!=null&&h(e,["parameters","personGeneration"],u);let c=f(n,["includeSafetyAttributes"]);e!==void 0&&c!=null&&h(e,["parameters","includeSafetyAttributes"],c);let p=f(n,["includeRaiReason"]);e!==void 0&&p!=null&&h(e,["parameters","includeRaiReason"],p);let g=f(n,["language"]);e!==void 0&&g!=null&&h(e,["parameters","language"],g);let y=f(n,["outputMimeType"]);e!==void 0&&y!=null&&h(e,["parameters","outputOptions","mimeType"],y);let v=f(n,["outputCompressionQuality"]);if(e!==void 0&&v!=null&&h(e,["parameters","outputOptions","compressionQuality"],v),f(n,["addWatermark"])!==void 0)throw new Error("addWatermark parameter is not supported in Gemini API.");if(f(n,["labels"])!==void 0)throw new Error("labels parameter is not supported in Gemini API.");let C=f(n,["imageSize"]);if(e!==void 0&&C!=null&&h(e,["parameters","sampleImageSize"],C),f(n,["enhancePrompt"])!==void 0)throw new Error("enhancePrompt parameter is not supported in Gemini API.");return t}function ik(n,e){let t={},i=f(n,["outputGcsUri"]);e!==void 0&&i!=null&&h(e,["parameters","storageUri"],i);let r=f(n,["negativePrompt"]);e!==void 0&&r!=null&&h(e,["parameters","negativePrompt"],r);let o=f(n,["numberOfImages"]);e!==void 0&&o!=null&&h(e,["parameters","sampleCount"],o);let a=f(n,["aspectRatio"]);e!==void 0&&a!=null&&h(e,["parameters","aspectRatio"],a);let u=f(n,["guidanceScale"]);e!==void 0&&u!=null&&h(e,["parameters","guidanceScale"],u);let c=f(n,["seed"]);e!==void 0&&c!=null&&h(e,["parameters","seed"],c);let p=f(n,["safetyFilterLevel"]);e!==void 0&&p!=null&&h(e,["parameters","safetySetting"],p);let g=f(n,["personGeneration"]);e!==void 0&&g!=null&&h(e,["parameters","personGeneration"],g);let y=f(n,["includeSafetyAttributes"]);e!==void 0&&y!=null&&h(e,["parameters","includeSafetyAttributes"],y);let v=f(n,["includeRaiReason"]);e!==void 0&&v!=null&&h(e,["parameters","includeRaiReason"],v);let C=f(n,["language"]);e!==void 0&&C!=null&&h(e,["parameters","language"],C);let T=f(n,["outputMimeType"]);e!==void 0&&T!=null&&h(e,["parameters","outputOptions","mimeType"],T);let R=f(n,["outputCompressionQuality"]);e!==void 0&&R!=null&&h(e,["parameters","outputOptions","compressionQuality"],R);let F=f(n,["addWatermark"]);e!==void 0&&F!=null&&h(e,["parameters","addWatermark"],F);let P=f(n,["labels"]);e!==void 0&&P!=null&&h(e,["labels"],P);let H=f(n,["imageSize"]);e!==void 0&&H!=null&&h(e,["parameters","sampleImageSize"],H);let q=f(n,["enhancePrompt"]);return e!==void 0&&q!=null&&h(e,["parameters","enhancePrompt"],q),t}function rk(n,e){let t={},i=f(e,["model"]);i!=null&&h(t,["_url","model"],We(n,i));let r=f(e,["prompt"]);r!=null&&h(t,["instances[0]","prompt"],r);let o=f(e,["config"]);return o!=null&&nk(o,t),t}function ok(n,e){let t={},i=f(e,["model"]);i!=null&&h(t,["_url","model"],We(n,i));let r=f(e,["prompt"]);r!=null&&h(t,["instances[0]","prompt"],r);let o=f(e,["config"]);return o!=null&&ik(o,t),t}function ak(n){let e={},t=f(n,["sdkHttpResponse"]);t!=null&&h(e,["sdkHttpResponse"],t);let i=f(n,["predictions"]);if(i!=null){let o=i;Array.isArray(o)&&(o=o.map(a=>_k(a))),h(e,["generatedImages"],o)}let r=f(n,["positivePromptSafetyAttributes"]);return r!=null&&h(e,["positivePromptSafetyAttributes"],Q2(r)),e}function sk(n){let e={},t=f(n,["sdkHttpResponse"]);t!=null&&h(e,["sdkHttpResponse"],t);let i=f(n,["predictions"]);if(i!=null){let o=i;Array.isArray(o)&&(o=o.map(a=>ap(a))),h(e,["generatedImages"],o)}let r=f(n,["positivePromptSafetyAttributes"]);return r!=null&&h(e,["positivePromptSafetyAttributes"],Z2(r)),e}function lk(n,e){let t={},i=f(n,["numberOfVideos"]);if(e!==void 0&&i!=null&&h(e,["parameters","sampleCount"],i),f(n,["outputGcsUri"])!==void 0)throw new Error("outputGcsUri parameter is not supported in Gemini API.");if(f(n,["fps"])!==void 0)throw new Error("fps parameter is not supported in Gemini API.");let r=f(n,["durationSeconds"]);if(e!==void 0&&r!=null&&h(e,["parameters","durationSeconds"],r),f(n,["seed"])!==void 0)throw new Error("seed parameter is not supported in Gemini API.");let o=f(n,["aspectRatio"]);e!==void 0&&o!=null&&h(e,["parameters","aspectRatio"],o);let a=f(n,["resolution"]);e!==void 0&&a!=null&&h(e,["parameters","resolution"],a);let u=f(n,["personGeneration"]);if(e!==void 0&&u!=null&&h(e,["parameters","personGeneration"],u),f(n,["pubsubTopic"])!==void 0)throw new Error("pubsubTopic parameter is not supported in Gemini API.");let c=f(n,["negativePrompt"]);e!==void 0&&c!=null&&h(e,["parameters","negativePrompt"],c);let p=f(n,["enhancePrompt"]);if(e!==void 0&&p!=null&&h(e,["parameters","enhancePrompt"],p),f(n,["generateAudio"])!==void 0)throw new Error("generateAudio parameter is not supported in Gemini API.");let g=f(n,["lastFrame"]);e!==void 0&&g!=null&&h(e,["instances[0]","lastFrame"],sp(g));let y=f(n,["referenceImages"]);if(e!==void 0&&y!=null){let v=y;Array.isArray(v)&&(v=v.map(C=>d8(C))),h(e,["instances[0]","referenceImages"],v)}if(f(n,["mask"])!==void 0)throw new Error("mask parameter is not supported in Gemini API.");if(f(n,["compressionQuality"])!==void 0)throw new Error("compressionQuality parameter is not supported in Gemini API.");return t}function uk(n,e){let t={},i=f(n,["numberOfVideos"]);e!==void 0&&i!=null&&h(e,["parameters","sampleCount"],i);let r=f(n,["outputGcsUri"]);e!==void 0&&r!=null&&h(e,["parameters","storageUri"],r);let o=f(n,["fps"]);e!==void 0&&o!=null&&h(e,["parameters","fps"],o);let a=f(n,["durationSeconds"]);e!==void 0&&a!=null&&h(e,["parameters","durationSeconds"],a);let u=f(n,["seed"]);e!==void 0&&u!=null&&h(e,["parameters","seed"],u);let c=f(n,["aspectRatio"]);e!==void 0&&c!=null&&h(e,["parameters","aspectRatio"],c);let p=f(n,["resolution"]);e!==void 0&&p!=null&&h(e,["parameters","resolution"],p);let g=f(n,["personGeneration"]);e!==void 0&&g!=null&&h(e,["parameters","personGeneration"],g);let y=f(n,["pubsubTopic"]);e!==void 0&&y!=null&&h(e,["parameters","pubsubTopic"],y);let v=f(n,["negativePrompt"]);e!==void 0&&v!=null&&h(e,["parameters","negativePrompt"],v);let C=f(n,["enhancePrompt"]);e!==void 0&&C!=null&&h(e,["parameters","enhancePrompt"],C);let T=f(n,["generateAudio"]);e!==void 0&&T!=null&&h(e,["parameters","generateAudio"],T);let R=f(n,["lastFrame"]);e!==void 0&&R!=null&&h(e,["instances[0]","lastFrame"],hi(R));let F=f(n,["referenceImages"]);if(e!==void 0&&F!=null){let q=F;Array.isArray(q)&&(q=q.map(Z=>c8(Z))),h(e,["instances[0]","referenceImages"],q)}let P=f(n,["mask"]);e!==void 0&&P!=null&&h(e,["instances[0]","mask"],u8(P));let H=f(n,["compressionQuality"]);return e!==void 0&&H!=null&&h(e,["parameters","compressionQuality"],H),t}function dk(n){let e={},t=f(n,["name"]);t!=null&&h(e,["name"],t);let i=f(n,["metadata"]);i!=null&&h(e,["metadata"],i);let r=f(n,["done"]);r!=null&&h(e,["done"],r);let o=f(n,["error"]);o!=null&&h(e,["error"],o);let a=f(n,["response","generateVideoResponse"]);return a!=null&&h(e,["response"],fk(a)),e}function ck(n){let e={},t=f(n,["name"]);t!=null&&h(e,["name"],t);let i=f(n,["metadata"]);i!=null&&h(e,["metadata"],i);let r=f(n,["done"]);r!=null&&h(e,["done"],r);let o=f(n,["error"]);o!=null&&h(e,["error"],o);let a=f(n,["response"]);return a!=null&&h(e,["response"],gk(a)),e}function mk(n,e){let t={},i=f(e,["model"]);i!=null&&h(t,["_url","model"],We(n,i));let r=f(e,["prompt"]);r!=null&&h(t,["instances[0]","prompt"],r);let o=f(e,["image"]);o!=null&&h(t,["instances[0]","image"],sp(o));let a=f(e,["video"]);a!=null&&h(t,["instances[0]","video"],eS(a));let u=f(e,["source"]);u!=null&&hk(u,t);let c=f(e,["config"]);return c!=null&&lk(c,t),t}function pk(n,e){let t={},i=f(e,["model"]);i!=null&&h(t,["_url","model"],We(n,i));let r=f(e,["prompt"]);r!=null&&h(t,["instances[0]","prompt"],r);let o=f(e,["image"]);o!=null&&h(t,["instances[0]","image"],hi(o));let a=f(e,["video"]);a!=null&&h(t,["instances[0]","video"],tS(a));let u=f(e,["source"]);u!=null&&yk(u,t);let c=f(e,["config"]);return c!=null&&uk(c,t),t}function fk(n){let e={},t=f(n,["generatedSamples"]);if(t!=null){let o=t;Array.isArray(o)&&(o=o.map(a=>Ck(a))),h(e,["generatedVideos"],o)}let i=f(n,["raiMediaFilteredCount"]);i!=null&&h(e,["raiMediaFilteredCount"],i);let r=f(n,["raiMediaFilteredReasons"]);return r!=null&&h(e,["raiMediaFilteredReasons"],r),e}function gk(n){let e={},t=f(n,["videos"]);if(t!=null){let o=t;Array.isArray(o)&&(o=o.map(a=>xk(a))),h(e,["generatedVideos"],o)}let i=f(n,["raiMediaFilteredCount"]);i!=null&&h(e,["raiMediaFilteredCount"],i);let r=f(n,["raiMediaFilteredReasons"]);return r!=null&&h(e,["raiMediaFilteredReasons"],r),e}function hk(n,e){let t={},i=f(n,["prompt"]);e!==void 0&&i!=null&&h(e,["instances[0]","prompt"],i);let r=f(n,["image"]);e!==void 0&&r!=null&&h(e,["instances[0]","image"],sp(r));let o=f(n,["video"]);return e!==void 0&&o!=null&&h(e,["instances[0]","video"],eS(o)),t}function yk(n,e){let t={},i=f(n,["prompt"]);e!==void 0&&i!=null&&h(e,["instances[0]","prompt"],i);let r=f(n,["image"]);e!==void 0&&r!=null&&h(e,["instances[0]","image"],hi(r));let o=f(n,["video"]);return e!==void 0&&o!=null&&h(e,["instances[0]","video"],tS(o)),t}function _k(n){let e={},t=f(n,["_self"]);t!=null&&h(e,["image"],Mk(t));let i=f(n,["raiFilteredReason"]);i!=null&&h(e,["raiFilteredReason"],i);let r=f(n,["_self"]);return r!=null&&h(e,["safetyAttributes"],Q2(r)),e}function ap(n){let e={},t=f(n,["_self"]);t!=null&&h(e,["image"],K2(t));let i=f(n,["raiFilteredReason"]);i!=null&&h(e,["raiFilteredReason"],i);let r=f(n,["_self"]);r!=null&&h(e,["safetyAttributes"],Z2(r));let o=f(n,["prompt"]);return o!=null&&h(e,["enhancedPrompt"],o),e}function vk(n){let e={},t=f(n,["_self"]);t!=null&&h(e,["mask"],K2(t));let i=f(n,["labels"]);if(i!=null){let r=i;Array.isArray(r)&&(r=r.map(o=>o)),h(e,["labels"],r)}return e}function Ck(n){let e={},t=f(n,["video"]);return t!=null&&h(e,["video"],s8(t)),e}function xk(n){let e={},t=f(n,["_self"]);return t!=null&&h(e,["video"],l8(t)),e}function bk(n){let e={},t=f(n,["modelSelectionConfig"]);t!=null&&h(e,["modelConfig"],t);let i=f(n,["responseJsonSchema"]);i!=null&&h(e,["responseJsonSchema"],i);let r=f(n,["audioTimestamp"]);r!=null&&h(e,["audioTimestamp"],r);let o=f(n,["candidateCount"]);o!=null&&h(e,["candidateCount"],o);let a=f(n,["enableAffectiveDialog"]);a!=null&&h(e,["enableAffectiveDialog"],a);let u=f(n,["frequencyPenalty"]);u!=null&&h(e,["frequencyPenalty"],u);let c=f(n,["logprobs"]);c!=null&&h(e,["logprobs"],c);let p=f(n,["maxOutputTokens"]);p!=null&&h(e,["maxOutputTokens"],p);let g=f(n,["mediaResolution"]);g!=null&&h(e,["mediaResolution"],g);let y=f(n,["presencePenalty"]);y!=null&&h(e,["presencePenalty"],y);let v=f(n,["responseLogprobs"]);v!=null&&h(e,["responseLogprobs"],v);let C=f(n,["responseMimeType"]);C!=null&&h(e,["responseMimeType"],C);let T=f(n,["responseModalities"]);T!=null&&h(e,["responseModalities"],T);let R=f(n,["responseSchema"]);R!=null&&h(e,["responseSchema"],R);let F=f(n,["routingConfig"]);F!=null&&h(e,["routingConfig"],F);let P=f(n,["seed"]);P!=null&&h(e,["seed"],P);let H=f(n,["speechConfig"]);H!=null&&h(e,["speechConfig"],H);let q=f(n,["stopSequences"]);q!=null&&h(e,["stopSequences"],q);let Z=f(n,["temperature"]);Z!=null&&h(e,["temperature"],Z);let ie=f(n,["thinkingConfig"]);ie!=null&&h(e,["thinkingConfig"],ie);let me=f(n,["topK"]);me!=null&&h(e,["topK"],me);let de=f(n,["topP"]);if(de!=null&&h(e,["topP"],de),f(n,["enableEnhancedCivicAnswers"])!==void 0)throw new Error("enableEnhancedCivicAnswers parameter is not supported in Vertex AI.");return e}function Ek(n,e){let t={},i=f(e,["model"]);return i!=null&&h(t,["_url","name"],We(n,i)),t}function Sk(n,e){let t={},i=f(e,["model"]);return i!=null&&h(t,["_url","name"],We(n,i)),t}function Dk(n){let e={};if(f(n,["authConfig"])!==void 0)throw new Error("authConfig parameter is not supported in Gemini API.");let t=f(n,["enableWidget"]);return t!=null&&h(e,["enableWidget"],t),e}function wk(n){let e={};if(f(n,["excludeDomains"])!==void 0)throw new Error("excludeDomains parameter is not supported in Gemini API.");if(f(n,["blockingConfidence"])!==void 0)throw new Error("blockingConfidence parameter is not supported in Gemini API.");let t=f(n,["timeRangeFilter"]);return t!=null&&h(e,["timeRangeFilter"],t),e}function Tk(n){let e={},t=f(n,["aspectRatio"]);t!=null&&h(e,["aspectRatio"],t);let i=f(n,["imageSize"]);if(i!=null&&h(e,["imageSize"],i),f(n,["personGeneration"])!==void 0)throw new Error("personGeneration parameter is not supported in Gemini API.");if(f(n,["outputMimeType"])!==void 0)throw new Error("outputMimeType parameter is not supported in Gemini API.");if(f(n,["outputCompressionQuality"])!==void 0)throw new Error("outputCompressionQuality parameter is not supported in Gemini API.");return e}function Ik(n){let e={},t=f(n,["aspectRatio"]);t!=null&&h(e,["aspectRatio"],t);let i=f(n,["imageSize"]);i!=null&&h(e,["imageSize"],i);let r=f(n,["personGeneration"]);r!=null&&h(e,["personGeneration"],r);let o=f(n,["outputMimeType"]);o!=null&&h(e,["imageOutputOptions","mimeType"],o);let a=f(n,["outputCompressionQuality"]);return a!=null&&h(e,["imageOutputOptions","compressionQuality"],a),e}function Mk(n){let e={},t=f(n,["bytesBase64Encoded"]);t!=null&&h(e,["imageBytes"],Ir(t));let i=f(n,["mimeType"]);return i!=null&&h(e,["mimeType"],i),e}function K2(n){let e={},t=f(n,["gcsUri"]);t!=null&&h(e,["gcsUri"],t);let i=f(n,["bytesBase64Encoded"]);i!=null&&h(e,["imageBytes"],Ir(i));let r=f(n,["mimeType"]);return r!=null&&h(e,["mimeType"],r),e}function sp(n){let e={};if(f(n,["gcsUri"])!==void 0)throw new Error("gcsUri parameter is not supported in Gemini API.");let t=f(n,["imageBytes"]);t!=null&&h(e,["bytesBase64Encoded"],Ir(t));let i=f(n,["mimeType"]);return i!=null&&h(e,["mimeType"],i),e}function hi(n){let e={},t=f(n,["gcsUri"]);t!=null&&h(e,["gcsUri"],t);let i=f(n,["imageBytes"]);i!=null&&h(e,["bytesBase64Encoded"],Ir(i));let r=f(n,["mimeType"]);return r!=null&&h(e,["mimeType"],r),e}function Ak(n,e,t){let i={},r=f(e,["pageSize"]);t!==void 0&&r!=null&&h(t,["_query","pageSize"],r);let o=f(e,["pageToken"]);t!==void 0&&o!=null&&h(t,["_query","pageToken"],o);let a=f(e,["filter"]);t!==void 0&&a!=null&&h(t,["_query","filter"],a);let u=f(e,["queryBase"]);return t!==void 0&&u!=null&&h(t,["_url","models_url"],G2(n,u)),i}function Rk(n,e,t){let i={},r=f(e,["pageSize"]);t!==void 0&&r!=null&&h(t,["_query","pageSize"],r);let o=f(e,["pageToken"]);t!==void 0&&o!=null&&h(t,["_query","pageToken"],o);let a=f(e,["filter"]);t!==void 0&&a!=null&&h(t,["_query","filter"],a);let u=f(e,["queryBase"]);return t!==void 0&&u!=null&&h(t,["_url","models_url"],G2(n,u)),i}function Nk(n,e){let t={},i=f(e,["config"]);return i!=null&&Ak(n,i,t),t}function Fk(n,e){let t={},i=f(e,["config"]);return i!=null&&Rk(n,i,t),t}function Pk(n){let e={},t=f(n,["sdkHttpResponse"]);t!=null&&h(e,["sdkHttpResponse"],t);let i=f(n,["nextPageToken"]);i!=null&&h(e,["nextPageToken"],i);let r=f(n,["_self"]);if(r!=null){let o=q2(r);Array.isArray(o)&&(o=o.map(a=>ky(a))),h(e,["models"],o)}return e}function kk(n){let e={},t=f(n,["sdkHttpResponse"]);t!=null&&h(e,["sdkHttpResponse"],t);let i=f(n,["nextPageToken"]);i!=null&&h(e,["nextPageToken"],i);let r=f(n,["_self"]);if(r!=null){let o=q2(r);Array.isArray(o)&&(o=o.map(a=>Vy(a))),h(e,["models"],o)}return e}function Vk(n){let e={},t=f(n,["maskMode"]);t!=null&&h(e,["maskMode"],t);let i=f(n,["segmentationClasses"]);i!=null&&h(e,["maskClasses"],i);let r=f(n,["maskDilation"]);return r!=null&&h(e,["dilation"],r),e}function ky(n){let e={},t=f(n,["name"]);t!=null&&h(e,["name"],t);let i=f(n,["displayName"]);i!=null&&h(e,["displayName"],i);let r=f(n,["description"]);r!=null&&h(e,["description"],r);let o=f(n,["version"]);o!=null&&h(e,["version"],o);let a=f(n,["_self"]);a!=null&&h(e,["tunedModelInfo"],Zk(a));let u=f(n,["inputTokenLimit"]);u!=null&&h(e,["inputTokenLimit"],u);let c=f(n,["outputTokenLimit"]);c!=null&&h(e,["outputTokenLimit"],c);let p=f(n,["supportedGenerationMethods"]);p!=null&&h(e,["supportedActions"],p);let g=f(n,["temperature"]);g!=null&&h(e,["temperature"],g);let y=f(n,["maxTemperature"]);y!=null&&h(e,["maxTemperature"],y);let v=f(n,["topP"]);v!=null&&h(e,["topP"],v);let C=f(n,["topK"]);C!=null&&h(e,["topK"],C);let T=f(n,["thinking"]);return T!=null&&h(e,["thinking"],T),e}function Vy(n){let e={},t=f(n,["name"]);t!=null&&h(e,["name"],t);let i=f(n,["displayName"]);i!=null&&h(e,["displayName"],i);let r=f(n,["description"]);r!=null&&h(e,["description"],r);let o=f(n,["versionId"]);o!=null&&h(e,["version"],o);let a=f(n,["deployedModels"]);if(a!=null){let y=a;Array.isArray(y)&&(y=y.map(v=>JP(v))),h(e,["endpoints"],y)}let u=f(n,["labels"]);u!=null&&h(e,["labels"],u);let c=f(n,["_self"]);c!=null&&h(e,["tunedModelInfo"],Xk(c));let p=f(n,["defaultCheckpointId"]);p!=null&&h(e,["defaultCheckpointId"],p);let g=f(n,["checkpoints"]);if(g!=null){let y=g;Array.isArray(y)&&(y=y.map(v=>v)),h(e,["checkpoints"],y)}return e}function Lk(n){let e={},t=f(n,["mediaResolution"]);t!=null&&h(e,["mediaResolution"],t);let i=f(n,["codeExecutionResult"]);i!=null&&h(e,["codeExecutionResult"],i);let r=f(n,["executableCode"]);r!=null&&h(e,["executableCode"],r);let o=f(n,["fileData"]);o!=null&&h(e,["fileData"],KP(o));let a=f(n,["functionCall"]);a!=null&&h(e,["functionCall"],QP(a));let u=f(n,["functionResponse"]);u!=null&&h(e,["functionResponse"],u);let c=f(n,["inlineData"]);c!=null&&h(e,["inlineData"],bP(c));let p=f(n,["text"]);p!=null&&h(e,["text"],p);let g=f(n,["thought"]);g!=null&&h(e,["thought"],g);let y=f(n,["thoughtSignature"]);y!=null&&h(e,["thoughtSignature"],y);let v=f(n,["videoMetadata"]);return v!=null&&h(e,["videoMetadata"],v),e}function Ok(n){let e={},t=f(n,["productImage"]);return t!=null&&h(e,["image"],hi(t)),e}function Bk(n,e){let t={},i=f(n,["numberOfImages"]);e!==void 0&&i!=null&&h(e,["parameters","sampleCount"],i);let r=f(n,["baseSteps"]);e!==void 0&&r!=null&&h(e,["parameters","baseSteps"],r);let o=f(n,["outputGcsUri"]);e!==void 0&&o!=null&&h(e,["parameters","storageUri"],o);let a=f(n,["seed"]);e!==void 0&&a!=null&&h(e,["parameters","seed"],a);let u=f(n,["safetyFilterLevel"]);e!==void 0&&u!=null&&h(e,["parameters","safetySetting"],u);let c=f(n,["personGeneration"]);e!==void 0&&c!=null&&h(e,["parameters","personGeneration"],c);let p=f(n,["addWatermark"]);e!==void 0&&p!=null&&h(e,["parameters","addWatermark"],p);let g=f(n,["outputMimeType"]);e!==void 0&&g!=null&&h(e,["parameters","outputOptions","mimeType"],g);let y=f(n,["outputCompressionQuality"]);e!==void 0&&y!=null&&h(e,["parameters","outputOptions","compressionQuality"],y);let v=f(n,["enhancePrompt"]);e!==void 0&&v!=null&&h(e,["parameters","enhancePrompt"],v);let C=f(n,["labels"]);return e!==void 0&&C!=null&&h(e,["labels"],C),t}function Uk(n,e){let t={},i=f(e,["model"]);i!=null&&h(t,["_url","model"],We(n,i));let r=f(e,["source"]);r!=null&&Hk(r,t);let o=f(e,["config"]);return o!=null&&Bk(o,t),t}function $k(n){let e={},t=f(n,["predictions"]);if(t!=null){let i=t;Array.isArray(i)&&(i=i.map(r=>ap(r))),h(e,["generatedImages"],i)}return e}function Hk(n,e){let t={},i=f(n,["prompt"]);e!==void 0&&i!=null&&h(e,["instances[0]","prompt"],i);let r=f(n,["personImage"]);e!==void 0&&r!=null&&h(e,["instances[0]","personImage","image"],hi(r));let o=f(n,["productImages"]);if(e!==void 0&&o!=null){let a=o;Array.isArray(a)&&(a=a.map(u=>Ok(u))),h(e,["instances[0]","productImages"],a)}return t}function Gk(n){let e={},t=f(n,["referenceImage"]);t!=null&&h(e,["referenceImage"],hi(t));let i=f(n,["referenceId"]);i!=null&&h(e,["referenceId"],i);let r=f(n,["referenceType"]);r!=null&&h(e,["referenceType"],r);let o=f(n,["maskImageConfig"]);o!=null&&h(e,["maskImageConfig"],Vk(o));let a=f(n,["controlImageConfig"]);a!=null&&h(e,["controlImageConfig"],MP(a));let u=f(n,["styleImageConfig"]);u!=null&&h(e,["styleImageConfig"],u);let c=f(n,["subjectImageConfig"]);return c!=null&&h(e,["subjectImageConfig"],c),e}function Q2(n){let e={},t=f(n,["safetyAttributes","categories"]);t!=null&&h(e,["categories"],t);let i=f(n,["safetyAttributes","scores"]);i!=null&&h(e,["scores"],i);let r=f(n,["contentType"]);return r!=null&&h(e,["contentType"],r),e}function Z2(n){let e={},t=f(n,["safetyAttributes","categories"]);t!=null&&h(e,["categories"],t);let i=f(n,["safetyAttributes","scores"]);i!=null&&h(e,["scores"],i);let r=f(n,["contentType"]);return r!=null&&h(e,["contentType"],r),e}function qk(n){let e={},t=f(n,["category"]);if(t!=null&&h(e,["category"],t),f(n,["method"])!==void 0)throw new Error("method parameter is not supported in Gemini API.");let i=f(n,["threshold"]);return i!=null&&h(e,["threshold"],i),e}function Wk(n){let e={},t=f(n,["image"]);return t!=null&&h(e,["image"],hi(t)),e}function jk(n,e){let t={},i=f(n,["mode"]);e!==void 0&&i!=null&&h(e,["parameters","mode"],i);let r=f(n,["maxPredictions"]);e!==void 0&&r!=null&&h(e,["parameters","maxPredictions"],r);let o=f(n,["confidenceThreshold"]);e!==void 0&&o!=null&&h(e,["parameters","confidenceThreshold"],o);let a=f(n,["maskDilation"]);e!==void 0&&a!=null&&h(e,["parameters","maskDilation"],a);let u=f(n,["binaryColorThreshold"]);e!==void 0&&u!=null&&h(e,["parameters","binaryColorThreshold"],u);let c=f(n,["labels"]);return e!==void 0&&c!=null&&h(e,["labels"],c),t}function zk(n,e){let t={},i=f(e,["model"]);i!=null&&h(t,["_url","model"],We(n,i));let r=f(e,["source"]);r!=null&&Jk(r,t);let o=f(e,["config"]);return o!=null&&jk(o,t),t}function Yk(n){let e={},t=f(n,["predictions"]);if(t!=null){let i=t;Array.isArray(i)&&(i=i.map(r=>vk(r))),h(e,["generatedMasks"],i)}return e}function Jk(n,e){let t={},i=f(n,["prompt"]);e!==void 0&&i!=null&&h(e,["instances[0]","prompt"],i);let r=f(n,["image"]);e!==void 0&&r!=null&&h(e,["instances[0]","image"],hi(r));let o=f(n,["scribbleImage"]);return e!==void 0&&o!=null&&h(e,["instances[0]","scribble"],Wk(o)),t}function Kk(n){let e={},t=f(n,["retrievalConfig"]);t!=null&&h(e,["retrievalConfig"],t);let i=f(n,["functionCallingConfig"]);return i!=null&&h(e,["functionCallingConfig"],ZP(i)),e}function Qk(n){let e={};if(f(n,["retrieval"])!==void 0)throw new Error("retrieval parameter is not supported in Gemini API.");let t=f(n,["computerUse"]);t!=null&&h(e,["computerUse"],t);let i=f(n,["fileSearch"]);i!=null&&h(e,["fileSearch"],i);let r=f(n,["codeExecution"]);if(r!=null&&h(e,["codeExecution"],r),f(n,["enterpriseWebSearch"])!==void 0)throw new Error("enterpriseWebSearch parameter is not supported in Gemini API.");let o=f(n,["functionDeclarations"]);if(o!=null){let g=o;Array.isArray(g)&&(g=g.map(y=>y)),h(e,["functionDeclarations"],g)}let a=f(n,["googleMaps"]);a!=null&&h(e,["googleMaps"],Dk(a));let u=f(n,["googleSearch"]);u!=null&&h(e,["googleSearch"],wk(u));let c=f(n,["googleSearchRetrieval"]);c!=null&&h(e,["googleSearchRetrieval"],c);let p=f(n,["urlContext"]);return p!=null&&h(e,["urlContext"],p),e}function X2(n){let e={},t=f(n,["retrieval"]);t!=null&&h(e,["retrieval"],t);let i=f(n,["computerUse"]);if(i!=null&&h(e,["computerUse"],i),f(n,["fileSearch"])!==void 0)throw new Error("fileSearch parameter is not supported in Vertex AI.");let r=f(n,["codeExecution"]);r!=null&&h(e,["codeExecution"],r);let o=f(n,["enterpriseWebSearch"]);o!=null&&h(e,["enterpriseWebSearch"],o);let a=f(n,["functionDeclarations"]);if(a!=null){let y=a;Array.isArray(y)&&(y=y.map(v=>XP(v))),h(e,["functionDeclarations"],y)}let u=f(n,["googleMaps"]);u!=null&&h(e,["googleMaps"],u);let c=f(n,["googleSearch"]);c!=null&&h(e,["googleSearch"],c);let p=f(n,["googleSearchRetrieval"]);p!=null&&h(e,["googleSearchRetrieval"],p);let g=f(n,["urlContext"]);return g!=null&&h(e,["urlContext"],g),e}function Zk(n){let e={},t=f(n,["baseModel"]);t!=null&&h(e,["baseModel"],t);let i=f(n,["createTime"]);i!=null&&h(e,["createTime"],i);let r=f(n,["updateTime"]);return r!=null&&h(e,["updateTime"],r),e}function Xk(n){let e={},t=f(n,["labels","google-vertex-llm-tuning-base-model-id"]);t!=null&&h(e,["baseModel"],t);let i=f(n,["createTime"]);i!=null&&h(e,["createTime"],i);let r=f(n,["updateTime"]);return r!=null&&h(e,["updateTime"],r),e}function e8(n,e){let t={},i=f(n,["displayName"]);e!==void 0&&i!=null&&h(e,["displayName"],i);let r=f(n,["description"]);e!==void 0&&r!=null&&h(e,["description"],r);let o=f(n,["defaultCheckpointId"]);return e!==void 0&&o!=null&&h(e,["defaultCheckpointId"],o),t}function t8(n,e){let t={},i=f(n,["displayName"]);e!==void 0&&i!=null&&h(e,["displayName"],i);let r=f(n,["description"]);e!==void 0&&r!=null&&h(e,["description"],r);let o=f(n,["defaultCheckpointId"]);return e!==void 0&&o!=null&&h(e,["defaultCheckpointId"],o),t}function n8(n,e){let t={},i=f(e,["model"]);i!=null&&h(t,["_url","name"],We(n,i));let r=f(e,["config"]);return r!=null&&e8(r,t),t}function i8(n,e){let t={},i=f(e,["model"]);i!=null&&h(t,["_url","model"],We(n,i));let r=f(e,["config"]);return r!=null&&t8(r,t),t}function r8(n,e){let t={},i=f(n,["outputGcsUri"]);e!==void 0&&i!=null&&h(e,["parameters","storageUri"],i);let r=f(n,["safetyFilterLevel"]);e!==void 0&&r!=null&&h(e,["parameters","safetySetting"],r);let o=f(n,["personGeneration"]);e!==void 0&&o!=null&&h(e,["parameters","personGeneration"],o);let a=f(n,["includeRaiReason"]);e!==void 0&&a!=null&&h(e,["parameters","includeRaiReason"],a);let u=f(n,["outputMimeType"]);e!==void 0&&u!=null&&h(e,["parameters","outputOptions","mimeType"],u);let c=f(n,["outputCompressionQuality"]);e!==void 0&&c!=null&&h(e,["parameters","outputOptions","compressionQuality"],c);let p=f(n,["enhanceInputImage"]);e!==void 0&&p!=null&&h(e,["parameters","upscaleConfig","enhanceInputImage"],p);let g=f(n,["imagePreservationFactor"]);e!==void 0&&g!=null&&h(e,["parameters","upscaleConfig","imagePreservationFactor"],g);let y=f(n,["labels"]);e!==void 0&&y!=null&&h(e,["labels"],y);let v=f(n,["numberOfImages"]);e!==void 0&&v!=null&&h(e,["parameters","sampleCount"],v);let C=f(n,["mode"]);return e!==void 0&&C!=null&&h(e,["parameters","mode"],C),t}function o8(n,e){let t={},i=f(e,["model"]);i!=null&&h(t,["_url","model"],We(n,i));let r=f(e,["image"]);r!=null&&h(t,["instances[0]","image"],hi(r));let o=f(e,["upscaleFactor"]);o!=null&&h(t,["parameters","upscaleConfig","upscaleFactor"],o);let a=f(e,["config"]);return a!=null&&r8(a,t),t}function a8(n){let e={},t=f(n,["sdkHttpResponse"]);t!=null&&h(e,["sdkHttpResponse"],t);let i=f(n,["predictions"]);if(i!=null){let r=i;Array.isArray(r)&&(r=r.map(o=>ap(o))),h(e,["generatedImages"],r)}return e}function s8(n){let e={},t=f(n,["uri"]);t!=null&&h(e,["uri"],t);let i=f(n,["encodedVideo"]);i!=null&&h(e,["videoBytes"],Ir(i));let r=f(n,["encoding"]);return r!=null&&h(e,["mimeType"],r),e}function l8(n){let e={},t=f(n,["gcsUri"]);t!=null&&h(e,["uri"],t);let i=f(n,["bytesBase64Encoded"]);i!=null&&h(e,["videoBytes"],Ir(i));let r=f(n,["mimeType"]);return r!=null&&h(e,["mimeType"],r),e}function u8(n){let e={},t=f(n,["image"]);t!=null&&h(e,["_self"],hi(t));let i=f(n,["maskMode"]);return i!=null&&h(e,["maskMode"],i),e}function d8(n){let e={},t=f(n,["image"]);t!=null&&h(e,["image"],sp(t));let i=f(n,["referenceType"]);return i!=null&&h(e,["referenceType"],i),e}function c8(n){let e={},t=f(n,["image"]);t!=null&&h(e,["image"],hi(t));let i=f(n,["referenceType"]);return i!=null&&h(e,["referenceType"],i),e}function eS(n){let e={},t=f(n,["uri"]);t!=null&&h(e,["uri"],t);let i=f(n,["videoBytes"]);i!=null&&h(e,["encodedVideo"],Ir(i));let r=f(n,["mimeType"]);return r!=null&&h(e,["encoding"],r),e}function tS(n){let e={},t=f(n,["uri"]);t!=null&&h(e,["gcsUri"],t);let i=f(n,["videoBytes"]);i!=null&&h(e,["bytesBase64Encoded"],Ir(i));let r=f(n,["mimeType"]);return r!=null&&h(e,["mimeType"],r),e}function m8(n,e){let t={},i=f(n,["displayName"]);return e!==void 0&&i!=null&&h(e,["displayName"],i),t}function p8(n){let e={},t=f(n,["config"]);return t!=null&&m8(t,e),e}function f8(n,e){let t={},i=f(n,["force"]);return e!==void 0&&i!=null&&h(e,["_query","force"],i),t}function g8(n){let e={},t=f(n,["name"]);t!=null&&h(e,["_url","name"],t);let i=f(n,["config"]);return i!=null&&f8(i,e),e}function h8(n){let e={},t=f(n,["name"]);return t!=null&&h(e,["_url","name"],t),e}function y8(n,e){let t={},i=f(n,["customMetadata"]);if(e!==void 0&&i!=null){let o=i;Array.isArray(o)&&(o=o.map(a=>a)),h(e,["customMetadata"],o)}let r=f(n,["chunkingConfig"]);return e!==void 0&&r!=null&&h(e,["chunkingConfig"],r),t}function _8(n){let e={},t=f(n,["name"]);t!=null&&h(e,["name"],t);let i=f(n,["metadata"]);i!=null&&h(e,["metadata"],i);let r=f(n,["done"]);r!=null&&h(e,["done"],r);let o=f(n,["error"]);o!=null&&h(e,["error"],o);let a=f(n,["response"]);return a!=null&&h(e,["response"],C8(a)),e}function v8(n){let e={},t=f(n,["fileSearchStoreName"]);t!=null&&h(e,["_url","file_search_store_name"],t);let i=f(n,["fileName"]);i!=null&&h(e,["fileName"],i);let r=f(n,["config"]);return r!=null&&y8(r,e),e}function C8(n){let e={},t=f(n,["sdkHttpResponse"]);t!=null&&h(e,["sdkHttpResponse"],t);let i=f(n,["parent"]);i!=null&&h(e,["parent"],i);let r=f(n,["documentName"]);return r!=null&&h(e,["documentName"],r),e}function x8(n,e){let t={},i=f(n,["pageSize"]);e!==void 0&&i!=null&&h(e,["_query","pageSize"],i);let r=f(n,["pageToken"]);return e!==void 0&&r!=null&&h(e,["_query","pageToken"],r),t}function b8(n){let e={},t=f(n,["config"]);return t!=null&&x8(t,e),e}function E8(n){let e={},t=f(n,["sdkHttpResponse"]);t!=null&&h(e,["sdkHttpResponse"],t);let i=f(n,["nextPageToken"]);i!=null&&h(e,["nextPageToken"],i);let r=f(n,["fileSearchStores"]);if(r!=null){let o=r;Array.isArray(o)&&(o=o.map(a=>a)),h(e,["fileSearchStores"],o)}return e}function nS(n,e){let t={},i=f(n,["mimeType"]);e!==void 0&&i!=null&&h(e,["mimeType"],i);let r=f(n,["displayName"]);e!==void 0&&r!=null&&h(e,["displayName"],r);let o=f(n,["customMetadata"]);if(e!==void 0&&o!=null){let u=o;Array.isArray(u)&&(u=u.map(c=>c)),h(e,["customMetadata"],u)}let a=f(n,["chunkingConfig"]);return e!==void 0&&a!=null&&h(e,["chunkingConfig"],a),t}function S8(n){let e={},t=f(n,["fileSearchStoreName"]);t!=null&&h(e,["_url","file_search_store_name"],t);let i=f(n,["config"]);return i!=null&&nS(i,e),e}function D8(n){let e={},t=f(n,["sdkHttpResponse"]);return t!=null&&h(e,["sdkHttpResponse"],t),e}var w8="Content-Type",T8="X-Server-Timeout",I8="User-Agent",Ly="x-goog-api-client",M8="1.38.0",A8=`google-genai-sdk/${M8}`,R8="v1beta1",N8="v1beta",Oy=class{constructor(e){var t,i,r;this.clientOptions=Object.assign({},e),this.customBaseUrl=(t=e.httpOptions)===null||t===void 0?void 0:t.baseUrl,this.clientOptions.vertexai&&(this.clientOptions.project&&this.clientOptions.location?this.clientOptions.apiKey=void 0:this.clientOptions.apiKey&&(this.clientOptions.project=void 0,this.clientOptions.location=void 0));let o={};if(this.clientOptions.vertexai){if(!this.clientOptions.location&&!this.clientOptions.apiKey&&!this.customBaseUrl&&(this.clientOptions.location="global"),!(this.clientOptions.project&&this.clientOptions.location||this.clientOptions.apiKey)&&!this.customBaseUrl)throw new Error("Authentication is not set up. Please provide either a project and location, or an API key, or a custom base URL.");let u=e.project&&e.location||!!e.apiKey;this.customBaseUrl&&!u?(o.baseUrl=this.customBaseUrl,this.clientOptions.project=void 0,this.clientOptions.location=void 0):this.clientOptions.apiKey||this.clientOptions.location==="global"?o.baseUrl="https://aiplatform.googleapis.com/":this.clientOptions.project&&this.clientOptions.location&&(o.baseUrl=`https://${this.clientOptions.location}-aiplatform.googleapis.com/`),o.apiVersion=(i=this.clientOptions.apiVersion)!==null&&i!==void 0?i:R8}else{if(!this.clientOptions.apiKey)throw new ru({message:"API key must be set when using the Gemini API.",status:403});o.apiVersion=(r=this.clientOptions.apiVersion)!==null&&r!==void 0?r:N8,o.baseUrl="https://generativelanguage.googleapis.com/"}o.headers=this.getDefaultHeaders(),this.clientOptions.httpOptions=o,e.httpOptions&&(this.clientOptions.httpOptions=this.patchHttpOptions(o,e.httpOptions))}isVertexAI(){var e;return(e=this.clientOptions.vertexai)!==null&&e!==void 0?e:!1}getProject(){return this.clientOptions.project}getLocation(){return this.clientOptions.location}getCustomBaseUrl(){return this.customBaseUrl}async getAuthHeaders(){let e=new Headers;return await this.clientOptions.auth.addAuthHeaders(e),e}getApiVersion(){if(this.clientOptions.httpOptions&&this.clientOptions.httpOptions.apiVersion!==void 0)return this.clientOptions.httpOptions.apiVersion;throw new Error("API version is not set.")}getBaseUrl(){if(this.clientOptions.httpOptions&&this.clientOptions.httpOptions.baseUrl!==void 0)return this.clientOptions.httpOptions.baseUrl;throw new Error("Base URL is not set.")}getRequestUrl(){return this.getRequestUrlInternal(this.clientOptions.httpOptions)}getHeaders(){if(this.clientOptions.httpOptions&&this.clientOptions.httpOptions.headers!==void 0)return this.clientOptions.httpOptions.headers;throw new Error("Headers are not set.")}getRequestUrlInternal(e){if(!e||e.baseUrl===void 0||e.apiVersion===void 0)throw new Error("HTTP options are not correctly set.");let i=[e.baseUrl.endsWith("/")?e.baseUrl.slice(0,-1):e.baseUrl];return e.apiVersion&&e.apiVersion!==""&&i.push(e.apiVersion),i.join("/")}getBaseResourcePath(){return`projects/${this.clientOptions.project}/locations/${this.clientOptions.location}`}getApiKey(){return this.clientOptions.apiKey}getWebsocketBaseUrl(){let e=this.getBaseUrl(),t=new URL(e);return t.protocol=t.protocol=="http:"?"ws":"wss",t.toString()}setBaseUrl(e){if(this.clientOptions.httpOptions)this.clientOptions.httpOptions.baseUrl=e;else throw new Error("HTTP options are not correctly set.")}constructUrl(e,t,i){let r=[this.getRequestUrlInternal(t)];return i&&r.push(this.getBaseResourcePath()),e!==""&&r.push(e),new URL(`${r.join("/")}`)}shouldPrependVertexProjectPath(e,t){return!(t.baseUrl&&t.baseUrlResourceScope===k2.COLLECTION||this.clientOptions.apiKey||!this.clientOptions.vertexai||e.path.startsWith("projects/")||e.httpMethod==="GET"&&e.path.startsWith("publishers/google/models"))}async request(e){let t=this.clientOptions.httpOptions;e.httpOptions&&(t=this.patchHttpOptions(this.clientOptions.httpOptions,e.httpOptions));let i=this.shouldPrependVertexProjectPath(e,t),r=this.constructUrl(e.path,t,i);if(e.queryParams)for(let[a,u]of Object.entries(e.queryParams))r.searchParams.append(a,String(u));let o={};if(e.httpMethod==="GET"){if(e.body&&e.body!=="{}")throw new Error("Request body should be empty for GET request, but got non empty request body")}else o.body=e.body;return o=await this.includeExtraHttpOptionsToRequestInit(o,t,r.toString(),e.abortSignal),this.unaryApiCall(r,o,e.httpMethod)}patchHttpOptions(e,t){let i=JSON.parse(JSON.stringify(e));for(let[r,o]of Object.entries(t))typeof o=="object"?i[r]=Object.assign(Object.assign({},i[r]),o):o!==void 0&&(i[r]=o);return i}async requestStream(e){let t=this.clientOptions.httpOptions;e.httpOptions&&(t=this.patchHttpOptions(this.clientOptions.httpOptions,e.httpOptions));let i=this.shouldPrependVertexProjectPath(e,t),r=this.constructUrl(e.path,t,i);(!r.searchParams.has("alt")||r.searchParams.get("alt")!=="sse")&&r.searchParams.set("alt","sse");let o={};return o.body=e.body,o=await this.includeExtraHttpOptionsToRequestInit(o,t,r.toString(),e.abortSignal),this.streamApiCall(r,o,e.httpMethod)}async includeExtraHttpOptionsToRequestInit(e,t,i,r){if(t&&t.timeout||r){let o=new AbortController,a=o.signal;if(t.timeout&&t?.timeout>0){let u=setTimeout(()=>o.abort(),t.timeout);u&&typeof u.unref=="function"&&u.unref()}r&&r.addEventListener("abort",()=>{o.abort()}),e.signal=a}return t&&t.extraBody!==null&&F8(e,t.extraBody),e.headers=await this.getHeadersInternal(t,i),e}async unaryApiCall(e,t,i){return this.apiCall(e.toString(),Object.assign(Object.assign({},t),{method:i})).then(async r=>(await v2(r),new iu(r))).catch(r=>{throw r instanceof Error?r:new Error(JSON.stringify(r))})}async streamApiCall(e,t,i){return this.apiCall(e.toString(),Object.assign(Object.assign({},t),{method:i})).then(async r=>(await v2(r),this.processStreamResponse(r))).catch(r=>{throw r instanceof Error?r:new Error(JSON.stringify(r))})}processStreamResponse(e){return pi(this,arguments,function*(){var i;let r=(i=e?.body)===null||i===void 0?void 0:i.getReader(),o=new TextDecoder("utf-8");if(!r)throw new Error("Response body is empty");try{let a="",u="data:",c=[`

`,"\r\r",`\r
\r
`];for(;;){let{done:p,value:g}=yield Ce(r.read());if(p){if(a.trim().length>0)throw new Error("Incomplete JSON segment at the end");break}let y=o.decode(g,{stream:!0});try{let T=JSON.parse(y);if("error"in T){let R=JSON.parse(JSON.stringify(T.error)),F=R.status,P=R.code,H=`got status: ${F}. ${JSON.stringify(T)}`;if(P>=400&&P<600)throw new ru({message:H,status:P})}}catch(T){if(T.name==="ApiError")throw T}a+=y;let v=-1,C=0;for(;;){v=-1,C=0;for(let F of c){let P=a.indexOf(F);P!==-1&&(v===-1||P<v)&&(v=P,C=F.length)}if(v===-1)break;let T=a.substring(0,v);a=a.substring(v+C);let R=T.trim();if(R.startsWith(u)){let F=R.substring(u.length).trim();try{let P=new Response(F,{headers:e?.headers,status:e?.status,statusText:e?.statusText});yield yield Ce(new iu(P))}catch(P){throw new Error(`exception parsing stream chunk ${F}. ${P}`)}}}}}finally{r.releaseLock()}})}async apiCall(e,t){return fetch(e,t).catch(i=>{throw new Error(`exception ${i} sending request`)})}getDefaultHeaders(){let e={},t=A8+" "+this.clientOptions.userAgentExtra;return e[I8]=t,e[Ly]=t,e[w8]="application/json",e}async getHeadersInternal(e,t){let i=new Headers;if(e&&e.headers){for(let[r,o]of Object.entries(e.headers))i.append(r,o);e.timeout&&e.timeout>0&&i.append(T8,String(Math.ceil(e.timeout/1e3)))}return await this.clientOptions.auth.addAuthHeaders(i,t),i}getFileName(e){var t;let i="";return typeof e=="string"&&(i=e.replace(/[/\\]+$/,""),i=(t=i.split(/[/\\]/).pop())!==null&&t!==void 0?t:""),i}async uploadFile(e,t){var i;let r={};t!=null&&(r.mimeType=t.mimeType,r.name=t.name,r.displayName=t.displayName),r.name&&!r.name.startsWith("files/")&&(r.name=`files/${r.name}`);let o=this.clientOptions.uploader,a=await o.stat(e);r.sizeBytes=String(a.size);let u=(i=t?.mimeType)!==null&&i!==void 0?i:a.type;if(u===void 0||u==="")throw new Error("Can not determine mimeType. Please provide mimeType in the config.");r.mimeType=u;let c={file:r},p=this.getFileName(e),g=te("upload/v1beta/files",c._url),y=await this.fetchUploadUrl(g,r.sizeBytes,r.mimeType,p,c,t?.httpOptions);return o.upload(e,y,this)}async uploadFileToFileSearchStore(e,t,i){var r;let o=this.clientOptions.uploader,a=await o.stat(t),u=String(a.size),c=(r=i?.mimeType)!==null&&r!==void 0?r:a.type;if(c===void 0||c==="")throw new Error("Can not determine mimeType. Please provide mimeType in the config.");let p=`upload/v1beta/${e}:uploadToFileSearchStore`,g=this.getFileName(t),y={};i!=null&&nS(i,y);let v=await this.fetchUploadUrl(p,u,c,g,y,i?.httpOptions);return o.uploadToFileSearchStore(t,v,this)}async downloadFile(e){await this.clientOptions.downloader.download(e,this)}async fetchUploadUrl(e,t,i,r,o,a){var u;let c={};a?c=a:c={apiVersion:"",headers:Object.assign({"Content-Type":"application/json","X-Goog-Upload-Protocol":"resumable","X-Goog-Upload-Command":"start","X-Goog-Upload-Header-Content-Length":`${t}`,"X-Goog-Upload-Header-Content-Type":`${i}`},r?{"X-Goog-Upload-File-Name":r}:{})};let p=await this.request({path:e,body:JSON.stringify(o),httpMethod:"POST",httpOptions:c});if(!p||!p?.headers)throw new Error("Server did not return an HttpResponse or the returned HttpResponse did not have headers.");let g=(u=p?.headers)===null||u===void 0?void 0:u["x-goog-upload-url"];if(g===void 0)throw new Error("Failed to get upload url. Server did not return the x-google-upload-url in the headers");return g}};async function v2(n){var e;if(n===void 0)throw new Error("response is undefined");if(!n.ok){let t=n.status,i;!((e=n.headers.get("content-type"))===null||e===void 0)&&e.includes("application/json")?i=await n.json():i={error:{message:await n.text(),code:n.status,status:n.statusText}};let r=JSON.stringify(i);throw t>=400&&t<600?new ru({message:r,status:t}):new Error(r)}}function F8(n,e){if(!e||Object.keys(e).length===0)return;if(n.body instanceof Blob){console.warn("includeExtraBodyToRequestInit: extraBody provided but current request body is a Blob. extraBody will be ignored as merging is not supported for Blob bodies.");return}let t={};if(typeof n.body=="string"&&n.body.length>0)try{let o=JSON.parse(n.body);if(typeof o=="object"&&o!==null&&!Array.isArray(o))t=o;else{console.warn("includeExtraBodyToRequestInit: Original request body is valid JSON but not a non-array object. Skip applying extraBody to the request body.");return}}catch{console.warn("includeExtraBodyToRequestInit: Original request body is not valid JSON. Skip applying extraBody to the request body.");return}function i(o,a){let u=Object.assign({},o);for(let c in a)if(Object.prototype.hasOwnProperty.call(a,c)){let p=a[c],g=u[c];p&&typeof p=="object"&&!Array.isArray(p)&&g&&typeof g=="object"&&!Array.isArray(g)?u[c]=i(g,p):(g&&p&&typeof g!=typeof p&&console.warn(`includeExtraBodyToRequestInit:deepMerge: Type mismatch for key "${c}". Original type: ${typeof g}, New type: ${typeof p}. Overwriting.`),u[c]=p)}return u}let r=i(t,e);n.body=JSON.stringify(r)}var P8="mcp_used/unknown",k8=!1;function iS(n){for(let e of n)if(V8(e)||typeof e=="object"&&"inputSchema"in e)return!0;return k8}function rS(n){var e;let t=(e=n[Ly])!==null&&e!==void 0?e:"";n[Ly]=(t+` ${P8}`).trimStart()}function V8(n){return n!==null&&typeof n=="object"&&n instanceof By}function L8(n){return pi(this,arguments,function*(t,i=100){let r,o=0;for(;o<i;){let a=yield Ce(t.listTools({cursor:r}));for(let u of a.tools)yield yield Ce(u),o++;if(!a.nextCursor)break;r=a.nextCursor}})}var By=class n{constructor(e=[],t){this.mcpTools=[],this.functionNameToMcpClient={},this.mcpClients=e,this.config=t}static create(e,t){return new n(e,t)}async initialize(){var e,t,i,r;if(this.mcpTools.length>0)return;let o={},a=[];for(let g of this.mcpClients)try{for(var u=!0,c=(t=void 0,fi(L8(g))),p;p=await c.next(),e=p.done,!e;u=!0){r=p.value,u=!1;let y=r;a.push(y);let v=y.name;if(o[v])throw new Error(`Duplicate function name ${v} found in MCP tools. Please ensure function names are unique.`);o[v]=g}}catch(y){t={error:y}}finally{try{!u&&!e&&(i=c.return)&&await i.call(c)}finally{if(t)throw t.error}}this.mcpTools=a,this.functionNameToMcpClient=o}async tool(){return await this.initialize(),CN(this.mcpTools,this.config)}async callTool(e){await this.initialize();let t=[];for(let i of e)if(i.name in this.functionNameToMcpClient){let r=this.functionNameToMcpClient[i.name],o;this.config.timeout&&(o={timeout:this.config.timeout});let a=await r.callTool({name:i.name,arguments:i.args},void 0,o);t.push({functionResponse:{name:i.name,response:a.isError?{error:a}:a}})}return t}};async function O8(n,e,t){let i=new wy,r;t.data instanceof Blob?r=JSON.parse(await t.data.text()):r=JSON.parse(t.data),Object.assign(i,r),e(i)}var Uy=class{constructor(e,t,i){this.apiClient=e,this.auth=t,this.webSocketFactory=i}async connect(e){var t,i;if(this.apiClient.isVertexAI())throw new Error("Live music is not supported for Vertex AI.");console.warn("Live music generation is experimental and may change in future versions.");let r=this.apiClient.getWebsocketBaseUrl(),o=this.apiClient.getApiVersion(),a=U8(this.apiClient.getDefaultHeaders()),u=this.apiClient.getApiKey(),c=`${r}/ws/google.ai.generativelanguage.${o}.GenerativeService.BidiGenerateMusic?key=${u}`,p=()=>{},g=new Promise(q=>{p=q}),y=e.callbacks,v=function(){p({})},C=this.apiClient,T={onopen:v,onmessage:q=>{O8(C,y.onmessage,q)},onerror:(t=y?.onerror)!==null&&t!==void 0?t:function(q){},onclose:(i=y?.onclose)!==null&&i!==void 0?i:function(q){}},R=this.webSocketFactory.create(c,B8(a),T);R.connect(),await g;let H={setup:{model:We(this.apiClient,e.model)}};return R.send(JSON.stringify(H)),new $y(R,this.apiClient)}},$y=class{constructor(e,t){this.conn=e,this.apiClient=t}async setWeightedPrompts(e){if(!e.weightedPrompts||Object.keys(e.weightedPrompts).length===0)throw new Error("Weighted prompts must be set and contain at least one entry.");let t=mP(e);this.conn.send(JSON.stringify({clientContent:t}))}async setMusicGenerationConfig(e){e.musicGenerationConfig||(e.musicGenerationConfig={});let t=cP(e);this.conn.send(JSON.stringify(t))}sendPlaybackControl(e){let t={playbackControl:e};this.conn.send(JSON.stringify(t))}play(){this.sendPlaybackControl(tu.PLAY)}pause(){this.sendPlaybackControl(tu.PAUSE)}stop(){this.sendPlaybackControl(tu.STOP)}resetContext(){this.sendPlaybackControl(tu.RESET_CONTEXT)}close(){this.conn.close()}};function B8(n){let e={};return n.forEach((t,i)=>{e[i]=t}),e}function U8(n){let e=new Headers;for(let[t,i]of Object.entries(n))e.append(t,i);return e}var $8="FunctionResponse request must have an `id` field from the response of a ToolCall.FunctionalCalls in Google AI.";async function H8(n,e,t){let i=new Dy,r;t.data instanceof Blob?r=await t.data.text():t.data instanceof ArrayBuffer?r=new TextDecoder().decode(t.data):r=t.data;let o=JSON.parse(r);if(n.isVertexAI()){let a=gP(o);Object.assign(i,a)}else Object.assign(i,o);e(i)}var Hy=class{constructor(e,t,i){this.apiClient=e,this.auth=t,this.webSocketFactory=i,this.music=new Uy(this.apiClient,this.auth,this.webSocketFactory)}async connect(e){var t,i,r,o,a,u;if(e.config&&e.config.httpOptions)throw new Error("The Live module does not support httpOptions at request-level in LiveConnectConfig yet. Please use the client-level httpOptions configuration instead.");let c=this.apiClient.getWebsocketBaseUrl(),p=this.apiClient.getApiVersion(),g,y=this.apiClient.getHeaders();e.config&&e.config.tools&&iS(e.config.tools)&&rS(y);let v=W8(y);if(this.apiClient.isVertexAI()){let ge=this.apiClient.getProject(),Me=this.apiClient.getLocation(),wt=this.apiClient.getApiKey(),yi=!!ge&&!!Me||!!wt;this.apiClient.getCustomBaseUrl()&&!yi?g=c:(g=`${c}/ws/google.cloud.aiplatform.${p}.LlmBidiService/BidiGenerateContent`,await this.auth.addAuthHeaders(v,g))}else{let ge=this.apiClient.getApiKey(),Me="BidiGenerateContent",wt="key";ge?.startsWith("auth_tokens/")&&(console.warn("Warning: Ephemeral token support is experimental and may change in future versions."),p!=="v1alpha"&&console.warn("Warning: The SDK's ephemeral token support is in v1alpha only. Please use const ai = new GoogleGenAI({apiKey: token.name, httpOptions: { apiVersion: 'v1alpha' }}); before session connection."),Me="BidiGenerateContentConstrained",wt="access_token"),g=`${c}/ws/google.ai.generativelanguage.${p}.GenerativeService.${Me}?${wt}=${ge}`}let C=()=>{},T=new Promise(ge=>{C=ge}),R=e.callbacks,F=function(){var ge;(ge=R?.onopen)===null||ge===void 0||ge.call(R),C({})},P=this.apiClient,H={onopen:F,onmessage:ge=>{H8(P,R.onmessage,ge)},onerror:(t=R?.onerror)!==null&&t!==void 0?t:function(ge){},onclose:(i=R?.onclose)!==null&&i!==void 0?i:function(ge){}},q=this.webSocketFactory.create(g,q8(v),H);q.connect(),await T;let Z=We(this.apiClient,e.model);if(this.apiClient.isVertexAI()&&Z.startsWith("publishers/")){let ge=this.apiClient.getProject(),Me=this.apiClient.getLocation();ge&&Me&&(Z=`projects/${ge}/locations/${Me}/`+Z)}let ie={};this.apiClient.isVertexAI()&&((r=e.config)===null||r===void 0?void 0:r.responseModalities)===void 0&&(e.config===void 0?e.config={responseModalities:[my.AUDIO]}:e.config.responseModalities=[my.AUDIO]),!((o=e.config)===null||o===void 0)&&o.generationConfig&&console.warn("Setting `LiveConnectConfig.generation_config` is deprecated, please set the fields on `LiveConnectConfig` directly. This will become an error in a future version (not before Q3 2025).");let me=(u=(a=e.config)===null||a===void 0?void 0:a.tools)!==null&&u!==void 0?u:[],de=[];for(let ge of me)if(this.isCallableTool(ge)){let Me=ge;de.push(await Me.tool())}else de.push(ge);de.length>0&&(e.config.tools=de);let $e={model:Z,config:e.config,callbacks:e.callbacks};return this.apiClient.isVertexAI()?ie=dP(this.apiClient,$e):ie=uP(this.apiClient,$e),delete ie.config,q.send(JSON.stringify(ie)),new Gy(q,this.apiClient)}isCallableTool(e){return"callTool"in e&&typeof e.callTool=="function"}},G8={turnComplete:!0},Gy=class{constructor(e,t){this.conn=e,this.apiClient=t}tLiveClientContent(e,t){if(t.turns!==null&&t.turns!==void 0){let i=[];try{i=jn(t.turns),e.isVertexAI()||(i=i.map(r=>op(r)))}catch{throw new Error(`Failed to parse client content "turns", type: '${typeof t.turns}'`)}return{clientContent:{turns:i,turnComplete:t.turnComplete}}}return{clientContent:{turnComplete:t.turnComplete}}}tLiveClienttToolResponse(e,t){let i=[];if(t.functionResponses==null)throw new Error("functionResponses is required.");if(Array.isArray(t.functionResponses)?i=t.functionResponses:i=[t.functionResponses],i.length===0)throw new Error("functionResponses is required.");for(let o of i){if(typeof o!="object"||o===null||!("name"in o)||!("response"in o))throw new Error(`Could not parse function response, type '${typeof o}'.`);if(!e.isVertexAI()&&!("id"in o))throw new Error($8)}return{toolResponse:{functionResponses:i}}}sendClientContent(e){e=Object.assign(Object.assign({},G8),e);let t=this.tLiveClientContent(this.apiClient,e);this.conn.send(JSON.stringify(t))}sendRealtimeInput(e){let t={};this.apiClient.isVertexAI()?t={realtimeInput:fP(e)}:t={realtimeInput:pP(e)},this.conn.send(JSON.stringify(t))}sendToolResponse(e){if(e.functionResponses==null)throw new Error("Tool response parameters are required.");let t=this.tLiveClienttToolResponse(this.apiClient,e);this.conn.send(JSON.stringify(t))}close(){this.conn.close()}};function q8(n){let e={};return n.forEach((t,i)=>{e[i]=t}),e}function W8(n){let e=new Headers;for(let[t,i]of Object.entries(n))e.append(t,i);return e}var C2=10;function x2(n){var e,t,i;if(!((e=n?.automaticFunctionCalling)===null||e===void 0)&&e.disable)return!0;let r=!1;for(let a of(t=n?.tools)!==null&&t!==void 0?t:[])if(Va(a)){r=!0;break}if(!r)return!0;let o=(i=n?.automaticFunctionCalling)===null||i===void 0?void 0:i.maximumRemoteCalls;return o&&(o<0||!Number.isInteger(o))||o==0?(console.warn("Invalid maximumRemoteCalls value provided for automatic function calling. Disabled automatic function calling. Please provide a valid integer value greater than 0. maximumRemoteCalls provided:",o),!0):!1}function Va(n){return"callTool"in n&&typeof n.callTool=="function"}function j8(n){var e,t,i;return(i=(t=(e=n.config)===null||e===void 0?void 0:e.tools)===null||t===void 0?void 0:t.some(r=>Va(r)))!==null&&i!==void 0?i:!1}function b2(n){var e;let t=[];return!((e=n?.config)===null||e===void 0)&&e.tools&&n.config.tools.forEach((i,r)=>{if(Va(i))return;let o=i;o.functionDeclarations&&o.functionDeclarations.length>0&&t.push(r)}),t}function E2(n){var e;return!(!((e=n?.automaticFunctionCalling)===null||e===void 0)&&e.ignoreCallHistory)}var qy=class extends gi{constructor(e){super(),this.apiClient=e,this.generateContent=async t=>{var i,r,o,a,u;let c=await this.processParamsMaybeAddMcpUsage(t);if(this.maybeMoveToResponseJsonSchem(t),!j8(t)||x2(t.config))return await this.generateContentInternal(c);let p=b2(t);if(p.length>0){let R=p.map(F=>`tools[${F}]`).join(", ");throw new Error(`Automatic function calling with CallableTools (or MCP objects) and basic FunctionDeclarations is not yet supported. Incompatible tools found at ${R}.`)}let g,y,v=jn(c.contents),C=(o=(r=(i=c.config)===null||i===void 0?void 0:i.automaticFunctionCalling)===null||r===void 0?void 0:r.maximumRemoteCalls)!==null&&o!==void 0?o:C2,T=0;for(;T<C&&(g=await this.generateContentInternal(c),!(!g.functionCalls||g.functionCalls.length===0));){let R=g.candidates[0].content,F=[];for(let P of(u=(a=t.config)===null||a===void 0?void 0:a.tools)!==null&&u!==void 0?u:[])if(Va(P)){let q=await P.callTool(g.functionCalls);F.push(...q)}T++,y={role:"user",parts:F},c.contents=jn(c.contents),c.contents.push(R),c.contents.push(y),E2(c.config)&&(v.push(R),v.push(y))}return E2(c.config)&&(g.automaticFunctionCallingHistory=v),g},this.generateContentStream=async t=>{var i,r,o,a,u;if(this.maybeMoveToResponseJsonSchem(t),x2(t.config)){let y=await this.processParamsMaybeAddMcpUsage(t);return await this.generateContentStreamInternal(y)}let c=b2(t);if(c.length>0){let y=c.map(v=>`tools[${v}]`).join(", ");throw new Error(`Incompatible tools found at ${y}. Automatic function calling with CallableTools (or MCP objects) and basic FunctionDeclarations" is not yet supported.`)}let p=(o=(r=(i=t?.config)===null||i===void 0?void 0:i.toolConfig)===null||r===void 0?void 0:r.functionCallingConfig)===null||o===void 0?void 0:o.streamFunctionCallArguments,g=(u=(a=t?.config)===null||a===void 0?void 0:a.automaticFunctionCalling)===null||u===void 0?void 0:u.disable;if(p&&!g)throw new Error("Running in streaming mode with 'streamFunctionCallArguments' enabled, this feature is not compatible with automatic function calling (AFC). Please set 'config.automaticFunctionCalling.disable' to true to disable AFC or leave 'config.toolConfig.functionCallingConfig.streamFunctionCallArguments' to be undefined or set to false to disable streaming function call arguments feature.");return await this.processAfcStream(t)},this.generateImages=async t=>await this.generateImagesInternal(t).then(i=>{var r;let o,a=[];if(i?.generatedImages)for(let c of i.generatedImages)c&&c?.safetyAttributes&&((r=c?.safetyAttributes)===null||r===void 0?void 0:r.contentType)==="Positive Prompt"?o=c?.safetyAttributes:a.push(c);let u;return o?u={generatedImages:a,positivePromptSafetyAttributes:o,sdkHttpResponse:i.sdkHttpResponse}:u={generatedImages:a,sdkHttpResponse:i.sdkHttpResponse},u}),this.list=async t=>{var i;let a={config:Object.assign(Object.assign({},{queryBase:!0}),t?.config)};if(this.apiClient.isVertexAI()&&!a.config.queryBase){if(!((i=a.config)===null||i===void 0)&&i.filter)throw new Error("Filtering tuned models list for Vertex AI is not currently supported");a.config.filter="labels.tune-type:*"}return new er(Mr.PAGED_ITEM_MODELS,u=>this.listInternal(u),await this.listInternal(a),a)},this.editImage=async t=>{let i={model:t.model,prompt:t.prompt,referenceImages:[],config:t.config};return t.referenceImages&&t.referenceImages&&(i.referenceImages=t.referenceImages.map(r=>r.toReferenceImageAPI())),await this.editImageInternal(i)},this.upscaleImage=async t=>{let i={numberOfImages:1,mode:"upscale"};t.config&&(i=Object.assign(Object.assign({},i),t.config));let r={model:t.model,image:t.image,upscaleFactor:t.upscaleFactor,config:i};return await this.upscaleImageInternal(r)},this.generateVideos=async t=>{var i,r,o,a,u,c;if((t.prompt||t.image||t.video)&&t.source)throw new Error("Source and prompt/image/video are mutually exclusive. Please only use source.");return this.apiClient.isVertexAI()||(!((i=t.video)===null||i===void 0)&&i.uri&&(!((r=t.video)===null||r===void 0)&&r.videoBytes)?t.video={uri:t.video.uri,mimeType:t.video.mimeType}:!((a=(o=t.source)===null||o===void 0?void 0:o.video)===null||a===void 0)&&a.uri&&(!((c=(u=t.source)===null||u===void 0?void 0:u.video)===null||c===void 0)&&c.videoBytes)&&(t.source.video={uri:t.source.video.uri,mimeType:t.source.video.mimeType})),await this.generateVideosInternal(t)}}maybeMoveToResponseJsonSchem(e){e.config&&e.config.responseSchema&&(e.config.responseJsonSchema||Object.keys(e.config.responseSchema).includes("$schema")&&(e.config.responseJsonSchema=e.config.responseSchema,delete e.config.responseSchema))}async processParamsMaybeAddMcpUsage(e){var t,i,r;let o=(t=e.config)===null||t===void 0?void 0:t.tools;if(!o)return e;let a=await Promise.all(o.map(async c=>Va(c)?await c.tool():c)),u={model:e.model,contents:e.contents,config:Object.assign(Object.assign({},e.config),{tools:a})};if(u.config.tools=a,e.config&&e.config.tools&&iS(e.config.tools)){let c=(r=(i=e.config.httpOptions)===null||i===void 0?void 0:i.headers)!==null&&r!==void 0?r:{},p=Object.assign({},c);Object.keys(p).length===0&&(p=this.apiClient.getDefaultHeaders()),rS(p),u.config.httpOptions=Object.assign(Object.assign({},e.config.httpOptions),{headers:p})}return u}async initAfcToolsMap(e){var t,i,r;let o=new Map;for(let a of(i=(t=e.config)===null||t===void 0?void 0:t.tools)!==null&&i!==void 0?i:[])if(Va(a)){let u=a,c=await u.tool();for(let p of(r=c.functionDeclarations)!==null&&r!==void 0?r:[]){if(!p.name)throw new Error("Function declaration name is required.");if(o.has(p.name))throw new Error(`Duplicate tool declaration name: ${p.name}`);o.set(p.name,u)}}return o}async processAfcStream(e){var t,i,r;let o=(r=(i=(t=e.config)===null||t===void 0?void 0:t.automaticFunctionCalling)===null||i===void 0?void 0:i.maximumRemoteCalls)!==null&&r!==void 0?r:C2,a=!1,u=0,c=await this.initAfcToolsMap(e);return(function(p,g,y){return pi(this,arguments,function*(){for(var v,C,T,R,F,P;u<o;){a&&(u++,a=!1);let ie=yield Ce(p.processParamsMaybeAddMcpUsage(y)),me=yield Ce(p.generateContentStreamInternal(ie)),de=[],$e=[];try{for(var H=!0,q=(C=void 0,fi(me)),Z;Z=yield Ce(q.next()),v=Z.done,!v;H=!0){R=Z.value,H=!1;let ge=R;if(yield yield Ce(ge),ge.candidates&&(!((F=ge.candidates[0])===null||F===void 0)&&F.content)){$e.push(ge.candidates[0].content);for(let Me of(P=ge.candidates[0].content.parts)!==null&&P!==void 0?P:[])if(u<o&&Me.functionCall){if(!Me.functionCall.name)throw new Error("Function call name was not returned by the model.");if(g.has(Me.functionCall.name)){let wt=yield Ce(g.get(Me.functionCall.name).callTool([Me.functionCall]));de.push(...wt)}else throw new Error(`Automatic function calling was requested, but not all the tools the model used implement the CallableTool interface. Available tools: ${g.keys()}, mising tool: ${Me.functionCall.name}`)}}}}catch(ge){C={error:ge}}finally{try{!H&&!v&&(T=q.return)&&(yield Ce(T.call(q)))}finally{if(C)throw C.error}}if(de.length>0){a=!0;let ge=new xo;ge.candidates=[{content:{role:"user",parts:de}}],yield yield Ce(ge);let Me=[];Me.push(...$e),Me.push({role:"user",parts:de});let wt=jn(y.contents).concat(Me);y.contents=wt}else break}})})(this,c,e)}async generateContentInternal(e){var t,i,r,o;let a,u="",c={};if(this.apiClient.isVertexAI()){let p=h2(this.apiClient,e);return u=te("{model}:generateContent",p._url),c=p._query,delete p._url,delete p._query,a=this.apiClient.request({path:u,queryParams:c,body:JSON.stringify(p),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(g=>g.json().then(y=>{let v=y;return v.sdkHttpResponse={headers:g.headers},v})),a.then(g=>{let y=_2(g),v=new xo;return Object.assign(v,y),v})}else{let p=g2(this.apiClient,e);return u=te("{model}:generateContent",p._url),c=p._query,delete p._url,delete p._query,a=this.apiClient.request({path:u,queryParams:c,body:JSON.stringify(p),httpMethod:"POST",httpOptions:(r=e.config)===null||r===void 0?void 0:r.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(g=>g.json().then(y=>{let v=y;return v.sdkHttpResponse={headers:g.headers},v})),a.then(g=>{let y=y2(g),v=new xo;return Object.assign(v,y),v})}}async generateContentStreamInternal(e){var t,i,r,o;let a,u="",c={};if(this.apiClient.isVertexAI()){let p=h2(this.apiClient,e);return u=te("{model}:streamGenerateContent?alt=sse",p._url),c=p._query,delete p._url,delete p._query,a=this.apiClient.requestStream({path:u,queryParams:c,body:JSON.stringify(p),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}),a.then(function(y){return pi(this,arguments,function*(){var v,C,T,R;try{for(var F=!0,P=fi(y),H;H=yield Ce(P.next()),v=H.done,!v;F=!0){R=H.value,F=!1;let q=R,Z=_2(yield Ce(q.json()));Z.sdkHttpResponse={headers:q.headers};let ie=new xo;Object.assign(ie,Z),yield yield Ce(ie)}}catch(q){C={error:q}}finally{try{!F&&!v&&(T=P.return)&&(yield Ce(T.call(P)))}finally{if(C)throw C.error}}})})}else{let p=g2(this.apiClient,e);return u=te("{model}:streamGenerateContent?alt=sse",p._url),c=p._query,delete p._url,delete p._query,a=this.apiClient.requestStream({path:u,queryParams:c,body:JSON.stringify(p),httpMethod:"POST",httpOptions:(r=e.config)===null||r===void 0?void 0:r.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}),a.then(function(y){return pi(this,arguments,function*(){var v,C,T,R;try{for(var F=!0,P=fi(y),H;H=yield Ce(P.next()),v=H.done,!v;F=!0){R=H.value,F=!1;let q=R,Z=y2(yield Ce(q.json()));Z.sdkHttpResponse={headers:q.headers};let ie=new xo;Object.assign(ie,Z),yield yield Ce(ie)}}catch(q){C={error:q}}finally{try{!F&&!v&&(T=P.return)&&(yield Ce(T.call(P)))}finally{if(C)throw C.error}}})})}}async embedContent(e){var t,i,r,o;let a,u="",c={};if(this.apiClient.isVertexAI()){let p=jP(this.apiClient,e);return u=te("{model}:predict",p._url),c=p._query,delete p._url,delete p._query,a=this.apiClient.request({path:u,queryParams:c,body:JSON.stringify(p),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(g=>g.json().then(y=>{let v=y;return v.sdkHttpResponse={headers:g.headers},v})),a.then(g=>{let y=YP(g),v=new Nm;return Object.assign(v,y),v})}else{let p=WP(this.apiClient,e);return u=te("{model}:batchEmbedContents",p._url),c=p._query,delete p._url,delete p._query,a=this.apiClient.request({path:u,queryParams:c,body:JSON.stringify(p),httpMethod:"POST",httpOptions:(r=e.config)===null||r===void 0?void 0:r.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(g=>g.json().then(y=>{let v=y;return v.sdkHttpResponse={headers:g.headers},v})),a.then(g=>{let y=zP(g),v=new Nm;return Object.assign(v,y),v})}}async generateImagesInternal(e){var t,i,r,o;let a,u="",c={};if(this.apiClient.isVertexAI()){let p=ok(this.apiClient,e);return u=te("{model}:predict",p._url),c=p._query,delete p._url,delete p._query,a=this.apiClient.request({path:u,queryParams:c,body:JSON.stringify(p),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(g=>g.json().then(y=>{let v=y;return v.sdkHttpResponse={headers:g.headers},v})),a.then(g=>{let y=sk(g),v=new Fm;return Object.assign(v,y),v})}else{let p=rk(this.apiClient,e);return u=te("{model}:predict",p._url),c=p._query,delete p._url,delete p._query,a=this.apiClient.request({path:u,queryParams:c,body:JSON.stringify(p),httpMethod:"POST",httpOptions:(r=e.config)===null||r===void 0?void 0:r.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(g=>g.json().then(y=>{let v=y;return v.sdkHttpResponse={headers:g.headers},v})),a.then(g=>{let y=ak(g),v=new Fm;return Object.assign(v,y),v})}}async editImageInternal(e){var t,i;let r,o="",a={};if(this.apiClient.isVertexAI()){let u=$P(this.apiClient,e);return o=te("{model}:predict",u._url),a=u._query,delete u._url,delete u._query,r=this.apiClient.request({path:o,queryParams:a,body:JSON.stringify(u),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(c=>c.json().then(p=>{let g=p;return g.sdkHttpResponse={headers:c.headers},g})),r.then(c=>{let p=HP(c),g=new py;return Object.assign(g,p),g})}else throw new Error("This method is only supported by the Vertex AI.")}async upscaleImageInternal(e){var t,i;let r,o="",a={};if(this.apiClient.isVertexAI()){let u=o8(this.apiClient,e);return o=te("{model}:predict",u._url),a=u._query,delete u._url,delete u._query,r=this.apiClient.request({path:o,queryParams:a,body:JSON.stringify(u),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(c=>c.json().then(p=>{let g=p;return g.sdkHttpResponse={headers:c.headers},g})),r.then(c=>{let p=a8(c),g=new fy;return Object.assign(g,p),g})}else throw new Error("This method is only supported by the Vertex AI.")}async recontextImage(e){var t,i;let r,o="",a={};if(this.apiClient.isVertexAI()){let u=Uk(this.apiClient,e);return o=te("{model}:predict",u._url),a=u._query,delete u._url,delete u._query,r=this.apiClient.request({path:o,queryParams:a,body:JSON.stringify(u),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(c=>c.json()),r.then(c=>{let p=$k(c),g=new gy;return Object.assign(g,p),g})}else throw new Error("This method is only supported by the Vertex AI.")}async segmentImage(e){var t,i;let r,o="",a={};if(this.apiClient.isVertexAI()){let u=zk(this.apiClient,e);return o=te("{model}:predict",u._url),a=u._query,delete u._url,delete u._query,r=this.apiClient.request({path:o,queryParams:a,body:JSON.stringify(u),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(c=>c.json()),r.then(c=>{let p=Yk(c),g=new hy;return Object.assign(g,p),g})}else throw new Error("This method is only supported by the Vertex AI.")}async get(e){var t,i,r,o;let a,u="",c={};if(this.apiClient.isVertexAI()){let p=Sk(this.apiClient,e);return u=te("{name}",p._url),c=p._query,delete p._url,delete p._query,a=this.apiClient.request({path:u,queryParams:c,body:JSON.stringify(p),httpMethod:"GET",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(g=>g.json()),a.then(g=>Vy(g))}else{let p=Ek(this.apiClient,e);return u=te("{name}",p._url),c=p._query,delete p._url,delete p._query,a=this.apiClient.request({path:u,queryParams:c,body:JSON.stringify(p),httpMethod:"GET",httpOptions:(r=e.config)===null||r===void 0?void 0:r.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(g=>g.json()),a.then(g=>ky(g))}}async listInternal(e){var t,i,r,o;let a,u="",c={};if(this.apiClient.isVertexAI()){let p=Fk(this.apiClient,e);return u=te("{models_url}",p._url),c=p._query,delete p._url,delete p._query,a=this.apiClient.request({path:u,queryParams:c,body:JSON.stringify(p),httpMethod:"GET",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(g=>g.json().then(y=>{let v=y;return v.sdkHttpResponse={headers:g.headers},v})),a.then(g=>{let y=kk(g),v=new Pm;return Object.assign(v,y),v})}else{let p=Nk(this.apiClient,e);return u=te("{models_url}",p._url),c=p._query,delete p._url,delete p._query,a=this.apiClient.request({path:u,queryParams:c,body:JSON.stringify(p),httpMethod:"GET",httpOptions:(r=e.config)===null||r===void 0?void 0:r.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(g=>g.json().then(y=>{let v=y;return v.sdkHttpResponse={headers:g.headers},v})),a.then(g=>{let y=Pk(g),v=new Pm;return Object.assign(v,y),v})}}async update(e){var t,i,r,o;let a,u="",c={};if(this.apiClient.isVertexAI()){let p=i8(this.apiClient,e);return u=te("{model}",p._url),c=p._query,delete p._url,delete p._query,a=this.apiClient.request({path:u,queryParams:c,body:JSON.stringify(p),httpMethod:"PATCH",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(g=>g.json()),a.then(g=>Vy(g))}else{let p=n8(this.apiClient,e);return u=te("{name}",p._url),c=p._query,delete p._url,delete p._query,a=this.apiClient.request({path:u,queryParams:c,body:JSON.stringify(p),httpMethod:"PATCH",httpOptions:(r=e.config)===null||r===void 0?void 0:r.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(g=>g.json()),a.then(g=>ky(g))}}async delete(e){var t,i,r,o;let a,u="",c={};if(this.apiClient.isVertexAI()){let p=LP(this.apiClient,e);return u=te("{name}",p._url),c=p._query,delete p._url,delete p._query,a=this.apiClient.request({path:u,queryParams:c,body:JSON.stringify(p),httpMethod:"DELETE",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(g=>g.json().then(y=>{let v=y;return v.sdkHttpResponse={headers:g.headers},v})),a.then(g=>{let y=BP(g),v=new km;return Object.assign(v,y),v})}else{let p=VP(this.apiClient,e);return u=te("{name}",p._url),c=p._query,delete p._url,delete p._query,a=this.apiClient.request({path:u,queryParams:c,body:JSON.stringify(p),httpMethod:"DELETE",httpOptions:(r=e.config)===null||r===void 0?void 0:r.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(g=>g.json().then(y=>{let v=y;return v.sdkHttpResponse={headers:g.headers},v})),a.then(g=>{let y=OP(g),v=new km;return Object.assign(v,y),v})}}async countTokens(e){var t,i,r,o;let a,u="",c={};if(this.apiClient.isVertexAI()){let p=FP(this.apiClient,e);return u=te("{model}:countTokens",p._url),c=p._query,delete p._url,delete p._query,a=this.apiClient.request({path:u,queryParams:c,body:JSON.stringify(p),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(g=>g.json().then(y=>{let v=y;return v.sdkHttpResponse={headers:g.headers},v})),a.then(g=>{let y=kP(g),v=new Vm;return Object.assign(v,y),v})}else{let p=NP(this.apiClient,e);return u=te("{model}:countTokens",p._url),c=p._query,delete p._url,delete p._query,a=this.apiClient.request({path:u,queryParams:c,body:JSON.stringify(p),httpMethod:"POST",httpOptions:(r=e.config)===null||r===void 0?void 0:r.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(g=>g.json().then(y=>{let v=y;return v.sdkHttpResponse={headers:g.headers},v})),a.then(g=>{let y=PP(g),v=new Vm;return Object.assign(v,y),v})}}async computeTokens(e){var t,i;let r,o="",a={};if(this.apiClient.isVertexAI()){let u=DP(this.apiClient,e);return o=te("{model}:computeTokens",u._url),a=u._query,delete u._url,delete u._query,r=this.apiClient.request({path:o,queryParams:a,body:JSON.stringify(u),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(c=>c.json().then(p=>{let g=p;return g.sdkHttpResponse={headers:c.headers},g})),r.then(c=>{let p=wP(c),g=new yy;return Object.assign(g,p),g})}else throw new Error("This method is only supported by the Vertex AI.")}async generateVideosInternal(e){var t,i,r,o;let a,u="",c={};if(this.apiClient.isVertexAI()){let p=pk(this.apiClient,e);return u=te("{model}:predictLongRunning",p._url),c=p._query,delete p._url,delete p._query,a=this.apiClient.request({path:u,queryParams:c,body:JSON.stringify(p),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(g=>g.json()),a.then(g=>{let y=ck(g),v=new Lm;return Object.assign(v,y),v})}else{let p=mk(this.apiClient,e);return u=te("{model}:predictLongRunning",p._url),c=p._query,delete p._url,delete p._query,a=this.apiClient.request({path:u,queryParams:c,body:JSON.stringify(p),httpMethod:"POST",httpOptions:(r=e.config)===null||r===void 0?void 0:r.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(g=>g.json()),a.then(g=>{let y=dk(g),v=new Lm;return Object.assign(v,y),v})}}};var Wy=class extends gi{constructor(e){super(),this.apiClient=e}async getVideosOperation(e){let t=e.operation,i=e.config;if(t.name===void 0||t.name==="")throw new Error("Operation name is required.");if(this.apiClient.isVertexAI()){let r=t.name.split("/operations/")[0],o;i&&"httpOptions"in i&&(o=i.httpOptions);let a=await this.fetchPredictVideosOperationInternal({operationName:t.name,resourceName:r,config:{httpOptions:o}});return t._fromAPIResponse({apiResponse:a,_isVertexAI:!0})}else{let r=await this.getVideosOperationInternal({operationName:t.name,config:i});return t._fromAPIResponse({apiResponse:r,_isVertexAI:!1})}}async get(e){let t=e.operation,i=e.config;if(t.name===void 0||t.name==="")throw new Error("Operation name is required.");if(this.apiClient.isVertexAI()){let r=t.name.split("/operations/")[0],o;i&&"httpOptions"in i&&(o=i.httpOptions);let a=await this.fetchPredictVideosOperationInternal({operationName:t.name,resourceName:r,config:{httpOptions:o}});return t._fromAPIResponse({apiResponse:a,_isVertexAI:!0})}else{let r=await this.getVideosOperationInternal({operationName:t.name,config:i});return t._fromAPIResponse({apiResponse:r,_isVertexAI:!1})}}async getVideosOperationInternal(e){var t,i,r,o;let a,u="",c={};if(this.apiClient.isVertexAI()){let p=sN(e);return u=te("{operationName}",p._url),c=p._query,delete p._url,delete p._query,a=this.apiClient.request({path:u,queryParams:c,body:JSON.stringify(p),httpMethod:"GET",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(g=>g.json()),a}else{let p=aN(e);return u=te("{operationName}",p._url),c=p._query,delete p._url,delete p._query,a=this.apiClient.request({path:u,queryParams:c,body:JSON.stringify(p),httpMethod:"GET",httpOptions:(r=e.config)===null||r===void 0?void 0:r.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(g=>g.json()),a}}async fetchPredictVideosOperationInternal(e){var t,i;let r,o="",a={};if(this.apiClient.isVertexAI()){let u=XR(e);return o=te("{resourceName}:fetchPredictOperation",u._url),a=u._query,delete u._url,delete u._query,r=this.apiClient.request({path:o,queryParams:a,body:JSON.stringify(u),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(c=>c.json()),r}else throw new Error("This method is only supported by the Vertex AI.")}};function z8(n){let e={},t=f(n,["data"]);if(t!=null&&h(e,["data"],t),f(n,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");let i=f(n,["mimeType"]);return i!=null&&h(e,["mimeType"],i),e}function Y8(n){let e={},t=f(n,["parts"]);if(t!=null){let r=t;Array.isArray(r)&&(r=r.map(o=>i7(o))),h(e,["parts"],r)}let i=f(n,["role"]);return i!=null&&h(e,["role"],i),e}function J8(n,e,t){let i={},r=f(e,["expireTime"]);t!==void 0&&r!=null&&h(t,["expireTime"],r);let o=f(e,["newSessionExpireTime"]);t!==void 0&&o!=null&&h(t,["newSessionExpireTime"],o);let a=f(e,["uses"]);t!==void 0&&a!=null&&h(t,["uses"],a);let u=f(e,["liveConnectConstraints"]);t!==void 0&&u!=null&&h(t,["bidiGenerateContentSetup"],n7(n,u));let c=f(e,["lockAdditionalFields"]);return t!==void 0&&c!=null&&h(t,["fieldMask"],c),i}function K8(n,e){let t={},i=f(e,["config"]);return i!=null&&h(t,["config"],J8(n,i,t)),t}function Q8(n){let e={};if(f(n,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");let t=f(n,["fileUri"]);t!=null&&h(e,["fileUri"],t);let i=f(n,["mimeType"]);return i!=null&&h(e,["mimeType"],i),e}function Z8(n){let e={},t=f(n,["id"]);t!=null&&h(e,["id"],t);let i=f(n,["args"]);i!=null&&h(e,["args"],i);let r=f(n,["name"]);if(r!=null&&h(e,["name"],r),f(n,["partialArgs"])!==void 0)throw new Error("partialArgs parameter is not supported in Gemini API.");if(f(n,["willContinue"])!==void 0)throw new Error("willContinue parameter is not supported in Gemini API.");return e}function X8(n){let e={};if(f(n,["authConfig"])!==void 0)throw new Error("authConfig parameter is not supported in Gemini API.");let t=f(n,["enableWidget"]);return t!=null&&h(e,["enableWidget"],t),e}function e7(n){let e={};if(f(n,["excludeDomains"])!==void 0)throw new Error("excludeDomains parameter is not supported in Gemini API.");if(f(n,["blockingConfidence"])!==void 0)throw new Error("blockingConfidence parameter is not supported in Gemini API.");let t=f(n,["timeRangeFilter"]);return t!=null&&h(e,["timeRangeFilter"],t),e}function t7(n,e){let t={},i=f(n,["generationConfig"]);e!==void 0&&i!=null&&h(e,["setup","generationConfig"],i);let r=f(n,["responseModalities"]);e!==void 0&&r!=null&&h(e,["setup","generationConfig","responseModalities"],r);let o=f(n,["temperature"]);e!==void 0&&o!=null&&h(e,["setup","generationConfig","temperature"],o);let a=f(n,["topP"]);e!==void 0&&a!=null&&h(e,["setup","generationConfig","topP"],a);let u=f(n,["topK"]);e!==void 0&&u!=null&&h(e,["setup","generationConfig","topK"],u);let c=f(n,["maxOutputTokens"]);e!==void 0&&c!=null&&h(e,["setup","generationConfig","maxOutputTokens"],c);let p=f(n,["mediaResolution"]);e!==void 0&&p!=null&&h(e,["setup","generationConfig","mediaResolution"],p);let g=f(n,["seed"]);e!==void 0&&g!=null&&h(e,["setup","generationConfig","seed"],g);let y=f(n,["speechConfig"]);e!==void 0&&y!=null&&h(e,["setup","generationConfig","speechConfig"],p_(y));let v=f(n,["thinkingConfig"]);e!==void 0&&v!=null&&h(e,["setup","generationConfig","thinkingConfig"],v);let C=f(n,["enableAffectiveDialog"]);e!==void 0&&C!=null&&h(e,["setup","generationConfig","enableAffectiveDialog"],C);let T=f(n,["systemInstruction"]);e!==void 0&&T!=null&&h(e,["setup","systemInstruction"],Y8(nn(T)));let R=f(n,["tools"]);if(e!==void 0&&R!=null){let me=Ua(R);Array.isArray(me)&&(me=me.map(de=>o7(Ba(de)))),h(e,["setup","tools"],me)}let F=f(n,["sessionResumption"]);e!==void 0&&F!=null&&h(e,["setup","sessionResumption"],r7(F));let P=f(n,["inputAudioTranscription"]);e!==void 0&&P!=null&&h(e,["setup","inputAudioTranscription"],P);let H=f(n,["outputAudioTranscription"]);e!==void 0&&H!=null&&h(e,["setup","outputAudioTranscription"],H);let q=f(n,["realtimeInputConfig"]);e!==void 0&&q!=null&&h(e,["setup","realtimeInputConfig"],q);let Z=f(n,["contextWindowCompression"]);e!==void 0&&Z!=null&&h(e,["setup","contextWindowCompression"],Z);let ie=f(n,["proactivity"]);if(e!==void 0&&ie!=null&&h(e,["setup","proactivity"],ie),f(n,["explicitVadSignal"])!==void 0)throw new Error("explicitVadSignal parameter is not supported in Gemini API.");return t}function n7(n,e){let t={},i=f(e,["model"]);i!=null&&h(t,["setup","model"],We(n,i));let r=f(e,["config"]);return r!=null&&h(t,["config"],t7(r,t)),t}function i7(n){let e={},t=f(n,["mediaResolution"]);t!=null&&h(e,["mediaResolution"],t);let i=f(n,["codeExecutionResult"]);i!=null&&h(e,["codeExecutionResult"],i);let r=f(n,["executableCode"]);r!=null&&h(e,["executableCode"],r);let o=f(n,["fileData"]);o!=null&&h(e,["fileData"],Q8(o));let a=f(n,["functionCall"]);a!=null&&h(e,["functionCall"],Z8(a));let u=f(n,["functionResponse"]);u!=null&&h(e,["functionResponse"],u);let c=f(n,["inlineData"]);c!=null&&h(e,["inlineData"],z8(c));let p=f(n,["text"]);p!=null&&h(e,["text"],p);let g=f(n,["thought"]);g!=null&&h(e,["thought"],g);let y=f(n,["thoughtSignature"]);y!=null&&h(e,["thoughtSignature"],y);let v=f(n,["videoMetadata"]);return v!=null&&h(e,["videoMetadata"],v),e}function r7(n){let e={},t=f(n,["handle"]);if(t!=null&&h(e,["handle"],t),f(n,["transparent"])!==void 0)throw new Error("transparent parameter is not supported in Gemini API.");return e}function o7(n){let e={};if(f(n,["retrieval"])!==void 0)throw new Error("retrieval parameter is not supported in Gemini API.");let t=f(n,["computerUse"]);t!=null&&h(e,["computerUse"],t);let i=f(n,["fileSearch"]);i!=null&&h(e,["fileSearch"],i);let r=f(n,["codeExecution"]);if(r!=null&&h(e,["codeExecution"],r),f(n,["enterpriseWebSearch"])!==void 0)throw new Error("enterpriseWebSearch parameter is not supported in Gemini API.");let o=f(n,["functionDeclarations"]);if(o!=null){let g=o;Array.isArray(g)&&(g=g.map(y=>y)),h(e,["functionDeclarations"],g)}let a=f(n,["googleMaps"]);a!=null&&h(e,["googleMaps"],X8(a));let u=f(n,["googleSearch"]);u!=null&&h(e,["googleSearch"],e7(u));let c=f(n,["googleSearchRetrieval"]);c!=null&&h(e,["googleSearchRetrieval"],c);let p=f(n,["urlContext"]);return p!=null&&h(e,["urlContext"],p),e}function a7(n){let e=[];for(let t in n)if(Object.prototype.hasOwnProperty.call(n,t)){let i=n[t];if(typeof i=="object"&&i!=null&&Object.keys(i).length>0){let r=Object.keys(i).map(o=>`${t}.${o}`);e.push(...r)}else e.push(t)}return e.join(",")}function s7(n,e){let t=null,i=n.bidiGenerateContentSetup;if(typeof i=="object"&&i!==null&&"setup"in i){let o=i.setup;typeof o=="object"&&o!==null?(n.bidiGenerateContentSetup=o,t=o):delete n.bidiGenerateContentSetup}else i!==void 0&&delete n.bidiGenerateContentSetup;let r=n.fieldMask;if(t){let o=a7(t);if(Array.isArray(e?.lockAdditionalFields)&&e?.lockAdditionalFields.length===0)o?n.fieldMask=o:delete n.fieldMask;else if(e?.lockAdditionalFields&&e.lockAdditionalFields.length>0&&r!==null&&Array.isArray(r)&&r.length>0){let a=["temperature","topK","topP","maxOutputTokens","responseModalities","seed","speechConfig"],u=[];r.length>0&&(u=r.map(p=>a.includes(p)?`generationConfig.${p}`:p));let c=[];o&&c.push(o),u.length>0&&c.push(...u),c.length>0?n.fieldMask=c.join(","):delete n.fieldMask}else delete n.fieldMask}else r!==null&&Array.isArray(r)&&r.length>0?n.fieldMask=r.join(","):delete n.fieldMask;return n}var jy=class extends gi{constructor(e){super(),this.apiClient=e}async create(e){var t,i;let r,o="",a={};if(this.apiClient.isVertexAI())throw new Error("The client.tokens.create method is only supported by the Gemini Developer API.");{let u=K8(this.apiClient,e);o=te("auth_tokens",u._url),a=u._query,delete u.config,delete u._url,delete u._query;let c=s7(u,e.config);return r=this.apiClient.request({path:o,queryParams:a,body:JSON.stringify(c),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(p=>p.json()),r.then(p=>p)}}};function l7(n,e){let t={},i=f(n,["force"]);return e!==void 0&&i!=null&&h(e,["_query","force"],i),t}function u7(n){let e={},t=f(n,["name"]);t!=null&&h(e,["_url","name"],t);let i=f(n,["config"]);return i!=null&&l7(i,e),e}function d7(n){let e={},t=f(n,["name"]);return t!=null&&h(e,["_url","name"],t),e}function c7(n,e){let t={},i=f(n,["pageSize"]);e!==void 0&&i!=null&&h(e,["_query","pageSize"],i);let r=f(n,["pageToken"]);return e!==void 0&&r!=null&&h(e,["_query","pageToken"],r),t}function m7(n){let e={},t=f(n,["parent"]);t!=null&&h(e,["_url","parent"],t);let i=f(n,["config"]);return i!=null&&c7(i,e),e}function p7(n){let e={},t=f(n,["sdkHttpResponse"]);t!=null&&h(e,["sdkHttpResponse"],t);let i=f(n,["nextPageToken"]);i!=null&&h(e,["nextPageToken"],i);let r=f(n,["documents"]);if(r!=null){let o=r;Array.isArray(o)&&(o=o.map(a=>a)),h(e,["documents"],o)}return e}var zy=class extends gi{constructor(e){super(),this.apiClient=e,this.list=async t=>new er(Mr.PAGED_ITEM_DOCUMENTS,i=>this.listInternal({parent:t.parent,config:i.config}),await this.listInternal(t),t)}async get(e){var t,i;let r,o="",a={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{let u=d7(e);return o=te("{name}",u._url),a=u._query,delete u._url,delete u._query,r=this.apiClient.request({path:o,queryParams:a,body:JSON.stringify(u),httpMethod:"GET",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(c=>c.json()),r.then(c=>c)}}async delete(e){var t,i;let r="",o={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{let a=u7(e);r=te("{name}",a._url),o=a._query,delete a._url,delete a._query,await this.apiClient.request({path:r,queryParams:o,body:JSON.stringify(a),httpMethod:"DELETE",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal})}}async listInternal(e){var t,i;let r,o="",a={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{let u=m7(e);return o=te("{parent}/documents",u._url),a=u._query,delete u._url,delete u._query,r=this.apiClient.request({path:o,queryParams:a,body:JSON.stringify(u),httpMethod:"GET",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(c=>c.json()),r.then(c=>{let p=p7(c),g=new _y;return Object.assign(g,p),g})}}};var Yy=class extends gi{constructor(e,t=new zy(e)){super(),this.apiClient=e,this.documents=t,this.list=async(i={})=>new er(Mr.PAGED_ITEM_FILE_SEARCH_STORES,r=>this.listInternal(r),await this.listInternal(i),i)}async uploadToFileSearchStore(e){if(this.apiClient.isVertexAI())throw new Error("Vertex AI does not support uploading files to a file search store.");return this.apiClient.uploadFileToFileSearchStore(e.fileSearchStoreName,e.file,e.config)}async create(e){var t,i;let r,o="",a={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{let u=p8(e);return o=te("fileSearchStores",u._url),a=u._query,delete u._url,delete u._query,r=this.apiClient.request({path:o,queryParams:a,body:JSON.stringify(u),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(c=>c.json()),r.then(c=>c)}}async get(e){var t,i;let r,o="",a={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{let u=h8(e);return o=te("{name}",u._url),a=u._query,delete u._url,delete u._query,r=this.apiClient.request({path:o,queryParams:a,body:JSON.stringify(u),httpMethod:"GET",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(c=>c.json()),r.then(c=>c)}}async delete(e){var t,i;let r="",o={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{let a=g8(e);r=te("{name}",a._url),o=a._query,delete a._url,delete a._query,await this.apiClient.request({path:r,queryParams:o,body:JSON.stringify(a),httpMethod:"DELETE",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal})}}async listInternal(e){var t,i;let r,o="",a={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{let u=b8(e);return o=te("fileSearchStores",u._url),a=u._query,delete u._url,delete u._query,r=this.apiClient.request({path:o,queryParams:a,body:JSON.stringify(u),httpMethod:"GET",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(c=>c.json()),r.then(c=>{let p=E8(c),g=new vy;return Object.assign(g,p),g})}}async uploadToFileSearchStoreInternal(e){var t,i;let r,o="",a={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{let u=S8(e);return o=te("upload/v1beta/{file_search_store_name}:uploadToFileSearchStore",u._url),a=u._query,delete u._url,delete u._query,r=this.apiClient.request({path:o,queryParams:a,body:JSON.stringify(u),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(c=>c.json()),r.then(c=>{let p=D8(c),g=new Cy;return Object.assign(g,p),g})}}async importFile(e){var t,i;let r,o="",a={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{let u=v8(e);return o=te("{file_search_store_name}:importFile",u._url),a=u._query,delete u._url,delete u._query,r=this.apiClient.request({path:o,queryParams:a,body:JSON.stringify(u),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(c=>c.json()),r.then(c=>{let p=_8(c),g=new xy;return Object.assign(g,p),g})}}};var oS=function(){let{crypto:n}=globalThis;if(n?.randomUUID)return oS=n.randomUUID.bind(n),n.randomUUID();let e=new Uint8Array(1),t=n?()=>n.getRandomValues(e)[0]:()=>Math.random()*255&255;return"10000000-1000-4000-8000-100000000000".replace(/[018]/g,i=>(+i^t()&15>>+i/4).toString(16))},f7=()=>oS();function Jy(n){return typeof n=="object"&&n!==null&&("name"in n&&n.name==="AbortError"||"message"in n&&String(n.message).includes("FetchRequestCanceledException"))}var Ky=n=>{if(n instanceof Error)return n;if(typeof n=="object"&&n!==null){try{if(Object.prototype.toString.call(n)==="[object Error]"){let e=new Error(n.message,n.cause?{cause:n.cause}:{});return n.stack&&(e.stack=n.stack),n.cause&&!e.cause&&(e.cause=n.cause),n.name&&(e.name=n.name),e}}catch{}try{return new Error(JSON.stringify(n))}catch{}}return new Error(n)};var Cn=class extends Error{},xn=class n extends Cn{constructor(e,t,i,r){super(`${n.makeMessage(e,t,i)}`),this.status=e,this.headers=r,this.error=t}static makeMessage(e,t,i){let r=t?.message?typeof t.message=="string"?t.message:JSON.stringify(t.message):t?JSON.stringify(t):i;return e&&r?`${e} ${r}`:e?`${e} status code (no body)`:r||"(no status code or body)"}static generate(e,t,i,r){if(!e||!r)return new La({message:i,cause:Ky(t)});let o=t;return e===400?new jm(e,o,i,r):e===401?new zm(e,o,i,r):e===403?new Ym(e,o,i,r):e===404?new Jm(e,o,i,r):e===409?new Km(e,o,i,r):e===422?new Qm(e,o,i,r):e===429?new Zm(e,o,i,r):e>=500?new Xm(e,o,i,r):new n(e,o,i,r)}},ou=class extends xn{constructor({message:e}={}){super(void 0,void 0,e||"Request was aborted.",void 0)}},La=class extends xn{constructor({message:e,cause:t}){super(void 0,void 0,e||"Connection error.",void 0),t&&(this.cause=t)}},Wm=class extends La{constructor({message:e}={}){super({message:e??"Request timed out."})}},jm=class extends xn{},zm=class extends xn{},Ym=class extends xn{},Jm=class extends xn{},Km=class extends xn{},Qm=class extends xn{},Zm=class extends xn{},Xm=class extends xn{};var g7=/^[a-z][a-z0-9+.-]*:/i,h7=n=>g7.test(n),Qy=n=>(Qy=Array.isArray,Qy(n)),y7=Qy,_7=y7,S2=_7;function v7(n){if(!n)return!0;for(let e in n)return!1;return!0}function C7(n,e){return Object.prototype.hasOwnProperty.call(n,e)}var x7=(n,e)=>{if(typeof e!="number"||!Number.isInteger(e))throw new Cn(`${n} must be an integer`);if(e<0)throw new Cn(`${n} must be a positive integer`);return e},b7=n=>{try{return JSON.parse(n)}catch{return}};var E7=n=>new Promise(e=>setTimeout(e,n));var Pa="0.0.1";function S7(){return typeof Deno<"u"&&Deno.build!=null?"deno":typeof EdgeRuntime<"u"?"edge":Object.prototype.toString.call(typeof globalThis.process<"u"?globalThis.process:0)==="[object process]"?"node":"unknown"}var D7=()=>{var n,e,t,i,r;let o=S7();if(o==="deno")return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":Pa,"X-Stainless-OS":w2(Deno.build.os),"X-Stainless-Arch":D2(Deno.build.arch),"X-Stainless-Runtime":"deno","X-Stainless-Runtime-Version":typeof Deno.version=="string"?Deno.version:(e=(n=Deno.version)===null||n===void 0?void 0:n.deno)!==null&&e!==void 0?e:"unknown"};if(typeof EdgeRuntime<"u")return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":Pa,"X-Stainless-OS":"Unknown","X-Stainless-Arch":`other:${EdgeRuntime}`,"X-Stainless-Runtime":"edge","X-Stainless-Runtime-Version":globalThis.process.version};if(o==="node")return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":Pa,"X-Stainless-OS":w2((t=globalThis.process.platform)!==null&&t!==void 0?t:"unknown"),"X-Stainless-Arch":D2((i=globalThis.process.arch)!==null&&i!==void 0?i:"unknown"),"X-Stainless-Runtime":"node","X-Stainless-Runtime-Version":(r=globalThis.process.version)!==null&&r!==void 0?r:"unknown"};let a=w7();return a?{"X-Stainless-Lang":"js","X-Stainless-Package-Version":Pa,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"unknown","X-Stainless-Runtime":`browser:${a.browser}`,"X-Stainless-Runtime-Version":a.version}:{"X-Stainless-Lang":"js","X-Stainless-Package-Version":Pa,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"unknown","X-Stainless-Runtime":"unknown","X-Stainless-Runtime-Version":"unknown"}};function w7(){if(typeof navigator>"u"||!navigator)return null;let n=[{key:"edge",pattern:/Edge(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"ie",pattern:/MSIE(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"ie",pattern:/Trident(?:.*rv\:(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"chrome",pattern:/Chrome(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"firefox",pattern:/Firefox(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"safari",pattern:/(?:Version\W+(\d+)\.(\d+)(?:\.(\d+))?)?(?:\W+Mobile\S*)?\W+Safari/}];for(let{key:e,pattern:t}of n){let i=t.exec(navigator.userAgent);if(i){let r=i[1]||0,o=i[2]||0,a=i[3]||0;return{browser:e,version:`${r}.${o}.${a}`}}}return null}var D2=n=>n==="x32"?"x32":n==="x86_64"||n==="x64"?"x64":n==="arm"?"arm":n==="aarch64"||n==="arm64"?"arm64":n?`other:${n}`:"unknown",w2=n=>(n=n.toLowerCase(),n.includes("ios")?"iOS":n==="android"?"Android":n==="darwin"?"MacOS":n==="win32"?"Windows":n==="freebsd"?"FreeBSD":n==="openbsd"?"OpenBSD":n==="linux"?"Linux":n?`Other:${n}`:"Unknown"),Dm,T7=()=>Dm??(Dm=D7());function I7(){if(typeof fetch<"u")return fetch;throw new Error("`fetch` is not defined as a global; Either pass `fetch` to the client, `new GeminiNextGenAPIClient({ fetch })` or polyfill the global, `globalThis.fetch = fetch`")}function aS(...n){let e=globalThis.ReadableStream;if(typeof e>"u")throw new Error("`ReadableStream` is not defined as a global; You will need to polyfill it, `globalThis.ReadableStream = ReadableStream`");return new e(...n)}function M7(n){let e=Symbol.asyncIterator in n?n[Symbol.asyncIterator]():n[Symbol.iterator]();return aS({start(){},async pull(t){let{done:i,value:r}=await e.next();i?t.close():t.enqueue(r)},async cancel(){var t;await((t=e.return)===null||t===void 0?void 0:t.call(e))}})}function sS(n){if(n[Symbol.asyncIterator])return n;let e=n.getReader();return{async next(){try{let t=await e.read();return t?.done&&e.releaseLock(),t}catch(t){throw e.releaseLock(),t}},async return(){let t=e.cancel();return e.releaseLock(),await t,{done:!0,value:void 0}},[Symbol.asyncIterator](){return this}}}async function A7(n){var e,t;if(n===null||typeof n!="object")return;if(n[Symbol.asyncIterator]){await((t=(e=n[Symbol.asyncIterator]()).return)===null||t===void 0?void 0:t.call(e));return}let i=n.getReader(),r=i.cancel();i.releaseLock(),await r}var R7=({headers:n,body:e})=>({bodyHeaders:{"content-type":"application/json"},body:JSON.stringify(e)});var lS=()=>{var n;if(typeof File>"u"){let{process:e}=globalThis,t=typeof((n=e?.versions)===null||n===void 0?void 0:n.node)=="string"&&parseInt(e.versions.node.split("."))<20;throw new Error("`File` is not defined as a global, which is required for file uploads."+(t?" Update to Node 20 LTS or newer, or set `globalThis.File` to `import('node:buffer').File`.":""))}};function uy(n,e,t){return lS(),new File(n,e??"unknown_file",t)}function N7(n){return(typeof n=="object"&&n!==null&&("name"in n&&n.name&&String(n.name)||"url"in n&&n.url&&String(n.url)||"filename"in n&&n.filename&&String(n.filename)||"path"in n&&n.path&&String(n.path))||"").split(/[\\/]/).pop()||void 0}var F7=n=>n!=null&&typeof n=="object"&&typeof n[Symbol.asyncIterator]=="function";var uS=n=>n!=null&&typeof n=="object"&&typeof n.size=="number"&&typeof n.type=="string"&&typeof n.text=="function"&&typeof n.slice=="function"&&typeof n.arrayBuffer=="function",P7=n=>n!=null&&typeof n=="object"&&typeof n.name=="string"&&typeof n.lastModified=="number"&&uS(n),k7=n=>n!=null&&typeof n=="object"&&typeof n.url=="string"&&typeof n.blob=="function";async function V7(n,e,t){if(lS(),n=await n,P7(n))return n instanceof File?n:uy([await n.arrayBuffer()],n.name);if(k7(n)){let r=await n.blob();return e||(e=new URL(n.url).pathname.split(/[\\/]/).pop()),uy(await Zy(r),e,t)}let i=await Zy(n);if(e||(e=N7(n)),!t?.type){let r=i.find(o=>typeof o=="object"&&"type"in o&&o.type);typeof r=="string"&&(t=Object.assign(Object.assign({},t),{type:r}))}return uy(i,e,t)}async function Zy(n){var e,t,i,r,o;let a=[];if(typeof n=="string"||ArrayBuffer.isView(n)||n instanceof ArrayBuffer)a.push(n);else if(uS(n))a.push(n instanceof Blob?n:await n.arrayBuffer());else if(F7(n))try{for(var u=!0,c=fi(n),p;p=await c.next(),e=p.done,!e;u=!0){r=p.value,u=!1;let g=r;a.push(...await Zy(g))}}catch(g){t={error:g}}finally{try{!u&&!e&&(i=c.return)&&await i.call(c)}finally{if(t)throw t.error}}else{let g=(o=n?.constructor)===null||o===void 0?void 0:o.name;throw new Error(`Unexpected data type: ${typeof n}${g?`; constructor: ${g}`:""}${L7(n)}`)}return a}function L7(n){return typeof n!="object"||n===null?"":`; props: [${Object.getOwnPropertyNames(n).map(t=>`"${t}"`).join(", ")}]`}var O7=(()=>{class n{constructor(t){this._client=t}}n._key=[];return n})();function dS(n){return n.replace(/[^A-Za-z0-9\-._~!$&'()*+,;=:@]+/g,encodeURIComponent)}var T2=Object.freeze(Object.create(null)),B7=(n=dS)=>function(t,...i){if(t.length===1)return t[0];let r=!1,o=[],a=t.reduce((g,y,v)=>{var C,T,R;/[?#]/.test(y)&&(r=!0);let F=i[v],P=(r?encodeURIComponent:n)(""+F);return v!==i.length&&(F==null||typeof F=="object"&&F.toString===((R=Object.getPrototypeOf((T=Object.getPrototypeOf((C=F.hasOwnProperty)!==null&&C!==void 0?C:T2))!==null&&T!==void 0?T:T2))===null||R===void 0?void 0:R.toString))&&(P=F+"",o.push({start:g.length+y.length,length:P.length,error:`Value of type ${Object.prototype.toString.call(F).slice(8,-1)} is not a valid path parameter`})),g+y+(v===i.length?"":P)},""),u=a.split(/[?#]/,1)[0],c=new RegExp("(?<=^|\\/)(?:\\.|%2e){1,2}(?=\\/|$)","gi"),p;for(;(p=c.exec(u))!==null;)o.push({start:p.index,length:p[0].length,error:`Value "${p[0]}" can't be safely passed as a path parameter`});if(o.sort((g,y)=>g.start-y.start),o.length>0){let g=0,y=o.reduce((v,C)=>{let T=" ".repeat(C.start-g),R="^".repeat(C.length);return g=C.start+C.length,v+T+R},"");throw new Cn(`Path parameters result in path with invalid segments:
${o.map(v=>v.error).join(`
`)}
${a}
${y}`)}return a},wm=B7(dS);var ep=class extends O7{create(e,t){var i;let{api_version:r=this._client.apiVersion}=e,o=qm(e,["api_version"]);if("model"in o&&"agent_config"in o)throw new Cn("Invalid request: specified `model` and `agent_config`. If specifying `model`, use `generation_config`.");if("agent"in o&&"generation_config"in o)throw new Cn("Invalid request: specified `agent` and `generation_config`. If specifying `agent`, use `agent_config`.");return this._client.post(wm`/${r}/interactions`,Object.assign(Object.assign({body:o},t),{stream:(i=e.stream)!==null&&i!==void 0?i:!1}))}delete(e,t={},i){let{api_version:r=this._client.apiVersion}=t??{};return this._client.delete(wm`/${r}/interactions/${e}`,i)}cancel(e,t={},i){let{api_version:r=this._client.apiVersion}=t??{};return this._client.post(wm`/${r}/interactions/${e}/cancel`,i)}get(e,t={},i){var r;let o=t??{},{api_version:a=this._client.apiVersion}=o,u=qm(o,["api_version"]);return this._client.get(wm`/${a}/interactions/${e}`,Object.assign(Object.assign({query:u},i),{stream:(r=t?.stream)!==null&&r!==void 0?r:!1}))}};ep._key=Object.freeze(["interactions"]);var tp=class extends ep{};function U7(n){let e=0;for(let r of n)e+=r.length;let t=new Uint8Array(e),i=0;for(let r of n)t.set(r,i),i+=r.length;return t}var Tm;function f_(n){let e;return(Tm??(e=new globalThis.TextEncoder,Tm=e.encode.bind(e)))(n)}var Im;function I2(n){let e;return(Im??(e=new globalThis.TextDecoder,Im=e.decode.bind(e)))(n)}var Oa=class{constructor(){this.buffer=new Uint8Array,this.carriageReturnIndex=null}decode(e){if(e==null)return[];let t=e instanceof ArrayBuffer?new Uint8Array(e):typeof e=="string"?f_(e):e;this.buffer=U7([this.buffer,t]);let i=[],r;for(;(r=$7(this.buffer,this.carriageReturnIndex))!=null;){if(r.carriage&&this.carriageReturnIndex==null){this.carriageReturnIndex=r.index;continue}if(this.carriageReturnIndex!=null&&(r.index!==this.carriageReturnIndex+1||r.carriage)){i.push(I2(this.buffer.subarray(0,this.carriageReturnIndex-1))),this.buffer=this.buffer.subarray(this.carriageReturnIndex),this.carriageReturnIndex=null;continue}let o=this.carriageReturnIndex!==null?r.preceding-1:r.preceding,a=I2(this.buffer.subarray(0,o));i.push(a),this.buffer=this.buffer.subarray(r.index),this.carriageReturnIndex=null}return i}flush(){return this.buffer.length?this.decode(`
`):[]}};Oa.NEWLINE_CHARS=new Set([`
`,"\r"]);Oa.NEWLINE_REGEXP=/\r\n|[\n\r]/g;function $7(n,e){for(let r=e??0;r<n.length;r++){if(n[r]===10)return{preceding:r,index:r+1,carriage:!1};if(n[r]===13)return{preceding:r,index:r+1,carriage:!0}}return null}function H7(n){for(let i=0;i<n.length-1;i++){if(n[i]===10&&n[i+1]===10||n[i]===13&&n[i+1]===13)return i+2;if(n[i]===13&&n[i+1]===10&&i+3<n.length&&n[i+2]===13&&n[i+3]===10)return i+4}return-1}var np={off:0,error:200,warn:300,info:400,debug:500},M2=(n,e,t)=>{if(n){if(C7(np,n))return n;gn(t).warn(`${e} was set to ${JSON.stringify(n)}, expected one of ${JSON.stringify(Object.keys(np))}`)}};function nu(){}function Mm(n,e,t){return!e||np[n]>np[t]?nu:e[n].bind(e)}var G7={error:nu,warn:nu,info:nu,debug:nu},A2=new WeakMap;function gn(n){var e;let t=n.logger,i=(e=n.logLevel)!==null&&e!==void 0?e:"off";if(!t)return G7;let r=A2.get(t);if(r&&r[0]===i)return r[1];let o={error:Mm("error",t,i),warn:Mm("warn",t,i),info:Mm("info",t,i),debug:Mm("debug",t,i)};return A2.set(t,[i,o]),o}var Co=n=>(n.options&&(n.options=Object.assign({},n.options),delete n.options.headers),n.headers&&(n.headers=Object.fromEntries((n.headers instanceof Headers?[...n.headers]:Object.entries(n.headers)).map(([e,t])=>[e,e.toLowerCase()==="x-goog-api-key"||e.toLowerCase()==="authorization"||e.toLowerCase()==="cookie"||e.toLowerCase()==="set-cookie"?"***":t]))),"retryOfRequestLogID"in n&&(n.retryOfRequestLogID&&(n.retryOf=n.retryOfRequestLogID),delete n.retryOfRequestLogID),n);var Xy=class n{constructor(e,t,i){this.iterator=e,this.controller=t,this.client=i}static fromSSEResponse(e,t,i){let r=!1,o=i?gn(i):console;function a(){return pi(this,arguments,function*(){var c,p,g,y;if(r)throw new Cn("Cannot iterate over a consumed stream, use `.tee()` to split the stream.");r=!0;let v=!1;try{try{for(var C=!0,T=fi(q7(e,t)),R;R=yield Ce(T.next()),c=R.done,!c;C=!0){y=R.value,C=!1;let F=y;if(!v)if(F.data.startsWith("[DONE]")){v=!0;continue}else try{yield yield Ce(JSON.parse(F.data))}catch(P){throw o.error("Could not parse message into JSON:",F.data),o.error("From chunk:",F.raw),P}}}catch(F){p={error:F}}finally{try{!C&&!c&&(g=T.return)&&(yield Ce(g.call(T)))}finally{if(p)throw p.error}}v=!0}catch(F){if(Jy(F))return yield Ce(void 0);throw F}finally{v||t.abort()}})}return new n(a,t,i)}static fromReadableStream(e,t,i){let r=!1;function o(){return pi(this,arguments,function*(){var c,p,g,y;let v=new Oa,C=sS(e);try{for(var T=!0,R=fi(C),F;F=yield Ce(R.next()),c=F.done,!c;T=!0){y=F.value,T=!1;let P=y;for(let H of v.decode(P))yield yield Ce(H)}}catch(P){p={error:P}}finally{try{!T&&!c&&(g=R.return)&&(yield Ce(g.call(R)))}finally{if(p)throw p.error}}for(let P of v.flush())yield yield Ce(P)})}function a(){return pi(this,arguments,function*(){var c,p,g,y;if(r)throw new Cn("Cannot iterate over a consumed stream, use `.tee()` to split the stream.");r=!0;let v=!1;try{try{for(var C=!0,T=fi(o()),R;R=yield Ce(T.next()),c=R.done,!c;C=!0){y=R.value,C=!1;let F=y;v||F&&(yield yield Ce(JSON.parse(F)))}}catch(F){p={error:F}}finally{try{!C&&!c&&(g=T.return)&&(yield Ce(g.call(T)))}finally{if(p)throw p.error}}v=!0}catch(F){if(Jy(F))return yield Ce(void 0);throw F}finally{v||t.abort()}})}return new n(a,t,i)}[Symbol.asyncIterator](){return this.iterator()}tee(){let e=[],t=[],i=this.iterator(),r=o=>({next:()=>{if(o.length===0){let a=i.next();e.push(a),t.push(a)}return o.shift()}});return[new n(()=>r(e),this.controller,this.client),new n(()=>r(t),this.controller,this.client)]}toReadableStream(){let e=this,t;return aS({async start(){t=e[Symbol.asyncIterator]()},async pull(i){try{let{value:r,done:o}=await t.next();if(o)return i.close();let a=f_(JSON.stringify(r)+`
`);i.enqueue(a)}catch(r){i.error(r)}},async cancel(){var i;await((i=t.return)===null||i===void 0?void 0:i.call(t))}})}};function q7(n,e){return pi(this,arguments,function*(){var i,r,o,a;if(!n.body)throw e.abort(),typeof globalThis.navigator<"u"&&globalThis.navigator.product==="ReactNative"?new Cn("The default react-native fetch implementation does not support streaming. Please use expo/fetch: https://docs.expo.dev/versions/latest/sdk/expo/#expofetch-api"):new Cn("Attempted to iterate over a response with no body");let u=new e_,c=new Oa,p=sS(n.body);try{for(var g=!0,y=fi(W7(p)),v;v=yield Ce(y.next()),i=v.done,!i;g=!0){a=v.value,g=!1;let C=a;for(let T of c.decode(C)){let R=u.decode(T);R&&(yield yield Ce(R))}}}catch(C){r={error:C}}finally{try{!g&&!i&&(o=y.return)&&(yield Ce(o.call(y)))}finally{if(r)throw r.error}}for(let C of c.flush()){let T=u.decode(C);T&&(yield yield Ce(T))}})}function W7(n){return pi(this,arguments,function*(){var t,i,r,o;let a=new Uint8Array;try{for(var u=!0,c=fi(n),p;p=yield Ce(c.next()),t=p.done,!t;u=!0){o=p.value,u=!1;let g=o;if(g==null)continue;let y=g instanceof ArrayBuffer?new Uint8Array(g):typeof g=="string"?f_(g):g,v=new Uint8Array(a.length+y.length);v.set(a),v.set(y,a.length),a=v;let C;for(;(C=H7(a))!==-1;)yield yield Ce(a.slice(0,C)),a=a.slice(C)}}catch(g){i={error:g}}finally{try{!u&&!t&&(r=c.return)&&(yield Ce(r.call(c)))}finally{if(i)throw i.error}}a.length>0&&(yield yield Ce(a))})}var e_=class{constructor(){this.event=null,this.data=[],this.chunks=[]}decode(e){if(e.endsWith("\r")&&(e=e.substring(0,e.length-1)),!e){if(!this.event&&!this.data.length)return null;let o={event:this.event,data:this.data.join(`
`),raw:this.chunks};return this.event=null,this.data=[],this.chunks=[],o}if(this.chunks.push(e),e.startsWith(":"))return null;let[t,i,r]=j7(e,":");return r.startsWith(" ")&&(r=r.substring(1)),t==="event"?this.event=r:t==="data"&&this.data.push(r),null}};function j7(n,e){let t=n.indexOf(e);return t!==-1?[n.substring(0,t),e,n.substring(t+e.length)]:[n,"",""]}async function z7(n,e){let{response:t,requestLogID:i,retryOfRequestLogID:r,startTime:o}=e,a=await(async()=>{var u;if(e.options.stream)return gn(n).debug("response",t.status,t.url,t.headers,t.body),e.options.__streamClass?e.options.__streamClass.fromSSEResponse(t,e.controller,n):Xy.fromSSEResponse(t,e.controller,n);if(t.status===204)return null;if(e.options.__binaryResponse)return t;let c=t.headers.get("content-type"),p=(u=c?.split(";")[0])===null||u===void 0?void 0:u.trim();return p?.includes("application/json")||p?.endsWith("+json")?await t.json():await t.text()})();return gn(n).debug(`[${i}] response parsed`,Co({retryOfRequestLogID:r,url:t.url,status:t.status,body:a,durationMs:Date.now()-o})),a}var t_=class n extends Promise{constructor(e,t,i=z7){super(r=>{r(null)}),this.responsePromise=t,this.parseResponse=i,this.client=e}_thenUnwrap(e){return new n(this.client,this.responsePromise,async(t,i)=>e(await this.parseResponse(t,i),i))}asResponse(){return this.responsePromise.then(e=>e.response)}async withResponse(){let[e,t]=await Promise.all([this.parse(),this.asResponse()]);return{data:e,response:t}}parse(){return this.parsedPromise||(this.parsedPromise=this.responsePromise.then(e=>this.parseResponse(this.client,e))),this.parsedPromise}then(e,t){return this.parse().then(e,t)}catch(e){return this.parse().catch(e)}finally(e){return this.parse().finally(e)}};var cS=Symbol("brand.privateNullableHeaders");function*Y7(n){if(!n)return;if(cS in n){let{values:i,nulls:r}=n;yield*i.entries();for(let o of r)yield[o,null];return}let e=!1,t;n instanceof Headers?t=n.entries():S2(n)?t=n:(e=!0,t=Object.entries(n??{}));for(let i of t){let r=i[0];if(typeof r!="string")throw new TypeError("expected header name to be a string");let o=S2(i[1])?i[1]:[i[1]],a=!1;for(let u of o)u!==void 0&&(e&&!a&&(a=!0,yield[r,null]),yield[r,u])}}var eu=n=>{let e=new Headers,t=new Set;for(let i of n){let r=new Set;for(let[o,a]of Y7(i)){let u=o.toLowerCase();r.has(u)||(e.delete(o),r.add(u)),a===null?(e.delete(o),t.add(u)):(e.append(o,a),t.delete(u))}}return{[cS]:!0,values:e,nulls:t}};var dy=n=>{var e,t,i,r,o,a;if(typeof globalThis.process<"u")return(i=(t=(e=globalThis.process.env)===null||e===void 0?void 0:e[n])===null||t===void 0?void 0:t.trim())!==null&&i!==void 0?i:void 0;if(typeof globalThis.Deno<"u")return(a=(o=(r=globalThis.Deno.env)===null||r===void 0?void 0:r.get)===null||o===void 0?void 0:o.call(r,n))===null||a===void 0?void 0:a.trim()};var mS,J7=(()=>{class n{constructor(t){var i,r,o,a,u,c,p,{baseURL:g=dy("GEMINI_NEXT_GEN_API_BASE_URL"),apiKey:y=(i=dy("GEMINI_API_KEY"))!==null&&i!==void 0?i:null,apiVersion:v="v1beta"}=t,C=qm(t,["baseURL","apiKey","apiVersion"]);let T=Object.assign(Object.assign({apiKey:y,apiVersion:v},C),{baseURL:g||"https://generativelanguage.googleapis.com"});this.baseURL=T.baseURL,this.timeout=(r=T.timeout)!==null&&r!==void 0?r:n.DEFAULT_TIMEOUT,this.logger=(o=T.logger)!==null&&o!==void 0?o:console;let R="warn";this.logLevel=R,this.logLevel=(u=(a=M2(T.logLevel,"ClientOptions.logLevel",this))!==null&&a!==void 0?a:M2(dy("GEMINI_NEXT_GEN_API_LOG"),"process.env['GEMINI_NEXT_GEN_API_LOG']",this))!==null&&u!==void 0?u:R,this.fetchOptions=T.fetchOptions,this.maxRetries=(c=T.maxRetries)!==null&&c!==void 0?c:2,this.fetch=(p=T.fetch)!==null&&p!==void 0?p:I7(),this.encoder=R7,this._options=T,this.apiKey=y,this.apiVersion=v,this.clientAdapter=T.clientAdapter}withOptions(t){return new this.constructor(Object.assign(Object.assign(Object.assign({},this._options),{baseURL:this.baseURL,maxRetries:this.maxRetries,timeout:this.timeout,logger:this.logger,logLevel:this.logLevel,fetch:this.fetch,fetchOptions:this.fetchOptions,apiKey:this.apiKey,apiVersion:this.apiVersion}),t))}baseURLOverridden(){return this.baseURL!=="https://generativelanguage.googleapis.com"}defaultQuery(){return this._options.defaultQuery}validateHeaders({values:t,nulls:i}){if(!(t.has("authorization")||t.has("x-goog-api-key"))&&!(this.apiKey&&t.get("x-goog-api-key"))&&!i.has("x-goog-api-key"))throw new Error('Could not resolve authentication method. Expected the apiKey to be set. Or for the "x-goog-api-key" headers to be explicitly omitted')}async authHeaders(t){let i=eu([t.headers]);if(!(i.values.has("authorization")||i.values.has("x-goog-api-key"))){if(this.apiKey)return eu([{"x-goog-api-key":this.apiKey}]);if(this.clientAdapter.isVertexAI())return eu([await this.clientAdapter.getAuthHeaders()])}}stringifyQuery(t){return Object.entries(t).filter(([i,r])=>typeof r<"u").map(([i,r])=>{if(typeof r=="string"||typeof r=="number"||typeof r=="boolean")return`${encodeURIComponent(i)}=${encodeURIComponent(r)}`;if(r===null)return`${encodeURIComponent(i)}=`;throw new Cn(`Cannot stringify type ${typeof r}; Expected string, number, boolean, or null. If you need to pass nested query parameters, you can manually encode them, e.g. { query: { 'foo[key1]': value1, 'foo[key2]': value2 } }, and please open a GitHub issue requesting better support for your use case.`)}).join("&")}getUserAgent(){return`${this.constructor.name}/JS ${Pa}`}defaultIdempotencyKey(){return`stainless-node-retry-${f7()}`}makeStatusError(t,i,r,o){return xn.generate(t,i,r,o)}buildURL(t,i,r){let o=!this.baseURLOverridden()&&r||this.baseURL,a=h7(t)?new URL(t):new URL(o+(o.endsWith("/")&&t.startsWith("/")?t.slice(1):t)),u=this.defaultQuery();return v7(u)||(i=Object.assign(Object.assign({},u),i)),typeof i=="object"&&i&&!Array.isArray(i)&&(a.search=this.stringifyQuery(i)),a.toString()}async prepareOptions(t){if(this.clientAdapter&&this.clientAdapter.isVertexAI()&&!t.path.startsWith(`/${this.apiVersion}/projects/`)){let i=t.path.slice(this.apiVersion.length+1);t.path=`/${this.apiVersion}/projects/${this.clientAdapter.getProject()}/locations/${this.clientAdapter.getLocation()}${i}`}}async prepareRequest(t,{url:i,options:r}){}get(t,i){return this.methodRequest("get",t,i)}post(t,i){return this.methodRequest("post",t,i)}patch(t,i){return this.methodRequest("patch",t,i)}put(t,i){return this.methodRequest("put",t,i)}delete(t,i){return this.methodRequest("delete",t,i)}methodRequest(t,i,r){return this.request(Promise.resolve(r).then(o=>Object.assign({method:t,path:i},o)))}request(t,i=null){return new t_(this,this.makeRequest(t,i,void 0))}async makeRequest(t,i,r){var o,a,u;let c=await t,p=(o=c.maxRetries)!==null&&o!==void 0?o:this.maxRetries;i==null&&(i=p),await this.prepareOptions(c);let{req:g,url:y,timeout:v}=await this.buildRequest(c,{retryCount:p-i});await this.prepareRequest(g,{url:y,options:c});let C="log_"+(Math.random()*(1<<24)|0).toString(16).padStart(6,"0"),T=r===void 0?"":`, retryOf: ${r}`,R=Date.now();if(gn(this).debug(`[${C}] sending request`,Co({retryOfRequestLogID:r,method:c.method,url:y,options:c,headers:g.headers})),!((a=c.signal)===null||a===void 0)&&a.aborted)throw new ou;let F=new AbortController,P=await this.fetchWithTimeout(y,g,v,F).catch(Ky),H=Date.now();if(P instanceof globalThis.Error){let Z=`retrying, ${i} attempts remaining`;if(!((u=c.signal)===null||u===void 0)&&u.aborted)throw new ou;let ie=Jy(P)||/timed? ?out/i.test(String(P)+("cause"in P?String(P.cause):""));if(i)return gn(this).info(`[${C}] connection ${ie?"timed out":"failed"} - ${Z}`),gn(this).debug(`[${C}] connection ${ie?"timed out":"failed"} (${Z})`,Co({retryOfRequestLogID:r,url:y,durationMs:H-R,message:P.message})),this.retryRequest(c,i,r??C);throw gn(this).info(`[${C}] connection ${ie?"timed out":"failed"} - error; no more retries left`),gn(this).debug(`[${C}] connection ${ie?"timed out":"failed"} (error; no more retries left)`,Co({retryOfRequestLogID:r,url:y,durationMs:H-R,message:P.message})),ie?new Wm:new La({cause:P})}let q=`[${C}${T}] ${g.method} ${y} ${P.ok?"succeeded":"failed"} with status ${P.status} in ${H-R}ms`;if(!P.ok){let Z=await this.shouldRetry(P);if(i&&Z){let Me=`retrying, ${i} attempts remaining`;return await A7(P.body),gn(this).info(`${q} - ${Me}`),gn(this).debug(`[${C}] response error (${Me})`,Co({retryOfRequestLogID:r,url:P.url,status:P.status,headers:P.headers,durationMs:H-R})),this.retryRequest(c,i,r??C,P.headers)}let ie=Z?"error; no more retries left":"error; not retryable";gn(this).info(`${q} - ${ie}`);let me=await P.text().catch(Me=>Ky(Me).message),de=b7(me),$e=de?void 0:me;throw gn(this).debug(`[${C}] response error (${ie})`,Co({retryOfRequestLogID:r,url:P.url,status:P.status,headers:P.headers,message:$e,durationMs:Date.now()-R})),this.makeStatusError(P.status,de,$e,P.headers)}return gn(this).info(q),gn(this).debug(`[${C}] response start`,Co({retryOfRequestLogID:r,url:P.url,status:P.status,headers:P.headers,durationMs:H-R})),{response:P,options:c,controller:F,requestLogID:C,retryOfRequestLogID:r,startTime:R}}async fetchWithTimeout(t,i,r,o){let a=i||{},{signal:u,method:c}=a,p=qm(a,["signal","method"]);u&&u.addEventListener("abort",()=>o.abort());let g=setTimeout(()=>o.abort(),r),y=globalThis.ReadableStream&&p.body instanceof globalThis.ReadableStream||typeof p.body=="object"&&p.body!==null&&Symbol.asyncIterator in p.body,v=Object.assign(Object.assign(Object.assign({signal:o.signal},y?{duplex:"half"}:{}),{method:"GET"}),p);c&&(v.method=c.toUpperCase());try{return await this.fetch.call(void 0,t,v)}finally{clearTimeout(g)}}async shouldRetry(t){let i=t.headers.get("x-should-retry");return i==="true"?!0:i==="false"?!1:t.status===408||t.status===409||t.status===429||t.status>=500}async retryRequest(t,i,r,o){var a;let u,c=o?.get("retry-after-ms");if(c){let g=parseFloat(c);Number.isNaN(g)||(u=g)}let p=o?.get("retry-after");if(p&&!u){let g=parseFloat(p);Number.isNaN(g)?u=Date.parse(p)-Date.now():u=g*1e3}if(!(u&&0<=u&&u<60*1e3)){let g=(a=t.maxRetries)!==null&&a!==void 0?a:this.maxRetries;u=this.calculateDefaultRetryTimeoutMillis(i,g)}return await E7(u),this.makeRequest(t,i-1,r)}calculateDefaultRetryTimeoutMillis(t,i){let a=i-t,u=Math.min(.5*Math.pow(2,a),8),c=1-Math.random()*.25;return u*c*1e3}async buildRequest(t,{retryCount:i=0}={}){var r,o,a;let u=Object.assign({},t),{method:c,path:p,query:g,defaultBaseURL:y}=u,v=this.buildURL(p,g,y);"timeout"in u&&x7("timeout",u.timeout),u.timeout=(r=u.timeout)!==null&&r!==void 0?r:this.timeout;let{bodyHeaders:C,body:T}=this.buildBody({options:u}),R=await this.buildHeaders({options:t,method:c,bodyHeaders:C,retryCount:i});return{req:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({method:c,headers:R},u.signal&&{signal:u.signal}),globalThis.ReadableStream&&T instanceof globalThis.ReadableStream&&{duplex:"half"}),T&&{body:T}),(o=this.fetchOptions)!==null&&o!==void 0?o:{}),(a=u.fetchOptions)!==null&&a!==void 0?a:{}),url:v,timeout:u.timeout}}async buildHeaders({options:t,method:i,bodyHeaders:r,retryCount:o}){let a={};this.idempotencyHeader&&i!=="get"&&(t.idempotencyKey||(t.idempotencyKey=this.defaultIdempotencyKey()),a[this.idempotencyHeader]=t.idempotencyKey);let u=await this.authHeaders(t),c=eu([a,Object.assign(Object.assign({Accept:"application/json","User-Agent":this.getUserAgent(),"X-Stainless-Retry-Count":String(o)},t.timeout?{"X-Stainless-Timeout":String(Math.trunc(t.timeout/1e3))}:{}),T7()),this._options.defaultHeaders,r,t.headers,u]);return this.validateHeaders(c),c.values}buildBody({options:{body:t,headers:i}}){if(!t)return{bodyHeaders:void 0,body:void 0};let r=eu([i]);return ArrayBuffer.isView(t)||t instanceof ArrayBuffer||t instanceof DataView||typeof t=="string"&&r.values.has("content-type")||globalThis.Blob&&t instanceof globalThis.Blob||t instanceof FormData||t instanceof URLSearchParams||globalThis.ReadableStream&&t instanceof globalThis.ReadableStream?{bodyHeaders:void 0,body:t}:typeof t=="object"&&(Symbol.asyncIterator in t||Symbol.iterator in t&&"next"in t&&typeof t.next=="function")?{bodyHeaders:void 0,body:M7(t)}:this.encoder({body:t,headers:r})}}return n.DEFAULT_TIMEOUT=6e4,n})(),Ft=class extends J7{constructor(){super(...arguments),this.interactions=new tp(this)}};mS=Ft;Ft.GeminiNextGenAPIClient=mS;Ft.GeminiNextGenAPIClientError=Cn;Ft.APIError=xn;Ft.APIConnectionError=La;Ft.APIConnectionTimeoutError=Wm;Ft.APIUserAbortError=ou;Ft.NotFoundError=Jm;Ft.ConflictError=Km;Ft.RateLimitError=Zm;Ft.BadRequestError=jm;Ft.AuthenticationError=zm;Ft.InternalServerError=Xm;Ft.PermissionDeniedError=Ym;Ft.UnprocessableEntityError=Qm;Ft.toFile=V7;Ft.Interactions=tp;function K7(n,e){let t={},i=f(n,["name"]);return i!=null&&h(t,["_url","name"],i),t}function Q7(n,e){let t={},i=f(n,["name"]);return i!=null&&h(t,["_url","name"],i),t}function Z7(n,e){let t={},i=f(n,["sdkHttpResponse"]);return i!=null&&h(t,["sdkHttpResponse"],i),t}function X7(n,e){let t={},i=f(n,["sdkHttpResponse"]);return i!=null&&h(t,["sdkHttpResponse"],i),t}function eV(n,e,t){let i={};if(f(n,["validationDataset"])!==void 0)throw new Error("validationDataset parameter is not supported in Gemini API.");let r=f(n,["tunedModelDisplayName"]);if(e!==void 0&&r!=null&&h(e,["displayName"],r),f(n,["description"])!==void 0)throw new Error("description parameter is not supported in Gemini API.");let o=f(n,["epochCount"]);e!==void 0&&o!=null&&h(e,["tuningTask","hyperparameters","epochCount"],o);let a=f(n,["learningRateMultiplier"]);if(a!=null&&h(i,["tuningTask","hyperparameters","learningRateMultiplier"],a),f(n,["exportLastCheckpointOnly"])!==void 0)throw new Error("exportLastCheckpointOnly parameter is not supported in Gemini API.");if(f(n,["preTunedModelCheckpointId"])!==void 0)throw new Error("preTunedModelCheckpointId parameter is not supported in Gemini API.");if(f(n,["adapterSize"])!==void 0)throw new Error("adapterSize parameter is not supported in Gemini API.");let u=f(n,["batchSize"]);e!==void 0&&u!=null&&h(e,["tuningTask","hyperparameters","batchSize"],u);let c=f(n,["learningRate"]);if(e!==void 0&&c!=null&&h(e,["tuningTask","hyperparameters","learningRate"],c),f(n,["labels"])!==void 0)throw new Error("labels parameter is not supported in Gemini API.");if(f(n,["beta"])!==void 0)throw new Error("beta parameter is not supported in Gemini API.");return i}function tV(n,e,t){let i={},r=f(t,["config","method"]);if(r===void 0&&(r="SUPERVISED_FINE_TUNING"),r==="SUPERVISED_FINE_TUNING"){let C=f(n,["validationDataset"]);e!==void 0&&C!=null&&h(e,["supervisedTuningSpec"],R2(C))}else if(r==="PREFERENCE_TUNING"){let C=f(n,["validationDataset"]);e!==void 0&&C!=null&&h(e,["preferenceOptimizationSpec"],R2(C))}let o=f(n,["tunedModelDisplayName"]);e!==void 0&&o!=null&&h(e,["tunedModelDisplayName"],o);let a=f(n,["description"]);e!==void 0&&a!=null&&h(e,["description"],a);let u=f(t,["config","method"]);if(u===void 0&&(u="SUPERVISED_FINE_TUNING"),u==="SUPERVISED_FINE_TUNING"){let C=f(n,["epochCount"]);e!==void 0&&C!=null&&h(e,["supervisedTuningSpec","hyperParameters","epochCount"],C)}else if(u==="PREFERENCE_TUNING"){let C=f(n,["epochCount"]);e!==void 0&&C!=null&&h(e,["preferenceOptimizationSpec","hyperParameters","epochCount"],C)}let c=f(t,["config","method"]);if(c===void 0&&(c="SUPERVISED_FINE_TUNING"),c==="SUPERVISED_FINE_TUNING"){let C=f(n,["learningRateMultiplier"]);e!==void 0&&C!=null&&h(e,["supervisedTuningSpec","hyperParameters","learningRateMultiplier"],C)}else if(c==="PREFERENCE_TUNING"){let C=f(n,["learningRateMultiplier"]);e!==void 0&&C!=null&&h(e,["preferenceOptimizationSpec","hyperParameters","learningRateMultiplier"],C)}let p=f(t,["config","method"]);if(p===void 0&&(p="SUPERVISED_FINE_TUNING"),p==="SUPERVISED_FINE_TUNING"){let C=f(n,["exportLastCheckpointOnly"]);e!==void 0&&C!=null&&h(e,["supervisedTuningSpec","exportLastCheckpointOnly"],C)}else if(p==="PREFERENCE_TUNING"){let C=f(n,["exportLastCheckpointOnly"]);e!==void 0&&C!=null&&h(e,["preferenceOptimizationSpec","exportLastCheckpointOnly"],C)}let g=f(t,["config","method"]);if(g===void 0&&(g="SUPERVISED_FINE_TUNING"),g==="SUPERVISED_FINE_TUNING"){let C=f(n,["adapterSize"]);e!==void 0&&C!=null&&h(e,["supervisedTuningSpec","hyperParameters","adapterSize"],C)}else if(g==="PREFERENCE_TUNING"){let C=f(n,["adapterSize"]);e!==void 0&&C!=null&&h(e,["preferenceOptimizationSpec","hyperParameters","adapterSize"],C)}if(f(n,["batchSize"])!==void 0)throw new Error("batchSize parameter is not supported in Vertex AI.");if(f(n,["learningRate"])!==void 0)throw new Error("learningRate parameter is not supported in Vertex AI.");let y=f(n,["labels"]);e!==void 0&&y!=null&&h(e,["labels"],y);let v=f(n,["beta"]);return e!==void 0&&v!=null&&h(e,["preferenceOptimizationSpec","hyperParameters","beta"],v),i}function nV(n,e){let t={},i=f(n,["baseModel"]);i!=null&&h(t,["baseModel"],i);let r=f(n,["preTunedModel"]);r!=null&&h(t,["preTunedModel"],r);let o=f(n,["trainingDataset"]);o!=null&&pV(o);let a=f(n,["config"]);return a!=null&&eV(a,t),t}function iV(n,e){let t={},i=f(n,["baseModel"]);i!=null&&h(t,["baseModel"],i);let r=f(n,["preTunedModel"]);r!=null&&h(t,["preTunedModel"],r);let o=f(n,["trainingDataset"]);o!=null&&fV(o,t,e);let a=f(n,["config"]);return a!=null&&tV(a,t,e),t}function rV(n,e){let t={},i=f(n,["name"]);return i!=null&&h(t,["_url","name"],i),t}function oV(n,e){let t={},i=f(n,["name"]);return i!=null&&h(t,["_url","name"],i),t}function aV(n,e,t){let i={},r=f(n,["pageSize"]);e!==void 0&&r!=null&&h(e,["_query","pageSize"],r);let o=f(n,["pageToken"]);e!==void 0&&o!=null&&h(e,["_query","pageToken"],o);let a=f(n,["filter"]);return e!==void 0&&a!=null&&h(e,["_query","filter"],a),i}function sV(n,e,t){let i={},r=f(n,["pageSize"]);e!==void 0&&r!=null&&h(e,["_query","pageSize"],r);let o=f(n,["pageToken"]);e!==void 0&&o!=null&&h(e,["_query","pageToken"],o);let a=f(n,["filter"]);return e!==void 0&&a!=null&&h(e,["_query","filter"],a),i}function lV(n,e){let t={},i=f(n,["config"]);return i!=null&&aV(i,t),t}function uV(n,e){let t={},i=f(n,["config"]);return i!=null&&sV(i,t),t}function dV(n,e){let t={},i=f(n,["sdkHttpResponse"]);i!=null&&h(t,["sdkHttpResponse"],i);let r=f(n,["nextPageToken"]);r!=null&&h(t,["nextPageToken"],r);let o=f(n,["tunedModels"]);if(o!=null){let a=o;Array.isArray(a)&&(a=a.map(u=>pS(u))),h(t,["tuningJobs"],a)}return t}function cV(n,e){let t={},i=f(n,["sdkHttpResponse"]);i!=null&&h(t,["sdkHttpResponse"],i);let r=f(n,["nextPageToken"]);r!=null&&h(t,["nextPageToken"],r);let o=f(n,["tuningJobs"]);if(o!=null){let a=o;Array.isArray(a)&&(a=a.map(u=>n_(u))),h(t,["tuningJobs"],a)}return t}function mV(n,e){let t={},i=f(n,["name"]);i!=null&&h(t,["model"],i);let r=f(n,["name"]);return r!=null&&h(t,["endpoint"],r),t}function pV(n,e){let t={};if(f(n,["gcsUri"])!==void 0)throw new Error("gcsUri parameter is not supported in Gemini API.");if(f(n,["vertexDatasetResource"])!==void 0)throw new Error("vertexDatasetResource parameter is not supported in Gemini API.");let i=f(n,["examples"]);if(i!=null){let r=i;Array.isArray(r)&&(r=r.map(o=>o)),h(t,["examples","examples"],r)}return t}function fV(n,e,t){let i={},r=f(t,["config","method"]);if(r===void 0&&(r="SUPERVISED_FINE_TUNING"),r==="SUPERVISED_FINE_TUNING"){let a=f(n,["gcsUri"]);e!==void 0&&a!=null&&h(e,["supervisedTuningSpec","trainingDatasetUri"],a)}else if(r==="PREFERENCE_TUNING"){let a=f(n,["gcsUri"]);e!==void 0&&a!=null&&h(e,["preferenceOptimizationSpec","trainingDatasetUri"],a)}let o=f(t,["config","method"]);if(o===void 0&&(o="SUPERVISED_FINE_TUNING"),o==="SUPERVISED_FINE_TUNING"){let a=f(n,["vertexDatasetResource"]);e!==void 0&&a!=null&&h(e,["supervisedTuningSpec","trainingDatasetUri"],a)}else if(o==="PREFERENCE_TUNING"){let a=f(n,["vertexDatasetResource"]);e!==void 0&&a!=null&&h(e,["preferenceOptimizationSpec","trainingDatasetUri"],a)}if(f(n,["examples"])!==void 0)throw new Error("examples parameter is not supported in Vertex AI.");return i}function pS(n,e){let t={},i=f(n,["sdkHttpResponse"]);i!=null&&h(t,["sdkHttpResponse"],i);let r=f(n,["name"]);r!=null&&h(t,["name"],r);let o=f(n,["state"]);o!=null&&h(t,["state"],$2(o));let a=f(n,["createTime"]);a!=null&&h(t,["createTime"],a);let u=f(n,["tuningTask","startTime"]);u!=null&&h(t,["startTime"],u);let c=f(n,["tuningTask","completeTime"]);c!=null&&h(t,["endTime"],c);let p=f(n,["updateTime"]);p!=null&&h(t,["updateTime"],p);let g=f(n,["description"]);g!=null&&h(t,["description"],g);let y=f(n,["baseModel"]);y!=null&&h(t,["baseModel"],y);let v=f(n,["_self"]);return v!=null&&h(t,["tunedModel"],mV(v)),t}function n_(n,e){let t={},i=f(n,["sdkHttpResponse"]);i!=null&&h(t,["sdkHttpResponse"],i);let r=f(n,["name"]);r!=null&&h(t,["name"],r);let o=f(n,["state"]);o!=null&&h(t,["state"],$2(o));let a=f(n,["createTime"]);a!=null&&h(t,["createTime"],a);let u=f(n,["startTime"]);u!=null&&h(t,["startTime"],u);let c=f(n,["endTime"]);c!=null&&h(t,["endTime"],c);let p=f(n,["updateTime"]);p!=null&&h(t,["updateTime"],p);let g=f(n,["error"]);g!=null&&h(t,["error"],g);let y=f(n,["description"]);y!=null&&h(t,["description"],y);let v=f(n,["baseModel"]);v!=null&&h(t,["baseModel"],v);let C=f(n,["tunedModel"]);C!=null&&h(t,["tunedModel"],C);let T=f(n,["preTunedModel"]);T!=null&&h(t,["preTunedModel"],T);let R=f(n,["supervisedTuningSpec"]);R!=null&&h(t,["supervisedTuningSpec"],R);let F=f(n,["preferenceOptimizationSpec"]);F!=null&&h(t,["preferenceOptimizationSpec"],F);let P=f(n,["tuningDataStats"]);P!=null&&h(t,["tuningDataStats"],P);let H=f(n,["encryptionSpec"]);H!=null&&h(t,["encryptionSpec"],H);let q=f(n,["partnerModelTuningSpec"]);q!=null&&h(t,["partnerModelTuningSpec"],q);let Z=f(n,["customBaseModel"]);Z!=null&&h(t,["customBaseModel"],Z);let ie=f(n,["experiment"]);ie!=null&&h(t,["experiment"],ie);let me=f(n,["labels"]);me!=null&&h(t,["labels"],me);let de=f(n,["outputUri"]);de!=null&&h(t,["outputUri"],de);let $e=f(n,["pipelineJob"]);$e!=null&&h(t,["pipelineJob"],$e);let ge=f(n,["serviceAccount"]);ge!=null&&h(t,["serviceAccount"],ge);let Me=f(n,["tunedModelDisplayName"]);Me!=null&&h(t,["tunedModelDisplayName"],Me);let wt=f(n,["veoTuningSpec"]);return wt!=null&&h(t,["veoTuningSpec"],wt),t}function gV(n,e){let t={},i=f(n,["sdkHttpResponse"]);i!=null&&h(t,["sdkHttpResponse"],i);let r=f(n,["name"]);r!=null&&h(t,["name"],r);let o=f(n,["metadata"]);o!=null&&h(t,["metadata"],o);let a=f(n,["done"]);a!=null&&h(t,["done"],a);let u=f(n,["error"]);return u!=null&&h(t,["error"],u),t}function R2(n,e){let t={},i=f(n,["gcsUri"]);i!=null&&h(t,["validationDatasetUri"],i);let r=f(n,["vertexDatasetResource"]);return r!=null&&h(t,["validationDatasetUri"],r),t}var i_=class extends gi{constructor(e){super(),this.apiClient=e,this.list=async(t={})=>new er(Mr.PAGED_ITEM_TUNING_JOBS,i=>this.listInternal(i),await this.listInternal(t),t),this.get=async t=>await this.getInternal(t),this.tune=async t=>{var i;if(this.apiClient.isVertexAI())if(t.baseModel.startsWith("projects/")){let r={tunedModelName:t.baseModel};!((i=t.config)===null||i===void 0)&&i.preTunedModelCheckpointId&&(r.checkpointId=t.config.preTunedModelCheckpointId);let o=Object.assign(Object.assign({},t),{preTunedModel:r});return o.baseModel=void 0,await this.tuneInternal(o)}else{let r=Object.assign({},t);return await this.tuneInternal(r)}else{let r=Object.assign({},t),o=await this.tuneMldevInternal(r),a="";return o.metadata!==void 0&&o.metadata.tunedModel!==void 0?a=o.metadata.tunedModel:o.name!==void 0&&o.name.includes("/operations/")&&(a=o.name.split("/operations/")[0]),{name:a,state:P2.JOB_STATE_QUEUED}}}}async getInternal(e){var t,i,r,o;let a,u="",c={};if(this.apiClient.isVertexAI()){let p=oV(e);return u=te("{name}",p._url),c=p._query,delete p._url,delete p._query,a=this.apiClient.request({path:u,queryParams:c,body:JSON.stringify(p),httpMethod:"GET",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(g=>g.json().then(y=>{let v=y;return v.sdkHttpResponse={headers:g.headers},v})),a.then(g=>n_(g))}else{let p=rV(e);return u=te("{name}",p._url),c=p._query,delete p._url,delete p._query,a=this.apiClient.request({path:u,queryParams:c,body:JSON.stringify(p),httpMethod:"GET",httpOptions:(r=e.config)===null||r===void 0?void 0:r.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(g=>g.json().then(y=>{let v=y;return v.sdkHttpResponse={headers:g.headers},v})),a.then(g=>pS(g))}}async listInternal(e){var t,i,r,o;let a,u="",c={};if(this.apiClient.isVertexAI()){let p=uV(e);return u=te("tuningJobs",p._url),c=p._query,delete p._url,delete p._query,a=this.apiClient.request({path:u,queryParams:c,body:JSON.stringify(p),httpMethod:"GET",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(g=>g.json().then(y=>{let v=y;return v.sdkHttpResponse={headers:g.headers},v})),a.then(g=>{let y=cV(g),v=new Om;return Object.assign(v,y),v})}else{let p=lV(e);return u=te("tunedModels",p._url),c=p._query,delete p._url,delete p._query,a=this.apiClient.request({path:u,queryParams:c,body:JSON.stringify(p),httpMethod:"GET",httpOptions:(r=e.config)===null||r===void 0?void 0:r.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(g=>g.json().then(y=>{let v=y;return v.sdkHttpResponse={headers:g.headers},v})),a.then(g=>{let y=dV(g),v=new Om;return Object.assign(v,y),v})}}async cancel(e){var t,i,r,o;let a,u="",c={};if(this.apiClient.isVertexAI()){let p=Q7(e);return u=te("{name}:cancel",p._url),c=p._query,delete p._url,delete p._query,a=this.apiClient.request({path:u,queryParams:c,body:JSON.stringify(p),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(g=>g.json().then(y=>{let v=y;return v.sdkHttpResponse={headers:g.headers},v})),a.then(g=>{let y=X7(g),v=new Bm;return Object.assign(v,y),v})}else{let p=K7(e);return u=te("{name}:cancel",p._url),c=p._query,delete p._url,delete p._query,a=this.apiClient.request({path:u,queryParams:c,body:JSON.stringify(p),httpMethod:"POST",httpOptions:(r=e.config)===null||r===void 0?void 0:r.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(g=>g.json().then(y=>{let v=y;return v.sdkHttpResponse={headers:g.headers},v})),a.then(g=>{let y=Z7(g),v=new Bm;return Object.assign(v,y),v})}}async tuneInternal(e){var t,i;let r,o="",a={};if(this.apiClient.isVertexAI()){let u=iV(e,e);return o=te("tuningJobs",u._url),a=u._query,delete u._url,delete u._query,r=this.apiClient.request({path:o,queryParams:a,body:JSON.stringify(u),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(c=>c.json().then(p=>{let g=p;return g.sdkHttpResponse={headers:c.headers},g})),r.then(c=>n_(c))}else throw new Error("This method is only supported by the Vertex AI.")}async tuneMldevInternal(e){var t,i;let r,o="",a={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{let u=nV(e);return o=te("tunedModels",u._url),a=u._query,delete u._url,delete u._query,r=this.apiClient.request({path:o,queryParams:a,body:JSON.stringify(u),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(c=>c.json().then(p=>{let g=p;return g.sdkHttpResponse={headers:c.headers},g})),r.then(c=>gV(c))}}};var r_=class{async download(e,t){throw new Error("Download to file is not supported in the browser, please use a browser compliant download like an <a> tag.")}},hV=1024*1024*8,yV=3,_V=1e3,vV=2,ip="x-goog-upload-status";async function CV(n,e,t){var i;let r=await fS(n,e,t),o=await r?.json();if(((i=r?.headers)===null||i===void 0?void 0:i[ip])!=="final")throw new Error("Failed to upload file: Upload status is not finalized.");return o.file}async function xV(n,e,t){var i;let r=await fS(n,e,t),o=await r?.json();if(((i=r?.headers)===null||i===void 0?void 0:i[ip])!=="final")throw new Error("Failed to upload file: Upload status is not finalized.");let a=F2(o),u=new Ty;return Object.assign(u,a),u}async function fS(n,e,t){var i,r;let o=0,a=0,u=new iu(new Response),c="upload";for(o=n.size;a<o;){let p=Math.min(hV,o-a),g=n.slice(a,a+p);a+p>=o&&(c+=", finalize");let y=0,v=_V;for(;y<yV&&(u=await t.request({path:"",body:g,httpMethod:"POST",httpOptions:{apiVersion:"",baseUrl:e,headers:{"X-Goog-Upload-Command":c,"X-Goog-Upload-Offset":String(a),"Content-Length":String(p)}}}),!(!((i=u?.headers)===null||i===void 0)&&i[ip]));)y++,await EV(v),v=v*vV;if(a+=p,((r=u?.headers)===null||r===void 0?void 0:r[ip])!=="active")break;if(o<=a)throw new Error("All content has been uploaded, but the upload status is not finalized.")}return u}async function bV(n){return{size:n.size,type:n.type}}function EV(n){return new Promise(e=>setTimeout(e,n))}var o_=class{async upload(e,t,i){if(typeof e=="string")throw new Error("File path is not supported in browser uploader.");return await CV(e,t,i)}async uploadToFileSearchStore(e,t,i){if(typeof e=="string")throw new Error("File path is not supported in browser uploader.");return await xV(e,t,i)}async stat(e){if(typeof e=="string")throw new Error("File path is not supported in browser uploader.");return await bV(e)}};var a_=class{create(e,t,i){return new s_(e,t,i)}},s_=class{constructor(e,t,i){this.url=e,this.headers=t,this.callbacks=i}connect(){this.ws=new WebSocket(this.url),this.ws.onopen=this.callbacks.onopen,this.ws.onerror=this.callbacks.onerror,this.ws.onclose=this.callbacks.onclose,this.ws.onmessage=this.callbacks.onmessage}send(e){if(this.ws===void 0)throw new Error("WebSocket is not connected");this.ws.send(e)}close(){if(this.ws===void 0)throw new Error("WebSocket is not connected");this.ws.close()}};var N2="x-goog-api-key",l_=class{constructor(e){this.apiKey=e}async addAuthHeaders(e,t){if(e.get(N2)===null){if(this.apiKey.startsWith("auth_tokens/"))throw new Error("Ephemeral tokens are only supported by the live API.");if(!this.apiKey)throw new Error("API key is missing. Please provide a valid API key.");e.append(N2,this.apiKey)}}};var SV="gl-node/",rp=class{get interactions(){if(this._interactions!==void 0)return this._interactions;console.warn("GoogleGenAI.interactions: Interactions usage is experimental and may change in future versions.");let e=this.httpOptions;e?.extraBody&&console.warn("GoogleGenAI.interactions: Client level httpOptions.extraBody is not supported by the interactions client and will be ignored.");let t=new Ft({baseURL:this.apiClient.getBaseUrl(),apiKey:this.apiKey,apiVersion:this.apiClient.getApiVersion(),clientAdapter:this.apiClient,defaultHeaders:this.apiClient.getDefaultHeaders(),timeout:e?.timeout});return this._interactions=t.interactions,this._interactions}constructor(e){var t;if(e.apiKey==null)throw new Error("An API Key must be set when running in a browser");if(e.project||e.location)throw new Error("Vertex AI project based authentication is not supported on browser runtimes. Please do not provide a project or location.");this.vertexai=(t=e.vertexai)!==null&&t!==void 0?t:!1,this.apiKey=e.apiKey;let i=QR(e.httpOptions,e.vertexai,void 0,void 0);i&&(e.httpOptions?e.httpOptions.baseUrl=i:e.httpOptions={baseUrl:i}),this.apiVersion=e.apiVersion,this.httpOptions=e.httpOptions;let r=new l_(this.apiKey);this.apiClient=new Oy({auth:r,apiVersion:this.apiVersion,apiKey:this.apiKey,vertexai:this.vertexai,httpOptions:this.httpOptions,userAgentExtra:SV+"web",uploader:new o_,downloader:new r_}),this.models=new qy(this.apiClient),this.live=new Hy(this.apiClient,r,new a_),this.batches=new Ay(this.apiClient),this.chats=new Ny(this.models,this.apiClient),this.caches=new Ry(this.apiClient),this.files=new Py(this.apiClient),this.operations=new Wy(this.apiClient),this.authTokens=new jy(this.apiClient),this.tunings=new i_(this.apiClient),this.fileSearchStores=new Yy(this.apiClient)}};var bo=class bo{constructor(){this.ai=null;this.financialInsightState=D("idle");this.financialInsight=D(null);this.financialInsightError=D(null);this.basketAnalysisState=D("idle");this.basketAnalysis=D(null);this.basketAnalysisError=D(null);let e=typeof process<"u"&&process.env?process.env.API_KEY:void 0;e?this.ai=new rp({apiKey:e}):console.error("API_KEY environment variable not set. AI features will not be available.")}async generateFinancialInsights(e,t){if(!this.ai){this.financialInsightError.set("Gemini AI \u5BA2\u6236\u7AEF\u672A\u521D\u59CB\u5316\u3002\u8ACB\u6AA2\u67E5 API \u91D1\u9470\u3002"),this.financialInsightState.set("error");return}this.financialInsightState.set("loading"),this.financialInsightError.set(null),this.financialInsight.set(null);let i=`
      Analyze the following financial data for a small business.
      IMPORTANT: All textual analysis and recommendations in the response must be in Traditional Chinese. The JSON keys must remain in English as specified in the schema.

      Financial Summary:
      - Total Revenue: ${e.totalRevenue.toFixed(2)}
      - Total Expenses: ${e.totalExpenses.toFixed(2)}
      - Net Income: ${e.netIncome.toFixed(2)}

      Monthly Performance (Revenue vs Expenses):
      ${t.map(r=>`- ${r.month}: Revenue ${r.revenue.toFixed(2)}, Expenses ${r.expenses.toFixed(2)}`).join(`
`)}

      Based on this data, provide:
      1. Two key positive trends.
      2. Two potential areas for improvement or concern.
      3. Two actionable strategic recommendations.
    `;try{let r=await this.ai.models.generateContent({model:"gemini-2.5-flash",contents:i,config:{responseMimeType:"application/json",responseSchema:{type:yt.OBJECT,properties:{positive_trends:{type:yt.ARRAY,items:{type:yt.STRING}},areas_for_improvement:{type:yt.ARRAY,items:{type:yt.STRING}},strategic_recommendations:{type:yt.ARRAY,items:{type:yt.STRING}}}}}}),o=JSON.parse(r.text);this.financialInsight.set(o),this.financialInsightState.set("success")}catch(r){console.error(r),this.financialInsightError.set("\u5F9E AI \u6A21\u578B\u751F\u6210\u8CA1\u52D9\u6D1E\u5BDF\u5931\u6557\u3002"),this.financialInsightState.set("error")}}async analyzeShoppingBaskets(e){if(!this.ai){this.basketAnalysisError.set("Gemini AI \u5BA2\u6236\u7AEF\u672A\u521D\u59CB\u5316\u3002\u8ACB\u6AA2\u67E5 API \u91D1\u9470\u3002"),this.basketAnalysisState.set("error");return}this.basketAnalysisState.set("loading"),this.basketAnalysisError.set(null),this.basketAnalysis.set(null);let t=e.map(r=>r.items.map(o=>o.name)),i=`
      Perform a market basket analysis on the following list of customer transactions. Each inner list represents one transaction.
      Transactions: ${JSON.stringify(t)}

      IMPORTANT: All textual analysis, suggestions, and insights in the response must be in Traditional Chinese. The JSON keys must remain in English as specified in the schema.

      Identify up to 3 sets of items that are frequently bought together. For each set, provide a marketing or upselling suggestion.
      Also, provide 2 general insights into customer purchasing behavior based on this data.
    `;try{let r=await this.ai.models.generateContent({model:"gemini-2.5-flash",contents:i,config:{responseMimeType:"application/json",responseSchema:{type:yt.OBJECT,properties:{frequently_bought_together:{type:yt.ARRAY,items:{type:yt.OBJECT,properties:{items:{type:yt.ARRAY,items:{type:yt.STRING}},suggestion:{type:yt.STRING}}}},customer_behavior_insights:{type:yt.ARRAY,items:{type:yt.STRING}}}}}}),o=JSON.parse(r.text);this.basketAnalysis.set(o),this.basketAnalysisState.set("success")}catch(r){console.error(r),this.basketAnalysisError.set("\u5F9E AI \u6A21\u578B\u751F\u6210\u8CFC\u7269\u7C43\u5206\u6790\u5931\u6557\u3002"),this.basketAnalysisState.set("error")}}};bo.\u0275fac=function(t){return new(t||bo)},bo.\u0275prov=X({token:bo,factory:bo.\u0275fac,providedIn:"root"});var lp=bo;var DV=(n,e)=>e.id,wV=(n,e)=>e.transactionId;function TV(n,e){n&1&&(l(0,"div",17)(1,"div",31),x(2,"div",32),l(3,"p",6),d(4,"\u52A0\u8F09\u9867\u5BA2\u5217\u8868\u4E2D..."),s()()())}function IV(n,e){if(n&1&&(l(0,"div",18)(1,"p",33),d(2,"\u52A0\u8F09\u5931\u6557"),s(),l(3,"p"),d(4),s()()),n&2){let t=_();m(4),w(t.errorMessage())}}function MV(n,e){if(n&1){let t=B();l(0,"div",47),b("click",function(){let r=E(t).$implicit,o=_(2);return S(o.selectCustomer(r))}),l(1,"div",48)(2,"p",49),d(3),s(),l(4,"span",50),d(5),s()(),l(6,"p",6),d(7),s()()}if(n&2){let t,i,r=e.$implicit,o=_(2);j("bg-indigo-100",((t=o.selectedCustomer())==null?null:t.id)===r.id)("hover:bg-gray-100",((i=o.selectedCustomer())==null?null:i.id)!==r.id),m(3),w(o.getCleanCustomerName(r)),m(),Te(o.getCustomerTypeClass(r)),m(),w(o.getCustomerType(r)),m(2),w(r.phone)}}function AV(n,e){n&1&&(l(0,"p",46),d(1,"\u627E\u4E0D\u5230\u9867\u5BA2\u3002"),s())}function RV(n,e){if(n&1){let t=B();l(0,"div",34)(1,"select",35),K("ngModelChange",function(r){E(t);let o=_();return Q(o.categoryFilter,r)||(o.categoryFilter=r),S(r)}),l(2,"option",36),d(3,"\u5168\u90E8\u9867\u5BA2"),s(),l(4,"option",37),d(5,"\u4E00\u822C\u9867\u5BA2"),s(),l(6,"option",38),d(7,"\u96EA\u8304\u6703\u54E1"),s(),l(8,"option",39),d(9,"\u80A1\u6771"),s()()(),l(10,"div",40)(11,"input",41),K("ngModelChange",function(r){E(t);let o=_();return Q(o.searchTerm,r)||(o.searchTerm=r),S(r)}),s(),x(12,"ion-icon",42),s(),l(13,"div",43)(14,"div",44),V(15,MV,8,9,"div",45,DV,!1,AV,2,0,"p",46),s()()}if(n&2){let t=_();m(),J("ngModel",t.categoryFilter),m(10),J("ngModel",t.searchTerm),m(4),L(t.filteredCustomers())}}function NV(n,e){if(n&1&&(l(0,"div",60)(1,"strong",64),d(2,"\u6700\u5F8C\u7D50\u5E33\u6642\u9593"),s(),l(3,"span",58),d(4),jt(5,"date"),s()()),n&2){let t=_();m(4),w(un(5,1,t.lastCheckoutAt,"yyyy-MM-dd HH:mm"))}}function FV(n,e){if(n&1&&(l(0,"div",60)(1,"strong",64),d(2,"\u5099\u8A3B"),s(),l(3,"span",58),d(4),s()()),n&2){let t=_();m(4),w(t.note)}}function PV(n,e){if(n&1&&(l(0,"tr",68)(1,"td",66),d(2),s(),l(3,"td",66),d(4),s(),l(5,"td",69),d(6),s()()),n&2){let t=e.$implicit,i=_(3);m(2),w(t.date),m(2),w(i.formatSaleItems(t.items)),m(2),w(i.formatCurrency(t.total))}}function kV(n,e){if(n&1&&(l(0,"table",63)(1,"thead",65)(2,"tr")(3,"th",66),d(4,"\u65E5\u671F"),s(),l(5,"th",66),d(6,"\u54C1\u9805"),s(),l(7,"th",67),d(8,"\u7E3D\u91D1\u984D"),s()()(),l(9,"tbody"),V(10,PV,7,3,"tr",68,wV),s()()),n&2){let t=_(2);m(10),L(t.customerSales())}}function VV(n,e){n&1&&(l(0,"p",46),d(1,"\u7121\u4EA4\u6613\u7D00\u9304\u3002"),s())}function LV(n,e){if(n&1){let t=B();l(0,"div")(1,"div",21)(2,"div",51)(3,"div")(4,"h2",52),d(5),s(),l(6,"span",53),d(7),s()(),l(8,"button",54),b("click",function(){E(t);let r=_();return S(r.clearSelection())}),x(9,"ion-icon",55),s()(),l(10,"div",56)(11,"div")(12,"strong",57),d(13,"\u96FB\u8A71"),s(),l(14,"span",58),d(15),s()(),l(16,"div")(17,"strong",57),d(18,"\u6027\u5225"),s(),l(19,"span",58),d(20),s()(),l(21,"div")(22,"strong",57),d(23,"\u751F\u65E5"),s(),l(24,"span",58),d(25),s()(),l(26,"div")(27,"strong",57),d(28,"\u51FA\u751F\u5E74\u4EFD"),s(),l(29,"span",58),d(30),s()(),l(31,"div")(32,"strong",57),d(33,"\u7A4D\u5206\u9EDE\u6578"),s(),l(34,"span",59),d(35),s()(),l(36,"div")(37,"strong",57),d(38,"\u539F\u59CB\u9580\u5E97"),s(),l(39,"span",58),d(40),s()()(),M(41,NV,6,4,"div",60),M(42,FV,5,1,"div",60),s(),l(43,"div",61)(44,"h3",16),d(45,"\u4EA4\u6613\u6B77\u53F2"),s(),l(46,"div",62),M(47,kV,12,0,"table",63)(48,VV,2,0,"p",46),s()()()}if(n&2){let t=e,i=_();m(5),w(i.getCleanCustomerName(t)),m(),Te(i.getCustomerTypeClass(t)),m(),w(i.getCustomerType(t)),m(8),w(t.phone||"-"),m(5),w(t.gender||"-"),m(5),w(t.birthday||"-"),m(5),w(t.birthYear||"-"),m(5),N("",t.loyaltyPoints||0," \u9EDE"),m(5),w(t.originStore||"-"),m(),A(t.lastCheckoutAt?41:-1),m(),A(t.note?42:-1),m(5),A(i.customerSales().length>0?47:48)}}function OV(n,e){n&1&&(l(0,"div",20)(1,"div",70),x(2,"ion-icon",71),l(3,"p",72),d(4,"\u8ACB\u5F9E\u5DE6\u5074\u9078\u64C7\u4E00\u4F4D\u9867\u5BA2\u4EE5\u67E5\u770B\u8A73\u7D30\u8CC7\u8A0A\u3002"),s()()())}function BV(n,e){n&1&&x(0,"div",27)}function UV(n,e){n&1&&(l(0,"p",28),d(1,"\u9EDE\u64CA\u6309\u9215\u4EE5\u5C0D\u5168\u9AD4\u9867\u5BA2\u7684 POS \u6578\u64DA\u904B\u884C AI \u8CFC\u7269\u7C43\u5206\u6790\u3002"),s())}function $V(n,e){n&1&&(l(0,"p",29),d(1,"AI \u6B63\u5728\u5206\u6790\u4EA4\u6613\u7D00\u9304..."),s())}function HV(n,e){if(n&1&&(l(0,"div",30)(1,"p",33),d(2,"\u767C\u751F\u932F\u8AA4"),s(),l(3,"p"),d(4),s()()),n&2){let t=_();m(4),w(t.geminiService.basketAnalysisError())}}function GV(n,e){if(n&1&&(l(0,"div",75)(1,"p",77),d(2),s(),l(3,"p",78)(4,"span",79),d(5,"\u5EFA\u8B70\uFF1A"),s(),d(6),s()()),n&2){let t=e.$implicit;m(2),w(t.items.join(" + ")),m(4),N(" ",t.suggestion)}}function qV(n,e){n&1&&(l(0,"p",28),d(1,"\u672A\u627E\u5230\u986F\u8457\u7684\u5546\u54C1\u7D44\u5408\u3002"),s())}function WV(n,e){if(n&1&&(l(0,"li"),d(1),s()),n&2){let t=e.$implicit;m(),w(t)}}function jV(n,e){if(n&1&&(l(0,"div",73)(1,"div")(2,"h4",74),d(3,"\u7D93\u5E38\u4E00\u8D77\u8CFC\u8CB7\u7684\u5546\u54C1"),s(),V(4,GV,7,2,"div",75,sn,!1,qV,2,0,"p",28),s(),l(7,"div")(8,"h4",74),d(9,"\u9867\u5BA2\u884C\u70BA\u6D1E\u5BDF"),s(),l(10,"ul",76),V(11,WV,2,1,"li",null,sn),s()()()),n&2){let t=e;m(4),L(t.frequently_bought_together),m(7),L(t.customer_behavior_insights)}}function zV(n,e){if(n&1&&M(0,jV,13,1,"div",73),n&2){let t,i=_();A((t=i.geminiService.basketAnalysis())?0:-1,t)}}var Ha=class Ha{constructor(){this.apiService=k(we);this.geminiService=k(lp);this.customers=D([]);this.searchTerm=D("");this.categoryFilter=D("all");this.selectedCustomer=D(null);this.customerSales=D([]);this.customerFeedback=D([]);this.isLoading=D(!1);this.errorMessage=D(null);this.filteredCustomers=$(()=>{let e=this.customers(),t=this.categoryFilter();t!=="all"&&(e=e.filter(r=>this.getCustomerCategory(r)===t));let i=this.searchTerm().toLowerCase();return i&&(e=e.filter(r=>r.name?.toLowerCase().includes(i)||r.phone?.includes(i))),e});this.customerStats=$(()=>{let e=this.customers(),t=e.length,i=e.filter(a=>this.getCustomerCategory(a)==="cigar").length,r=e.filter(a=>this.getCustomerCategory(a)==="shareholder").length,o=e.filter(a=>this.getCustomerCategory(a)==="regular").length;return{total:t,cigarCount:i,regularCount:o,shareholderCount:r}});this.loadCustomers()}async loadCustomers(){this.isLoading.set(!0),this.errorMessage.set(null);try{let e=await this.apiService.getCustomers();e.success&&e.data&&Array.isArray(e.data)?this.customers.set(e.data):this.errorMessage.set(e.error||"\u7121\u6CD5\u53D6\u5F97\u9867\u5BA2\u8CC7\u6599")}catch(e){console.error("Error loading customers:",e),this.errorMessage.set("\u8F09\u5165\u9867\u5BA2\u8CC7\u6599\u5931\u6557\uFF0C\u8ACB\u7A0D\u5F8C\u91CD\u8A66")}finally{this.isLoading.set(!1)}}selectCustomer(e){this.selectedCustomer.set(e)}clearSelection(){this.selectedCustomer.set(null),this.customerSales.set([]),this.customerFeedback.set([])}runBasketAnalysis(){}getCustomerCategory(e){let t=e.name||"";return t.includes("\u96EA\u8304")?"cigar":t.includes("\u80A1\u6771")?"shareholder":"regular"}getCleanCustomerName(e){let t=e.name||"";return t=t.replace(/\s*/g,"").replace(/\s*/g,""),t.trim()}getCustomerTypeClass(e){switch(this.getCustomerCategory(e)){case"cigar":return"bg-purple-100 text-purple-800";case"shareholder":return"bg-yellow-100 text-yellow-800";default:return"bg-blue-100 text-blue-800"}}getCustomerType(e){switch(this.getCustomerCategory(e)){case"cigar":return"\u96EA\u8304\u6703\u54E1";case"shareholder":return"\u80A1\u6771";default:return"\u4E00\u822C\u9867\u5BA2"}}formatSaleItems(e){return e?e.map(t=>t.name).join(", "):""}formatCurrency(e){return e==null?"":e.toLocaleString("zh-TW",{style:"currency",currency:"TWD",minimumFractionDigits:0})}getStars(e){return Array(e).fill(0)}getEmptyStars(e){return Array(5-e).fill(0)}};Ha.\u0275fac=function(t){return new(t||Ha)},Ha.\u0275cmp=re({type:Ha,selectors:[["app-customer-analysis"]],decls:60,vars:11,consts:[[1,"space-y-8"],[1,"text-3xl","font-bold","text-gray-900"],[1,"grid","grid-cols-2","md:grid-cols-4","gap-6"],[1,"bg-white","p-6","rounded-xl","shadow-md","flex","items-center","space-x-4"],[1,"bg-blue-100","p-3","rounded-full"],["name","people-outline",1,"text-2xl","text-blue-600"],[1,"text-sm","text-gray-500"],[1,"text-2xl","font-semibold","text-gray-900"],[1,"bg-green-100","p-3","rounded-full"],["name","person-outline",1,"text-2xl","text-green-600"],[1,"bg-purple-100","p-3","rounded-full"],["name","ribbon-outline",1,"text-2xl","text-purple-600"],[1,"bg-yellow-100","p-3","rounded-full"],["name","briefcase-outline",1,"text-2xl","text-yellow-600"],[1,"grid","grid-cols-1","lg:grid-cols-3","gap-8"],[1,"lg:col-span-1","bg-white","p-6","rounded-xl","shadow-md","flex","flex-col"],[1,"text-lg","font-semibold","text-gray-800","mb-4"],[1,"flex","items-center","justify-center","h-32"],[1,"bg-red-50","border","border-red-200","text-red-700","p-3","rounded-lg","mb-4","text-sm"],[1,"lg:col-span-2","space-y-8"],[1,"h-full","flex","items-center","justify-center","bg-white","p-6","rounded-xl","shadow-md"],[1,"bg-white","p-6","rounded-xl","shadow-md"],[1,"flex","justify-between","items-center","mb-4"],[1,"flex","items-center","space-x-3"],["name","basket-outline",1,"text-2xl","text-indigo-600"],[1,"text-lg","font-semibold","text-gray-800"],[1,"bg-indigo-600","text-white","px-4","py-2","rounded-lg","font-medium","hover:bg-indigo-700","transition-colors","disabled:bg-indigo-300","disabled:cursor-not-allowed","flex","items-center","space-x-2",3,"click","disabled"],[1,"w-5","h-5","border-2","border-white","border-t-transparent","rounded-full","animate-spin"],[1,"text-gray-500"],[1,"text-gray-500","animate-pulse"],[1,"bg-red-50","text-red-700","p-4","rounded-lg"],[1,"flex","flex-col","items-center","space-y-2"],[1,"w-8","h-8","border-3","border-indigo-200","border-t-indigo-600","rounded-full","animate-spin"],[1,"font-semibold"],[1,"mb-3"],[1,"w-full","border-gray-300","rounded-lg","shadow-sm","focus:ring-indigo-500","focus:border-indigo-500","text-sm","p-2","bg-gray-50",3,"ngModelChange","ngModel"],["value","all"],["value","regular"],["value","cigar"],["value","shareholder"],[1,"relative","mb-4"],["type","text","placeholder","\u4F9D\u59D3\u540D\u6216\u96FB\u8A71\u641C\u5C0B...",1,"w-full","border-gray-300","rounded-lg","shadow-sm","focus:ring-indigo-500","focus:border-indigo-500","text-sm","p-2","pl-10","bg-gray-50",3,"ngModelChange","ngModel"],["name","search-outline",1,"absolute","left-3","top-1/2","-translate-y-1/2","text-gray-400"],[1,"flex-1","overflow-y-auto","-mx-2","px-2"],[1,"space-y-2"],[1,"p-3","rounded-lg","cursor-pointer","transition-colors",3,"bg-indigo-100","hover:bg-gray-100"],[1,"text-center","text-gray-500","py-4"],[1,"p-3","rounded-lg","cursor-pointer","transition-colors",3,"click"],[1,"flex","justify-between","items-center"],[1,"font-medium","text-gray-800"],[1,"text-xs","font-semibold","px-2","py-1","rounded-full"],[1,"flex","justify-between","items-start"],[1,"text-2xl","font-bold","text-gray-900"],[1,"text-sm","font-semibold","px-2","py-1","rounded-full","mt-1","inline-block"],[1,"text-gray-500","hover:text-gray-700",3,"click"],["name","close-circle-outline",1,"text-2xl"],[1,"mt-4","grid","grid-cols-2","md:grid-cols-3","gap-4","text-sm","border-t","pt-4"],[1,"block","text-gray-500"],[1,"text-gray-800"],[1,"text-gray-800","font-bold"],[1,"mt-4","pt-4","border-t","text-sm"],[1,"bg-white","p-6","rounded-xl","shadow-md","mt-8"],[1,"overflow-x-auto","max-h-60"],[1,"w-full","text-sm","text-left","text-gray-500"],[1,"block","text-gray-500","mb-1"],[1,"text-xs","text-gray-700","uppercase","bg-gray-50","sticky","top-0"],[1,"px-4","py-2"],[1,"px-4","py-2","text-right"],[1,"bg-white","border-b","hover:bg-gray-50"],[1,"px-4","py-2","text-right","font-medium"],[1,"text-center"],["name","person-add-outline",1,"text-5xl","text-gray-400"],[1,"mt-2","text-gray-500"],[1,"grid","grid-cols-1","lg:grid-cols-2","gap-6","text-sm"],[1,"font-semibold","text-gray-800","mb-2"],[1,"bg-indigo-50","p-4","rounded-lg","mb-4"],[1,"list-disc","list-inside","space-y-2","text-gray-600","bg-gray-50","p-4","rounded-lg"],[1,"font-semibold","text-indigo-800"],[1,"text-indigo-700","mt-1"],[1,"font-medium"]],template:function(t,i){if(t&1&&(l(0,"div",0)(1,"h1",1),d(2,"\u9867\u5BA2\u7BA1\u7406"),s(),l(3,"div",2)(4,"div",3)(5,"div",4),x(6,"ion-icon",5),s(),l(7,"div")(8,"p",6),d(9,"\u7E3D\u9867\u5BA2\u6578"),s(),l(10,"p",7),d(11),s()()(),l(12,"div",3)(13,"div",8),x(14,"ion-icon",9),s(),l(15,"div")(16,"p",6),d(17,"\u4E00\u822C\u9867\u5BA2"),s(),l(18,"p",7),d(19),s()()(),l(20,"div",3)(21,"div",10),x(22,"ion-icon",11),s(),l(23,"div")(24,"p",6),d(25,"\u96EA\u8304\u6703\u54E1"),s(),l(26,"p",7),d(27),s()()(),l(28,"div",3)(29,"div",12),x(30,"ion-icon",13),s(),l(31,"div")(32,"p",6),d(33,"\u80A1\u6771"),s(),l(34,"p",7),d(35),s()()()(),l(36,"div",14)(37,"div",15)(38,"h3",16),d(39,"\u9867\u5BA2\u5217\u8868"),s(),M(40,TV,5,0,"div",17),M(41,IV,5,1,"div",18),M(42,RV,18,3),s(),l(43,"div",19),M(44,LV,49,13,"div")(45,OV,5,0,"div",20),s()(),l(46,"div",21)(47,"div",22)(48,"div",23),x(49,"ion-icon",24),l(50,"h3",25),d(51,"\u9867\u5BA2\u884C\u70BA\u5206\u6790 (\u6574\u9AD4)"),s()(),l(52,"button",26),b("click",function(){return i.runBasketAnalysis()}),M(53,BV,1,0,"div",27),l(54,"span"),d(55,"\u5206\u6790\u8CFC\u7269\u7C43"),s()()(),M(56,UV,2,0,"p",28)(57,$V,2,0,"p",29)(58,HV,5,1,"div",30)(59,zV,1,1),s()()),t&2){let r,o;m(11),w(i.customerStats().total),m(8),w(i.customerStats().regularCount),m(8),w(i.customerStats().cigarCount),m(8),w(i.customerStats().shareholderCount),m(5),A(i.isLoading()?40:-1),m(),A(i.errorMessage()?41:-1),m(),A(i.isLoading()?-1:42),m(2),A((r=i.selectedCustomer())?44:45,r),m(8),I("disabled",i.geminiService.basketAnalysisState()==="loading"),m(),A(i.geminiService.basketAnalysisState()==="loading"?53:-1),m(3),A((o=i.geminiService.basketAnalysisState())==="idle"?56:o==="loading"?57:o==="error"?58:o==="success"?59:-1)}},dependencies:[se,De,He,Ge,be,Oe,fe,Ie,ao],encapsulation:2,changeDetection:0});var up=Ha;var Eo=class Eo{constructor(){this.mockTargetGoals=D([{id:"TG001",title:"\u516B\u6708\u7E3D\u71DF\u6536\u76EE\u6A19",type:"\u71DF\u6536",targetValue:35e4,currentValue:289190,startDate:"2024-08-01",endDate:"2024-08-31",status:"\u9032\u884C\u4E2D",unit:"\u5143",assigneeId:"USR002",period:"monthly"},{id:"TG002",title:"\u5341\u6708\u6D3B\u52D5\u5834\u6B21",type:"\u6D3B\u52D5",targetValue:15,currentValue:13,startDate:"2024-10-01",endDate:"2024-10-31",status:"\u9032\u884C\u4E2D",unit:"\u5834",assigneeId:"USR003",period:"monthly"},{id:"TG003",title:"\u7B2C\u4E09\u5B63 VIP \u9867\u5BA2\u589E\u9577",type:"\u9867\u5BA2",targetValue:10,currentValue:12,startDate:"2024-07-01",endDate:"2024-09-30",status:"\u5DF2\u9054\u6210",unit:"\u4EBA",assigneeId:"USR003",period:"monthly"},{id:"TG004",title:"\u7B2C\u56DB\u5B63\u9867\u5BA2\u6EFF\u610F\u5EA6\u63D0\u5347",type:"\u9867\u5BA2",targetValue:5,currentValue:4,startDate:"2024-10-01",endDate:"2024-12-31",status:"\u9032\u884C\u4E2D",unit:"\u5206",period:"monthly"},{id:"TG005",title:"2024\u5E74\u5E74\u5EA6\u7E3D\u71DF\u6536",type:"\u71DF\u6536",targetValue:4e6,currentValue:285e4,startDate:"2024-01-01",endDate:"2024-12-31",status:"\u9032\u884C\u4E2D",unit:"\u5143",period:"yearly"},{id:"TG006",title:"2024\u5E74\u7E3D\u6D3B\u52D5\u5834\u6B21",type:"\u6D3B\u52D5",targetValue:100,currentValue:85,startDate:"2024-01-01",endDate:"2024-12-31",status:"\u9032\u884C\u4E2D",unit:"\u5834",assigneeId:"USR003",period:"yearly"}]);this.mockEvents=D([{id:"EVT001",type:"\u5BB4\u5BA2",status:"active",date:"2024-10-03",name:"\u52DE\u502B\u65AF",attendees:"10~15",estimatedRevenue:19e3,actualRevenue:20980,notes:"\u9152\u5546\u8CBB: 9600/\u9910\u9EDE: \u4EBA600"},{id:"EVT002",type:"\u76AE\u5361",status:"active",date:"2024-10-04",time:"14:30~18:30",name:"\u5361\u724C",attendees:"10~15",estimatedRevenue:8e3,actualRevenue:8540},{id:"EVT003",type:"\u5546\u52D9\u3001\u5E97\u5167",status:"active",date:"2024-10-07",name:"\u6F2B\u9727",attendees:"6",estimatedRevenue:4200,actualRevenue:4900,notes:"\u662F\u5426\u8ABF\u6574"},{id:"EVT004",type:"\u5BB4\u5BA2",status:"active",date:"2024-10-13",name:"Dave",attendees:"8~10",estimatedRevenue:15e3,actualRevenue:24080,notes:"8000/\u4E2D\u5F0F"},{id:"EVT005",type:"\u76AE\u5361",status:"active",date:"2024-10-14",time:"14:30~18:00",name:"TCBA",organizer:"\u76AE\u5361",attendees:"8",estimatedRevenue:4e3,actualRevenue:4e3,notes:"\u4EBA/530"},{id:"EVT006",type:"\u5E97\u5167",status:"cancelled",date:"2024-10-17",name:"\u70C8\u9152\u54C1\u9152\u6703",attendees:"0",estimatedRevenue:0,actualRevenue:0},{id:"EVT007",type:"\u7DAD\u7DB8",status:"active",date:"2024-10-18",time:"\u665A\u4E0A18:00\u5F8C",name:"slp\u5275\u696D\u5B78\u9662",attendees:"70",estimatedRevenue:7e4,deposit:21e3,actualRevenue:77640,notes:"\u8A02\u91D1\u5DF2\u6536"},{id:"EVT008",type:"\u7D05\u767D\u806F\u8ABC",status:"active",date:"2024-10-19",time:"14:00~17:00",name:"\u5C0F\u745C",attendees:"7",estimatedRevenue:36e3,actualRevenue:7e3,notes:"\u9152\u5546\u8CBB: 12000~14000/\u4EBA\u6578: \u7537\u5973\u5C0D\u534A \u5C0F\u745C\u62BD500\u5143/\u4EBA"},{id:"EVT009",type:"\u5E97\u5167",status:"active",date:"2024-10-22",name:"\u7D05\u767D\u9152\u54C1\u6703",attendees:"4",estimatedRevenue:15e3,actualRevenue:6e3,notes:"\u9152\u5546\u8CBB: 12000 \u8CBB\u7528: 1,500\u5143/\u4EBA 4\u96BB\u9152/\u642D\u914D\u98A8\u5473\u98DF\u7269"},{id:"EVT010",type:"\u6D3B\u52D5",status:"cancelled",date:"2024-10-23",time:"19:00~22:00",name:"Scott",organizer:"Scott",attendees:"0",estimatedRevenue:0,actualRevenue:0,notes:"1\u4EBA/400"},{id:"EVT011",type:"\u7DAD\u7DB8",status:"active",date:"2024-10-25",time:"\u665A\u4E0A18:00\u5F8C",name:"slp\u5275\u696D\u5B78\u9662",attendees:"55",estimatedRevenue:7e4,deposit:21e3,actualRevenue:74010,notes:"\u8A02\u91D1\u5DF2\u6536"},{id:"EVT012",type:"Laurence",status:"active",date:"2024-10-26",time:"\u4E0B\u5348\u958B\u5E55",name:"\u516C\u53F8\u958B\u5E55",attendees:"30",estimatedRevenue:1e4,actualRevenue:1e4},{id:"EVT013",type:"\u80A1\u6771\u6703",status:"active",date:"2024-10-28",name:"\u80A1\u6771\u6703",attendees:"5",estimatedRevenue:0,actualRevenue:0},{id:"EVT014",type:"\u5BA2\u6236",status:"active",date:"2024-10-29",name:"Connyn",attendees:"20~25",estimatedRevenue:15e3,actualRevenue:15e3,notes:"\u83DC: 15000"},{id:"EVT015",type:"\u76AE\u5361",status:"active",date:"2024-10-30",time:"\u665A\u4E0A18:00\u5F8C",name:"\u5361\u724C",organizer:"\u76AE\u5361",attendees:"8",estimatedRevenue:4e3,actualRevenue:12890},{id:"EVT016",type:"\u5E97\u5167",status:"active",date:"2024-10-31",name:"\u6F2B\u9727",attendees:"6",estimatedRevenue:8400,actualRevenue:4900},{id:"EVT017",type:"\u5546\u52D9",status:"active",date:"2024-08-01",name:"\u6F2B\u9727",attendees:"20",estimatedRevenue:2e4,actualRevenue:21450},{id:"EVT018",type:"\u79C1\u4EBA",status:"active",date:"2024-08-09",name:"\u555F\u5E06",attendees:"5",estimatedRevenue:2e3,actualRevenue:1900},{id:"EVT019",type:"\u79C1\u4EBA",status:"active",date:"2024-08-13",name:"\u555F\u5E06",attendees:"10",estimatedRevenue:0,actualRevenue:0},{id:"EVT020",type:"\u5BB4\u5BA2",status:"active",date:"2024-08-14",name:"vic / jackle",attendees:"15",estimatedRevenue:18e3,actualRevenue:2e4},{id:"EVT021",type:"\u5546\u52D9",status:"active",date:"2024-08-22",name:"\u6F2B\u9727",attendees:"12",estimatedRevenue:1e4,actualRevenue:10155},{id:"EVT022",type:"\u79C1\u4EBA",status:"active",date:"2024-08-27",name:"\u555F\u5E06",attendees:"8",estimatedRevenue:8e3,actualRevenue:9300},{id:"EVT023",type:"\u54C1\u9152\u6703",status:"active",date:"2024-08-28",name:"\u5167\u90E8\u54C1\u9152",attendees:"10",estimatedRevenue:1e4,actualRevenue:10700}]);this.mockDailyRevenue=D([{date:"2024-08-01",nonEventRevenue:10520,isDayOff:!1},{date:"2024-08-02",nonEventRevenue:3340,isDayOff:!1},{date:"2024-08-03",nonEventRevenue:970,isDayOff:!1},{date:"2024-08-04",nonEventRevenue:0,isDayOff:!0},{date:"2024-08-05",nonEventRevenue:200,isDayOff:!1},{date:"2024-08-06",nonEventRevenue:0,isDayOff:!1},{date:"2024-08-07",nonEventRevenue:0,isDayOff:!1},{date:"2024-08-08",nonEventRevenue:17950,isDayOff:!1},{date:"2024-08-09",nonEventRevenue:6800,isDayOff:!1},{date:"2024-08-10",nonEventRevenue:8410,isDayOff:!1},{date:"2024-08-11",nonEventRevenue:0,isDayOff:!0},{date:"2024-08-12",nonEventRevenue:8970,isDayOff:!1},{date:"2024-08-13",nonEventRevenue:14900,isDayOff:!1},{date:"2024-08-14",nonEventRevenue:14130,isDayOff:!1},{date:"2024-08-15",nonEventRevenue:23630,isDayOff:!1},{date:"2024-08-16",nonEventRevenue:10740,isDayOff:!1},{date:"2024-08-17",nonEventRevenue:6090,isDayOff:!1},{date:"2024-08-18",nonEventRevenue:0,isDayOff:!0},{date:"2024-08-19",nonEventRevenue:7500,isDayOff:!1},{date:"2024-08-20",nonEventRevenue:1860,isDayOff:!1},{date:"2024-08-21",nonEventRevenue:700,isDayOff:!1},{date:"2024-08-22",nonEventRevenue:-845,isDayOff:!1},{date:"2024-08-23",nonEventRevenue:36100,isDayOff:!1},{date:"2024-08-24",nonEventRevenue:3140,isDayOff:!1},{date:"2024-08-25",nonEventRevenue:0,isDayOff:!0},{date:"2024-08-26",nonEventRevenue:2180,isDayOff:!1},{date:"2024-08-27",nonEventRevenue:4720,isDayOff:!1},{date:"2024-08-28",nonEventRevenue:17600,isDayOff:!1},{date:"2024-08-29",nonEventRevenue:18560,isDayOff:!1},{date:"2024-08-30",nonEventRevenue:11500,isDayOff:!1},{date:"2024-08-31",nonEventRevenue:4850,isDayOff:!1}]);this.mockEmployees=D([{id:"EMP001",name:"\u738B\u5C0F\u660E",type:"full-time",monthlySalary:55e3},{id:"EMP002",name:"\u9673\u7F8E\u9E97",type:"full-time",monthlySalary:62e3},{id:"EMP003",name:"\u674E\u5927\u885B",type:"part-time",hourlyRate:200},{id:"EMP004",name:"\u5F35\u4F73\u73B2",type:"part-time",hourlyRate:200},{id:"EMP005",name:"\u9EC3\u5FD7\u5F37",type:"part-time",hourlyRate:200}]);this.mockPunchRecords=D([{employeeId:"EMP003",date:"2024-08-01",clockIn:"10:00",clockOut:"18:30",isDoublePay:!1},{employeeId:"EMP003",date:"2024-08-02",clockIn:"10:05",clockOut:"17:55",isDoublePay:!1},{employeeId:"EMP003",date:"2024-08-05",clockIn:"14:00",clockOut:"22:15",isDoublePay:!1},{employeeId:"EMP003",date:"2024-08-06",clockIn:"13:58",clockOut:"22:05",isDoublePay:!1},{employeeId:"EMP003",date:"2024-08-08",clockIn:"10:00",clockOut:"14:00",isDoublePay:!1},{employeeId:"EMP003",date:"2024-08-09",clockIn:"09:55",clockOut:"18:00",isDoublePay:!0},{employeeId:"EMP003",date:"2024-08-12",clockIn:"10:00",clockOut:"18:00",isDoublePay:!1},{employeeId:"EMP003",date:"2024-08-13",clockIn:"10:00",clockOut:"18:00",isDoublePay:!1},{employeeId:"EMP003",date:"2024-08-15",clockIn:"10:00",clockOut:null,isDoublePay:!1},{employeeId:"EMP003",date:"2024-08-16",clockIn:"14:00",clockOut:"22:00",isDoublePay:!1},{employeeId:"EMP004",date:"2024-08-01",clockIn:"18:00",clockOut:"22:00",isDoublePay:!1},{employeeId:"EMP004",date:"2024-08-03",clockIn:"18:00",clockOut:"22:30",isDoublePay:!1},{employeeId:"EMP004",date:"2024-08-07",clockIn:"17:55",clockOut:"22:01",isDoublePay:!1},{employeeId:"EMP004",date:"2024-08-10",clockIn:"17:30",clockOut:"22:30",isDoublePay:!1},{employeeId:"EMP004",date:"2024-08-14",clockIn:"18:00",clockOut:"22:00",isDoublePay:!1},{employeeId:"EMP004",date:"2024-08-17",clockIn:"18:00",clockOut:"22:00",isDoublePay:!1},{employeeId:"EMP005",date:"2024-08-20",clockIn:"12:00",clockOut:"20:00",isDoublePay:!1},{employeeId:"EMP005",date:"2024-08-21",clockIn:"12:05",clockOut:"20:08",isDoublePay:!1},{employeeId:"EMP005",date:"2024-08-22",clockIn:null,clockOut:"20:00",isDoublePay:!1},{employeeId:"EMP005",date:"2024-08-24",clockIn:"11:58",clockOut:"20:03",isDoublePay:!1}]);this.mockTransactions=D([{id:"TXN001",date:"2025-12-16",item:"\u8CA0\u50B5",category:"\u61C9\u4ED8\u96EA\u8304\u9032\u8CA8",amount:-66350,approved:!0},{id:"TXN002",date:"2025-12-17",item:"\u71DF\u696D\u6536\u5165",category:"-\u92B7\u6216\u6298\u8B93",amount:0,approved:!0},{id:"TXN003",date:"2025-12-17",item:"\u71DF\u696D\u6536\u5165",category:"\u92B7\u8CA8\u6536\u5165",amount:1150,approved:!1},{id:"TXN004",date:"2025-12-17",item:"\u8CC7\u7522",category:"\u71DF\u696D\u8A2D\u5099",amount:-295,vendorName:"\u8766\u76AE",description:"\u53EF\u9E97\u9732\u70E4\u76E4",approved:!0},{id:"TXN005",date:"2025-12-18",item:"\u71DF\u696D\u6536\u5165",category:"-\u92B7\u6216\u6298\u8B93",amount:-2862,approved:!0},{id:"TXN006",date:"2025-12-18",item:"\u71DF\u696D\u6536\u5165",category:"\u92B7\u8CA8\u6536\u5165",amount:17440,approved:!0},{id:"TXN007",date:"2025-12-19",item:"\u71DF\u696D\u6536\u5165",category:"-\u92B7\u6216\u6298\u8B93",amount:-191,approved:!0},{id:"TXN008",date:"2025-12-19",item:"\u71DF\u696D\u8CBB\u7528",category:"\u6587\u5177\u7528\u54C1",amount:-100,vendorTaxId:"14713177",vendorName:"\u91D1\u5409\u523B\u5370\u884C",approved:!0},{id:"TXN009",date:"2025-12-19",item:"\u71DF\u696D\u8CBB\u7528",category:"\u6587\u5177\u7528\u54C1",amount:-7,invoiceNumber:"VF-79457330",vendorTaxId:"90113315",vendorName:"\u5168\u65B9\u4F4D\u6578\u4F4D\u8F38\u51FA\u6709\u9650\u516C\u53F8\u5357\u4EAC\u6771\u8DEF\u5206\u516C\u53F8",approved:!0},{id:"TXN010",date:"2025-12-19",item:"\u71DF\u696D\u8CBB\u7528",category:"\u6587\u5177\u7528\u54C1",amount:-114,invoiceNumber:"UB-05014356",vendorTaxId:"97616452",vendorName:"\u5168\u806F\u798F\u5229\u4E2D\u5FC3",approved:!1},{id:"TXN011",date:"2025-12-19",item:"\u8CC7\u7522",category:"\u5B58\u8CA8-\u9152\u6C34",amount:-5580,vendorName:"\u6DFB\u6F64\u6D0B\u884C",approved:!0},{id:"TXN012",date:"2025-12-19",item:"\u8CC7\u7522",category:"\u5B58\u8CA8-\u9910\u98F2",amount:-189,invoiceNumber:"12170425",vendorName:"\u89AA\u6C11\u98DF\u54C1\u6709\u9650\u516C\u53F8",approved:!0},{id:"TXN013",date:"2025-12-19",item:"\u8CC7\u7522",category:"\u5B58\u8CA8-\u9910\u98F2",amount:-427,vendorName:"\u6D0B\u83EF\u9BAE\u98DF\u5BE6\u696D\u6709\u9650\u516C\u53F8",approved:!0},{id:"TXN014",date:"2025-12-19",item:"\u8CC7\u7522",category:"\u5B58\u8CA8-\u9910\u98F2",amount:-280,invoiceNumber:"UK88724800",vendorName:"\u958B\u5143\u98DF\u54C1\u5DE5\u696D\u80A1\u4EFD\u6709\u9650\u516C\u53F8",approved:!0},{id:"TXN015",date:"2025-12-19",item:"\u8CC7\u7522",category:"\u5B58\u8CA8-\u9910\u98F2",amount:-45,invoiceNumber:"111412191194",vendorTaxId:"79997612",vendorName:"\u570B\u8C50\u5546\u884C\u6709\u9650\u516C\u53F8",approved:!0},{id:"TXN016",date:"2025-12-19",item:"\u8CC7\u7522",category:"\u5B58\u8CA8-\u9910\u98F2",amount:-1874,vendorTaxId:"79997612",vendorName:"\u570B\u8C50\u5546\u884C\u6709\u9650\u516C\u53F8",approved:!0},{id:"TXN017",date:"2025-12-19",item:"\u71DF\u696D\u6536\u5165",category:"\u92B7\u8CA8\u6536\u5165",amount:9280,approved:!0},{id:"TXN018",date:"2025-12-20",item:"\u71DF\u696D\u6536\u5165",category:"-\u92B7\u6216\u6298\u8B93",amount:-4349,approved:!1},{id:"TXN019",date:"2025-12-20",item:"\u71DF\u696D\u8CBB\u7528",category:"\u6587\u5177\u7528\u54C1",amount:-240,vendorTaxId:"93138304",vendorName:"\u798F\u5BF6\u523B\u5370\u884C",approved:!0},{id:"TXN020",date:"2025-12-20",item:"\u8CC7\u7522",category:"\u5B58\u8CA8-\u9910\u98F2",amount:-72,invoiceNumber:"UB-05015759",vendorTaxId:"97616452",vendorName:"\u5168\u806F\u798F\u5229\u4E2D\u5FC3",approved:!0},{id:"TXN021",date:"2025-12-20",item:"\u8CC7\u7522",category:"\u5B58\u8CA8-\u9910\u98F2",amount:-568,invoiceNumber:"UB-05015750",vendorTaxId:"97616452",vendorName:"\u5168\u806F\u798F\u5229\u4E2D\u5FC3",approved:!0},{id:"TXN022",date:"2025-12-20",item:"\u8CC7\u7522",category:"\u5B58\u8CA8-\u9910\u98F2",amount:-160,vendorName:"\u5E02\u5834",approved:!0},{id:"TXN023",date:"2025-12-20",item:"\u71DF\u696D\u8CBB\u7528",category:"\u62DC\u62DC\u8CBB\u7528",amount:-198,invoiceNumber:"UN-74686337",vendorTaxId:"28983777",vendorName:"7-ELEVEN",approved:!0},{id:"TXN024",date:"2025-12-20",item:"\u71DF\u696D\u6536\u5165",category:"\u92B7\u8CA8\u6536\u5165",amount:25310,approved:!0},{id:"TXN025",date:"2025-12-21",item:"\u71DF\u696D\u6536\u5165",category:"-\u92B7\u6216\u6298\u8B93",amount:-1612,approved:!0},{id:"TXN026",date:"2025-12-21",item:"\u71DF\u696D\u6536\u5165",category:"\u92B7\u8CA8\u6536\u5165",amount:14660,approved:!0},{id:"TXN027",date:"2025-12-22",item:"\u71DF\u696D\u8CBB\u7528",category:"\u8CB8\u6B3E\u5229\u606F",amount:-3824,approved:!0},{id:"TXN028",date:"2025-12-22",item:"\u71DF\u696D\u6536\u5165",category:"-\u92B7\u6216\u6298\u8B93",amount:0,approved:!0},{id:"TXN029",date:"2025-12-23",item:"\u8CC7\u7522",category:"\u5B58\u8CA8-\u9910\u98F2",amount:-2020,invoiceNumber:"SO1412221261",vendorTaxId:"22161107",vendorName:"\u9F0E\u8000\u98DF\u54C1\u80A1\u4EFD\u6709\u9650\u516C\u53F8",approved:!0},{id:"TXN030",date:"2025-12-23",item:"\u8CC7\u7522",category:"\u5B58\u8CA8-\u9910\u98F2",amount:-36,invoiceNumber:"UB-15207729",vendorTaxId:"97616452",vendorName:"\u5168\u806F\u798F\u5229\u4E2D\u5FC3",approved:!1},{id:"TXN031",date:"2025-12-23",item:"\u8CC7\u7522",category:"\u5B58\u8CA8-\u9910\u98F2",amount:-150,invoiceNumber:"UB-15209268",vendorTaxId:"97616452",vendorName:"\u5168\u806F\u798F\u5229\u4E2D\u5FC3",approved:!0},{id:"TXN032",date:"2025-12-23",item:"\u71DF\u696D\u6536\u5165",category:"\u92B7\u8CA8\u6536\u5165",amount:2650,approved:!0}]);this.mockVendors=D([{id:"V001",category:"\u98DF\u6750",name:"\u570B\u8C50",contactInfo:"\u696D\u52D9line @926yleos",restDays:"\u516D\u3001\u65E5",taxId:"79997612"},{id:"V002",category:"\u98DF\u6750",name:"\u570B\u6210",contactInfo:"(02)8671-9056",restDays:"\u516D\u3001\u65E5"},{id:"V003",category:"\u5976\u88FD/\u96DE\u7FC5",name:"\u958B\u5143",contactInfo:"\u696D\u52D9 MR.\u8F9C 0916-250-990",restDays:"\u516D\u3001\u65E5",taxId:"UK88724800"},{id:"V004",category:"\u51B0\u6DC7\u6DCB",name:"\u5408\u7A40",contactInfo:"(03)3578-130",restDays:"\u516D\u3001\u65E5"},{id:"V005",category:"\u53EF\u980C",name:"\u89AA\u6C11",contactInfo:"(02)2999-9381",restDays:"\u516D\u3001\u65E5"},{id:"V006",category:"\u8C9D\u679C",name:"\u5E03\u6717\u4E3B\u5EDA",contactInfo:"\u696D\u52D9line @928ebhwu",restDays:"\u516D\u3001\u65E5"},{id:"V007",category:"\u86CB\u7CD5",name:"\u897F\u9EDE\u5C0F\u8216",contactInfo:"\u7DB2\u9801\u4E0B\u55AE, (02)2995-0596",restDays:"\u4E8C\u3001\u4E09\u3001\u56DB\u3001\u516D\u3001\u65E5"},{id:"V008",category:"\u9152",name:"\u5229\u591A\u5409",contactInfo:"Line",restDays:"\u65E5\u3001\u4E00"},{id:"V009",category:"\u9152",name:"\u4E5D\u6A3D",contactInfo:"(02)7728-6670",restDays:"\u516D\u3001\u65E5"},{id:"V010",category:"\u9152",name:"\u9152\u9F0E",contactInfo:"(02)2578-1515",restDays:"\u516D\u3001\u65E5"},{id:"V011",category:"\u8017\u6750",name:"\u6613\u9054\u8C50",contactInfo:"\u696D\u52D9line 0926077730",restDays:"-"},{id:"V012",category:"\u5236\u670D",name:"\u570B\u8C6A",contactInfo:"\u738B\u5730\u7FA9 0932-036356",restDays:"-"},{id:"V013",category:"\u65B9\u51B0\u584A",name:"\u5FEB\u6A02\u51B0\u584A",contactInfo:"0932-357-696",restDays:"-"},{id:"V014",category:"\u83DC\u5546",name:"\u6D25\u83EF",contactInfo:"(02)2307-5255",restDays:"-"},{id:"V015",category:"\u6536\u5EE2\u6CB9",name:"\u5C24\u52A0\u5229",contactInfo:"0909-511-256 \u6797\u5955\u9716 02-8287 5522",restDays:"\u4E8C\u4E09\u56DB\u516D\u65E5"},{id:"V016",category:"\u6536\u5EE2\u6CB9",name:"\u6C38\u745E",contactInfo:"07-6161-580 \u8521\u4F73\u6210 0965-659-532",restDays:"\u9808\u63D0\u524D\u5B89\u6392"},{id:"V017",category:"\u725B\u8C6C\u8089",name:"\u7F8E\u798F",contactInfo:"(02)8791-9688",restDays:"\u516D\u3001\u65E5, \u5207\u8089\u52A01\u5929"},{id:"V018",category:"\u5496\u5561\u8C46",name:"\u4E0A\u7FA4",contactInfo:"(02)2504-2715",restDays:"\u516D\u3001\u65E5"},{id:"V019",category:"\u6D77\u9BAE",name:"\u81FB\u7FD4",contactInfo:"(02)2223-9647",restDays:"\u65E5\u3001\u4E00"},{id:"V020",category:"\u74E6\u65AF",name:"\u9806\u5B89",contactInfo:"(02)2765-7778",restDays:"-"},{id:"V021",category:"\u5E03",name:"\u69AE\u51A0\u5462\u7D68",contactInfo:"022556-6668 \u5468\u69AE\u4E7E 0931-337-876",restDays:"-"},{id:"V022",category:"\u98DF\u6750",name:"\u9F0E\u8000",contactInfo:"APP\u4E0B\u55AE, (02) 2910-6111",restDays:"\u65E5",taxId:"22161107"},{id:"V023",category:"\u9152",name:"\u5C1A\u5FB7",contactInfo:"Line",restDays:"\u516D\u3001\u65E5"},{id:"V024",category:"\u98DF\u6750",name:"COSTCO",contactInfo:"\u81EA\u884C\u63A1\u8CB7",restDays:"-"}]);this.mockPurchaseOrders=D([{id:"PO001",poNumber:"PO-2024-001",vendorId:"V001",date:"2024-08-05",items:[{productName:"\u7279\u7D1A\u521D\u69A8\u6A44\u6B16\u6CB9",quantity:10,unitPrice:350,total:3500},{productName:"\u7FA9\u5927\u5229\u9EB5",quantity:20,unitPrice:80,total:1600}],totalAmount:5100},{id:"PO002",poNumber:"PO-2024-002",vendorId:"V009",date:"2024-08-10",items:[{productName:"\u6CE2\u723E\u591A\u7D05\u9152",quantity:12,unitPrice:800,total:9600},{productName:"\u590F\u5E03\u5229\u767D\u9152",quantity:6,unitPrice:950,total:5700}],totalAmount:15300},{id:"PO003",poNumber:"PO-2024-003",vendorId:"V017",date:"2024-08-12",items:[{productName:"\u7F8E\u570B Prime \u7D1A\u808B\u773C\u725B\u6392",quantity:5,unitPrice:1200,total:6e3}],totalAmount:6e3}]);this.mockProductCosts=D([{id:"PC001",productId:"LIQ-001",productName:"\u544A\u767D",vendorId:"V023",category:"\u9152\u6C34",itemQuantity:700,itemUnit:"ml",totalUnit:"\u74F6",price:280},{id:"PC002",productId:"LIQ-002",productName:"\u73AB\u7470\u5564\u9152",vendorId:"V023",category:"\u9152\u6C34",itemQuantity:700,itemUnit:"ml",totalUnit:"\u74F6",price:420},{id:"PC003",productId:"LIQ-003",productName:"\u6A59\u9152",vendorId:"V023",category:"\u9152\u6C34",itemQuantity:700,itemUnit:"ml",totalUnit:"\u74F6",price:520},{id:"PC004",productId:"LIQ-004",productName:"\u91D1\u8CD3\u5A01\u58EB\u5FCC",vendorId:"V023",category:"\u9152\u6C34",itemQuantity:700,itemUnit:"ml",totalUnit:"\u74F6",price:330},{id:"PC005",productId:"LIQ-005",productName:"\u7259\u8CB7\u52A0\u9EA5\u65AF\u8FA3\u59C6\u9152",vendorId:"V023",category:"\u9152\u6C34",itemQuantity:1e3,itemUnit:"ml",totalUnit:"\u74F6",price:420},{id:"PC006",productId:"LIQ-006",productName:"\u99AC\u4E01\u5C3C\u767D\u9999\u827E\u9152",vendorId:"V023",category:"\u9152\u6C34",itemQuantity:750,itemUnit:"ml",totalUnit:"\u74F6",price:420},{id:"PC007",productId:"LIQ-007",productName:"Kahkua\u5496\u5561\u5229\u53E3\u9152",vendorId:"V023",category:"\u9152\u6C34",itemQuantity:750,itemUnit:"ml",totalUnit:"\u74F6",price:430},{id:"PC013",productId:"FOD-001",productName:"\u5BAE\u4FDD\u96DE\u4E01",vendorId:"V024",category:"\u98DF\u6750",itemQuantity:1200,itemUnit:"g",totalUnit:"\u5305",price:358},{id:"PC014",productId:"FOD-002",productName:"Swiss Delice 72%\u9ED1\u5DE7\u514B\u529B",vendorId:"V024",category:"\u98DF\u6750",itemQuantity:216,itemUnit:"\u9846",totalUnit:"\u5305",price:879},{id:"PC015",productId:"FOD-003",productName:"\u5805\u679C",vendorId:"V024",category:"\u98DF\u6750",itemQuantity:1070,itemUnit:"g",totalUnit:"\u7F50",price:659},{id:"PC016",productId:"LIQ-013",productName:"\u767E\u52A0\u5F97\u862D\u59C6\u9152",vendorId:"V024",category:"\u9152\u6C34",itemQuantity:1e3,itemUnit:"ml",totalUnit:"\u74F6",price:469},{id:"PC017",productId:"LIQ-014",productName:"\u7F8E\u570B\u4F0F\u7279\u52A0",vendorId:"V024",category:"\u9152\u6C34",itemQuantity:1750,itemUnit:"ml",totalUnit:"\u74F6",price:375},{id:"PC018",productId:"LIQ-015",productName:"\u79D1\u514B\u862D\u9F8D\u820C\u862D\u9152",vendorId:"V024",category:"\u9152\u6C34",itemQuantity:1750,itemUnit:"ml",totalUnit:"\u74F6",price:769},{id:"PC019",productId:"LIQ-016",productName:"\u79D1\u514B\u862D\u7434\u9152",vendorId:"V024",category:"\u9152\u6C34",itemQuantity:1750,itemUnit:"ml",totalUnit:"\u74F6",price:495},{id:"PC020",productId:"LIQ-017",productName:"\u9AD8\u767B\u7C89\u7D05\u7434\u9152",vendorId:"V024",category:"\u9152\u6C34",itemQuantity:1e3,itemUnit:"ml",totalUnit:"\u74F6",price:549}]);this.mockWineCosts=D([{id:"W01",vendor:"\u5C1A\u5FB7",productName:"\u544A\u767D",type:"\u767D\u6C23\u6CE1",cost:280,sellingPrice:1100},{id:"W02",vendor:"\u4E5D\u6A3D",productName:"Primo Amore Moscato Delle Venezie IGT \u521D\u6200",type:"\u751C\u767D",cost:450,sellingPrice:1100},{id:"W03",vendor:"\u4E5D\u6A3D",productName:"Francois Confuron Gindre Bourgogne (2020)",type:"\u767D\u9152",cost:1150,sellingPrice:2300},{id:"W04",vendor:"\u4E5D\u6A3D",productName:"Moet & Chandon",type:"\u9999\u6AB3",cost:1650,sellingPrice:3500},{id:"W05",vendor:"\u4E5D\u6A3D",productName:"McManis Cab. Sau (2022)",type:"\u7D05\u9152",cost:550,sellingPrice:1100},{id:"W06",vendor:"\u4E5D\u6A3D",productName:"Botter Cuvee16 Limited Edition Rosso Vino 16\u6A02\u7AE0",type:"\u7D05\u9152",cost:750,sellingPrice:2200},{id:"W07",vendor:"\u4E5D\u6A3D",productName:"Saint-Estephe Calon Segur \u5361\u9686\u8CFD\u683C\u4E09\u8ECD (2015)",type:"\u7D05\u9152",cost:1350,sellingPrice:3e3},{id:"W08",vendor:"\u9152\u9F0E",productName:"Adobe Reserva Sauvignon White (2018)",type:"\u767D\u9152",cost:550,sellingPrice:1600},{id:"W09",vendor:"\u9152\u9F0E",productName:"De Martino Estate Cabernet Sauvignon (2022)",type:"\u7D05\u9152",cost:480,sellingPrice:1800},{id:"W10",vendor:"\u9152\u9F0E",productName:"Adobe Reserva Sauvignon Red (2021)",type:"\u7D05\u9152",cost:550,sellingPrice:1600},{id:"W11",vendor:"\u5409\u591A\u5229",productName:"Santero Dile Moscato sweet\u5929\u4F7F\u4E4B\u624B",type:"\u767D\u6C23\u6CE1",cost:285,sellingPrice:1100},{id:"W12",vendor:"\u5409\u591A\u5229",productName:"Louis Eschenauer 24K Carat Gold Muscat Sparkling",type:"\u767D\u6C23\u6CE1",cost:520,sellingPrice:1600},{id:"W13",vendor:"\u5409\u591A\u5229",productName:"Joly de Tr\xE9buis R\xE9serve Brut Champagne",type:"\u9999\u6AB3",cost:1100,sellingPrice:2800},{id:"W14",vendor:"\u5409\u591A\u5229",productName:"Dark Horse Cabernet Sauvignon",type:"\u7D05\u9152",cost:480,sellingPrice:1450},{id:"W15",vendor:"\u5409\u591A\u5229",productName:"Domaine Viticole de la Ville de Colmar Signature de Colmar Pinot Noir",type:"\u7D05\u9152",cost:630,sellingPrice:1600},{id:"W16",vendor:"\u6DFB\u6F64",productName:"Glendronach \u683C\u862D\u591A\u7D0D12\u5E74",type:"\u55AE\u4E00\u9EA5\u82BD\u5A01\u58EB\u5FCC",cost:1150,sellingPrice:3200},{id:"W17",vendor:"\u6DFB\u6F64",productName:"Aberlour \u4E9E\u4F2F\u6A0212\u5E74",type:"\u55AE\u4E00\u9EA5\u82BD\u5A01\u58EB\u5FCC",cost:1100,sellingPrice:3200},{id:"W18",vendor:"\u6DFB\u6F64",productName:"Laphroaig \u62C9\u4F5B\u683C10\u5E74",type:"\u55AE\u4E00\u9EA5\u82BD\u5A01\u58EB\u5FCC",cost:1050,sellingPrice:3300},{id:"W19",vendor:"\u6DFB\u6F64",productName:"Fettercairn \u8CBB\u7279\u80AF12\u5E74",type:"\u55AE\u4E00\u9EA5\u82BD\u5A01\u58EB\u5FCC",cost:1050,sellingPrice:3300},{id:"W20",vendor:"\u6DFB\u6F64",productName:"Glenfiddich \u683C\u862D\u83F2\u8FEA12\u5E74",type:"\u55AE\u4E00\u9EA5\u82BD\u5A01\u58EB\u5FCC",cost:950,sellingPrice:3500},{id:"W21",vendor:"\u6DFB\u6F64",productName:"Balvenie \u767E\u5BCC12\u5E74",type:"\u55AE\u4E00\u9EA5\u82BD\u5A01\u58EB\u5FCC",cost:1350,sellingPrice:3800},{id:"W22",vendor:"\u6DFB\u6F64",productName:"Mortlach \u6155\u8D6B12\u5E74",type:"\u55AE\u4E00\u9EA5\u82BD\u5A01\u58EB\u5FCC",cost:1350,sellingPrice:3800},{id:"W23",vendor:"\u6DFB\u6F64",productName:"Dalmore \u5927\u646912\u5E74",type:"\u55AE\u4E00\u9EA5\u82BD\u5A01\u58EB\u5FCC",cost:1396,sellingPrice:3900},{id:"W24",vendor:"\u6DFB\u6F64",productName:"Ardbeg \u96C5\u67CF10\u5E74",type:"\u55AE\u4E00\u9EA5\u82BD\u5A01\u58EB\u5FCC",cost:1350,sellingPrice:3900},{id:"W25",vendor:"\u6DFB\u6F64",productName:"Macallan \u9EA5\u5361\u502B12\u5E74",type:"\u55AE\u4E00\u9EA5\u82BD\u5A01\u58EB\u5FCC",cost:1650,sellingPrice:4200},{id:"W26",vendor:"\u6DFB\u6F64",productName:"Hibiki \u97FF",type:"\u8ABF\u548C\u5A01\u58EB\u5FCC",cost:2300,sellingPrice:4900},{id:"W27",vendor:"\u6DFB\u6F64",productName:"Johnnie Walker \u7D04\u7FF0\u8D70\u8DEF \u9ED1\u724C 12\u5E74",type:"\u8ABF\u548C\u5A01\u58EB\u5FCC",cost:750,sellingPrice:2100},{id:"W28",vendor:"\u6DFB\u6F64",productName:"Johnnie Walker \u7D04\u7FF0\u8D70\u8DEFXR 21\u5E74",type:"\u8ABF\u548C\u5A01\u58EB\u5FCC",cost:2390,sellingPrice:4900},{id:"W29",vendor:"\u6DFB\u6F64",productName:"Royal Salute \u7687\u5BB6\u79AE\u70AE",type:"\u8ABF\u548C\u5A01\u58EB\u5FCC",cost:2500,sellingPrice:4900},{id:"W30",vendor:"\u5927\u6469",productName:"\u5927\u646915",type:"\u55AE\u4E00\u9EA5\u82BD\u5A01\u58EB\u5FCC",cost:2300,sellingPrice:5200},{id:"W31",vendor:"\u767E\u5BCC",productName:"\u767E\u5BCC14",type:"\u55AE\u4E00\u9EA5\u82BD\u5A01\u58EB\u5FCC",cost:1850,sellingPrice:4200},{id:"W32",vendor:"\u6155\u8D6B",productName:"\u6155\u8D6B16",type:"\u55AE\u4E00\u9EA5\u82BD\u5A01\u58EB\u5FCC",cost:2300,sellingPrice:4900},{id:"W33",vendor:"\u767E\u5BCC",productName:"\u767E\u9F61\u7F4830",type:"\u8ABF\u548C\u5A01\u58EB\u5FCC",cost:7800,sellingPrice:14e3}]);this.mockCigarCosts=D([{id:"C01",brand:"Allados",productName:"Robusto",size:"5*50",quantityPerBox:20,lishengCost:340,baijiaCost:370,sellingPrice:560},{id:"C02",brand:"Allados",productName:"Toro",size:"6*52",quantityPerBox:20,lishengCost:370,baijiaCost:390,sellingPrice:780},{id:"C03",brand:"Oliva",productName:"Flor De Oliva Robusto",size:"5*50",quantityPerBox:25,lishengCost:255,baijiaCost:285,sellingPrice:520},{id:"C04",brand:"Oliva",productName:"Flor De Oliva Toro",size:"6*50",quantityPerBox:25,lishengCost:270,baijiaCost:300,sellingPrice:580},{id:"C05",brand:"Oliva",productName:"Serie O Robusto",size:"5*50",quantityPerBox:20,lishengCost:375,baijiaCost:405,sellingPrice:750},{id:"C06",brand:"Oliva",productName:"Serie O Corona",size:"6*46",quantityPerBox:20,lishengCost:335,baijiaCost:365,sellingPrice:700},{id:"C07",brand:"Oliva",productName:"Serie V Lancero",size:"7*38",quantityPerBox:24,lishengCost:415,baijiaCost:430,sellingPrice:790},{id:"C08",brand:"Oliva",productName:"Serie V Belicoso",size:"5*54",quantityPerBox:24,lishengCost:415,baijiaCost:445,sellingPrice:800},{id:"C09",brand:"Oliva",productName:"Serie V DBL.Robusto",size:"5*54",quantityPerBox:24,lishengCost:450,baijiaCost:480,sellingPrice:820},{id:"C10",brand:"Oliva",productName:"Serie V DBL. Toro",size:"6*60",quantityPerBox:24,lishengCost:520,baijiaCost:550,sellingPrice:1100},{id:"C11",brand:"Oliva",productName:"Serie V Melanio Figurado",size:"6.5*52",quantityPerBox:10,lishengCost:570,baijiaCost:670,sellingPrice:1480},{id:"C12",brand:"Oliva",productName:"Serie V Melanio Toro",size:"6.5*52",quantityPerBox:10,lishengCost:690,baijiaCost:790,sellingPrice:1600},{id:"C13",brand:"Oliva",productName:"Connecticut Res.PETIT Corona",size:"4*38",quantityPerBox:30,lishengCost:270,baijiaCost:300,sellingPrice:540},{id:"C14",brand:"Oliva",productName:"Master Blender 3 Robusto",size:"5*50",quantityPerBox:20,lishengCost:440,baijiaCost:470,sellingPrice:950},{id:"C15",brand:"Oliva",productName:"Master Blender 3 Torpedo",size:"6.5*52",quantityPerBox:10,lishengCost:490,baijiaCost:520,sellingPrice:1e3},{id:"C16",brand:"Oliva",productName:"Oliva 135\u9031\u5E74\u7D00\u5FF5",size:"5.5*54",quantityPerBox:12,lishengCost:900,baijiaCost:1e3,sellingPrice:2e3},{id:"C17",brand:"Oliva",productName:"Oliva 2024\u9F8D\u5E74\u7CFB\u5217",size:"5.5*60",quantityPerBox:10,lishengCost:900,baijiaCost:1e3,sellingPrice:2e3},{id:"C18",brand:"Oliva",productName:"Serie V Melanio Torpedo",size:"6.5*52",quantityPerBox:10,lishengCost:690,baijiaCost:790,sellingPrice:1600}]);this.itemCategoryMap={\u8CC7\u7522:["\u73FE\u91D1","\u61C9\u6536\u5E33\u6B3E","\u5B58\u8CA8-\u9910\u98F2","\u5B58\u8CA8-\u9152\u6C34","\u5B58\u8CA8-\u96EA\u8304","\u88DD\u6F62","\u62BC\u91D1","\u71DF\u696D\u8A2D\u5099"],\u8CA0\u50B5:["\u61C9\u4ED8\u5E33\u6B3E","\u61C9\u4ED8\u88DD\u6F62\u6B3E","\u61C9\u4ED8\u85AA\u8CC7","\u61C9\u4ED8\u80A1\u6771\u56DE\u994B\u91D1","\u61C9\u4ED8\u96EA\u8304\u9032\u8CA8","\u9280\u884C\u501F\u6B3E"],\u696D\u4E3B\u6B0A\u76CA:["\u8CC7\u672C","\u696D\u4E3B\u5B58\u5165","\u696D\u4E3B\u63D0\u51FA","\u672C\u671F\u640D\u76CA"],\u71DF\u696D\u6536\u5165:["\u92B7\u8CA8\u6536\u5165","\u5176\u4ED6\u6536\u5165","-\u92B7\u6216\u6298\u8B93"],\u71DF\u696D\u8CBB\u7528:["\u85AA\u8CC7\u652F\u51FA","\u5065\u4FDD\u8CBB","\u52DE\u4FDD\u8CBB","\u56DE\u994B\u91D1\u652F\u51FA","\u79DF\u91D1\u652F\u51FA","\u4FDD\u96AA\u8CBB","\u8CB8\u6B3E\u5229\u606F","\u5EDA\u623F\u6D88\u8017\u54C1","\u6587\u5177\u7528\u54C1","\u7DB2\u8DEF\u8CBB","\u96FB\u8A71\u8CBB","\u5927\u6A13\u7BA1\u7406\u8CBB","\u6703\u8A08\u8CBB\u7528","\u734E\u91D1\u652F\u51FA","\u6C34\u8CBB","\u74E6\u65AF\u8CBB","\u96FB\u8CBB","\u50AD\u91D1\u8CBB\u7528","\u8A66\u83DC\u8CBB\u7528","\u62DC\u62DC\u8CBB\u7528","pos\u6A5F\u8CBB\u7528","\u5176\u4ED6\u8CBB\u7528","\u71DF\u696D\u7A05"]};this.mockCustomers=D([{id:"C101",name:"\u6797\u5C0F\u59D0",phone:"0912-345-678",note:"VIP\u5BA2\u6236\uFF0C\u5E38\u5BA2",gender:"\u5973\u6027",birthday:"05/20",birthYear:"1990",loyaltyPoints:1250,originStore:"\u4FE1\u7FA9\u9580\u5E02",lastCheckoutAt:"2026-01-25T15:30:00Z",isDeleted:!1},{id:"C102",name:"\u9673\u5148\u751F",phone:"0987-654-321",note:"VIP\u5BA2\u6236\uFF0C\u559C\u611B\u5A01\u58EB\u5FCC",gender:"\u7537\u6027",birthday:"11/12",birthYear:"1985",loyaltyPoints:3400,originStore:"\u4FE1\u7FA9\u9580\u5E02",lastCheckoutAt:"2026-01-23T18:45:00Z",isDeleted:!1},{id:"C103",name:"\u9EC3\u5148\u751F",phone:"0928-111-222",note:"\u559C\u611B\u7D05\u9152",gender:"\u7537\u6027",birthday:"02/28",birthYear:"1992",loyaltyPoints:320,originStore:"\u5357\u4EAC\u9580\u5E02",lastCheckoutAt:"2026-01-20T12:15:00Z",isDeleted:!1},{id:"C104",name:"\u5F35\u5C0F\u59D0",phone:"0933-444-555",note:null,gender:"\u5973\u6027",birthday:"08/08",birthYear:"1998",loyaltyPoints:880,originStore:"\u4FE1\u7FA9\u9580\u5E02",lastCheckoutAt:"2026-01-19T20:30:00Z",isDeleted:!1},{id:"C201",name:"\u5433\u5148\u751F",phone:"0955-666-777",note:"\u5B9A\u671F\u4F86\u8A2A",gender:"\u7537\u6027",birthday:"07/15",birthYear:"1988",loyaltyPoints:150,originStore:"\u6771\u9580\u9580\u5E02",lastCheckoutAt:"2026-01-18T16:00:00Z",isDeleted:!1},{id:"C202",name:"\u5289\u5C0F\u59D0",phone:"0911-222-333",note:"\u5DF2\u505C\u6B62\u670D\u52D9",gender:"\u5973\u6027",birthday:"03/30",birthYear:"1995",loyaltyPoints:0,originStore:"\u4FE1\u7FA9\u9580\u5E02",lastCheckoutAt:"2025-06-30T14:20:00Z",isDeleted:!1}]);this.mockCustomerFeedback=D([{id:"F001",customerId:"C101",date:"2026-01-21",rating:5,comment:"\u5496\u5561\u5F88\u597D\u559D\uFF0C\u751C\u9EDE\u4E5F\u5F88\u68D2\uFF0C\u74B0\u5883\u8212\u9069\u3002"},{id:"F002",customerId:"C102",date:"2026-01-10",rating:4,comment:"\u5A01\u58EB\u5FCC\u9078\u64C7\u5F88\u591A\uFF0C\u96EA\u8304\u54C1\u8CEA\u4E0D\u932F\uFF0C\u4F46\u50F9\u683C\u504F\u9AD8\u3002"},{id:"F003",customerId:"C103",date:"2026-01-15",rating:5,comment:"\u7D05\u9152\u5F88\u9806\u53E3\uFF0C\u70B8\u7269\u62FC\u76E4\u8D85\u597D\u5403\uFF01"},{id:"F004",customerId:"C101",date:"2026-01-05",rating:4,comment:"\u9910\u9EDE\u597D\u5403\uFF0C\u4F46\u6C23\u6CE1\u98F2\u7684\u6C23\u6709\u9EDE\u4E0D\u8DB3\u3002"}]);this.mockLedger2024=[{date:"2024-01-15",description:"\u7DB2\u7AD9\u958B\u767C\u5C08\u6848 - A\u516C\u53F8",category:"\u92B7\u8CA8\u6536\u5165",income:15e4,expense:0},{date:"2024-01-20",description:"\u8FA6\u516C\u5BA4\u7528\u54C1\u63A1\u8CFC",category:"\u6587\u5177\u7528\u54C1",income:0,expense:4500},{date:"2024-02-10",description:"\u8A2D\u8A08\u670D\u52D9\u8CBB - B\u5BA2\u6236",category:"\u92B7\u8CA8\u6536\u5165",income:225e3,expense:0},{date:"2024-02-22",description:"SaaS \u8EDF\u9AD4\u8A02\u95B1\u8CBB",category:"\u5176\u4ED6\u8CBB\u7528",income:0,expense:6e3},{date:"2024-03-05",description:"\u96F2\u7AEF\u4F3A\u670D\u5668\u8CBB\u7528",category:"\u7DB2\u8DEF\u8CBB",income:0,expense:9e3},{date:"2024-03-18",description:"\u7DAD\u8B77\u5408\u7D04 - C\u516C\u53F8",category:"\u92B7\u8CA8\u6536\u5165",income:186e3,expense:0},{date:"2024-04-12",description:"\u6578\u4F4D\u5EE3\u544A\u6295\u653E",category:"\u884C\u92B7\u8CBB\u7528",income:0,expense:36e3},{date:"2024-04-25",description:"App\u958B\u767C\u5C08\u6848 - D\u5BA2\u6236",category:"\u92B7\u8CA8\u6536\u5165",income:243e3,expense:0},{date:"2024-05-15",description:"\u5916\u5305\u5C08\u6848\u8CBB\u7528",category:"\u50AD\u91D1\u8CBB\u7528",income:0,expense:45e3},{date:"2024-06-20",description:"\u9867\u554F\u670D\u52D9\u8CBB",category:"\u92B7\u8CA8\u6536\u5165",income:279e3,expense:0},{date:"2024-07-01",description:"\u8FA6\u516C\u5BA4\u79DF\u91D1 - Q3",category:"\u79DF\u91D1\u652F\u51FA",income:0,expense:6e4},{date:"2024-08-10",description:"\u7CFB\u7D71\u958B\u767C - E\u516C\u53F8",category:"\u92B7\u8CA8\u6536\u5165",income:165e3,expense:0}];this.mockLedger2025=[{date:"2025-01-15",description:"\u5E74\u5EA6\u7DAD\u8B77\u5408\u7D04 - A\u516C\u53F8",category:"\u92B7\u8CA8\u6536\u5165",income:18e4,expense:0},{date:"2025-01-20",description:"\u63A1\u8CFC\u65B0\u7B46\u96FB",category:"\u71DF\u696D\u8A2D\u5099",income:0,expense:75e3},{date:"2025-02-10",description:"\u54C1\u724C\u8A2D\u8A08\u5C08\u6848 - F\u5BA2\u6236",category:"\u92B7\u8CA8\u6536\u5165",income:255e3,expense:0},{date:"2025-02-22",description:"SaaS \u8EDF\u9AD4\u8A02\u95B1\u8CBB",category:"pos\u6A5F\u8CBB\u7528",income:0,expense:7500},{date:"2025-03-05",description:"\u96F2\u7AEF\u4F3A\u670D\u5668\u8CBB\u7528",category:"\u7DB2\u8DEF\u8CBB",income:0,expense:10500},{date:"2025-04-10",description:"\u6578\u4F4D\u5EE3\u544A\u6295\u653E - Q2",category:"\u884C\u92B7\u8CBB\u7528",income:0,expense:42e3},{date:"2025-05-20",description:"ERP \u7CFB\u7D71\u5C0E\u5165 - G \u516C\u53F8",category:"\u92B7\u8CA8\u6536\u5165",income:35e4,expense:0},{date:"2025-06-15",description:"\u8FA6\u516C\u5BA4\u64F4\u5EFA\u5DE5\u7A0B",category:"\u88DD\u6F62",income:0,expense:15e4},{date:"2025-07-01",description:"\u8FA6\u516C\u5BA4\u79DF\u91D1 - Q3",category:"\u79DF\u91D1\u652F\u51FA",income:0,expense:78e3},{date:"2025-08-18",description:"\u6CD5\u5F8B\u9867\u554F\u8CBB",category:"\u6703\u8A08\u8CBB\u7528",income:0,expense:25e3},{date:"2025-09-25",description:"\u96F2\u7AEF\u5E73\u53F0\u958B\u767C - H \u5BA2\u6236",category:"\u92B7\u8CA8\u6536\u5165",income:42e4,expense:0},{date:"2025-10-05",description:"\u4F3A\u670D\u5668\u786C\u9AD4\u5347\u7D1A",category:"\u71DF\u696D\u8A2D\u5099",income:0,expense:95e3},{date:"2025-11-12",description:"\u884C\u92B7\u6D3B\u52D5\u8CBB\u7528",category:"\u884C\u92B7\u8CBB\u7528",income:0,expense:65e3},{date:"2025-12-20",description:"\u5E74\u5EA6\u734E\u91D1\u767C\u653E",category:"\u734E\u91D1\u652F\u51FA",income:0,expense:25e4}];this.mockLedger2026=[{date:"2026-06-01",description:"VIP\u5305\u5EC2\u670D\u52D9\u8CBB",category:"\u92B7\u8CA8\u6536\u5165",income:88e3,expense:0},{date:"2026-06-05",description:"\u4F01\u696D\u5305\u5834\u6D3B\u52D5",category:"\u92B7\u8CA8\u6536\u5165",income:15e4,expense:0},{date:"2026-06-10",description:"\u7CFB\u7D71\u6574\u5408\u670D\u52D9 - M \u516C\u53F8",category:"\u92B7\u8CA8\u6536\u5165",income:22e4,expense:0},{date:"2026-06-12",description:"\u5834\u5730\u79DF\u8CC3\u6536\u5165",category:"\u5176\u4ED6\u6536\u5165",income:25e3,expense:0},{date:"2026-06-15",description:"\u9867\u5BA2\u8A02\u91D1\u6C92\u6536",category:"\u5176\u4ED6\u6536\u5165",income:5e3,expense:0},{date:"2026-06-20",description:"\u719F\u5BA2\u512A\u60E0\u6298\u8B93",category:"\u92B7\u8CA8\u6298\u8B93",income:12e3,expense:0},{date:"2026-06-02",description:"\u516D\u6708\u4EFD\u8FA6\u516C\u5BA4\u79DF\u91D1",category:"\u79DF\u91D1\u652F\u51FA",income:0,expense:8e4},{date:"2026-06-02",description:"\u516D\u6708\u4EFD\u5927\u6A13\u7BA1\u7406\u8CBB",category:"\u5927\u6A13\u7BA1\u7406\u8CBB",income:0,expense:5e3},{date:"2026-06-05",description:"\u54E1\u5DE5\u85AA\u8CC7",category:"\u85AA\u8CC7\u652F\u51FA",income:0,expense:18e4},{date:"2026-06-05",description:"\u52DE\u5065\u4FDD\u8CBB\u7528",category:"\u52DE\u4FDD\u8CBB",income:0,expense:15e3},{date:"2026-06-05",description:"\u52DE\u5065\u4FDD\u8CBB\u7528",category:"\u5065\u4FDD\u8CBB",income:0,expense:18e3},{date:"2026-06-08",description:"\u6C34\u96FB\u74E6\u65AF\u8CBB",category:"\u6C34\u8CBB",income:0,expense:2500},{date:"2026-06-08",description:"\u6C34\u96FB\u74E6\u65AF\u8CBB",category:"\u96FB\u8CBB",income:0,expense:12e3},{date:"2026-06-08",description:"\u6C34\u96FB\u74E6\u65AF\u8CBB",category:"\u74E6\u65AF\u8CBB",income:0,expense:3500},{date:"2026-06-10",description:"\u96FB\u4FE1\u7DB2\u8DEF\u8CBB",category:"\u7DB2\u8DEF\u8CBB",income:0,expense:2e3},{date:"2026-06-10",description:"\u96FB\u4FE1\u7DB2\u8DEF\u8CBB",category:"\u96FB\u8A71\u8CBB",income:0,expense:1500},{date:"2026-06-12",description:"\u5EDA\u623F\u98DF\u6750\u3001\u7D19\u5DFE\u7B49\u6D88\u8017\u54C1",category:"\u5EDA\u623F\u6D88\u8017\u54C1",income:0,expense:18e3},{date:"2026-06-15",description:"\u5F71\u5370\u7D19\u3001\u7B46\u7B49\u8FA6\u516C\u7528\u54C1",category:"\u6587\u5177\u7528\u54C1",income:0,expense:3e3},{date:"2026-06-18",description:"\u884C\u92B7\u6D3B\u52D5\u50AD\u91D1",category:"\u50AD\u91D1\u8CBB\u7528",income:0,expense:22e3},{date:"2026-06-20",description:"POS\u7CFB\u7D71\u6708\u8CBB",category:"pos\u6A5F\u8CBB\u7528",income:0,expense:5e3},{date:"2026-06-21",description:"\u7AEF\u5348\u7BC0\u62DC\u62DC\u7528\u54C1",category:"\u62DC\u62DC\u8CBB\u7528",income:0,expense:2e3},{date:"2026-06-22",description:"\u65B0\u83DC\u8272\u7814\u767C\u98DF\u6750",category:"\u8A66\u83DC\u8CBB\u7528",income:0,expense:8e3},{date:"2026-06-24",description:"\u71DF\u696D\u7528\u8CA1\u7522\u4FDD\u96AA",category:"\u4FDD\u96AA\u8CBB",income:0,expense:6e3},{date:"2026-06-25",description:"\u6703\u8A08\u5E2B\u8A18\u5E33\u8CBB",category:"\u6703\u8A08\u8CBB\u7528",income:0,expense:8e3},{date:"2026-06-25",description:"\u9280\u884C\u8CB8\u6B3E\u5229\u606F",category:"\u8CB8\u6B3E\u5229\u606F",income:0,expense:12e3}];this.mockPurchases=[{date:"2024-01-18",category:"\u9152\u6C34",amount:12e3},{date:"2024-02-05",category:"\u9910\u98F2",amount:8500},{date:"2024-02-25",category:"\u96EA\u8304",amount:25e3},{date:"2024-03-12",category:"\u9152\u6C34",amount:15e3},{date:"2024-04-20",category:"\u9910\u98F2",amount:9800},{date:"2024-05-10",category:"\u96EA\u8304",amount:32e3},{date:"2024-06-22",category:"\u9152\u6C34",amount:18e3},{date:"2024-07-15",category:"\u9910\u98F2",amount:11e3},{date:"2025-01-22",category:"\u9152\u6C34",amount:16e3},{date:"2025-02-15",category:"\u96EA\u8304",amount:45e3},{date:"2025-03-01",category:"\u9910\u98F2",amount:13500},{date:"2025-04-10",category:"\u9152\u6C34",amount:22e3},{date:"2025-05-15",category:"\u9910\u98F2",amount:15e3},{date:"2025-06-20",category:"\u96EA\u8304",amount:52e3},{date:"2025-08-05",category:"\u9152\u6C34",amount:25e3},{date:"2025-10-18",category:"\u9910\u98F2",amount:18e3},{date:"2025-12-01",category:"\u96EA\u8304",amount:65e3},{date:"2026-01-20",category:"\u9152\u6C34",amount:28e3},{date:"2026-02-18",category:"\u9910\u98F2",amount:25e3},{date:"2026-03-10",category:"\u9910\u98F2",amount:21e3},{date:"2026-03-25",category:"\u96EA\u8304",amount:82e3},{date:"2026-04-25",category:"\u96EA\u8304",amount:75e3},{date:"2026-05-15",category:"\u9152\u6C34",amount:35e3},{date:"2026-06-05",category:"\u9152\u6C34",amount:32e3},{date:"2026-06-12",category:"\u9910\u98F2",amount:28e3},{date:"2026-06-20",category:"\u96EA\u8304",amount:95e3}];this.mockPOSSales=[{transactionId:"T201",customerId:"C101",date:"2026-01-05",items:[{name:"\u4E3B\u98DF",price:350,quantity:2},{name:"\u6C23\u6CE1\u98F2",price:120,quantity:2}],total:940},{transactionId:"T202",customerId:"C102",date:"2026-01-10",items:[{name:"\u5A01\u58EB\u5FCC",price:2800,quantity:1},{name:"\u96EA\u8304",price:900,quantity:2}],total:4600},{transactionId:"T203",customerId:"C103",date:"2026-01-15",items:[{name:"\u7D05\u9152/\u767D\u9152",price:1800,quantity:1},{name:"\u70B8\u7269",price:250,quantity:1}],total:2050},{transactionId:"T204",customerId:"C101",date:"2026-01-20",items:[{name:"\u5496\u5561",price:150,quantity:2},{name:"\u751C\u9EDE",price:180,quantity:2}],total:660},{transactionId:"T205",customerId:"C104",date:"2026-01-25",items:[{name:"\u6D3B\u52D5",price:13e3,quantity:1}],total:13e3},{transactionId:"T301",customerId:"C201",date:"2026-02-03",items:[{name:"\u5564\u9152",price:200,quantity:4},{name:"\u70B8\u7269",price:250,quantity:2}],total:1300},{transactionId:"T302",customerId:"C202",date:"2026-02-12",items:[{name:"\u5A01\u58EB\u5FCC",price:3200,quantity:1}],total:3200},{transactionId:"T303",customerId:"C103",date:"2026-02-18",items:[{name:"\u4E3B\u98DF",price:400,quantity:1},{name:"\u8336\u98F2",price:130,quantity:1}],total:530},{transactionId:"T304",customerId:"C201",date:"2026-02-25",items:[{name:"\u96EA\u8304",price:1200,quantity:1}],total:1200},{transactionId:"T401",customerId:"C104",date:"2026-03-05",items:[{name:"\u5834\u5730\u4F7F\u7528\u8CBB",price:4e3,quantity:1}],total:4e3},{transactionId:"T402",customerId:"C101",date:"2026-03-10",items:[{name:"\u8ABF\u9152",price:450,quantity:2},{name:"\u55AE\u9EDE",price:300,quantity:1}],total:1200},{transactionId:"T403",customerId:"C102",date:"2026-03-20",items:[{name:"\u5A01\u58EB\u5FCC",price:2500,quantity:1},{name:"\u96EA\u8304",price:850,quantity:3}],total:5050},{transactionId:"T404",customerId:"C101",date:"2026-03-28",items:[{name:"\u4E0B\u5348\u8336\u5957\u9910",price:600,quantity:2}],total:1200},{transactionId:"T501",customerId:"C104",date:"2026-04-02",items:[{name:"\u5834\u5730\u4F7F\u7528\u8CBB",price:15e3,quantity:1}],total:15e3},{transactionId:"T502",customerId:"C101",date:"2026-04-10",items:[{name:"\u4E3B\u98DF",price:380,quantity:2},{name:"\u7D05\u9152/\u767D\u9152",price:2200,quantity:1}],total:2960},{transactionId:"T503",customerId:"C103",date:"2026-04-22",items:[{name:"\u96EA\u8304",price:1100,quantity:2}],total:2200}];this.productCategoryMap=new Map([["\u5834\u5730\u4F7F\u7528\u8CBB","\u6D3B\u52D5\u5834\u5730"],["\u6D3B\u52D5","\u6D3B\u52D5\u5834\u5730"],["\u8ABF\u9152","\u9152\u6C34"],["\u7D05\u9152/\u767D\u9152","\u9152\u6C34"],["\u5564\u9152","\u9152\u6C34"],["\u5A01\u58EB\u5FCC","\u9152\u6C34"],["\u4E3B\u98DF","\u9910\u98F2"],["\u70B8\u7269","\u9910\u98F2"],["\u5976\u6614","\u9910\u98F2"],["\u6C23\u6CE1\u98F2","\u9910\u98F2"],["\u55AE\u9EDE","\u9910\u98F2"],["\u8336\u98F2","\u9910\u98F2"],["\u8C9D\u679C/\u53EF\u980C","\u9910\u98F2"],["\u5496\u5561","\u9910\u98F2"],["\u751C\u9EDE","\u9910\u98F2"],["\u6C99\u62C9","\u9910\u98F2"],["\u4E0B\u5348\u8336\u5957\u9910","\u9910\u98F2"],["\u96EA\u8304","\u96EA\u8304"]]);this.mockCostRateMap=new Map([["\u6D3B\u52D5\u5834\u5730",.1],["\u9152\u6C34",.35],["\u9910\u98F2",.25],["\u96EA\u8304",.55]]);this.mockMonthlyBalanceSheetData2026={assets:{\u73FE\u91D1:{"2026-01":-60372,"2026-02":0,"2026-03":0,"2026-04":0,"2026-05":0,"2026-06":0,"2026-07":0,"2026-08":0,"2026-09":0,"2026-10":0,"2026-11":0,"2026-12":0},\u61C9\u6536\u5E33\u6B3E:{"2026-01":0,"2026-02":0,"2026-03":0,"2026-04":0,"2026-05":0,"2026-06":0,"2026-07":0,"2026-08":0,"2026-09":0,"2026-10":0,"2026-11":0,"2026-12":0},"\u5B58\u8CA8-\u9910\u98F2":{"2026-01":42459,"2026-02":56424,"2026-03":63318,"2026-04":53737,"2026-05":41714,"2026-06":62941,"2026-07":55331,"2026-08":57454,"2026-09":42199,"2026-10":88353,"2026-11":56195,"2026-12":70131},"\u5B58\u8CA8-\u9152\u6C34":{"2026-01":4561,"2026-02":51162,"2026-03":28630,"2026-04":51807,"2026-05":26140,"2026-06":7117,"2026-07":5707,"2026-08":23549,"2026-09":40217,"2026-10":80083,"2026-11":38428,"2026-12":13344},"\u5B58\u8CA8-\u96EA\u8304":{"2026-01":106380,"2026-02":114733,"2026-03":150810,"2026-04":112936,"2026-05":79912,"2026-06":91653,"2026-07":0,"2026-08":0,"2026-09":0,"2026-10":0,"2026-11":0,"2026-12":0},\u88DD\u6F62:{"2026-01":0,"2026-02":0,"2026-03":0,"2026-04":0,"2026-05":1700030,"2026-06":0,"2026-07":0,"2026-08":0,"2026-09":0,"2026-10":0,"2026-11":0,"2026-12":0},\u62BC\u91D1:{"2026-01":0,"2026-02":0,"2026-03":0,"2026-04":0,"2026-05":0,"2026-06":0,"2026-07":0,"2026-08":0,"2026-09":0,"2026-10":0,"2026-11":0,"2026-12":0},\u71DF\u696D\u8A2D\u5099:{"2026-01":20472,"2026-02":9694,"2026-03":4235,"2026-04":25624,"2026-05":25084,"2026-06":1044,"2026-07":770,"2026-08":2876,"2026-09":6678,"2026-10":25840,"2026-11":5444,"2026-12":1589}},liabilities:{\u61C9\u4ED8\u5E33\u6B3E:{"2026-01":-116791,"2026-02":0,"2026-03":0,"2026-04":0,"2026-05":0,"2026-06":0,"2026-07":0,"2026-08":0,"2026-09":0,"2026-10":0,"2026-11":0,"2026-12":0},\u61C9\u4ED8\u88DD\u6F62\u6B3E:{"2026-01":0,"2026-02":0,"2026-03":0,"2026-04":0,"2026-05":0,"2026-06":-34e4,"2026-07":-34e4,"2026-08":-34e4,"2026-09":-34e4,"2026-10":-26e4,"2026-11":0,"2026-12":0},\u61C9\u4ED8\u85AA\u8CC7:{"2026-01":0,"2026-02":0,"2026-03":0,"2026-04":0,"2026-05":0,"2026-06":0,"2026-07":-73145,"2026-08":-53145,"2026-09":-38145,"2026-10":0,"2026-11":-67145,"2026-12":-50145},\u61C9\u4ED8\u80A1\u6771\u56DE\u994B\u91D1:{"2026-01":0,"2026-02":0,"2026-03":0,"2026-04":0,"2026-05":0,"2026-06":0,"2026-07":0,"2026-08":-21181,"2026-09":-1830,"2026-10":0,"2026-11":0,"2026-12":0},\u61C9\u4ED8\u96EA\u8304\u9032\u8CA8:{"2026-01":0,"2026-02":0,"2026-03":0,"2026-04":0,"2026-05":0,"2026-06":-99275,"2026-07":-78270,"2026-08":-224230,"2026-09":-113975,"2026-10":-118535,"2026-11":-71145,"2026-12":-66350},\u9280\u884C\u501F\u6B3E:{"2026-01":0,"2026-02":0,"2026-03":0,"2026-04":0,"2026-05":2e6,"2026-06":0,"2026-07":0,"2026-08":0,"2026-09":0,"2026-10":0,"2026-11":0,"2026-12":0}},equity:{\u8CC7\u672C:{"2026-01":0,"2026-02":0,"2026-03":0,"2026-04":0,"2026-05":0,"2026-06":0,"2026-07":0,"2026-08":0,"2026-09":0,"2026-10":0,"2026-11":0,"2026-12":0},\u696D\u4E3B\u5B58\u5165:{"2026-01":0,"2026-02":3e5,"2026-03":15e4,"2026-04":5e4,"2026-05":1e5,"2026-06":0,"2026-07":0,"2026-08":0,"2026-09":0,"2026-10":0,"2026-11":0,"2026-12":0},\u696D\u4E3B\u63D0\u51FA:{"2026-01":0,"2026-02":0,"2026-03":0,"2026-04":0,"2026-05":0,"2026-06":0,"2026-07":0,"2026-08":0,"2026-09":0,"2026-10":0,"2026-11":0,"2026-12":0}}};this.mockMonthlyIncomeStatementData2026={revenue:{\u92B7\u8CA8\u6536\u5165:{"2026-01":515140,"2026-02":347057,"2026-03":327890,"2026-04":261350,"2026-05":256858,"2026-06":187580,"2026-07":200710,"2026-08":308020,"2026-09":224550,"2026-10":504140,"2026-11":236815,"2026-12":340853},\u5176\u4ED6\u6536\u5165:{"2026-01":100,"2026-02":0,"2026-03":0,"2026-04":0,"2026-05":0,"2026-06":27677,"2026-07":636,"2026-08":25e3,"2026-09":0,"2026-10":0,"2026-11":0,"2026-12":0},\u92B7\u8CA8\u6298\u8B93:{"2026-01":-111972,"2026-02":-84928,"2026-03":-59978,"2026-04":-58915,"2026-05":-35331,"2026-06":-29417,"2026-07":-22367,"2026-08":-30058,"2026-09":-36237,"2026-10":-55599,"2026-11":-22119,"2026-12":-35978}},expenses:{\u85AA\u8CC7\u652F\u51FA:{"2026-01":-117806,"2026-02":-97814,"2026-03":-110799,"2026-04":-105507,"2026-05":-110155,"2026-06":-109977,"2026-07":-25718,"2026-08":-52922,"2026-09":-70688,"2026-10":-95017,"2026-11":-35040,"2026-12":-37492},\u5065\u4FDD\u8CBB:{"2026-01":0,"2026-02":-2368,"2026-03":-2368,"2026-04":-2368,"2026-05":-2373,"2026-06":-2368,"2026-07":-2368,"2026-08":-2368,"2026-09":-2368,"2026-10":-2368,"2026-11":-2368,"2026-12":0},\u52DE\u4FDD\u8CBB:{"2026-01":-4447,"2026-02":-8883,"2026-03":-5382,"2026-04":-15787,"2026-05":-5138,"2026-06":-4827,"2026-07":-4827,"2026-08":-4827,"2026-09":-4827,"2026-10":-4827,"2026-11":-4827,"2026-12":-4827},\u56DE\u994B\u91D1\u652F\u51FA:{"2026-01":-1654,"2026-02":-1581,"2026-03":-1623,"2026-04":-3320,"2026-05":-9792,"2026-06":0,"2026-07":0,"2026-08":0,"2026-09":0,"2026-10":0,"2026-11":-15e3,"2026-12":0},\u79DF\u91D1\u652F\u51FA:{"2026-01":-72425,"2026-02":-72425,"2026-03":-72425,"2026-04":-72425,"2026-05":-72425,"2026-06":-72425,"2026-07":-72425,"2026-08":-72410,"2026-09":-72410,"2026-10":-72410,"2026-11":-72410,"2026-12":-72410},\u4FDD\u96AA\u8CBB:{"2026-01":0,"2026-02":0,"2026-03":0,"2026-04":0,"2026-05":0,"2026-06":0,"2026-07":0,"2026-08":0,"2026-09":0,"2026-10":0,"2026-11":-21297,"2026-12":0},\u8CB8\u6B3E\u5229\u606F:{"2026-01":0,"2026-02":0,"2026-03":0,"2026-04":0,"2026-05":0,"2026-06":-3824,"2026-07":-3824,"2026-08":-3824,"2026-09":-3824,"2026-10":-3824,"2026-11":-3824,"2026-12":-3824},\u5EDA\u623F\u6D88\u8017\u54C1:{"2026-01":-596,"2026-02":-834,"2026-03":-79,"2026-04":-3002,"2026-05":0,"2026-06":0,"2026-07":-641,"2026-08":-300,"2026-09":0,"2026-10":0,"2026-11":0,"2026-12":-1293},\u6587\u5177\u7528\u54C1:{"2026-01":-266,"2026-02":-590,"2026-03":-1263,"2026-04":-9358,"2026-05":-149,"2026-06":-1255,"2026-07":-207,"2026-08":-953,"2026-09":-152,"2026-10":-163,"2026-11":-1989,"2026-12":-621},\u7DB2\u8DEF\u8CBB:{"2026-01":-4794,"2026-02":0,"2026-03":0,"2026-04":0,"2026-05":-4794,"2026-06":0,"2026-07":-2397,"2026-08":0,"2026-09":0,"2026-10":-2553,"2026-11":-2302,"2026-12":-1344},\u96FB\u8A71\u8CBB:{"2026-01":0,"2026-02":-334,"2026-03":-1302,"2026-04":-338,"2026-05":-369,"2026-06":-359,"2026-07":-330,"2026-08":-316,"2026-09":-328,"2026-10":-310,"2026-11":-357,"2026-12":-340},\u5927\u6A13\u7BA1\u7406\u8CBB:{"2026-01":-1400,"2026-02":-1400,"2026-03":-1400,"2026-04":0,"2026-05":0,"2026-06":-1400,"2026-07":-1400,"2026-08":0,"2026-09":0,"2026-10":-1400,"2026-11":-1400,"2026-12":0},\u6703\u8A08\u8CBB\u7528:{"2026-01":0,"2026-02":-14730,"2026-03":-4e3,"2026-04":0,"2026-05":-4162,"2026-06":0,"2026-07":-4e3,"2026-08":0,"2026-09":0,"2026-10":0,"2026-11":0,"2026-12":0},\u734E\u91D1\u652F\u51FA:{"2026-01":0,"2026-02":-3e3,"2026-03":0,"2026-04":0,"2026-05":0,"2026-06":0,"2026-07":0,"2026-08":0,"2026-09":0,"2026-10":0,"2026-11":0,"2026-12":0},\u6C34\u8CBB:{"2026-01":-709,"2026-02":0,"2026-03":-696,"2026-04":0,"2026-05":-599,"2026-06":0,"2026-07":-525,"2026-08":0,"2026-09":-578,"2026-10":0,"2026-11":-1218,"2026-12":0},\u74E6\u65AF\u8CBB:{"2026-01":-300,"2026-02":0,"2026-03":0,"2026-04":-300,"2026-05":0,"2026-06":0,"2026-07":0,"2026-08":0,"2026-09":-2100,"2026-10":-600,"2026-11":-300,"2026-12":-1540},\u96FB\u8CBB:{"2026-01":0,"2026-02":-8811,"2026-03":-807,"2026-04":0,"2026-05":0,"2026-06":-12543,"2026-07":0,"2026-08":-24358,"2026-09":0,"2026-10":-24920,"2026-11":0,"2026-12":-14417},\u50AD\u91D1\u8CBB\u7528:{"2026-01":0,"2026-02":0,"2026-03":0,"2026-04":0,"2026-05":0,"2026-06":0,"2026-07":0,"2026-08":0,"2026-09":0,"2026-10":0,"2026-11":0,"2026-12":-3e3},\u8A66\u83DC\u8CBB\u7528:{"2026-01":-10530,"2026-02":-1070,"2026-03":-1403,"2026-04":0,"2026-05":0,"2026-06":-225,"2026-07":0,"2026-08":0,"2026-09":0,"2026-10":0,"2026-11":0,"2026-12":0},\u62DC\u62DC\u8CBB\u7528:{"2026-01":-3744,"2026-02":-6043,"2026-03":-1174,"2026-04":-838,"2026-05":-554,"2026-06":-1228,"2026-07":-608,"2026-08":-1258,"2026-09":-1216,"2026-10":-1216,"2026-11":-585,"2026-12":-806},pos\u6A5F\u8CBB\u7528:{"2026-01":0,"2026-02":-11700,"2026-03":0,"2026-04":0,"2026-05":0,"2026-06":0,"2026-07":0,"2026-08":0,"2026-09":0,"2026-10":0,"2026-11":0,"2026-12":0},\u5176\u4ED6\u8CBB\u7528:{"2026-01":-2030,"2026-02":-3058,"2026-03":-3570,"2026-04":0,"2026-05":-25418,"2026-06":-13010,"2026-07":-6445,"2026-08":-154,"2026-09":-1302,"2026-10":-6413,"2026-11":-1e3,"2026-12":-13126},\u71DF\u696D\u7A05:{"2026-01":0,"2026-02":0,"2026-03":-8421,"2026-04":0,"2026-05":0,"2026-06":0,"2026-07":-4915,"2026-08":0,"2026-09":0,"2026-10":0,"2026-11":-22930,"2026-12":0}}};this.mockRebateTransactions=D([{id:"RT001",shareholderName:"\u80A1\u6771 A",checkoutTime:"2024/08/01 20:30:15",discountDetails:"\u9910\u98F28\u6298",invoiceAmount:5e3,rebatePercentage:5,rebateAmount:250,discountUsed:"\u7121"},{id:"RT002",shareholderName:"\u80A1\u6771 A",checkoutTime:"2024/08/15 21:00:00",discountDetails:"\u96EA\u83049\u6298",invoiceAmount:8e3,rebatePercentage:5,rebateAmount:400,discountUsed:"\u751F\u65E5\u5238"},{id:"RT003",shareholderName:"\u80A1\u6771 B",checkoutTime:"2024/08/10 19:45:00",discountDetails:"\u5168\u55AE85\u6298",invoiceAmount:12e3,rebatePercentage:8,rebateAmount:960,discountUsed:"\u7121"}])}getFilteredLedger(e,t){let i=[...this.mockLedger2024,...this.mockLedger2025,...this.mockLedger2026];return!e&&!t?i:i.filter(r=>{let o=r.date,a=e?o>=e:!0,u=t?o<=t:!0;return a&&u})}getFilteredPurchases(e,t){return!e&&!t?this.mockPurchases:this.mockPurchases.filter(i=>{let r=i.date,o=e?r>=e:!0,a=t?r<=t:!0;return o&&a})}getFilteredPOSSales(e,t,i){let r=this.mockPOSSales;return i&&(r=r.filter(o=>o.customerId===i)),!e&&!t?r:r.filter(o=>{let a=o.date,u=e?a>=e:!0,c=t?a<=t:!0;return u&&c})}getFinancialSummary(e,t){let i=this.getFilteredLedger(e,t),r=i.filter(T=>T.category!=="\u92B7\u8CA8\u6298\u8B93").reduce((T,R)=>T+R.income,0),o=i.filter(T=>T.category==="\u92B7\u8CA8\u6298\u8B93").reduce((T,R)=>T+R.income,0),a=r-o,u=i.reduce((T,R)=>T+R.expense,0),c=a-u,g=this.getFilteredPurchases(e,t).reduce((T,R)=>T+R.amount,0),y=1e6+c,v=3e5,C=y-v;return{totalRevenue:a,totalExpenses:u,netIncome:c,totalAssets:y,totalLiabilities:v,equity:C,totalPurchases:g,totalAllowance:o}}getPOSSales(e,t,i){return this.getFilteredPOSSales(e,t,i)}getMonthlyPerformance(e,t){let i=new Map;return this.getFilteredLedger(e,t).forEach(o=>{let a=o.date.substring(0,7);i.has(a)||i.set(a,{revenue:0,expenses:0,accountsPayable:0});let u=i.get(a);o.category==="\u92B7\u8CA8\u6298\u8B93"?u.revenue-=o.income:u.revenue+=o.income,u.expenses+=o.expense,u.accountsPayable=u.expenses*.4+u.revenue*.05}),Array.from(i.keys()).sort().map(o=>O({month:o},i.get(o)))}getExpensesByCategory(e,t){let i=new Map;return this.getFilteredLedger(e,t).forEach(o=>{o.expense>0&&o.category!=="\u8CC7\u672C\u652F\u51FA"&&i.set(o.category,(i.get(o.category)||0)+o.expense)}),Array.from(i.entries()).map(([o,a])=>({category:o,amount:a}))}getPurchasesByCategory(e,t){let i=new Map;return this.getFilteredPurchases(e,t).forEach(o=>{i.set(o.category,(i.get(o.category)||0)+o.amount)}),Array.from(i.entries()).map(([o,a])=>({category:o,amount:a}))}getTopSellingProducts(e,t){let i=new Map;return this.getFilteredPOSSales(e,t).forEach(r=>{r.items.forEach(o=>{let a=i.get(o.name)||{quantitySold:0,revenue:0};a.quantitySold+=o.quantity,a.revenue+=o.price*o.quantity,i.set(o.name,a)})}),Array.from(i.entries()).map(([r,o])=>O({name:r},o)).sort((r,o)=>o.revenue-r.revenue).slice(0,5)}getFilteredPOSSalesByMonth(e,t){return!e&&!t?this.mockPOSSales:this.mockPOSSales.filter(i=>{let r=i.date.substring(0,7),o=e?r>=e:!0,a=t?r<=t:!0;return o&&a})}getAllProductsAnalysis(e,t){let i=new Map,r=this.getFilteredPOSSalesByMonth(e,t),o=r.reduce((a,u)=>a+u.total,0);return r.forEach(a=>{a.items.forEach(u=>{let c=i.get(u.name)||{quantitySold:0,revenue:0,prices:[]};c.quantitySold+=u.quantity,c.revenue+=u.price*u.quantity,c.prices.push(u.price),i.set(u.name,c)})}),i.size===0?[]:Array.from(i.entries()).map(([a,u])=>{let c=u.prices.length>0?u.prices.reduce((g,y)=>g+y,0)/u.prices.length:0,p=o>0?u.revenue/o*100:0;return{name:a,category:this.productCategoryMap.get(a)||"\u5176\u4ED6",quantitySold:u.quantitySold,revenue:u.revenue,avgPrice:c,revenueShare:p}}).sort((a,u)=>u.revenue-a.revenue)}getProductAnalysisReport(e,t){let i=this.getFilteredPOSSalesByMonth(e,t);if(i.length===0)return null;let r=[...new Set(i.map(C=>C.date.substring(0,7)))].sort(),o=new Map,a=new Map;r.forEach(C=>a.set(C,{revenue:0}));for(let C of i){let T=C.date.substring(0,7);a.get(T).revenue+=C.total;for(let R of C.items){o.has(R.name)||o.set(R.name,{category:this.productCategoryMap.get(R.name)||"\u5176\u4ED6",totalRevenue:0,totalQuantity:0,monthly:new Map});let F=o.get(R.name),P=R.price*R.quantity;F.totalRevenue+=P,F.totalQuantity+=R.quantity,F.monthly.has(T)||F.monthly.set(T,{revenue:0,quantity:0});let H=F.monthly.get(T);H.revenue+=P,H.quantity+=R.quantity}}let u=Array.from(a.values()).reduce((C,T)=>C+T.revenue,0);if(u===0)return null;let c=Array.from(o.entries()).map(([C,T])=>{let R={};for(let F of r){let P=T.monthly.get(F),H=a.get(F).revenue,q=this.mockCostRateMap.get(T.category)||0;R[F]={quantitySold:P?.quantity||0,revenue:P?.revenue||0,revenueShare:H>0?(P?.revenue||0)/H*100:0,costRate:q>0?q+(Math.random()-.5)*.1:0}}return{name:C,category:T.category,totalRevenue:T.totalRevenue,totalQuantity:T.totalQuantity,totalRevenueShare:T.totalRevenue/u*100,monthlyMetrics:R}}),p=["\u6D3B\u52D5\u5834\u5730","\u9152\u6C34","\u9910\u98F2","\u96EA\u8304"],g=[];for(let C of p){let T=c.filter(H=>H.category===C).sort((H,q)=>q.totalRevenue-H.totalRevenue);if(T.length===0)continue;let R={};for(let H of r){let q=T.reduce((de,$e)=>de+$e.monthlyMetrics[H].quantitySold,0),Z=T.reduce((de,$e)=>de+$e.monthlyMetrics[H].revenue,0),ie=a.get(H).revenue,me=T.reduce((de,$e)=>de+$e.monthlyMetrics[H].revenue*$e.monthlyMetrics[H].costRate,0);R[H]={quantitySold:q,revenue:Z,revenueShare:ie>0?Z/ie*100:0,costRate:Z>0?me/Z:0}}let F=T.reduce((H,q)=>H+q.totalRevenue,0),P={name:"\u5C0F\u8A08",category:C,totalRevenue:F,totalQuantity:T.reduce((H,q)=>H+q.totalQuantity,0),totalRevenueShare:F/u*100,monthlyMetrics:R};g.push({category:C,products:T,subtotal:P})}let y={};for(let C of r){let T=a.get(C).revenue,R=g.reduce((F,P)=>F+P.subtotal.monthlyMetrics[C].revenue*P.subtotal.monthlyMetrics[C].costRate,0);y[C]={quantitySold:g.reduce((F,P)=>F+P.subtotal.monthlyMetrics[C].quantitySold,0),revenue:T,revenueShare:100,costRate:T>0?R/T:0}}let v={name:"\u7E3D\u8A08",category:"",totalRevenue:u,totalQuantity:g.reduce((C,T)=>C+T.subtotal.totalQuantity,0),totalRevenueShare:100,monthlyMetrics:y};return{months:r,categoryGroups:g,grandTotal:v}}getIncomeStatement(e,t){let i=this.getFilteredLedger(e,t),r=new Map,o=new Map;i.forEach(y=>{y.income>0&&r.set(y.category,(r.get(y.category)||0)+y.income),y.expense>0&&o.set(y.category,(o.get(y.category)||0)+y.expense)});let a=r.get("\u92B7\u8CA8\u6536\u5165")||0,u=r.get("\u5176\u4ED6\u6536\u5165")||0,c=r.get("\u92B7\u8CA8\u6298\u8B93")||0,p={items:[{account:"\u92B7\u8CA8\u6536\u5165",amount:a},{account:"\u5176\u4ED6\u6536\u5165",amount:u},{account:"\u92B7\u8CA8\u6298\u8B93",amount:-c}],total:a+u-c},g={items:Array.from(o.entries()).map(([y,v])=>({account:y,amount:v})).sort((y,v)=>v.amount-y.amount),total:Array.from(o.values()).reduce((y,v)=>y+v,0)};return{operatingRevenue:p,operatingExpenses:g,netIncome:p.total-g.total}}getBalanceSheet(e,t){let i=this.getIncomeStatement(e,t),r=i.netIncome,o=this.getFilteredPurchases(e,t),u={items:[{account:"\u73FE\u91D1",amount:5e5+r},{account:"\u61C9\u6536\u5E33\u6B3E",amount:i.operatingRevenue.total*.15},{account:"\u5B58\u8CA8-\u9910\u98F2",amount:o.filter(C=>C.category==="\u9910\u98F2").reduce((C,T)=>C+T.amount,0)*.4},{account:"\u5B58\u8CA8-\u9152\u6C34",amount:o.filter(C=>C.category==="\u9152\u6C34").reduce((C,T)=>C+T.amount,0)*.5},{account:"\u5B58\u8CA8-\u96EA\u8304",amount:o.filter(C=>C.category==="\u96EA\u8304").reduce((C,T)=>C+T.amount,0)*.6},{account:"\u88DD\u6F62",amount:12e5},{account:"\u62BC\u91D1",amount:15e4},{account:"\u71DF\u696D\u8A2D\u5099",amount:45e4}],total:0};u.total=u.items.reduce((C,T)=>C+T.amount,0);let c={items:[{account:"\u61C9\u4ED8\u5E33\u6B3E",amount:i.operatingExpenses.total*.3},{account:"\u61C9\u4ED8\u88DD\u6F62\u6B3E",amount:25e4},{account:"\u61C9\u4ED8\u85AA\u8CC7",amount:45e3},{account:"\u61C9\u4ED8\u80A1\u6771\u56DE\u994B\u91D1",amount:15e3},{account:"\u61C9\u4ED8\u96EA\u8304\u9032\u8CA8",amount:35e3},{account:"\u9280\u884C\u501F\u6B3E",amount:8e5}],total:0};c.total=c.items.reduce((C,T)=>C+T.amount,0);let p={items:[{account:"\u8CC7\u672C",amount:1e6},{account:"\u696D\u4E3B\u5B58\u5165",amount:5e4},{account:"\u696D\u4E3B\u63D0\u51FA",amount:-2e4},{account:"\u672C\u671F\u640D\u76CA",amount:r}],total:0};p.total=p.items.reduce((C,T)=>C+T.amount,0);let g=c.total+p.total,y=u.total-g,v=p.items.find(C=>C.account==="\u8CC7\u672C");return v&&(v.amount+=y,p.total+=y),{assets:u,liabilities:c,equity:p,totalLiabilitiesAndEquity:u.total}}getMonthlyBalanceSheetReport(e,t){if(e!==2026)return null;let i=this.mockMonthlyBalanceSheetData2026,r=`${e}-`,o=Array.from({length:12},(C,T)=>r+String(T+1).padStart(2,"0")),a;if(t==="all")a=o;else{let C=(t-1)*3+1;a=o.slice(C-1,C+2)}let u=C=>{let T=[],R={};for(let P in C){let H=C[P],q=H[a[a.length-1]]||0;T.push({account:P,monthlyAmounts:H,total:q,percentage:0})}for(let P of o)R[P]=T.reduce((H,q)=>H+(q.monthlyAmounts[P]||0),0);let F=R[a[a.length-1]]||0;return{items:T,monthlyTotals:R,grandTotal:F}},c=u(i.assets),p=u(i.liabilities),g=u(i.equity);c.grandTotal!==0&&c.items.forEach(C=>C.percentage=C.total/c.grandTotal*100);let y=p.grandTotal+g.grandTotal;y!==0&&(p.items.forEach(C=>C.percentage=C.total/y*100),g.items.forEach(C=>C.percentage=C.total/y*100));let v={items:[],monthlyTotals:{},grandTotal:y};for(let C of o)v.monthlyTotals[C]=(p.monthlyTotals[C]||0)+(g.monthlyTotals[C]||0);return{months:a,assets:c,liabilities:p,equity:g,totalLiabilitiesAndEquity:v}}getMonthlyIncomeStatementReport(e,t){if(e!==2026)return null;let i=this.mockMonthlyIncomeStatementData2026,r=`${e}-`,o=Array.from({length:12},(y,v)=>r+String(v+1).padStart(2,"0")),a;if(t==="all")a=o;else{let y=(t-1)*3+1;a=o.slice(y-1,y+2)}let u=y=>{let v=[],C={};for(let R in y){let F=y[R],P=a.reduce((H,q)=>H+(F[q]||0),0);v.push({account:R,monthlyAmounts:F,total:P,percentage:0})}for(let R of o)C[R]=v.reduce((F,P)=>F+(P.monthlyAmounts[R]||0),0);let T=a.reduce((R,F)=>R+(C[F]||0),0);return T!==0&&v.forEach(R=>R.percentage=R.total/T*100),{items:v,monthlyTotals:C,grandTotal:T}},c=u(i.revenue),p=u(i.expenses),g={monthlyTotals:{},grandTotal:c.grandTotal+p.grandTotal};for(let y of o)g.monthlyTotals[y]=(c.monthlyTotals[y]||0)+(p.monthlyTotals[y]||0);return{months:a,operatingRevenue:c,operatingExpenses:p,netIncome:g}}getTransactions(e){let t=this.mockTransactions();if(e.startDate&&(t=t.filter(i=>i.date>=e.startDate)),e.endDate&&(t=t.filter(i=>i.date<=e.endDate)),e.item&&(t=t.filter(i=>i.item===e.item)),e.category&&(t=t.filter(i=>i.category===e.category)),e.vendorName&&(t=t.filter(i=>i.vendorName===e.vendorName)),e.description){let i=e.description.toLowerCase();t=t.filter(r=>r.description?.toLowerCase().includes(i))}return t}addTransaction(e){let t=G(O({},e),{id:`TXN${Date.now()}`});this.mockTransactions.update(i=>[...i,t])}updateTransaction(e){this.mockTransactions.update(t=>t.map(i=>i.id===e.id?e:i))}getLedgerFilterOptions(){let e=this.mockTransactions(),t=[...new Set(e.map(o=>o.item))],i=[...new Set(e.map(o=>o.category))],r=[...new Set(e.map(o=>o.vendorName).filter(o=>!!o))];return{items:t.sort(),categories:i.sort(),vendorNames:r.sort()}}getEvents(){return this.mockEvents()}getEventById(e){return this.mockEvents().find(t=>t.id===e)}addEvent(e){let t=G(O({},e),{id:`EVT${Date.now()}`});this.mockEvents.update(i=>[...i,t])}updateEvent(e){this.mockEvents.update(t=>t.map(i=>i.id===e.id?e:i))}deleteEvent(e){this.mockEvents.update(t=>t.filter(i=>i.id!==e))}getDailyRevenueReport(e,t){let i=new Date(e,t-1,1),o=new Date(e,t,0).getDate(),a=`${e}-${String(t).padStart(2,"0")}`,u=[];for(let c=1;c<=o;c++){let p=`${a}-${String(c).padStart(2,"0")}`,g=this.mockDailyRevenue().find(R=>R.date===p)||{date:p,nonEventRevenue:0,isDayOff:!1},y=this.mockEvents().filter(R=>R.date===p&&R.status==="active"),v=y.reduce((R,F)=>R+F.actualRevenue,0),C=g.nonEventRevenue+v,T=y.map(R=>R.name);u.push({day:c,date:p,isDayOff:g.isDayOff,totalDailyRevenue:C,eventRevenue:v,eventNames:T})}return u}getDailyRevenueEntryByDate(e){return this.mockDailyRevenue().find(t=>t.date===e)||{date:e,nonEventRevenue:0,isDayOff:!1}}updateDailyRevenueEntry(e,t){this.mockDailyRevenue.update(i=>{let r=i.findIndex(o=>o.date===e);if(r>-1){let o=[...i];return o[r]=O(O({},o[r]),t),o}else return[...i,{date:e,nonEventRevenue:t.nonEventRevenue??0,isDayOff:t.isDayOff??!1}]})}getEmployees(e){let t=this.mockEmployees();return e?t.filter(i=>i.type===e):t}getEmployeeById(e){return this.mockEmployees().find(t=>t.id===e)}getPayrollSummary(e,t){let i=this.getEmployees("full-time"),r=this.getEmployees("part-time"),o=`${e}-${String(t).padStart(2,"0")}`,a=i.reduce((p,g)=>p+(g.monthlySalary||0),0),u=r.map(p=>{let g=this.mockPunchRecords().filter(T=>T.employeeId===p.id&&T.date.startsWith(o)),y=0,v=0,C=!1;return g.forEach(T=>{if(!T.clockIn||!T.clockOut){C=!0;return}let[R,F]=T.clockIn.split(":").map(Number),[P,H]=T.clockOut.split(":").map(Number),q=new Date(0,0,0,R,F),Z=new Date(0,0,0,P,H);if(Z<q)return;let me=(Z.getTime()-q.getTime())/(1e3*60)/60,de=Math.floor(me*100)/100;y+=de;let $e=de*(p.hourlyRate||0);T.isDoublePay&&($e*=2),v+=$e}),{employeeId:p.id,name:p.name,totalHours:y,totalPay:v,hasMissingPunch:C}}),c=u.reduce((p,g)=>p+g.totalPay,0);return{fullTimePayroll:a,partTimePayroll:c,partTimeDetails:u}}getPunchRecordsForMonth(e,t,i){let r=`${t}-${String(i).padStart(2,"0")}`;return this.mockPunchRecords().filter(o=>o.employeeId===e&&o.date.startsWith(r))}updatePunchRecords(e,t,i,r){let o=`${t}-${String(i).padStart(2,"0")}`;this.mockPunchRecords.update(a=>{let u=a.filter(p=>!(p.employeeId===e&&p.date.startsWith(o))),c=r.filter(p=>p.clockIn||p.clockOut);return[...u,...c]})}getVendors(){return this.mockVendors()}addVendor(e){let t=G(O({},e),{id:`V${Date.now()}`});this.mockVendors.update(i=>[...i,t])}updateVendor(e){this.mockVendors.update(t=>t.map(i=>i.id===e.id?e:i))}deleteVendor(e){this.mockVendors.update(t=>t.filter(i=>i.id!==e))}getPurchaseOrders(){return this.mockPurchaseOrders()}addPurchaseOrder(e){let t=G(O({},e),{id:`PO${Date.now()}`});this.mockPurchaseOrders.update(i=>[...i,t])}updatePurchaseOrder(e){this.mockPurchaseOrders.update(t=>t.map(i=>i.id===e.id?e:i))}deletePurchaseOrder(e){this.mockPurchaseOrders.update(t=>t.filter(i=>i.id!==e))}getProductCosts(){return this.mockProductCosts()}addProductCost(e){let t=G(O({},e),{id:`PC${Date.now()}`});this.mockProductCosts.update(i=>[...i,t])}updateProductCost(e){this.mockProductCosts.update(t=>t.map(i=>i.id===e.id?e:i))}deleteProductCost(e){this.mockProductCosts.update(t=>t.filter(i=>i.id!==e))}getCigarCosts(){return this.mockCigarCosts()}addCigarCost(e){let t=G(O({},e),{id:`C${Date.now()}`});this.mockCigarCosts.update(i=>[...i,t])}updateCigarCost(e){this.mockCigarCosts.update(t=>t.map(i=>i.id===e.id?e:i))}deleteCigarCost(e){this.mockCigarCosts.update(t=>t.filter(i=>i.id!==e))}getWineCosts(){return this.mockWineCosts()}addWineCost(e){let t=G(O({},e),{id:`W${Date.now()}`});this.mockWineCosts.update(i=>[...i,t])}updateWineCost(e){this.mockWineCosts.update(t=>t.map(i=>i.id===e.id?e:i))}deleteWineCost(e){this.mockWineCosts.update(t=>t.filter(i=>i.id!==e))}getCustomers(){return this.mockCustomers()}getFeedbackForCustomer(e){return this.mockCustomerFeedback().filter(t=>t.customerId===e)}getAnnualSummaryReport(e,t){let i=Array.from({length:t-e+1},(a,u)=>e+u),r={years:i,revenue:{total:0},expense:{total:0},net:{total:0},unpaid:{total:0}},o=[...this.mockLedger2024,...this.mockLedger2025,...this.mockLedger2026];return i.forEach(a=>{let u=o.filter(v=>v.date.startsWith(a.toString())),c=u.filter(v=>v.category!=="\u92B7\u8CA8\u6298\u8B93").reduce((v,C)=>v+C.income,0),p=u.filter(v=>v.category==="\u92B7\u8CA8\u6298\u8B93").reduce((v,C)=>v+C.income,0),g=c-p,y=u.reduce((v,C)=>v+C.expense,0);r.revenue[a]=g,r.expense[a]=y,r.net[a]=g-y,r.unpaid[a]=y*.15}),r.revenue.total=i.reduce((a,u)=>a+r.revenue[u],0),r.expense.total=i.reduce((a,u)=>a+r.expense[u],0),r.net.total=i.reduce((a,u)=>a+r.net[u],0),r.unpaid.total=i.reduce((a,u)=>a+r.unpaid[u],0),r}getMonthlyDetail(e,t){let i=e.toString(),o=[...this.mockLedger2024,...this.mockLedger2025,...this.mockLedger2026].filter(u=>u.date.startsWith(i)),a={year:e,type:t==="unpaid"?"\u672A\u4ED8":t==="revenue"?"\u6536\u5165":"\u652F\u51FA",data:[]};for(let u=1;u<=12;u++){let c=`${i}-${String(u).padStart(2,"0")}`,p=o.filter(v=>v.date?.startsWith(c));if(p.length===0)continue;let g=0,y=new Map;t==="revenue"?p.forEach(v=>{if(v.income>0){let C=v.category==="\u92B7\u8CA8\u6298\u8B93"?-v.income:v.income;y.set(v.category,(y.get(v.category)||0)+C),g+=C}}):t==="expense"?p.forEach(v=>{v.expense>0&&(y.set(v.category,(y.get(v.category)||0)+v.expense),g+=v.expense)}):(g=p.reduce((C,T)=>C+T.expense,0)*.15,y.set("\u61C9\u4ED8\u5E33\u6B3E",g*.7),y.set("\u61C9\u4ED8\u85AA\u8CC7",g*.3)),a.data.push({month:u,total:g,items:Array.from(y.entries()).map(([v,C])=>({name:v,amount:C}))})}return a.data.length>0?a:null}getProductGrossMarginReport(e,t){let i={dining:{totalPurchases:5e4,totalSales:15e4,grossMargin:1e5,grossMarginRate:.66},drinks:{totalPurchases:8e4,totalSales:2e5,grossMargin:12e4,grossMarginRate:.6},cigars:{totalPurchases:12e4,totalSales:22e4,grossMargin:1e5,grossMarginRate:.45},venue:{totalPurchases:1e4,totalSales:8e4,grossMargin:7e4,grossMarginRate:.875},total:{totalPurchases:26e4,totalSales:65e4,grossMargin:39e4,grossMarginRate:.6}},r=[],o=new Date(e.replace("/","-")+"-01"),a=new Date(t.replace("/","-")+"-01");for(;o<=a;){let u=5e4+Math.random()*2e4,c=6e4+Math.random()*3e4,p=7e4+Math.random()*4e4,g=2e4+Math.random()*1e4;r.push({month:`${o.getFullYear()}/${String(o.getMonth()+1).padStart(2,"0")}`,dining:u,drinks:c,cigars:p,venue:g,total:u+c+p+g}),o.setMonth(o.getMonth()+1)}return{summary:i,monthlySales:r}}getShareholderRebates(e,t){return[{name:"\u80A1\u6771 A",currentMonthRebate:650,unpaidRebate:1500,cumulativeRebate:8500},{name:"\u80A1\u6771 B",currentMonthRebate:960,unpaidRebate:500,cumulativeRebate:12e3},{name:"\u80A1\u6771 C",currentMonthRebate:200,unpaidRebate:2200,cumulativeRebate:5500}]}getMonthlyRebateHistory(e){return[{year:2024,month:8,totalRebate:650,unpaidRebate:0},{year:2024,month:7,totalRebate:850,unpaidRebate:850},{year:2024,month:6,totalRebate:500,unpaidRebate:0}].filter(t=>t.totalRebate>0)}getRebateTransactions(e,t,i){let r=`${t}/${String(i).padStart(2,"0")}`;return this.mockRebateTransactions().filter(o=>o.shareholderName===e&&o.checkoutTime.startsWith(r))}updateRebateTransaction(e){this.mockRebateTransactions.update(t=>t.map(i=>i.id===e.id?G(O({},e),{isEdited:!0}):i))}getTargetGoals(){return this.mockTargetGoals()}addTargetGoal(e){let t=G(O({},e),{id:`TG${Date.now()}`});this.mockTargetGoals.update(i=>[...i,t])}updateTargetGoal(e){this.mockTargetGoals.update(t=>t.map(i=>i.id===e.id?e:i))}deleteTargetGoal(e){this.mockTargetGoals.update(t=>t.filter(i=>i.id!==e))}};Eo.\u0275fac=function(t){return new(t||Eo)},Eo.\u0275prov=X({token:Eo,factory:Eo.\u0275fac,providedIn:"root"});var zn=Eo;var YV=["mainCategoryChart"],JV=["diningChart"],KV=["drinksChart"],QV=["monthlyTrendChart"],ZV=(n,e)=>e.month;function XV(n,e){if(n&1&&(l(0,"option",13),d(1),s()),n&2){let t=e.$implicit;I("value",t),m(),N("",t,"\u5E74")}}function e9(n,e){if(n&1&&(l(0,"option",13),d(1),s()),n&2){let t=e.$implicit;I("value",t),m(),N("",t,"\u6708")}}function t9(n,e){if(n&1&&(l(0,"option",13),d(1),s()),n&2){let t=e.$implicit;I("value",t),m(),N("",t,"\u5E74")}}function n9(n,e){if(n&1&&(l(0,"option",13),d(1),s()),n&2){let t=e.$implicit;I("value",t),m(),N("",t,"\u6708")}}function i9(n,e){if(n&1){let t=B();l(0,"div",4)(1,"div",10)(2,"label",11),d(3,"\u5F9E:"),s(),l(4,"select",12),b("ngModelChange",function(r){E(t);let o=_();return S(o.selectedStartYear.set(r))}),V(5,XV,2,2,"option",13,Y),s(),l(7,"select",12),b("ngModelChange",function(r){E(t);let o=_();return S(o.selectedStartMonth.set(r))}),V(8,e9,2,2,"option",13,Y),s()(),l(10,"div",10)(11,"label",11),d(12,"\u81F3:"),s(),l(13,"select",12),b("ngModelChange",function(r){E(t);let o=_();return S(o.selectedEndYear.set(r))}),V(14,t9,2,2,"option",13,Y),s(),l(16,"select",12),b("ngModelChange",function(r){E(t);let o=_();return S(o.selectedEndMonth.set(r))}),V(17,n9,2,2,"option",13,Y),s()(),l(19,"div",14)(20,"button",15),b("click",function(){E(t);let r=_();return S(r.applyAnalysisFilter())}),x(21,"ion-icon",16),l(22,"span"),d(23,"\u5957\u7528"),s()(),l(24,"button",17),b("click",function(){E(t);let r=_();return S(r.resetAnalysisFilter())}),x(25,"ion-icon",18),s()()()}if(n&2){let t=_();m(4),I("ngModel",t.selectedStartYear()),m(),L(t.analysisYears()),m(2),I("ngModel",t.selectedStartMonth()),m(),L(t.analysisMonths()),m(5),I("ngModel",t.selectedEndYear()),m(),L(t.analysisYears()),m(2),I("ngModel",t.selectedEndMonth()),m(),L(t.analysisMonths())}}function r9(n,e){if(n&1&&(l(0,"option",13),d(1),s()),n&2){let t=e.$implicit;I("value",t),m(),N("",t,"\u5E74")}}function o9(n,e){if(n&1&&(l(0,"option",13),d(1),s()),n&2){let t=e.$implicit;I("value",t),m(),N("",t,"\u6708")}}function a9(n,e){if(n&1&&(l(0,"option",13),d(1),s()),n&2){let t=e.$implicit;I("value",t),m(),N("",t,"\u5E74")}}function s9(n,e){if(n&1&&(l(0,"option",13),d(1),s()),n&2){let t=e.$implicit;I("value",t),m(),N("",t,"\u6708")}}function l9(n,e){if(n&1){let t=B();l(0,"div",4)(1,"div",10)(2,"label",11),d(3,"\u5F9E:"),s(),l(4,"select",12),K("ngModelChange",function(r){E(t);let o=_();return Q(o.selectedMarginStartYear,r)||(o.selectedMarginStartYear=r),S(r)}),V(5,r9,2,2,"option",13,Y),s(),l(7,"select",12),K("ngModelChange",function(r){E(t);let o=_();return Q(o.selectedMarginStartMonth,r)||(o.selectedMarginStartMonth=r),S(r)}),V(8,o9,2,2,"option",13,Y),s()(),l(10,"div",10)(11,"label",11),d(12,"\u81F3:"),s(),l(13,"select",12),K("ngModelChange",function(r){E(t);let o=_();return Q(o.selectedMarginEndYear,r)||(o.selectedMarginEndYear=r),S(r)}),V(14,a9,2,2,"option",13,Y),s(),l(16,"select",12),K("ngModelChange",function(r){E(t);let o=_();return Q(o.selectedMarginEndMonth,r)||(o.selectedMarginEndMonth=r),S(r)}),V(17,s9,2,2,"option",13,Y),s()(),l(19,"div",14)(20,"button",15),b("click",function(){E(t);let r=_();return S(r.applyMarginFilter())}),x(21,"ion-icon",16),l(22,"span"),d(23,"\u5957\u7528"),s()(),l(24,"button",17),b("click",function(){E(t);let r=_();return S(r.resetMarginFilter())}),x(25,"ion-icon",18),s()()()}if(n&2){let t=_();m(4),J("ngModel",t.selectedMarginStartYear),m(),L(t.marginYears()),m(2),J("ngModel",t.selectedMarginStartMonth),m(),L(t.marginAllMonths()),m(5),J("ngModel",t.selectedMarginEndYear),m(),L(t.marginYears()),m(2),J("ngModel",t.selectedMarginEndMonth),m(),L(t.marginAllMonths())}}function u9(n,e){n&1&&(l(0,"div",19)(1,"h3",20),d(2,"\u6708\u92B7\u552E\u8DA8\u52E2"),s(),l(3,"div",26),x(4,"canvas",null,0),s()())}function d9(n,e){n&1&&(l(0,"div",22)(1,"div",27),x(2,"div",28),l(3,"p",29),d(4,"\u8F09\u5165\u5546\u54C1\u92B7\u552E\u8CC7\u6599\u4E2D..."),s()()())}function c9(n,e){if(n&1&&(l(0,"div",23)(1,"div",30),x(2,"ion-icon",31),l(3,"div",32)(4,"p",33),d(5,"\u5546\u54C1\u92B7\u552E\u8CC7\u6599\u8F09\u5165\u5931\u6557"),s(),l(6,"div",34),d(7),s()()(),l(8,"div",35),d(9," \u{1F4A1} \u63D0\u793A\uFF1A\u76EE\u524D\u8CC7\u6599\u5EAB\u4E2D\u53EA\u6709 "),l(10,"strong"),d(11,"2024-2025 \u5E74"),s(),d(12,"\u7684\u5546\u54C1\u92B7\u552E\u8CC7\u6599\u3002 "),s()()),n&2){let t=_(2);m(7),N(" ",t.productSalesError()," ")}}function m9(n,e){if(n&1&&(l(0,"th",40),d(1),s()),n&2){let t=e.$implicit,i=_(3);m(),w(i.formatMonth(t))}}function p9(n,e){n&1&&(l(0,"th",44),d(1,"\u92B7\u552E\u91CF"),s(),l(2,"th",45),d(3,"\u71DF\u696D\u984D"),s(),l(4,"th",45),d(5,"\u71DF\u696D\u984D\u4F54\u6BD4"),s())}function f9(n,e){if(n&1&&(l(0,"td",49),d(1),s()),n&2){let t=_().$implicit;j("bg-yellow-50",t.isSubtotal)("bg-red-100",t.isTotal)("bg-white",!t.isSubtotal&&!t.isTotal),m(),N(" ",t.category," ")}}function g9(n,e){n&1&&x(0,"td",47)}function h9(n,e){if(n&1&&(l(0,"td",50),d(1),s(),l(2,"td",50),d(3),s(),l(4,"td",50),d(5),s()),n&2){let t=e.$implicit,i=_().$implicit,r=_(3);m(),w((i.monthlyData[t]==null?null:i.monthlyData[t].sales)||0),m(2),w(r.formatCurrency((i.monthlyData[t]==null?null:i.monthlyData[t].revenue)||0)),m(2),N("",((i.monthlyData[t]==null?null:i.monthlyData[t].rate)||0).toFixed(2),"%")}}function y9(n,e){if(n&1&&(l(0,"tr"),M(1,f9,2,7,"td",46)(2,g9,1,0,"td",47),l(3,"td",48),d(4),s(),V(5,h9,6,3,null,null,Y),s()),n&2){let t=e.$implicit,i=_(3);Te(t.isSubtotal?"bg-yellow-50 font-semibold":t.isTotal?"bg-red-100 font-bold":"hover:bg-gray-50"),m(),A(!t.item||t.item==="\u5C0F\u8A08"||t.item==="\u7E3D\u8A08"?1:2),m(2),j("bg-yellow-50",t.isSubtotal)("bg-red-100",t.isTotal)("bg-white",!t.isSubtotal&&!t.isTotal),m(),N(" ",t.item||t.category," "),m(),L(i.monthlySalesData().months)}}function _9(n,e){if(n&1&&(l(0,"div",24)(1,"table",36)(2,"thead",37)(3,"tr")(4,"th",38),d(5,"\u5206\u985E"),s(),l(6,"th",39),d(7,"\u54C1\u9805"),s(),V(8,m9,2,1,"th",40,Y),s(),l(10,"tr"),x(11,"th",41)(12,"th",42),V(13,p9,6,0,null,null,Y),s()(),l(15,"tbody"),V(16,y9,7,10,"tr",43,sn),s()()()),n&2){let t=_(2);m(8),L(t.monthlySalesData().months),m(5),L(t.monthlySalesData().months),m(3),L(t.monthlySalesData().data)}}function v9(n,e){n&1&&(l(0,"div",25)(1,"p",51),d(2,"\u672A\u627E\u5230\u5546\u54C1\u92B7\u552E\u8CC7\u6599"),s(),l(3,"p",52),d(4,"\u8ACB\u9078\u64C7\u6642\u9593\u7BC4\u570D\u4E26\u5957\u7528\u7BE9\u9078"),s()())}function C9(n,e){if(n&1&&(l(0,"div",1),M(1,u9,6,0,"div",19),l(2,"div")(3,"h3",20),d(4,"\u5546\u54C1\u92B7\u552E\u660E\u7D30\u8868"),s(),l(5,"div",21),M(6,d9,5,0,"div",22),M(7,c9,13,1,"div",23),M(8,_9,18,0,"div",24),M(9,v9,5,0,"div",25),s()()()),n&2){let t=_();m(),A(!t.isLoadingProductSales()&&t.productSalesData().length>0?1:-1),m(5),A(t.isLoadingProductSales()?6:-1),m(),A(t.productSalesError()?7:-1),m(),A(!t.isLoadingProductSales()&&t.monthlySalesData().data.length>0?8:-1),m(),A(!t.isLoadingProductSales()&&t.monthlySalesData().data.length===0&&!t.productSalesError()?9:-1)}}function x9(n,e){n&1&&(l(0,"div",22)(1,"div",27),x(2,"div",28),l(3,"p",29),d(4,"\u8F09\u5165\u5546\u54C1\u6BDB\u5229\u8CC7\u6599\u4E2D..."),s()()())}function b9(n,e){if(n&1&&(l(0,"div",23)(1,"div",30),x(2,"ion-icon",31),l(3,"div",32)(4,"p",33),d(5,"\u5546\u54C1\u6BDB\u5229\u8CC7\u6599\u8F09\u5165\u5931\u6557"),s(),l(6,"div",34),d(7),s()()(),l(8,"div",35),d(9," \u{1F4A1} \u63D0\u793A\uFF1A\u76EE\u524D\u8CC7\u6599\u5EAB\u4E2D\u53EA\u6709 "),l(10,"strong"),d(11,"2024-2025 \u5E74"),s(),d(12,"\u7684\u5546\u54C1\u92B7\u552E\u8CC7\u6599\u3002 "),s()()),n&2){let t=_(2);m(7),N(" ",t.marginDataError()," ")}}function E9(n,e){if(n&1&&(l(0,"tr",64)(1,"td",65),d(2),s(),l(3,"td"),d(4),s(),l(5,"td"),d(6),s(),l(7,"td"),d(8),s(),l(9,"td"),d(10),s(),l(11,"td",66),d(12),s()()),n&2){let t=e.$implicit,i=_(3);m(2),w(t.month),m(2),w(i.formatCurrency(t.dining)),m(2),w(i.formatCurrency(t.drinks)),m(2),w(i.formatCurrency(t.cigars)),m(2),w(i.formatCurrency(t.venue)),m(2),w(i.formatCurrency(t.total))}}function S9(n,e){n&1&&(l(0,"tr")(1,"td",67),d(2,"\u6B64\u6642\u9593\u5340\u9593\u7121\u8CC7\u6599\u3002"),s()())}function D9(n,e){if(n&1&&(l(0,"div",21)(1,"table",53)(2,"thead",54)(3,"tr",55),x(4,"th",56),l(5,"th",57),d(6,"\u9910\u98F2"),s(),l(7,"th",57),d(8,"\u9152\u6C34"),s(),l(9,"th",57),d(10,"\u96EA\u8304(\u542B\u61C9\u4ED8)"),s(),l(11,"th",57),d(12,"\u6D3B\u52D5\u5834\u5730"),s(),l(13,"th",57),d(14,"\u5C0F\u8A08"),s()()(),l(15,"tbody")(16,"tr",58)(17,"td",59),d(18,"\u9032\u8CA8\u7E3D\u8A08"),s(),l(19,"td"),d(20),s(),l(21,"td"),d(22),s(),l(23,"td"),d(24),s(),l(25,"td",60),d(26,"--"),s(),l(27,"td",61),d(28),s()(),l(29,"tr",58)(30,"td",59),d(31,"\u92B7\u8CA8\u7E3D\u8A08(\u6263\u6298\u8B93)"),s(),l(32,"td"),d(33),s(),l(34,"td"),d(35),s(),l(36,"td"),d(37),s(),l(38,"td"),d(39),s(),l(40,"td",61),d(41),s()(),l(42,"tr",62)(43,"td",59),d(44,"\u6BDB\u5229"),s(),l(45,"td"),d(46),s(),l(47,"td"),d(48),s(),l(49,"td"),d(50),s(),l(51,"td",60),d(52,"--"),s(),l(53,"td",61),d(54),s()(),l(55,"tr",63)(56,"td",59),d(57,"\u6BDB\u5229\u7387"),s(),l(58,"td"),d(59),s(),l(60,"td"),d(61),s(),l(62,"td"),d(63),s(),l(64,"td",60),d(65,"--"),s(),l(66,"td",61),d(67),s()(),V(68,E9,13,6,"tr",64,ZV,!1,S9,3,0,"tr"),s()()()),n&2){let t=e,i=_(2);m(20),w(i.formatCurrency(t.summary.dining.totalPurchases)),m(2),w(i.formatCurrency(t.summary.drinks.totalPurchases)),m(2),w(i.formatCurrency(t.summary.cigars.totalPurchases)),m(4),w(i.formatCurrency(t.summary.total.totalPurchases)),m(5),w(i.formatCurrency(t.summary.dining.totalSales)),m(2),w(i.formatCurrency(t.summary.drinks.totalSales)),m(2),w(i.formatCurrency(t.summary.cigars.totalSales)),m(2),w(i.formatCurrency(t.summary.venue.totalSales)),m(2),w(i.formatCurrency(t.summary.total.totalSales)),m(4),j("text-red-600",t.summary.dining.grossMargin<0),m(),w(i.formatCurrency(t.summary.dining.grossMargin)),m(),j("text-red-600",t.summary.drinks.grossMargin<0),m(),w(i.formatCurrency(t.summary.drinks.grossMargin)),m(),j("text-red-600",t.summary.cigars.grossMargin<0),m(),w(i.formatCurrency(t.summary.cigars.grossMargin)),m(3),j("text-red-600",t.summary.total.grossMargin<0),m(),w(i.formatCurrency(t.summary.total.grossMargin)),m(4),j("text-red-600",t.summary.dining.grossMarginRate<0),m(),N("",(t.summary.dining.grossMarginRate*100).toFixed(2),"%"),m(),j("text-red-600",t.summary.drinks.grossMarginRate<0),m(),N("",(t.summary.drinks.grossMarginRate*100).toFixed(2),"%"),m(),j("text-red-600",t.summary.cigars.grossMarginRate<0),m(),N("",(t.summary.cigars.grossMarginRate*100).toFixed(2),"%"),m(3),j("text-red-600",t.summary.total.grossMarginRate<0),m(),N("",(t.summary.total.grossMarginRate*100).toFixed(2),"%"),m(),L(t.monthlySales)}}function w9(n,e){n&1&&(l(0,"div",25)(1,"p",51),d(2,"\u672A\u627E\u5230\u5546\u54C1\u6BDB\u5229\u8CC7\u6599"),s(),l(3,"p",52),d(4,"\u8ACB\u9078\u64C7\u6642\u9593\u7BC4\u570D\u4E26\u5957\u7528\u7BE9\u9078"),s()())}function T9(n,e){if(n&1&&(M(0,x9,5,0,"div",22),M(1,b9,13,1,"div",23),M(2,D9,71,34,"div",21),M(3,w9,5,0,"div",25)),n&2){let t,i=_();A(i.isLoadingMarginData()?0:-1),m(),A(i.marginDataError()?1:-1),m(),A((t=!i.isLoadingMarginData()&&i.productGrossMarginReport())?2:-1,t),m(),A(!i.isLoadingMarginData()&&!i.productGrossMarginReport()&&!i.marginDataError()?3:-1)}}var Ga=class Ga{constructor(){this.apiService=k(we);this.dataService=k(zn);this.injector=k(Qt);this.chartInstances=[];this.colors={main:["#3b82f6","#8b5cf6","#ef4444","#f59e0b"],sub:["#1d4ed8","#3b82f6","#60a5fa","#93c5fd","#bfdbfe"]};this.activeView=D("analysis");this.productSalesData=D([]);this.isLoadingProductSales=D(!1);this.productSalesError=D(null);this.report=D(null);this.analysisYears=D([2025,2024,2023]);this.analysisMonths=D(Array.from({length:12},(e,t)=>t+1));this.selectedStartYear=D(new Date().getMonth()>=3?new Date().getFullYear():new Date().getFullYear()-1);this.selectedStartMonth=D(new Date().getMonth()>=3?new Date().getMonth()-2:new Date().getMonth()+10);this.selectedEndYear=D(new Date().getFullYear());this.selectedEndMonth=D(new Date().getMonth()+1);this.productGrossMarginReport=D(null);this.isLoadingMarginData=D(!1);this.marginDataError=D(null);this.marginYears=D([2025,2024]);this.marginAllMonths=D(Array.from({length:12},(e,t)=>t+1));this.selectedMarginStartYear=D(2024);this.selectedMarginStartMonth=D(12);this.selectedMarginEndYear=D(2025);this.selectedMarginEndMonth=D(12);this.monthlySalesData=$(()=>{let e=this.productSalesData();if(!e||e.length===0)return{months:[],data:[]};let t=this.buildMonthRange(this.selectedStartYear(),this.selectedStartMonth(),this.selectedEndYear(),this.selectedEndMonth());if(console.log("========== monthlySalesData \u8A08\u7B97\u958B\u59CB =========="),console.log("\u9078\u64C7\u7684\u6708\u4EFD\u7BC4\u570D:",t),console.log("\u6536\u5230\u7684\u5206\u985E\u6578:",e.length),e[0]&&console.log("\u7B2C\u4E00\u500B\u5206\u985E\u7684\u6708\u4EFD:",e[0].items.map(u=>u.reportMonth)),t.length===0)return console.warn("\u6708\u4EFD\u7BC4\u570D\u70BA\u7A7A\uFF01"),{months:[],data:[]};let i=[{name:"\u5176\u4ED6",items:["\u5834\u5730\u4F7F\u7528\u8CBB","\u6D3B\u52D5"]},{name:"\u9152\u6C34",items:["\u8ABF\u9152","\u7D05\u9152/\u767D\u9152","\u5564\u9152","\u5A01\u58EB\u5FCC"]},{name:"\u9910\u98F2",items:["\u4E3B\u98DF","\u70B8\u7269","\u5976\u6614","\u6C23\u6CE1\u98F2","\u55AE\u9EDE","\u8336\u98F2","\u8C9D\u679C/\u53EF\u980C","\u5496\u5561","\u751C\u9EDE","\u6C99\u62C9","\u4E0B\u5348\u8336\u5957\u9910"]},{name:"\u96EA\u8304",items:["\u96EA\u8304"]}],r={};i.forEach(u=>{r[u.name]={},t.forEach(c=>{let p=0,g=0;u.items.forEach(y=>{let v=e.find(C=>C.categoryName===y);if(v){let C=v.items.filter(T=>T.reportMonth===c);p+=C.reduce((T,R)=>T+(R.salesNumber||0),0),g+=C.reduce((T,R)=>T+(R.salesAmount||0),0)}}),r[u.name][c]={sales:p,revenue:g}})});let o=[];i.forEach(u=>{if(u.items.length===1&&u.items[0]==="\u96EA\u8304"){let c={};t.forEach(p=>{let g=r[u.name][p];c[p]={sales:g.sales,revenue:g.revenue,rate:0}}),o.push({category:u.name,item:null,isCategory:!0,monthlyData:c})}else{u.items.forEach(p=>{let g={};t.forEach(y=>{let v=e.find(C=>C.categoryName===p);if(v){let C=v.items.filter(F=>F.reportMonth===y),T=C.reduce((F,P)=>F+(P.salesNumber||0),0),R=C.reduce((F,P)=>F+(P.salesAmount||0),0);R>0&&console.log(`\u2713 ${p} ${y}: \u71DF\u696D\u984D=${R}, \u92B7\u91CF=${T}`),g[y]={sales:T,revenue:R,rate:0}}else g[y]={sales:0,revenue:0,rate:0}}),o.push({category:u.name,item:p,isCategory:!1,isItem:!0,monthlyData:g})});let c={};t.forEach(p=>{let g=r[u.name][p];c[p]={sales:g.sales,revenue:g.revenue,rate:0}}),o.push({category:u.name,item:"\u5C0F\u8A08",isSubtotal:!0,monthlyData:c})}}),t.forEach(u=>{let c=i.reduce((p,g)=>p+(r[g.name][u]?.revenue||0),0);o.forEach(p=>{if(p.monthlyData[u]){if(p.isSubtotal||p.isCategory)p.monthlyData[u].rate=c>0?p.monthlyData[u].revenue/c*100:0;else if(p.isItem){let g=r[p.category][u];p.monthlyData[u].rate=g.revenue>0?p.monthlyData[u].revenue/g.revenue*100:0}}})});let a={};return t.forEach(u=>{let c=i.reduce((g,y)=>g+(r[y.name][u]?.sales||0),0),p=i.reduce((g,y)=>g+(r[y.name][u]?.revenue||0),0);a[u]={sales:c,revenue:p,rate:100}}),o.push({category:"\u5408\u8A08",item:"\u7E3D\u8A08",isTotal:!0,monthlyData:a}),{months:t,data:o}});this.summaryMetrics=$(()=>{let e=this.productSalesData();if(!e||e.length===0)return{uniqueProducts:0,totalItemsSold:0,bestContributor:"N/A",totalRevenue:0};let t=e.flatMap(a=>a.items),i=t.length>0?t.sort((a,u)=>u.salesAmount-a.salesAmount)[0]:null,r=e.reduce((a,u)=>a+u.salesAmount,0),o=e.reduce((a,u)=>a+u.salesNumber,0);return{uniqueProducts:t.length,totalItemsSold:o,bestContributor:i?.itemName||"N/A",totalRevenue:r}});this.chartData=$(()=>{let e=this.productSalesData();if(!e||e.length===0)return{main:[],dining:[],drinks:[],cigars:[],other:[]};let t=e.map(r=>({name:r.categoryName,value:r.salesAmount})),i=r=>{let o=e.find(a=>a.categoryName===r);return o?o.items.map(a=>({name:a.itemName,value:a.salesAmount})):[]};return{main:t,dining:i("\u9910\u98F2"),drinks:i("\u9152\u6C34"),cigars:i("\u96EA\u8304"),other:i("\u5176\u4ED6")}});this.monthlyTrendChartData=$(()=>{let e=this.productSalesData();if(console.log("\u{1F4C8} monthlyTrendChartData computed \u88AB\u89F8\u767C"),console.log("categories \u9577\u5EA6:",e?.length),!e||e.length===0)return console.warn("\u26A0\uFE0F \u6C92\u6709 productSalesData"),{labels:[],datasets:[]};let t=this.buildMonthRange(this.selectedStartYear(),this.selectedStartMonth(),this.selectedEndYear(),this.selectedEndMonth());if(console.log("sortedMonths:",t),t.length===0)return console.warn("\u26A0\uFE0F sortedMonths \u70BA\u7A7A"),{labels:[],datasets:[]};let i=t.map(a=>this.formatMonth(a));console.log("\u5716\u8868 labels:",i);let o=[{displayName:"\u5176\u4ED6",dbCategories:["\u5834\u5730\u4F7F\u7528\u8CBB","\u6D3B\u52D5"],color:"#10b981"},{displayName:"\u9152\u6C34",dbCategories:["\u8ABF\u9152","\u7D05\u9152/\u767D\u9152","\u5564\u9152","\u5A01\u58EB\u5FCC"],color:"#8b5cf6"},{displayName:"\u9910\u98F2",dbCategories:["\u4E3B\u98DF","\u70B8\u7269","\u5976\u6614","\u6C23\u6CE1\u98F2","\u55AE\u9EDE","\u8336\u98F2","\u8C9D\u679C/\u53EF\u980C","\u5496\u5561","\u751C\u9EDE","\u6C99\u62C9","\u4E0B\u5348\u8336\u5957\u9910"],color:"#3b82f6"},{displayName:"\u96EA\u8304",dbCategories:["\u96EA\u8304"],color:"#ef4444"}].map(a=>{let u=t.map(c=>{let p=0;return a.dbCategories.forEach(g=>{let y=e.find(v=>v.categoryName===g);if(y){let v=y.items.filter(C=>C.reportMonth===c);p+=v.reduce((C,T)=>C+(T.salesAmount||0),0)}}),p});return{label:a.displayName,data:u,borderColor:a.color,backgroundColor:`${a.color}1A`,fill:!0,tension:.4}});return console.log("datasets \u751F\u6210\u5B8C\u6210:",o.map(a=>({label:a.label,dataLength:a.data.length}))),{labels:i,datasets:o}});this.applyAnalysisFilter(),this.applyMarginFilter(),Wi(()=>{this.activeView()==="analysis"&&this.createAllCharts(this.chartData())}),Bn(()=>{let e=this.activeView();kt(this.injector,()=>{Wi(()=>{e==="analysis"?this.updateAllCharts(this.chartData()):this.destroyCharts()})})})}changeView(e){this.activeView.set(e)}async applyAnalysisFilter(){let e=`${this.selectedStartYear()}-${String(this.selectedStartMonth()).padStart(2,"0")}`,t=`${this.selectedEndYear()}-${String(this.selectedEndMonth()).padStart(2,"0")}`;if(e>t){this.productSalesError.set("\u274C \u932F\u8AA4\uFF1A\u8D77\u59CB\u5E74\u6708\u4E0D\u80FD\u665A\u65BC\u7D50\u675F\u5E74\u6708\u3002");return}if(this.selectedStartYear()===2026){this.productSalesError.set(`\u26A0\uFE0F \u63D0\u793A\uFF1A\u8CC7\u6599\u5EAB\u4E2D\u76EE\u524D\u53EA\u6709 2024-2025 \u5E74\u7684\u5546\u54C1\u92B7\u552E\u8CC7\u6599\u3002
\u5DF2\u81EA\u52D5\u8ABF\u6574\u70BA 2025 \u5E74\u3002\u8ACB\u9EDE\u64CA\u300C\u5957\u7528\u300D\u91CD\u65B0\u67E5\u8A62\u3002`),this.selectedStartYear.set(2025),this.selectedEndYear.set(2025);return}this.isLoadingProductSales.set(!0),this.productSalesError.set(null);try{console.log("\u2550".repeat(60)),console.log("\u5546\u54C1\u92B7\u552E\u8CC7\u6599\u67E5\u8A62"),console.log("\u2550".repeat(60)),console.log("\u67E5\u8A62\u53C3\u6578:",{startMonth:e,endMonth:t,selectedYear:this.selectedStartYear()});let r=await this.apiService.getProductSales({startMonth:e,endMonth:t,limit:1e4});if(console.log("API \u539F\u59CB\u56DE\u61C9:",{success:r.success,total:r.total,count:r.count,dataLength:r.data?r.data.length:0,categoriesLength:r.categories?r.categories.length:0}),console.log("API \u5B8C\u6574\u56DE\u61C9 data \u524D10\u7B46:",r.data?.slice(0,10)),!r)throw new Error("API \u8FD4\u56DE\u7A7A\u56DE\u61C9");if(!r.success)throw new Error(`API \u8FD4\u56DE\u5931\u6557: ${r.error||"\u672A\u77E5\u932F\u8AA4"}`);if(r.data&&r.data.length>0){console.log(`\u2713 \u6536\u5230 ${r.data.length} \u7B46\u539F\u59CB\u8CC7\u6599\uFF0C\u6B63\u5728\u6309\u5206\u985E\u5206\u7D44...`),console.log("\u524D5\u7B46\u539F\u59CB\u8CC7\u6599:",r.data.slice(0,5));let o=new Map;r.data.forEach(c=>{let p=c.reportMonth;o.set(p,(o.get(p)||0)+1)}),console.log("\u6708\u4EFD\u5206\u4F48:",Array.from(o.entries()).sort());let a=new Map;r.data.forEach(c=>{let p=c.categoryName||"\u5176\u4ED6";a.has(p)||a.set(p,[]),a.get(p).push(c)});let u=[];a.forEach((c,p)=>{console.log(`\u5206\u985E "${p}" \u6709 ${c.length} \u7B46\u8CC7\u6599`),u.push({categoryName:p,categoryUuid:c[0].categoryUuid||"",items:c})}),console.log(`\u2713 \u5206\u7D44\u5B8C\u6210\uFF1A${u.length} \u500B\u5206\u985E`),console.log("\u7B2C\u4E00\u500B\u5206\u985E:",u[0]),u[0]&&(console.log("\u7B2C\u4E00\u500B\u5206\u985E\u7684 items \u6578\u91CF:",u[0].items.length),console.log("\u7B2C\u4E00\u500B\u5206\u985E\u7684\u524D3\u500B items:",u[0].items.slice(0,3))),this.productSalesData.set(u),setTimeout(()=>{console.log("\u{1F4CA} \u6E96\u5099\u66F4\u65B0\u6708\u92B7\u552E\u8DA8\u52E2\u5716\u8868..."),this.createMonthlyTrendChartOnly()},100)}else if(!r.categories||r.categories.length===0)if(console.warn("\u26A0\uFE0F API \u8FD4\u56DE success=true \u4F46 categories \u9663\u5217\u70BA\u7A7A"),console.warn("API \u56DE\u61C9\u9375\u503C:",Object.keys(r)),console.warn("\u5B8C\u6574\u56DE\u61C9:",JSON.stringify(r,null,2)),r.data&&r.data.length>0){console.log("\u2713 \u6AA2\u6E2C\u5230 data \u6B04\u4F4D\u6709\u8CC7\u6599\uFF0C\u6B63\u5728\u91CD\u65B0\u5206\u7D44...");let o=new Map;r.data.forEach(u=>{let c=u.categoryName||"\u5176\u4ED6";o.has(c)||o.set(c,[]),o.get(c).push(u)});let a=[];o.forEach((u,c)=>{let p=u.reduce((y,v)=>y+Number(v.salesAmount||0),0),g=u.reduce((y,v)=>y+Number(v.salesNumber||0),0);a.push({categoryName:c,categoryUuid:u[0].categoryUuid||"",reportMonth:u[0].reportMonth||"",salesAmount:p,salesNumber:g,averagePrice:g>0?p/g:0,items:u})}),console.log(`\u2713 \u5F9E data \u91CD\u65B0\u5206\u7D44\u6210 ${a.length} \u500B\u5206\u985E`),this.productSalesData.set(a),setTimeout(()=>{console.log("\u{1F4CA} \u6E96\u5099\u66F4\u65B0\u6708\u92B7\u552E\u8DA8\u52E2\u5716\u8868..."),this.createMonthlyTrendChartOnly()},100)}else{let o=`\u2717 \u67E5\u8A62\u6642\u9593\u7BC4\u570D\uFF1A${e} \u5230 ${t}
\u2717 API \u8FD4\u56DE\uFF1Atotal=${r.total}, count=${r.count}
\u2717 \u5EFA\u8B70\uFF1A\u9078\u64C7 2024-2025 \u5E74\u9593\u7684\u6708\u4EFD`;this.productSalesError.set(`\u7121\u6CD5\u7372\u53D6\u5546\u54C1\u92B7\u552E\u8CC7\u6599

\u53EF\u80FD\u539F\u56E0\uFF1A
1. \u9078\u64C7\u7684\u6642\u9593\u7BC4\u570D\u6C92\u6709\u92B7\u552E\u8A18\u9304
2. \u8CC7\u6599\u5EAB\u4E2D\u8A72\u6708\u4EFD\u7121\u5546\u54C1\u92B7\u552E\u8CC7\u6599
3. \u8ACB\u9078\u64C7 2024 \u6216 2025 \u5E74

`+o)}}catch(r){console.error("\u274C \u8F09\u5165\u5546\u54C1\u92B7\u552E\u8CC7\u6599\u6642\u767C\u751F\u932F\u8AA4:",r);let o=r instanceof Error?r.message:"\u8F09\u5165\u5546\u54C1\u92B7\u552E\u8CC7\u6599\u5931\u6557\uFF0C\u8ACB\u7A0D\u5F8C\u91CD\u8A66";this.productSalesError.set(`\u274C \u932F\u8AA4\uFF1A${o}

\u8A66\u8A66\u770B\uFF1A
1. \u78BA\u8A8D\u5F8C\u7AEF\u670D\u52D9\u5DF2\u555F\u52D5
2. \u9078\u64C7 2024-2025 \u5E74\u7684\u6708\u4EFD
3. \u6253\u958B\u700F\u89BD\u5668 F12 \u67E5\u770B\u8A73\u7D30\u932F\u8AA4`),this.productSalesData.set([])}finally{this.isLoadingProductSales.set(!1)}}resetAnalysisFilter(){let e=new Date,t=e.getFullYear(),i=e.getMonth()+1;i>=4?(this.selectedStartYear.set(t),this.selectedStartMonth.set(i-3)):(this.selectedStartYear.set(t-1),this.selectedStartMonth.set(i+9)),this.selectedEndYear.set(t),this.selectedEndMonth.set(i),this.productSalesError.set(null),this.applyAnalysisFilter()}async applyMarginFilter(){let e=`${this.selectedMarginStartYear()}-${String(this.selectedMarginStartMonth()).padStart(2,"0")}`,t=`${this.selectedMarginEndYear()}-${String(this.selectedMarginEndMonth()).padStart(2,"0")}`;if(e>t){this.marginDataError.set("\u274C \u932F\u8AA4\uFF1A\u8D77\u59CB\u5E74\u6708\u4E0D\u80FD\u665A\u65BC\u7D50\u675F\u5E74\u6708\u3002");return}this.isLoadingMarginData.set(!0),this.marginDataError.set(null);try{console.log("\u2550".repeat(60)),console.log("\u5546\u54C1\u6BDB\u5229\u8CC7\u6599\u67E5\u8A62"),console.log("\u2550".repeat(60)),console.log("\u67E5\u8A62\u53C3\u6578:",{startMonth:e,endMonth:t});let[i,r]=await Promise.all([this.apiService.getProductSales({startMonth:e,endMonth:t,limit:1e4}),this.apiService.getPurchaseCosts({startMonth:e,endMonth:t})]);if(!i||!i.success)throw new Error(`\u92B7\u552E\u6578\u64DA API \u8FD4\u56DE\u5931\u6557: ${i?.error||"\u672A\u77E5\u932F\u8AA4"}`);if(!r||!r.success)throw new Error(`\u9032\u8CA8\u6578\u64DA API \u8FD4\u56DE\u5931\u6557: ${r?.error||"\u672A\u77E5\u932F\u8AA4"}`);if(!i.data||i.data.length===0){this.marginDataError.set(`\u26A0\uFE0F \u63D0\u793A\uFF1A\u9078\u64C7\u7684\u6642\u9593\u7BC4\u570D\u5167\u6C92\u6709\u5546\u54C1\u92B7\u552E\u8CC7\u6599\u3002

\u76EE\u524D\u8CC7\u6599\u5EAB\u4E2D\u53EA\u6709 2024-2025 \u5E74\u7684\u5546\u54C1\u92B7\u552E\u8CC7\u6599\u3002`),this.productGrossMarginReport.set(null);return}console.log(`\u2713 \u6536\u5230 ${i.data.length} \u7B46\u5546\u54C1\u92B7\u552E\u8CC7\u6599`),console.log("\u2713 \u6536\u5230\u9032\u8CA8\u6210\u672C\u8CC7\u6599:",r.data.summary);let o={\u9910\u98F2:["\u4E3B\u98DF","\u70B8\u7269","\u5976\u6614","\u6C23\u6CE1\u98F2","\u55AE\u9EDE","\u8336\u98F2","\u8C9D\u679C/\u53EF\u980C","\u5496\u5561","\u751C\u9EDE","\u6C99\u62C9","\u4E0B\u5348\u8336\u5957\u9910"],\u9152\u6C34:["\u8ABF\u9152","\u7D05\u9152/\u767D\u9152","\u5564\u9152","\u5A01\u58EB\u5FCC"],\u96EA\u8304:["\u96EA\u8304"],\u6D3B\u52D5\u5834\u5730:["\u5834\u5730\u4F7F\u7528\u8CBB","\u6D3B\u52D5","\u5176\u4ED6"]},a=r.data.summary,u={dining:{totalPurchases:a.dining,totalSales:0,grossMargin:0,grossMarginRate:0},drinks:{totalPurchases:a.drinks,totalSales:0,grossMargin:0,grossMarginRate:0},cigars:{totalPurchases:a.cigars,totalSales:0,grossMargin:0,grossMarginRate:0},venue:{totalPurchases:null,totalSales:0,grossMargin:null,grossMarginRate:null},total:{totalPurchases:a.total,totalSales:0,grossMargin:0,grossMarginRate:0}},c=new Map;i.data.forEach(g=>{let y=g.categoryName||"\u5176\u4ED6",v=g.salesAmount||0,C=g.reportMonth,T=null;if(o.\u9910\u98F2.includes(y)?T="dining":o.\u9152\u6C34.includes(y)?T="drinks":o.\u96EA\u8304.includes(y)?T="cigars":o.\u6D3B\u52D5\u5834\u5730.includes(y)&&(T="venue"),T){u[T].totalSales+=v,u.total.totalSales+=v,c.has(C)||c.set(C,{month:C.replace("-","/"),dining:0,drinks:0,cigars:0,venue:0,total:0});let R=c.get(C);R[T]+=v,R.total+=v}}),["dining","drinks","cigars","total"].forEach(g=>{let y=u[g];y.totalPurchases!==null&&(y.grossMargin=y.totalSales-y.totalPurchases,y.grossMarginRate=y.totalSales>0?y.grossMargin/y.totalSales:0)});let p=Array.from(c.values()).sort((g,y)=>g.month.localeCompare(y.month));console.log("\u2713 \u5546\u54C1\u6BDB\u5229\u8A08\u7B97\u5B8C\u6210:",{summary:u,monthlySalesCount:p.length}),this.productGrossMarginReport.set({summary:u,monthlySales:p})}catch(i){console.error("\u274C \u8F09\u5165\u5546\u54C1\u6BDB\u5229\u8CC7\u6599\u6642\u767C\u751F\u932F\u8AA4:",i);let r=i instanceof Error?i.message:"\u8F09\u5165\u5546\u54C1\u6BDB\u5229\u8CC7\u6599\u5931\u6557\uFF0C\u8ACB\u7A0D\u5F8C\u91CD\u8A66";this.marginDataError.set(`\u274C \u932F\u8AA4\uFF1A${r}

\u63D0\u793A\uFF1A
1. \u78BA\u8A8D\u5F8C\u7AEF\u670D\u52D9\u5DF2\u555F\u52D5
2. \u9078\u64C7 2024-2025 \u5E74\u7684\u6708\u4EFD
3. \u6253\u958B\u700F\u89BD\u5668 F12 \u67E5\u770B\u8A73\u7D30\u932F\u8AA4`),this.productGrossMarginReport.set(null)}finally{this.isLoadingMarginData.set(!1)}}resetMarginFilter(){this.selectedMarginStartYear.set(2024),this.selectedMarginStartMonth.set(12),this.selectedMarginEndYear.set(2025),this.selectedMarginEndMonth.set(12),this.applyMarginFilter()}formatMonth(e){return`${parseInt(e.split("-")[1],10)}\u6708`}buildMonthRange(e,t,i,r){let o=Number(e),a=Number(t),u=Number(i),c=Number(r);if(!o||!a||!u||!c)return[];let p=[],g=o,y=a;for(;g<u||g===u&&y<=c;)p.push(`${g}-${String(y).padStart(2,"0")}`),y+=1,y>12&&(y=1,g+=1);return p}formatCurrency(e){return e==null?"NT$0":e.toLocaleString("zh-TW",{style:"currency",currency:"TWD",minimumFractionDigits:0})}createAllCharts(e){this.destroyCharts(),this.mainCategoryChart=this.createDonutChart(this.mainCategoryChartRef,e.main,"\u4E3B\u8981\u5206\u985E\u71DF\u6536\u4F54\u6BD4",this.colors.main),this.diningChart=this.createDonutChart(this.diningChartRef,e.dining,"\u9910\u98F2\u985E\u54C1\u9805\u4F54\u6BD4",this.colors.sub),this.drinksChart=this.createDonutChart(this.drinksChartRef,e.drinks,"\u9152\u6C34\u985E\u54C1\u9805\u4F54\u6BD4",this.colors.sub),this.chartInstances=[this.mainCategoryChart,this.diningChart,this.drinksChart].filter(t=>t)}createMonthlyTrendChartOnly(){console.log("\u{1F4CA} createMonthlyTrendChartOnly \u88AB\u8ABF\u7528");let e=this.monthlyTrendChartData();if(console.log("\u5716\u8868\u8CC7\u6599:",{labelsLength:e.labels?.length,datasetsLength:e.datasets?.length,labels:e.labels,datasets:e.datasets?.map(t=>({label:t.label,dataLength:t.data?.length,data:t.data}))}),!this.monthlyTrendChartRef){console.error("\u274C monthlyTrendChartRef \u4E0D\u5B58\u5728\uFF01");return}if(!this.monthlyTrendChartRef.nativeElement){console.error("\u274C monthlyTrendChartRef.nativeElement \u4E0D\u5B58\u5728\uFF01");return}if(console.log("\u2713 Canvas \u5143\u7D20\u5B58\u5728"),this.monthlyTrendChart){console.log("\u{1F5D1}\uFE0F \u92B7\u6BC0\u820A\u5716\u8868");try{this.monthlyTrendChart.destroy()}catch(t){console.warn("\u92B7\u6BC0\u5716\u8868\u6642\u51FA\u932F\uFF08\u53EF\u80FD\u5DF2\u88AB\u92B7\u6BC0\uFF09:",t)}this.monthlyTrendChart=null}e.labels.length>0?(console.log("\u{1F3A8} \u5275\u5EFA\u65B0\u5716\u8868\uFF0Clabels:",e.labels.length,"datasets:",e.datasets.length),this.monthlyTrendChart=this.createMonthlyTrendChart(this.monthlyTrendChartRef,e),this.monthlyTrendChart?console.log("\u2705 \u5716\u8868\u5275\u5EFA\u6210\u529F\uFF01",this.monthlyTrendChart):console.error("\u274C \u5716\u8868\u5275\u5EFA\u5931\u6557\uFF01createMonthlyTrendChart \u8FD4\u56DE null")):console.warn("\u26A0\uFE0F \u6C92\u6709\u5716\u8868\u8CC7\u6599\uFF08labels \u70BA\u7A7A\uFF09")}updateAllCharts(e){this.destroyCharts(),this.createAllCharts(e)}destroyCharts(){this.chartInstances.forEach(e=>e?.destroy()),this.chartInstances=[],this.monthlyTrendChart&&(this.monthlyTrendChart.destroy(),this.monthlyTrendChart=null)}createTooltipCallback(e){return t=>{let i=t.label||"",r=t.raw||0,o=e>0?(r/e*100).toFixed(2):0,a=new Intl.NumberFormat("zh-TW",{style:"currency",currency:"TWD",minimumFractionDigits:0}).format(r);return`${i}: ${a} (${o}%)`}}createDonutChart(e,t,i,r){if(!e||!e.nativeElement||t.length===0)return null;let o=e.nativeElement.getContext("2d");if(!o)return null;let a=t.reduce((u,c)=>u+c.value,0);return new Chart(o,{type:"doughnut",data:{labels:t.map(u=>u.name),datasets:[{data:t.map(u=>u.value),backgroundColor:r,hoverOffset:4}]},options:{responsive:!0,maintainAspectRatio:!1,plugins:{title:{display:!0,text:i,font:{size:16}},legend:{display:!0,position:"bottom",labels:{boxWidth:12,padding:15}},tooltip:{callbacks:{label:this.createTooltipCallback(a)}}}}})}createMonthlyTrendChart(e,t){if(!e||!e.nativeElement||t.datasets.length===0)return null;let i=e.nativeElement.getContext("2d");return i?new Chart(i,{type:"line",data:t,options:{responsive:!0,maintainAspectRatio:!1,scales:{y:{beginAtZero:!0,ticks:{callback:r=>this.formatCurrency(r)}}},plugins:{title:{display:!0,text:"\u6BCF\u6708\u54C1\u9805\u71DF\u6536\u8DA8\u52E2",font:{size:16}},legend:{display:!0,position:"bottom"},tooltip:{callbacks:{label:r=>`${r.dataset.label}: ${this.formatCurrency(r.raw)}`}}}}}):null}};Ga.\u0275fac=function(t){return new(t||Ga)},Ga.\u0275cmp=re({type:Ga,selectors:[["app-product-analysis"]],viewQuery:function(t,i){if(t&1&&(ut(YV,5),ut(JV,5),ut(KV,5),ut(QV,5)),t&2){let r;tt(r=nt())&&(i.mainCategoryChartRef=r.first),tt(r=nt())&&(i.diningChartRef=r.first),tt(r=nt())&&(i.drinksChartRef=r.first),tt(r=nt())&&(i.monthlyTrendChartRef=r.first)}},decls:16,vars:8,consts:[["monthlyTrendChart",""],[1,"space-y-8"],[1,"flex","flex-wrap","items-center","justify-between","gap-4"],[1,"text-3xl","font-bold","text-gray-900"],[1,"flex","flex-col","sm:flex-row","items-center","gap-2","bg-white","p-3","rounded-xl","shadow-md","border","border-gray-200"],[1,"bg-white","p-6","rounded-xl","shadow-md"],[1,"border-b","border-gray-200"],["aria-label","Tabs",1,"-mb-px","flex","space-x-6"],[1,"whitespace-nowrap","py-4","px-1","border-b-2","font-medium","text-sm",3,"click"],[1,"pt-6"],[1,"flex","items-center","gap-2"],[1,"text-sm","font-medium","text-gray-600"],[1,"border-gray-300","rounded-lg","shadow-sm","focus:ring-indigo-500","focus:border-indigo-500","text-sm","p-2","bg-gray-100",3,"ngModelChange","ngModel"],[3,"value"],[1,"flex","items-center","gap-2","mt-2","sm:mt-0"],[1,"bg-indigo-600","text-white","px-4","py-2","rounded-lg","font-medium","hover:bg-indigo-700","transition-colors","flex","items-center","gap-2","text-sm",3,"click"],["name","filter-outline"],["title","\u91CD\u8A2D\u7BE9\u9078",1,"text-gray-500","hover:text-gray-800","transition-colors","p-2","rounded-full","bg-gray-100","hover:bg-gray-200",3,"click"],["name","refresh-outline",1,"text-xl"],[1,"bg-white","p-6","rounded-xl","shadow-inner","border","mb-6"],[1,"text-lg","font-semibold","text-gray-800","mb-4"],[1,"overflow-x-auto"],[1,"flex","items-center","justify-center","h-32","bg-white","rounded-xl"],[1,"bg-red-50","border-l-4","border-red-500","p-4","rounded-lg","mb-4","space-y-3"],[1,"overflow-x-auto","border","rounded-lg",2,"max-width","100%"],[1,"bg-gray-50","border","border-gray-200","rounded-lg","p-8","text-center"],[1,"h-80"],[1,"flex","flex-col","items-center","space-y-2"],[1,"w-8","h-8","border-3","border-indigo-200","border-t-indigo-600","rounded-full","animate-spin"],[1,"text-sm","text-gray-500"],[1,"flex","items-start","gap-3"],["name","alert-circle-outline",1,"text-2xl","text-red-600","flex-shrink-0","mt-1"],[1,"flex-grow"],[1,"font-bold","text-red-900","text-lg"],[1,"mt-2","text-sm","text-red-800","whitespace-pre-wrap","leading-relaxed"],[1,"bg-red-100","p-3","rounded","text-sm","text-red-900","font-medium"],[1,"text-sm","text-left","border-collapse","bg-white",2,"min-width","100%","width","max-content"],[1,"text-xs","text-gray-700","uppercase","bg-gray-100","sticky","top-0","z-40"],["scope","col",1,"px-3","py-2","border","border-gray-300","font-semibold","sticky","left-0","bg-gray-100","z-50",2,"min-width","80px"],["scope","col",1,"px-3","py-2","border","border-gray-300","font-semibold","sticky","bg-gray-100","z-50",2,"left","80px","min-width","120px"],["scope","col","colspan","3",1,"px-2","py-2","border","border-gray-300","text-center","font-semibold","bg-gray-100",2,"min-width","200px"],[1,"px-3","py-2","border","border-gray-300","sticky","left-0","bg-gray-100","z-50"],[1,"px-3","py-2","border","border-gray-300","sticky","bg-gray-100","z-50",2,"left","80px"],[3,"class"],["scope","col",1,"px-2","py-1","border","border-gray-300","text-center","text-xs","bg-gray-100",2,"min-width","60px"],["scope","col",1,"px-2","py-1","border","border-gray-300","text-center","text-xs","bg-gray-100",2,"min-width","70px"],[1,"px-3","py-2","border","border-gray-300","font-semibold","sticky","left-0","z-20",3,"bg-yellow-50","bg-red-100","bg-white"],[1,"px-3","py-2","border","border-gray-300","sticky","left-0","bg-white","z-20"],[1,"px-3","py-2","border","border-gray-300","sticky","z-20",2,"left","80px"],[1,"px-3","py-2","border","border-gray-300","font-semibold","sticky","left-0","z-20"],[1,"px-2","py-2","border","border-gray-300","text-right","text-xs",2,"white-space","nowrap"],[1,"text-gray-500","mb-2"],[1,"text-sm","text-gray-400"],[1,"w-full","text-sm","text-left","whitespace-nowrap"],[1,"text-xs","text-gray-700","uppercase","bg-gray-50"],[1,"text-center"],[1,"py-3","px-4","text-left"],[1,"py-3","px-4"],[1,"border-b","text-right"],[1,"py-3","px-4","font-semibold","text-gray-800","text-left"],[1,"text-gray-400"],[1,"font-bold"],[1,"border-b","text-right","font-medium"],[1,"border-b","text-right","font-medium","bg-gray-50"],[1,"border-b","text-right","hover:bg-gray-50"],[1,"py-2","px-4","text-gray-500","text-left"],[1,"font-semibold"],["colspan","6",1,"text-center","py-8","text-gray-500"]],template:function(t,i){t&1&&(l(0,"div",1)(1,"div",2)(2,"h1",3),d(3,"\u5546\u54C1\u5206\u6790"),s(),M(4,i9,26,4,"div",4),M(5,l9,26,4,"div",4),s(),l(6,"div",5)(7,"div",6)(8,"nav",7)(9,"button",8),b("click",function(){return i.changeView("analysis")}),d(10," \u5546\u54C1\u5206\u6790 "),s(),l(11,"button",8),b("click",function(){return i.changeView("margin")}),d(12," \u5546\u54C1\u6BDB\u5229 "),s()()(),l(13,"div",9),M(14,C9,10,5,"div",1),M(15,T9,4,4),s()()()),t&2&&(m(4),A(i.activeView()==="analysis"?4:-1),m(),A(i.activeView()==="margin"?5:-1),m(4),Te(i.activeView()==="analysis"?"border-indigo-500 text-indigo-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"),m(2),Te(i.activeView()==="margin"?"border-indigo-500 text-indigo-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"),m(3),A(i.activeView()==="analysis"?14:-1),m(),A(i.activeView()==="margin"?15:-1))},dependencies:[se,De,He,Ge,Oe,fe,Ie],encapsulation:2,changeDetection:0});var dp=Ga;var I9=(n,e)=>e.entry_id,gS=(n,e)=>e.shipment_id;function M9(n,e){n&1&&(l(0,"div",2),x(1,"ion-icon",11),l(2,"span",12),d(3,"\u6B63\u5728\u52A0\u8F09\u6578\u64DA..."),s()())}function A9(n,e){if(n&1&&(l(0,"div",3),x(1,"ion-icon",13),l(2,"span",14),d(3),s()()),n&2){let t=_();m(3),w(t.errorMessage())}}function R9(n,e){if(n&1&&(l(0,"option",26),d(1),s()),n&2){let t=e.$implicit;I("value",t),m(),w(t)}}function N9(n,e){if(n&1&&(l(0,"option",26),d(1),s()),n&2){let t=e.$implicit;I("value",t),m(),w(t)}}function F9(n,e){if(n&1&&(l(0,"option",26),d(1),s()),n&2){let t=e.$implicit;I("value",t),m(),w(t)}}function P9(n,e){n&1&&(x(0,"ion-icon",48),l(1,"span"),d(2,"\u5957\u7528\u4E2D..."),s())}function k9(n,e){n&1&&(x(0,"ion-icon",49),l(1,"span"),d(2,"\u5957\u7528"),s())}function V9(n,e){if(n&1){let t=B();l(0,"tr",50),b("click",function(){let r=E(t).$implicit,o=_(2);return S(o.openEditModal(r))}),l(1,"td",51),x(2,"input",52),s(),l(3,"td",53),d(4),s(),l(5,"td",53),d(6),s(),l(7,"td",53),d(8),s(),l(9,"td",54),d(10),s(),l(11,"td",53),d(12),s(),l(13,"td",53),d(14),s(),l(15,"td",53),d(16),s(),l(17,"td",55),d(18),s()()}if(n&2){let t=e.$implicit,i=_(2);j("bg-red-50",!t.is_sigh_off),m(2),I("checked",t.is_sigh_off),m(2),w((t.entry_date==null?null:t.entry_date.substring(0,10))||t.entry_date),m(2),w(t.item_group),m(2),w(t.subject_name),m(2),w(i.formatCurrency(t.amount)),m(2),w(t.invoice_no),m(2),w(t.vendor_tax_id),m(2),w(t.vendor_name),m(2),w(t.description)}}function L9(n,e){n&1&&(l(0,"tr")(1,"td",56),d(2,"\u7121\u7B26\u5408\u689D\u4EF6\u7684\u6D41\u6C34\u5E33\u8CC7\u6599\u3002"),s()())}function O9(n,e){if(n&1){let t=B();l(0,"div",9)(1,"div",15)(2,"div",16)(3,"label",17),d(4,"\u5F9E:"),s(),l(5,"div",18)(6,"input",19),K("ngModelChange",function(r){E(t);let o=_();return Q(o.startDate,r)||(o.startDate=r),S(r)}),s(),l(7,"div",20),x(8,"ion-icon",21),s()()(),l(9,"div",16)(10,"label",22),d(11,"\u81F3:"),s(),l(12,"div",18)(13,"input",23),K("ngModelChange",function(r){E(t);let o=_();return Q(o.endDate,r)||(o.endDate=r),S(r)}),s(),l(14,"div",20),x(15,"ion-icon",21),s()()(),l(16,"div")(17,"select",24),K("ngModelChange",function(r){E(t);let o=_();return Q(o.selectedItem,r)||(o.selectedItem=r),S(r)}),l(18,"option",25),d(19,"\u6240\u6709\u9805\u76EE"),s(),V(20,R9,2,2,"option",26,Y),s()(),l(22,"div")(23,"select",27),K("ngModelChange",function(r){E(t);let o=_();return Q(o.selectedCategory,r)||(o.selectedCategory=r),S(r)}),l(24,"option",25),d(25,"\u6240\u6709\u79D1\u76EE"),s(),V(26,N9,2,2,"option",26,Y),s()(),l(28,"div",28)(29,"select",24),K("ngModelChange",function(r){E(t);let o=_();return Q(o.selectedVendor,r)||(o.selectedVendor=r),S(r)}),l(30,"option",25),d(31,"\u6240\u6709\u8CE3\u65B9"),s(),V(32,F9,2,2,"option",26,Y),s()(),l(34,"div")(35,"input",29),K("ngModelChange",function(r){E(t);let o=_();return Q(o.entryIdFilter,r)||(o.entryIdFilter=r),S(r)}),s()(),l(36,"div")(37,"input",30),K("ngModelChange",function(r){E(t);let o=_();return Q(o.descriptionFilter,r)||(o.descriptionFilter=r),S(r)}),s()(),l(38,"div",31)(39,"button",32),b("click",function(){E(t);let r=_();return S(r.applyFilters())}),M(40,P9,3,0)(41,k9,3,0),s(),l(42,"button",33),b("click",function(){E(t);let r=_();return S(r.resetFilters())}),x(43,"ion-icon",34),s()()(),l(44,"div",35)(45,"table",36)(46,"thead",37)(47,"tr")(48,"th",38)(49,"div",39)(50,"input",40),b("change",function(r){E(t);let o=_();return S(o.toggleAllApprovals(r))}),s(),l(51,"span"),d(52,"\u7C3D\u6838"),s()()(),l(53,"th",41),b("click",function(){E(t);let r=_();return S(r.sortData("entry_date"))}),d(54,"\u65E5\u671F "),x(55,"ion-icon",42),s(),l(56,"th",41),b("click",function(){E(t);let r=_();return S(r.sortData("item_group"))}),d(57,"\u9805\u76EE "),x(58,"ion-icon",42),s(),l(59,"th",41),b("click",function(){E(t);let r=_();return S(r.sortData("subject_name"))}),d(60,"\u79D1\u76EE "),x(61,"ion-icon",42),s(),l(62,"th",43),b("click",function(){E(t);let r=_();return S(r.sortData("amount"))}),d(63,"\u91D1\u984D "),x(64,"ion-icon",42),s(),l(65,"th",41),b("click",function(){E(t);let r=_();return S(r.sortData("invoice_no"))}),d(66,"\u767C\u7968\u865F\u78BC "),x(67,"ion-icon",42),s(),l(68,"th",41),b("click",function(){E(t);let r=_();return S(r.sortData("vendor_tax_id"))}),d(69,"\u8CE3\u65B9\u7D71\u7DE8 "),x(70,"ion-icon",42),s(),l(71,"th",41),b("click",function(){E(t);let r=_();return S(r.sortData("vendor_name"))}),d(72,"\u8CE3\u65B9\u540D\u7A31 "),x(73,"ion-icon",42),s(),l(74,"th",38),d(75,"\u8AAA\u660E"),s()()(),l(76,"tbody"),V(77,V9,19,11,"tr",44,I9,!1,L9,3,0,"tr"),s()()(),l(80,"div",45)(81,"div",46),d(82),s(),l(83,"div",16)(84,"button",47),b("click",function(){E(t);let r=_();return S(r.goToPrevPage())}),d(85," \u4E0A\u4E00\u9801 "),s(),l(86,"button",47),b("click",function(){E(t);let r=_();return S(r.goToNextPage())}),d(87," \u4E0B\u4E00\u9801 "),s()()()()}if(n&2){let t=_();m(6),J("ngModel",t.startDate),m(7),J("ngModel",t.endDate),m(4),J("ngModel",t.selectedItem),m(3),L(t.modalAvailableItems()),m(3),J("ngModel",t.selectedCategory),I("disabled",!t.selectedItem()),m(3),L(t.filterAvailableCategories()),m(3),J("ngModel",t.selectedVendor),m(3),L(t.filterOptions().vendorNames),m(3),J("ngModel",t.entryIdFilter),m(2),J("ngModel",t.descriptionFilter),m(2),I("disabled",t.isLoading()),m(),A(t.isLoading()?40:41),m(10),I("checked",t.areAllApproved()),m(27),L(t.pagedTransactions()),m(5),Lt(" \u7B2C ",t.currentPage()," / ",t.totalPages()," \u9801\uFF0C\u5171 ",t.totalRecords()," \u7B46 "),m(2),I("disabled",t.currentPage()===1),m(2),I("disabled",t.currentPage()===t.totalPages())}}function B9(n,e){if(n&1&&(l(0,"option",26),d(1),s()),n&2){let t=e.$implicit;I("value",t),m(),w(t)}}function U9(n,e){if(n&1&&(l(0,"option",26),d(1),s()),n&2){let t=e.$implicit;I("value",t),m(),w(t)}}function $9(n,e){if(n&1){let t=B();l(0,"form",59),b("ngSubmit",function(){E(t);let r=_(2);return S(r.handleFormSubmit())}),l(1,"div",60)(2,"div")(3,"label",61),d(4,"\u65E5\u671F*"),s(),l(5,"div",62),x(6,"input",63),l(7,"div",20),x(8,"ion-icon",21),s()()(),l(9,"div")(10,"label",64),d(11,"\u9805\u76EE*"),s(),l(12,"select",65)(13,"option",66),d(14,"\u8ACB\u9078\u64C7\u9805\u76EE"),s(),V(15,B9,2,2,"option",26,Y),s()(),l(17,"div")(18,"label",67),d(19,"\u79D1\u76EE*"),s(),l(20,"select",68)(21,"option",66),d(22,"\u8ACB\u9078\u64C7\u79D1\u76EE"),s(),V(23,U9,2,2,"option",26,Y),s()(),l(25,"div")(26,"label",69),d(27,"\u91D1\u984D*"),s(),x(28,"input",70),s(),l(29,"div")(30,"label",71),d(31,"\u767C\u7968\u865F\u78BC"),s(),x(32,"input",72),s(),l(33,"div")(34,"label",73),d(35,"\u8CE3\u65B9\u7D71\u7DE8"),s(),l(36,"input",74),b("input",function(r){E(t);let o=_(2);return S(o.onVendorTaxIdInput(r))}),s()(),l(37,"div",75)(38,"label",76),d(39,"\u8CE3\u65B9\u540D\u7A31"),s(),x(40,"input",77),s(),l(41,"div",75)(42,"label",78),d(43,"\u8AAA\u660E"),s(),x(44,"textarea",79),s()(),l(45,"div",80)(46,"button",81),b("click",function(){E(t);let r=_(2);return S(r.resetForm())}),d(47,"\u53D6\u6D88"),s(),l(48,"button",82),d(49,"\u9001\u51FA"),s()()()}if(n&2){let t=_(2);I("formGroup",t.ledgerForm),m(6),j("border-red-500",t.isInvalid("entry_date")),m(6),j("border-red-500",t.isInvalid("item_group")),m(3),L(t.filterOptions().items),m(5),j("border-red-500",t.isInvalid("subject_name")),m(3),L(t.availableCategories()),m(5),j("border-red-500",t.isInvalid("amount"))}}function H9(n,e){if(n&1&&(l(0,"div",89),x(1,"ion-icon",97),l(2,"span"),d(3),s()()),n&2){let t=_(3);m(3),w(t.saveSuccessMessage())}}function G9(n,e){n&1&&(l(0,"div",90),x(1,"ion-icon",98),l(2,"span"),d(3,"\u8F09\u5165\u4E2D..."),s()())}function q9(n,e){if(n&1&&(l(0,"div",93)(1,"div",16),x(2,"ion-icon",99),l(3,"span"),d(4),s()()()),n&2){let t=_(3);m(4),w(t.shipmentItemsError())}}function W9(n,e){n&1&&(l(0,"div",94),d(1,"\u6B64\u6D41\u6C34\u5E33\u5C1A\u672A\u95DC\u806F\u9032\u8CA8\u8CC7\u6599\u3002"),s())}function j9(n,e){n&1&&d(0," \u5132\u5B58\u4E2D... ")}function z9(n,e){n&1&&d(0," \u5132\u5B58\u9032\u8CA8\u8CC7\u6599 ")}function Y9(n,e){if(n&1){let t=B();l(0,"div")(1,"div",101)(2,"div")(3,"label",102),d(4,"\u54C1\u9805\u540D\u7A31"),s(),l(5,"input",103),K("ngModelChange",function(r){let o=E(t).$implicit;return Q(o.itemName,r)||(o.itemName=r),S(r)}),s()(),l(6,"div")(7,"label",102),d(8,"\u6578\u91CF"),s(),l(9,"input",104),K("ngModelChange",function(r){let o=E(t).$implicit;return Q(o.qty,r)||(o.qty=r),S(r)}),s()(),l(10,"div")(11,"label",102),d(12,"\u55AE\u4F4D"),s(),l(13,"input",103),K("ngModelChange",function(r){let o=E(t).$implicit;return Q(o.unit,r)||(o.unit=r),S(r)}),s()(),l(14,"div")(15,"label",102),d(16,"\u55AE\u50F9"),s(),l(17,"input",104),K("ngModelChange",function(r){let o=E(t).$implicit;return Q(o.unitPrice,r)||(o.unitPrice=r),S(r)}),s()(),l(18,"div")(19,"label",102),d(20,"\u5C0F\u8A08"),s(),x(21,"input",105),s(),l(22,"div",75)(23,"label",102),d(24,"\u5099\u8A3B"),s(),l(25,"textarea",106),K("ngModelChange",function(r){let o=E(t).$implicit;return Q(o.remark,r)||(o.remark=r),S(r)}),s()()(),l(26,"div",107)(27,"button",108),b("click",function(){let r=E(t).$implicit,o=_(4);return S(o.deleteShipmentItem(r))}),x(28,"ion-icon",109),l(29,"span"),d(30,"\u522A\u9664"),s()(),l(31,"button",110),b("click",function(){let r=E(t).$implicit,o=_(4);return S(o.saveShipmentItem(r))}),M(32,j9,1,0)(33,z9,1,0),s()()()}if(n&2){let t=e.$implicit,i=_(4);Te("border rounded-lg p-4 "+(i.newShipmentItemIds().includes(t.shipment_id)?"bg-yellow-50":"bg-gray-50")),m(5),I("name",On("shipmentItemName",t.shipment_id)),J("ngModel",t.itemName),m(4),I("name",On("shipmentQty",t.shipment_id)),J("ngModel",t.qty),m(4),I("name",On("shipmentUnit",t.shipment_id)),J("ngModel",t.unit),m(4),I("name",On("shipmentUnitPrice",t.shipment_id)),J("ngModel",t.unitPrice),m(4),I("value",t.lineAmount??"-"),m(4),I("name",On("shipmentRemark",t.shipment_id)),J("ngModel",t.remark),m(6),I("disabled",i.isSavingShipmentItem(t.shipment_id)),m(),A(i.isSavingShipmentItem(t.shipment_id)?32:33)}}function J9(n,e){if(n&1&&(l(0,"div",9),V(1,Y9,34,20,"div",100,gS),s()),n&2){let t=_(3);m(),L(t.shipmentItems())}}function K9(n,e){if(n&1){let t=B();l(0,"div",58)(1,"div",83),x(2,"ion-icon",84),l(3,"span",12),d(4,"\u6D41\u6C34\u5E33\u5DF2\u6210\u529F\u65B0\u589E\uFF01\u60A8\u73FE\u5728\u53EF\u4EE5\u95DC\u806F\u9032\u8CA8\u8CC7\u6599\u3002"),s()(),l(5,"div",85)(6,"div",86)(7,"div",87)(8,"h4",88),d(9),s(),M(10,H9,4,1,"div",89),s(),l(11,"div",16),M(12,G9,4,0,"div",90),l(13,"button",91),b("click",function(){E(t);let r=_(2);return S(r.addNewShipmentItem())}),x(14,"ion-icon",92),l(15,"span"),d(16,"\u65B0\u589E\u9032\u8CA8\u55AE"),s()()()(),M(17,q9,5,1,"div",93),M(18,W9,2,0,"div",94),M(19,J9,3,0,"div",9),l(20,"div",95)(21,"button",81),b("click",function(){E(t);let r=_(2);return S(r.resetAddView())}),d(22,"\u8FD4\u56DE\u65B0\u589E\u8868\u55AE"),s(),l(23,"button",96),b("click",function(){E(t);let r=_(2);return S(r.changeView("details"))}),d(24,"\u5B8C\u6210"),s()()()()}if(n&2){let t,i=_(2);m(9),N("\u95DC\u806F\u9032\u8CA8\u8CC7\u6599\uFF1A",i.shipmentItems().length,"\u7B46"),m(),A(i.saveSuccessMessage()?10:-1),m(2),A(i.isLoadingShipmentItems()?12:-1),m(),I("disabled",i.isLoadingShipmentItems()||!((t=i.newlyCreatedEntry())!=null&&t.entry_id)),m(4),A(i.shipmentItemsError()?17:-1),m(),A(!i.isLoadingShipmentItems()&&i.shipmentItems().length===0?18:-1),m(),A(i.shipmentItems().length>0?19:-1)}}function Q9(n,e){if(n&1&&M(0,$9,50,9,"form",57)(1,K9,25,7,"div",58),n&2){let t=_();A(t.newlyCreatedEntry()?1:0)}}function Z9(n,e){if(n&1&&(l(0,"option",26),d(1),s()),n&2){let t=e.$implicit;I("value",t),m(),w(t)}}function X9(n,e){if(n&1&&(l(0,"option",26),d(1),s()),n&2){let t=e.$implicit;I("value",t),m(),w(t)}}function eL(n,e){if(n&1&&(l(0,"p",130),d(1),s()),n&2){let t=_(2);m(),w(t.getErrorMessage("vendor_tax_id"))}}function tL(n,e){if(n&1&&(l(0,"div",147)(1,"p",151)(2,"strong"),d(3,"\u6CE8\u610F\uFF1A"),s(),d(4,"\u6B64\u6D41\u6C34\u5E33\u5DF2\u95DC\u806F "),l(5,"strong"),d(6),s(),d(7," \u7B46\u9032\u8CA8\u55AE\u9805\u76EE\uFF0C\u522A\u9664\u6B64\u6D41\u6C34\u5E33\u6642\u5C07\u4E00\u4F75\u522A\u9664\u9019\u4E9B\u9032\u8CA8\u55AE\u9805\u76EE\u3002 "),s()()),n&2){let t=_(3);m(6),w(t.ledgerDeleteConfirmation().relatedShipmentCount)}}function nL(n,e){if(n&1){let t=B();l(0,"div",140)(1,"div",142)(2,"div",143),x(3,"ion-icon",144),l(4,"h3",88),d(5,"\u78BA\u8A8D\u522A\u9664\u6D41\u6C34\u5E33"),s()(),l(6,"div",145)(7,"p",146),d(8,"\u60A8\u78BA\u5B9A\u8981\u522A\u9664\u6B64\u6D41\u6C34\u5E33\u8A18\u9304\u55CE\uFF1F\u6B64\u64CD\u4F5C\u7121\u6CD5\u5FA9\u539F\u3002"),s(),M(9,tL,8,1,"div",147),s(),l(10,"div",148)(11,"button",149),b("click",function(){E(t);let r=_(2);return S(r.cancelDeleteLedgerEntry())}),d(12,"\u53D6\u6D88"),s(),l(13,"button",150),b("click",function(){E(t);let r=_(2);return S(r.confirmDeleteLedgerEntry())}),d(14,"\u78BA\u8A8D\u522A\u9664"),s()()()()}if(n&2){let t=_(2);m(9),A(t.ledgerDeleteConfirmation().relatedShipmentCount>0?9:-1)}}function iL(n,e){if(n&1&&(l(0,"div",89),x(1,"ion-icon",97),l(2,"span"),d(3),s()()),n&2){let t=_(2);m(3),w(t.saveSuccessMessage())}}function rL(n,e){n&1&&(l(0,"div",90),x(1,"ion-icon",98),l(2,"span"),d(3,"\u8F09\u5165\u4E2D..."),s()())}function oL(n,e){if(n&1&&(l(0,"div",93)(1,"div",16),x(2,"ion-icon",99),l(3,"span"),d(4),s()()()),n&2){let t=_(2);m(4),w(t.shipmentItemsError())}}function aL(n,e){n&1&&(l(0,"div",94),d(1,"\u6B64\u6D41\u6C34\u5E33\u5C1A\u672A\u95DC\u806F\u9032\u8CA8\u8CC7\u6599\u3002"),s())}function sL(n,e){n&1&&d(0," \u5132\u5B58\u4E2D... ")}function lL(n,e){n&1&&d(0," \u5132\u5B58\u9032\u8CA8\u8CC7\u6599 ")}function uL(n,e){if(n&1){let t=B();l(0,"div")(1,"div",101)(2,"div")(3,"label",102),d(4,"\u54C1\u9805\u540D\u7A31"),s(),l(5,"input",103),K("ngModelChange",function(r){let o=E(t).$implicit;return Q(o.itemName,r)||(o.itemName=r),S(r)}),s()(),l(6,"div")(7,"label",102),d(8,"\u6578\u91CF"),s(),l(9,"input",104),K("ngModelChange",function(r){let o=E(t).$implicit;return Q(o.qty,r)||(o.qty=r),S(r)}),s()(),l(10,"div")(11,"label",102),d(12,"\u55AE\u4F4D"),s(),l(13,"input",103),K("ngModelChange",function(r){let o=E(t).$implicit;return Q(o.unit,r)||(o.unit=r),S(r)}),s()(),l(14,"div")(15,"label",102),d(16,"\u55AE\u50F9"),s(),l(17,"input",104),K("ngModelChange",function(r){let o=E(t).$implicit;return Q(o.unitPrice,r)||(o.unitPrice=r),S(r)}),s()(),l(18,"div")(19,"label",102),d(20,"\u5C0F\u8A08"),s(),x(21,"input",105),s(),l(22,"div",75)(23,"label",102),d(24,"\u5099\u8A3B"),s(),l(25,"textarea",106),K("ngModelChange",function(r){let o=E(t).$implicit;return Q(o.remark,r)||(o.remark=r),S(r)}),s()()(),l(26,"div",107)(27,"button",108),b("click",function(){let r=E(t).$implicit,o=_(3);return S(o.deleteShipmentItem(r))}),x(28,"ion-icon",109),l(29,"span"),d(30,"\u522A\u9664"),s()(),l(31,"button",110),b("click",function(){let r=E(t).$implicit,o=_(3);return S(o.saveShipmentItem(r))}),M(32,sL,1,0)(33,lL,1,0),s()()()}if(n&2){let t=e.$implicit,i=_(3);Te("border rounded-lg p-4 "+(i.newShipmentItemIds().includes(t.shipment_id)?"bg-yellow-50":"bg-gray-50")),m(5),I("name",On("shipmentItemName",t.shipment_id)),J("ngModel",t.itemName),m(4),I("name",On("shipmentQty",t.shipment_id)),J("ngModel",t.qty),m(4),I("name",On("shipmentUnit",t.shipment_id)),J("ngModel",t.unit),m(4),I("name",On("shipmentUnitPrice",t.shipment_id)),J("ngModel",t.unitPrice),m(4),I("value",t.lineAmount??"-"),m(4),I("name",On("shipmentRemark",t.shipment_id)),J("ngModel",t.remark),m(6),I("disabled",i.isSavingShipmentItem(t.shipment_id)),m(),A(i.isSavingShipmentItem(t.shipment_id)?32:33)}}function dL(n,e){if(n&1&&(l(0,"div",9),V(1,uL,34,20,"div",100,gS),s()),n&2){let t=_(2);m(),L(t.shipmentItems())}}function cL(n,e){if(n&1){let t=B();l(0,"div",10)(1,"div",111)(2,"div",112)(3,"h3",113),d(4),s(),l(5,"button",114),b("click",function(){E(t);let r=_();return S(r.closeModal())}),x(6,"ion-icon",115),s()(),l(7,"div",116)(8,"form",117),b("ngSubmit",function(){E(t);let r=_();return S(r.handleFormSubmit())}),l(9,"div",60)(10,"div")(11,"label",118),d(12,"\u65E5\u671F*"),s(),l(13,"div",62),x(14,"input",119),l(15,"div",20),x(16,"ion-icon",21),s()()(),l(17,"div")(18,"label",120),d(19,"\u9805\u76EE*"),s(),l(20,"select",121),V(21,Z9,2,2,"option",26,Y),s()(),l(23,"div")(24,"label",122),d(25,"\u79D1\u76EE*"),s(),l(26,"select",123)(27,"option",25),d(28,"\u8ACB\u9078\u64C7\u79D1\u76EE"),s(),V(29,X9,2,2,"option",26,Y),s()(),l(31,"div")(32,"label",124),d(33,"\u91D1\u984D*"),s(),x(34,"input",125),s(),l(35,"div")(36,"label",126),d(37,"\u767C\u7968\u865F\u78BC"),s(),x(38,"input",127),s(),l(39,"div")(40,"label",128),d(41,"\u8CE3\u65B9\u7D71\u7DE8"),s(),l(42,"input",129),b("input",function(r){E(t);let o=_();return S(o.onVendorTaxIdInput(r))}),s(),M(43,eL,2,1,"p",130),s(),l(44,"div",75)(45,"label",131),d(46,"\u8CE3\u65B9\u540D\u7A31"),s(),x(47,"input",132),s(),l(48,"div",75)(49,"label",133),d(50,"\u8AAA\u660E"),s(),x(51,"textarea",134),s(),l(52,"div",75)(53,"label",135),x(54,"input",136),l(55,"span",137),d(56,"\u5DF2\u7C3D\u6838"),s()()()(),l(57,"div",138)(58,"button",139),b("click",function(){E(t);let r=_();return S(r.deleteLedgerEntry())}),d(59,"\u522A\u9664"),s(),l(60,"button",81),b("click",function(){E(t);let r=_();return S(r.closeModal())}),d(61,"\u53D6\u6D88"),s(),l(62,"button",82),d(63,"\u4FEE\u6539"),s()()(),M(64,nL,15,1,"div",140),l(65,"div",141)(66,"div",86)(67,"div",87)(68,"h4",88),d(69),s(),M(70,iL,4,1,"div",89),s(),l(71,"div",16),M(72,rL,4,0,"div",90),l(73,"button",91),b("click",function(){E(t);let r=_();return S(r.addNewShipmentItem())}),x(74,"ion-icon",92),l(75,"span"),d(76,"\u65B0\u589E\u9032\u8CA8\u55AE"),s()()()(),M(77,oL,5,1,"div",93),M(78,aL,2,0,"div",94),M(79,dL,3,0,"div",9),s()()()()}if(n&2){let t,i,r=_();m(4),N("\u4FEE\u6539\u6D41\u6C34\u5E33 ID\uFF1A",(t=r.editingTransaction())==null?null:t.entry_id),m(4),I("formGroup",r.ledgerForm),m(6),j("border-red-500",r.isInvalid("entry_date")),m(6),j("border-red-500",r.isInvalid("item_group")),m(),L(r.modalAvailableItems()),m(5),j("border-red-500",r.isInvalid("subject_name")),m(3),L(r.availableCategories()),m(5),j("border-red-500",r.isInvalid("amount")),m(8),j("border-red-500",r.isInvalid("vendor_tax_id")),m(),A(r.isInvalid("vendor_tax_id")?43:-1),m(21),A(r.ledgerDeleteConfirmation()?64:-1),m(5),N("\u95DC\u806F\u9032\u8CA8\u8CC7\u6599\uFF1A",r.shipmentItems().length,"\u7B46"),m(),A(r.saveSuccessMessage()?70:-1),m(2),A(r.isLoadingShipmentItems()?72:-1),m(),I("disabled",r.isLoadingShipmentItems()||!((i=r.editingTransaction())!=null&&i.entry_id)),m(4),A(r.shipmentItemsError()?77:-1),m(),A(!r.isLoadingShipmentItems()&&r.shipmentItems().length===0?78:-1),m(),A(r.shipmentItems().length>0?79:-1)}}function mL(n,e){if(n&1){let t=B();l(0,"div",10)(1,"div",152)(2,"div",153)(3,"div",154),x(4,"ion-icon",155),s(),l(5,"h3",156),d(6,"\u8ACB\u78BA\u8A8D"),s(),l(7,"p",157),d(8),s()(),l(9,"div",158)(10,"button",159),b("click",function(){E(t);let r=_();return S(r.cancelApproval())}),d(11,"\u53D6\u6D88"),s(),l(12,"button",160),b("click",function(){E(t);let r=_();return S(r.confirmApproval())}),d(13,"\u78BA\u8A8D"),s()()()()}n&2&&(m(8),w(e.message))}function pL(n,e){if(n&1){let t=B();l(0,"div",10)(1,"div",152)(2,"div",153)(3,"div",161),x(4,"ion-icon",162),s(),l(5,"h3",156),d(6,"\u78BA\u8A8D\u522A\u9664"),s(),l(7,"p",157),d(8),s(),l(9,"p",163),d(10,"\u6B64\u64CD\u4F5C\u7121\u6CD5\u5FA9\u539F\u3002"),s()(),l(11,"div",158)(12,"button",159),b("click",function(){E(t);let r=_();return S(r.cancelDeleteShipmentItem())}),d(13,"\u53D6\u6D88"),s(),l(14,"button",164),b("click",function(){E(t);let r=_();return S(r.confirmDeleteShipmentItem())}),d(15,"\u78BA\u8A8D\u522A\u9664"),s()()()()}n&2&&(m(8),N("\u60A8\u78BA\u5B9A\u8981\u522A\u9664\u9032\u8CA8\u55AE\u9805\u76EE\u300C",e.itemName,"\u300D\u55CE\uFF1F"))}var qa=class qa{constructor(){this.apiService=k(we);this.fb=k(qe);this.activeView=D("details");this.allTransactions=D([]);this.displayedTransactions=D([]);this.pagination=D({total:0,totalPages:1,page:1,limit:20});this.filterOptions=D({items:[],categories:[],vendorNames:[]});this.editingTransaction=D(null);this.newlyCreatedEntry=D(null);this.isModalOpen=D(!1);this.isLoading=D(!1);this.errorMessage=D(null);this.confirmationState=D(null);this.shipmentItems=D([]);this.isLoadingShipmentItems=D(!1);this.shipmentItemsError=D(null);this.savingShipmentItemIds=D([]);this.deleteConfirmation=D(null);this.newShipmentItemIds=D([]);this.saveSuccessMessage=D(null);this.ledgerDeleteConfirmation=D(null);this.isCheckingShipment=D(!1);this.today=new Date;this.firstDayOfMonth=new Date(this.today.getFullYear(),this.today.getMonth(),1);this.lastDayOfMonth=new Date(this.today.getFullYear(),this.today.getMonth()+1,0);this.startDate=D(this.formatDate(this.firstDayOfMonth));this.endDate=D(this.formatDate(this.lastDayOfMonth));this.selectedItem=D("");this.selectedCategory=D("");this.selectedVendor=D("");this.descriptionFilter=D("");this.entryIdFilter=D("");this.appliedItem=D("");this.appliedCategory=D("");this.appliedVendor=D("");this.appliedDescriptionFilter=D("");this.appliedEntryIdFilter=D("");this.pageSize=20;this.currentPage=D(1);this.sortColumn=D("entry_date");this.sortDirection=D("desc");this.submitted=D(!1);this.formItemGroup=D(null);this.ledgerForm=this.fb.group({entry_id:[""],entry_date:["",U.required],item_group:["",U.required],subject_name:["",U.required],amount:["",U.required],invoice_no:[""],vendor_tax_id:["",[U.pattern(/^\d{0,8}$/)]],vendor_id:[null],vendor_name:[""],description:[""],is_sigh_off:[!1],gl_account_id:[null]});this.glAccounts=D([]);this.isLoadingGLAccounts=D(!1);this.glAccountsError=D(null);this.glAccountsHierarchy=$(()=>{let e=this.glAccounts(),t={};return e.forEach(i=>{let r=i.parent_account_id!==null&&i.parent_account_id!==void 0?i.parent_account_id.toString():"null";t[r]||(t[r]=[]),t[r].push(i)}),t});this.topLevelAccounts=$(()=>(this.glAccountsHierarchy().null||[]).sort((t,i)=>t.gl_account_id-i.gl_account_id));this.selectedItemSubAccounts=$(()=>{let e=this.ledgerForm.get("item_group")?.value,t=this.glAccounts();if(!e||t.length===0)return[];let i=t.find(r=>r.account_name===e&&r.parent_account_id===null);return i?t.filter(r=>r.parent_account_id===i.gl_account_id).sort((r,o)=>r.gl_account_id-o.gl_account_id):[]});this.itemCategoryMap={\u8CC7\u7522:["\u73FE\u91D1","\u9280\u884C\u5B58\u6B3E","\u61C9\u6536\u5E33\u6B3E","\u5B58\u8CA8"],\u8CA0\u50B5:["\u61C9\u4ED8\u5E33\u6B3E","\u61C9\u4ED8\u85AA\u8CC7","\u61C9\u4ED8\u7A05\u6B3E"],\u696D\u4E3B\u6B0A\u76CA:["\u8CC7\u672C","\u4FDD\u7559\u76C8\u9918"],\u71DF\u696D\u6536\u5165:["\u92B7\u8CA8\u6536\u5165","\u5176\u4ED6\u6536\u5165"],\u71DF\u696D\u8CBB\u7528:["\u4EBA\u4E8B\u8CBB\u7528","\u9032\u8CA8\u6210\u672C","\u5176\u4ED6\u8CBB\u7528"]};this.availableCategories=$(()=>{let e=this.formItemGroup();if(!e)return[];let t=this.glAccounts();if(t.length>0){let a=t.find(u=>u.account_name===e&&u.parent_account_id===null);if(a){let u=t.filter(c=>c.parent_account_id===a.gl_account_id).map(c=>c.account_name).filter(Boolean).sort();if(u.length>0)return u}}let r=this.allTransactions().filter(a=>a.item_group===e).map(a=>a.subject_name).filter(Boolean),o=[...new Set(r)].sort();if(o.length===0){let a=this.itemCategoryMap[e];if(a&&a.length>0)return a}return o});this.filterAvailableCategories=$(()=>{let e=this.selectedItem();if(this.glAccounts().length>0){let r=this.glAccounts(),o=r.find(a=>a.account_name===e&&a.parent_account_id===null);if(o){let a=r.filter(u=>u.parent_account_id===o.gl_account_id).map(u=>u.account_name).filter(Boolean).sort();if(a.length>0)return a}}if(!e)return[];let i=this.allTransactions().filter(r=>r.item_group===e).map(r=>r.subject_name).filter(Boolean);return[...new Set(i)].sort()});this.modalAvailableItems=$(()=>this.glAccounts().length>0?this.topLevelAccounts().map(e=>e.account_name).filter(Boolean).sort():Object.keys(this.itemCategoryMap).sort());this.pagedTransactions=$(()=>this.displayedTransactions());this.totalPages=$(()=>this.pagination().totalPages);this.totalRecords=$(()=>this.pagination().total);this.areAllApproved=$(()=>{let e=this.displayedTransactions();return e.length>0&&e.every(t=>t.is_sigh_off)});this.loadInitialData(),this.ledgerForm.get("item_group")?.valueChanges.subscribe(e=>{this.formItemGroup.set(e)}),Bn(()=>{let e=this.formItemGroup(),t=this.availableCategories(),i=this.ledgerForm.get("subject_name")?.value;i&&t.length>0&&!t.includes(i)&&(this.ledgerForm.get("subject_name")?.setValue("",{emitEvent:!1}),this.ledgerForm.get("gl_account_id")?.setValue(null,{emitEvent:!1}))}),this.ledgerForm.get("subject_name")?.valueChanges.subscribe(async()=>{await this.updateGLAccountId()}),Bn(()=>{this.selectedItem()||this.selectedCategory.set("")})}async loadInitialData(){await Promise.all([this.loadGLAccounts(),this.applyFilters()])}async loadGLAccounts(){this.isLoadingGLAccounts.set(!0),this.glAccountsError.set(null);try{let e=await this.apiService.getGLAccounts();e.success&&e.data?this.glAccounts.set(e.data):this.glAccountsError.set(e.error||"\u7121\u6CD5\u52A0\u8F09\u6703\u8A08\u79D1\u76EE")}catch{this.glAccountsError.set("\u52A0\u8F09\u6703\u8A08\u79D1\u76EE\u5931\u6557\uFF0C\u8ACB\u7A0D\u5F8C\u91CD\u8A66")}finally{this.isLoadingGLAccounts.set(!1)}}async applyFilters(){this.isLoading.set(!0),this.errorMessage.set(null),this.appliedItem.set(this.selectedItem()),this.appliedCategory.set(this.selectedCategory()),this.appliedVendor.set(this.selectedVendor()),this.appliedDescriptionFilter.set(this.descriptionFilter()),this.appliedEntryIdFilter.set(this.entryIdFilter()),this.currentPage.set(1),await this.loadPageData(1)}async loadPageData(e){this.isLoading.set(!0),this.errorMessage.set(null);try{let t=await this.apiService.getLedgerEntries({startDate:this.startDate(),endDate:this.endDate(),itemGroup:this.appliedItem()||void 0,subjectName:this.appliedCategory()||void 0,vendorName:this.appliedVendor()||void 0,description:this.appliedDescriptionFilter()||void 0,entryId:this.appliedEntryIdFilter()?parseInt(this.appliedEntryIdFilter(),10):void 0,page:e,limit:20});if(t.success&&t.data){if(this.displayedTransactions.set(t.data),t.pagination&&this.pagination.set({total:t.pagination.total,totalPages:t.pagination.totalPages,page:t.pagination.page,limit:t.pagination.limit}),e===1){let i=await this.apiService.getLedgerEntries({startDate:this.startDate(),endDate:this.endDate(),limit:9999});if(i.success&&i.data){this.allTransactions.set(i.data);let r=Object.keys(this.itemCategoryMap),o=i.data.map(p=>p.item_group).filter(Boolean),a=[...new Set([...r,...o])].sort(),u=[...new Set(i.data.map(p=>p.subject_name).filter(Boolean))].sort(),c=[...new Set(i.data.map(p=>p.vendor_name).filter(Boolean))].sort();this.filterOptions.set({items:a,categories:u,vendorNames:c})}}}else this.errorMessage.set(t.error||"\u7121\u6CD5\u53D6\u5F97\u6D41\u6C34\u5E33\u8CC7\u6599")}catch(t){console.error("Error loading ledger entries:",t),this.errorMessage.set("\u53D6\u5F97\u6D41\u6C34\u5E33\u8CC7\u6599\u5931\u6557\uFF0C\u8ACB\u7A0D\u5F8C\u91CD\u8A66")}finally{this.isLoading.set(!1)}}resetFilters(){this.startDate.set(this.formatDate(this.firstDayOfMonth)),this.endDate.set(this.formatDate(this.lastDayOfMonth)),this.selectedItem.set(""),this.selectedCategory.set(""),this.selectedVendor.set(""),this.descriptionFilter.set(""),this.entryIdFilter.set(""),this.appliedItem.set(""),this.appliedCategory.set(""),this.appliedVendor.set(""),this.appliedDescriptionFilter.set(""),this.appliedEntryIdFilter.set(""),this.currentPage.set(1),this.applyFilters()}changeView(e){this.activeView.set(e),e==="add"&&(this.resetForm(),this.newlyCreatedEntry.set(null),this.shipmentItems.set([]),this.shipmentItemsError.set(null))}async goToPage(e){let t=this.totalPages(),i=Math.min(Math.max(e,1),t);i!==this.currentPage()&&(this.currentPage.set(i),await this.loadPageData(i))}async goToPrevPage(){await this.goToPage(this.currentPage()-1)}async goToNextPage(){await this.goToPage(this.currentPage()+1)}sortData(e){this.sortColumn()===e?this.sortDirection.update(t=>t==="asc"?"desc":"asc"):(this.sortColumn.set(e),this.sortDirection.set("asc")),this.currentPage.set(1)}async openEditModal(e){this.editingTransaction.set(e),this.formItemGroup.set(e.item_group),this.ledgerForm.patchValue({entry_id:e.entry_id?e.entry_id.toString():"",entry_date:this.normalizeDateInput(e.entry_date),item_group:e.item_group,subject_name:e.subject_name,amount:e.amount?e.amount.toString():"",invoice_no:e.invoice_no,vendor_tax_id:this.sanitizeVendorTaxId(e.vendor_tax_id),vendor_name:e.vendor_name,description:e.description,is_sigh_off:e.is_sigh_off}),this.isModalOpen.set(!0),await this.loadShipmentItemsForEntry(e.entry_id)}closeModal(){this.isModalOpen.set(!1),this.editingTransaction.set(null),this.shipmentItems.set([]),this.shipmentItemsError.set(null),this.isLoadingShipmentItems.set(!1),this.resetForm()}async loadShipmentItemsForEntry(e){if(!e){this.shipmentItems.set([]),this.shipmentItemsError.set(null);return}let t=typeof e=="string"?parseInt(e,10):e;this.isLoadingShipmentItems.set(!0),this.shipmentItemsError.set(null);try{let i={entryId:t,limit:1e3,offset:0},r=await this.apiService.getShipmentItems(i);if(r.success&&r.data){let o=r.data.map(a=>O({},a));this.shipmentItems.set(o)}else this.shipmentItems.set([]),this.shipmentItemsError.set(r.error||"\u7121\u6CD5\u53D6\u5F97\u9032\u8CA8\u8CC7\u6599")}catch(i){console.error("Error loading shipment items:",i),this.shipmentItems.set([]),this.shipmentItemsError.set("\u53D6\u5F97\u9032\u8CA8\u8CC7\u6599\u5931\u6557\uFF0C\u8ACB\u7A0D\u5F8C\u91CD\u8A66")}finally{this.isLoadingShipmentItems.set(!1)}}isSavingShipmentItem(e){return this.savingShipmentItemIds().includes(e)}async saveShipmentItem(e){if(!e?.shipment_id)return;let t=this.savingShipmentItemIds();if(t.includes(e.shipment_id))return;let r=(this.editingTransaction()||this.newlyCreatedEntry())?.entry_id;this.savingShipmentItemIds.set([...t,e.shipment_id]),this.shipmentItemsError.set(null);try{let o=await this.apiService.updateShipmentItem(e.shipment_id,{itemName:e.itemName,qty:e.qty??null,unitPrice:e.unitPrice??null,unit:e.unit??null,remark:e.remark??null,entryId:r??null});o.success?(this.saveSuccessMessage.set("\u9032\u8CA8\u8CC7\u6599\u5DF2\u5132\u5B58\u6210\u529F"),this.newShipmentItemIds.set(this.newShipmentItemIds().filter(a=>a!==e.shipment_id)),setTimeout(()=>{this.saveSuccessMessage.set(null)},3e3)):this.shipmentItemsError.set(o.error||"\u66F4\u65B0\u9032\u8CA8\u8CC7\u6599\u5931\u6557")}catch(o){console.error("Error updating shipment item:",o),this.shipmentItemsError.set("\u66F4\u65B0\u9032\u8CA8\u8CC7\u6599\u5931\u6557\uFF0C\u8ACB\u7A0D\u5F8C\u91CD\u8A66")}finally{this.savingShipmentItemIds.set(this.savingShipmentItemIds().filter(o=>o!==e.shipment_id))}}async addNewShipmentItem(){let e=this.editingTransaction()||this.newlyCreatedEntry();if(!e||!e.entry_id){this.shipmentItemsError.set("\u7121\u6CD5\u65B0\u589E\u9032\u8CA8\u55AE\uFF1A\u6D41\u6C34\u5E33\u5C1A\u672A\u4FDD\u5B58");return}let i=this.ledgerForm.get("vendor_id")?.value||e.vendor_id||null;this.isLoadingShipmentItems.set(!0),this.shipmentItemsError.set(null);try{let r=await this.apiService.createShipmentItem({entryId:e.entry_id,issueDate:e.entry_date||new Date().toISOString().split("T")[0],vendorId:i,itemName:"\u65B0\u54C1\u9805",qty:0,unitPrice:0,unit:"",remark:""});if(r.success&&r.data){let o=this.shipmentItems();this.shipmentItems.set([r.data,...o]),this.newShipmentItemIds.set([...this.newShipmentItemIds(),r.data.shipment_id])}else this.shipmentItemsError.set(r.error||"\u65B0\u589E\u9032\u8CA8\u8CC7\u6599\u5931\u6557")}catch(r){console.error("Error creating shipment item:",r),this.shipmentItemsError.set("\u65B0\u589E\u9032\u8CA8\u8CC7\u6599\u5931\u6557\uFF0C\u8ACB\u7A0D\u5F8C\u91CD\u8A66")}finally{this.isLoadingShipmentItems.set(!1)}}deleteShipmentItem(e){this.deleteConfirmation.set({shipmentId:e.shipment_id,itemName:e.itemName})}async confirmDeleteShipmentItem(){let e=this.deleteConfirmation();if(e)try{let t=await this.apiService.deleteShipmentItem(e.shipmentId);if(t.success){let i=this.shipmentItems();this.shipmentItems.set(i.filter(r=>r.shipment_id!==e.shipmentId)),this.shipmentItemsError.set(null)}else this.shipmentItemsError.set(t.error||"\u522A\u9664\u9032\u8CA8\u8CC7\u6599\u5931\u6557")}catch(t){console.error("Error deleting shipment item:",t),this.shipmentItemsError.set("\u522A\u9664\u9032\u8CA8\u8CC7\u6599\u5931\u6557\uFF0C\u8ACB\u7A0D\u5F8C\u91CD\u8A66")}finally{this.deleteConfirmation.set(null)}}cancelDeleteShipmentItem(){this.deleteConfirmation.set(null)}async deleteLedgerEntry(){let e=this.editingTransaction();if(!e?.entry_id){this.errorMessage.set("\u7121\u6CD5\u53D6\u5F97\u6D41\u6C34\u5E33ID");return}this.isCheckingShipment.set(!0);try{let t=await this.apiService.checkLedgerShipmentItems(e.entry_id);t.success?this.ledgerDeleteConfirmation.set({entryId:e.entry_id,relatedShipmentCount:t.data?.shipmentItemsCount||0}):this.errorMessage.set(t.error||"\u6AA2\u67E5\u9032\u8CA8\u55AE\u5931\u6557")}catch(t){console.error("Error checking shipment items:",t),this.errorMessage.set("\u6AA2\u67E5\u9032\u8CA8\u55AE\u5931\u6557\uFF0C\u8ACB\u7A0D\u5F8C\u91CD\u8A66")}finally{this.isCheckingShipment.set(!1)}}async confirmDeleteLedgerEntry(){let e=this.ledgerDeleteConfirmation();if(e)try{let t=await this.apiService.deleteLedgerEntry(e.entryId);if(t.success){let i=this.displayedTransactions();this.displayedTransactions.set(i.filter(r=>r.entry_id!==e.entryId)),this.ledgerDeleteConfirmation.set(null),this.closeModal(),this.errorMessage.set(`\u6D41\u6C34\u5E33\u5DF2\u522A\u9664${e.relatedShipmentCount>0?`\uFF0C\u4E26\u540C\u6642\u522A\u9664\u4E86 ${e.relatedShipmentCount} \u7B46\u9032\u8CA8\u55AE\u9805\u76EE`:""}`),setTimeout(()=>{this.errorMessage.set(null)},3e3)}else this.errorMessage.set(t.error||"\u522A\u9664\u6D41\u6C34\u5E33\u5931\u6557")}catch(t){console.error("Error deleting ledger entry:",t),this.errorMessage.set("\u522A\u9664\u6D41\u6C34\u5E33\u5931\u6557\uFF0C\u8ACB\u7A0D\u5F8C\u91CD\u8A66")}}cancelDeleteLedgerEntry(){this.ledgerDeleteConfirmation.set(null)}toggleAllApprovals(e){let t=e.target,i=t.checked,r=i?"\u60A8\u78BA\u5B9A\u8981\u7C3D\u6838\u6240\u6709\u53EF\u898B\u9805\u76EE\u55CE\uFF1F":"\u60A8\u78BA\u5B9A\u8981\u53D6\u6D88\u7C3D\u6838\u6240\u6709\u53EF\u898B\u9805\u76EE\u55CE\uFF1F";this.confirmationState.set({message:r,isChecked:i,target:t})}async confirmApproval(){let e=this.confirmationState();if(!e)return;let{isChecked:t}=e,i=this.displayedTransactions().filter(o=>o.is_sigh_off!==t),r=i.map(o=>this.apiService.updateLedgerEntry({entry_id:o.entry_id,is_sigh_off:t}));try{await Promise.all(r);let o=this.allTransactions().map(a=>i.some(c=>c.entry_id===a.entry_id)?G(O({},a),{is_sigh_off:t}):a);this.allTransactions.set(o)}catch(o){console.error("\u66F4\u65B0\u7C3D\u6838\u72C0\u614B\u5931\u6557:",o),this.errorMessage.set("\u66F4\u65B0\u7C3D\u6838\u72C0\u614B\u5931\u6557")}this.confirmationState.set(null)}cancelApproval(){let e=this.confirmationState();e&&(e.target.checked=!e.isChecked,this.confirmationState.set(null))}async updateGLAccountId(){let e=this.ledgerForm.get("item_group")?.value,t=this.ledgerForm.get("subject_name")?.value;if(!e||!t){this.ledgerForm.get("gl_account_id")?.setValue(null);return}try{let i=await this.apiService.resolveGLAccount(e,t);i.success&&i.data?.glAccountId?this.ledgerForm.get("gl_account_id")?.setValue(i.data.glAccountId,{emitEvent:!1}):this.ledgerForm.get("gl_account_id")?.setValue(null,{emitEvent:!1})}catch(i){console.error("Error resolving GL account:",i),this.ledgerForm.get("gl_account_id")?.setValue(null,{emitEvent:!1})}}async handleFormSubmit(){if(this.submitted.set(!0),this.ledgerForm.invalid)return;let e=this.ledgerForm.get("vendor_tax_id")?.value;if(e&&e.trim().length>0){if(!/^\d{1,8}$/.test(e)){this.errorMessage.set("\u8CE3\u65B9\u7D71\u7DE8\u53EA\u80FD\u662F 1-8 \u4F4D\u6578\u5B57"),this.isLoading.set(!1);return}try{let t=await this.apiService.getVendorByTaxId(e);t.success&&t.data?this.ledgerForm.patchValue({vendor_id:t.data.vendor_id,vendor_name:t.data.vendor_name},{emitEvent:!1}):console.warn("\u8CE3\u65B9\u7D71\u7DE8\u4E0D\u5B58\u5728\u65BC\u7CFB\u7D71\u4E2D\uFF0C\u4F46\u5141\u8A31\u7E7C\u7E8C\u4FDD\u5B58\uFF08\u53EF\u80FD\u662F\u5E02\u5834\u8CB7\u7684\u8CA8\uFF09")}catch(t){console.warn("\u9A57\u8B49\u8CE3\u65B9\u7D71\u7DE8\u6642\u51FA\u932F\uFF1A",t)}}this.isLoading.set(!0),this.errorMessage.set(null);try{let t=this.ledgerForm.value,i={entry_date:t.entry_date,item_group:t.item_group,subject_name:t.subject_name,amount:Number(t.amount),invoice_no:t.invoice_no,vendor_tax_id:t.vendor_tax_id,vendor_name:t.vendor_name,vendor_id:t.vendor_id,description:t.description,is_sigh_off:t.is_sigh_off||!1,gl_account_id:t.gl_account_id||null};if(this.editingTransaction()){let r=this.editingTransaction();if((await this.apiService.updateLedgerEntry(O({entry_id:r.entry_id},i))).success){let a=this.allTransactions().map(u=>u.entry_id===r.entry_id?O(O({},u),i):u);this.allTransactions.set(a),this.closeModal()}}else{let r=await this.apiService.createLedgerEntry(i);if(r.success&&r.data){let o={entry_id:r.data.entry_id,entry_date:r.data.entry_date,item_group:r.data.item_group,subject_name:r.data.subject_name,amount:r.data.amount,invoice_no:r.data.invoice_no,vendor_tax_id:r.data.vendor_tax_id,vendor_name:r.data.vendor_name,vendor_id:r.data.vendor_id,description:r.data.description,is_sigh_off:r.data.is_sigh_off||!1,gl_account_id:r.data.gl_account_id||null};this.newlyCreatedEntry.set(o),this.resetForm(),await this.loadShipmentItemsForEntry(o.entry_id)}}}catch(t){console.error("\u4FDD\u5B58\u5931\u6557:",t),this.errorMessage.set("\u4FDD\u5B58\u5931\u6557\uFF0C\u8ACB\u7A0D\u5F8C\u91CD\u8A66")}finally{this.isLoading.set(!1)}this.editingTransaction()||this.applyFilters()}resetForm(){this.ledgerForm.reset({is_sigh_off:!1}),this.submitted.set(!1)}resetAddView(){this.newlyCreatedEntry.set(null),this.shipmentItems.set([]),this.shipmentItemsError.set(null),this.resetForm()}formatCurrency(e){if(e==null||isNaN(e))return"";let t=e<0,r=Math.abs(e).toLocaleString("zh-TW",{style:"currency",currency:"TWD",minimumFractionDigits:0});return t?`-${r}`:r}getErrorMessage(e){let t=this.ledgerForm.get(e);if(!t||!t.errors)return"";if(e==="vendor_tax_id"){if(t.errors.pattern)return"\u8CE3\u65B9\u7D71\u7DE8\u53EA\u80FD\u662F 1-8 \u4F4D\u6578\u5B57";if(t.errors.required)return"\u8CE3\u65B9\u7D71\u7DE8\u70BA\u5FC5\u586B"}return t.errors.required?`${e} \u70BA\u5FC5\u586B`:t.errors.pattern?`${e} \u683C\u5F0F\u4E0D\u6B63\u78BA`:"\u8F38\u5165\u8CC7\u6599\u6709\u8AA4"}sanitizeVendorTaxId(e){return e?e.replace(/\D/g,"").slice(0,8):""}onVendorTaxIdInput(e){let t=e.target,i=this.sanitizeVendorTaxId(t.value);this.ledgerForm.get("vendor_tax_id")?.setValue(i)}formatDate(e){let t=e.getFullYear(),i=String(e.getMonth()+1).padStart(2,"0"),r=String(e.getDate()).padStart(2,"0");return`${t}-${i}-${r}`}normalizeDateInput(e){if(!e)return"";if(/^\d{4}-\d{2}-\d{2}$/.test(e))return e;let t=new Date(e);return Number.isNaN(t.getTime())?"":this.formatDate(t)}isInvalid(e){let t=this.ledgerForm.get(e);return!!t&&t.invalid&&(t.touched||this.submitted())}};qa.\u0275fac=function(t){return new(t||qa)},qa.\u0275cmp=re({type:qa,selectors:[["app-ledger"]],decls:18,vars:11,consts:[[1,"space-y-6"],[1,"text-3xl","font-bold","text-gray-900"],[1,"bg-blue-50","border","border-blue-200","rounded-lg","p-4","flex","items-center","gap-3"],[1,"bg-red-50","border","border-red-200","rounded-lg","p-4","flex","items-center","gap-3"],[1,"bg-white","p-6","rounded-xl","shadow-md"],[1,"border-b","border-gray-200"],["aria-label","Tabs",1,"-mb-px","flex","space-x-6"],[1,"whitespace-nowrap","py-4","px-1","border-b-2","font-medium","text-sm",3,"click"],[1,"pt-6"],[1,"space-y-4"],[1,"fixed","inset-0","bg-black","bg-opacity-50","flex","items-center","justify-center","z-50"],["name","hourglass-outline",1,"text-blue-600","text-xl","animate-spin"],[1,"text-blue-700"],["name","alert-circle-outline",1,"text-red-600","text-xl"],[1,"text-red-700"],[1,"grid","grid-cols-1","md:grid-cols-2","lg:grid-cols-4","gap-4","p-4","bg-gray-50","rounded-lg"],[1,"flex","items-center","gap-2"],["for","startDate",1,"text-sm","font-medium","text-gray-600","shrink-0"],[1,"relative","w-full"],["type","date","id","startDate",1,"w-full","border-gray-300","rounded-lg","shadow-sm","focus:ring-indigo-500","focus:border-indigo-500","text-sm","p-2","bg-white","pr-10",3,"ngModelChange","ngModel"],[1,"absolute","inset-y-0","right-0","flex","items-center","pr-3","pointer-events-none"],["name","calendar-outline",1,"text-gray-400"],["for","endDate",1,"text-sm","font-medium","text-gray-600","shrink-0"],["type","date","id","endDate",1,"w-full","border-gray-300","rounded-lg","shadow-sm","focus:ring-indigo-500","focus:border-indigo-500","text-sm","p-2","bg-white","pr-10",3,"ngModelChange","ngModel"],[1,"w-full","border-gray-300","rounded-lg","shadow-sm","focus:ring-indigo-500","focus:border-indigo-500","text-sm","p-2","bg-white",3,"ngModelChange","ngModel"],["value",""],[3,"value"],[1,"w-full","border-gray-300","rounded-lg","shadow-sm","focus:ring-indigo-500","focus:border-indigo-500","text-sm","p-2","bg-white","disabled:bg-gray-100","disabled:cursor-not-allowed",3,"ngModelChange","ngModel","disabled"],[1,"lg:col-span-2"],["type","text","placeholder","\u641C\u5C0BID...","inputmode","numeric","pattern","[0-9]*",1,"w-full","border-gray-300","rounded-lg","shadow-sm","focus:ring-indigo-500","focus:border-indigo-500","text-sm","p-2","bg-white",3,"ngModelChange","ngModel"],["type","text","placeholder","\u641C\u5C0B\u8AAA\u660E\u95DC\u9375\u5B57...",1,"w-full","border-gray-300","rounded-lg","shadow-sm","focus:ring-indigo-500","focus:border-indigo-500","text-sm","p-2","bg-white",3,"ngModelChange","ngModel"],[1,"flex","items-center","gap-2","lg:col-span-4","justify-end"],[1,"bg-indigo-600","text-white","px-4","py-2","rounded-lg","font-medium","hover:bg-indigo-700","transition-colors","flex","items-center","gap-2","text-sm","disabled:opacity-50","disabled:cursor-not-allowed",3,"click","disabled"],["title","\u91CD\u8A2D\u7BE9\u9078",1,"text-gray-500","hover:text-gray-800","transition-colors","p-2","rounded-full","bg-gray-100","hover:bg-gray-200",3,"click"],["name","refresh-outline",1,"text-xl"],[1,"overflow-x-auto"],[1,"w-full","text-sm","text-left","whitespace-nowrap"],[1,"text-xs","text-gray-700","uppercase","bg-gray-100"],[1,"px-4","py-3"],[1,"flex","items-center","justify-center","gap-2"],["type","checkbox","title","\u5168\u90E8\u7C3D\u6838/\u53D6\u6D88\u7C3D\u6838",1,"rounded","h-4","w-4","text-indigo-600","border-gray-300","focus:ring-indigo-500","cursor-pointer",3,"change","checked"],[1,"px-4","py-3","cursor-pointer",3,"click"],["name","swap-vertical-outline"],[1,"px-4","py-3","cursor-pointer","text-right",3,"click"],[1,"border-b","hover:bg-gray-50","cursor-pointer",3,"bg-red-50"],[1,"flex","flex-col","sm:flex-row","items-center","justify-between","gap-3","pt-4"],[1,"text-sm","text-gray-600"],["type","button",1,"px-3","py-1.5","text-sm","border","rounded-md","disabled:opacity-50","disabled:cursor-not-allowed",3,"click","disabled"],["name","hourglass-outline",1,"animate-spin"],["name","filter-outline"],[1,"border-b","hover:bg-gray-50","cursor-pointer",3,"click"],[1,"px-4","py-2","text-center"],["type","checkbox","disabled","",1,"rounded","h-4","w-4","text-indigo-500","border-gray-300","cursor-not-allowed",3,"checked"],[1,"px-4","py-2"],[1,"px-4","py-2","text-right"],[1,"px-4","py-2","truncate","max-w-xs"],["colspan","9",1,"text-center","py-8","text-gray-500"],["novalidate","",1,"space-y-6","max-w-4xl","mx-auto",3,"formGroup"],[1,"max-w-4xl","mx-auto"],["novalidate","",1,"space-y-6","max-w-4xl","mx-auto",3,"ngSubmit","formGroup"],[1,"grid","grid-cols-1","md:grid-cols-2","gap-6"],["for","date",1,"block","text-sm","font-medium","text-gray-700"],[1,"relative","mt-1"],["type","date","id","date","formControlName","entry_date",1,"block","w-full","border","bg-gray-50","rounded-md","shadow-sm","p-2","pr-10"],["for","item",1,"block","text-sm","font-medium","text-gray-700"],["id","item","formControlName","item_group",1,"mt-1","block","w-full","border","bg-gray-50","rounded-md","shadow-sm","p-2"],["value","","disabled",""],["for","category",1,"block","text-sm","font-medium","text-gray-700"],["id","category","formControlName","subject_name",1,"mt-1","block","w-full","border","bg-gray-50","rounded-md","shadow-sm","p-2"],["for","amount",1,"block","text-sm","font-medium","text-gray-700"],["type","number","id","amount","formControlName","amount","placeholder","\u6B63\u6578\u70BA\u6536\u5165\uFF0C\u8CA0\u6578\u70BA\u8A72\u9805\u76EE\u5C0D\u6C96",1,"mt-1","block","w-full","border","bg-gray-50","rounded-md","shadow-sm","p-2","text-right"],["for","invoiceNumber",1,"block","text-sm","font-medium","text-gray-700"],["type","text","id","invoiceNumber","formControlName","invoice_no",1,"mt-1","block","w-full","border","bg-gray-50","rounded-md","shadow-sm","p-2"],["for","vendorTaxId",1,"block","text-sm","font-medium","text-gray-700"],["type","text","id","vendorTaxId","formControlName","vendor_tax_id","inputmode","numeric","pattern","\\d*","maxlength","8",1,"mt-1","block","w-full","border","bg-gray-50","rounded-md","shadow-sm","p-2",3,"input"],[1,"md:col-span-2"],["for","vendorName",1,"block","text-sm","font-medium","text-gray-700"],["type","text","id","vendorName","formControlName","vendor_name",1,"mt-1","block","w-full","border","bg-gray-50","rounded-md","shadow-sm","p-2"],["for","description",1,"block","text-sm","font-medium","text-gray-700"],["id","description","formControlName","description","rows","3",1,"mt-1","block","w-full","border","bg-gray-50","rounded-md","shadow-sm","p-2"],[1,"flex","justify-end","gap-4"],["type","button",1,"px-4","py-2","border","border-gray-300","rounded-md","shadow-sm","text-sm","font-medium","text-gray-700","bg-white","hover:bg-gray-50",3,"click"],["type","submit",1,"px-4","py-2","border","border-transparent","rounded-md","shadow-sm","text-sm","font-medium","text-white","bg-indigo-600","hover:bg-indigo-700"],[1,"bg-blue-50","border","border-blue-200","rounded-lg","p-4","mb-6","flex","items-center","gap-3"],["name","checkmark-circle-outline",1,"text-blue-600","text-xl"],[1,"mt-8"],[1,"flex","items-center","justify-between","mb-4"],[1,"flex","items-center","gap-4","flex-grow"],[1,"text-lg","font-semibold","text-gray-900"],[1,"flex","items-center","gap-2","px-3","py-1.5","text-sm","text-green-700","bg-green-50","border","border-green-200","rounded-md"],[1,"flex","items-center","gap-2","text-sm","text-blue-600"],["type","button",1,"px-3","py-1.5","text-sm","bg-green-600","text-white","rounded-md","hover:bg-green-700","disabled:opacity-50","disabled:cursor-not-allowed","flex","items-center","gap-1",3,"click","disabled"],["name","add-outline"],[1,"bg-red-50","border","border-red-200","rounded-lg","p-3","text-red-700","text-sm","mb-4"],[1,"text-sm","text-gray-500"],[1,"flex","justify-end","gap-4","mt-6","pt-6","border-t"],["type","button",1,"px-4","py-2","border","border-transparent","rounded-md","shadow-sm","text-sm","font-medium","text-white","bg-indigo-600","hover:bg-indigo-700",3,"click"],["name","checkmark-circle-outline",1,"text-green-600"],["name","refresh-outline",1,"animate-spin"],["name","alert-circle-outline"],[3,"class"],[1,"grid","grid-cols-1","md:grid-cols-2","gap-4"],[1,"block","text-xs","font-medium","text-gray-600"],["type","text",1,"mt-1","block","w-full","border","bg-white","rounded-md","shadow-sm","p-2",3,"ngModelChange","ngModel","name"],["type","number","step","0.01",1,"mt-1","block","w-full","border","bg-white","rounded-md","shadow-sm","p-2","text-right",3,"ngModelChange","ngModel","name"],["type","text","readonly","",1,"mt-1","block","w-full","border","bg-gray-100","rounded-md","shadow-sm","p-2","text-right",3,"value"],["rows","2",1,"mt-1","block","w-full","border","bg-white","rounded-md","shadow-sm","p-2",3,"ngModelChange","ngModel","name"],[1,"flex","justify-end","gap-2","mt-3"],["type","button",1,"px-3","py-1.5","text-sm","bg-red-600","text-white","rounded-md","hover:bg-red-700","disabled:opacity-50","disabled:cursor-not-allowed","flex","items-center","gap-1",3,"click"],["name","trash-outline"],["type","button",1,"px-3","py-1.5","text-sm","bg-indigo-600","text-white","rounded-md","hover:bg-indigo-700","disabled:opacity-50","disabled:cursor-not-allowed",3,"click","disabled"],[1,"bg-white","rounded-xl","shadow-2xl","w-full","max-w-2xl","max-h-[90vh]","flex","flex-col"],[1,"flex","justify-between","items-center","p-4","border-b"],[1,"text-lg","font-semibold"],[1,"text-gray-400","hover:text-gray-600",3,"click"],["name","close-outline",1,"text-2xl"],[1,"p-6","overflow-y-auto"],["novalidate","",1,"space-y-6",3,"ngSubmit","formGroup"],["for","modal-date",1,"block","text-sm","font-medium","text-gray-700"],["type","date","id","modal-date","formControlName","entry_date",1,"block","w-full","border","bg-gray-50","rounded-md","shadow-sm","p-2","pr-10"],["for","modal-item",1,"block","text-sm","font-medium","text-gray-700"],["id","modal-item","formControlName","item_group",1,"mt-1","block","w-full","border","bg-gray-50","rounded-md","shadow-sm","p-2"],["for","modal-category",1,"block","text-sm","font-medium","text-gray-700"],["id","modal-category","formControlName","subject_name",1,"mt-1","block","w-full","border","bg-gray-50","rounded-md","shadow-sm","p-2"],["for","modal-amount",1,"block","text-sm","font-medium","text-gray-700"],["type","number","id","modal-amount","formControlName","amount",1,"mt-1","block","w-full","border","bg-gray-50","rounded-md","shadow-sm","p-2","text-right"],["for","modal-invoiceNumber",1,"block","text-sm","font-medium","text-gray-700"],["type","text","id","modal-invoiceNumber","formControlName","invoice_no",1,"mt-1","block","w-full","border","bg-gray-50","rounded-md","shadow-sm","p-2"],["for","modal-vendorTaxId",1,"block","text-sm","font-medium","text-gray-700"],["type","text","id","modal-vendorTaxId","formControlName","vendor_tax_id","inputmode","numeric","pattern","\\d*","maxlength","8",1,"mt-1","block","w-full","border","bg-gray-50","rounded-md","shadow-sm","p-2",3,"input"],[1,"mt-1","text-sm","text-red-600"],["for","modal-vendorName",1,"block","text-sm","font-medium","text-gray-700"],["type","text","id","modal-vendorName","formControlName","vendor_name","readonly","",1,"mt-1","block","w-full","border","bg-gray-50","rounded-md","shadow-sm","p-2","cursor-not-allowed","opacity-60"],["for","modal-description",1,"block","text-sm","font-medium","text-gray-700"],["id","modal-description","formControlName","description","rows","3",1,"mt-1","block","w-full","border","bg-gray-50","rounded-md","shadow-sm","p-2"],[1,"flex","items-center","space-x-2"],["type","checkbox","formControlName","is_sigh_off",1,"rounded","h-4","w-4","text-indigo-600","focus:ring-indigo-500","border-gray-300"],[1,"text-sm","text-gray-700"],[1,"flex","justify-end","gap-4","pt-4","border-t","mt-6"],["type","button",1,"px-4","py-2","border","border-transparent","rounded-md","shadow-sm","text-sm","font-medium","text-white","bg-red-600","hover:bg-red-700",3,"click"],[1,"fixed","inset-0","bg-black","bg-opacity-50","flex","items-center","justify-center","z-[60]"],[1,"mt-8","pt-6","border-t"],[1,"bg-white","rounded-lg","shadow-lg","p-6","max-w-md","w-full","mx-4"],[1,"flex","items-center","gap-3","mb-4"],["name","warning-outline",1,"text-2xl","text-orange-600"],[1,"space-y-3","mb-6"],[1,"text-gray-700"],[1,"bg-red-50","border","border-red-200","rounded-md","p-3"],[1,"flex","justify-end","gap-3"],[1,"px-4","py-2","border","border-gray-300","rounded-md","shadow-sm","text-sm","font-medium","text-gray-700","bg-white","hover:bg-gray-50",3,"click"],[1,"px-4","py-2","border","border-transparent","rounded-md","shadow-sm","text-sm","font-medium","text-white","bg-red-600","hover:bg-red-700",3,"click"],[1,"text-sm","text-red-700"],[1,"bg-white","rounded-xl","shadow-2xl","w-full","max-w-md","m-4"],[1,"p-6","text-center"],[1,"mx-auto","flex","items-center","justify-center","h-12","w-12","rounded-full","bg-blue-100"],["name","help-outline",1,"h-6","w-6","text-blue-600"],[1,"mt-4","text-lg","font-semibold","text-gray-900"],[1,"mt-2","text-sm","text-gray-500"],[1,"flex","justify-center","gap-4","bg-gray-50","px-6","py-4","rounded-b-xl"],["type","button",1,"px-4","py-2","border","rounded-md",3,"click"],["type","button",1,"px-4","py-2","bg-indigo-600","text-white","rounded-md","hover:bg-indigo-700",3,"click"],[1,"mx-auto","flex","items-center","justify-center","h-12","w-12","rounded-full","bg-red-100"],["name","trash-outline",1,"h-6","w-6","text-red-600"],[1,"mt-1","text-xs","text-gray-400"],["type","button",1,"px-4","py-2","bg-red-600","text-white","rounded-md","hover:bg-red-700",3,"click"]],template:function(t,i){if(t&1&&(l(0,"div",0)(1,"h1",1),d(2,"\u6D41\u6C34\u5E33"),s(),M(3,M9,4,0,"div",2),M(4,A9,4,1,"div",3),l(5,"div",4)(6,"div",5)(7,"nav",6)(8,"button",7),b("click",function(){return i.changeView("details")}),d(9," \u6D41\u6C34\u5E33\u7D30\u9805 "),s(),l(10,"button",7),b("click",function(){return i.changeView("add")}),d(11," \u65B0\u589E\u5E33\u52D9 "),s()()(),l(12,"div",8),M(13,O9,88,17,"div",9),M(14,Q9,2,1),s()()(),M(15,cL,80,21,"div",10),M(16,mL,14,1,"div",10),M(17,pL,16,1,"div",10)),t&2){let r,o;m(3),A(i.isLoading()?3:-1),m(),A(i.errorMessage()?4:-1),m(4),Te(i.activeView()==="details"?"border-indigo-500 text-indigo-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"),m(2),Te(i.activeView()==="add"?"border-indigo-500 text-indigo-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"),m(3),A(i.activeView()==="details"?13:-1),m(),A(i.activeView()==="add"?14:-1),m(),A(i.isModalOpen()?15:-1),m(),A((r=i.confirmationState())?16:-1,r),m(),A((o=i.deleteConfirmation())?17:-1,o)}},dependencies:[se,De,Ve,He,Ge,be,Bt,Xi,Oe,fe,ke,Ql,Zl,Ie,Be,Le,Ue],encapsulation:2,changeDetection:0});var cp=qa;var So=class So{constructor(){this.holidays2024=[{date:"2024-01-01",name:"\u5143\u65E6"},{date:"2024-02-08",name:"\u8FB2\u66C6\u6625\u7BC0"},{date:"2024-02-09",name:"\u8FB2\u66C6\u6625\u7BC0"},{date:"2024-02-10",name:"\u8FB2\u66C6\u6625\u7BC0"},{date:"2024-02-11",name:"\u8FB2\u66C6\u6625\u7BC0"},{date:"2024-02-12",name:"\u8FB2\u66C6\u6625\u7BC0"},{date:"2024-02-13",name:"\u8FB2\u66C6\u6625\u7BC0"},{date:"2024-02-14",name:"\u8FB2\u66C6\u6625\u7BC0"},{date:"2024-02-28",name:"\u548C\u5E73\u7D00\u5FF5\u65E5"},{date:"2024-04-04",name:"\u5152\u7AE5\u7BC0"},{date:"2024-04-05",name:"\u6E05\u660E\u7BC0"},{date:"2024-06-10",name:"\u7AEF\u5348\u7BC0"},{date:"2024-09-17",name:"\u4E2D\u79CB\u7BC0"},{date:"2024-10-10",name:"\u570B\u6176\u65E5"}]}getHolidays(e){return e===2024?this.holidays2024:[]}};So.\u0275fac=function(t){return new(t||So)},So.\u0275prov=X({token:So,factory:So.\u0275fac,providedIn:"root"});var mp=So;var fL=()=>({month:"long"}),gL=()=>["\u65E5","\u4E00","\u4E8C","\u4E09","\u56DB","\u4E94","\u516D"],hL=(n,e)=>e.date,yL=(n,e)=>e.id;function _L(n,e){if(n&1&&(rt(0,"div",7),d(1),ot()),n&2){let t=e.$implicit;m(),w(t)}}function vL(n,e){if(n&1&&(rt(0,"div",12),d(1),ot()),n&2){let t=_().$implicit;m(),N(" ",t.holiday.name," ")}}function CL(n,e){if(n&1){let t=B();rt(0,"div",14),xr("click",function(){let r=E(t).$implicit,o=_(2);return S(o.editEvent(r))}),d(1),ot()}if(n&2){let t=e.$implicit;j("opacity-60",t.status==="cancelled")("line-through",t.status==="cancelled"),m(),N(" ",t.name," ")}}function xL(n,e){if(n&1&&(rt(0,"div",9)(1,"time",10),d(2),ot(),rt(3,"div",11),M(4,vL,2,1,"div",12),V(5,CL,2,5,"div",13,yL),ot()()),n&2){let t=e.$implicit;j("bg-gray-50",!t.isCurrentMonth),m(),j("text-gray-400",!t.isCurrentMonth)("bg-indigo-600",t.isToday)("text-white",t.isToday)("rounded-full",t.isToday)("w-6",t.isToday)("h-6",t.isToday)("flex",t.isToday)("items-center",t.isToday)("justify-center",t.isToday),ac("dateTime",t.date.toISOString()),m(),N(" ",t.date.getDate()," "),m(2),A(t.holiday?4:-1),m(),L(t.events)}}var Wa=class Wa{constructor(){this.holidayService=k(mp);this.router=k(Fe);this.events=cc.required();this.currentDate=D(new Date);this.holidays=D([]);this.calendarGrid=$(()=>{let e=this.events(),t=this.holidays(),i=this.currentDate(),r=i.getFullYear(),o=i.getMonth(),a=new Date(r,o,1),u=new Date(r,o+1,0),c=a.getDay(),p=new Date(a);p.setDate(a.getDate()-c);let g=[],y=new Date;y.setHours(0,0,0,0);for(let v=0;v<42;v++){let C=new Date(p);C.setDate(p.getDate()+v);let T=this.formatDate(C);g.push({date:C,isCurrentMonth:C.getMonth()===o,isToday:C.getTime()===y.getTime(),events:e.filter(R=>R.date===T),holiday:t.find(R=>R.date===T)})}return g});this.loadHolidays()}formatDate(e){let t=e.getFullYear(),i=(e.getMonth()+1).toString().padStart(2,"0"),r=e.getDate().toString().padStart(2,"0");return`${t}-${i}-${r}`}loadHolidays(){let e=this.currentDate().getFullYear();this.holidays.set(this.holidayService.getHolidays(e))}previousMonth(){this.currentDate.update(e=>{let t=new Date(e);return t.setMonth(e.getMonth()-1),t}),this.loadHolidays()}nextMonth(){this.currentDate.update(e=>{let t=new Date(e);return t.setMonth(e.getMonth()+1),t}),this.loadHolidays()}editEvent(e){this.router.navigate(["/events/edit",e.id])}};Wa.\u0275fac=function(t){return new(t||Wa)},Wa.\u0275cmp=re({type:Wa,selectors:[["app-calendar-view"]],inputs:{events:[1,"events"]},decls:13,vars:4,consts:[[1,"space-y-4"],[1,"flex","items-center","justify-between"],[1,"p-2","rounded-full","hover:bg-gray-100","transition-colors",3,"click"],["name","chevron-back-outline",1,"text-xl","text-gray-600"],[1,"text-xl","font-semibold","text-gray-800"],["name","chevron-forward-outline",1,"text-xl","text-gray-600"],[1,"grid","grid-cols-7","gap-px","bg-gray-200","border","border-gray-200","rounded-lg","overflow-hidden"],[1,"py-2","text-center","text-sm","font-medium","text-gray-600","bg-gray-50"],[1,"relative","min-h-[120px]","bg-white","p-2",3,"bg-gray-50"],[1,"relative","min-h-[120px]","bg-white","p-2"],[1,"text-sm","font-medium",3,"dateTime"],[1,"mt-2","space-y-1","overflow-hidden"],[1,"text-xs","text-red-700","bg-red-100","rounded","px-1","py-0.5","truncate","font-medium"],[1,"text-xs","text-indigo-800","bg-indigo-100","rounded","px-1","py-0.5","cursor-pointer","hover:bg-indigo-200","truncate",3,"opacity-60","line-through"],[1,"text-xs","text-indigo-800","bg-indigo-100","rounded","px-1","py-0.5","cursor-pointer","hover:bg-indigo-200","truncate",3,"click"]],template:function(t,i){t&1&&(rt(0,"div",0)(1,"div",1)(2,"button",2),xr("click",function(){return i.previousMonth()}),Ti(3,"ion-icon",3),ot(),rt(4,"h2",4),d(5),ot(),rt(6,"button",2),xr("click",function(){return i.nextMonth()}),Ti(7,"ion-icon",5),ot()(),rt(8,"div",6),V(9,_L,2,1,"div",7,Y),V(11,xL,7,23,"div",8,hL),ot()()),t&2&&(m(5),Qe(" ",i.currentDate().getFullYear(),"\u5E74 ",i.currentDate().toLocaleString("zh-TW",Ke(2,fL))," "),m(4),L(Ke(3,gL)),m(2),L(i.calendarGrid()))},dependencies:[se],encapsulation:2,changeDetection:0});var pp=Wa;var bL=(n,e)=>e.id;function EL(n,e){n&1&&(l(0,"div",26),d(1,"\u8F09\u5165\u4E2D..."),s())}function SL(n,e){if(n&1&&(l(0,"div",27),d(1),s()),n&2){let t=_(2);m(),w(t.errorMessage())}}function DL(n,e){if(n&1){let t=B();l(0,"tr",37),b("click",function(){let r=E(t).$implicit,o=_(2);return S(o.editEvent(r))}),l(1,"td",38),d(2),s(),l(3,"td",38),d(4),s(),l(5,"td",38),d(6),s(),l(7,"td",38),d(8),s(),l(9,"td",39),d(10),s(),l(11,"td",38),d(12),s(),l(13,"td",38),d(14),s(),l(15,"td",40),d(16),s(),l(17,"td",40),d(18),s(),l(19,"td",41),d(20),s(),l(21,"td",42),d(22),s()()}if(n&2){let t=e.$implicit,i=e.$index,r=_(2);j("text-gray-400",t.status==="cancelled")("line-through",t.status==="cancelled"),m(2),w((r.currentPage()-1)*r.pageSize()+i+1),m(2),w(t.type),m(2),w(r.formatDateForDisplay(t.date)),m(2),w(t.time),m(2),w(t.name),m(2),w(t.organizer),m(2),w(t.attendees),m(2),w(r.formatCurrency(t.estimatedRevenue)),m(2),w(r.formatCurrency(t.deposit)),m(2),w(r.formatCurrency(t.actualRevenue)),m(2),w(t.notes)}}function wL(n,e){n&1&&(l(0,"tr")(1,"td",43),d(2,"\u627E\u4E0D\u5230\u7B26\u5408\u689D\u4EF6\u7684\u6D3B\u52D5\u3002"),s()())}function TL(n,e){if(n&1){let t=B();l(0,"div",36)(1,"span",44),d(2),s(),l(3,"div",12)(4,"button",45),b("click",function(){E(t);let r=_(2);return S(r.prevPage())}),x(5,"ion-icon",46),s(),l(6,"span",47),d(7),s(),l(8,"button",45),b("click",function(){E(t);let r=_(2);return S(r.nextPage())}),x(9,"ion-icon",48),s()()()}if(n&2){let t=_(2);m(2),Lt(" \u986F\u793A\u7B2C ",t.totalItems()>0?(t.currentPage()-1)*t.pageSize()+1:0," \u81F3 ",t.Math.min(t.currentPage()*t.pageSize(),t.totalItems())," \u7B46\uFF0C\u5171 ",t.totalItems()," \u7B46 "),m(2),I("disabled",t.currentPage()===1),m(3),Qe("\u7B2C ",t.currentPage()," \u9801 / \u5171 ",t.totalPages()," \u9801"),m(),I("disabled",t.currentPage()===t.totalPages())}}function IL(n,e){if(n&1){let t=B();M(0,EL,2,0,"div",26),M(1,SL,2,1,"div",27),l(2,"div",28)(3,"table",29)(4,"thead",30)(5,"tr")(6,"th",31),d(7,"\u7DE8\u865F"),s(),l(8,"th",32),b("click",function(){E(t);let r=_();return S(r.sortData("type"))}),d(9,"\u985E\u578B "),x(10,"ion-icon",33),s(),l(11,"th",32),b("click",function(){E(t);let r=_();return S(r.sortData("date"))}),d(12,"\u65E5\u671F "),x(13,"ion-icon",33),s(),l(14,"th",32),b("click",function(){E(t);let r=_();return S(r.sortData("time"))}),d(15,"\u6642\u9593 "),x(16,"ion-icon",33),s(),l(17,"th",32),b("click",function(){E(t);let r=_();return S(r.sortData("name"))}),d(18,"\u540D\u7A31 "),x(19,"ion-icon",33),s(),l(20,"th",32),b("click",function(){E(t);let r=_();return S(r.sortData("organizer"))}),d(21,"\u4ECB\u7D39\u4EBA "),x(22,"ion-icon",33),s(),l(23,"th",32),b("click",function(){E(t);let r=_();return S(r.sortData("attendees"))}),d(24,"\u4EBA\u6578 "),x(25,"ion-icon",33),s(),l(26,"th",34),b("click",function(){E(t);let r=_();return S(r.sortData("estimatedRevenue"))}),d(27,"\u9810\u8A08\u6536\u5165 "),x(28,"ion-icon",33),s(),l(29,"th",34),b("click",function(){E(t);let r=_();return S(r.sortData("deposit"))}),d(30,"\u8A02\u91D1 "),x(31,"ion-icon",33),s(),l(32,"th",34),b("click",function(){E(t);let r=_();return S(r.sortData("actualRevenue"))}),d(33,"\u5BE6\u969B\u6536\u5165 "),x(34,"ion-icon",33),s(),l(35,"th",32),b("click",function(){E(t);let r=_();return S(r.sortData("notes"))}),d(36,"\u5099\u8A3B "),x(37,"ion-icon",33),s()()(),l(38,"tbody"),V(39,DL,23,15,"tr",35,bL,!1,wL,3,0,"tr"),s()()(),M(42,TL,10,7,"div",36)}if(n&2){let t=_();A(t.isLoading()?0:-1),m(),A(t.errorMessage()?1:-1),m(38),L(t.paginatedEvents()),m(3),A(t.totalPages()>0?42:-1)}}function ML(n,e){if(n&1&&x(0,"app-calendar-view",25),n&2){let t=_();I("events",t.filteredEvents())}}var ja=class ja{constructor(){this.apiService=k(we);this.router=k(Fe);this.allEvents=D([]);this.isLoading=D(!1);this.errorMessage=D(null);this.searchTerm=D("");this.activeView=D("list");this.selectedStartDate=D("");this.selectedEndDate=D("");this.appliedFilters=D({startDate:"",endDate:""});this.currentPage=D(1);this.pageSize=D(10);this.totalItems=D(0);this.totalPages=D(0);this.Math=Math;this.sortColumn=D("date");this.sortDirection=D("desc");this.filteredEvents=$(()=>this.allEvents());this.paginatedEvents=$(()=>this.filteredEvents());this.eventsSummary=$(()=>{let t=this.filteredEvents().filter(a=>a.status==="active"),i=t.reduce((a,u)=>a+u.estimatedRevenue,0),r=t.reduce((a,u)=>a+u.actualRevenue,0),o=r/2e5*100;return{estimatedRevenue:i,actualRevenue:r,targetRevenue:2e5,achievementRate:o}});this.initializeMonthDateRange(),this.applyFilter()}initializeMonthDateRange(){let e=new Date,t=new Date(e.getFullYear(),e.getMonth(),1),i=new Date(e.getFullYear(),e.getMonth()+1,0);this.selectedStartDate.set(this.formatDateForInput(t)),this.selectedEndDate.set(this.formatDateForInput(i))}formatDateForInput(e){let t=e.getFullYear(),i=String(e.getMonth()+1).padStart(2,"0"),r=String(e.getDate()).padStart(2,"0");return`${t}-${i}-${r}`}async loadEvents(e=this.currentPage()){this.isLoading.set(!0),this.errorMessage.set(null);try{let t=await this.apiService.getEvents({startDate:this.appliedFilters().startDate,endDate:this.appliedFilters().endDate,search:this.searchTerm(),page:e,limit:this.pageSize(),sortBy:this.sortColumn(),sortOrder:this.sortDirection()});t.success&&t.data?(this.allEvents.set(t.data),this.currentPage.set(t.pagination?.page||e),this.totalItems.set(t.pagination?.total||t.data.length),this.totalPages.set(t.pagination?.totalPages||0)):(this.allEvents.set([]),this.totalItems.set(0),this.totalPages.set(0),this.errorMessage.set(t.error||"\u8F09\u5165\u6D3B\u52D5\u8CC7\u6599\u5931\u6557"))}catch(t){console.error("Failed to load events:",t),this.allEvents.set([]),this.totalItems.set(0),this.totalPages.set(0),this.errorMessage.set(t?.error?.error||"\u8F09\u5165\u6D3B\u52D5\u8CC7\u6599\u5931\u6557\uFF0C\u8ACB\u7A0D\u5F8C\u518D\u8A66")}finally{this.isLoading.set(!1)}}applyFilter(){if(!this.selectedStartDate()||!this.selectedEndDate()){this.errorMessage.set("\u8ACB\u9078\u64C7\u5B8C\u6574\u7684\u8D77\u8A16\u65E5\u671F");return}if(this.selectedStartDate()>this.selectedEndDate()){this.errorMessage.set("\u958B\u59CB\u65E5\u671F\u4E0D\u53EF\u665A\u65BC\u7D50\u675F\u65E5\u671F");return}this.appliedFilters.set({startDate:this.selectedStartDate(),endDate:this.selectedEndDate()}),this.loadEvents(1)}resetFilter(){this.initializeMonthDateRange(),this.searchTerm.set(""),this.applyFilter()}onSearchChange(e){this.searchTerm.set(e),this.loadEvents(1)}sortData(e){this.sortColumn()===e?this.sortDirection.update(t=>t==="asc"?"desc":"asc"):(this.sortColumn.set(e),this.sortDirection.set("asc")),this.loadEvents(1)}goToPage(e){e>=1&&e<=this.totalPages()&&this.loadEvents(e)}nextPage(){this.goToPage(this.currentPage()+1)}prevPage(){this.goToPage(this.currentPage()-1)}editEvent(e){this.router.navigate(["/events/edit",e.id])}formatDateForDisplay(e){let t=new Date(e),i=t.getMonth()+1,r=t.getDate(),o=["\u65E5","\u4E00","\u4E8C","\u4E09","\u56DB","\u4E94","\u516D"][t.getDay()];return`${i}/${r} (${o})`}formatCurrency(e){return e==null?"":e.toLocaleString("zh-TW",{style:"currency",currency:"TWD",minimumFractionDigits:0})}setView(e){this.activeView.set(e)}};ja.\u0275fac=function(t){return new(t||ja)},ja.\u0275cmp=re({type:ja,selectors:[["app-events"]],decls:53,vars:32,consts:[[1,"space-y-6"],[1,"flex","flex-wrap","items-center","justify-between","gap-4"],[1,"text-3xl","font-bold","text-gray-900"],["routerLink","/events/new",1,"bg-indigo-600","text-white","px-4","py-2","rounded-lg","font-medium","hover:bg-indigo-700","transition-colors","flex","items-center","gap-2","text-sm"],["name","add-outline"],[1,"grid","grid-cols-1","sm:grid-cols-2","lg:grid-cols-4","gap-6"],[1,"bg-white","p-6","rounded-xl","shadow-md"],[1,"text-sm","text-gray-500"],[1,"text-2xl","font-semibold","text-gray-900"],[1,"text-2xl","font-semibold"],[1,"flex","flex-wrap","justify-between","items-center","gap-4","mb-4","border-b","pb-4"],[1,"flex","flex-wrap","items-center","gap-4"],[1,"flex","items-center","gap-2"],[1,"text-sm","font-medium","text-gray-600","shrink-0"],["type","date",1,"border-gray-300","rounded-lg","shadow-sm","focus:ring-indigo-500","focus:border-indigo-500","text-sm","p-2","bg-gray-50",3,"ngModelChange","ngModel"],[1,"text-gray-500","text-sm"],[1,"bg-indigo-600","text-white","px-3","py-2","rounded-lg","font-medium","hover:bg-indigo-700","transition-colors","flex","items-center","gap-1","text-sm",3,"click"],["name","filter-outline"],["title","\u91CD\u8A2D\u7BE9\u9078",1,"text-gray-500","hover:text-gray-800","transition-colors","p-2","rounded-full","bg-gray-100","hover:bg-gray-200",3,"click"],["name","refresh-outline",1,"text-xl"],["type","text","placeholder","\u4F9D\u6D3B\u52D5\u540D\u7A31\u6216\u65E5\u671F\u641C\u5C0B...",1,"w-full","sm:w-auto","flex-grow","border-gray-300","rounded-lg","shadow-sm","focus:ring-indigo-500","focus:border-indigo-500","text-sm","p-2","bg-white",3,"ngModelChange","ngModel"],[1,"flex","items-center","border","border-gray-200","rounded-lg","p-1","space-x-1","bg-gray-50","shrink-0"],[1,"px-3","py-1","text-sm","font-medium","rounded-md","transition-colors","flex","items-center","gap-2",3,"click"],["name","list-outline"],["name","calendar-outline"],[3,"events"],[1,"text-center","py-8","text-gray-500"],[1,"mb-4","rounded-lg","border","border-red-200","bg-red-50","px-4","py-3","text-sm","text-red-700"],[1,"overflow-x-auto"],[1,"w-full","text-sm","text-left","whitespace-nowrap"],[1,"text-xs","text-gray-700","uppercase","bg-gray-100"],[1,"px-4","py-3"],[1,"px-4","py-3","cursor-pointer",3,"click"],["name","swap-vertical-outline"],[1,"px-4","py-3","cursor-pointer","text-right",3,"click"],[1,"border-b","hover:bg-gray-50","cursor-pointer",3,"text-gray-400","line-through"],[1,"flex","justify-between","items-center","pt-4","border-t","mt-4"],[1,"border-b","hover:bg-gray-50","cursor-pointer",3,"click"],[1,"px-4","py-2"],[1,"px-4","py-2","font-medium"],[1,"px-4","py-2","text-right"],[1,"px-4","py-2","text-right","font-semibold"],[1,"px-4","py-2","truncate","max-w-xs"],["colspan","11",1,"text-center","py-8","text-gray-500"],[1,"text-sm","text-gray-600"],[1,"px-3","py-1","border","rounded-md","disabled:opacity-50","disabled:cursor-not-allowed",3,"click","disabled"],["name","chevron-back-outline"],[1,"text-sm"],["name","chevron-forward-outline"]],template:function(t,i){t&1&&(l(0,"div",0)(1,"div",1)(2,"h1",2),d(3,"\u6D3B\u52D5\u7BA1\u7406"),s(),l(4,"a",3),x(5,"ion-icon",4),l(6,"span"),d(7,"\u65B0\u589E\u6D3B\u52D5"),s()()(),l(8,"div",5)(9,"div",6)(10,"p",7),d(11,"\u9810\u8A08\u7E3D\u6536\u5165"),s(),l(12,"p",8),d(13),s()(),l(14,"div",6)(15,"p",7),d(16,"\u5BE6\u969B\u7E3D\u6536\u5165"),s(),l(17,"p",8),d(18),s()(),l(19,"div",6)(20,"p",7),d(21,"\u76EE\u6A19\u6536\u5165"),s(),l(22,"p",8),d(23),s()(),l(24,"div",6)(25,"p",7),d(26,"\u76EE\u6A19\u9054\u6210\u7387"),s(),l(27,"p",9),d(28),s()()(),l(29,"div",6)(30,"div",10)(31,"div",11)(32,"div",12)(33,"label",13),d(34,"\u6642\u9593:"),s(),l(35,"input",14),K("ngModelChange",function(o){return Q(i.selectedStartDate,o)||(i.selectedStartDate=o),o}),s(),l(36,"span",15),d(37,"\u81F3"),s(),l(38,"input",14),K("ngModelChange",function(o){return Q(i.selectedEndDate,o)||(i.selectedEndDate=o),o}),s(),l(39,"button",16),b("click",function(){return i.applyFilter()}),x(40,"ion-icon",17),s(),l(41,"button",18),b("click",function(){return i.resetFilter()}),x(42,"ion-icon",19),s()(),l(43,"input",20),b("ngModelChange",function(o){return i.onSearchChange(o)}),s()(),l(44,"div",21)(45,"button",22),b("click",function(){return i.setView("list")}),x(46,"ion-icon",23),d(47," \u5217\u8868 "),s(),l(48,"button",22),b("click",function(){return i.setView("calendar")}),x(49,"ion-icon",24),d(50," \u65E5\u66C6 "),s()()(),M(51,IL,43,4)(52,ML,1,1,"app-calendar-view",25),s()()),t&2&&(m(13),w(i.formatCurrency(i.eventsSummary().estimatedRevenue)),m(5),w(i.formatCurrency(i.eventsSummary().actualRevenue)),m(5),w(i.formatCurrency(i.eventsSummary().targetRevenue)),m(4),j("text-green-600",i.eventsSummary().achievementRate>=100)("text-red-600",i.eventsSummary().achievementRate<100),m(),N(" ",i.eventsSummary().achievementRate.toFixed(1),"% "),m(7),J("ngModel",i.selectedStartDate),m(3),J("ngModel",i.selectedEndDate),m(5),I("ngModel",i.searchTerm()),m(2),j("bg-white",i.activeView()==="list")("shadow-sm",i.activeView()==="list")("text-indigo-600",i.activeView()==="list")("text-gray-600",i.activeView()!=="list")("hover:bg-gray-200",i.activeView()!=="list"),m(3),j("bg-white",i.activeView()==="calendar")("shadow-sm",i.activeView()==="calendar")("text-indigo-600",i.activeView()==="calendar")("text-gray-600",i.activeView()!=="calendar")("hover:bg-gray-200",i.activeView()!=="calendar"),m(3),A(i.activeView()==="list"?51:52))},dependencies:[se,De,be,fe,Ie,wr,pp],encapsulation:2,changeDetection:0});var fp=ja;function AL(n,e){if(n&1&&(l(0,"option",12),d(1),s()),n&2){let t=e.$implicit;I("value",t),m(),w(t)}}function RL(n,e){if(n&1&&(l(0,"option",12),d(1),s()),n&2){let t=e.$implicit;I("value",t),m(),w(t)}}function NL(n,e){if(n&1){let t=B();l(0,"button",39),b("click",function(){E(t);let r=_();return S(r.onDelete())}),d(1," \u522A\u9664\u6D3B\u52D5 "),s()}}var za=class za{constructor(){this.fb=k(qe);this.apiService=k(we);this.router=k(Fe);this.route=k(mn);this.isEditMode=D(!1);this.eventId=D(null);this.submitted=D(!1);this.isSaving=D(!1);this.eventTypeOptions=["\u5916\u5BA2","\u80A1\u6771\u4ECB\u7D39","\u5E97\u5167\u6D3B\u52D5","\u80A1\u6771\u6703","\u5916\u71F4"];this.useSpaceOptions=["D1","D2","D3","\u5916\u71F4"];this.eventForm=this.fb.group({type:[""],status:["active"],useSpace:["D1"],date:["",U.required],time:[""],name:["",U.required],organizer:[""],attendees:[""],estimatedRevenue:[null,[U.min(0)]],deposit:[null],actualRevenue:[null,[U.min(0)]],notes:[""]});this.route.paramMap.pipe(ve(e=>e.get("id")),lt(e=>{this.isEditMode.set(!!e),this.eventId.set(e)}),vt(e=>!!e),lt(async e=>{try{let t=await this.apiService.getEventById(e);t.success&&t.data?this.eventForm.patchValue(t.data):(alert("\u627E\u4E0D\u5230\u6D3B\u52D5\uFF01"),this.router.navigate(["/events"]))}catch{alert("\u627E\u4E0D\u5230\u6D3B\u52D5\uFF01"),this.router.navigate(["/events"])}})).subscribe()}isInvalid(e){let t=this.eventForm.get(e);return!!t&&t.invalid&&(t.touched||this.submitted())}async onSubmit(){if(this.isSaving())return;if(this.submitted.set(!0),this.eventForm.invalid){alert("\u8ACB\u6AA2\u67E5\u8868\u55AE\uFF0C\u50C5\u6D3B\u52D5\u540D\u7A31\u8207\u65E5\u671F\u70BA\u5FC5\u586B\u3002");return}this.isSaving.set(!0);let e=this.eventForm.getRawValue(),t=G(O({},e),{type:e.type||"",status:e.status||"active",useSpace:e.useSpace||"D1",date:e.date||"",name:e.name||"",attendees:e.attendees||"",estimatedRevenue:e.estimatedRevenue??0,actualRevenue:e.actualRevenue??0,deposit:e.deposit??void 0,organizer:e.organizer||void 0,time:e.time||void 0,notes:e.notes||void 0});try{if(this.isEditMode()&&this.eventId()){let i=await this.apiService.updateEvent(this.eventId(),{type:e.type||void 0,status:e.status||"active",useSpace:e.useSpace||"D1",date:e.date||"",time:e.time||void 0,name:e.name||"",organizer:e.organizer||void 0,attendees:e.attendees||void 0,estimatedRevenue:e.estimatedRevenue,deposit:e.deposit,actualRevenue:e.actualRevenue,notes:e.notes||void 0});if(!i.success){alert(i.error||"\u6D3B\u52D5\u66F4\u65B0\u5931\u6557\uFF0C\u8ACB\u7A0D\u5F8C\u518D\u8A66\u3002");return}alert("\u6D3B\u52D5\u5DF2\u6210\u529F\u66F4\u65B0\uFF01")}else{let i=await this.apiService.createEvent({type:e.type||void 0,status:e.status||"active",useSpace:e.useSpace||"D1",date:e.date||"",time:e.time||void 0,name:e.name||"",organizer:e.organizer||void 0,attendees:e.attendees||void 0,estimatedRevenue:e.estimatedRevenue,deposit:e.deposit,actualRevenue:e.actualRevenue,notes:e.notes||void 0});if(!i.success){alert(i.error||"\u6D3B\u52D5\u65B0\u589E\u5931\u6557\uFF0C\u8ACB\u7A0D\u5F8C\u518D\u8A66\u3002");return}alert("\u6D3B\u52D5\u5DF2\u6210\u529F\u65B0\u589E\uFF01")}this.router.navigate(["/events"])}catch(i){console.error("Create event failed:",i);let r=i?.error?.error||i?.message||"\u6D3B\u52D5\u65B0\u589E\u5931\u6557\uFF0C\u8ACB\u6AA2\u67E5\u7DB2\u8DEF\u6216\u7A0D\u5F8C\u518D\u8A66\u3002";alert(r)}finally{this.isSaving.set(!1)}}async onDelete(){if(this.isEditMode()&&this.eventId()&&confirm("\u60A8\u78BA\u5B9A\u8981\u522A\u9664\u6B64\u6D3B\u52D5\u55CE\uFF1F\u6B64\u64CD\u4F5C\u7121\u6CD5\u5FA9\u539F\u3002")){try{let e=await this.apiService.deleteEvent(this.eventId());if(!e.success){alert(e.error||"\u6D3B\u52D5\u522A\u9664\u5931\u6557\uFF0C\u8ACB\u7A0D\u5F8C\u518D\u8A66\u3002");return}}catch{alert("\u6D3B\u52D5\u522A\u9664\u5931\u6557\uFF0C\u8ACB\u7A0D\u5F8C\u518D\u8A66\u3002");return}alert("\u6D3B\u52D5\u5DF2\u522A\u9664\u3002"),this.router.navigate(["/events"])}}onCancel(){this.router.navigate(["/events"])}};za.\u0275fac=function(t){return new(t||za)},za.\u0275cmp=re({type:za,selectors:[["app-event-form"]],decls:71,vars:13,consts:[[1,"space-y-6","max-w-4xl","mx-auto"],[1,"text-3xl","font-bold","text-gray-900"],[1,"bg-white","p-6","md:p-8","rounded-xl","shadow-md"],["novalidate","",1,"space-y-6",3,"ngSubmit","formGroup"],[1,"grid","grid-cols-1","md:grid-cols-2","gap-x-6","gap-y-4"],[1,"md:col-span-2"],["for","name",1,"block","text-sm","font-medium","text-gray-700"],["type","text","id","name","formControlName","name",1,"mt-1","block","w-full","border","bg-gray-50","rounded-md","shadow-sm","p-2"],["for","date",1,"block","text-sm","font-medium","text-gray-700"],["type","date","id","date","formControlName","date",1,"mt-1","block","w-full","border","bg-gray-50","rounded-md","shadow-sm","p-2"],["for","useSpace",1,"block","text-sm","font-medium","text-gray-700"],["id","useSpace","formControlName","useSpace",1,"mt-1","block","w-full","border","bg-gray-50","rounded-md","shadow-sm","p-2"],[3,"value"],["for","time",1,"block","text-sm","font-medium","text-gray-700"],["type","text","id","time","formControlName","time","placeholder","\u4F8B\u5982: 14:30~18:30",1,"mt-1","block","w-full","border","bg-gray-50","rounded-md","shadow-sm","p-2"],["for","type",1,"block","text-sm","font-medium","text-gray-700"],["id","type","formControlName","type",1,"mt-1","block","w-full","border","bg-gray-50","rounded-md","shadow-sm","p-2"],["value",""],["for","attendees",1,"block","text-sm","font-medium","text-gray-700"],["type","text","id","attendees","formControlName","attendees","placeholder","\u4F8B\u5982: 10~15",1,"mt-1","block","w-full","border","bg-gray-50","rounded-md","shadow-sm","p-2"],["for","organizer",1,"block","text-sm","font-medium","text-gray-700"],["type","text","id","organizer","formControlName","organizer",1,"mt-1","block","w-full","border","bg-gray-50","rounded-md","shadow-sm","p-2"],["for","estimatedRevenue",1,"block","text-sm","font-medium","text-gray-700"],["type","number","id","estimatedRevenue","formControlName","estimatedRevenue",1,"mt-1","block","w-full","border","bg-gray-50","rounded-md","shadow-sm","p-2"],["for","deposit",1,"block","text-sm","font-medium","text-gray-700"],["type","number","id","deposit","formControlName","deposit",1,"mt-1","block","w-full","border","bg-gray-50","rounded-md","shadow-sm","p-2"],["for","actualRevenue",1,"block","text-sm","font-medium","text-gray-700"],["type","number","id","actualRevenue","formControlName","actualRevenue",1,"mt-1","block","w-full","border","bg-gray-50","rounded-md","shadow-sm","p-2"],["for","status",1,"block","text-sm","font-medium","text-gray-700"],["id","status","formControlName","status",1,"mt-1","block","w-full","border","bg-gray-50","rounded-md","shadow-sm","p-2"],["value","active"],["value","cancelled"],["for","notes",1,"block","text-sm","font-medium","text-gray-700"],["id","notes","formControlName","notes","rows","4",1,"mt-1","block","w-full","border","bg-gray-50","rounded-md","shadow-sm","p-2"],[1,"flex","items-center","justify-end","gap-4","pt-4","border-t","mt-6"],["type","button",1,"px-4","py-2","text-sm","font-medium","text-red-600","bg-transparent","hover:bg-red-50","rounded-md"],[1,"flex-grow"],["type","button",1,"px-4","py-2","border","border-gray-300","rounded-md","shadow-sm","text-sm","font-medium","text-gray-700","bg-white","hover:bg-gray-50",3,"click"],["type","submit",1,"px-4","py-2","border","border-transparent","rounded-md","shadow-sm","text-sm","font-medium","text-white","bg-indigo-600","hover:bg-indigo-700","disabled:opacity-60","disabled:cursor-not-allowed",3,"disabled"],["type","button",1,"px-4","py-2","text-sm","font-medium","text-red-600","bg-transparent","hover:bg-red-50","rounded-md",3,"click"]],template:function(t,i){t&1&&(l(0,"div",0)(1,"h1",1),d(2),s(),l(3,"div",2)(4,"form",3),b("ngSubmit",function(){return i.onSubmit()}),l(5,"div",4)(6,"div",5)(7,"label",6),d(8,"\u6D3B\u52D5\u540D\u7A31*"),s(),x(9,"input",7),s(),l(10,"div")(11,"label",8),d(12,"\u65E5\u671F*"),s(),x(13,"input",9),s(),l(14,"div")(15,"label",10),d(16,"\u4F7F\u7528\u7A7A\u9593"),s(),l(17,"select",11),V(18,AL,2,2,"option",12,Y),s()(),l(20,"div")(21,"label",13),d(22,"\u6642\u9593"),s(),x(23,"input",14),s(),l(24,"div")(25,"label",15),d(26,"\u985E\u578B"),s(),l(27,"select",16)(28,"option",17),d(29,"\u8ACB\u9078\u64C7"),s(),V(30,RL,2,2,"option",12,Y),s()(),l(32,"div")(33,"label",18),d(34,"\u4EBA\u6578"),s(),x(35,"input",19),s(),l(36,"div",5)(37,"label",20),d(38,"\u4ECB\u7D39\u4EBA"),s(),x(39,"input",21),s(),l(40,"div")(41,"label",22),d(42,"\u9810\u8A08\u5831\u540D\u6536\u5165"),s(),x(43,"input",23),s(),l(44,"div")(45,"label",24),d(46,"\u8A02\u91D1"),s(),x(47,"input",25),s(),l(48,"div")(49,"label",26),d(50,"\u5BE6\u969B\u7E3D\u6536\u5165"),s(),x(51,"input",27),s(),l(52,"div")(53,"label",28),d(54,"\u72C0\u614B"),s(),l(55,"select",29)(56,"option",30),d(57,"\u9032\u884C\u4E2D"),s(),l(58,"option",31),d(59,"\u5DF2\u53D6\u6D88"),s()()(),l(60,"div",5)(61,"label",32),d(62,"\u5099\u8A3B"),s(),x(63,"textarea",33),s()(),l(64,"div",34),M(65,NL,2,0,"button",35),x(66,"div",36),l(67,"button",37),b("click",function(){return i.onCancel()}),d(68," \u53D6\u6D88 "),s(),l(69,"button",38),d(70),s()()()()()),t&2&&(m(2),N(" ",i.isEditMode()?"\u7DE8\u8F2F\u6D3B\u52D5":"\u65B0\u589E\u6D3B\u52D5"," "),m(2),I("formGroup",i.eventForm),m(5),j("border-red-500",i.isInvalid("name")),m(4),j("border-red-500",i.isInvalid("date")),m(5),L(i.useSpaceOptions),m(12),L(i.eventTypeOptions),m(13),j("border-red-500",i.isInvalid("estimatedRevenue")),m(8),j("border-red-500",i.isInvalid("actualRevenue")),m(14),A(i.isEditMode()?65:-1),m(4),I("disabled",i.isSaving()),m(),N(" ",i.isSaving()?"\u5132\u5B58\u4E2D...":i.isEditMode()?"\u5132\u5B58\u8B8A\u66F4":"\u5132\u5B58\u6D3B\u52D5"," "))},dependencies:[se,Be,Ve,He,Ge,be,Bt,Oe,fe,ke,Le,Ue],encapsulation:2,changeDetection:0});var au=za;var FL=["dailyRevenueChart"],PL=(n,e)=>e.transactionDate;function kL(n,e){if(n&1&&(l(0,"option",8),d(1),s()),n&2){let t=e.$implicit;I("value",t),m(),N("",t,"\u5E74")}}function VL(n,e){if(n&1&&(l(0,"option",8),d(1),s()),n&2){let t=e.$implicit;I("value",t),m(),N("",t,"\u6708")}}function LL(n,e){if(n&1&&(l(0,"div",14),x(1,"ion-icon",16),l(2,"span"),d(3),s()()),n&2){let t=_();m(3),w(t.errorMessage())}}function OL(n,e){n&1&&(l(0,"div",15),x(1,"div",17),s())}function BL(n,e){if(n&1&&d(0),n&2){let t=_().$implicit,i=_(2);N(" ",i.formatCurrency(t.debitAmount)," ")}}function UL(n,e){if(n&1&&d(0),n&2){let t=_().$implicit,i=_(2);N(" ",i.formatCurrency(t.creditAmount)," ")}}function $L(n,e){n&1&&d(0," \u516C\u4F11\u65E5 ")}function HL(n,e){n&1&&d(0," 0 ")}function GL(n,e){if(n&1&&M(0,$L,1,0)(1,HL,1,0),n&2){let t=_().$implicit,i=_(2);A(i.isClosedDay(t.transactionDate,!1)?0:1)}}function qL(n,e){if(n&1&&(l(0,"tr",33)(1,"td",34),d(2),s(),l(3,"td",35),M(4,BL,1,1)(5,UL,1,1)(6,GL,2,1),s()()),n&2){let t=e.$implicit,i=_(2);m(2),w(i.formatDate(t.transactionDate)),m(2),A(t.debitAmount>0?4:t.creditAmount>0?5:6)}}function WL(n,e){n&1&&(l(0,"tr")(1,"td",36),d(2,"\u627E\u4E0D\u5230\u8A72\u6708\u4EFD\u7684\u92B7\u8CA8\u6536\u5165\u8CC7\u6599\u3002"),s()())}function jL(n,e){if(n&1&&(l(0,"div",18)(1,"div",19)(2,"p",20),d(3,"\u6708\u71DF\u6536\u76EE\u6A19"),s(),l(4,"p",21),d(5),s()(),l(6,"div",19)(7,"p",20),d(8,"\u6BCF\u65E5\u5E73\u5747\u76EE\u6A19"),s(),l(9,"p",21),d(10),s()(),l(11,"div",19)(12,"p",20),d(13,"\u76EE\u6A19\u5DEE\u984D"),s(),l(14,"p",22),d(15),s()(),l(16,"div",19)(17,"p",20),d(18,"\u672C\u6708\u7D2F\u8A08\u71DF\u6536"),s(),l(19,"p",21),d(20),s()(),l(21,"div",19)(22,"p",20),d(23,"\u6708\u71DF\u6536\u76EE\u6A19\u9054\u6210\u7387"),s(),l(24,"p",22),d(25),s()()(),l(26,"div",23)(27,"h3",24),d(28,"\u6BCF\u65E5\u71DF\u6536\u8DA8\u52E2"),s(),l(29,"div",25),x(30,"canvas",null,0),s()(),l(32,"div",23)(33,"h3",24),d(34,"\u7576\u65E5\u71DF\u6536\u660E\u7D30"),s(),l(35,"div",26),x(36,"ion-icon",27),d(37," \u9019\u500B\u8868\u683C\u986F\u793A\u6240\u9078\u64C7\u7684\u6708\u4EFD\u4E2D\uFF0C\u5F9E\u6D41\u6C34\u5E33\u6578\u64DA\u8868\u62C9\u53D6\u7684\u6240\u6709\u7B97\u7B26\u540D\u7A31\u70BA\u300C\u92B7\u8CA8\u6536\u5165\u300D\u7684\u4EA4\u6613\u7D00\u9304\uFF0C\u4E26\u4F9D\u7167\u4EA4\u6613\u6642\u9593\u5347\u5E8F\u6392\u5217\u3002 "),s(),l(38,"div",28)(39,"table",29)(40,"thead",30)(41,"tr")(42,"th",31),d(43,"\u4EA4\u6613\u65E5\u671F"),s(),l(44,"th",32),d(45,"\u91D1\u984D"),s()()(),l(46,"tbody"),V(47,qL,7,2,"tr",33,PL,!1,WL,3,0,"tr"),s()()()()),n&2){let t=_();m(5),w(t.formatCurrency(t.summary().monthlyRevenueTarget)),m(5),w(t.formatCurrency(t.summary().dailyAverageTarget)),m(4),j("text-red-600",t.summary().targetDeficit<0)("text-green-600",t.summary().targetDeficit>=0),m(),N(" ",t.formatCurrency(t.summary().targetDeficit)," "),m(5),w(t.formatCurrency(t.summary().cumulativeMonthlyRevenue)),m(4),j("text-green-600",t.summary().monthlyTargetAchievementRate>=100)("text-red-600",t.summary().monthlyTargetAchievementRate<100),m(),N(" ",t.summary().monthlyTargetAchievementRate.toFixed(2),"% "),m(22),L(t.ledgerDetails())}}var Ya=class Ya{constructor(){this.apiService=k(we);this.router=k(Fe);this.monthlyTargetData=D(null);this.monthlyRevenueTarget=28e4;this.availableYears=D([2024,2025,2026]);this.availableMonths=D(Array.from({length:12},(e,t)=>t+1));this.selectedYear=D(new Date().getFullYear());this.selectedMonth=D(new Date().getMonth()+1);this.monthlyData=D(null);this.ledgerDetails=D([]);this.isLoading=D(!1);this.errorMessage=D(null);this.reportData=$(()=>{let e=this.monthlyData();if(!e)return[];let i=this.monthlyTargetData()?.monthlyRevenueTarget||this.monthlyRevenueTarget,r=e.dailyReports.filter(a=>a.totalRevenue>0).length,o=r>0?i/r:0;return e.dailyReports.map(a=>({day:a.day,date:a.date,isDayOff:a.totalRevenue===0&&a.recordCount===0,totalDailyRevenue:a.totalRevenue,dailyAchievementRate:o>0?a.totalRevenue/o*100:0,cancelledInvoiceCount:a.cancelledInvoiceCount,shortAmount:a.shortAmount,recordCount:a.recordCount}))});this.dailyRevenueFromLedger=$(()=>{let e=this.ledgerDetails(),t=new Map;return console.log("\u6B63\u5728\u8A08\u7B97\u6BCF\u65E5\u71DF\u6536\uFF0C\u6D41\u6C34\u5E33\u7B46\u6578:",e.length),e.forEach((i,r)=>{let o=i.transactionDate;if(!o)return;if(!/^\d{4}-\d{2}-\d{2}$/.test(o)){let c=new Date(o);if(isNaN(c.getTime())){console.warn("\u7121\u6CD5\u89E3\u6790\u65E5\u671F:",i.transactionDate);return}else{let p=c.getFullYear(),g=String(c.getMonth()+1).padStart(2,"0"),y=String(c.getDate()).padStart(2,"0");o=`${p}-${g}-${y}`}}let a=Number(i.debitAmount)>0?Number(i.debitAmount):Number(i.creditAmount);r<5&&console.log(`\u6D41\u6C34\u5E33[${r}]`,{originalDate:i.transactionDate,normalizedDate:o,debitAmount:i.debitAmount,creditAmount:i.creditAmount,calculatedAmount:a});let u=t.get(o)||0;t.set(o,u+a)}),console.log("\u6BCF\u65E5\u71DF\u6536Map:",{size:t.size,sample:Array.from(t.entries()).slice(0,10),total:Array.from(t.values()).reduce((i,r)=>i+r,0)}),t});this.chartData=$(()=>{let e=this.dailyRevenueFromLedger(),t=this.selectedYear(),i=this.selectedMonth(),o=this.monthlyTargetData()?.monthlyRevenueTarget||this.monthlyRevenueTarget,a=new Date(t,i,0).getDate(),u=Array.from(e.values()).filter(g=>g>0).length,c=u>0?o/u:0;console.log("\u69CB\u5EFA\u5716\u8868\u6578\u64DA:",{year:t,month:i,lastDay:a,revenueMapSize:e.size,revenueMapEntries:Array.from(e.entries()).slice(0,10),workingDays:u,dailyAverageTarget:c});let p=[];for(let g=1;g<=a;g++){let y=`${t}-${String(i).padStart(2,"0")}-${String(g).padStart(2,"0")}`,v=e.get(y)||0;p.push({day:g,date:y,isDayOff:v===0,totalDailyRevenue:v,dailyAchievementRate:c>0?v/c*100:0,cancelledInvoiceCount:0,shortAmount:0,recordCount:v>0?1:0})}return console.log("\u5716\u8868\u6578\u64DA\u69CB\u5EFA\u5B8C\u6210:",{totalDays:p.length,daysWithRevenue:p.filter(g=>g.totalDailyRevenue>0).length,sampleData:p.slice(0,5)}),p});this.summary=$(()=>{let e=this.chartData(),t=this.monthlyTargetData(),i=this.ledgerDetails(),r=t?.monthlyRevenueTarget||this.monthlyRevenueTarget,o=t?.dailyAvgTarget||0,a=i.reduce((p,g)=>{let y=Number(g.debitAmount)>0?Number(g.debitAmount):Number(g.creditAmount);return p+y},0),u=a-r,c=r>0?a/r*100:0;return{monthlyRevenueTarget:r,dailyAverageTarget:o,targetDeficit:u,cumulativeMonthlyRevenue:a,monthlyTargetAchievementRate:c,totalCancelledInvoices:e.reduce((p,g)=>p+g.cancelledInvoiceCount,0),totalShortAmount:e.reduce((p,g)=>p+g.shortAmount,0)}});this.loadData()}set dailyRevenueChartRef(e){this.destroyChart(),e&&this.chartData().length>0&&this.createChart(e)}async loadData(){this.isLoading.set(!0),this.errorMessage.set(null);try{let e=this.selectedYear(),t=this.selectedMonth(),i=String(e),r=String(t).padStart(2,"0"),o=`${i}-${r}-01`,a=new Date(e,t,0).getDate(),u=`${i}-${r}-${String(a).padStart(2,"0")}`,[c,p,g]=await Promise.all([this.apiService.getMonthlyRevenue(e,t),this.apiService.getMonthlyTargets({startMonth:`${i}-${r}`,endMonth:`${i}-${r}`}),this.apiService.getLedgerEntries({startDate:o,endDate:u,subjectName:"\u92B7\u8CA8\u6536\u5165",sortBy:"entry_date",sortOrder:"asc"})]);if(this.monthlyData.set(c),p.success&&p.data&&p.data.length>0){let y=p.data[0];this.monthlyTargetData.set({targetId:y.targetId,targetMonth:y.targetMonth,monthlyRevenueTarget:y.monthlyRevenueTarget,eventRevenueTarget:y.eventRevenueTarget,totalTarget:y.totalTarget,dailyAvgTarget:y.dailyAvgTarget,remark:y.remark}),console.log("\u2713 \u6708\u5EA6\u71DF\u6536\u76EE\u6A19\u5DF2\u8F09\u5165:",y)}else console.warn("\u26A0 \u8A72\u6708\u4EFD\u672A\u8A2D\u5B9A\u71DF\u6536\u76EE\u6A19\uFF0C\u5C07\u4F7F\u7528\u7CFB\u7D71\u9810\u8A2D\u503C"),this.monthlyTargetData.set(null);console.log("\u6B63\u5728\u8F09\u5165\u6D41\u6C34\u5E33\u8CC7\u6599:",{startDate:o,endDate:u}),g.success&&g.data?this.ledgerDetails.set(g.data.map(y=>({transactionDate:y.entry_date||"",description:y.description||"",subjectName:y.subject_name||"",debitAmount:y.amount&&y.amount>0?y.amount:0,creditAmount:y.amount&&y.amount<0?Math.abs(y.amount):0,glAccountName:y.account_name||""}))):this.ledgerDetails.set([])}catch(e){console.error("\u8F09\u5165\u7576\u65E5\u71DF\u6536\u8CC7\u6599\u6642\u767C\u751F\u932F\u8AA4:",e);let t=e instanceof Error?e.message:"\u7121\u6CD5\u8F09\u5165\u71DF\u6536\u8CC7\u6599\uFF0C\u8ACB\u7A0D\u5F8C\u518D\u8A66";this.errorMessage.set(t)}finally{this.isLoading.set(!1)}}applyFilter(){this.loadData()}resetFilter(){this.selectedYear.set(new Date().getFullYear()),this.selectedMonth.set(new Date().getMonth()+1),this.loadData()}navigateToDetail(e){this.router.navigate(["/daily-revenue",e])}formatCurrency(e){return e==null?"":e.toLocaleString("zh-TW",{style:"currency",currency:"TWD",minimumFractionDigits:0})}getWeekdayChar(e){return["\u65E5","\u4E00","\u4E8C","\u4E09","\u56DB","\u4E94","\u516D"][e%7]}formatDate(e){if(!e)return"";let t;if(/^\d{4}-\d{2}-\d{2}$/.test(e)){let[u,c,p]=e.split("-").map(Number);t=new Date(u,c-1,p)}else t=new Date(e);if(isNaN(t.getTime()))return e;let i=t.getFullYear(),r=String(t.getMonth()+1).padStart(2,"0"),o=String(t.getDate()).padStart(2,"0"),a=this.getWeekdayChar(t.getDay());return`${i}-${r}-${o}(${a})`}isClosedDay(e,t){if(t||!e)return!1;let i;if(/^\d{4}-\d{2}-\d{2}$/.test(e)){let[r,o,a]=e.split("-").map(Number);i=new Date(r,o-1,a)}else i=new Date(e);return isNaN(i.getTime())?!1:i.getDay()===1}createChart(e){let t=this.chartData(),i=this.summary(),r=t.map(p=>p.day),o=t.map(p=>p.totalDailyRevenue),a=o.some(p=>p>0);console.log("\u6B63\u5728\u5EFA\u7ACB\u5716\u8868:",{dataCount:t.length,hasRevenueData:a,revenueDataSample:o.slice(0,10),daysWithRevenue:o.filter(p=>p>0).length});let u=[{label:"\u6BCF\u65E5\u71DF\u6536",data:o,borderColor:"#4f46e5",backgroundColor:"rgba(79, 70, 229, 0.1)",fill:!0,tension:.4,pointRadius:4,pointBackgroundColor:"#4f46e5"},{label:"\u6BCF\u65E5\u5E73\u5747\u76EE\u6A19",data:t.map(()=>i.dailyAverageTarget),borderColor:"#f97316",borderDash:[5,5],fill:!1,pointRadius:0,pointHitRadius:0}],c=e.nativeElement.getContext("2d");this.dailyChart=new Chart(c,{type:"line",data:{labels:r,datasets:u},options:{responsive:!0,maintainAspectRatio:!1,scales:{y:{beginAtZero:!0,ticks:{callback:p=>this.formatCurrency(p)}},x:{title:{display:!0,text:"\u65E5\u671F"}}},plugins:{tooltip:{callbacks:{label:p=>`${p.dataset.label}: ${this.formatCurrency(p.raw)}`}}}}})}destroyChart(){this.dailyChart&&(this.dailyChart.destroy(),this.dailyChart=null)}};Ya.\u0275fac=function(t){return new(t||Ya)},Ya.\u0275cmp=re({type:Ya,selectors:[["app-daily-revenue"]],viewQuery:function(t,i){if(t&1&&ut(FL,5),t&2){let r;tt(r=nt())&&(i.dailyRevenueChartRef=r.first)}},decls:24,vars:9,consts:[["dailyRevenueChart",""],[1,"space-y-6"],[1,"flex","flex-wrap","items-center","justify-between","gap-4"],[1,"text-3xl","font-bold","text-gray-900"],[1,"flex","flex-col","sm:flex-row","items-center","gap-2","bg-white","p-3","rounded-xl","shadow-md","border","border-gray-200"],[1,"flex","items-center","gap-2"],[1,"text-sm","font-medium","text-gray-600"],[1,"border-gray-300","rounded-lg","shadow-sm","focus:ring-indigo-500","focus:border-indigo-500","text-sm","p-2","bg-gray-100","pr-8",3,"ngModelChange","ngModel"],[3,"value"],[1,"flex","items-center","gap-2","mt-2","sm:mt-0"],[1,"bg-indigo-600","text-white","px-4","py-2","rounded-lg","font-medium","hover:bg-indigo-700","transition-colors","flex","items-center","gap-2","text-sm","disabled:opacity-50",3,"click","disabled"],[3,"name"],["title","\u91CD\u8A2D\u7BE9\u9078",1,"text-gray-500","hover:text-gray-800","transition-colors","p-2","rounded-full","bg-gray-100","hover:bg-gray-200","disabled:opacity-50",3,"click","disabled"],["name","refresh-outline",1,"text-xl"],[1,"bg-red-50","border","border-red-200","text-red-700","px-4","py-3","rounded-lg","flex","items-center","gap-2"],[1,"flex","justify-center","items-center","py-12"],["name","alert-circle-outline",1,"text-xl"],[1,"animate-spin","rounded-full","h-12","w-12","border-b-2","border-indigo-600"],[1,"grid","grid-cols-2","md:grid-cols-3","lg:grid-cols-5","gap-6"],[1,"bg-white","p-4","rounded-xl","shadow-md","text-center"],[1,"text-sm","text-gray-500"],[1,"text-xl","font-semibold","text-gray-900","mt-1"],[1,"text-xl","font-semibold","mt-1"],[1,"bg-white","p-6","rounded-xl","shadow-md"],[1,"text-lg","font-semibold","text-gray-800","mb-4"],[1,"h-80"],[1,"text-sm","text-gray-600","mb-4"],["name","information-circle-outline",1,"align-middle"],[1,"overflow-x-auto"],[1,"w-full","text-sm","text-left","whitespace-nowrap"],[1,"text-xs","text-gray-700","uppercase","bg-gray-100"],[1,"px-4","py-3"],[1,"px-4","py-3","text-right"],[1,"border-b","hover:bg-gray-50"],[1,"px-4","py-2","font-medium"],[1,"px-4","py-2","text-right"],["colspan","2",1,"text-center","py-8","text-gray-500"]],template:function(t,i){t&1&&(l(0,"div",1)(1,"div",2)(2,"h1",3),d(3,"\u7576\u65E5\u71DF\u6536"),s(),l(4,"div",4)(5,"div",5)(6,"label",6),d(7,"\u6642\u9593:"),s(),l(8,"select",7),K("ngModelChange",function(o){return Q(i.selectedYear,o)||(i.selectedYear=o),o}),V(9,kL,2,2,"option",8,Y),s(),l(11,"select",7),K("ngModelChange",function(o){return Q(i.selectedMonth,o)||(i.selectedMonth=o),o}),V(12,VL,2,2,"option",8,Y),s()(),l(14,"div",9)(15,"button",10),b("click",function(){return i.applyFilter()}),x(16,"ion-icon",11),l(17,"span"),d(18),s()(),l(19,"button",12),b("click",function(){return i.resetFilter()}),x(20,"ion-icon",13),s()()()(),M(21,LL,4,1,"div",14),M(22,OL,2,0,"div",15),M(23,jL,50,14),s()),t&2&&(m(8),J("ngModel",i.selectedYear),m(),L(i.availableYears()),m(2),J("ngModel",i.selectedMonth),m(),L(i.availableMonths()),m(3),I("disabled",i.isLoading()),m(),I("name",i.isLoading()?"hourglass-outline":"filter-outline"),m(2),w(i.isLoading()?"\u8F09\u5165\u4E2D...":"\u5957\u7528"),m(),I("disabled",i.isLoading()),m(2),A(i.errorMessage()?21:-1),m(),A(i.isLoading()?22:-1),m(),A(!i.isLoading()&&!i.errorMessage()?23:-1))},dependencies:[se,De,He,Ge,Oe,fe,Ie],encapsulation:2,changeDetection:0});var gp=Ya;var zL=(n,e)=>e.id;function YL(n,e){if(n&1&&(l(0,"tr",24)(1,"td",28),d(2),s(),l(3,"td",29),d(4),s(),l(5,"td",30),d(6),s()()),n&2){let t=e.$implicit,i=_();m(2),w(t.name),m(2),w(t.organizer),m(2),w(i.formatCurrency(t.actualRevenue))}}function JL(n,e){n&1&&(l(0,"tr")(1,"td",31),d(2,"\u672C\u65E5\u7121\u6D3B\u52D5\u3002"),s()())}var Ja=class Ja{constructor(){this.fb=k(qe);this.dataService=k(zn);this.router=k(Fe);this.route=k(mn);this.date=D("");this.dailyEntry=D(null);this.eventsOnDay=D([]);this.submitted=D(!1);this.revenueForm=this.fb.group({nonEventRevenue:[0,[U.required,U.min(0)]]});this.totalEventRevenue=$(()=>this.eventsOnDay().reduce((e,t)=>e+t.actualRevenue,0));this.totalDailyRevenue=$(()=>(this.revenueForm.controls.nonEventRevenue.value??0)+this.totalEventRevenue());this.route.paramMap.pipe(ve(e=>e.get("date")),lt(e=>{if(!e||!/^\d{4}-\d{2}-\d{2}$/.test(e)){alert("\u7121\u6548\u7684\u65E5\u671F\u683C\u5F0F"),this.router.navigate(["/daily-revenue"]);return}this.date.set(e);let t=this.dataService.getDailyRevenueEntryByDate(e);this.dailyEntry.set(t),this.revenueForm.patchValue({nonEventRevenue:t.nonEventRevenue});let i=this.dataService.getEvents();this.eventsOnDay.set(i.filter(r=>r.date===e&&r.status==="active"))})).subscribe()}onSubmit(){if(this.submitted.set(!0),this.revenueForm.invalid){alert("\u8ACB\u8F38\u5165\u6709\u6548\u7684\u975E\u6D3B\u52D5\u71DF\u6536\u91D1\u984D\u3002");return}let e=this.revenueForm.controls.nonEventRevenue.value??0;this.dataService.updateDailyRevenueEntry(this.date(),{nonEventRevenue:e}),alert("\u7576\u65E5\u71DF\u6536\u5DF2\u66F4\u65B0\uFF01"),this.router.navigate(["/daily-revenue"])}onCancel(){this.router.navigate(["/daily-revenue"])}formatCurrency(e){return e==null?"":e.toLocaleString("zh-TW",{style:"currency",currency:"TWD",minimumFractionDigits:0})}};Ja.\u0275fac=function(t){return new(t||Ja)},Ja.\u0275cmp=re({type:Ja,selectors:[["app-daily-revenue-detail"]],decls:53,vars:7,consts:[[1,"space-y-6","max-w-4xl","mx-auto"],[1,"flex","items-center","gap-4"],[1,"text-gray-500","hover:text-gray-800","transition-colors","p-2","rounded-full","bg-gray-100","hover:bg-gray-200",3,"click"],["name","arrow-back-outline",1,"text-2xl"],[1,"text-3xl","font-bold","text-gray-900"],[1,"text-indigo-600"],["novalidate","",3,"ngSubmit","formGroup"],[1,"bg-white","p-6","md:p-8","rounded-xl","shadow-md","space-y-6"],[1,"grid","grid-cols-1","md:grid-cols-3","gap-6"],[1,"bg-gray-50","p-4","rounded-lg"],["for","nonEventRevenue",1,"block","text-sm","font-medium","text-gray-700"],["type","number","id","nonEventRevenue","formControlName","nonEventRevenue",1,"mt-2","block","w-full","border","bg-white","rounded-md","shadow-sm","p-2","text-lg","text-right","font-semibold"],[1,"text-xs","text-gray-500","mt-1"],[1,"bg-blue-50","p-4","rounded-lg"],[1,"text-sm","font-medium","text-gray-700"],[1,"mt-2","text-lg","text-right","font-semibold","text-blue-800"],[1,"bg-green-50","p-4","rounded-lg"],[1,"mt-2","text-lg","text-right","font-semibold","text-green-800"],[1,"text-lg","font-semibold","text-gray-800","mb-2"],[1,"border","rounded-lg","overflow-hidden"],[1,"w-full","text-sm","text-left"],[1,"bg-gray-100","text-xs","uppercase"],[1,"px-4","py-2"],[1,"px-4","py-2","text-right"],[1,"border-t"],[1,"flex","items-center","justify-end","gap-4","pt-4","border-t","mt-6"],["type","button",1,"px-4","py-2","border","border-gray-300","rounded-md","shadow-sm","text-sm","font-medium","text-gray-700","bg-white","hover:bg-gray-50",3,"click"],["type","submit",1,"px-4","py-2","border","border-transparent","rounded-md","shadow-sm","text-sm","font-medium","text-white","bg-indigo-600","hover:bg-indigo-700"],[1,"px-4","py-2","font-medium"],[1,"px-4","py-2","text-gray-600"],[1,"px-4","py-2","text-right","font-semibold"],["colspan","3",1,"px-4","py-4","text-center","text-gray-500"]],template:function(t,i){if(t&1&&(l(0,"div",0)(1,"div",1)(2,"button",2),b("click",function(){return i.onCancel()}),x(3,"ion-icon",3),s(),l(4,"h1",4),d(5," \u7DE8\u8F2F\u7576\u65E5\u71DF\u6536 - "),l(6,"span",5),d(7),s()()(),l(8,"form",6),b("ngSubmit",function(){return i.onSubmit()}),l(9,"div",7)(10,"div",8)(11,"div",9)(12,"label",10),d(13,"\u975E\u6D3B\u52D5\u71DF\u6536*"),s(),x(14,"input",11),l(15,"p",12),d(16,"\u624B\u52D5\u8F38\u5165\u7576\u5929\u975E\u6D3B\u52D5\u76F8\u95DC\u7684\u71DF\u6536\u3002"),s()(),l(17,"div",13)(18,"p",14),d(19,"\u6D3B\u52D5\u7E3D\u71DF\u6536"),s(),l(20,"p",15),d(21),s(),l(22,"p",12),d(23,"\u4F86\u81EA\u4E0B\u65B9\u6D3B\u52D5\u5217\u8868\u7684\u52A0\u7E3D\u3002"),s()(),l(24,"div",16)(25,"p",14),d(26,"\u7576\u65E5\u7E3D\u71DF\u6536"),s(),l(27,"p",17),d(28),s(),l(29,"p",12),d(30,"\u975E\u6D3B\u52D5\u71DF\u6536 + \u6D3B\u52D5\u7E3D\u71DF\u6536\u3002"),s()()(),l(31,"div")(32,"h3",18),d(33,"\u672C\u65E5\u6D3B\u52D5"),s(),l(34,"div",19)(35,"table",20)(36,"thead",21)(37,"tr")(38,"th",22),d(39,"\u6D3B\u52D5\u540D\u7A31"),s(),l(40,"th",22),d(41,"\u4ECB\u7D39\u4EBA"),s(),l(42,"th",23),d(43,"\u5BE6\u969B\u6536\u5165"),s()()(),l(44,"tbody"),V(45,YL,7,3,"tr",24,zL,!1,JL,3,0,"tr"),s()()()(),l(48,"div",25)(49,"button",26),b("click",function(){return i.onCancel()}),d(50," \u53D6\u6D88 "),s(),l(51,"button",27),d(52," \u5132\u5B58\u8B8A\u66F4 "),s()()()()()),t&2){let r;m(7),w(i.date()),m(),I("formGroup",i.revenueForm),m(6),j("border-red-500",i.submitted()&&((r=i.revenueForm.get("nonEventRevenue"))==null?null:r.invalid)),m(7),w(i.formatCurrency(i.totalEventRevenue())),m(7),w(i.formatCurrency(i.totalDailyRevenue())),m(17),L(i.eventsOnDay())}},dependencies:[se,Be,Ve,be,Bt,fe,ke,Le,Ue],encapsulation:2,changeDetection:0});var hp=Ja;var hS=()=>[2024,2025,2026,2027],KL=()=>[1,2,3,4,5,6,7,8,9,10,11,12],yS=(n,e)=>e.user_id+"-"+e.year_month,g_=(n,e)=>e.id,QL=(n,e)=>e.employee_id,ZL=(n,e)=>e.source_month,XL=(n,e)=>e.payable_id;function eO(n,e){if(n&1&&(l(0,"option",23),d(1),s()),n&2){let t=e.$implicit;I("value",t),m(),N("",t,"\u5E74")}}function tO(n,e){if(n&1){let t=B();l(0,"div",10)(1,"label",21),d(2,"\u5E74\u4EFD:"),s(),l(3,"select",22),K("ngModelChange",function(r){E(t);let o=_();return Q(o.selectedYear,r)||(o.selectedYear=r),S(r)}),b("change",function(){E(t);let r=_();return S(r.onMonthChange())}),V(4,eO,2,2,"option",23,Y),s()()}if(n&2){let t=_();m(3),J("ngModel",t.selectedYear),m(),L(Ke(1,hS))}}function nO(n,e){if(n&1&&(l(0,"option",23),d(1),s()),n&2){let t=e.$implicit;I("value",t),m(),N("",t,"\u5E74")}}function iO(n,e){if(n&1&&(l(0,"option",23),d(1),s()),n&2){let t=e.$implicit;I("value",t),m(),N("",t,"\u6708")}}function rO(n,e){if(n&1){let t=B();l(0,"div",10)(1,"label",21),d(2,"\u6708\u4EFD:"),s(),l(3,"select",22),K("ngModelChange",function(r){E(t);let o=_();return Q(o.selectedYear,r)||(o.selectedYear=r),S(r)}),b("change",function(){E(t);let r=_();return S(r.onMonthChange())}),V(4,nO,2,2,"option",23,Y),s(),l(6,"select",22),K("ngModelChange",function(r){E(t);let o=_();return Q(o.selectedMonth,r)||(o.selectedMonth=r),S(r)}),b("change",function(){E(t);let r=_();return S(r.onMonthChange())}),V(7,iO,2,2,"option",23,Y),s()()}if(n&2){let t=_();m(3),J("ngModel",t.selectedYear),m(),L(Ke(2,hS)),m(2),J("ngModel",t.selectedMonth),m(),L(Ke(3,KL))}}function oO(n,e){if(n&1&&(l(0,"div",24)(1,"div",28)(2,"p",29),d(3,"\u7B46\u6578"),s(),l(4,"p",30),d(5),s()(),l(6,"div",28)(7,"p",29),d(8,"\u7E3D\u85AA\u8CC7"),s(),l(9,"p",31),d(10),s()(),l(11,"div",28)(12,"p",29),d(13,"\u5DF2\u6838\u5C0D"),s(),l(14,"p",32),d(15),s()(),l(16,"div",28)(17,"p",29),d(18,"\u5DF2\u767C\u653E"),s(),l(19,"p",33),d(20),s()()()),n&2){let t=_(2);m(5),w(t.dailyStats().totalRecords),m(5),w(t.formatCurrency(t.dailyStats().totalWages)),m(5),w(t.dailyStats().verifiedCount),m(5),w(t.dailyStats().paidCount)}}function aO(n,e){if(n&1&&(l(0,"div",25)(1,"p",34),d(2),s()()),n&2){let t=_(2);m(2),w(t.dailyError())}}function sO(n,e){n&1&&(l(0,"div",26)(1,"p",35),d(2,"\u8F09\u5165\u4E2D..."),s()())}function lO(n,e){if(n&1&&(l(0,"span",54),d(1),s()),n&2){let t=_().$implicit;m(),N("\u7F3A\u5361",t.missing_records,"\u7B46")}}function uO(n,e){n&1&&(l(0,"span",55),d(1,"\u5DF2\u6838\u5C0D"),s())}function dO(n,e){n&1&&(l(0,"span",35),d(1,"\u672A\u6838\u5C0D"),s())}function cO(n,e){if(n&1&&(l(0,"span",56),x(1,"ion-icon",62),d(2),s()),n&2){let t=_().$implicit,i=_(4);m(2),N(" ",i.getReleaseStatusLabel(t)," ")}}function mO(n,e){if(n&1&&(l(0,"span",57),x(1,"ion-icon",63),d(2),s()),n&2){let t=_().$implicit,i=_(4);m(2),N(" ",i.getReleaseStatusLabel(t)," ")}}function pO(n,e){if(n&1&&(l(0,"span",58),x(1,"ion-icon",64),d(2),s()),n&2){let t=_().$implicit,i=_(4);m(2),N(" ",i.getReleaseStatusLabel(t)," ")}}function fO(n,e){if(n&1&&(l(0,"span",59),d(1),s()),n&2){let t=_().$implicit;m(),N("#",t.entry_id)}}function gO(n,e){n&1&&(l(0,"span",60),d(1,"-"),s())}function hO(n,e){n&1&&(l(0,"span"),d(1,"\u7522\u751F\u4E2D..."),s())}function yO(n,e){n&1&&(l(0,"span"),d(1,"\u4E0B\u8F09"),s())}function _O(n,e){if(n&1){let t=B();l(0,"tr",48),b("click",function(){let r=E(t).$implicit,o=_(4);return S(o.openMonthlyDetails(r))}),l(1,"td",49),d(2),s(),l(3,"td",50),d(4),s(),l(5,"td",51),d(6),s(),l(7,"td",52),d(8),s(),l(9,"td",53),M(10,lO,2,1,"span",54),s(),l(11,"td",53),M(12,uO,2,0,"span",55)(13,dO,2,0,"span",35),s(),l(14,"td",53),M(15,cO,3,1,"span",56)(16,mO,3,1,"span",57)(17,pO,3,1,"span",58),s(),l(18,"td",53),M(19,fO,2,1,"span",59)(20,gO,2,0,"span",60),s(),l(21,"td",53)(22,"button",61),b("click",function(r){let o=E(t).$implicit,a=_(4);return S(a.downloadLaborReport(o,r))}),M(23,hO,2,0,"span")(24,yO,2,0,"span"),s()()()}if(n&2){let t=e.$implicit,i=_(4);m(2),w(t.year_month),m(2),w(t.display_name),m(2),N("",t.total_work_hours.toFixed(2)," h"),m(2),w(i.formatCurrency(t.total_wage)),m(2),A(t.missing_records>0?10:-1),m(2),A(t.is_fully_verified?12:13),m(3),A(i.getReleaseStatus(t)==="released"?15:i.getReleaseStatus(t)==="partial"?16:17),m(4),A(t.entry_id?19:20),m(3),I("disabled",i.downloadingReports().has(t.user_id+"-"+t.year_month)),m(),A(i.downloadingReports().has(t.user_id+"-"+t.year_month)?23:24)}}function vO(n,e){if(n&1&&(l(0,"div",36)(1,"div",38)(2,"h3",39),d(3,"\u8A08\u6642\u54E1\u5DE5"),s()(),l(4,"div",40)(5,"table",41)(6,"thead",42)(7,"tr")(8,"th",43),d(9,"\u5DE5\u4F5C\u6708\u4EFD"),s(),l(10,"th",43),d(11,"\u54E1\u5DE5"),s(),l(12,"th",44),d(13,"\u7E3D\u5DE5\u6642"),s(),l(14,"th",44),d(15,"\u7E3D\u85AA\u8CC7"),s(),l(16,"th",45),d(17,"\u7F3A\u5361"),s(),l(18,"th",45),d(19,"\u6838\u5C0D"),s(),l(20,"th",45),d(21,"\u767C\u653E"),s(),l(22,"th",45),d(23,"\u6D41\u6C34\u5E33"),s(),l(24,"th",45),d(25,"\u52DE\u5831\u55AE"),s()()(),l(26,"tbody",46),V(27,_O,25,10,"tr",47,yS),s()()()()),n&2){let t=_(3);m(27),L(t.hourlySummaries())}}function CO(n,e){if(n&1&&(l(0,"span",54),d(1),s()),n&2){let t=_().$implicit;m(),N("\u7F3A\u5361",t.missing_records,"\u7B46")}}function xO(n,e){n&1&&(l(0,"span",69),x(1,"ion-icon",71),d(2," \u5DF2\u6838\u5C0D "),s())}function bO(n,e){if(n&1){let t=B();l(0,"button",72),b("click",function(){E(t);let r=_().$implicit,o=_(4);return S(o.verifyMonthlySalarySummary(r))}),d(1," \u6838\u5C0D "),s()}}function EO(n,e){if(n&1&&(l(0,"span",56),x(1,"ion-icon",62),d(2),s()),n&2){let t=_().$implicit,i=_(4);m(2),N(" ",i.getReleaseStatusLabel(t)," ")}}function SO(n,e){if(n&1&&(l(0,"span",57),x(1,"ion-icon",63),d(2),s()),n&2){let t=_().$implicit,i=_(4);m(2),N(" ",i.getReleaseStatusLabel(t)," ")}}function DO(n,e){if(n&1&&(l(0,"span",58),x(1,"ion-icon",64),d(2),s()),n&2){let t=_().$implicit,i=_(4);m(2),N(" ",i.getReleaseStatusLabel(t)," ")}}function wO(n,e){if(n&1&&(l(0,"span",59),d(1),s()),n&2){let t=_().$implicit;m(),N("#",t.entry_id)}}function TO(n,e){n&1&&(l(0,"span",60),d(1,"-"),s())}function IO(n,e){if(n&1){let t=B();l(0,"tr",67)(1,"td",49),d(2),s(),l(3,"td",50),d(4),s(),l(5,"td",51),d(6),s(),l(7,"td",52),d(8),s(),l(9,"td",53)(10,"button",68),b("click",function(){let r=E(t).$implicit,o=_(4);return S(o.openMonthlySalaryAdjust(r))}),d(11," \u8ABF\u6574 "),s()(),l(12,"td",53),M(13,CO,2,1,"span",54),s(),l(14,"td",53),M(15,xO,3,0,"span",69)(16,bO,2,0,"button",70),s(),l(17,"td",53),M(18,EO,3,1,"span",56)(19,SO,3,1,"span",57)(20,DO,3,1,"span",58),s(),l(21,"td",53),M(22,wO,2,1,"span",59)(23,TO,2,0,"span",60),s()()}if(n&2){let t=e.$implicit,i=_(4);m(2),w(t.year_month),m(2),w(t.display_name),m(2),N("",t.total_work_hours.toFixed(2)," h"),m(2),w(i.formatCurrency(t.total_wage)),m(2),I("disabled",t.is_fully_paid),m(3),A(t.missing_records>0?13:-1),m(2),A(t.is_fully_verified?15:16),m(3),A(i.getReleaseStatus(t)==="released"?18:i.getReleaseStatus(t)==="partial"?19:20),m(4),A(t.entry_id?22:23)}}function MO(n,e){if(n&1&&(l(0,"div",37)(1,"div",65)(2,"h3",66),d(3,"\u6B63\u8077\u54E1\u5DE5 (\u6708\u85AA)"),s()(),l(4,"div",40)(5,"table",41)(6,"thead",42)(7,"tr")(8,"th",43),d(9,"\u5DE5\u4F5C\u6708\u4EFD"),s(),l(10,"th",43),d(11,"\u54E1\u5DE5"),s(),l(12,"th",44),d(13,"\u7E3D\u5DE5\u6642"),s(),l(14,"th",44),d(15,"\u7E3D\u85AA\u8CC7"),s(),l(16,"th",45),d(17,"\u8ABF\u6574"),s(),l(18,"th",45),d(19,"\u7F3A\u5361"),s(),l(20,"th",45),d(21,"\u6838\u5C0D"),s(),l(22,"th",45),d(23,"\u767C\u653E"),s(),l(24,"th",45),d(25,"\u6D41\u6C34\u5E33"),s()()(),l(26,"tbody",46),V(27,IO,24,9,"tr",67,yS),s()()()()),n&2){let t=_(3);m(27),L(t.monthlySalarySummaries())}}function AO(n,e){if(n&1&&(M(0,vO,29,0,"div",36),M(1,MO,29,0,"div",37)),n&2){let t=_(2);A(t.hourlySummaries().length>0?0:-1),m(),A(t.monthlySalarySummaries().length>0?1:-1)}}function RO(n,e){if(n&1&&(l(0,"div",27)(1,"p",73),d(2),s()()),n&2){let t=_(2);m(2),N("",t.getMonthLabel()," \u6C92\u6709\u85AA\u8CC7\u8A18\u9304")}}function NO(n,e){if(n&1&&(l(0,"span",57),d(1),s()),n&2){let t=_().$implicit;m(),N(" ",t.multiplier,"x ")}}function FO(n,e){n&1&&(l(0,"span",60),d(1,"-"),s())}function PO(n,e){n&1&&(l(0,"span",69),x(1,"ion-icon",71),d(2," \u5DF2\u6838\u5C0D "),s())}function kO(n,e){n&1&&(l(0,"span",93),d(1," \u672A\u6838\u5C0D "),s())}function VO(n,e){n&1&&(l(0,"span",56),x(1,"ion-icon",62),d(2," \u5DF2\u767C\u653E "),s())}function LO(n,e){n&1&&(l(0,"span",93),d(1," \u672A\u767C\u653E "),s())}function OO(n,e){if(n&1){let t=B();l(0,"tr",67)(1,"td",53)(2,"input",91),b("change",function(r){let o=E(t).$implicit,a=_(3);return S(a.toggleRowSelection(o.id,r))}),s()(),l(3,"td",49),d(4),s(),l(5,"td",49)(6,"input",92),K("ngModelChange",function(r){let o=E(t).$implicit;return Q(o.clock_in_time_input,r)||(o.clock_in_time_input=r),S(r)}),b("change",function(){let r=E(t).$implicit,o=_(3);return S(o.updateMonthlyDetailDisplay(r))}),s()(),l(7,"td",49)(8,"input",92),K("ngModelChange",function(r){let o=E(t).$implicit;return Q(o.clock_out_time_input,r)||(o.clock_out_time_input=r),S(r)}),b("change",function(){let r=E(t).$implicit,o=_(3);return S(o.updateMonthlyDetailDisplay(r))}),s()(),l(9,"td",51),d(10),s(),l(11,"td",51),d(12),s(),l(13,"td",53),M(14,NO,2,1,"span",57)(15,FO,2,0,"span",60),s(),l(16,"td",53),M(17,PO,3,0,"span",69)(18,kO,2,0,"span",93),s(),l(19,"td",53),M(20,VO,3,0,"span",56)(21,LO,2,0,"span",93),s(),l(22,"td",53)(23,"div",94)(24,"button",95),b("click",function(){let r=E(t).$implicit,o=_(3);return S(o.saveMonthlyDetail(r))}),x(25,"ion-icon",96),s(),l(26,"button",97),b("click",function(){let r=E(t).$implicit,o=_(3);return S(o.deleteMonthlyDetail(r))}),x(27,"ion-icon",98),s()()()()}if(n&2){let t=e.$implicit,i=_(3);j("bg-green-50",t.is_paid)("opacity-60",t.is_paid),m(2),I("checked",i.isRowSelected(t.id))("disabled",t.is_paid),m(2),w(i.formatDateYMD(t.work_date)),m(2),J("ngModel",t.clock_in_time_input),I("disabled",t.is_paid),m(2),J("ngModel",t.clock_out_time_input),I("disabled",t.is_paid),m(2),w(t.work_hours.toFixed(2)),m(2),w(i.formatCurrency(t.total_wage)),m(2),A(t.multiplier&&t.multiplier!==1?14:15),m(3),A(t.is_verified?17:18),m(3),A(t.is_paid?20:21),m(4),I("disabled",t.is_paid),m(2),I("disabled",t.is_paid)}}function BO(n,e){if(n&1){let t=B();l(0,"div",19)(1,"div",74)(2,"div",75)(3,"h2",76),d(4),s(),l(5,"button",77),b("click",function(){E(t);let r=_(2);return S(r.closeMonthlyDetails())}),x(6,"ion-icon",78),s()(),l(7,"div",79)(8,"div",80)(9,"div",81),d(10),s(),l(11,"div",82)(12,"button",83),b("click",function(){E(t);let r=_(2);return S(r.openCreateClockRecord())}),x(13,"ion-icon",84),d(14," \u65B0\u589E\u6253\u5361 "),s(),l(15,"button",85),b("click",function(){E(t);let r=_(2);return S(r.batchVerifyRecords())}),x(16,"ion-icon",86),d(17," \u6279\u91CF\u6838\u5C0D "),s(),l(18,"button",87),b("click",function(){E(t);let r=_(2);return S(r.batchReleaseRecords())}),x(19,"ion-icon",88),d(20," \u6279\u91CF\u767C\u653E "),s()()(),l(21,"div",40)(22,"table",41)(23,"thead",42)(24,"tr")(25,"th",53)(26,"input",89),b("change",function(r){E(t);let o=_(2);return S(o.toggleSelectAll(r))}),s()(),l(27,"th",43),d(28,"\u5DE5\u4F5C\u65E5\u671F"),s(),l(29,"th",43),d(30,"\u4E0A\u73ED\u6253\u5361\u6642\u9593"),s(),l(31,"th",43),d(32,"\u4E0B\u73ED\u6253\u5361\u6642\u9593"),s(),l(33,"th",44),d(34,"\u5DE5\u4F5C\u6642\u6578"),s(),l(35,"th",44),d(36,"\u85AA\u8CC7\u91D1\u984D"),s(),l(37,"th",45),d(38,"\u500D\u6578"),s(),l(39,"th",45),d(40,"\u6838\u5C0D"),s(),l(41,"th",45),d(42,"\u767C\u653E"),s(),l(43,"th",45),d(44,"\u64CD\u4F5C"),s()()(),l(45,"tbody",46),V(46,OO,28,18,"tr",90,g_),s()()()()()()}if(n&2){let t,i=_(2);m(4),w(i.monthlyDetailsTitle()),m(6),N(" \u5DF2\u9078\u64C7 ",i.selectedRows().length," \u7B46\u8A18\u9304 "),m(2),I("disabled",(t=i.currentMonthlySummary())==null?null:t.is_paid),m(3),I("disabled",i.selectedRows().length===0),m(3),I("disabled",i.selectedRows().length===0),m(28),L(i.monthlyDetailsRows())}}function UO(n,e){if(n&1&&(l(0,"div",5),M(1,oO,21,4,"div",24),M(2,aO,3,1,"div",25),M(3,sO,3,0,"div",26),M(4,AO,2,2),M(5,RO,3,1,"div",27),M(6,BO,48,5,"div",19),s()),n&2){let t=_();m(),A(!t.dailyLoading()&&t.dailySummaries().length>0?1:-1),m(),A(t.dailyError()?2:-1),m(),A(t.dailyLoading()?3:-1),m(),A(!t.dailyLoading()&&(t.hourlySummaries().length>0||t.monthlySalarySummaries().length>0)?4:-1),m(),A(!t.dailyLoading()&&t.hourlySummaries().length===0&&t.monthlySalarySummaries().length===0?5:-1),m(),A(t.monthlyDetailsVisible()?6:-1)}}function $O(n,e){if(n&1&&(l(0,"div",25)(1,"p",34),d(2),s()()),n&2){let t=_(2);m(2),w(t.wagesError())}}function HO(n,e){n&1&&(l(0,"div",26)(1,"p",35),d(2,"\u8F09\u5165\u4E2D..."),s()())}function GO(n,e){n&1&&(l(0,"span",101),d(1," \u555F\u7528 "),s())}function qO(n,e){n&1&&(l(0,"span",102),d(1," \u505C\u7528 "),s())}function WO(n,e){if(n&1){let t=B();l(0,"tr",67)(1,"td",49),d(2),s(),l(3,"td",50),d(4),s(),l(5,"td",51),d(6),s(),l(7,"td",49),d(8),s(),l(9,"td",49),d(10),s(),l(11,"td",49),d(12),s(),l(13,"td",53),M(14,GO,2,0,"span",101)(15,qO,2,0,"span",102),s(),l(16,"td",53)(17,"button",103),b("click",function(){let r=E(t).$implicit,o=_(3);return S(o.openWageForm(r))}),x(18,"ion-icon",104),s(),l(19,"button",105),b("click",function(){let r=E(t).$implicit,o=_(3);return S(o.deleteWageRecord(r))}),x(20,"ion-icon",106),s()()()}if(n&2){let t=e.$implicit,i=_(3);m(2),w(t.user_id),m(2),w(t.display_name),m(2),Qe("",i.formatCurrency(t.hourly_rate),"",t.wage_type==="hourly"?"/\u5C0F\u6642":"/\u6708"),m(2),w(t.wage_type==="hourly"?"\u8A08\u6642":"\u6708\u85AA"),m(2),w(i.formatDate(t.effective_from)),m(2),w(t.effective_to?i.formatDate(t.effective_to):"-"),m(2),A(t.is_active?14:15)}}function jO(n,e){if(n&1&&(l(0,"div",37)(1,"div",40)(2,"table",41)(3,"thead",42)(4,"tr")(5,"th",43),d(6,"\u54E1\u5DE5 ID"),s(),l(7,"th",43),d(8,"\u54E1\u5DE5\u540D\u7A31"),s(),l(9,"th",44),d(10,"\u85AA\u8CC7"),s(),l(11,"th",43),d(12,"\u985E\u578B"),s(),l(13,"th",43),d(14,"\u751F\u6548\u65E5\u671F"),s(),l(15,"th",43),d(16,"\u622A\u6B62\u65E5\u671F"),s(),l(17,"th",45),d(18,"\u72C0\u614B"),s(),l(19,"th",45),d(20,"\u64CD\u4F5C"),s()()(),l(21,"tbody",46),V(22,WO,21,8,"tr",67,g_),s()()()()),n&2){let t=_(2);m(22),L(t.employeeWages())}}function zO(n,e){if(n&1){let t=B();l(0,"div",27)(1,"p",73),d(2,"\u6C92\u6709\u54E1\u5DE5\u85AA\u8CC7\u8A2D\u5B9A"),s(),l(3,"button",107),b("click",function(){E(t);let r=_(2);return S(r.openWageForm())}),d(4," \u65B0\u589E\u85AA\u8CC7\u8A2D\u5B9A "),s()()}}function YO(n,e){if(n&1){let t=B();l(0,"div",19)(1,"div",108)(2,"div",109)(3,"h2",76),d(4),s(),l(5,"button",77),b("click",function(){E(t);let r=_(2);return S(r.closeWageForm())}),x(6,"ion-icon",78),s()(),l(7,"form",110)(8,"div",111)(9,"div")(10,"label",112),d(11,"\u54E1\u5DE5 ID *"),s(),x(12,"input",113),s(),l(13,"div")(14,"label",112),d(15,"\u54E1\u5DE5\u540D\u7A31"),s(),x(16,"input",114),s()(),l(17,"div",111)(18,"div")(19,"label",112),d(20,"\u85AA\u8CC7 *"),s(),x(21,"input",115),s(),l(22,"div")(23,"label",112),d(24,"\u85AA\u8CC7\u985E\u578B"),s(),l(25,"select",116)(26,"option",117),d(27,"\u8A08\u6642"),s(),l(28,"option",118),d(29,"\u6708\u85AA"),s()()()(),l(30,"div",111)(31,"div")(32,"label",112),d(33,"\u751F\u6548\u65E5\u671F *"),s(),x(34,"input",119),s(),l(35,"div")(36,"label",112),d(37,"\u622A\u6B62\u65E5\u671F"),s(),x(38,"input",120),s()(),l(39,"div")(40,"label",112),d(41,"\u5099\u8A3B"),s(),x(42,"textarea",121),s(),l(43,"div",122)(44,"button",123),b("click",function(){E(t);let r=_(2);return S(r.closeWageForm())}),d(45," \u53D6\u6D88 "),s(),l(46,"button",124),b("click",function(){E(t);let r=_(2);return S(r.saveWageRecord())}),d(47," \u4FDD\u5B58 "),s()()()()()}if(n&2){let t=_(2);m(4),w(t.editingWage()?"\u7DE8\u8F2F\u85AA\u8CC7\u8A2D\u5B9A":"\u65B0\u589E\u85AA\u8CC7\u8A2D\u5B9A"),m(3),I("formGroup",t.wageForm),m(5),j("bg-gray-100",!!t.editingWage())("cursor-not-allowed",!!t.editingWage()),I("readonly",!!t.editingWage())}}function JO(n,e){if(n&1){let t=B();l(0,"div",5),M(1,$O,3,1,"div",25),l(2,"div",99)(3,"button",100),b("click",function(){E(t);let r=_();return S(r.openWageForm())}),x(4,"ion-icon",84),d(5," \u65B0\u589E\u85AA\u8CC7\u8A2D\u5B9A "),s()(),M(6,HO,3,0,"div",26),M(7,jO,24,0,"div",37),M(8,zO,5,0,"div",27),M(9,YO,48,7,"div",19),s()}if(n&2){let t=_();m(),A(t.wagesError()?1:-1),m(5),A(t.wagesLoading()?6:-1),m(),A(!t.wagesLoading()&&t.employeeWages().length>0?7:-1),m(),A(!t.wagesLoading()&&t.employeeWages().length===0?8:-1),m(),A(t.wagesFormVisible()?9:-1)}}function KO(n,e){n&1&&(l(0,"div",26)(1,"p",35),d(2,"\u8F09\u5165\u4E2D..."),s()())}function QO(n,e){if(n&1&&(l(0,"div",128),d(1),s()),n&2){let t=_(2);m(),N(" ",t.specialError()," ")}}function ZO(n,e){n&1&&(l(0,"tr")(1,"td",136),d(2," \u76EE\u524D\u6C92\u6709\u7279\u6B8A\u5DE5\u4F5C\u65E5\u8A2D\u5B9A "),s()())}function XO(n,e){n&1&&(l(0,"span",101),d(1," \u555F\u7528 "),s())}function eB(n,e){n&1&&(l(0,"span",102),d(1," \u505C\u7528 "),s())}function tB(n,e){if(n&1){let t=B();l(0,"tr",135)(1,"td",137),d(2),s(),l(3,"td",138),d(4),s(),l(5,"td",139)(6,"span",140),d(7),s()(),l(8,"td",139),M(9,XO,2,0,"span",101)(10,eB,2,0,"span",102),s(),l(11,"td",141),d(12),s(),l(13,"td",142)(14,"button",143),b("click",function(){let r=E(t).$implicit,o=_(3);return S(o.openSpecialForm(r))}),x(15,"ion-icon",144),s(),l(16,"button",145),b("click",function(){let r=E(t).$implicit,o=_(3);return S(o.deleteSpecialDate(r.id))}),x(17,"ion-icon",146),s()()()}if(n&2){let t=e.$implicit,i=_(3);m(2),N(" ",i.formatDateYMD(t.date)," "),m(2),N(" ",t.name," "),m(3),N(" ",t.multiplier,"x "),m(2),A(t.is_active?9:10),m(3),N(" ",t.notes||"-"," ")}}function nB(n,e){if(n&1&&(l(0,"div",129)(1,"table",130)(2,"thead",131)(3,"tr")(4,"th",132),d(5,"\u65E5\u671F"),s(),l(6,"th",132),d(7,"\u540D\u7A31"),s(),l(8,"th",133),d(9,"\u85AA\u8CC7\u500D\u6578"),s(),l(10,"th",133),d(11,"\u72C0\u614B"),s(),l(12,"th",132),d(13,"\u5099\u8A3B"),s(),l(14,"th",133),d(15,"\u64CD\u4F5C"),s()()(),l(16,"tbody",134),M(17,ZO,3,0,"tr"),V(18,tB,18,5,"tr",135,g_),s()()()),n&2){let t=_(2);m(17),A(t.specialDates().length===0?17:-1),m(),L(t.specialDates())}}function iB(n,e){if(n&1){let t=B();l(0,"div",19)(1,"div",147)(2,"div",79)(3,"h3",148),d(4),s(),l(5,"div",149)(6,"div")(7,"label",112),d(8,"\u65E5\u671F *"),s(),x(9,"input",150,0),s(),l(11,"div")(12,"label",112),d(13,"\u540D\u7A31 *"),s(),x(14,"input",151,1),s(),l(16,"div")(17,"label",112),d(18,"\u85AA\u8CC7\u500D\u6578 *"),s(),x(19,"input",152,2),s(),l(21,"div")(22,"label",153),x(23,"input",154,3),l(25,"span",155),d(26,"\u555F\u7528"),s()()(),l(27,"div")(28,"label",112),d(29,"\u5099\u8A3B"),s(),x(30,"textarea",156,4),s()(),l(32,"div",157)(33,"button",123),b("click",function(){E(t);let r=_(2);return S(r.closeSpecialForm())}),d(34," \u53D6\u6D88 "),s(),l(35,"button",124),b("click",function(){E(t);let r=oe(10),o=oe(15),a=oe(20),u=oe(24),c=oe(31),p=_(2);return S(p.saveSpecialDate({date:r.value,name:o.value,multiplier:+a.value,is_active:u.checked,notes:c.value||null}))}),d(36," \u4FDD\u5B58 "),s()()()()()}if(n&2){let t,i,r,o,a,u=_(2);m(4),N(" ",u.editingSpecial()?"\u7DE8\u8F2F\u7279\u6B8A\u5DE5\u4F5C\u65E5":"\u65B0\u589E\u7279\u6B8A\u5DE5\u4F5C\u65E5"," "),m(5),I("value",((t=u.editingSpecial())==null?null:t.date)||""),m(5),I("value",((i=u.editingSpecial())==null?null:i.name)||""),m(5),I("value",((r=u.editingSpecial())==null?null:r.multiplier)||2),m(4),I("checked",((o=u.editingSpecial())==null?null:o.is_active)??!0),m(7),I("value",((a=u.editingSpecial())==null?null:a.notes)||"")}}function rB(n,e){if(n&1){let t=B();l(0,"div",5)(1,"div",125)(2,"h2",126),d(3,"\u7279\u6B8A\u5DE5\u4F5C\u65E5\u8A2D\u5B9A"),s(),l(4,"button",127),b("click",function(){E(t);let r=_();return S(r.openSpecialForm())}),x(5,"ion-icon",84),d(6," \u65B0\u589E\u7279\u6B8A\u5DE5\u4F5C\u65E5 "),s()(),M(7,KO,3,0,"div",26),M(8,QO,2,1,"div",128),M(9,nB,20,1,"div",129),M(10,iB,37,6,"div",19),s()}if(n&2){let t=_();m(7),A(t.specialLoading()?7:-1),m(),A(t.specialError()?8:-1),m(),A(!t.specialLoading()&&!t.specialError()?9:-1),m(),A(t.specialFormVisible()?10:-1)}}function oB(n,e){n&1&&(l(0,"p",160),d(1,"\u8F09\u5165\u4E2D..."),s())}function aB(n,e){if(n&1&&(l(0,"p",161),d(1),s(),l(2,"p",162),d(3),s()),n&2){let t=_(2);m(),N(" ",t.formatCurrency(t.payablesSummary().total_payable)," "),m(2),N(" \u5171 ",t.payablesSummary().employees.length," \u4F4D\u54E1\u5DE5\u6709\u61C9\u4ED8\u85AA\u8CC7 ")}}function sB(n,e){n&1&&(l(0,"div",26)(1,"p",35),d(2,"\u8F09\u5165\u4E2D..."),s()())}function lB(n,e){if(n&1&&(l(0,"div",128),d(1),s()),n&2){let t=_(2);m(),N(" ",t.payablesError()," ")}}function uB(n,e){n&1&&(l(0,"tr")(1,"td",166),d(2," \u76EE\u524D\u6C92\u6709\u61C9\u4ED8\u85AA\u8CC7\u8A18\u9304 "),s()())}function dB(n,e){if(n&1){let t=B();l(0,"tr",167),b("click",function(){let r=E(t).$implicit,o=_(3);return S(o.openPayablesDetail(r))}),l(1,"td",168)(2,"div",153)(3,"div",169),x(4,"ion-icon",170),s(),l(5,"div",171)(6,"div",172),d(7),s(),l(8,"div",173),d(9),s()()()(),l(10,"td",174)(11,"div",175),d(12),s()(),l(13,"td",176)(14,"div",177)(15,"button",178),b("click",function(r){let o=E(t).$implicit;return _(3).openPayablesPaymentModal(o),S(r.stopPropagation())}),d(16," \u652F\u4ED8\u85AA\u8CC7 "),s(),l(17,"button",179),b("click",function(r){let o=E(t).$implicit;return _(3).openPayablesDetail(o),S(r.stopPropagation())}),d(18," \u67E5\u770B\u660E\u7D30 "),x(19,"ion-icon",180),s()()()()}if(n&2){let t=e.$implicit,i=_(3);m(7),w(t.employee_name),m(2),N("ID: ",t.employee_id),m(3),N(" ",i.formatCurrency(t.total_payable)," ")}}function cB(n,e){if(n&1&&(l(0,"div",129)(1,"div",163)(2,"h2",31),d(3,"\u54E1\u5DE5\u61C9\u4ED8\u85AA\u8CC7\u660E\u7D30"),s()(),l(4,"table",130)(5,"thead",131)(6,"tr")(7,"th",132),d(8,"\u54E1\u5DE5\u540D\u7A31"),s(),l(9,"th",164),d(10,"\u7D2F\u7A4D\u61C9\u4ED8\u85AA\u8CC7"),s(),l(11,"th",133),d(12,"\u64CD\u4F5C"),s()()(),l(13,"tbody",134),M(14,uB,3,0,"tr"),V(15,dB,20,3,"tr",165,QL),s()()()),n&2){let t=_(2);m(14),A(t.payablesSummary().employees.length===0?14:-1),m(),L(t.payablesSummary().employees)}}function mB(n,e){if(n&1&&(l(0,"div",5)(1,"div",158)(2,"p",159),d(3,"\u7E3D\u61C9\u4ED8\u85AA\u8CC7"),s(),M(4,oB,2,0,"p",160)(5,aB,4,2),s(),M(6,sB,3,0,"div",26),M(7,lB,2,1,"div",128),M(8,cB,17,1,"div",129),s()),n&2){let t=_();m(4),A(t.payablesLoading()?4:5),m(2),A(t.payablesLoading()?6:-1),m(),A(t.payablesError()?7:-1),m(),A(!t.payablesLoading()&&!t.payablesError()?8:-1)}}function pB(n,e){if(n&1){let t=B();l(0,"div",19)(1,"div",181)(2,"h3",148),d(3),s(),l(4,"div",182)(5,"p",183),d(6,"\u5F85\u652F\u4ED8\u85AA\u8CC7\u7E3D\u984D"),s(),l(7,"p",184),d(8),s()(),l(9,"form",185),b("ngSubmit",function(){E(t);let r=_();return S(r.submitPayablesPayment())}),l(10,"div",186)(11,"label",187),d(12,"\u652F\u4ED8\u91D1\u984D"),s(),x(13,"input",188),l(14,"p",189),d(15),s()(),l(16,"div",186)(17,"label",187),d(18,"\u5099\u8A3B"),s(),x(19,"textarea",190),s(),l(20,"div",191)(21,"button",192),b("click",function(){E(t);let r=_();return S(r.closePayablesPaymentModal())}),d(22," \u53D6\u6D88 "),s(),l(23,"button",193),d(24),s()()()()()}if(n&2){let t,i,r,o,a=_();m(3),N(" \u652F\u4ED8\u85AA\u8CC7 - ",(t=a.payingEmployee())==null?null:t.employee_name," "),m(5),N(" ",a.formatCurrency(((i=a.payingEmployee())==null?null:i.total_payable)||0)," "),m(),I("formGroup",a.payablesPaymentForm),m(4),I("max",((r=a.payingEmployee())==null?null:r.total_payable)||0),m(2),N(" \u53EF\u8F38\u5165\u7BC4\u570D\uFF1A0 ~ ",a.formatCurrency(((o=a.payingEmployee())==null?null:o.total_payable)||0)," "),m(8),I("disabled",a.payablesPaymentSubmitting()),m(),N(" ",a.payablesPaymentSubmitting()?"\u8655\u7406\u4E2D...":"\u78BA\u8A8D\u652F\u4ED8"," ")}}function fB(n,e){n&1&&(l(0,"div",26)(1,"p",35),d(2,"\u8F09\u5165\u4E2D..."),s()())}function gB(n,e){n&1&&(l(0,"div",202),d(1," \u66AB\u7121\u61C9\u4ED8\u85AA\u8CC7\u8A18\u9304 "),s())}function hB(n,e){if(n&1&&(l(0,"span",224),d(1),s()),n&2){let t=_().$implicit;m(),N("(\u6D41\u6C34\u5E33 #",t.entry_id,")")}}function yB(n,e){if(n&1&&(l(0,"div",222)(1,"div",223)(2,"span",59),d(3),s(),M(4,hB,2,1,"span",224),s(),l(5,"div",225)(6,"span",226),d(7),s()()()),n&2){let t=e.$implicit,i=_(6);m(3),w(t.reference_note),m(),A(t.entry_id?4:-1),m(2),j("text-green-600",t.amount<0)("text-red-600",t.amount>0),m(),Qe(" ",t.amount>=0?"+":"","",i.formatCurrency(t.amount)," ")}}function _B(n,e){if(n&1&&(l(0,"tr",217)(1,"td",218)(2,"details",219)(3,"summary",220),d(4),s(),l(5,"div",221),V(6,yB,8,8,"div",222,XL),s()()()()),n&2){let t=_().$implicit;m(4),N(" \u67E5\u770B\u8A72\u6708\u660E\u7D30\uFF08\u5171 ",t.records.length," \u7B46\u8A18\u9304\uFF09 "),m(2),L(t.records)}}function vB(n,e){if(n&1&&(l(0,"tr",212)(1,"td",213),d(2),s(),l(3,"td",214),d(4),s(),l(5,"td",215),d(6),s(),l(7,"td",216),d(8),s()(),M(9,_B,8,1,"tr",217)),n&2){let t=e.$implicit,i=_(4);m(2),N(" ",i.formatDateYM(t.source_month)," "),m(2),N(" ",i.formatCurrency(t.total_salary)," "),m(2),N(" ",i.formatCurrency(t.paid_amount)," "),m(),j("text-red-600",t.payable_amount>0)("text-gray-400",t.payable_amount<=0),m(),N(" ",i.formatCurrency(t.payable_amount)," "),m(),A(t.records.length>1?9:-1)}}function CB(n,e){if(n&1&&(l(0,"div",40)(1,"table",203)(2,"thead")(3,"tr",204)(4,"th",205),d(5,"\u65E5\u671F"),s(),l(6,"th",206),d(7,"\u85AA\u6C34"),s(),l(8,"th",206),d(9,"\u5BE6\u969B\u4ED8\u6B3E"),s(),l(10,"th",206),d(11,"\u61C9\u4ED8\u85AA\u8CC7"),s()()(),l(12,"tbody"),V(13,vB,10,9,null,null,ZL),s(),l(15,"tfoot")(16,"tr",207)(17,"td",208),d(18,"\u7E3D\u8A08"),s(),l(19,"td",209),d(20),s(),l(21,"td",210),d(22),s(),l(23,"td",211),d(24),s()()()()()),n&2){let t=_(3);m(13),L(t.payablesDetails().monthly_summary),m(7),N(" ",t.formatCurrency(t.calculateTotalSalary(t.payablesDetails().monthly_summary))," "),m(2),N(" ",t.formatCurrency(t.calculateTotalPaid(t.payablesDetails().monthly_summary))," "),m(2),N(" ",t.formatCurrency(t.payablesDetails().total_payable)," ")}}function xB(n,e){if(n&1&&M(0,gB,2,0,"div",202)(1,CB,25,3,"div",40),n&2){let t=_(2);A(t.payablesDetails().monthly_summary.length===0?0:1)}}function bB(n,e){if(n&1){let t=B();l(0,"div",19)(1,"div",194)(2,"div",195)(3,"div")(4,"h3",31),d(5),s(),l(6,"p",196),d(7," \u7D2F\u8A08\u61C9\u4ED8\uFF1A"),l(8,"span",197),d(9),s()()(),l(10,"button",198),b("click",function(){E(t);let r=_();return S(r.closePayablesDetailModal())}),x(11,"ion-icon",78),s()(),l(12,"div",199),M(13,fB,3,0,"div",26)(14,xB,2,1),s(),l(15,"div",200)(16,"button",201),b("click",function(){E(t);let r=_();return S(r.closePayablesDetailModal())}),d(17," \u95DC\u9589 "),s()()()()}if(n&2){let t,i,r=_();m(5),N(" ",(t=r.payablesDetails())==null?null:t.employee_name," - \u61C9\u4ED8\u85AA\u8CC7\u660E\u7D30 "),m(4),w(r.formatCurrency(((i=r.payablesDetails())==null?null:i.total_payable)||0)),m(4),A(r.payablesDetailsLoading()?13:r.payablesDetails()?14:-1)}}function EB(n,e){n&1&&(l(0,"p",232),d(1,"\u5FC5\u586B\u6B04\u4F4D"),s())}function SB(n,e){n&1&&(l(0,"p",232),d(1,"\u91D1\u984D\u4E0D\u80FD\u70BA\u8CA0\u6578"),s())}function DB(n,e){if(n&1){let t=B();l(0,"div",20)(1,"div",227)(2,"h3",228),d(3),s(),l(4,"form",185),b("ngSubmit",function(){E(t);let r=_();return S(r.confirmMonthlySalaryAdjust())}),l(5,"div",229)(6,"label",230),d(7,"\u8ABF\u6574\u5F8C\u85AA\u8CC7"),s(),x(8,"input",231),M(9,EB,2,0,"p",232),M(10,SB,2,0,"p",232),s(),l(11,"div",191)(12,"button",233),b("click",function(){E(t);let r=_();return S(r.closeMonthlySalaryAdjustModal())}),d(13," \u53D6\u6D88 "),s(),l(14,"button",234),d(15," \u78BA\u8A8D\u8ABF\u6574 "),s()()()()()}if(n&2){let t,i,r,o=_();m(3),N("",(t=o.adjustingMonthlySalarySummary())==null?null:t.display_name," \u85AA\u8CC7\u8ABF\u6574"),m(),I("formGroup",o.adjustingAmountForm),m(5),A(!((i=o.adjustingAmountForm.get("total_wage"))==null||i.errors==null)&&i.errors.required?9:-1),m(),A(!((r=o.adjustingAmountForm.get("total_wage"))==null||r.errors==null)&&r.errors.min?10:-1),m(4),I("disabled",!o.adjustingAmountForm.valid)}}function wB(n,e){n&1&&(l(0,"p",232),d(1,"\u5FC5\u586B\u6B04\u4F4D"),s())}function TB(n,e){n&1&&(l(0,"p",232),d(1,"\u91D1\u984D\u4E0D\u80FD\u70BA\u8CA0\u6578"),s())}function IB(n,e){n&1&&d(0," \u767C\u653E\u91D1\u984D\u4F4E\u65BC\u85AA\u8CC7\u7E3D\u984D\uFF0C\u5DEE\u984D\u5C07\u81EA\u52D5\u8A18\u9304\u5230\u61C9\u4ED8\u85AA\u8CC7\u79D1\u76EE ")}function MB(n,e){n&1&&d(0," \u767C\u653E\u91D1\u984D\u7B49\u65BC\u85AA\u8CC7\u7E3D\u984D\uFF0C\u5C07\u76F4\u63A5\u8A18\u9304\u5230\u85AA\u8CC7\u652F\u51FA\u79D1\u76EE ")}function AB(n,e){if(n&1){let t=B();l(0,"div",20)(1,"div",227)(2,"h3",228),d(3),s(),l(4,"form",185),b("ngSubmit",function(){E(t);let r=_();return S(r.confirmReleaseMonthlySalarySummary())}),l(5,"div",229)(6,"label",187),d(7,"\u54E1\u5DE5\u85AA\u8CC7\u7E3D\u984D"),s(),l(8,"div",235),d(9),s()(),l(10,"div",229)(11,"label",236),d(12,"\u767C\u653E\u91D1\u984D"),s(),x(13,"input",237),M(14,wB,2,0,"p",232),M(15,TB,2,0,"p",232),s(),l(16,"div",238)(17,"p",239)(18,"strong"),d(19,"\u8AAA\u660E\uFF1A"),s(),M(20,IB,1,0)(21,MB,1,0),s()(),l(22,"div",191)(23,"button",233),b("click",function(){E(t);let r=_();return S(r.closeMonthlySalaryReleaseModal())}),d(24," \u53D6\u6D88 "),s(),l(25,"button",240),d(26," \u78BA\u8A8D\u767C\u653E "),s()()()()()}if(n&2){let t,i,r,o,a,u,c=_();m(3),N("",(t=c.releasingMonthlySalarySummary())==null?null:t.display_name," \u85AA\u8CC7\u767C\u653E"),m(),I("formGroup",c.releasingAmountForm),m(5),N(" ",c.formatCurrency(((i=c.releasingMonthlySalarySummary())==null?null:i.total_wage)||0)," "),m(4),I("max",(r=c.releasingMonthlySalarySummary())==null?null:r.total_wage),m(),A(!((o=c.releasingAmountForm.get("release_amount"))==null||o.errors==null)&&o.errors.required?14:-1),m(),A(!((a=c.releasingAmountForm.get("release_amount"))==null||a.errors==null)&&a.errors.min?15:-1),m(5),A((((u=c.releasingAmountForm.get("release_amount"))==null?null:u.value)||0)<(((u=c.releasingMonthlySalarySummary())==null?null:u.total_wage)||0)?20:21),m(5),I("disabled",!c.releasingAmountForm.valid)}}function RB(n,e){n&1&&(l(0,"p",232),d(1,"\u5FC5\u586B\u6B04\u4F4D"),s())}function NB(n,e){n&1&&(l(0,"p",232),d(1,"\u5FC5\u586B\u6B04\u4F4D"),s())}function FB(n,e){if(n&1){let t=B();l(0,"div",19)(1,"div",241)(2,"div",75)(3,"h2",76),d(4),s(),l(5,"button",77),b("click",function(){E(t);let r=_();return S(r.closeDailyForm())}),x(6,"ion-icon",78),s()(),l(7,"form",242),b("ngSubmit",function(){E(t);let r=_();return S(r.saveDailyRecord())}),l(8,"div",243)(9,"div")(10,"label",112),d(11,"\u54E1\u5DE5 ID"),s(),x(12,"input",244),s(),l(13,"div")(14,"label",112),d(15,"\u54E1\u5DE5\u59D3\u540D"),s(),x(16,"input",245),s()(),l(17,"div")(18,"label",112),d(19,"\u5DE5\u4F5C\u65E5\u671F *"),s(),x(20,"input",246),M(21,RB,2,0,"p",232),s(),l(22,"div",243)(23,"div")(24,"label",112),d(25,"\u4E0A\u73ED\u6253\u5361\u6642\u9593"),s(),x(26,"input",247),s(),l(27,"div")(28,"label",112),d(29,"\u4E0B\u73ED\u6253\u5361\u6642\u9593"),s(),x(30,"input",248),s()(),l(31,"div",243)(32,"div")(33,"label",112),d(34,"\u57FA\u672C\u6642\u85AA *"),s(),x(35,"input",249),M(36,NB,2,0,"p",232),s(),l(37,"div")(38,"label",112),d(39,"\u500D\u6578"),s(),x(40,"input",250),s()(),l(41,"div")(42,"label",112),d(43,"\u7279\u6B8A\u734E\u91D1"),s(),x(44,"input",251),s(),l(45,"div",153),x(46,"input",252),l(47,"label",253),d(48,"\u7279\u6B8A\u65E5\u671F"),s()(),l(49,"div")(50,"label",112),d(51,"\u5099\u8A3B"),s(),x(52,"textarea",254),s(),l(53,"div",255)(54,"button",123),b("click",function(){E(t);let r=_();return S(r.closeDailyForm())}),d(55," \u53D6\u6D88 "),s(),l(56,"button",234),d(57),s()()()()()}if(n&2){let t,i,r=_();m(4),w(r.editingDaily()?"\u7DE8\u8F2F\u6253\u5361\u8A18\u9304":"\u65B0\u589E\u6253\u5361\u8A18\u9304"),m(3),I("formGroup",r.dailyForm),m(14),A(!((t=r.dailyForm.get("work_date"))==null||t.errors==null)&&t.errors.required?21:-1),m(15),A(!((i=r.dailyForm.get("base_wage"))==null||i.errors==null)&&i.errors.required?36:-1),m(20),I("disabled",!r.dailyForm.valid),m(),N(" ",r.editingDaily()?"\u66F4\u65B0":"\u65B0\u589E"," ")}}var Ka=class Ka{constructor(){this.apiService=k(we);this.router=k(Fe);this.fb=k(qe);this.activeTab=D("daily");this.currentDate=new Date;this.previousMonth=this.getPreviousMonth();this.selectedYear=D(this.previousMonth.year);this.selectedMonth=D(this.previousMonth.month);this.dailySummaries=D([]);this.dailyLoading=D(!1);this.dailyError=D("");this.monthlySummaryRecords=D([]);this.monthlySummaries=$(()=>{let e=this.dailySummaries(),t=this.getMonthlyWageUserIds(),i=new Map;return e.forEach(r=>{let o=new Date(r.work_date),a=o.getFullYear(),u=String(o.getMonth()+1).padStart(2,"0"),c=`${a}-${u}`,p=`${r.user_id}-${c}`,g=i.get(p)||{user_id:r.user_id,display_name:r.display_name,year_month:c,total_work_hours:0,total_wage:0,total_days:0,paid_days:0,missing_records:0,is_fully_verified:!0,is_fully_paid:!0,wage_type:t.has(r.user_id)?"monthly":r.wage_type||"hourly",entry_id:r.entry_id||void 0};g.total_work_hours+=this.toNumber(r.work_hours),g.total_wage+=this.toNumber(r.total_wage),g.total_days+=1,r.is_paid&&(g.paid_days+=1),(!r.clock_in_time||!r.clock_out_time)&&(g.missing_records+=1),r.is_verified||(g.is_fully_verified=!1),r.is_paid||(g.is_fully_paid=!1),r.entry_id&&!g.entry_id&&(g.entry_id=r.entry_id),i.set(p,g)}),Array.from(i.values()).sort((r,o)=>r.year_month===o.year_month?r.user_id-o.user_id:r.year_month.localeCompare(o.year_month))});this.hourlySummaries=$(()=>this.monthlySummaries().filter(e=>e.wage_type!=="monthly"));this.monthlySalarySummaries=$(()=>{let e=this.monthlySummaries().filter(y=>y.wage_type==="monthly"),t=this.monthlySalaryOverrides(),i=new Map(this.monthlySummaryRecords().map(y=>{let v=String(y.month).padStart(2,"0");return[`${y.user_id}-${y.year}-${v}`,y]})),r=this.selectedYear(),o=this.selectedMonth(),a=`${r}-${String(o).padStart(2,"0")}`,u=new Set(e.map(y=>y.user_id)),p=this.employeeWages().filter(y=>y.wage_type==="monthly").filter(y=>this.isWageEffectiveForMonth(y,r,o)).filter(y=>!u.has(y.user_id)).map(y=>({user_id:y.user_id,display_name:y.display_name||`ID: ${y.user_id}`,year_month:a,total_work_hours:0,total_wage:this.toNumber(y.hourly_rate),total_days:0,paid_days:0,missing_records:0,is_fully_verified:!1,is_fully_paid:!1,wage_type:"monthly",entry_id:void 0}));return[...e,...p].map(y=>{let v=`${y.user_id}-${y.year_month}`,C=i.get(v),T=t.get(v);return G(O({},y),{display_name:C?.display_name||y.display_name,total_work_hours:C?.total_work_hours||y.total_work_hours,total_wage:C?.total_wage||y.total_wage,is_fully_verified:T?.is_fully_verified??C?.is_closed??y.is_fully_verified,is_fully_paid:T?.is_fully_paid??C?.is_paid??y.is_fully_paid,entry_id:T?.entry_id??C?.entry_id??y.entry_id})}).sort((y,v)=>y.user_id-v.user_id)});this.monthlyDetailsVisible=D(!1);this.monthlyDetailsRows=D([]);this.monthlyDetailsTitle=D("");this.currentMonthlySummary=D(null);this.selectedRows=D([]);this.dailyFormVisible=D(!1);this.editingDaily=D(null);this.employeeWages=D([]);this.wagesLoading=D(!1);this.wagesError=D("");this.specialDates=D([]);this.specialLoading=D(!1);this.specialError=D("");this.specialFormVisible=D(!1);this.editingSpecial=D(null);this.downloadingReports=D(new Set);this.wagesFormVisible=D(!1);this.editingWage=D(null);this.monthlySalaryReleaseModalVisible=D(!1);this.releasingMonthlySalarySummary=D(null);this.monthlySalaryOverrides=D(new Map);this.monthlySalaryAdjustModalVisible=D(!1);this.adjustingMonthlySalarySummary=D(null);this.payablesSummary=D({total_payable:0,employees:[]});this.payablesLoading=D(!1);this.payablesError=D("");this.payablesDetailModalVisible=D(!1);this.payablesDetails=D(null);this.payablesDetailsLoading=D(!1);this.payablesPaymentModalVisible=D(!1);this.payingEmployee=D(null);this.payablesPaymentSubmitting=D(!1);this.dailyStats=$(()=>{let e=[...this.hourlySummaries(),...this.monthlySalarySummaries()],t=this.dailySummaries();return{totalRecords:e.length,totalWages:e.reduce((i,r)=>i+(Number(r.total_wage)||0),0),verifiedCount:e.filter(i=>i.is_fully_verified).length,paidCount:e.filter(i=>i.is_fully_paid).length,specialDayCount:t.filter(i=>i.is_special_day).length}});this.dailyForm=this.fb.group({user_id:["",U.required],display_name:["",U.required],work_date:["",U.required],clock_in_time:[""],clock_out_time:[""],work_hours:[""],regular_hours:[""],overtime_hours:[""],base_wage:["",U.required],multiplier:[1],regular_wage:[""],overtime_wage:[""],special_bonus:[0],total_wage:["",U.required],is_special_day:[!1],notes:[""]}),this.wageForm=this.fb.group({user_id:["",U.required],display_name:[""],hourly_rate:["",U.required],wage_type:["hourly"],effective_from:["",U.required],effective_to:[""],notes:[""]}),this.releasingAmountForm=this.fb.group({release_amount:["",[U.required,U.min(0)]]}),this.adjustingAmountForm=this.fb.group({total_wage:["",[U.required,U.min(0)]]}),this.payablesPaymentForm=this.fb.group({pay_amount:[0,[U.required,U.min(0)]],remark:[""]}),Bn(()=>{let e=this.activeTab();e==="daily"?(this.loadDailySummaries(),this.loadMonthlySummaries(),this.loadEmployeeWages()):e==="wages"?this.loadEmployeeWages():e==="special"?this.loadSpecialDates():e==="payables"&&this.loadPayablesSummary()})}getMonthlyWageUserIds(){let e=this.selectedYear(),t=this.selectedMonth(),i=this.employeeWages().filter(r=>r.wage_type==="monthly").filter(r=>this.isWageEffectiveForMonth(r,e,t)).map(r=>r.user_id);return new Set(i)}isWageEffectiveForMonth(e,t,i){let r=new Date(t,i-1,1),o=new Date(t,i,0),a=e.effective_from?new Date(e.effective_from):null,u=e.effective_to?new Date(e.effective_to):null;return!(a&&a>o||u&&u<r)}async loadSpecialDates(){this.specialLoading.set(!0),this.specialError.set("");try{let e=await this.apiService.getSpecialDates({year:this.selectedYear()});if(e.success&&e.data){let t=e.data.sort((i,r)=>new Date(i.date).getTime()-new Date(r.date).getTime());this.specialDates.set(t)}else this.specialError.set(e.error||"\u8F09\u5165\u7279\u6B8A\u5DE5\u4F5C\u65E5\u5931\u6557")}catch(e){this.specialError.set(e?.message||"\u8F09\u5165\u5931\u6557"),console.error("Error loading special dates:",e)}finally{this.specialLoading.set(!1)}}async saveSpecialDate(e){try{let t=this.editingSpecial(),i;t?i=await this.apiService.updateSpecialDate(t.id,e):i=await this.apiService.createSpecialDate(e),i.success?(alert(t?"\u66F4\u65B0\u6210\u529F":"\u65B0\u589E\u6210\u529F"),this.specialFormVisible.set(!1),this.loadSpecialDates()):alert("\u64CD\u4F5C\u5931\u6557: "+(i.error||"\u672A\u77E5\u932F\u8AA4"))}catch(t){alert("\u64CD\u4F5C\u5931\u6557: "+t?.message)}}async deleteSpecialDate(e){if(confirm("\u78BA\u5B9A\u8981\u522A\u9664\u6B64\u7279\u6B8A\u5DE5\u4F5C\u65E5\u8A2D\u5B9A\u55CE\uFF1F"))try{let t=await this.apiService.deleteSpecialDate(e);t.success?(alert("\u522A\u9664\u6210\u529F"),this.loadSpecialDates()):alert("\u522A\u9664\u5931\u6557: "+(t.error||"\u672A\u77E5\u932F\u8AA4"))}catch(t){alert("\u522A\u9664\u5931\u6557: "+t?.message)}}openSpecialForm(e){if(e){let t=G(O({},e),{date:this.formatDateYMD(e.date)});this.editingSpecial.set(t)}else this.editingSpecial.set(null);this.specialFormVisible.set(!0)}closeSpecialForm(){this.specialFormVisible.set(!1),this.editingSpecial.set(null)}async downloadLaborReport(e,t){t.stopPropagation();let i=`${e.user_id}-${e.year_month}`;if(this.downloadingReports().has(i))return;let r=new Set(this.downloadingReports());r.add(i),this.downloadingReports.set(r);try{let o=await this.apiService.downloadLaborReport(e.user_id,e.year_month),a=o.body||new Blob,u=o.headers.get("Content-Disposition")||"",c=u.match(/filename\*=UTF-8''([^;]+)/i),p=u.match(/filename="?([^";]+)"?/i),g="labor-report.zip";if(c?.[1])try{g=decodeURIComponent(c[1])}catch{g=c[1]}else p?.[1]&&(g=p[1]);let y=window.URL.createObjectURL(a),v=document.createElement("a");v.href=y,v.download=g,document.body.appendChild(v),v.click(),document.body.removeChild(v),window.URL.revokeObjectURL(y)}catch(o){alert("\u4E0B\u8F09\u52DE\u5831\u55AE\u5931\u6557: "+(o?.message||"\u672A\u77E5\u932F\u8AA4")),console.error("Error downloading labor report:",o)}finally{let o=new Set(this.downloadingReports());o.delete(i),this.downloadingReports.set(o)}}toNumber(e){if(e==null||e==="")return 0;let t=Number(e);return Number.isFinite(t)?t:0}toDateInput(e){if(!e)return"";let t=new Date(e);if(Number.isNaN(t.getTime()))return typeof e=="string"&&e.includes("T")?e.split("T")[0]:typeof e=="string"?e:"";let i=t.getFullYear(),r=String(t.getMonth()+1).padStart(2,"0"),o=String(t.getDate()).padStart(2,"0");return`${i}-${r}-${o}`}toTimeInput(e){if(!e)return"";let t=new Date(e);if(!Number.isNaN(t.getTime())){let i=String(t.getHours()).padStart(2,"0"),r=String(t.getMinutes()).padStart(2,"0");return`${i}:${r}`}return typeof e=="string"?e.includes("T")?(e.split("T")[1]||"").slice(0,5):e.slice(0,5):""}combineDateTime(e,t){if(!t)return null;let i=this.toDateInput(e),r=new Date(`${i}T${t}:00`);if(isNaN(r.getTime()))return null;let o=r.getFullYear(),a=String(r.getMonth()+1).padStart(2,"0"),u=String(r.getDate()).padStart(2,"0"),c=String(r.getHours()).padStart(2,"0"),p=String(r.getMinutes()).padStart(2,"0"),g=String(r.getSeconds()).padStart(2,"0"),y=-r.getTimezoneOffset(),v=String(Math.floor(Math.abs(y)/60)).padStart(2,"0"),C=String(Math.abs(y)%60).padStart(2,"0"),T=y>=0?"+":"-";return`${o}-${a}-${u}T${c}:${p}:${g}${T}${v}:${C}`}calculateWorkHours(e,t){if(!e||!t)return 0;try{let i=new Date(e),r=new Date(t);if(isNaN(i.getTime())){let u=e.replace(/ /g,"T").split("+")[0];i=new Date(u)}if(isNaN(r.getTime())){let u=t.replace(/ /g,"T").split("+")[0];r=new Date(u)}if(isNaN(i.getTime())||isNaN(r.getTime()))return 0;let o=r.getTime()-i.getTime();return o<0&&(o+=1440*60*1e3),Math.floor(o/(1e3*60*60)*100)/100}catch{return 0}}calculateWage(e,t){if(e<=0)return 0;let i;if(e<=8)i=e*t;else{let r=8*t,o=(e-8)*t*1.34;i=r+o}return Math.floor(i)}normalizeDailySummary(e){return G(O({},e),{work_hours:this.toNumber(e.work_hours),regular_hours:this.toNumber(e.regular_hours),overtime_hours:this.toNumber(e.overtime_hours),base_wage:this.toNumber(e.base_wage),multiplier:this.toNumber(e.multiplier),regular_wage:this.toNumber(e.regular_wage),overtime_wage:this.toNumber(e.overtime_wage),special_bonus:this.toNumber(e.special_bonus),total_wage:this.toNumber(e.total_wage)})}normalizeEmployeeWage(e){return G(O({},e),{hourly_rate:this.toNumber(e.hourly_rate)})}getPreviousMonth(){let e=new Date,t=e.getMonth()+1,i=e.getFullYear();return t===1?(t=12,i--):t--,{year:i,month:t}}onMonthChange(){this.activeTab()==="daily"&&(this.loadDailySummaries(),this.loadMonthlySummaries())}resetFilter(){let e=this.getPreviousMonth();this.selectedYear.set(e.year),this.selectedMonth.set(e.month),this.onMonthChange()}async loadDailySummaries(){this.dailyLoading.set(!0),this.dailyError.set("");try{let e=await this.apiService.getDailySummaries({year:this.selectedYear(),month:this.selectedMonth(),limit:1e3});if(e.success&&e.data){let t=e.data.map(i=>this.normalizeDailySummary(i));this.dailySummaries.set(t)}else this.dailyError.set(e.error||"\u8F09\u5165\u8CC7\u6599\u5931\u6557")}catch(e){this.dailyError.set(e?.message||"\u8F09\u5165\u5931\u6557"),console.error("Error loading daily summaries:",e)}finally{this.dailyLoading.set(!1)}}async loadMonthlySummaries(){try{let e=await this.apiService.getMonthlySummaries({year:this.selectedYear(),month:this.selectedMonth()});if(e.success&&e.data){let t=e.data.map(i=>G(O({},i),{total_work_hours:this.toNumber(i.total_work_hours),total_wage:this.toNumber(i.total_wage)}));this.monthlySummaryRecords.set(t)}else this.monthlySummaryRecords.set([])}catch(e){console.error("Error loading monthly summaries:",e),this.monthlySummaryRecords.set([])}}openDailyForm(e){if(e){let t=this.normalizeDailySummary(e);this.editingDaily.set(t),this.dailyForm.patchValue(G(O({},t),{work_date:this.toDateInput(t.work_date)}))}else this.editingDaily.set(null),this.dailyForm.reset({multiplier:1,special_bonus:0,is_special_day:!1});this.dailyFormVisible.set(!0)}openMonthlyDetails(e){let i=this.dailySummaries().filter(r=>r.user_id===e.user_id).filter(r=>{let o=new Date(r.work_date),a=o.getFullYear(),u=String(o.getMonth()+1).padStart(2,"0");return`${a}-${u}`===e.year_month}).sort((r,o)=>new Date(r.work_date).getTime()-new Date(o.work_date).getTime()).map(r=>{let o=this.normalizeDailySummary(r),a=G(O({},o),{clock_in_time_input:this.toTimeInput(r.clock_in_time),clock_out_time_input:this.toTimeInput(r.clock_out_time)});if(r.clock_in_time&&r.clock_out_time&&(!o.work_hours||o.work_hours===0)){let u=r.clock_in_time,c=r.clock_out_time,p=this.calculateWorkHours(u,c),g=this.calculateWage(p,o.base_wage);a.work_hours=p,a.total_wage=g,console.log("[DEBUG] \u81EA\u52D5\u8A08\u7B97\u5DE5\u6642:",{work_date:r.work_date,clock_in_time:u,clock_out_time:c,calculated_hours:p,calculated_wage:g,base_wage:o.base_wage}),this.apiService.updateDailySummary(r.id,{work_hours:p,total_wage:g}).then(y=>{y.success?console.log("[DEBUG] \u81EA\u52D5\u4FDD\u5B58\u6210\u529F:",{id:r.id}):console.warn("[DEBUG] \u81EA\u52D5\u4FDD\u5B58\u5931\u6557:",y.error)}).catch(y=>{console.error("[DEBUG] \u81EA\u52D5\u4FDD\u5B58\u932F\u8AA4:",y)})}return a}).map(r=>{let o=this.combineDateTime(r.work_date,r.clock_in_time_input),a=this.combineDateTime(r.work_date,r.clock_out_time_input);if(o&&a){let u=new Date(o).getTime();if(new Date(a).getTime()<u){let[p,g,y]=r.work_date.split("-"),v=new Date(parseInt(p),parseInt(g)-1,parseInt(y)+1),C=`${v.getFullYear()}-${String(v.getMonth()+1).padStart(2,"0")}-${String(v.getDate()).padStart(2,"0")}`;a=this.combineDateTime(C,r.clock_out_time_input)}}if(o&&a){let u=this.calculateWorkHours(o,a),c=this.calculateWage(u,r.base_wage);return G(O({},r),{work_hours:u,total_wage:c})}return r});this.monthlyDetailsRows.set(i),this.currentMonthlySummary.set(e),this.monthlyDetailsTitle.set(`${e.display_name} - ${e.year_month}`),this.monthlyDetailsVisible.set(!0)}closeMonthlyDetails(){this.monthlyDetailsVisible.set(!1),this.monthlyDetailsRows.set([]),this.monthlyDetailsTitle.set(""),this.currentMonthlySummary.set(null),this.selectedRows.set([]),this.loadDailySummaries()}toggleRowSelection(e,t){let i=t.target.checked,r=this.selectedRows();i?this.selectedRows.set([...r,e]):this.selectedRows.set(r.filter(o=>o!==e))}toggleSelectAll(e){if(e.target.checked){let i=this.monthlyDetailsRows().filter(r=>!r.is_paid).map(r=>r.id);this.selectedRows.set(i)}else this.selectedRows.set([])}isRowSelected(e){return this.selectedRows().includes(e)}async batchVerifyRecords(){let e=this.selectedRows();if(e.length===0){alert("\u8ACB\u9078\u64C7\u8981\u6838\u5C0D\u7684\u8A18\u9304");return}if(confirm(`\u78BA\u5B9A\u8981\u6838\u5C0D\u9078\u4E2D\u7684 ${e.length} \u7B46\u8A18\u9304\u55CE\uFF1F`))try{let t=e.map(u=>this.apiService.updateDailySummary(u,{is_verified:!0})),r=(await Promise.all(t)).filter(u=>u.success).length,a=this.monthlyDetailsRows().map(u=>e.includes(u.id)?G(O({},u),{is_verified:!0}):u);this.monthlyDetailsRows.set(a),this.selectedRows.set([]),alert(`\u6210\u529F\u6838\u5C0D ${r} \u7B46\u8A18\u9304`)}catch(t){alert("\u6279\u91CF\u6838\u5C0D\u5931\u6557: "+t?.message)}}async batchReleaseRecords(){let e=this.selectedRows();if(e.length===0){alert("\u8ACB\u9078\u64C7\u8981\u767C\u653E\u7684\u8A18\u9304");return}let t=this.monthlyDetailsRows();if(e.filter(r=>{let o=t.find(a=>a.id===r);return o&&!o.is_verified}).length>0){alert("\u6709\u672A\u6838\u5C0D\u7684\u8A18\u9304\uFF0C\u8ACB\u5148\u6838\u5C0D\u5F8C\u518D\u767C\u653E");return}if(confirm(`\u78BA\u5B9A\u8981\u767C\u653E\u9078\u4E2D\u7684 ${e.length} \u7B46\u8A18\u9304\u55CE\uFF1F\u767C\u653E\u5F8C\u5C07\u7121\u6CD5\u518D\u7DE8\u8F2F\u3002`))try{let r=await this.apiService.batchReleasePayroll(e);if(!r.success||!r.data){alert("\u6279\u91CF\u767C\u653E\u5931\u6557: "+(r.error||"\u672A\u77E5\u932F\u8AA4"));return}let o=r.data.entry_id,u=this.monthlyDetailsRows().map(g=>e.includes(g.id)?G(O({},g),{is_paid:!0,entry_id:o}):g);this.monthlyDetailsRows.set(u);let p=this.dailySummaries().map(g=>e.includes(g.id)?G(O({},g),{is_paid:!0,entry_id:o}):g);this.dailySummaries.set(p),this.selectedRows.set([]),alert("\u6279\u91CF\u767C\u653E\u6210\u529F")}catch(r){alert("\u6279\u91CF\u767C\u653E\u5931\u6557: "+r?.message)}}updateMonthlyDetailDisplay(e){let t=this.combineDateTime(e.work_date,e.clock_in_time_input),i=this.combineDateTime(e.work_date,e.clock_out_time_input);if(console.log("[DEBUG] updateMonthlyDetailDisplay:",{work_date:e.work_date,clock_in_time_input:e.clock_in_time_input,clock_out_time_input:e.clock_out_time_input,clockInTime:t,clockOutTime:i,base_wage:e.base_wage}),t&&i){let r=new Date(t).getTime();if(new Date(i).getTime()<r){let[a,u,c]=e.work_date.split("-"),p=new Date(parseInt(a),parseInt(u)-1,parseInt(c)+1),g=`${p.getFullYear()}-${String(p.getMonth()+1).padStart(2,"0")}-${String(p.getDate()).padStart(2,"0")}`;i=this.combineDateTime(g,e.clock_out_time_input),console.log("[DEBUG] \u5075\u6E2C\u5230\u8DE8\u65E5\u73ED\u6B21\uFF0C\u4E0B\u73ED\u65E5\u671F\u8ABF\u6574\u70BA:",g)}}if(t&&i){let r=this.calculateWorkHours(t,i),o=this.calculateWage(r,e.base_wage);console.log("[DEBUG] \u8A08\u7B97\u7D50\u679C:",{newWorkHours:r,newTotalWage:o}),e.work_hours=r,e.total_wage=o,this.monthlyDetailsRows.set([...this.monthlyDetailsRows()])}else console.warn("[DEBUG] clockInTime \u6216 clockOutTime \u7121\u6548",{clockInTime:t,clockOutTime:i})}async saveMonthlyDetail(e){let t=this.combineDateTime(e.work_date,e.clock_in_time_input),i=this.combineDateTime(e.work_date,e.clock_out_time_input);if(t&&i){let u=new Date(t).getTime();if(new Date(i).getTime()<u){let[p,g,y]=e.work_date.split("-"),v=new Date(parseInt(p),parseInt(g)-1,parseInt(y)+1),C=`${v.getFullYear()}-${String(v.getMonth()+1).padStart(2,"0")}-${String(v.getDate()).padStart(2,"0")}`;i=this.combineDateTime(C,e.clock_out_time_input)}}let r=this.calculateWorkHours(t,i),o=this.calculateWage(r,e.base_wage),a={clock_in_time:t,clock_out_time:i,work_hours:r,total_wage:o};try{let u=await this.apiService.updateDailySummary(e.id,a);u.success?(alert("\u66F4\u65B0\u6210\u529F"),this.loadDailySummaries()):alert("\u66F4\u65B0\u5931\u6557: "+(u.error||"\u672A\u77E5\u932F\u8AA4"))}catch(u){alert("\u66F4\u65B0\u5931\u6557: "+u?.message)}}async deleteMonthlyDetail(e){if(confirm(`\u78BA\u5B9A\u8981\u522A\u9664 ${e.display_name} \u5728 ${this.formatDateYMD(e.work_date)} \u7684\u6253\u5361\u8A18\u9304\u55CE\uFF1F`))try{let t=await this.apiService.deleteDailySummary(e.id);if(t.success){alert("\u522A\u9664\u6210\u529F"),this.loadDailySummaries();let i=this.monthlyDetailsRows();this.monthlyDetailsRows.set(i.filter(r=>r.id!==e.id))}else alert("\u522A\u9664\u5931\u6557: "+(t.error||"\u672A\u77E5\u932F\u8AA4"))}catch(t){alert("\u522A\u9664\u5931\u6557: "+t?.message)}}openCreateClockRecord(){let e=this.monthlyDetailsTitle();console.log("[DEBUG] openCreateClockRecord title:",e);let t=e.match(/(.+?)\s*-\s*(\d{4})-(\d{1,2})/)||e.match(/(.+) - (\d{4})-(\d{2})/),i=this.monthlyDetailsRows()[0];if(!i){alert("\u7121\u6CD5\u7372\u53D6\u54E1\u5DE5\u4FE1\u606F");return}let r=`${this.selectedYear()}-${String(this.selectedMonth()).padStart(2,"0")}-01`;if(t){let o=t[2],a=String(t[3]).padStart(2,"0");r=`${o}-${a}-01`}this.dailyForm.patchValue({user_id:i.user_id,display_name:i.display_name,work_date:r,base_wage:i.base_wage||200,total_wage:0,multiplier:1,special_bonus:0,is_special_day:!1}),this.editingDaily.set(null),this.dailyFormVisible.set(!0),console.log("[DEBUG] openCreateClockRecord - \u8868\u55AE\u5DF2\u6253\u958B")}async verifyMonthlyDetail(e){try{let t=await this.apiService.updateDailySummary(e.id,{is_verified:!e.is_verified});t.success?(alert(e.is_verified?"\u5DF2\u53D6\u6D88\u6838\u5C0D":"\u5DF2\u6838\u5C0D"),this.loadDailySummaries()):alert("\u64CD\u4F5C\u5931\u6557: "+(t.error||"\u672A\u77E5\u932F\u8AA4"))}catch(t){alert("\u64CD\u4F5C\u5931\u6557: "+t?.message)}}async releaseMonthlyDetail(e){try{let t=await this.apiService.updateDailySummary(e.id,{is_paid:!e.is_paid});t.success?(alert(e.is_paid?"\u5DF2\u53D6\u6D88\u767C\u653E":"\u5DF2\u767C\u653E"),this.loadDailySummaries()):alert("\u64CD\u4F5C\u5931\u6557: "+(t.error||"\u672A\u77E5\u932F\u8AA4"))}catch(t){alert("\u64CD\u4F5C\u5931\u6557: "+t?.message)}}closeDailyForm(){this.dailyFormVisible.set(!1),this.editingDaily.set(null),this.dailyForm.reset()}async saveDailyRecord(){if(!this.dailyForm.valid){alert("\u8ACB\u586B\u5BEB\u5FC5\u8981\u6B04\u4F4D");return}try{let e=this.dailyForm.value,t=this.editingDaily();if(!t&&this.dailySummaries().find(p=>p.user_id===e.user_id&&p.work_date===e.work_date)){alert(`\u8A72\u54E1\u5DE5\u5728 ${e.work_date} \u5DF2\u6709\u6253\u5361\u8A18\u9304\uFF0C\u8ACB\u5148\u522A\u9664\u5F8C\u91CD\u65B0\u65B0\u589E`);return}let i=null,r=null;if(e.work_date&&e.clock_in_time&&(i=this.combineDateTime(e.work_date,e.clock_in_time)),e.work_date&&e.clock_out_time&&(r=this.combineDateTime(e.work_date,e.clock_out_time)),i&&r){let c=new Date(i).getTime();if(new Date(r).getTime()<c){let[g,y,v]=e.work_date.split("-"),C=new Date(parseInt(g),parseInt(y)-1,parseInt(v)+1),T=`${C.getFullYear()}-${String(C.getMonth()+1).padStart(2,"0")}-${String(C.getDate()).padStart(2,"0")}`;r=this.combineDateTime(T,e.clock_out_time)}}let o=this.calculateWorkHours(i,r),a=this.calculateWage(o,e.base_wage||200),u={user_id:e.user_id,display_name:e.display_name,work_date:e.work_date,clock_in_time:i,clock_out_time:r,work_hours:o,base_wage:e.base_wage||200,multiplier:e.multiplier||1,special_bonus:e.special_bonus||0,total_wage:a,release_amount:a,is_special_day:e.is_special_day||!1,notes:e.notes||""};if(t){let c=await this.apiService.updateDailySummary(t.id,u);c.success?(alert("\u66F4\u65B0\u6210\u529F"),this.closeDailyForm(),this.loadDailySummaries()):alert("\u66F4\u65B0\u5931\u6557: "+(c.error||"\u672A\u77E5\u932F\u8AA4"))}else{let c=await this.apiService.createDailySummary(u);c.success?(alert("\u65B0\u589E\u6210\u529F"),this.closeDailyForm(),this.loadDailySummaries()):alert("\u65B0\u589E\u5931\u6557: "+(c.error||"\u672A\u77E5\u932F\u8AA4"))}}catch(e){alert("\u64CD\u4F5C\u5931\u6557: "+e?.message),console.error("Error saving daily record:",e)}}async deleteDailyRecord(e){if(confirm(`\u78BA\u5B9A\u8981\u522A\u9664 ${e.display_name} \u7684\u85AA\u8CC7\u7D00\u9304\u55CE?`))try{let t=await this.apiService.deleteDailySummary(e.id);t.success?(alert("\u522A\u9664\u6210\u529F"),this.loadDailySummaries()):alert("\u522A\u9664\u5931\u6557: "+(t.error||"\u672A\u77E5\u932F\u8AA4"))}catch(t){alert("\u522A\u9664\u5931\u6557: "+t?.message),console.error("Error deleting daily record:",t)}}async verifyDailyRecord(e){try{let t=await this.apiService.updateDailySummary(e.id,{is_verified:!e.is_verified,verified_by:"user",verified_at:e.is_verified?null:new Date().toISOString()});t.success?(alert(e.is_verified?"\u5DF2\u53D6\u6D88\u6838\u5C0D":"\u5DF2\u6838\u5C0D"),this.loadDailySummaries()):alert("\u64CD\u4F5C\u5931\u6557: "+(t.error||"\u672A\u77E5\u932F\u8AA4"))}catch(t){alert("\u64CD\u4F5C\u5931\u6557: "+t?.message)}}async releaseDailyRecord(e){try{let t=await this.apiService.updateDailySummary(e.id,{is_paid:!e.is_paid,paid_by:"user",paid_at:e.is_paid?null:new Date().toISOString()});t.success?(alert(e.is_paid?"\u5DF2\u53D6\u6D88\u767C\u653E":"\u5DF2\u767C\u653E"),this.loadDailySummaries()):alert("\u64CD\u4F5C\u5931\u6557: "+(t.error||"\u672A\u77E5\u932F\u8AA4"))}catch(t){alert("\u64CD\u4F5C\u5931\u6557: "+t?.message)}}async loadEmployeeWages(){this.wagesLoading.set(!0),this.wagesError.set("");try{let e=await this.apiService.getEmployeeWages({limit:1e3});if(e.success&&e.data){let t=e.data.map(i=>this.normalizeEmployeeWage(i));this.employeeWages.set(t)}else this.wagesError.set(e.error||"\u8F09\u5165\u8CC7\u6599\u5931\u6557")}catch(e){this.wagesError.set(e?.message||"\u8F09\u5165\u5931\u6557"),console.error("Error loading employee wages:",e)}finally{this.wagesLoading.set(!1)}}openWageForm(e){if(e){let t=this.normalizeEmployeeWage(e);this.editingWage.set(t),this.wageForm.patchValue(G(O({},t),{effective_from:this.toDateInput(t.effective_from),effective_to:this.toDateInput(t.effective_to)}))}else this.editingWage.set(null),this.wageForm.reset({wage_type:"hourly",effective_from:this.toDateInput(new Date)});this.wagesFormVisible.set(!0)}closeWageForm(){this.wagesFormVisible.set(!1),this.editingWage.set(null),this.wageForm.reset()}async saveWageRecord(){if(!this.wageForm.valid){alert("\u8ACB\u586B\u5BEB\u5FC5\u8981\u6B04\u4F4D");return}try{let e=this.wageForm.value,t=this.editingWage();if(t){let i=await this.apiService.updateEmployeeWage(t.id,e);i.success?(alert("\u66F4\u65B0\u6210\u529F"),this.closeWageForm(),this.loadEmployeeWages()):alert("\u66F4\u65B0\u5931\u6557: "+(i.error||"\u672A\u77E5\u932F\u8AA4"))}else{let i=await this.apiService.createEmployeeWage(e);i.success?(alert("\u65B0\u589E\u6210\u529F"),this.closeWageForm(),this.loadEmployeeWages()):alert("\u65B0\u589E\u5931\u6557: "+(i.error||"\u672A\u77E5\u932F\u8AA4"))}}catch(e){alert("\u64CD\u4F5C\u5931\u6557: "+e?.message),console.error("Error saving wage record:",e)}}async deleteWageRecord(e){if(confirm(`\u78BA\u5B9A\u8981\u522A\u9664 ${e.display_name||`ID: ${e.user_id}`} \u7684\u85AA\u8CC7\u8A2D\u5B9A\u55CE?`))try{let t=await this.apiService.deleteEmployeeWage(e.id);t.success?(alert("\u522A\u9664\u6210\u529F"),this.loadEmployeeWages()):alert("\u522A\u9664\u5931\u6557: "+(t.error||"\u672A\u77E5\u932F\u8AA4"))}catch(t){alert("\u522A\u9664\u5931\u6557: "+t?.message),console.error("Error deleting wage record:",t)}}formatCurrency(e){return e==null?"":e.toLocaleString("zh-TW",{style:"currency",currency:"TWD",minimumFractionDigits:0})}formatDate(e){if(!e)return"";try{return new Date(e).toLocaleDateString("zh-TW",{year:"numeric",month:"2-digit",day:"2-digit"})}catch{return e}}formatDateYMD(e){if(!e)return"";try{let t=new Date(e),i=t.getFullYear(),r=String(t.getMonth()+1).padStart(2,"0"),o=String(t.getDate()).padStart(2,"0");return`${i}-${r}-${o}`}catch{return e||""}}formatMonth(e){if(!e)return"";try{let t=new Date(e),i=t.getFullYear(),r=String(t.getMonth()+1).padStart(2,"0");return`${i}-${r}`}catch{return e}}formatDateYM(e){if(!e)return"";try{let t=new Date(e),i=t.getFullYear(),r=t.getMonth()+1;return`${i}\u5E74${r}\u6708`}catch{return e}}formatDateTime(e){if(!e)return"";try{return new Date(e).toLocaleString("zh-TW",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",hour12:!1})}catch{return e}}formatTime(e){if(!e)return"";try{return new Date(e).toLocaleTimeString("zh-TW",{hour:"2-digit",minute:"2-digit"})}catch{return e}}async verifyMonthlySalarySummary(e){if(confirm(`\u78BA\u5B9A\u8981\u6838\u5C0D ${e.display_name} (${e.year_month}) \u7684\u85AA\u8CC7\u55CE\uFF1F`))try{let[t,i]=e.year_month.split("-").map(Number),r=await this.apiService.verifyMonthlySalary(e.user_id,t,i);if(r.success){alert("\u6838\u5C0D\u6210\u529F");let o=`${e.user_id}-${e.year_month}`,a=new Map(this.monthlySalaryOverrides()),u=a.get(o)||{};a.set(o,G(O({},u),{is_fully_verified:!0})),this.monthlySalaryOverrides.set(a);let[c,p]=e.year_month.split("-").map(Number),g=this.monthlySummaryRecords(),y=!1,v=g.map(C=>C.user_id===e.user_id&&C.year===c&&C.month===p?(y=!0,G(O({},C),{is_closed:!0})):C);y||v.push({id:0,user_id:e.user_id,display_name:e.display_name,year:c,month:p,total_work_hours:e.total_work_hours,total_wage:e.total_wage,is_closed:!0,is_paid:!1,entry_id:e.entry_id||null}),this.monthlySummaryRecords.set(v)}else alert("\u6838\u5C0D\u5931\u6557: "+(r.error||"\u672A\u77E5\u932F\u8AA4"))}catch(t){alert("\u6838\u5C0D\u5931\u6557: "+t?.message)}}async releaseMonthlySalarySummary(e){this.releasingMonthlySalarySummary.set(e),this.releasingAmountForm.patchValue({release_amount:e.total_wage}),this.monthlySalaryReleaseModalVisible.set(!0)}openMonthlySalaryAdjust(e){if(e.is_fully_paid){alert("\u5DF2\u767C\u653E\u7684\u85AA\u8CC7\u7121\u6CD5\u8ABF\u6574");return}this.adjustingMonthlySalarySummary.set(e),this.adjustingAmountForm.patchValue({total_wage:e.total_wage}),this.monthlySalaryAdjustModalVisible.set(!0)}closeMonthlySalaryAdjustModal(){this.monthlySalaryAdjustModalVisible.set(!1),this.adjustingMonthlySalarySummary.set(null),this.adjustingAmountForm.reset()}async confirmMonthlySalaryAdjust(){if(!this.adjustingAmountForm.valid){alert("\u8ACB\u8F38\u5165\u6709\u6548\u7684\u85AA\u8CC7\u91D1\u984D");return}let e=this.adjustingMonthlySalarySummary();if(!e)return;let t=Number(this.adjustingAmountForm.get("total_wage")?.value);if(Number.isNaN(t)||t<0){alert("\u85AA\u8CC7\u91D1\u984D\u5FC5\u9808\u70BA 0 \u4EE5\u4E0A");return}if(confirm(`\u78BA\u5B9A\u8981\u8ABF\u6574 ${e.display_name} (${e.year_month}) \u7684\u85AA\u8CC7\u70BA ${this.formatCurrency(t)} \u55CE\uFF1F`))try{let[i,r]=e.year_month.split("-").map(Number),o=await this.apiService.updateMonthlySummary({user_id:e.user_id,year:i,month:r,total_wage:t,total_work_hours:e.total_work_hours,display_name:e.display_name});if(o.success&&o.data){alert("\u8ABF\u6574\u6210\u529F");let a=this.monthlySummaryRecords(),u=!1,c=a.map(p=>p.user_id===e.user_id&&p.year===i&&p.month===r?(u=!0,G(O({},p),{total_wage:t,total_work_hours:e.total_work_hours,display_name:e.display_name})):p);u||c.push({id:o.data.id||0,user_id:e.user_id,display_name:e.display_name,year:i,month:r,total_work_hours:e.total_work_hours,total_wage:t,is_closed:!1,is_paid:!1,entry_id:e.entry_id||null}),this.monthlySummaryRecords.set(c),this.closeMonthlySalaryAdjustModal()}else alert("\u8ABF\u6574\u5931\u6557: "+(o.error||"\u672A\u77E5\u932F\u8AA4"))}catch(i){alert("\u8ABF\u6574\u5931\u6557: "+i?.message)}}closeMonthlySalaryReleaseModal(){this.monthlySalaryReleaseModalVisible.set(!1),this.releasingMonthlySalarySummary.set(null),this.releasingAmountForm.reset()}async confirmReleaseMonthlySalarySummary(){if(!this.releasingAmountForm.valid){alert("\u8ACB\u8F38\u5165\u6709\u6548\u7684\u767C\u653E\u91D1\u984D");return}let e=this.releasingMonthlySalarySummary();if(!e)return;let t=Number(this.releasingAmountForm.get("release_amount")?.value);if(Number.isNaN(t)||t<0||t>e.total_wage){alert("\u767C\u653E\u91D1\u984D\u5FC5\u9808\u5728 0 \u5230 "+e.total_wage+" \u4E4B\u9593");return}if(confirm(`\u78BA\u5B9A\u8981\u767C\u653E ${e.display_name} (${e.year_month}) \u5171 ${this.formatCurrency(t)} \u55CE\uFF1F`))try{let[i,r]=e.year_month.split("-").map(Number),o=await this.apiService.releaseMonthlySalary(e.user_id,i,r,e.total_wage,e.total_work_hours,e.display_name,t);if(o.success&&o.data){alert(`\u767C\u653E\u6210\u529F (\u6D41\u6C34\u5E33: #${o.data.entry_id})`);let a=t>=e.total_wage,u=`${e.user_id}-${e.year_month}`,c=new Map(this.monthlySalaryOverrides()),p=c.get(u)||{};c.set(u,G(O({},p),{is_fully_paid:a,entry_id:o.data.entry_id})),this.monthlySalaryOverrides.set(c);let[g,y]=e.year_month.split("-").map(Number),v=this.monthlySummaryRecords(),C=!1,T=v.map(R=>R.user_id===e.user_id&&R.year===g&&R.month===y?(C=!0,G(O({},R),{is_paid:a,entry_id:o.data.entry_id})):R);C||T.push({id:0,user_id:e.user_id,display_name:e.display_name,year:g,month:y,total_work_hours:e.total_work_hours,total_wage:e.total_wage,is_closed:!0,is_paid:a,entry_id:o.data.entry_id}),this.monthlySummaryRecords.set(T),this.closeMonthlySalaryReleaseModal()}else alert("\u767C\u653E\u5931\u6557: "+(o.error||"\u672A\u77E5\u932F\u8AA4"))}catch(i){alert("\u767C\u653E\u5931\u6557: "+i?.message)}}getMonthLabel(){return`${this.selectedYear()}\u5E74${this.selectedMonth()}\u6708`}async loadPayablesSummary(){this.payablesLoading.set(!0),this.payablesError.set("");try{let e=await this.apiService.getPayrollPayablesSummary();e.success&&e.data?this.payablesSummary.set({total_payable:e.data.total_payable||0,employees:e.data.employees||[]}):this.payablesError.set(e.error||"\u8F09\u5165\u8CC7\u6599\u5931\u6557")}catch(e){this.payablesError.set(e?.message||"\u8F09\u5165\u5931\u6557"),console.error("Error loading payables summary:",e)}finally{this.payablesLoading.set(!1)}}async openPayablesDetail(e){this.payablesDetailModalVisible.set(!0),await this.loadPayablesDetails(e.employee_id)}openPayablesPaymentModal(e){this.payingEmployee.set(e),this.payablesPaymentForm.patchValue({pay_amount:0,remark:""}),this.payablesPaymentModalVisible.set(!0)}closePayablesPaymentModal(){this.payablesPaymentModalVisible.set(!1),this.payingEmployee.set(null),this.payablesPaymentForm.reset({pay_amount:0,remark:""}),this.payablesPaymentSubmitting.set(!1)}async submitPayablesPayment(){let e=this.payingEmployee();if(!e)return;let t=this.payablesPaymentForm.get("pay_amount")?.value,i=Number(t);if(Number.isNaN(i)){alert("\u8ACB\u8F38\u5165\u6709\u6548\u6578\u5B57");return}if(i<=0){alert("\u652F\u4ED8\u91D1\u984D\u9700\u5927\u65BC 0");return}if(i>e.total_payable){alert("\u652F\u4ED8\u91D1\u984D\u4E0D\u53EF\u5927\u65BC\u5F85\u652F\u4ED8\u85AA\u8CC7\u7E3D\u984D");return}if(!confirm(`\u78BA\u5B9A\u652F\u4ED8 ${e.employee_name} \u7684\u61C9\u4ED8\u85AA\u8CC7 ${this.formatCurrency(i)} \u55CE\uFF1F`))return;let o=String(this.payablesPaymentForm.get("remark")?.value||"").trim();this.payablesPaymentSubmitting.set(!0);try{let a=await this.apiService.payPayrollPayables({employee_id:e.employee_id,employee_name:e.employee_name,pay_amount:i,remark:o||void 0});if(a.success){alert("\u652F\u4ED8\u6210\u529F");let u=this.payablesDetails(),c=this.payablesDetailModalVisible()&&u?.employee_id===e.employee_id;this.closePayablesPaymentModal(),await this.loadPayablesSummary(),c&&await this.loadPayablesDetails(e.employee_id)}else alert("\u652F\u4ED8\u5931\u6557: "+(a.error||"\u672A\u77E5\u932F\u8AA4"))}catch(a){alert("\u652F\u4ED8\u5931\u6557: "+(a?.message||"\u672A\u77E5\u932F\u8AA4")),console.error("Error paying payroll payables:",a)}finally{this.payablesPaymentSubmitting.set(!1)}}async loadPayablesDetails(e){this.payablesDetailsLoading.set(!0);try{let t=await this.apiService.getPayrollPayablesDetails(e);console.log("\u61C9\u4ED8\u85AA\u8CC7\u660E\u7D30 API \u56DE\u61C9:",t),t.success&&t.data?(console.log("\u6708\u5EA6\u5F59\u7E3D\u8CC7\u6599:",t.data.monthly_summary),this.payablesDetails.set(t.data)):alert("\u8F09\u5165\u660E\u7D30\u5931\u6557: "+(t.error||"\u672A\u77E5\u932F\u8AA4"))}catch(t){alert("\u8F09\u5165\u660E\u7D30\u5931\u6557: "+t?.message),console.error("Error loading payables details:",t)}finally{this.payablesDetailsLoading.set(!1)}}closePayablesDetailModal(){this.payablesDetailModalVisible.set(!1),this.payablesDetails.set(null)}calculateTotalSalary(e){return e.reduce((t,i)=>t+i.total_salary,0)}calculateTotalPaid(e){return e.reduce((t,i)=>t+i.paid_amount,0)}getReleaseStatus(e){return e.is_fully_paid?"released":e.total_days>0?e.paid_days<=0?"unreleased":e.paid_days<e.total_days?"partial":"released":e.entry_id?"partial":"unreleased"}getReleaseStatusLabel(e){let t=this.getReleaseStatus(e);return t==="released"?"\u5DF2\u767C\u653E":t==="partial"?"\u90E8\u5206\u767C\u653E":"\u672A\u767C\u653E"}};Ka.\u0275fac=function(t){return new(t||Ka)},Ka.\u0275cmp=re({type:Ka,selectors:[["app-payroll"]],decls:32,vars:34,consts:[["specialDate",""],["specialName",""],["specialMultiplier",""],["specialActive",""],["specialNotes",""],[1,"space-y-6"],[1,"flex","flex-col","sm:flex-row","items-start","sm:items-center","justify-between","gap-4"],[1,"text-3xl","font-bold","text-gray-900"],[1,"bg-white","p-4","rounded-xl","shadow-md","border","border-gray-200","w-full","sm:w-auto"],[1,"flex","flex-col","sm:flex-row","items-center","gap-3"],[1,"flex","items-center","gap-2"],["title","\u91CD\u8A2D\u7BE9\u9078",1,"text-gray-500","hover:text-gray-800","transition-colors","p-2","rounded-full","bg-gray-100","hover:bg-gray-200",3,"click"],["name","refresh-outline",1,"text-xl"],[1,"flex","gap-4","border-b","border-gray-200"],[1,"px-4","py-3","text-sm","font-medium","text-gray-600","hover:text-gray-900","transition-colors",3,"click"],["name","calendar-outline",1,"text-base","align-middle","mr-2"],["name","people-outline",1,"text-base","align-middle","mr-2"],["name","star-outline",1,"text-base","align-middle","mr-2"],["name","wallet-outline",1,"text-base","align-middle","mr-2"],[1,"fixed","inset-0","bg-black","bg-opacity-50","flex","items-center","justify-center","z-50","p-4"],[1,"fixed","inset-0","bg-black","bg-opacity-50","flex","items-center","justify-center","z-50"],[1,"text-sm","font-medium","text-gray-600","whitespace-nowrap"],[1,"border-gray-300","rounded-lg","shadow-sm","focus:ring-indigo-500","focus:border-indigo-500","text-sm","p-2","bg-gray-100",3,"ngModelChange","change","ngModel"],[3,"value"],[1,"grid","grid-cols-2","md:grid-cols-4","gap-4"],[1,"bg-red-50","border","border-red-200","rounded-lg","p-4"],[1,"text-center","py-8"],[1,"bg-gray-50","rounded-lg","p-8","text-center"],[1,"bg-white","p-4","rounded-lg","shadow-md","border","border-gray-200"],[1,"text-xs","text-gray-500","mb-1"],[1,"text-2xl","font-semibold","text-gray-900"],[1,"text-lg","font-semibold","text-gray-900"],[1,"text-2xl","font-semibold","text-green-600"],[1,"text-2xl","font-semibold","text-blue-600"],[1,"text-sm","text-red-700"],[1,"text-gray-500"],[1,"bg-white","rounded-lg","shadow-md","overflow-hidden","mb-6"],[1,"bg-white","rounded-lg","shadow-md","overflow-hidden"],[1,"bg-blue-50","border-b","border-blue-200","px-4","py-2"],[1,"text-sm","font-semibold","text-blue-900"],[1,"overflow-x-auto"],[1,"w-full","text-sm"],[1,"bg-gray-100","border-b","border-gray-200"],[1,"px-4","py-3","text-left","font-semibold","text-gray-700"],[1,"px-4","py-3","text-right","font-semibold","text-gray-700"],[1,"px-4","py-3","text-center","font-semibold","text-gray-700"],[1,"divide-y","divide-gray-200"],["title","\u9EDE\u64CA\u67E5\u770B\u660E\u7D30",1,"hover:bg-indigo-50","transition-colors","cursor-pointer"],["title","\u9EDE\u64CA\u67E5\u770B\u660E\u7D30",1,"hover:bg-indigo-50","transition-colors","cursor-pointer",3,"click"],[1,"px-4","py-3"],[1,"px-4","py-3","font-medium"],[1,"px-4","py-3","text-right"],[1,"px-4","py-3","text-right","font-semibold"],[1,"px-4","py-3","text-center"],[1,"text-red-600","font-medium"],[1,"text-green-600"],[1,"inline-flex","items-center","px-2","py-1","rounded-full","text-xs","font-medium","bg-blue-100","text-blue-800"],[1,"inline-flex","items-center","px-2","py-1","rounded-full","text-xs","font-medium","bg-yellow-100","text-yellow-800"],[1,"inline-flex","items-center","px-2","py-1","rounded-full","text-xs","font-medium","bg-gray-100","text-gray-700"],[1,"text-gray-700"],[1,"text-gray-400"],["title","\u4E0B\u8F09\u52DE\u5831\u55AE",1,"px-3","py-1","bg-blue-500","text-white","text-xs","rounded","hover:bg-blue-600","disabled:bg-gray-300","disabled:cursor-not-allowed","transition-colors",3,"click","disabled"],["name","cash-outline",1,"mr-1"],["name","remove-circle-outline",1,"mr-1"],["name","ellipse-outline",1,"mr-1"],[1,"bg-green-50","border-b","border-green-200","px-4","py-2"],[1,"text-sm","font-semibold","text-green-900"],[1,"hover:bg-gray-50","transition-colors"],["title","\u8ABF\u6574\u7576\u6708\u85AA\u8CC7",1,"px-3","py-1","bg-gray-100","text-gray-700","rounded","text-xs","hover:bg-gray-200","disabled:bg-gray-300","disabled:text-gray-500","disabled:cursor-not-allowed","transition-colors",3,"click","disabled"],[1,"inline-flex","items-center","px-2","py-1","rounded-full","text-xs","font-medium","bg-green-100","text-green-800"],["title","\u6838\u5C0D\u6B64\u54E1\u5DE5\u85AA\u8CC7",1,"px-3","py-1","bg-green-600","text-white","rounded","text-xs","hover:bg-green-700","transition-colors"],["name","checkmark-done-outline",1,"mr-1"],["title","\u6838\u5C0D\u6B64\u54E1\u5DE5\u85AA\u8CC7",1,"px-3","py-1","bg-green-600","text-white","rounded","text-xs","hover:bg-green-700","transition-colors",3,"click"],[1,"text-gray-500","mb-4"],[1,"bg-white","rounded-lg","shadow-lg","max-w-6xl","w-full","max-h-[90vh]","overflow-y-auto"],[1,"sticky","top-0","bg-white","border-b","p-4","flex","justify-between","items-center"],[1,"text-lg","font-semibold"],[1,"text-gray-500","hover:text-gray-700",3,"click"],["name","close-outline",1,"text-2xl"],[1,"p-6"],[1,"mb-4","flex","gap-4","items-center","bg-gray-50","p-4","rounded-lg"],[1,"flex-1","text-sm","text-gray-600"],[1,"flex","gap-2"],[1,"px-4","py-2","bg-indigo-600","text-white","rounded-lg","hover:bg-indigo-700","disabled:bg-gray-300","disabled:cursor-not-allowed","transition-colors","flex","items-center","gap-2",3,"click","disabled"],["name","add-outline"],[1,"px-4","py-2","bg-green-600","text-white","rounded-lg","hover:bg-green-700","disabled:bg-gray-300","disabled:cursor-not-allowed","transition-colors","flex","items-center","gap-2",3,"click","disabled"],["name","checkmark-done-outline"],[1,"px-4","py-2","bg-blue-600","text-white","rounded-lg","hover:bg-blue-700","disabled:bg-gray-300","disabled:cursor-not-allowed","transition-colors","flex","items-center","gap-2",3,"click","disabled"],["name","cash-outline"],["type","checkbox",1,"rounded","border-gray-300","text-indigo-600","focus:ring-indigo-500",3,"change"],[1,"hover:bg-gray-50","transition-colors",3,"bg-green-50","opacity-60"],["type","checkbox",1,"rounded","border-gray-300","text-indigo-600","focus:ring-indigo-500","disabled:opacity-50",3,"change","checked","disabled"],["type","time",1,"w-36","px-3","py-2","border","border-gray-300","rounded-md","focus:outline-none","focus:ring-2","focus:ring-indigo-500","text-base","disabled:bg-gray-100","disabled:cursor-not-allowed",3,"ngModelChange","change","ngModel","disabled"],[1,"inline-flex","items-center","px-2","py-1","rounded-full","text-xs","font-medium","bg-gray-100","text-gray-600"],[1,"flex","items-center","justify-center","gap-2"],["title","\u4FDD\u5B58\u6253\u5361\u6642\u9593",1,"text-indigo-600","hover:text-indigo-800","transition-colors","disabled:text-gray-300","disabled:cursor-not-allowed",3,"click","disabled"],["name","save-outline",1,"text-xl"],["title","\u522A\u9664\u6253\u5361\u8A18\u9304",1,"text-red-600","hover:text-red-800","transition-colors","disabled:text-gray-300","disabled:cursor-not-allowed",3,"click","disabled"],["name","trash-outline",1,"text-xl"],[1,"flex","justify-end"],[1,"bg-indigo-600","text-white","px-4","py-2","rounded-lg","font-medium","hover:bg-indigo-700","transition-colors","flex","items-center","gap-2",3,"click"],[1,"inline-flex","items-center","px-2.5","py-0.5","rounded-full","text-xs","font-medium","bg-green-100","text-green-800"],[1,"inline-flex","items-center","px-2.5","py-0.5","rounded-full","text-xs","font-medium","bg-gray-100","text-gray-800"],["title","\u7DE8\u8F2F",1,"text-indigo-600","hover:text-indigo-800","transition-colors","mr-2",3,"click"],["name","pencil-outline"],["title","\u522A\u9664",1,"text-red-600","hover:text-red-800","transition-colors",3,"click"],["name","trash-outline"],[1,"bg-indigo-600","text-white","px-4","py-2","rounded-lg","font-medium","hover:bg-indigo-700","transition-colors",3,"click"],[1,"bg-white","rounded-lg","shadow-lg","max-w-2xl","w-full"],[1,"bg-white","border-b","p-4","flex","justify-between","items-center"],[1,"p-6","space-y-4",3,"formGroup"],[1,"grid","grid-cols-2","gap-4"],[1,"block","text-sm","font-medium","text-gray-700","mb-1"],["formControlName","user_id","type","number",1,"w-full","px-3","py-2","border","border-gray-300","rounded-lg","focus:outline-none","focus:ring-2","focus:ring-indigo-500",3,"readonly"],["formControlName","display_name","type","text",1,"w-full","px-3","py-2","border","border-gray-300","rounded-lg","focus:outline-none","focus:ring-2","focus:ring-indigo-500"],["formControlName","hourly_rate","type","number","step","0.01",1,"w-full","px-3","py-2","border","border-gray-300","rounded-lg","focus:outline-none","focus:ring-2","focus:ring-indigo-500"],["formControlName","wage_type",1,"w-full","px-3","py-2","border","border-gray-300","rounded-lg","focus:outline-none","focus:ring-2","focus:ring-indigo-500"],["value","hourly"],["value","monthly"],["formControlName","effective_from","type","date",1,"w-full","px-3","py-2","border","border-gray-300","rounded-lg","focus:outline-none","focus:ring-2","focus:ring-indigo-500"],["formControlName","effective_to","type","date",1,"w-full","px-3","py-2","border","border-gray-300","rounded-lg","focus:outline-none","focus:ring-2","focus:ring-indigo-500"],["formControlName","notes","rows","2",1,"w-full","px-3","py-2","border","border-gray-300","rounded-lg","focus:outline-none","focus:ring-2","focus:ring-indigo-500"],[1,"flex","justify-end","gap-3","pt-6","border-t"],["type","button",1,"px-4","py-2","border","border-gray-300","rounded-lg","text-gray-700","hover:bg-gray-50","transition-colors",3,"click"],["type","button",1,"px-4","py-2","bg-indigo-600","text-white","rounded-lg","hover:bg-indigo-700","transition-colors",3,"click"],[1,"flex","justify-between","items-center"],[1,"text-xl","font-semibold","text-gray-900"],[1,"px-4","py-2","bg-indigo-600","text-white","rounded-lg","hover:bg-indigo-700","transition-colors","flex","items-center","gap-2",3,"click"],[1,"bg-red-50","text-red-600","p-4","rounded-lg"],[1,"bg-white","rounded-xl","shadow-md","overflow-hidden"],[1,"w-full"],[1,"bg-gray-50","border-b","border-gray-200"],[1,"px-6","py-3","text-left","text-xs","font-medium","text-gray-500","uppercase","tracking-wider"],[1,"px-6","py-3","text-center","text-xs","font-medium","text-gray-500","uppercase","tracking-wider"],[1,"bg-white","divide-y","divide-gray-200"],[1,"hover:bg-gray-50"],["colspan","6",1,"px-6","py-8","text-center","text-gray-500"],[1,"px-6","py-4","whitespace-nowrap","text-sm","text-gray-900"],[1,"px-6","py-4","text-sm","text-gray-900"],[1,"px-6","py-4","whitespace-nowrap","text-sm","text-center"],[1,"inline-flex","items-center","px-2.5","py-0.5","rounded-full","text-xs","font-medium","bg-yellow-100","text-yellow-800"],[1,"px-6","py-4","text-sm","text-gray-500"],[1,"px-6","py-4","whitespace-nowrap","text-sm","text-center","space-x-2"],["title","\u7DE8\u8F2F",1,"text-indigo-600","hover:text-indigo-900",3,"click"],["name","create-outline",1,"text-lg","align-middle"],["title","\u522A\u9664",1,"text-red-600","hover:text-red-900",3,"click"],["name","trash-outline",1,"text-lg","align-middle"],[1,"bg-white","rounded-lg","shadow-xl","max-w-md","w-full"],[1,"text-lg","font-semibold","text-gray-900","mb-4"],[1,"space-y-4"],["type","date","required","",1,"w-full","px-3","py-2","border","border-gray-300","rounded-lg","focus:outline-none","focus:ring-2","focus:ring-indigo-500",3,"value"],["type","text","placeholder","\u4F8B\u5982\uFF1A\u6625\u7BC0\u3001\u570B\u6176\u65E5","required","",1,"w-full","px-3","py-2","border","border-gray-300","rounded-lg","focus:outline-none","focus:ring-2","focus:ring-indigo-500",3,"value"],["type","number","step","0.1","min","1","max","10","required","",1,"w-full","px-3","py-2","border","border-gray-300","rounded-lg","focus:outline-none","focus:ring-2","focus:ring-indigo-500",3,"value"],[1,"flex","items-center"],["type","checkbox",1,"rounded","border-gray-300","text-indigo-600","focus:ring-indigo-500",3,"checked"],[1,"ml-2","text-sm","text-gray-700"],["rows","3","placeholder","\u9078\u586B",1,"w-full","px-3","py-2","border","border-gray-300","rounded-lg","focus:outline-none","focus:ring-2","focus:ring-indigo-500",3,"value"],[1,"flex","justify-end","gap-3","mt-6","pt-6","border-t"],[1,"bg-gradient-to-r","from-red-500","to-pink-600","rounded-xl","shadow-lg","p-6","text-white"],[1,"text-sm","uppercase","tracking-wide","opacity-90","mb-2"],[1,"text-3xl","font-bold"],[1,"text-4xl","font-bold"],[1,"text-sm","mt-2","opacity-90"],[1,"px-6","py-4","border-b","border-gray-200"],[1,"px-6","py-3","text-right","text-xs","font-medium","text-gray-500","uppercase","tracking-wider"],[1,"hover:bg-gray-50","cursor-pointer","transition-colors"],["colspan","3",1,"px-6","py-8","text-center","text-gray-500"],[1,"hover:bg-gray-50","cursor-pointer","transition-colors",3,"click"],[1,"px-6","py-4","whitespace-nowrap"],[1,"flex-shrink-0","h-10","w-10","bg-indigo-100","rounded-full","flex","items-center","justify-center"],["name","person-outline",1,"text-indigo-600","text-xl"],[1,"ml-4"],[1,"text-sm","font-medium","text-gray-900"],[1,"text-xs","text-gray-500"],[1,"px-6","py-4","whitespace-nowrap","text-right"],[1,"text-sm","font-semibold","text-red-600"],[1,"px-6","py-4","whitespace-nowrap","text-center"],[1,"flex","items-center","justify-center","gap-4"],[1,"text-red-600","hover:text-red-800","font-medium","text-sm",3,"click"],[1,"text-indigo-600","hover:text-indigo-900","font-medium","text-sm",3,"click"],["name","chevron-forward-outline",1,"align-middle"],[1,"bg-white","rounded-xl","shadow-xl","w-full","max-w-md","p-6"],[1,"mb-4","p-3","bg-red-50","rounded-lg","border","border-red-100"],[1,"text-sm","text-gray-600"],[1,"text-xl","font-bold","text-red-600"],[3,"ngSubmit","formGroup"],[1,"mb-5"],[1,"block","text-sm","font-medium","text-gray-700","mb-2"],["type","number","formControlName","pay_amount","min","0","step","0.01","placeholder","\u8ACB\u8F38\u5165\u652F\u4ED8\u91D1\u984D",1,"w-full","px-3","py-2","border","border-gray-300","rounded-lg","focus:outline-none","focus:ring-2","focus:ring-red-500",3,"max"],[1,"text-xs","text-gray-500","mt-2"],["formControlName","remark","rows","3","placeholder","\u8ACB\u8F38\u5165\u5099\u8A3B\uFF08\u53EF\u9078\uFF09",1,"w-full","px-3","py-2","border","border-gray-300","rounded-lg","focus:outline-none","focus:ring-2","focus:ring-red-500"],[1,"flex","justify-end","gap-3"],["type","button",1,"px-4","py-2","rounded-lg","border","border-gray-300","text-gray-700","hover:bg-gray-50","transition-colors",3,"click"],["type","submit",1,"px-4","py-2","rounded-lg","bg-red-600","text-white","hover:bg-red-700","disabled:bg-gray-400","transition-colors",3,"disabled"],[1,"bg-white","rounded-lg","shadow-xl","max-w-5xl","w-full","max-h-[90vh]","overflow-hidden","flex","flex-col"],[1,"px-6","py-4","border-b","border-gray-200","flex","justify-between","items-center"],[1,"text-sm","text-gray-500","mt-1"],[1,"font-semibold","text-red-600"],[1,"text-gray-400","hover:text-gray-600","transition-colors",3,"click"],[1,"flex-1","overflow-y-auto","p-6"],[1,"px-6","py-4","border-t","border-gray-200","flex","justify-end"],[1,"px-4","py-2","bg-gray-600","text-white","rounded-lg","hover:bg-gray-700","transition-colors",3,"click"],[1,"text-center","py-8","text-gray-500"],[1,"w-full","border-collapse"],[1,"bg-gradient-to-r","from-indigo-50","to-blue-50","border-b-2","border-indigo-200"],[1,"px-4","py-3","text-left","text-sm","font-semibold","text-gray-700"],[1,"px-4","py-3","text-right","text-sm","font-semibold","text-gray-700"],[1,"bg-gradient-to-r","from-gray-50","to-gray-100","border-t-2","border-gray-300"],[1,"px-4","py-3","text-sm","font-bold","text-gray-900"],[1,"px-4","py-3","text-sm","text-right","font-bold","text-gray-900"],[1,"px-4","py-3","text-sm","text-right","font-bold","text-green-600"],[1,"px-4","py-3","text-sm","text-right","font-bold","text-red-600"],[1,"border-b","border-gray-200","hover:bg-gray-50","transition-colors"],[1,"px-4","py-3","text-sm","text-gray-900"],[1,"px-4","py-3","text-sm","text-right","font-medium","text-gray-900"],[1,"px-4","py-3","text-sm","text-right","text-green-600","font-medium"],[1,"px-4","py-3","text-sm","text-right","font-semibold"],[1,"bg-gray-50"],["colspan","4",1,"px-4","py-2"],[1,"text-xs","text-gray-600"],[1,"cursor-pointer","hover:text-indigo-600","font-medium"],[1,"mt-2","pl-4","space-y-1"],[1,"flex","justify-between","items-center","py-1","border-b","border-gray-200","last:border-0"],[1,"flex-1"],[1,"ml-2","text-gray-400"],[1,"text-right"],[1,"font-mono"],[1,"bg-white","rounded-lg","shadow-lg","p-6","w-96"],[1,"text-lg","font-bold","mb-4"],[1,"mb-4"],["for","adjustTotalWage",1,"block","text-sm","font-medium","text-gray-700","mb-2"],["id","adjustTotalWage","type","number","formControlName","total_wage","step","0.01","min","0","placeholder","\u8F38\u5165\u8ABF\u6574\u5F8C\u85AA\u8CC7",1,"w-full","px-3","py-2","border","border-gray-300","rounded-lg","focus:outline-none","focus:ring-2","focus:ring-indigo-500"],[1,"text-red-600","text-sm","mt-1"],["type","button",1,"px-4","py-2","bg-gray-300","text-gray-800","rounded-lg","hover:bg-gray-400","transition-colors",3,"click"],["type","submit",1,"px-4","py-2","bg-indigo-600","text-white","rounded-lg","hover:bg-indigo-700","disabled:bg-gray-300","disabled:cursor-not-allowed","transition-colors",3,"disabled"],[1,"text-2xl","font-bold","text-blue-600","mb-4"],["for","releaseAmount",1,"block","text-sm","font-medium","text-gray-700","mb-2"],["id","releaseAmount","type","number","formControlName","release_amount","step","0.01","min","0","placeholder","\u8F38\u5165\u767C\u653E\u91D1\u984D",1,"w-full","px-3","py-2","border","border-gray-300","rounded-lg","focus:outline-none","focus:ring-2","focus:ring-blue-500",3,"max"],[1,"mb-4","p-3","bg-orange-50","border","border-orange-200","rounded-lg"],[1,"text-sm","text-gray-700"],["type","submit",1,"px-4","py-2","bg-blue-600","text-white","rounded-lg","hover:bg-blue-700","disabled:bg-gray-300","disabled:cursor-not-allowed","transition-colors",3,"disabled"],[1,"bg-white","rounded-lg","shadow-lg","max-w-2xl","w-full","max-h-[90vh]","overflow-y-auto"],[1,"p-6","space-y-4",3,"ngSubmit","formGroup"],[1,"grid","grid-cols-1","md:grid-cols-2","gap-4"],["type","number","formControlName","user_id","readonly","",1,"w-full","px-3","py-2","border","border-gray-300","rounded-lg","bg-gray-100","text-gray-600"],["type","text","formControlName","display_name","readonly","",1,"w-full","px-3","py-2","border","border-gray-300","rounded-lg","bg-gray-100","text-gray-600"],["type","date","formControlName","work_date",1,"w-full","px-3","py-2","border","border-gray-300","rounded-lg","focus:outline-none","focus:ring-2","focus:ring-indigo-500"],["type","time","formControlName","clock_in_time",1,"w-full","px-3","py-2","border","border-gray-300","rounded-lg","focus:outline-none","focus:ring-2","focus:ring-indigo-500"],["type","time","formControlName","clock_out_time",1,"w-full","px-3","py-2","border","border-gray-300","rounded-lg","focus:outline-none","focus:ring-2","focus:ring-indigo-500"],["type","number","formControlName","base_wage","step","0.01",1,"w-full","px-3","py-2","border","border-gray-300","rounded-lg","focus:outline-none","focus:ring-2","focus:ring-indigo-500"],["type","number","formControlName","multiplier","step","0.01","min","0.5",1,"w-full","px-3","py-2","border","border-gray-300","rounded-lg","focus:outline-none","focus:ring-2","focus:ring-indigo-500"],["type","number","formControlName","special_bonus","step","0.01",1,"w-full","px-3","py-2","border","border-gray-300","rounded-lg","focus:outline-none","focus:ring-2","focus:ring-indigo-500"],["type","checkbox","formControlName","is_special_day","id","is_special_day",1,"rounded","border-gray-300","text-indigo-600","focus:ring-indigo-500"],["for","is_special_day",1,"ml-2","text-sm","font-medium","text-gray-700"],["formControlName","notes","rows","3",1,"w-full","px-3","py-2","border","border-gray-300","rounded-lg","focus:outline-none","focus:ring-2","focus:ring-indigo-500"],[1,"flex","justify-end","gap-3","pt-4","border-t"]],template:function(t,i){t&1&&(l(0,"div",5)(1,"div",6)(2,"h1",7),d(3,"\u85AA\u8CC7\u7BA1\u7406"),s(),l(4,"div",8)(5,"div",9),M(6,tO,6,2,"div",10)(7,rO,9,4,"div",10),l(8,"button",11),b("click",function(){return i.resetFilter()}),x(9,"ion-icon",12),s()()()(),l(10,"div",13)(11,"button",14),b("click",function(){return i.activeTab.set("daily")}),x(12,"ion-icon",15),d(13," \u6BCF\u6708\u85AA\u8CC7 "),s(),l(14,"button",14),b("click",function(){return i.activeTab.set("wages")}),x(15,"ion-icon",16),d(16," \u54E1\u5DE5\u85AA\u8CC7\u8A2D\u5B9A "),s(),l(17,"button",14),b("click",function(){return i.activeTab.set("special")}),x(18,"ion-icon",17),d(19," \u7279\u6B8A\u5DE5\u4F5C\u65E5 "),s(),l(20,"button",14),b("click",function(){return i.activeTab.set("payables")}),x(21,"ion-icon",18),d(22," \u61C9\u4ED8\u85AA\u8CC7 "),s()(),M(23,UO,7,6,"div",5),M(24,JO,10,5,"div",5),M(25,rB,11,4,"div",5),M(26,mB,9,4,"div",5),M(27,pB,25,7,"div",19),M(28,bB,18,3,"div",19),M(29,DB,16,5,"div",20),M(30,AB,27,8,"div",20),M(31,FB,58,6,"div",19),s()),t&2&&(m(6),A(i.activeTab()==="special"?6:7),m(5),j("border-b-2",i.activeTab()==="daily")("border-indigo-600",i.activeTab()==="daily")("text-indigo-600",i.activeTab()==="daily"),m(3),j("border-b-2",i.activeTab()==="wages")("border-indigo-600",i.activeTab()==="wages")("text-indigo-600",i.activeTab()==="wages"),m(3),j("border-b-2",i.activeTab()==="special")("border-indigo-600",i.activeTab()==="special")("text-indigo-600",i.activeTab()==="special"),m(3),j("border-b-2",i.activeTab()==="payables")("border-indigo-600",i.activeTab()==="payables")("text-indigo-600",i.activeTab()==="payables"),m(3),A(i.activeTab()==="daily"?23:-1),m(),A(i.activeTab()==="wages"?24:-1),m(),A(i.activeTab()==="special"?25:-1),m(),A(i.activeTab()==="payables"?26:-1),m(),A(i.payablesPaymentModalVisible()?27:-1),m(),A(i.payablesDetailModalVisible()?28:-1),m(),A(i.monthlySalaryAdjustModalVisible()?29:-1),m(),A(i.monthlySalaryReleaseModalVisible()?30:-1),m(),A(i.dailyFormVisible()?31:-1))},dependencies:[se,De,Ve,He,Ge,be,Bt,Xi,Oe,fe,ke,_o,Kl,Ie,Be,Le,Ue],encapsulation:2,changeDetection:0});var yp=Ka;function PB(n,e){if(n&1){let t=B();l(0,"tr",16)(1,"td",23)(2,"button",24),b("click",function(){let r=E(t).$index,o=_();return S(o.clearRecord(r))}),x(3,"ion-icon",25),s()(),l(4,"td",26),d(5),s(),l(6,"td",27),x(7,"input",28),s(),l(8,"td",27),x(9,"input",29),s(),l(10,"td",30),d(11),jt(12,"number"),s(),l(13,"td",31),x(14,"input",32),s(),l(15,"td",33),d(16),jt(17,"currency"),s()()}if(n&2){let t,i=e.$implicit,r=e.$index,o=_();I("formGroupName",r),m(5),Qe(" ",(t=i.get("date"))==null?null:t.value," (",o.getWeekday((t=i.get("date"))==null?null:t.value),") "),m(6),N(" ",un(12,5,o.calculateWorkHours(i),"1.2-2")," "),m(5),N(" ",sc(17,8,o.calculateSalary(i),"TWD","symbol","1.0-0")," ")}}var Qa=class Qa{constructor(){this.fb=k(qe);this.dataService=k(zn);this.router=k(Fe);this.route=k(mn);this.employee=D(null);this.year=D(0);this.month=D(0);this.payrollForm=this.fb.group({records:this.fb.array([])});this.initialFormValue="";this.totalHours=$(()=>this.records.controls.reduce((e,t)=>e+this.calculateWorkHours(t),0));this.totalSalary=$(()=>this.records.controls.reduce((e,t)=>e+this.calculateSalary(t),0));this.route.paramMap.pipe(lt(e=>{let t=e.get("employeeId"),i=Number(e.get("year")),r=Number(e.get("month"));if(!t||!i||!r){alert("\u7121\u6548\u7684\u7DB2\u5740\u53C3\u6578"),this.router.navigate(["/payroll"]);return}let o=this.dataService.getEmployeeById(t);if(!o){alert("\u627E\u4E0D\u5230\u54E1\u5DE5"),this.router.navigate(["/payroll"]);return}this.employee.set(o),this.year.set(i),this.month.set(r),this.buildForm(t,i,r)})).subscribe()}get records(){return this.payrollForm.get("records")}buildForm(e,t,i){let r=this.records;r.clear();let o=this.dataService.getPunchRecordsForMonth(e,t,i),a=new Date(t,i,0).getDate();for(let u=1;u<=a;u++){let c=`${t}-${String(i).padStart(2,"0")}-${String(u).padStart(2,"0")}`,p=o.find(y=>y.date===c),g=this.fb.group({date:[c],clockIn:[p?.clockIn||null],clockOut:[p?.clockOut||null],isDoublePay:[p?.isDoublePay||!1]});r.push(g)}this.initialFormValue=JSON.stringify(this.payrollForm.value)}getWeekday(e){return e?new Date(e+"T00:00:00").toLocaleDateString("zh-TW",{weekday:"short"}).replace("\u9031",""):""}calculateWorkHours(e){let{clockIn:t,clockOut:i}=e.value;if(!t||!i)return 0;let[r,o,a]=t.split(":").map(Number),[u,c,p]=i.split(":").map(Number),g=new Date(0,0,0,r,o,a||0),y=new Date(0,0,0,u,c,p||0);if(isNaN(g.getTime())||isNaN(y.getTime())||y<g)return 0;let C=(y.getTime()-g.getTime())/(1e3*60*60);return Math.floor(C*100)/100}calculateSalary(e){let t=this.calculateWorkHours(e),i=this.employee()?.hourlyRate||0,r=e.get("isDoublePay")?.value,o=t*i;return r&&(o*=2),o}onSave(){let e=this.employee()?.id;if(!e)return;let i=(this.payrollForm.value.records||[]).map(r=>({employeeId:e,date:r.date,clockIn:r.clockIn||null,clockOut:r.clockOut||null,isDoublePay:r.isDoublePay||!1}));this.dataService.updatePunchRecords(e,this.year(),this.month(),i),this.initialFormValue=JSON.stringify(this.payrollForm.value),alert("\u6253\u5361\u7D00\u9304\u5DF2\u5132\u5B58\uFF01"),this.router.navigate(["/payroll"])}goBack(){this.router.navigate(["/payroll"])}onCancel(){let e=JSON.stringify(this.payrollForm.value);this.initialFormValue===e?this.router.navigate(["/payroll"]):confirm("\u60A8\u6709\u672A\u5132\u5B58\u7684\u8B8A\u66F4\uFF0C\u78BA\u5B9A\u8981\u96E2\u958B\u55CE\uFF1F")&&this.router.navigate(["/payroll"])}clearRecord(e){confirm("\u662F\u5426\u6E05\u9664\u7576\u5929\u6253\u5361\u8CC7\u6599\uFF1F")&&this.records.at(e).patchValue({clockIn:null,clockOut:null,isDoublePay:!1})}};Qa.\u0275fac=function(t){return new(t||Qa)},Qa.\u0275cmp=re({type:Qa,selectors:[["app-payroll-detail"]],decls:47,vars:14,consts:[[1,"space-y-6","max-w-5xl","mx-auto"],[1,"flex","items-center","gap-4"],[1,"text-gray-500","hover:text-gray-800","transition-colors","p-2","rounded-full","bg-gray-100","hover:bg-gray-200",3,"click"],["name","arrow-back-outline",1,"text-2xl"],[1,"text-3xl","font-bold","text-gray-900"],[1,"text-lg","text-indigo-600","font-semibold"],[1,"bg-white","p-6","rounded-xl","shadow-md"],["novalidate","",3,"ngSubmit","formGroup"],[1,"overflow-x-auto"],[1,"w-full","text-sm","text-left","whitespace-nowrap"],[1,"text-xs","text-gray-700","uppercase","bg-gray-100"],[1,"px-2","py-3","w-12"],[1,"px-3","py-3"],[1,"px-3","py-3","text-center"],[1,"px-3","py-3","text-right"],["formArrayName","records"],[1,"border-b","hover:bg-gray-50",3,"formGroupName"],[1,"font-bold","bg-gray-100","text-base"],[1,"border-t-2"],["colspan","4",1,"px-3","py-3"],[1,"flex","items-center","justify-end","gap-4","pt-6","mt-6","border-t"],["type","button",1,"px-4","py-2","border","border-gray-300","rounded-md","shadow-sm","text-sm","font-medium","text-gray-700","bg-white","hover:bg-gray-50",3,"click"],["type","submit",1,"px-4","py-2","border","border-transparent","rounded-md","shadow-sm","text-sm","font-medium","text-white","bg-indigo-600","hover:bg-indigo-700"],[1,"px-2","py-2","text-center"],["type","button","title","\u6E05\u9664\u6B64\u884C",1,"text-red-500","hover:text-red-700","p-1","rounded-full","hover:bg-red-100","transition-colors",3,"click"],["name","close-circle-outline",1,"text-lg","align-middle"],[1,"px-3","py-2","font-medium"],[1,"px-3","py-2"],["type","time","step","1","formControlName","clockIn",1,"w-full","border-gray-200","rounded-md","shadow-sm","p-1","bg-gray-50","text-sm"],["type","time","step","1","formControlName","clockOut",1,"w-full","border-gray-200","rounded-md","shadow-sm","p-1","bg-gray-50","text-sm"],[1,"px-3","py-2","text-center","font-medium"],[1,"px-3","py-2","text-center"],["type","checkbox","formControlName","isDoublePay",1,"rounded","h-4","w-4","text-indigo-600","focus:ring-indigo-500","border-gray-300"],[1,"px-3","py-2","text-right","font-semibold"]],template:function(t,i){if(t&1&&(l(0,"div",0)(1,"div",1)(2,"button",2),b("click",function(){return i.goBack()}),x(3,"ion-icon",3),s(),l(4,"div")(5,"h1",4),d(6),s(),l(7,"p",5),d(8),s()()(),l(9,"div",6)(10,"form",7),b("ngSubmit",function(){return i.onSave()}),l(11,"div",8)(12,"table",9)(13,"thead",10)(14,"tr"),x(15,"th",11),l(16,"th",12),d(17,"\u65E5\u671F"),s(),l(18,"th",12),d(19,"\u4E0A\u73ED"),s(),l(20,"th",12),d(21,"\u4E0B\u73ED"),s(),l(22,"th",13),d(23,"\u5DE5\u6642"),s(),l(24,"th",13),d(25,"\u96D9\u500D\u85AA\u8CC7"),s(),l(26,"th",14),d(27,"\u85AA\u8CC7"),s()()(),l(28,"tbody",15),V(29,PB,18,13,"tr",16,Y),s(),l(31,"tfoot",17)(32,"tr",18)(33,"td",19),d(34,"\u7E3D\u8A08"),s(),l(35,"td",13),d(36),jt(37,"number"),s(),x(38,"td",12),l(39,"td",14),d(40),jt(41,"currency"),s()()()()(),l(42,"div",20)(43,"button",21),b("click",function(){return i.onCancel()}),d(44," \u53D6\u6D88 "),s(),l(45,"button",22),d(46," \u5132\u5B58\u8B8A\u66F4 "),s()()()()()),t&2){let r;m(6),N(" ",(r=i.employee())==null?null:r.name," - \u6253\u5361\u8A73\u7D30\u8CC7\u8A0A "),m(2),Qe("",i.year(),"\u5E74 ",i.month(),"\u6708"),m(2),I("formGroup",i.payrollForm),m(19),L(i.records.controls),m(7),w(un(37,6,i.totalHours(),"1.2-2")),m(4),w(sc(41,9,i.totalSalary(),"TWD","symbol","1.0-0"))}},dependencies:[se,Be,Ve,be,Xi,fe,ke,Le,Ue,qn,Wn,dl,ah],encapsulation:2,changeDetection:0});var _p=Qa;function kB(n,e){if(n&1&&(l(0,"option",22),d(1),s()),n&2){let t=e.$implicit;I("value",t),m(),N(" ",t," ")}}function VB(n,e){n&1&&(l(0,"div",23)(1,"div",24),d(2,"\u8F09\u5165\u4E2D..."),s()())}function LB(n,e){if(n&1&&(l(0,"div",25),d(1),s()),n&2){let t=_();m(),N(" ",t.error()," ")}}function OB(n,e){if(n&1){let t=B();l(0,"tr",34),b("click",function(){let r=E(t).$implicit,o=_(2);return S(o.openEditModal(r))}),l(1,"td",35),d(2),s(),l(3,"td",36)(4,"div",37)(5,"div",38),d(6),s()()(),l(7,"td",39),d(8),s(),l(9,"td",40)(10,"button",41),b("click",function(r){let o=E(t).$implicit;return _(2).openEditModal(o),S(r.stopPropagation())}),d(11," \u7DE8\u8F2F "),s()()()}if(n&2){let t=e.$implicit;m(2),w(t.id),m(4),w(t.employee_name),m(2),w(t.position||"-")}}function BB(n,e){n&1&&(l(0,"tr")(1,"td",42),d(2," \u76EE\u524D\u6C92\u6709\u54E1\u5DE5\u8CC7\u6599 "),s()())}function UB(n,e){if(n&1&&(l(0,"div",26)(1,"table",27)(2,"thead",28)(3,"tr")(4,"th",29),d(5,"ID"),s(),l(6,"th",29),d(7,"\u54E1\u5DE5\u59D3\u540D"),s(),l(8,"th",29),d(9,"\u8077\u7A31"),s(),l(10,"th",30),d(11,"\u64CD\u4F5C"),s()()(),l(12,"tbody",31),xt(13,OB,12,3,"tr",32)(14,BB,3,0,"tr",33),s()()()),n&2){let t=_();m(13),I("ngForOf",t.filteredEmployees()),m(),I("ngIf",t.filteredEmployees().length===0)}}function $B(n,e){if(n&1&&(l(0,"option",85),d(1),s()),n&2){let t,i=e.$implicit,r=_(2);I("ngValue",i.id)("disabled",((t=r.selectedEmployee())==null?null:t.id)===i.id),m(),Qe(" ",i.employee_name," (ID: ",i.id,") ")}}function HB(n,e){if(n&1){let t=B();l(0,"div",96)(1,"img",97),b("error",function(){E(t);let r=_(3);return S(r.onImageLoadError("front"))}),s(),l(2,"a",98),d(3," \u9810\u89BD\u5927\u5716 "),s()()}if(n&2){let t,i,r=_(3);m(),I("src",r.getImageUrl((t=r.selectedEmployee())==null?null:t.id_card_front),qt),m(),I("href",r.getImageUrl((i=r.selectedEmployee())==null?null:i.id_card_front),qt)}}function GB(n,e){if(n&1&&(l(0,"p",99),d(1),s()),n&2){let t,i=_(3);m(),N(" \u5DF2\u9078\u64C7: ",(t=i.selectedFrontFile())==null?null:t.name," ")}}function qB(n,e){if(n&1){let t=B();l(0,"button",100),b("click",function(){E(t);let r=_(3);return S(r.uploadFront())}),d(1),s()}if(n&2){let t=_(3);I("disabled",t.uploadingFront()),m(),N(" ",t.uploadingFront()?"\u4E0A\u50B3\u4E2D...":"\u78BA\u8A8D\u4E0A\u50B3\u6B63\u9762"," ")}}function WB(n,e){if(n&1&&(l(0,"p",101),d(1),s()),n&2){let t=_(3);m(),N("\u2713 ",t.uploadSuccessFront())}}function jB(n,e){if(n&1&&(l(0,"p",102),d(1),s()),n&2){let t=_(3);m(),w(t.uploadErrorFront())}}function zB(n,e){if(n&1){let t=B();l(0,"div",96)(1,"img",103),b("error",function(){E(t);let r=_(3);return S(r.onImageLoadError("back"))}),s(),l(2,"a",98),d(3," \u9810\u89BD\u5927\u5716 "),s()()}if(n&2){let t,i,r=_(3);m(),I("src",r.getImageUrl((t=r.selectedEmployee())==null?null:t.id_card_back),qt),m(),I("href",r.getImageUrl((i=r.selectedEmployee())==null?null:i.id_card_back),qt)}}function YB(n,e){if(n&1&&(l(0,"p",99),d(1),s()),n&2){let t,i=_(3);m(),N(" \u5DF2\u9078\u64C7: ",(t=i.selectedBackFile())==null?null:t.name," ")}}function JB(n,e){if(n&1){let t=B();l(0,"button",100),b("click",function(){E(t);let r=_(3);return S(r.uploadBack())}),d(1),s()}if(n&2){let t=_(3);I("disabled",t.uploadingBack()),m(),N(" ",t.uploadingBack()?"\u4E0A\u50B3\u4E2D...":"\u78BA\u8A8D\u4E0A\u50B3\u53CD\u9762"," ")}}function KB(n,e){if(n&1&&(l(0,"p",101),d(1),s()),n&2){let t=_(3);m(),N("\u2713 ",t.uploadSuccessBack())}}function QB(n,e){if(n&1&&(l(0,"p",102),d(1),s()),n&2){let t=_(3);m(),w(t.uploadErrorBack())}}function ZB(n,e){if(n&1){let t=B();l(0,"div",50)(1,"h4",51)(2,"span",52),d(3,"4"),s(),d(4," \u8EAB\u4EFD\u8B49\u5716\u7247 "),s(),l(5,"div",86)(6,"div",87)(7,"label",88),d(8,"\u8EAB\u4EFD\u8B49\u6B63\u9762"),s(),xt(9,HB,4,2,"div",89),l(10,"input",90,0),b("change",function(r){E(t);let o=_(2);return S(o.onFrontFileSelected(r))}),s(),l(12,"button",91),b("click",function(){E(t);let r=oe(11);return S(r.click())}),d(13),s(),xt(14,GB,2,1,"p",92)(15,qB,2,2,"button",93)(16,WB,2,1,"p",94)(17,jB,2,1,"p",95),s(),l(18,"div",87)(19,"label",88),d(20,"\u8EAB\u4EFD\u8B49\u53CD\u9762"),s(),xt(21,zB,4,2,"div",89),l(22,"input",90,1),b("change",function(r){E(t);let o=_(2);return S(o.onBackFileSelected(r))}),s(),l(24,"button",91),b("click",function(){E(t);let r=oe(23);return S(r.click())}),d(25),s(),xt(26,YB,2,1,"p",92)(27,JB,2,2,"button",93)(28,KB,2,1,"p",94)(29,QB,2,1,"p",95),s()()()}if(n&2){let t,i,r,o,a=_(2);m(9),I("ngIf",(t=a.selectedEmployee())==null?null:t.id_card_front),m(4),N(" ",(i=a.selectedEmployee())!=null&&i.id_card_front?"\u91CD\u65B0\u4E0A\u50B3\u6B63\u9762":"\u4E0A\u50B3\u6B63\u9762"," "),m(),I("ngIf",a.selectedFrontFile()),m(),I("ngIf",a.selectedFrontFile()),m(),I("ngIf",a.uploadSuccessFront()),m(),I("ngIf",a.uploadErrorFront()),m(4),I("ngIf",(r=a.selectedEmployee())==null?null:r.id_card_back),m(4),N(" ",(o=a.selectedEmployee())!=null&&o.id_card_back?"\u91CD\u65B0\u4E0A\u50B3\u53CD\u9762":"\u4E0A\u50B3\u53CD\u9762"," "),m(),I("ngIf",a.selectedBackFile()),m(),I("ngIf",a.selectedBackFile()),m(),I("ngIf",a.uploadSuccessBack()),m(),I("ngIf",a.uploadErrorBack())}}function XB(n,e){n&1&&(l(0,"div",104),d(1," \u65B0\u589E\u5B8C\u6210\u5F8C\uFF0C\u53EF\u5728\u300C\u7DE8\u8F2F\u300D\u6A21\u5F0F\u4E0A\u50B3\u8EAB\u4EFD\u8B49\u5716\u7247\u3002 "),s())}function eU(n,e){if(n&1&&(l(0,"div",6),d(1),jt(2,"date"),s()),n&2){let t,i=_(2);m(),N(" \u6700\u5F8C\u66F4\u65B0: ",un(2,1,(t=i.selectedEmployee())==null?null:t.updated_at,"yyyy-MM-dd HH:mm")," ")}}function tU(n,e){if(n&1){let t=B();l(0,"div",43),b("click",function(){E(t);let r=_();return S(r.closeEditModal())}),l(1,"div",44),b("click",function(r){return E(t),S(r.stopPropagation())}),l(2,"div",45)(3,"h3",46),d(4),s(),l(5,"button",47),b("click",function(){E(t);let r=_();return S(r.closeEditModal())}),d(6," \xD7 "),s()(),l(7,"div",48)(8,"form",49)(9,"div",50)(10,"h4",51)(11,"span",52),d(12,"1"),s(),d(13," \u57FA\u672C\u8CC7\u8A0A "),s(),l(14,"div",53)(15,"div")(16,"label",10),d(17,"\u54E1\u5DE5\u7DE8\u865F"),s(),x(18,"input",54),s(),l(19,"div")(20,"label",10),d(21,"\u54E1\u5DE5\u59D3\u540D "),l(22,"span",55),d(23,"*"),s()(),x(24,"input",56),s(),l(25,"div")(26,"label",10),d(27,"\u8077\u7A31"),s(),x(28,"input",57),s(),l(29,"div")(30,"label",10),d(31,"\u8EAB\u4EFD\u8B49\u5B57\u865F"),s(),x(32,"input",58),s(),l(33,"div")(34,"label",10),d(35,"\u4EE3\u7406\u4EBA"),s(),l(36,"select",59)(37,"option",60),d(38,"\u7121\u4EE3\u7406\u4EBA"),s(),xt(39,$B,2,4,"option",61),s()()()(),l(40,"div",50)(41,"h4",51)(42,"span",52),d(43,"2"),s(),d(44," \u806F\u7D61\u65B9\u5F0F "),s(),l(45,"div",53)(46,"div")(47,"label",10),d(48,"\u806F\u7D61\u96FB\u8A71"),s(),x(49,"input",62),s(),l(50,"div")(51,"label",10),d(52,"Email"),s(),x(53,"input",63),s(),l(54,"div",64)(55,"label",10),d(56,"\u6236\u7C4D\u5730\u5740"),s(),x(57,"input",65),s(),l(58,"div",64)(59,"label",10),d(60,"\u901A\u8A0A\u5730\u5740"),s(),x(61,"input",66),s()()(),l(62,"div",50)(63,"h4",51)(64,"span",52),d(65,"3"),s(),d(66," \u9280\u884C\u8CC7\u8A0A "),s(),l(67,"div",53)(68,"div")(69,"label",10),d(70,"\u4ED8\u6B3E\u65B9\u5F0F"),s(),l(71,"select",67)(72,"option",13),d(73,"\u8ACB\u9078\u64C7"),s(),l(74,"option",68),d(75,"\u73FE\u91D1"),s(),l(76,"option",69),d(77,"\u8F49\u5E33"),s(),l(78,"option",70),d(79,"\u652F\u7968"),s()()(),l(80,"div")(81,"label",10),d(82,"\u9280\u884C"),s(),x(83,"input",71),s(),l(84,"div")(85,"label",10),d(86,"\u5206\u884C"),s(),x(87,"input",72),s(),l(88,"div")(89,"label",10),d(90,"\u9280\u884C\u5E33\u865F"),s(),x(91,"input",73),s(),l(92,"div")(93,"label",10),d(94,"\u6236\u540D"),s(),x(95,"input",74),s()()(),xt(96,ZB,30,12,"div",75)(97,XB,2,0,"div",76),l(98,"div",50)(99,"h4",51)(100,"span",52),d(101,"5"),s(),d(102," \u5176\u4ED6\u8CC7\u8A0A "),s(),l(103,"div",77)(104,"div")(105,"label",10),d(106,"\u8077\u52D9\u5167\u5BB9"),s(),x(107,"textarea",78),s(),l(108,"div")(109,"label",10),d(110,"\u5099\u8A3B"),s(),x(111,"textarea",79),s()()()()(),l(112,"div",80),xt(113,eU,3,4,"div",81),l(114,"div",82)(115,"button",83),b("click",function(){E(t);let r=_();return S(r.closeEditModal())}),d(116," \u53D6\u6D88 "),s(),l(117,"button",84),b("click",function(){E(t);let r=_();return S(r.submitEmployee())}),d(118),s()()()()()}if(n&2){let t,i=_();m(4),N(" ",i.isCreateMode()?"\u65B0\u589E\u54E1\u5DE5\u8CC7\u6599":"\u7DE8\u8F2F\u54E1\u5DE5\u8CC7\u6599 - "+((t=i.selectedEmployee())==null?null:t.employee_name)," "),m(4),I("formGroup",i.employeeForm),m(10),j("bg-gray-100",!i.isCreateMode())("text-gray-600",!i.isCreateMode())("cursor-not-allowed",!i.isCreateMode()),I("disabled",!i.isCreateMode()),m(6),j("bg-gray-100",!i.isCreateMode())("text-gray-600",!i.isCreateMode())("cursor-not-allowed",!i.isCreateMode()),I("disabled",!i.isCreateMode()),m(13),I("ngValue",null),m(2),I("ngForOf",i.employees()),m(57),I("ngIf",!i.isCreateMode()),m(),I("ngIf",i.isCreateMode()),m(16),I("ngIf",!i.isCreateMode()),m(4),I("disabled",i.saving()||!i.employeeForm.valid),m(),N(" ",i.saving()?"\u8655\u7406\u4E2D...":i.isCreateMode()?"\u65B0\u589E":"\u5132\u5B58"," ")}}function nU(n,e){n&1&&(l(0,"div",105),d(1," \u2713 \u5132\u5B58\u6210\u529F\uFF01 "),s())}var Za=class Za{constructor(){this.apiService=k(we);this.fb=k(qe);this.employees=D([]);this.loading=D(!1);this.error=D("");this.searchKeyword=D("");this.selectedPosition=D("");this.positionOptions=$(()=>[...new Set(this.employees().map(e=>(e.position||"").trim()).filter(e=>!!e))].sort((e,t)=>e.localeCompare(t,"zh-Hant")));this.filteredEmployees=$(()=>{let e=this.searchKeyword().trim().toLowerCase(),t=this.selectedPosition().trim();return this.employees().filter(i=>{let r=!e||String(i.id).includes(e)||String(i.employee_number||"").toLowerCase().includes(e)||String(i.employee_name||"").toLowerCase().includes(e),o=!t||(i.position||"")===t;return r&&o})});this.editModalOpen=D(!1);this.selectedEmployee=D(null);this.isCreateMode=D(!1);this.saving=D(!1);this.saveSuccess=D(!1);this.selectedFrontFile=D(null);this.selectedBackFile=D(null);this.uploadingFront=D(!1);this.uploadingBack=D(!1);this.uploadErrorFront=D("");this.uploadErrorBack=D("");this.uploadSuccessFront=D("");this.uploadSuccessBack=D("");this.employeeForm=this.fb.group({employee_number:["",U.required],employee_name:["",U.required],position:[""],id_number:[""],phone:[""],email:["",U.email],registered_address:[""],mailing_address:[""],job_description:[""],payment_method:[""],bank:[""],branch:[""],account_number:[""],account_holder:[""],notes:[""],agent_id:[null]})}ngOnInit(){this.loadEmployees()}trackByPosition(e,t){return t}resetFilters(){this.searchKeyword.set(""),this.selectedPosition.set("")}async loadEmployees(){this.loading.set(!0),this.error.set("");try{let e=await this.apiService.getEmployeeInfo();e.success&&e.data?this.employees.set(e.data):this.error.set("\u8F09\u5165\u54E1\u5DE5\u8CC7\u6599\u5931\u6557")}catch(e){console.error("Error loading employees:",e),this.error.set("\u7121\u6CD5\u8F09\u5165\u54E1\u5DE5\u8CC7\u6599\uFF0C\u8ACB\u6AA2\u67E5\u7DB2\u8DEF\u9023\u7DDA")}finally{this.loading.set(!1)}}openEditModal(e){this.selectedEmployee.set(e),this.employeeForm.patchValue(e),this.editModalOpen.set(!0),this.isCreateMode.set(!1),this.employeeForm.get("employee_number")?.disable(),this.employeeForm.get("employee_name")?.disable(),this.selectedFrontFile.set(null),this.selectedBackFile.set(null),this.uploadErrorFront.set(""),this.uploadErrorBack.set(""),this.uploadSuccessFront.set(""),this.uploadSuccessBack.set("")}closeEditModal(){this.editModalOpen.set(!1),this.selectedEmployee.set(null),this.isCreateMode.set(!1),this.employeeForm.reset()}openCreateModal(){this.isCreateMode.set(!0),this.selectedEmployee.set(null),this.employeeForm.reset({employee_number:"",employee_name:"",position:"",id_number:"",phone:"",email:"",registered_address:"",mailing_address:"",job_description:"",payment_method:"",bank:"",branch:"",account_number:"",account_holder:"",notes:"",agent_id:null}),this.employeeForm.get("employee_number")?.enable(),this.employeeForm.get("employee_name")?.enable(),this.editModalOpen.set(!0),this.selectedFrontFile.set(null),this.selectedBackFile.set(null),this.uploadErrorFront.set(""),this.uploadErrorBack.set(""),this.uploadSuccessFront.set(""),this.uploadSuccessBack.set("")}submitEmployee(){this.isCreateMode()?this.createEmployee():this.saveEmployee()}async createEmployee(){if(this.employeeForm.valid){this.saving.set(!0),this.error.set("");try{let e=this.employeeForm.getRawValue(),t=await this.apiService.createEmployeeInfo(e);t.success?(this.saveSuccess.set(!0),setTimeout(()=>this.saveSuccess.set(!1),3e3),this.closeEditModal(),await this.loadEmployees()):this.error.set(t.error||"\u65B0\u589E\u5931\u6557\uFF0C\u8ACB\u91CD\u8A66")}catch(e){console.error("Error creating employee:",e),this.error.set(e?.error?.error||"\u65B0\u589E\u5931\u6557\uFF0C\u8ACB\u91CD\u8A66")}finally{this.saving.set(!1)}}}async saveEmployee(){if(!(!this.employeeForm.valid||!this.selectedEmployee())){this.saving.set(!0);try{let e=this.employeeForm.value,t=this.selectedEmployee();if((await this.apiService.updateEmployeeInfo(t.employee_number,e)).success){let r=this.employees().map(o=>o.id===t.id?G(O(O({},o),e),{updated_at:new Date().toISOString()}):o);this.employees.set(r),this.saveSuccess.set(!0),setTimeout(()=>this.saveSuccess.set(!1),3e3),this.closeEditModal(),await this.loadEmployees()}}catch(e){console.error("Error saving employee:",e),this.error.set("\u5132\u5B58\u5931\u6557\uFF0C\u8ACB\u91CD\u8A66")}finally{this.saving.set(!1)}}}onFrontFileSelected(e){let t=e.target;t.files?.length&&(this.selectedFrontFile.set(t.files[0]),this.uploadErrorFront.set(""),this.uploadSuccessFront.set(""))}onBackFileSelected(e){let t=e.target;t.files?.length&&(this.selectedBackFile.set(t.files[0]),this.uploadErrorBack.set(""),this.uploadSuccessBack.set(""))}onImageLoadError(e){console.error(`Failed to load ID card ${e} image`)}async uploadFront(){let e=this.selectedFrontFile(),t=this.selectedEmployee();if(!(!e||!t)){this.uploadingFront.set(!0),this.uploadErrorFront.set("");try{let i=await this.apiService.uploadIdCardImage(e,t.employee_number,"front");if(i.success){await this.apiService.updateEmployeeIdCardPath(Number(t.employee_number),"front",i.filepath);let r=await this.apiService.getEmployeeInfo();if(r.success&&r.data){this.employees.set(r.data);let o=r.data.find(a=>a.id===t.id);o&&this.selectedEmployee.set(o)}this.uploadSuccessFront.set("\u6B63\u9762\u5716\u7247\u4E0A\u50B3\u6210\u529F\uFF01"),this.selectedFrontFile.set(null),setTimeout(()=>this.uploadSuccessFront.set(""),3e3)}}catch(i){this.uploadErrorFront.set(i?.error?.error||"\u4E0A\u50B3\u5931\u6557\uFF0C\u8ACB\u91CD\u8A66"),console.error("Upload error:",i)}finally{this.uploadingFront.set(!1)}}}async uploadBack(){let e=this.selectedBackFile(),t=this.selectedEmployee();if(!(!e||!t)){this.uploadingBack.set(!0),this.uploadErrorBack.set("");try{let i=await this.apiService.uploadIdCardImage(e,t.employee_number,"back");if(i.success){await this.apiService.updateEmployeeIdCardPath(Number(t.employee_number),"back",i.filepath);let r=await this.apiService.getEmployeeInfo();if(r.success&&r.data){this.employees.set(r.data);let o=r.data.find(a=>a.id===t.id);o&&this.selectedEmployee.set(o)}this.uploadSuccessBack.set("\u53CD\u9762\u5716\u7247\u4E0A\u50B3\u6210\u529F\uFF01"),this.selectedBackFile.set(null),setTimeout(()=>this.uploadSuccessBack.set(""),3e3)}}catch(i){this.uploadErrorBack.set(i?.error?.error||"\u4E0A\u50B3\u5931\u6557\uFF0C\u8ACB\u91CD\u8A66"),console.error("Upload error:",i)}finally{this.uploadingBack.set(!1)}}}getImageUrl(e){return e?e.startsWith("http://")||e.startsWith("https://")?e:e.startsWith("/")?"http://localhost:3000"+e:e:null}};Za.\u0275fac=function(t){return new(t||Za)},Za.\u0275cmp=re({type:Za,selectors:[["app-company-profile"]],decls:30,vars:11,consts:[["frontFileInput",""],["backFileInput",""],[1,"p-6","space-y-6"],[1,"flex","justify-between","items-center"],[1,"text-2xl","font-bold","text-gray-800"],[1,"flex","items-center","gap-3"],[1,"text-sm","text-gray-500"],["type","button",1,"px-4","py-2","bg-green-500","text-white","text-sm","rounded-lg","hover:bg-green-600","transition-colors",3,"click"],[1,"bg-white","rounded-lg","shadow","p-4"],[1,"grid","grid-cols-1","md:grid-cols-3","gap-3"],[1,"block","text-sm","font-medium","text-gray-700","mb-1"],["type","text","placeholder","\u8F38\u5165 ID \u6216\u59D3\u540D",1,"w-full","px-3","py-2","border","border-gray-300","rounded","focus:ring-2","focus:ring-blue-500","focus:border-transparent",3,"ngModelChange","ngModel"],[1,"w-full","px-3","py-2","border","border-gray-300","rounded","focus:ring-2","focus:ring-blue-500","focus:border-transparent",3,"ngModelChange","ngModel"],["value",""],[3,"value",4,"ngFor","ngForOf","ngForTrackBy"],[1,"flex","items-end"],["type","button",1,"px-4","py-2","border","border-gray-300","rounded","text-sm","text-gray-700","hover:bg-gray-50","transition-colors",3,"click"],["class","flex justify-center items-center py-12",4,"ngIf"],["class","bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded",4,"ngIf"],["class","bg-white rounded-lg shadow overflow-hidden",4,"ngIf"],["class","fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",3,"click",4,"ngIf"],["class","fixed bottom-4 right-4 bg-green-500 text-white px-6 py-3 rounded-lg shadow-lg z-50 animate-fade-in",4,"ngIf"],[3,"value"],[1,"flex","justify-center","items-center","py-12"],[1,"text-gray-500"],[1,"bg-red-50","border","border-red-200","text-red-700","px-4","py-3","rounded"],[1,"bg-white","rounded-lg","shadow","overflow-hidden"],[1,"w-full"],[1,"bg-gray-50","border-b-2","border-gray-200"],[1,"px-6","py-4","text-left","text-sm","font-semibold","text-gray-700"],[1,"px-6","py-4","text-center","text-sm","font-semibold","text-gray-700"],[1,"divide-y","divide-gray-200"],["class","hover:bg-gray-50 transition-colors cursor-pointer",3,"click",4,"ngFor","ngForOf"],[4,"ngIf"],[1,"hover:bg-gray-50","transition-colors","cursor-pointer",3,"click"],[1,"px-6","py-4","text-sm","text-gray-900"],[1,"px-6","py-4"],[1,"flex","items-center"],[1,"text-sm","font-medium","text-gray-900"],[1,"px-6","py-4","text-sm","text-gray-600"],[1,"px-6","py-4","text-center"],[1,"px-3","py-1","bg-blue-500","text-white","text-sm","rounded","hover:bg-blue-600","transition-colors",3,"click"],["colspan","4",1,"px-6","py-12","text-center","text-gray-500"],[1,"fixed","inset-0","bg-black","bg-opacity-50","flex","items-center","justify-center","z-50","p-4",3,"click"],[1,"bg-white","rounded-lg","shadow-2xl","max-w-4xl","w-full","max-h-[90vh]","overflow-hidden","flex","flex-col",3,"click"],[1,"bg-gradient-to-r","from-blue-500","to-blue-600","px-6","py-4","flex","justify-between","items-center","text-white"],[1,"text-xl","font-bold"],[1,"text-white","hover:text-gray-200","text-3xl","leading-none",3,"click"],[1,"flex-1","overflow-y-auto","p-6"],[1,"space-y-6",3,"formGroup"],[1,"bg-gray-50","p-4","rounded-lg"],[1,"text-lg","font-semibold","text-gray-800","mb-4","flex","items-center"],[1,"bg-blue-500","text-white","rounded-full","w-8","h-8","flex","items-center","justify-center","mr-2","text-sm"],[1,"grid","grid-cols-1","md:grid-cols-2","gap-4"],["type","text","formControlName","employee_number","placeholder","\u8ACB\u8F38\u5165\u54E1\u5DE5\u7DE8\u865F",1,"w-full","px-3","py-2","border","border-gray-300","rounded",3,"disabled"],[1,"text-red-500"],["type","text","formControlName","employee_name","placeholder","\u8ACB\u8F38\u5165\u54E1\u5DE5\u59D3\u540D",1,"w-full","px-3","py-2","border","border-gray-300","rounded",3,"disabled"],["type","text","formControlName","position","placeholder","\u8ACB\u8F38\u5165\u8077\u7A31",1,"w-full","px-3","py-2","border","border-gray-300","rounded","focus:ring-2","focus:ring-blue-500","focus:border-transparent"],["type","text","formControlName","id_number","placeholder","\u8ACB\u8F38\u5165\u8EAB\u4EFD\u8B49\u5B57\u865F",1,"w-full","px-3","py-2","border","border-gray-300","rounded","focus:ring-2","focus:ring-blue-500","focus:border-transparent"],["formControlName","agent_id",1,"w-full","px-3","py-2","border","border-gray-300","rounded","focus:ring-2","focus:ring-blue-500","focus:border-transparent"],[3,"ngValue"],[3,"ngValue","disabled",4,"ngFor","ngForOf"],["type","tel","formControlName","phone","placeholder","\u8ACB\u8F38\u5165\u806F\u7D61\u96FB\u8A71",1,"w-full","px-3","py-2","border","border-gray-300","rounded","focus:ring-2","focus:ring-blue-500","focus:border-transparent"],["type","email","formControlName","email","placeholder","\u8ACB\u8F38\u5165 Email",1,"w-full","px-3","py-2","border","border-gray-300","rounded","focus:ring-2","focus:ring-blue-500","focus:border-transparent"],[1,"md:col-span-2"],["type","text","formControlName","registered_address","placeholder","\u8ACB\u8F38\u5165\u6236\u7C4D\u5730\u5740",1,"w-full","px-3","py-2","border","border-gray-300","rounded","focus:ring-2","focus:ring-blue-500","focus:border-transparent"],["type","text","formControlName","mailing_address","placeholder","\u8ACB\u8F38\u5165\u901A\u8A0A\u5730\u5740\uFF08\u540C\u6236\u7C4D\u5730\u5740\u53EF\u7559\u7A7A\uFF09",1,"w-full","px-3","py-2","border","border-gray-300","rounded","focus:ring-2","focus:ring-blue-500","focus:border-transparent"],["formControlName","payment_method",1,"w-full","px-3","py-2","border","border-gray-300","rounded","focus:ring-2","focus:ring-blue-500","focus:border-transparent"],["value","\u73FE\u91D1"],["value","\u8F49\u5E33"],["value","\u652F\u7968"],["type","text","formControlName","bank","placeholder","\u8ACB\u8F38\u5165\u9280\u884C\u540D\u7A31",1,"w-full","px-3","py-2","border","border-gray-300","rounded","focus:ring-2","focus:ring-blue-500","focus:border-transparent"],["type","text","formControlName","branch","placeholder","\u8ACB\u8F38\u5165\u5206\u884C\u540D\u7A31",1,"w-full","px-3","py-2","border","border-gray-300","rounded","focus:ring-2","focus:ring-blue-500","focus:border-transparent"],["type","text","formControlName","account_number","placeholder","\u8ACB\u8F38\u5165\u9280\u884C\u5E33\u865F",1,"w-full","px-3","py-2","border","border-gray-300","rounded","focus:ring-2","focus:ring-blue-500","focus:border-transparent"],["type","text","formControlName","account_holder","placeholder","\u8ACB\u8F38\u5165\u6236\u540D",1,"w-full","px-3","py-2","border","border-gray-300","rounded","focus:ring-2","focus:ring-blue-500","focus:border-transparent"],["class","bg-gray-50 p-4 rounded-lg",4,"ngIf"],["class","bg-blue-50 border border-blue-100 p-4 rounded-lg text-sm text-blue-700",4,"ngIf"],[1,"space-y-4"],["formControlName","job_description","rows","3","placeholder","\u8ACB\u8F38\u5165\u8077\u52D9\u5167\u5BB9\u63CF\u8FF0",1,"w-full","px-3","py-2","border","border-gray-300","rounded","focus:ring-2","focus:ring-blue-500","focus:border-transparent"],["formControlName","notes","rows","3","placeholder","\u8ACB\u8F38\u5165\u5099\u8A3B",1,"w-full","px-3","py-2","border","border-gray-300","rounded","focus:ring-2","focus:ring-blue-500","focus:border-transparent"],[1,"bg-gray-50","border-t","border-gray-200","px-6","py-4","flex","justify-between","items-center"],["class","text-sm text-gray-500",4,"ngIf"],[1,"flex","gap-3"],["type","button",1,"px-6","py-2","border","border-gray-300","rounded-lg","hover:bg-gray-50","transition-colors",3,"click"],["type","button",1,"px-6","py-2","bg-blue-500","text-white","rounded-lg","hover:bg-blue-600","disabled:opacity-50","disabled:cursor-not-allowed","transition-colors",3,"click","disabled"],[3,"ngValue","disabled"],[1,"grid","grid-cols-1","md:grid-cols-2","gap-6"],[1,"space-y-3"],[1,"block","text-sm","font-medium","text-gray-700"],["class","mb-3",4,"ngIf"],["type","file","accept","image/jpeg,image/png",1,"hidden",3,"change"],["type","button",1,"w-full","px-4","py-2","border-2","border-dashed","border-blue-300","text-blue-600","rounded","hover:bg-blue-50","transition-colors",3,"click"],["class","text-sm text-gray-600",4,"ngIf"],["type","button","class","w-full px-4 py-2 bg-green-500 text-white rounded hover:bg-green-600 disabled:opacity-50",3,"disabled","click",4,"ngIf"],["class","text-sm text-green-600",4,"ngIf"],["class","text-sm text-red-600",4,"ngIf"],[1,"mb-3"],["alt","\u8EAB\u4EFD\u8B49\u6B63\u9762",1,"w-full","h-48","object-contain","border-2","border-gray-200","rounded","bg-gray-100",3,"error","src"],["target","_blank",1,"text-xs","text-blue-500","hover:underline","mt-1","inline-block",3,"href"],[1,"text-sm","text-gray-600"],["type","button",1,"w-full","px-4","py-2","bg-green-500","text-white","rounded","hover:bg-green-600","disabled:opacity-50",3,"click","disabled"],[1,"text-sm","text-green-600"],[1,"text-sm","text-red-600"],["alt","\u8EAB\u4EFD\u8B49\u53CD\u9762",1,"w-full","h-48","object-contain","border-2","border-gray-200","rounded","bg-gray-100",3,"error","src"],[1,"bg-blue-50","border","border-blue-100","p-4","rounded-lg","text-sm","text-blue-700"],[1,"fixed","bottom-4","right-4","bg-green-500","text-white","px-6","py-3","rounded-lg","shadow-lg","z-50","animate-fade-in"]],template:function(t,i){t&1&&(l(0,"div",2)(1,"div",3)(2,"h2",4),d(3,"\u516C\u53F8\u500B\u4EBA\u8CC7\u6599"),s(),l(4,"div",5)(5,"div",6),d(6),s(),l(7,"button",7),b("click",function(){return i.openCreateModal()}),d(8," \u65B0\u589E\u54E1\u5DE5 "),s()()(),l(9,"div",8)(10,"div",9)(11,"div")(12,"label",10),d(13,"\u641C\u5C0B ID / \u59D3\u540D"),s(),l(14,"input",11),b("ngModelChange",function(o){return i.searchKeyword.set(o)}),s()(),l(15,"div")(16,"label",10),d(17,"\u8077\u7A31\u7BE9\u9078"),s(),l(18,"select",12),b("ngModelChange",function(o){return i.selectedPosition.set(o)}),l(19,"option",13),d(20,"\u5168\u90E8\u8077\u7A31"),s(),xt(21,kB,2,2,"option",14),s()(),l(22,"div",15)(23,"button",16),b("click",function(){return i.resetFilters()}),d(24," \u6E05\u9664\u7BE9\u9078 "),s()()()(),xt(25,VB,3,0,"div",17)(26,LB,2,1,"div",18)(27,UB,15,2,"div",19)(28,tU,119,23,"div",20)(29,nU,2,0,"div",21),s()),t&2&&(m(6),Qe(" \u986F\u793A ",i.filteredEmployees().length," / ",i.employees().length," \u4F4D\u54E1\u5DE5 "),m(8),I("ngModel",i.searchKeyword()),m(4),I("ngModel",i.selectedPosition()),m(3),I("ngForOf",i.positionOptions())("ngForTrackBy",i.trackByPosition),m(4),I("ngIf",i.loading()),m(),I("ngIf",i.error()),m(),I("ngIf",!i.loading()),m(),I("ngIf",i.editModalOpen()),m(),I("ngIf",i.saveSuccess()))},dependencies:[se,la,Ji,De,Ve,He,Ge,be,Oe,fe,ke,Ie,Be,Le,Ue,ao],styles:["@keyframes _ngcontent-%COMP%_fadeIn{0%{opacity:0;transform:translateY(10px)}to{opacity:1;transform:translateY(0)}}.animate-fade-in[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_fadeIn .3s ease-out}"],changeDetection:0});var vp=Za;var su=(n,e)=>e.id;function iU(n,e){if(n&1&&(l(0,"option",16),d(1),s()),n&2){let t=e.$implicit;I("value",t.id),m(),w(t.name)}}function rU(n,e){if(n&1&&(l(0,"option",16),d(1),s()),n&2){let t=e.$implicit;I("value",t),m(),w(t)}}function oU(n,e){if(n&1){let t=B();l(0,"tr",27)(1,"td",29),d(2),s(),l(3,"td",30),d(4),s(),l(5,"td",29),d(6),s(),l(7,"td",29),d(8),s(),l(9,"td",31),d(10),s(),l(11,"td",29),d(12),s(),l(13,"td",29),d(14),s(),l(15,"td",31),d(16),s(),l(17,"td",32),d(18),s(),l(19,"td",33),d(20),s(),l(21,"td",29)(22,"div",34)(23,"button",35),b("click",function(){let r=E(t).$implicit,o=_(2);return S(o.openModal(r))}),x(24,"ion-icon",36),s(),l(25,"button",37),b("click",function(){let r=E(t).$implicit,o=_(2);return S(o.deleteItem(r.id))}),x(26,"ion-icon",38),s()()()()}if(n&2){let t=e.$implicit,i=_(2);m(2),w(t.productId),m(2),w(t.productName),m(2),w(i.getVendorName(t.vendorId)),m(2),w(t.category),m(2),w(t.itemQuantity),m(2),w(t.itemUnit),m(2),w(t.totalUnit),m(2),w(i.formatCurrency(t.price)),m(2),w(i.formatCurrency(i.calculateItemCost(t.price,t.itemQuantity))),m(2),w(t.notes)}}function aU(n,e){n&1&&(l(0,"tr")(1,"td",39),d(2,"\u7121\u7B26\u5408\u689D\u4EF6\u7684\u5546\u54C1\u6210\u672C\u8CC7\u6599\u3002"),s()())}function sU(n,e){if(n&1){let t=B();l(0,"div",28)(1,"span",40),d(2),s(),l(3,"div",34)(4,"button",41),b("click",function(){E(t);let r=_(2);return S(r.goToPage(r.groceriesCurrentPage()-1,"groceries"))}),x(5,"ion-icon",42),s(),l(6,"span",43),d(7),s(),l(8,"button",41),b("click",function(){E(t);let r=_(2);return S(r.goToPage(r.groceriesCurrentPage()+1,"groceries"))}),x(9,"ion-icon",44),s()()()}if(n&2){let t=_(2);m(2),Lt("\u986F\u793A\u7B2C ",(t.groceriesCurrentPage()-1)*t.groceriesPageSize+1," \u81F3 ",t.Math.min(t.groceriesCurrentPage()*t.groceriesPageSize,t.filteredGroceries().length)," \u7B46\uFF0C\u5171 ",t.filteredGroceries().length," \u7B46"),m(2),I("disabled",t.groceriesCurrentPage()===1),m(3),Qe("\u7B2C ",t.groceriesCurrentPage()," \u9801 / \u5171 ",t.groceriesTotalPages()," \u9801"),m(),I("disabled",t.groceriesCurrentPage()===t.groceriesTotalPages())}}function lU(n,e){if(n&1){let t=B();l(0,"div",11)(1,"div",12)(2,"input",13),b("ngModelChange",function(r){E(t);let o=_();return o.groceriesSearchTerm.set(r),S(o.applyFilters("groceries"))}),s()(),l(3,"div")(4,"select",14),b("ngModelChange",function(r){E(t);let o=_();return o.groceriesSelectedVendor.set(r),S(o.applyFilters("groceries"))}),l(5,"option",15),d(6,"\u6240\u6709\u4F9B\u61C9\u5546"),s(),V(7,iU,2,2,"option",16,su),s()(),l(9,"div")(10,"select",14),b("ngModelChange",function(r){E(t);let o=_();return o.groceriesSelectedCategory.set(r),S(o.applyFilters("groceries"))}),l(11,"option",15),d(12,"\u6240\u6709\u54C1\u9805"),s(),V(13,rU,2,2,"option",16,Y),s()(),l(15,"div",17)(16,"button",18),b("click",function(){E(t);let r=_();return S(r.resetFilters("groceries"))}),x(17,"ion-icon",19),s()()(),l(18,"div",20)(19,"table",21)(20,"thead",22)(21,"tr")(22,"th",23),b("click",function(){E(t);let r=_();return S(r.sortData("productId"))}),d(23,"\u5546\u54C1\u7DE8\u865F"),s(),l(24,"th",23),b("click",function(){E(t);let r=_();return S(r.sortData("productName"))}),d(25,"\u5546\u54C1\u540D\u7A31"),s(),l(26,"th",23),b("click",function(){E(t);let r=_();return S(r.sortData("vendorId"))}),d(27,"\u4F9B\u61C9\u5546"),s(),l(28,"th",23),b("click",function(){E(t);let r=_();return S(r.sortData("category"))}),d(29,"\u54C1\u9805"),s(),l(30,"th",24),b("click",function(){E(t);let r=_();return S(r.sortData("itemQuantity"))}),d(31,"\u7D30\u9805\u6578\u91CF"),s(),l(32,"th",23),b("click",function(){E(t);let r=_();return S(r.sortData("itemUnit"))}),d(33,"\u7D30\u9805\u55AE\u4F4D"),s(),l(34,"th",23),b("click",function(){E(t);let r=_();return S(r.sortData("totalUnit"))}),d(35,"\u7E3D\u55AE\u4F4D"),s(),l(36,"th",24),b("click",function(){E(t);let r=_();return S(r.sortData("price"))}),d(37,"\u50F9\u683C(\u5143)"),s(),l(38,"th",25),d(39,"\u7D30\u9805\u55AE\u4F4D\u6210\u672C"),s(),l(40,"th",26),d(41,"\u5099\u8A3B"),s(),l(42,"th",26),d(43,"\u64CD\u4F5C"),s()()(),l(44,"tbody"),V(45,oU,27,10,"tr",27,su,!1,aU,3,0,"tr"),s()()(),M(48,sU,10,7,"div",28)}if(n&2){let t=_();m(2),I("ngModel",t.groceriesSearchTerm()),m(2),I("ngModel",t.groceriesSelectedVendor()),m(3),L(t.allVendors()),m(3),I("ngModel",t.groceriesSelectedCategory()),m(3),L(t.groceriesProductCategories()),m(32),L(t.paginatedGroceries()),m(3),A(t.groceriesTotalPages()>1?48:-1)}}function uU(n,e){if(n&1&&(l(0,"option",16),d(1),s()),n&2){let t=e.$implicit;I("value",t),m(),w(t)}}function dU(n,e){if(n&1&&(l(0,"option",16),d(1),s()),n&2){let t=e.$implicit;I("value",t),m(),w(t)}}function cU(n,e){if(n&1){let t=B();l(0,"tr",27)(1,"td",29),d(2),s(),l(3,"td",30),d(4),s(),l(5,"td",29),d(6),s(),l(7,"td",31),d(8),s(),l(9,"td",31),d(10),s(),l(11,"td",32),d(12),s(),l(13,"td",29)(14,"div",34)(15,"button",35),b("click",function(){let r=E(t).$implicit,o=_(2);return S(o.openModal(r))}),x(16,"ion-icon",36),s(),l(17,"button",37),b("click",function(){let r=E(t).$implicit,o=_(2);return S(o.deleteItem(r.id))}),x(18,"ion-icon",38),s()()()()}if(n&2){let t=e.$implicit,i=_(2);m(2),w(t.vendor),m(2),w(t.productName),m(2),w(t.type),m(2),w(i.formatCurrency(t.cost)),m(2),w(i.formatCurrency(t.sellingPrice)),m(2),N("",i.calculateMargin(t.cost,t.sellingPrice).toFixed(2),"%")}}function mU(n,e){n&1&&(l(0,"tr")(1,"td",46),d(2,"\u7121\u8CC7\u6599\u3002"),s()())}function pU(n,e){if(n&1){let t=B();l(0,"div",28)(1,"span",40),d(2),s(),l(3,"div",34)(4,"button",41),b("click",function(){E(t);let r=_(2);return S(r.goToPage(r.wineCurrentPage()-1,"wines"))}),x(5,"ion-icon",42),s(),l(6,"span",43),d(7),s(),l(8,"button",41),b("click",function(){E(t);let r=_(2);return S(r.goToPage(r.wineCurrentPage()+1,"wines"))}),x(9,"ion-icon",44),s()()()}if(n&2){let t=_(2);m(2),Lt("\u986F\u793A\u7B2C ",(t.wineCurrentPage()-1)*t.winePageSize+1," \u81F3 ",t.Math.min(t.wineCurrentPage()*t.winePageSize,t.filteredWines().length)," \u7B46\uFF0C\u5171 ",t.filteredWines().length," \u7B46"),m(2),I("disabled",t.wineCurrentPage()===1),m(3),Qe("\u7B2C ",t.wineCurrentPage()," \u9801 / \u5171 ",t.wineTotalPages()," \u9801"),m(),I("disabled",t.wineCurrentPage()===t.wineTotalPages())}}function fU(n,e){if(n&1){let t=B();l(0,"div",11)(1,"div",12)(2,"input",45),b("ngModelChange",function(r){E(t);let o=_();return o.wineSearchTerm.set(r),S(o.applyFilters("wines"))}),s()(),l(3,"div")(4,"select",14),b("ngModelChange",function(r){E(t);let o=_();return o.wineSelectedVendor.set(r),S(o.applyFilters("wines"))}),l(5,"option",15),d(6,"\u6240\u6709\u5EE0\u5546"),s(),V(7,uU,2,2,"option",16,Y),s()(),l(9,"div")(10,"select",14),b("ngModelChange",function(r){E(t);let o=_();return o.wineSelectedType.set(r),S(o.applyFilters("wines"))}),l(11,"option",15),d(12,"\u6240\u6709\u985E\u578B"),s(),V(13,dU,2,2,"option",16,Y),s()(),l(15,"div",17)(16,"button",18),b("click",function(){E(t);let r=_();return S(r.resetFilters("wines"))}),x(17,"ion-icon",19),s()()(),l(18,"div",20)(19,"table",21)(20,"thead",22)(21,"tr")(22,"th",23),b("click",function(){E(t);let r=_();return S(r.sortData("vendor"))}),d(23,"\u5EE0\u5546"),s(),l(24,"th",23),b("click",function(){E(t);let r=_();return S(r.sortData("productName"))}),d(25,"\u5546\u54C1"),s(),l(26,"th",23),b("click",function(){E(t);let r=_();return S(r.sortData("type"))}),d(27,"\u985E\u578B"),s(),l(28,"th",24),b("click",function(){E(t);let r=_();return S(r.sortData("cost"))}),d(29,"\u9032\u8CA8\u6210\u672C"),s(),l(30,"th",24),b("click",function(){E(t);let r=_();return S(r.sortData("sellingPrice"))}),d(31,"\u552E\u50F9"),s(),l(32,"th",25),d(33,"\u6BDB\u5229\u7387"),s(),l(34,"th",26),d(35,"\u64CD\u4F5C"),s()()(),l(36,"tbody"),V(37,cU,19,6,"tr",27,su,!1,mU,3,0,"tr"),s()()(),M(40,pU,10,7,"div",28)}if(n&2){let t=_();m(2),I("ngModel",t.wineSearchTerm()),m(2),I("ngModel",t.wineSelectedVendor()),m(3),L(t.wineVendors()),m(3),I("ngModel",t.wineSelectedType()),m(3),L(t.wineTypes()),m(24),L(t.paginatedWines()),m(3),A(t.wineTotalPages()>1?40:-1)}}function gU(n,e){if(n&1&&(l(0,"option",16),d(1),s()),n&2){let t=e.$implicit;I("value",t),m(),w(t)}}function hU(n,e){if(n&1){let t=B();l(0,"tr",27)(1,"td",30),d(2),s(),l(3,"td",29),d(4),s(),l(5,"td",29),d(6),s(),l(7,"td",31),d(8),s(),l(9,"td",31),d(10),s(),l(11,"td",31),d(12),s(),l(13,"td",31),d(14),s(),l(15,"td",32),d(16),s(),l(17,"td",29)(18,"div",34)(19,"button",35),b("click",function(){let r=E(t).$implicit,o=_(2);return S(o.openModal(r))}),x(20,"ion-icon",36),s(),l(21,"button",37),b("click",function(){let r=E(t).$implicit,o=_(2);return S(o.deleteItem(r.id))}),x(22,"ion-icon",38),s()()()()}if(n&2){let t=e.$implicit,i=_(2);m(2),w(t.brand),m(2),w(t.productName),m(2),w(t.size),m(2),w(t.quantityPerBox),m(2),w(i.formatCurrency(t.lishengCost)),m(2),w(i.formatCurrency(t.baijiaCost)),m(2),w(i.formatCurrency(t.sellingPrice)),m(2),N("",i.calculateMargin(t.baijiaCost,t.sellingPrice).toFixed(2),"%")}}function yU(n,e){n&1&&(l(0,"tr")(1,"td",50),d(2,"\u7121\u8CC7\u6599\u3002"),s()())}function _U(n,e){if(n&1){let t=B();l(0,"div",28)(1,"span",40),d(2),s(),l(3,"div",34)(4,"button",41),b("click",function(){E(t);let r=_(2);return S(r.goToPage(r.cigarCurrentPage()-1,"cigars"))}),x(5,"ion-icon",42),s(),l(6,"span",43),d(7),s(),l(8,"button",41),b("click",function(){E(t);let r=_(2);return S(r.goToPage(r.cigarCurrentPage()+1,"cigars"))}),x(9,"ion-icon",44),s()()()}if(n&2){let t=_(2);m(2),Lt("\u986F\u793A\u7B2C ",(t.cigarCurrentPage()-1)*t.cigarPageSize+1," \u81F3 ",t.Math.min(t.cigarCurrentPage()*t.cigarPageSize,t.filteredCigars().length)," \u7B46\uFF0C\u5171 ",t.filteredCigars().length," \u7B46"),m(2),I("disabled",t.cigarCurrentPage()===1),m(3),Qe("\u7B2C ",t.cigarCurrentPage()," \u9801 / \u5171 ",t.cigarTotalPages()," \u9801"),m(),I("disabled",t.cigarCurrentPage()===t.cigarTotalPages())}}function vU(n,e){if(n&1){let t=B();l(0,"div",47)(1,"div",12)(2,"input",48),b("ngModelChange",function(r){E(t);let o=_();return o.cigarSearchTerm.set(r),S(o.applyFilters("cigars"))}),s()(),l(3,"div")(4,"select",14),b("ngModelChange",function(r){E(t);let o=_();return o.cigarSelectedBrand.set(r),S(o.applyFilters("cigars"))}),l(5,"option",15),d(6,"\u6240\u6709\u54C1\u724C"),s(),V(7,gU,2,2,"option",16,Y),s()(),l(9,"div",49)(10,"button",18),b("click",function(){E(t);let r=_();return S(r.resetFilters("cigars"))}),x(11,"ion-icon",19),s()()(),l(12,"div",20)(13,"table",21)(14,"thead",22)(15,"tr")(16,"th",23),b("click",function(){E(t);let r=_();return S(r.sortData("brand"))}),d(17,"\u54C1\u724C"),s(),l(18,"th",23),b("click",function(){E(t);let r=_();return S(r.sortData("productName"))}),d(19,"\u5546\u54C1\u540D\u7A31"),s(),l(20,"th",23),b("click",function(){E(t);let r=_();return S(r.sortData("size"))}),d(21,"\u5C3A\u5BF8"),s(),l(22,"th",24),b("click",function(){E(t);let r=_();return S(r.sortData("quantityPerBox"))}),d(23,"\u6BCF\u76D2\u6578\u91CF"),s(),l(24,"th",24),b("click",function(){E(t);let r=_();return S(r.sortData("lishengCost"))}),d(25,"\u7406\u665F\u6210\u672C(\u652F)"),s(),l(26,"th",24),b("click",function(){E(t);let r=_();return S(r.sortData("baijiaCost"))}),d(27,"\u767E\u6CC7\u6210\u672C(\u652F)"),s(),l(28,"th",24),b("click",function(){E(t);let r=_();return S(r.sortData("sellingPrice"))}),d(29,"\u8CE3\u50F9"),s(),l(30,"th",25),d(31,"\u6BDB\u5229\u7387"),s(),l(32,"th",26),d(33,"\u64CD\u4F5C"),s()()(),l(34,"tbody"),V(35,hU,23,8,"tr",27,su,!1,yU,3,0,"tr"),s()()(),M(38,_U,10,7,"div",28)}if(n&2){let t=_();m(2),I("ngModel",t.cigarSearchTerm()),m(2),I("ngModel",t.cigarSelectedBrand()),m(3),L(t.cigarBrands()),m(28),L(t.paginatedCigars()),m(3),A(t.cigarTotalPages()>1?38:-1)}}function CU(n,e){if(n&1&&d(0),n&2){let t=_(2);N(" ",t.editingProductCost()?"\u7DE8\u8F2F\u5546\u54C1\u6210\u672C":"\u65B0\u589E\u5546\u54C1\u6210\u672C"," ")}}function xU(n,e){if(n&1&&d(0),n&2){let t=_(2);N(" ",t.editingWineCost()?"\u7DE8\u8F2F\u9152\u985E\u6210\u672C":"\u65B0\u589E\u9152\u985E\u6210\u672C"," ")}}function bU(n,e){if(n&1&&d(0),n&2){let t=_(2);N(" ",t.editingCigarCost()?"\u7DE8\u8F2F\u96EA\u8304\u6210\u672C":"\u65B0\u589E\u96EA\u8304\u6210\u672C"," ")}}function EU(n,e){if(n&1&&x(0,"option",16),n&2){let t=e.$implicit;I("value",t)}}function SU(n,e){if(n&1&&(l(0,"option",16),d(1),s()),n&2){let t=e.$implicit;I("value",t.id),m(),w(t.name)}}function DU(n,e){if(n&1&&(l(0,"div",58)(1,"div",62)(2,"label",63)(3,"span",64),d(4,"\u5546\u54C1\u7DE8\u865F*"),s(),x(5,"input",65),s(),l(6,"label",63)(7,"span",64),d(8,"\u5546\u54C1\u540D\u7A31*"),s(),x(9,"input",66),s(),l(10,"label",63)(11,"span",64),d(12,"\u54C1\u9805*"),s(),x(13,"input",67),l(14,"datalist",68),V(15,EU,1,1,"option",16,Y),s()(),l(17,"label",63)(18,"span",64),d(19,"\u4F9B\u61C9\u5546*"),s(),l(20,"select",69)(21,"option",70),d(22,"\u9078\u64C7\u4F9B\u61C9\u5546"),s(),V(23,SU,2,2,"option",16,su),s()(),l(25,"label",63)(26,"span",64),d(27,"\u7D30\u9805\u6578\u91CF*"),s(),x(28,"input",71),s(),l(29,"label",63)(30,"span",64),d(31,"\u7D30\u9805\u55AE\u4F4D*"),s(),x(32,"input",72),s(),l(33,"label",63)(34,"span",64),d(35,"\u7E3D\u55AE\u4F4D*"),s(),x(36,"input",73),s(),l(37,"label",63)(38,"span",64),d(39,"\u50F9\u683C(\u5143)*"),s(),x(40,"input",74),s()(),l(41,"label",63)(42,"span",64),d(43,"\u5099\u8A3B"),s(),x(44,"textarea",75),s()()),n&2){let t=_(2);I("formGroup",t.productCostForm),m(15),L(t.groceriesProductCategories()),m(8),L(t.allVendors())}}function wU(n,e){if(n&1&&(l(0,"div",58)(1,"div",62)(2,"label",63)(3,"span",64),d(4,"\u5EE0\u5546*"),s(),x(5,"input",76),s(),l(6,"label",63)(7,"span",64),d(8,"\u5546\u54C1\u540D\u7A31*"),s(),x(9,"input",66),s(),l(10,"label",63)(11,"span",64),d(12,"\u985E\u578B*"),s(),x(13,"input",77),s(),l(14,"label",63)(15,"span",64),d(16,"\u9032\u8CA8\u6210\u672C*"),s(),x(17,"input",78),s(),l(18,"label",79)(19,"span",64),d(20,"\u552E\u50F9*"),s(),x(21,"input",80),s()()()),n&2){let t=_(2);I("formGroup",t.wineCostForm)}}function TU(n,e){if(n&1&&(l(0,"div",58)(1,"div",62)(2,"label",63)(3,"span",64),d(4,"\u54C1\u724C*"),s(),x(5,"input",81),s(),l(6,"label",63)(7,"span",64),d(8,"\u5546\u54C1\u540D\u7A31*"),s(),x(9,"input",66),s(),l(10,"label",63)(11,"span",64),d(12,"\u5C3A\u5BF8*"),s(),x(13,"input",82),s(),l(14,"label",63)(15,"span",64),d(16,"\u6BCF\u76D2\u6578\u91CF*"),s(),x(17,"input",83),s(),l(18,"label",63)(19,"span",64),d(20,"\u7406\u665F\u6210\u672C(\u652F)*"),s(),x(21,"input",84),s(),l(22,"label",63)(23,"span",64),d(24,"\u767E\u6CC7\u6210\u672C(\u652F)*"),s(),x(25,"input",85),s(),l(26,"label",79)(27,"span",64),d(28,"\u8CE3\u50F9*"),s(),x(29,"input",80),s()()()),n&2){let t=_(2);I("formGroup",t.cigarCostForm)}}function IU(n,e){if(n&1){let t=B();l(0,"div",10)(1,"div",51)(2,"div",52)(3,"h3",53),M(4,CU,1,1)(5,xU,1,1)(6,bU,1,1),s(),l(7,"button",54),b("click",function(){E(t);let r=_();return S(r.closeModal())}),x(8,"ion-icon",55),s()(),l(9,"div",56)(10,"form",57),b("ngSubmit",function(){E(t);let r=_();return S(r.handleFormSubmit())}),M(11,DU,45,1,"div",58)(12,wU,22,1,"div",58)(13,TU,30,1,"div",58),l(14,"div",59)(15,"button",60),b("click",function(){E(t);let r=_();return S(r.closeModal())}),d(16,"\u53D6\u6D88"),s(),l(17,"button",61),d(18,"\u5132\u5B58"),s()()()()()()}if(n&2){let t,i,r=_();m(4),A((t=r.activeView())==="groceries"?4:t==="wines"?5:t==="cigars"?6:-1),m(7),A((i=r.activeView())==="groceries"?11:i==="wines"?12:i==="cigars"?13:-1)}}var Xa=class Xa{constructor(){this.dataService=k(zn);this.fb=k(qe);this.activeView=D("groceries");this.isModalOpen=D(!1);this.Math=Math;this.allVendors=D([]);this.allProductCosts=D([]);this.editingProductCost=D(null);this.allCigarCosts=D([]);this.editingCigarCost=D(null);this.allWineCosts=D([]);this.editingWineCost=D(null);this.productCostForm=this.fb.group({id:[""],productId:["",U.required],productName:["",U.required],vendorId:["",U.required],category:["",U.required],itemQuantity:[null,[U.required,U.min(.01)]],itemUnit:["",U.required],totalUnit:["",U.required],price:[null,[U.required,U.min(0)]],notes:[""]});this.cigarCostForm=this.fb.group({id:[""],brand:["",U.required],productName:["",U.required],size:["",U.required],quantityPerBox:[null,[U.required,U.min(1)]],lishengCost:[null,[U.required,U.min(0)]],baijiaCost:[null,[U.required,U.min(0)]],sellingPrice:[null,[U.required,U.min(0)]]});this.wineCostForm=this.fb.group({id:[""],vendor:["",U.required],productName:["",U.required],type:["",U.required],cost:[null,[U.required,U.min(0)]],sellingPrice:[null,[U.required,U.min(0)]]});this.groceriesSearchTerm=D("");this.groceriesSelectedVendor=D("");this.groceriesSelectedCategory=D("");this.groceriesSortColumn=D("productName");this.groceriesSortDirection=D("asc");this.groceriesCurrentPage=D(1);this.groceriesPageSize=10;this.cigarSearchTerm=D("");this.cigarSelectedBrand=D("");this.cigarSortColumn=D("brand");this.cigarSortDirection=D("asc");this.cigarCurrentPage=D(1);this.cigarPageSize=10;this.wineSearchTerm=D("");this.wineSelectedVendor=D("");this.wineSelectedType=D("");this.wineSortColumn=D("vendor");this.wineSortDirection=D("asc");this.wineCurrentPage=D(1);this.winePageSize=10;this.groceriesProductCategories=$(()=>[...new Set(this.allProductCosts().map(e=>e.category))].sort());this.filteredGroceries=$(()=>this.filterAndSort(this.allProductCosts(),this.groceriesSearchTerm(),{vendorId:this.groceriesSelectedVendor(),category:this.groceriesSelectedCategory()},["productName","productId"],this.groceriesSortColumn(),this.groceriesSortDirection()));this.paginatedGroceries=$(()=>this.paginate(this.filteredGroceries(),this.groceriesCurrentPage(),this.groceriesPageSize));this.groceriesTotalPages=$(()=>Math.ceil(this.filteredGroceries().length/this.groceriesPageSize));this.cigarBrands=$(()=>[...new Set(this.allCigarCosts().map(e=>e.brand))].sort());this.filteredCigars=$(()=>this.filterAndSort(this.allCigarCosts(),this.cigarSearchTerm(),{brand:this.cigarSelectedBrand()},["productName","brand"],this.cigarSortColumn(),this.cigarSortDirection()));this.paginatedCigars=$(()=>this.paginate(this.filteredCigars(),this.cigarCurrentPage(),this.cigarPageSize));this.cigarTotalPages=$(()=>Math.ceil(this.filteredCigars().length/this.cigarPageSize));this.wineVendors=$(()=>[...new Set(this.allWineCosts().map(e=>e.vendor))].sort());this.wineTypes=$(()=>[...new Set(this.allWineCosts().map(e=>e.type))].sort());this.filteredWines=$(()=>this.filterAndSort(this.allWineCosts(),this.wineSearchTerm(),{vendor:this.wineSelectedVendor(),type:this.wineSelectedType()},["productName","vendor","type"],this.wineSortColumn(),this.wineSortDirection()));this.paginatedWines=$(()=>this.paginate(this.filteredWines(),this.wineCurrentPage(),this.winePageSize));this.wineTotalPages=$(()=>Math.ceil(this.filteredWines().length/this.winePageSize));this.loadData()}loadData(){this.allProductCosts.set(this.dataService.getProductCosts()),this.allCigarCosts.set(this.dataService.getCigarCosts()),this.allWineCosts.set(this.dataService.getWineCosts()),this.allVendors.set(this.dataService.getVendors())}changeView(e){this.activeView.set(e)}filterAndSort(e,t,i,r,o,a){let u=t.toLowerCase(),c=e.filter(p=>Object.entries(i).every(([y,v])=>!v||p[y]===v)?u?r.some(y=>String(p[y]).toLowerCase().includes(u)):!0:!1);return o&&(c=[...c].sort((p,g)=>{let y=p[o],v=g[o];return y<v?a==="asc"?-1:1:y>v?a==="asc"?1:-1:0})),c}paginate(e,t,i){let r=(t-1)*i;return e.slice(r,r+i)}openModal(e=null){let t=this.activeView();t==="groceries"?(this.editingProductCost.set(e),this.productCostForm.reset(),e&&this.productCostForm.patchValue(e)):t==="cigars"?(this.editingCigarCost.set(e),this.cigarCostForm.reset(),e&&this.cigarCostForm.patchValue(e)):t==="wines"&&(this.editingWineCost.set(e),this.wineCostForm.reset(),e&&this.wineCostForm.patchValue(e)),this.isModalOpen.set(!0)}closeModal(){this.isModalOpen.set(!1)}handleFormSubmit(){let e=this.activeView();e==="groceries"?this.handleGroceriesSubmit():e==="cigars"?this.handleCigarSubmit():e==="wines"&&this.handleWineSubmit(),this.loadData(),this.closeModal()}handleGroceriesSubmit(){if(this.productCostForm.invalid)return;let e=this.productCostForm.value;this.editingProductCost()?this.dataService.updateProductCost(G(O({},e),{id:this.editingProductCost().id})):this.dataService.addProductCost(e)}handleCigarSubmit(){if(this.cigarCostForm.invalid)return;let e=this.cigarCostForm.value;this.editingCigarCost()?this.dataService.updateCigarCost(G(O({},e),{id:this.editingCigarCost().id})):this.dataService.addCigarCost(e)}handleWineSubmit(){if(this.wineCostForm.invalid)return;let e=this.wineCostForm.value;this.editingWineCost()?this.dataService.updateWineCost(G(O({},e),{id:this.editingWineCost().id})):this.dataService.addWineCost(e)}deleteItem(e){if(!confirm("\u60A8\u78BA\u5B9A\u8981\u522A\u9664\u6B64\u9805\u5546\u54C1\u55CE\uFF1F\u6B64\u64CD\u4F5C\u7121\u6CD5\u5FA9\u539F\u3002"))return;let t=this.activeView();t==="groceries"?this.dataService.deleteProductCost(e):t==="cigars"?this.dataService.deleteCigarCost(e):t==="wines"&&this.dataService.deleteWineCost(e),this.loadData()}sortData(e){let t=this.activeView(),i=t==="groceries"?this.groceriesSortColumn:t==="cigars"?this.cigarSortColumn:this.wineSortColumn,r=t==="groceries"?this.groceriesSortDirection:t==="cigars"?this.cigarSortDirection:this.wineSortDirection;i()===e?r.update(o=>o==="asc"?"desc":"asc"):(i.set(e),r.set("asc"))}resetFilters(e){e==="groceries"?(this.groceriesSearchTerm.set(""),this.groceriesSelectedVendor.set(""),this.groceriesSelectedCategory.set("")):e==="cigars"?(this.cigarSearchTerm.set(""),this.cigarSelectedBrand.set("")):e==="wines"&&(this.wineSearchTerm.set(""),this.wineSelectedVendor.set(""),this.wineSelectedType.set("")),this.goToPage(1,e)}applyFilters(e){this.goToPage(1,e)}goToPage(e,t){let i=t==="groceries"?this.groceriesCurrentPage:t==="cigars"?this.cigarCurrentPage:this.wineCurrentPage,r=t==="groceries"?this.groceriesTotalPages():t==="cigars"?this.cigarTotalPages():this.wineTotalPages();e>=1&&e<=r&&i.set(e)}getVendorName(e){return this.allVendors().find(t=>t.id===e)?.name||"N/A"}calculateItemCost(e,t){return!e||!t?0:e/t}calculateMargin(e,t){return!e||!t?0:(t-e)/t*100}formatCurrency(e){return e?.toLocaleString("zh-TW",{style:"currency",currency:"TWD",minimumFractionDigits:0})||""}};Xa.\u0275fac=function(t){return new(t||Xa)},Xa.\u0275cmp=re({type:Xa,selectors:[["app-product-cost"]],decls:22,vars:8,consts:[[1,"space-y-6"],[1,"flex","flex-wrap","items-center","justify-between","gap-4"],[1,"text-3xl","font-bold","text-gray-900"],[1,"bg-indigo-600","text-white","px-4","py-2","rounded-lg","font-medium","hover:bg-indigo-700","transition-colors","flex","items-center","gap-2","text-sm",3,"click"],["name","add-outline"],[1,"bg-white","p-6","rounded-xl","shadow-md"],[1,"border-b","border-gray-200"],["aria-label","Tabs",1,"-mb-px","flex","space-x-6"],[1,"whitespace-nowrap","py-4","px-1","border-b-2","font-medium","text-sm",3,"click"],[1,"pt-6"],[1,"fixed","inset-0","bg-black","bg-opacity-50","flex","items-center","justify-center","z-50"],[1,"grid","grid-cols-1","md:grid-cols-4","gap-4","p-4","bg-gray-50","rounded-lg","mb-6"],[1,"md:col-span-2"],["type","text","placeholder","\u641C\u5C0B\u5546\u54C1\u540D\u7A31\u6216\u7DE8\u865F...",1,"w-full","border-gray-300","rounded-lg","shadow-sm","text-sm","p-2","bg-white",3,"ngModelChange","ngModel"],[1,"w-full","border-gray-300","rounded-lg","shadow-sm","text-sm","p-2","bg-white",3,"ngModelChange","ngModel"],["value",""],[3,"value"],[1,"flex","items-center","gap-2","md:col-span-4","justify-end"],["title","\u91CD\u8A2D\u7BE9\u9078",1,"text-gray-500","hover:text-gray-800","p-2","rounded-full","bg-gray-100","hover:bg-gray-200",3,"click"],["name","refresh-outline",1,"text-xl"],[1,"overflow-x-auto"],[1,"w-full","text-sm","text-left","whitespace-nowrap"],[1,"text-xs","text-gray-700","uppercase","bg-gray-100"],[1,"px-4","py-3","cursor-pointer",3,"click"],[1,"px-4","py-3","cursor-pointer","text-right",3,"click"],[1,"px-4","py-3","text-right"],[1,"px-4","py-3"],[1,"border-b","hover:bg-gray-50"],[1,"flex","justify-between","items-center","pt-4","border-t","mt-4"],[1,"px-4","py-2"],[1,"px-4","py-2","font-medium"],[1,"px-4","py-2","text-right"],[1,"px-4","py-2","text-right","font-semibold","bg-green-50"],[1,"px-4","py-2","truncate","max-w-xs"],[1,"flex","items-center","gap-2"],["title","\u7DE8\u8F2F",1,"text-indigo-600","hover:text-indigo-800","p-1",3,"click"],["name","create-outline",1,"text-lg"],["title","\u522A\u9664",1,"text-red-500","hover:text-red-700","p-1",3,"click"],["name","trash-outline",1,"text-lg"],["colspan","11",1,"text-center","py-8","text-gray-500"],[1,"text-sm","text-gray-600"],[1,"px-3","py-1","border","rounded-md","disabled:opacity-50",3,"click","disabled"],["name","chevron-back-outline"],[1,"text-sm"],["name","chevron-forward-outline"],["type","text","placeholder","\u641C\u5C0B\u5546\u54C1\u3001\u5EE0\u5546\u3001\u985E\u578B...",1,"w-full","border-gray-300","rounded-lg","shadow-sm","text-sm","p-2","bg-white",3,"ngModelChange","ngModel"],["colspan","7",1,"text-center","py-8","text-gray-500"],[1,"grid","grid-cols-1","md:grid-cols-3","gap-4","p-4","bg-gray-50","rounded-lg","mb-6"],["type","text","placeholder","\u641C\u5C0B\u54C1\u724C\u6216\u5546\u54C1\u540D\u7A31...",1,"w-full","border-gray-300","rounded-lg","shadow-sm","text-sm","p-2","bg-white",3,"ngModelChange","ngModel"],[1,"flex","items-center","gap-2","md:col-span-3","justify-end"],["colspan","9",1,"text-center","py-8","text-gray-500"],[1,"bg-white","rounded-xl","shadow-2xl","w-full","max-w-2xl","max-h-[90vh]","flex","flex-col"],[1,"flex","justify-between","items-center","p-4","border-b"],[1,"text-lg","font-semibold"],[1,"text-gray-400","hover:text-gray-600",3,"click"],["name","close-outline",1,"text-2xl"],[1,"p-6","overflow-y-auto"],["novalidate","",1,"space-y-4",3,"ngSubmit"],[1,"space-y-4",3,"formGroup"],[1,"flex","justify-end","gap-4","pt-4","border-t","mt-4"],["type","button",1,"px-4","py-2","border","rounded-md",3,"click"],["type","submit",1,"px-4","py-2","bg-indigo-600","text-white","rounded-md"],[1,"grid","grid-cols-1","md:grid-cols-2","gap-4"],[1,"block"],[1,"text-gray-700"],["formControlName","productId",1,"mt-1","block","w-full","rounded-md","border-gray-300","shadow-sm","bg-gray-50","p-2"],["formControlName","productName",1,"mt-1","block","w-full","rounded-md","border-gray-300","shadow-sm","bg-gray-50","p-2"],["formControlName","category","list","productCategoriesList","placeholder","\u9078\u64C7\u6216\u8F38\u5165\u65B0\u54C1\u9805",1,"mt-1","block","w-full","rounded-md","border-gray-300","shadow-sm","bg-gray-50","p-2"],["id","productCategoriesList"],["formControlName","vendorId",1,"mt-1","block","w-full","rounded-md","border-gray-300","shadow-sm","bg-gray-50","p-2"],["value","","disabled",""],["type","number","formControlName","itemQuantity",1,"mt-1","block","w-full","rounded-md","border-gray-300","shadow-sm","bg-gray-50","p-2"],["formControlName","itemUnit","placeholder","\u4F8B\u5982: ml, g, \u9846",1,"mt-1","block","w-full","rounded-md","border-gray-300","shadow-sm","bg-gray-50","p-2"],["formControlName","totalUnit","placeholder","\u4F8B\u5982: \u74F6, \u5305, \u7F50",1,"mt-1","block","w-full","rounded-md","border-gray-300","shadow-sm","bg-gray-50","p-2"],["type","number","formControlName","price",1,"mt-1","block","w-full","rounded-md","border-gray-300","shadow-sm","bg-gray-50","p-2"],["formControlName","notes","rows","3",1,"mt-1","block","w-full","rounded-md","border-gray-300","shadow-sm","bg-gray-50","p-2"],["formControlName","vendor",1,"mt-1","block","w-full","rounded-md","border-gray-300","shadow-sm","bg-gray-50","p-2"],["formControlName","type",1,"mt-1","block","w-full","rounded-md","border-gray-300","shadow-sm","bg-gray-50","p-2"],["type","number","formControlName","cost",1,"mt-1","block","w-full","rounded-md","border-gray-300","shadow-sm","bg-gray-50","p-2"],[1,"block","md:col-span-2"],["type","number","formControlName","sellingPrice",1,"mt-1","block","w-full","rounded-md","border-gray-300","shadow-sm","bg-gray-50","p-2"],["formControlName","brand",1,"mt-1","block","w-full","rounded-md","border-gray-300","shadow-sm","bg-gray-50","p-2"],["formControlName","size",1,"mt-1","block","w-full","rounded-md","border-gray-300","shadow-sm","bg-gray-50","p-2"],["type","number","formControlName","quantityPerBox",1,"mt-1","block","w-full","rounded-md","border-gray-300","shadow-sm","bg-gray-50","p-2"],["type","number","formControlName","lishengCost",1,"mt-1","block","w-full","rounded-md","border-gray-300","shadow-sm","bg-gray-50","p-2"],["type","number","formControlName","baijiaCost",1,"mt-1","block","w-full","rounded-md","border-gray-300","shadow-sm","bg-gray-50","p-2"]],template:function(t,i){if(t&1&&(l(0,"div",0)(1,"div",1)(2,"h1",2),d(3,"\u5546\u54C1\u6210\u672C\u7BA1\u7406"),s(),l(4,"button",3),b("click",function(){return i.openModal()}),x(5,"ion-icon",4),l(6,"span"),d(7,"\u65B0\u589E\u9805\u76EE"),s()()(),l(8,"div",5)(9,"div",6)(10,"nav",7)(11,"button",8),b("click",function(){return i.changeView("groceries")}),d(12,"\u9910\u98F2&\u96DC\u8CA8"),s(),l(13,"button",8),b("click",function(){return i.changeView("wines")}),d(14,"\u5A01&\u7D05\u767D\u9152"),s(),l(15,"button",8),b("click",function(){return i.changeView("cigars")}),d(16,"\u96EA\u8304"),s()()(),l(17,"div",9),M(18,lU,49,5)(19,fU,41,5)(20,vU,39,4),s()()(),M(21,IU,19,2,"div",10)),t&2){let r;m(11),Te(i.activeView()==="groceries"?"border-indigo-500 text-indigo-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"),m(2),Te(i.activeView()==="wines"?"border-indigo-500 text-indigo-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"),m(2),Te(i.activeView()==="cigars"?"border-indigo-500 text-indigo-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"),m(3),A((r=i.activeView())==="groceries"?18:r==="wines"?19:r==="cigars"?20:-1),m(3),A(i.isModalOpen()?21:-1)}},dependencies:[se,Be,Ve,He,Ge,be,Bt,Oe,fe,ke,Le,Ue,De,Ie,Yl],encapsulation:2,changeDetection:0});var Cp=Xa;var MU=(n,e)=>e.vendor_id||e.id;function AU(n,e){n&1&&(l(0,"div",1),x(1,"ion-icon",29),l(2,"span",30),d(3,"\u6B63\u5728\u52A0\u8F09\u6578\u64DA..."),s()())}function RU(n,e){if(n&1&&(l(0,"div",2),x(1,"ion-icon",31),l(2,"span",32),d(3),s()()),n&2){let t=_();m(3),w(t.errorMessage())}}function NU(n,e){if(n&1&&(l(0,"option",14),d(1),s()),n&2){let t=e.$implicit;I("value",t),m(),w(t)}}function FU(n,e){if(n&1&&d(0),n&2){let t=_().$implicit;N(" ",t.rest_days.join(", ")," ")}}function PU(n,e){if(n&1&&d(0),n&2){let t=_().$implicit;N(" ",t.restDays||"-"," ")}}function kU(n,e){if(n&1){let t=B();l(0,"tr",33),b("click",function(){let r=E(t).$implicit,o=_();return S(o.openModal(r))}),l(1,"td",34),d(2),s(),l(3,"td",35),d(4),s(),l(5,"td",34),d(6),s(),l(7,"td",34),M(8,FU,1,1)(9,PU,1,1),s()()}if(n&2){let t=e.$implicit;m(2),w(t.category),m(2),w(t.vendor_name||t.name),m(2),w(t.contact_info||t.contactInfo),m(2),A(t.rest_days&&t.rest_days.length>0?8:9)}}function VU(n,e){n&1&&(l(0,"tr")(1,"td",36),d(2,"\u7121\u7B26\u5408\u689D\u4EF6\u7684\u5EE0\u5546\u8CC7\u6599\u3002"),s()())}function LU(n,e){if(n&1&&(l(0,"div",52),x(1,"ion-icon",56),l(2,"span",57),d(3),s()()),n&2){let t=_(2);m(3),w(t.errorMessage())}}function OU(n,e){n&1&&(x(0,"ion-icon",58),l(1,"span"),d(2,"\u5132\u5B58\u4E2D..."),s())}function BU(n,e){n&1&&(l(0,"span"),d(1,"\u5132\u5B58"),s())}function UU(n,e){if(n&1){let t=B();l(0,"div",28)(1,"div",37)(2,"div",38)(3,"h3",39),d(4),s(),l(5,"button",40),b("click",function(){E(t);let r=_();return S(r.closeModal())}),x(6,"ion-icon",41),s()(),l(7,"div",42)(8,"form",43),b("ngSubmit",function(){E(t);let r=_();return S(r.handleVendorSubmit())}),x(9,"input",44),l(10,"label",45)(11,"span",46),d(12,"\u985E\u5225*"),s(),x(13,"input",47),s(),l(14,"label",45)(15,"span",46),d(16,"\u5EE0\u5546\u540D\u7A31*"),s(),x(17,"input",48),s(),l(18,"label",45)(19,"span",46),d(20,"\u7D71\u4E00\u7DE8\u865F"),s(),x(21,"input",49),s(),l(22,"label",45)(23,"span",46),d(24,"\u806F\u7D61\u65B9\u5F0F"),s(),x(25,"input",50),s(),l(26,"label",45)(27,"span",46),d(28,"\u4F11\u606F\u6642\u9593"),s(),x(29,"input",51),s(),M(30,LU,4,1,"div",52),l(31,"div",53)(32,"button",54),b("click",function(){E(t);let r=_();return S(r.closeModal())}),d(33,"\u53D6\u6D88"),s(),l(34,"button",55),M(35,OU,3,0)(36,BU,2,0,"span"),s()()()()()()}if(n&2){let t=_();m(4),w(t.editingVendor()?"\u7DE8\u8F2F\u5EE0\u5546":"\u65B0\u589E\u5EE0\u5546"),m(4),I("formGroup",t.vendorForm),m(22),A(t.errorMessage()?30:-1),m(2),I("disabled",t.isLoading()),m(2),I("disabled",t.isLoading()),m(),A(t.isLoading()?35:36)}}var es=class es{constructor(){this.apiService=k(we);this.fb=k(qe);this.isModalOpen=D(!1);this.isLoading=D(!1);this.errorMessage=D(null);this.allVendors=D([]);this.editingVendor=D(null);this.vendorForm=this.fb.group({vendor_id:[""],category:["",U.required],vendor_name:["",U.required],tax_id:[""],contact_info:[""],rest_days:[""]});this.vendorSearchTerm=D("");this.selectedVendorCategory=D("");this.vendorTaxIdFilter=D("");this.pageSize=20;this.currentPage=D(1);this.vendorCategories=$(()=>{let e=this.allVendors();return[...new Set(e.map(i=>i.category))].sort()});this.filteredVendors=$(()=>{let e=this.vendorSearchTerm().toLowerCase(),t=this.selectedVendorCategory(),i=this.vendorTaxIdFilter(),r=this.allVendors();return t&&(r=r.filter(o=>o.category===t)),i&&(r=r.filter(o=>(o.tax_id||o.taxId||"").includes(i))),e&&(r=r.filter(o=>(o.vendor_name||o.name||"").toLowerCase().includes(e)||(o.category||"").toLowerCase().includes(e)||(o.contact_info||o.contactInfo||"").toLowerCase().includes(e))),r});this.pagedVendors=$(()=>{let e=this.filteredVendors(),t=(this.currentPage()-1)*this.pageSize;return e.slice(t,t+this.pageSize)});this.totalPages=$(()=>{let e=this.filteredVendors().length;return Math.max(1,Math.ceil(e/this.pageSize))});this.totalRecords=$(()=>this.filteredVendors().length);this.loadData()}async loadData(){this.isLoading.set(!0),this.errorMessage.set(null);try{let e=await this.apiService.getVendors();e.success&&e.data?this.allVendors.set(e.data):this.errorMessage.set(e.error||"\u7121\u6CD5\u53D6\u5F97\u5EE0\u5546\u8CC7\u6599")}catch(e){console.error("Error loading vendors:",e),this.errorMessage.set("\u53D6\u5F97\u5EE0\u5546\u8CC7\u6599\u5931\u6557\uFF0C\u8ACB\u7A0D\u5F8C\u91CD\u8A66")}finally{this.isLoading.set(!1)}}resetVendorFilters(){this.vendorSearchTerm.set(""),this.selectedVendorCategory.set(""),this.vendorTaxIdFilter.set(""),this.currentPage.set(1)}goToPage(e){let t=this.totalPages(),i=Math.min(Math.max(e,1),t);i!==this.currentPage()&&this.currentPage.set(i)}goToPrevPage(){this.goToPage(this.currentPage()-1)}goToNextPage(){this.goToPage(this.currentPage()+1)}onTaxIdInput(e){let t=e.target,i=t.value.replace(/\D/g,"").slice(0,8);this.vendorTaxIdFilter.set(i),t.value=i,this.currentPage.set(1)}openModal(e=null){this.editingVendor.set(e),this.vendorForm.reset(),e&&this.vendorForm.patchValue(e),this.isModalOpen.set(!0)}closeModal(){this.isModalOpen.set(!1),this.editingVendor.set(null)}async handleVendorSubmit(){if(this.vendorForm.invalid){this.errorMessage.set("\u8ACB\u586B\u5BEB\u6240\u6709\u5FC5\u586B\u6B04\u4F4D");return}this.isLoading.set(!0),this.errorMessage.set(null);try{let e=this.vendorForm.value,t={vendor_id:e.vendor_id?Number(e.vendor_id):void 0,category:e.category||"",vendor_name:e.vendor_name||"",tax_id:e.tax_id||void 0,contact_info:e.contact_info||"",rest_days:e.rest_days?e.rest_days.split(",").map(i=>i.trim()).filter(i=>i):[]};if(this.editingVendor()&&t.vendor_id){let i=await this.apiService.updateVendor(t);if(!i.success){this.errorMessage.set(i.error||"\u66F4\u65B0\u5EE0\u5546\u5931\u6557");return}let o=this.allVendors().map(a=>(a.vendor_id||a.id)==t.vendor_id?O(G(O({},a),{vendor_id:t.vendor_id,category:t.category,vendor_name:t.vendor_name,tax_id:t.tax_id,contact_info:t.contact_info,rest_days:t.rest_days}),i.data||{}):a);this.allVendors.set(o),alert("\u5EE0\u5546\u8CC7\u6599\u5DF2\u6210\u529F\u66F4\u65B0"),this.closeModal()}else this.errorMessage.set("\u65B0\u589E\u5EE0\u5546\u529F\u80FD\u5C1A\u672A\u5BE6\u4F5C"),console.warn("\u65B0\u589E\u5EE0\u5546\u529F\u80FD\u9700\u8981\u5F8C\u7AEF\u652F\u6301")}catch(e){console.error("Error submitting vendor:",e),this.errorMessage.set("\u63D0\u4EA4\u5EE0\u5546\u8CC7\u6599\u5931\u6557\uFF1A"+(e instanceof Error?e.message:"\u672A\u77E5\u932F\u8AA4"))}finally{this.isLoading.set(!1)}}async deleteVendor(e){let t=e.vendor_name||e.name||"\u672A\u77E5\u5EE0\u5546";if(!confirm(`\u60A8\u78BA\u5B9A\u8981\u522A\u9664\u5EE0\u5546 "${t}" \u55CE\uFF1F\u6B64\u64CD\u4F5C\u7121\u6CD5\u5FA9\u539F\u3002`))return;let i=e.vendor_id||e.id;if(!i){this.errorMessage.set("\u5EE0\u5546 ID \u4E0D\u5B58\u5728\uFF0C\u7121\u6CD5\u522A\u9664");return}this.isLoading.set(!0),this.errorMessage.set(null);try{let r=await this.apiService.deleteVendor(i);r.success?await this.loadData():this.errorMessage.set(r.error||"\u522A\u9664\u5EE0\u5546\u5931\u6557")}catch(r){console.error("Error deleting vendor:",r),this.errorMessage.set("\u522A\u9664\u5EE0\u5546\u5931\u6557\uFF0C\u8ACB\u7A0D\u5F8C\u91CD\u8A66")}finally{this.isLoading.set(!1)}}formatCurrency(e){return e==null?"":e.toLocaleString("zh-TW",{style:"currency",currency:"TWD",minimumFractionDigits:0})}};es.\u0275fac=function(t){return new(t||es)},es.\u0275cmp=re({type:es,selectors:[["app-vendors"]],decls:51,vars:13,consts:[[1,"space-y-6"],[1,"bg-blue-50","border","border-blue-200","rounded-lg","p-4","flex","items-center","gap-3"],[1,"bg-red-50","border","border-red-200","rounded-lg","p-4","flex","items-center","gap-3"],[1,"flex","flex-wrap","items-center","justify-between","gap-4"],[1,"text-3xl","font-bold","text-gray-900"],[1,"bg-indigo-600","text-white","px-4","py-2","rounded-lg","font-medium","hover:bg-indigo-700","transition-colors","flex","items-center","gap-2","text-sm","disabled:opacity-50","disabled:cursor-not-allowed",3,"click","disabled"],["name","add-outline"],[1,"bg-white","p-6","rounded-xl","shadow-md"],[1,"space-y-4"],[1,"grid","grid-cols-1","md:grid-cols-2","lg:grid-cols-4","gap-4","p-4","bg-gray-50","rounded-lg"],[1,"lg:col-span-2"],["type","text","placeholder","\u641C\u5C0B\u5EE0\u5546\u540D\u7A31\u3001\u985E\u5225\u6216\u806F\u7D61\u65B9\u5F0F...",1,"w-full","border-gray-300","rounded-lg","shadow-sm","focus:ring-indigo-500","focus:border-indigo-500","text-sm","p-2","bg-white",3,"ngModelChange","ngModel"],[1,"w-full","border-gray-300","rounded-lg","shadow-sm","focus:ring-indigo-500","focus:border-indigo-500","text-sm","p-2","bg-white",3,"ngModelChange","ngModel"],["value",""],[3,"value"],["type","text","placeholder","\u7D71\u4E00\u7DE8\u865F (8\u78BC)","maxlength","8","pattern","\\d*",1,"w-full","border-gray-300","rounded-lg","shadow-sm","focus:ring-indigo-500","focus:border-indigo-500","text-sm","p-2","bg-white",3,"input","value"],[1,"flex","items-center","gap-2","lg:col-span-4","justify-end"],["title","\u91CD\u8A2D\u7BE9\u9078",1,"text-gray-500","hover:text-gray-800","transition-colors","p-2","rounded-full","bg-gray-100","hover:bg-gray-200",3,"click"],["name","refresh-outline",1,"text-xl"],[1,"overflow-x-auto"],[1,"w-full","text-sm","text-left","whitespace-nowrap"],[1,"text-xs","text-gray-700","uppercase","bg-gray-100"],[1,"px-4","py-3"],[1,"border-b","hover:bg-gray-50","cursor-pointer","transition-colors"],[1,"flex","flex-col","sm:flex-row","items-center","justify-between","gap-3","pt-4"],[1,"text-sm","text-gray-600"],[1,"flex","items-center","gap-2"],["type","button",1,"px-3","py-1.5","text-sm","border","rounded-md","disabled:opacity-50","disabled:cursor-not-allowed","hover:bg-gray-50",3,"click","disabled"],[1,"fixed","inset-0","bg-black","bg-opacity-50","flex","items-center","justify-center","z-50"],["name","hourglass-outline",1,"text-blue-600","text-xl","animate-spin"],[1,"text-blue-700"],["name","alert-circle-outline",1,"text-red-600","text-xl"],[1,"text-red-700"],[1,"border-b","hover:bg-gray-50","cursor-pointer","transition-colors",3,"click"],[1,"px-4","py-2"],[1,"px-4","py-2","font-medium"],["colspan","4",1,"text-center","py-8","text-gray-500"],[1,"bg-white","rounded-xl","shadow-2xl","w-full","max-w-lg","max-h-[90vh]","flex","flex-col"],[1,"flex","justify-between","items-center","p-4","border-b"],[1,"text-lg","font-semibold"],[1,"text-gray-400","hover:text-gray-600",3,"click"],["name","close-outline",1,"text-2xl"],[1,"p-6","overflow-y-auto"],[1,"space-y-4",3,"ngSubmit","formGroup"],["type","hidden","formControlName","vendor_id"],[1,"block"],[1,"text-gray-700"],["formControlName","category",1,"mt-1","block","w-full","rounded-md","border-gray-300","shadow-sm","bg-gray-50","p-2"],["formControlName","vendor_name",1,"mt-1","block","w-full","rounded-md","border-gray-300","shadow-sm","bg-gray-50","p-2"],["formControlName","tax_id","type","text","maxlength","8","pattern","\\d*","placeholder","8\u4F4D\u6578\u5B57",1,"mt-1","block","w-full","rounded-md","border-gray-300","shadow-sm","bg-gray-50","p-2"],["formControlName","contact_info",1,"mt-1","block","w-full","rounded-md","border-gray-300","shadow-sm","bg-gray-50","p-2"],["formControlName","rest_days","placeholder","\u4F8B\uFF1A\u5468\u4E00,\u5468\u4E8C",1,"mt-1","block","w-full","rounded-md","border-gray-300","shadow-sm","bg-gray-50","p-2"],[1,"bg-red-50","border","border-red-200","rounded-lg","p-3","flex","items-center","gap-2"],[1,"flex","justify-end","gap-4","pt-4","border-t","mt-4"],["type","button",1,"px-4","py-2","border","rounded-md","disabled:opacity-50","disabled:cursor-not-allowed","hover:bg-gray-50",3,"click","disabled"],["type","submit",1,"px-4","py-2","bg-indigo-600","text-white","rounded-md","hover:bg-indigo-700","disabled:opacity-50","disabled:cursor-not-allowed","flex","items-center","gap-2",3,"disabled"],["name","alert-circle-outline",1,"text-red-600","text-lg"],[1,"text-red-700","text-sm"],["name","hourglass-outline",1,"animate-spin"]],template:function(t,i){t&1&&(l(0,"div",0),M(1,AU,4,0,"div",1),M(2,RU,4,1,"div",2),l(3,"div",3)(4,"h1",4),d(5,"\u5EE0\u5546\u7BA1\u7406"),s(),l(6,"button",5),b("click",function(){return i.openModal()}),x(7,"ion-icon",6),l(8,"span"),d(9,"\u65B0\u589E\u5EE0\u5546"),s()()(),l(10,"div",7)(11,"div",8)(12,"div",9)(13,"div",10)(14,"input",11),b("ngModelChange",function(o){return i.vendorSearchTerm.set(o),i.currentPage.set(1)}),s()(),l(15,"div")(16,"select",12),b("ngModelChange",function(o){return i.selectedVendorCategory.set(o),i.currentPage.set(1)}),l(17,"option",13),d(18,"\u6240\u6709\u985E\u5225"),s(),V(19,NU,2,2,"option",14,Y),s()(),l(21,"div")(22,"input",15),b("input",function(o){return i.onTaxIdInput(o)}),s()(),l(23,"div",16)(24,"button",17),b("click",function(){return i.resetVendorFilters()}),x(25,"ion-icon",18),s()()(),l(26,"div",19)(27,"table",20)(28,"thead",21)(29,"tr")(30,"th",22),d(31,"\u985E\u5225"),s(),l(32,"th",22),d(33,"\u5EE0\u5546"),s(),l(34,"th",22),d(35,"\u806F\u7D61\u65B9\u5F0F"),s(),l(36,"th",22),d(37,"\u4F11\u606F\u6642\u9593"),s()()(),l(38,"tbody"),V(39,kU,10,4,"tr",23,MU,!1,VU,3,0,"tr"),s()()(),l(42,"div",24)(43,"div",25),d(44),s(),l(45,"div",26)(46,"button",27),b("click",function(){return i.goToPrevPage()}),d(47," \u4E0A\u4E00\u9801 "),s(),l(48,"button",27),b("click",function(){return i.goToNextPage()}),d(49," \u4E0B\u4E00\u9801 "),s()()()()()(),M(50,UU,37,6,"div",28)),t&2&&(m(),A(i.isLoading()?1:-1),m(),A(i.errorMessage()?2:-1),m(4),I("disabled",i.isLoading()),m(8),I("ngModel",i.vendorSearchTerm()),m(2),I("ngModel",i.selectedVendorCategory()),m(3),L(i.vendorCategories()),m(3),I("value",i.vendorTaxIdFilter()),m(17),L(i.pagedVendors()),m(5),Lt(" \u7B2C ",i.currentPage()," / ",i.totalPages()," \u9801\uFF0C\u5171 ",i.totalRecords()," \u7B46 "),m(2),I("disabled",i.currentPage()===1),m(2),I("disabled",i.currentPage()===i.totalPages()),m(2),A(i.isModalOpen()?50:-1))},dependencies:[se,Be,Ve,He,Ge,be,Oe,fe,ke,Ql,Zl,Le,Ue,De,Ie],encapsulation:2,changeDetection:0});var xp=es;var _S=(n,e)=>e.id,h_=(n,e)=>e.name;function $U(n,e){if(n&1&&(l(0,"option",18),d(1),s()),n&2){let t=e.$implicit;I("value",t.id),m(),w(t.name)}}function HU(n,e){n&1&&(l(0,"div",26),x(1,"ion-icon",34),l(2,"span"),d(3,"\u8F09\u5165\u9032\u8CA8\u55AE\u8CC7\u6599\u4E2D..."),s()())}function GU(n,e){if(n&1&&(l(0,"div",27)(1,"div",10),x(2,"ion-icon",35),l(3,"span"),d(4),s()()()),n&2){let t=_(2);m(4),w(t.shipmentError())}}function qU(n,e){if(n&1&&(d(0),jt(1,"number")),n&2){let t=_().$implicit;N(" ",un(1,1,t.qty,"1.2-2")," ")}}function WU(n,e){n&1&&d(0," - ")}function jU(n,e){if(n&1&&d(0),n&2){let t=_().$implicit,i=_(2);N(" ",i.formatCurrency(t.unitPrice)," ")}}function zU(n,e){n&1&&d(0," - ")}function YU(n,e){if(n&1&&d(0),n&2){let t=_().$implicit,i=_(2);N(" ",i.formatCurrency(t.lineAmount)," ")}}function JU(n,e){n&1&&d(0," - ")}function KU(n,e){if(n&1){let t=B();l(0,"tr",36),b("click",function(){let r=E(t).$implicit,o=_(2);return S(o.openShipmentEditModal(r))}),l(1,"td",37),d(2),s(),l(3,"td",38),d(4),s(),l(5,"td",37),d(6),s(),l(7,"td",39),M(8,qU,2,4)(9,WU,1,0),s(),l(10,"td",39),d(11),s(),l(12,"td",39),M(13,jU,1,1)(14,zU,1,0),s(),l(15,"td",40),M(16,YU,1,1)(17,JU,1,0),s(),l(18,"td",41),d(19),s()()}if(n&2){let t=e.$implicit,i=_(2);m(2),w(i.formatDate(t.issueDate)),m(2),w(t.vendorName),m(2),w(t.itemName),m(2),A(t.qty!==null?8:9),m(3),w(t.unit||"-"),m(2),A(t.unitPrice!==null?13:14),m(3),A(t.lineAmount!==null?16:17),m(3),w(t.remark||"-")}}function QU(n,e){n&1&&(l(0,"tr")(1,"td",42),d(2,"\u672A\u627E\u5230\u9032\u8CA8\u55AE\u8CC7\u6599\u3002"),s()())}function ZU(n,e){if(n&1&&(l(0,"div",4),M(1,HU,4,0,"div",26),M(2,GU,5,1,"div",27),l(3,"div",28)(4,"table",29)(5,"thead",30)(6,"tr")(7,"th",31),d(8,"\u958B\u7ACB\u65E5\u671F"),s(),l(9,"th",31),d(10,"\u5EE0\u5546"),s(),l(11,"th",31),d(12,"\u54C1\u9805\u540D\u7A31"),s(),l(13,"th",32),d(14,"\u6578\u91CF"),s(),l(15,"th",32),d(16,"\u55AE\u4F4D"),s(),l(17,"th",32),d(18,"\u55AE\u50F9"),s(),l(19,"th",32),d(20,"\u5C0F\u8A08"),s(),l(21,"th",31),d(22,"\u5099\u8A3B"),s()()(),l(23,"tbody"),V(24,KU,20,8,"tr",33,sn,!1,QU,3,0,"tr"),s()()()()),n&2){let t=_();m(),A(t.isLoadingShipments()?1:-1),m(),A(!t.isLoadingShipments()&&t.shipmentError()?2:-1),m(22),L(t.pagedShipments())}}function XU(n,e){if(n&1){let t=B();Ui(),l(0,"g",59),b("mouseenter",function(){E(t);let r=_().$implicit,o=_(4);return S(o.hoveredVendor.set(r.name))})("mouseleave",function(){E(t);let r=_(5);return S(r.hoveredVendor.set(null))}),x(1,"path",60),s()}if(n&2){let t=_(),i=t.$implicit,r=t.$index,o=_(4);m(),gt("d",o.getPieSlicePath(r,o.pieChartData()))("fill",o.getPieColor(r,o.pieChartData().length))("opacity",o.hoveredVendor()===i.name?"1":"0.8")("stroke",o.hoveredVendor()===i.name?"#000":"none")}}function e$(n,e){if(n&1&&M(0,XU,2,4,":svg:g"),n&2){let t=e.$implicit;A(t.percentage>0?0:-1)}}function t$(n,e){if(n&1&&(l(0,"div",61)(1,"div",62),d(2),s(),l(3,"div",63),d(4),s(),l(5,"div",64),d(6),jt(7,"number"),s()()),n&2){let t=_().$implicit,i=_(5);m(2),w(t.name),m(2),w(i.formatCurrency(t.amount)),m(2),N("",un(7,3,t.percentage,"1.1-1"),"%")}}function n$(n,e){if(n&1&&M(0,t$,8,6,"div",61),n&2){let t=e.$implicit,i=_(5);A(t.name===i.hoveredVendor()?0:-1)}}function i$(n,e){if(n&1&&V(0,n$,1,1,null,null,h_),n&2){let t=_(4);L(t.pieChartData())}}function r$(n,e){n&1&&(l(0,"div",57),d(1,"\u6ED1\u9F20\u79FB\u5230\u5713\u9905\u5716\u5207\u7247\u4EE5\u67E5\u770B\u660E\u7D30"),s())}function o$(n,e){if(n&1&&(l(0,"div",10),x(1,"div",65),l(2,"div",66)(3,"div",67),d(4),s(),l(5,"div",68),d(6),s()()()),n&2){let t=e.$implicit,i=_(4);m(),Xt("background-color",i.getVendorColor(t.name)),m(3),w(t.name),m(2),w(i.formatCurrency(t.amount))}}function a$(n,e){if(n&1&&(l(0,"div",51)(1,"div",52),d(2,"\u5EE0\u5546\u9032\u8CA8\u91D1\u984D\u5206\u4F48"),s(),l(3,"div",53)(4,"div",54),Ui(),l(5,"svg",55),V(6,e$,1,1,null,null,h_),s()(),Yr(),l(8,"div",56),M(9,i$,2,0)(10,r$,2,0,"div",57),s()(),l(11,"div",58),V(12,o$,7,4,"div",10,h_),s()()),n&2){let t=_(3);m(6),L(t.pieChartData()),m(3),A(t.hoveredVendor()?9:10),m(3),L(t.vendorAmountEntries())}}function s$(n,e){if(n&1&&(l(0,"div",44)(1,"div",45)(2,"div",46),d(3,"\u9032\u8CA8\u9805\u76EE\u6578"),s(),l(4,"div",47),d(5),s()(),l(6,"div",48)(7,"div",49),d(8,"\u9032\u8CA8\u7E3D\u91D1\u984D"),s(),l(9,"div",50),d(10),s()()(),M(11,a$,14,1,"div",51)),n&2){let t=_(2);m(5),w(t.shipmentStats().totalItems),m(5),w(t.formatCurrency(t.shipmentStats().totalAmount)),m(),A(t.vendorAmountEntries().length>0&&t.shipmentStats().totalAmount>0?11:-1)}}function l$(n,e){n&1&&(l(0,"div",43),d(1,"\u5C1A\u7121\u53EF\u5206\u6790\u7684\u9032\u8CA8\u55AE\u8CC7\u6599\u3002"),s())}function u$(n,e){if(n&1&&(l(0,"div",4),M(1,s$,12,3)(2,l$,2,0,"div",43),s()),n&2){let t=_();m(),A(!t.isLoadingShipments()&&!t.shipmentError()&&t.filteredShipments().length>0?1:2)}}function d$(n,e){if(n&1){let t=B();l(0,"div",24)(1,"div",64),d(2),s(),l(3,"div",10)(4,"button",70),b("click",function(){E(t);let r=_(2);return S(r.setShipmentPage(r.shipmentPage()-1))}),d(5,"\u4E0A\u4E00\u9801"),s(),l(6,"button",70),b("click",function(){E(t);let r=_(2);return S(r.setShipmentPage(r.shipmentPage()+1))}),d(7,"\u4E0B\u4E00\u9801"),s()()()}if(n&2){let t=_(2);m(2),Lt(" \u7B2C ",t.shipmentPage()," / ",t.shipmentTotalPages()," \u9801\uFF0C\u5171 ",t.filteredShipments().length," \u7B46 "),m(2),j("text-gray-400",t.shipmentPage()===1),I("disabled",t.shipmentPage()===1),m(2),j("text-gray-400",t.shipmentPage()===t.shipmentTotalPages()),I("disabled",t.shipmentPage()===t.shipmentTotalPages())}}function c$(n,e){if(n&1&&xt(0,d$,8,9,"div",69),n&2){let t=_();I("ngIf",t.shipmentTotalPages()>1)}}function m$(n,e){if(n&1&&(l(0,"option",18),d(1),s()),n&2){let t=e.$implicit;I("value",t.id),m(),w(t.name)}}function p$(n,e){if(n&1){let t=B();l(0,"div",91),x(1,"input",97)(2,"input",98)(3,"input",99),l(4,"span",88),d(5),s(),l(6,"button",100),b("click",function(){let r=E(t).$index,o=_(2);return S(o.removeItem(r))}),x(7,"ion-icon",101),s()()}if(n&2){let t,i=e.$implicit,r=e.$index,o=_(2);I("formGroupName",r),m(5),w(o.formatCurrency((t=i.get("total"))==null?null:t.value))}}function f$(n,e){if(n&1){let t=B();l(0,"div",25)(1,"div",71)(2,"div",72)(3,"h3",73),d(4),s(),l(5,"button",74),b("click",function(){E(t);let r=_();return S(r.closeModal())}),x(6,"ion-icon",75),s()(),l(7,"div",76)(8,"form",77),b("ngSubmit",function(){E(t);let r=_();return S(r.handlePOSubmit())}),l(9,"div",78)(10,"label",79)(11,"span",80),d(12,"\u9032\u8CA8\u55AE\u865F*"),s(),x(13,"input",81),s(),l(14,"label",79)(15,"span",80),d(16,"\u65E5\u671F*"),s(),x(17,"input",82),s()(),l(18,"label",79)(19,"span",80),d(20,"\u5EE0\u5546*"),s(),l(21,"select",83)(22,"option",84),d(23,"\u9078\u64C7\u5EE0\u5546"),s(),V(24,m$,2,2,"option",18,_S),s()(),l(26,"h4",85),d(27,"\u54C1\u9805"),s(),l(28,"div",86)(29,"div",87),d(30,"\u54C1\u9805\u540D\u7A31"),s(),l(31,"div",88),d(32,"\u6578\u91CF"),s(),l(33,"div",88),d(34,"\u55AE\u50F9"),s(),l(35,"div",88),d(36,"\u5C0F\u8A08"),s(),x(37,"div",89),s(),l(38,"div",90),V(39,p$,8,2,"div",91,sn),s(),l(41,"button",92),b("click",function(){E(t);let r=_();return S(r.addItem())}),d(42,"+ \u65B0\u589E\u54C1\u9805"),s(),l(43,"div",93),d(44),s(),l(45,"div",94)(46,"button",95),b("click",function(){E(t);let r=_();return S(r.closeModal())}),d(47,"\u53D6\u6D88"),s(),l(48,"button",96),d(49,"\u5132\u5B58"),s()()()()()()}if(n&2){let t,i=_();m(4),w(i.editingPO()?"\u7DE8\u8F2F\u9032\u8CA8\u55AE":"\u65B0\u589E\u9032\u8CA8\u55AE"),m(4),I("formGroup",i.poForm),m(16),L(i.allVendors()),m(15),L(i.poItems.controls),m(5),N("\u7E3D\u8A08: ",i.formatCurrency((t=i.poForm.get("totalAmount"))==null?null:t.value))}}function g$(n,e){if(n&1){let t=B();l(0,"div",4)(1,"div",78)(2,"label",79)(3,"span",102),d(4,"\u958B\u7ACB\u65E5\u671F*"),s(),l(5,"input",103),K("ngModelChange",function(r){E(t);let o=_(2);return Q(o.editingShipmentItem().issueDate,r)||(o.editingShipmentItem().issueDate=r),S(r)}),s()(),l(6,"label",79)(7,"span",102),d(8,"\u5EE0\u5546*"),s(),l(9,"input",104),K("ngModelChange",function(r){E(t);let o=_(2);return Q(o.editingShipmentItem().vendorName,r)||(o.editingShipmentItem().vendorName=r),S(r)}),s()()(),l(10,"label",79)(11,"span",102),d(12,"\u54C1\u9805\u540D\u7A31*"),s(),l(13,"input",105),K("ngModelChange",function(r){E(t);let o=_(2);return Q(o.editingShipmentItem().itemName,r)||(o.editingShipmentItem().itemName=r),S(r)}),s()(),l(14,"div",106)(15,"label",79)(16,"span",102),d(17,"\u6578\u91CF"),s(),l(18,"input",107),K("ngModelChange",function(r){E(t);let o=_(2);return Q(o.editingShipmentItem().qty,r)||(o.editingShipmentItem().qty=r),S(r)}),s()(),l(19,"label",79)(20,"span",102),d(21,"\u55AE\u4F4D"),s(),l(22,"input",105),K("ngModelChange",function(r){E(t);let o=_(2);return Q(o.editingShipmentItem().unit,r)||(o.editingShipmentItem().unit=r),S(r)}),s()(),l(23,"label",79)(24,"span",102),d(25,"\u55AE\u50F9"),s(),l(26,"input",107),K("ngModelChange",function(r){E(t);let o=_(2);return Q(o.editingShipmentItem().unitPrice,r)||(o.editingShipmentItem().unitPrice=r),S(r)}),s()()(),l(27,"label",79)(28,"span",102),d(29,"\u5C0F\u8A08"),s(),l(30,"input",108),K("ngModelChange",function(r){E(t);let o=_(2);return Q(o.editingShipmentItem().lineAmount,r)||(o.editingShipmentItem().lineAmount=r),S(r)}),s()(),l(31,"label",79)(32,"span",102),d(33,"\u5099\u8A3B"),s(),l(34,"textarea",109),K("ngModelChange",function(r){E(t);let o=_(2);return Q(o.editingShipmentItem().remark,r)||(o.editingShipmentItem().remark=r),S(r)}),s()()(),l(35,"div",94)(36,"button",110),b("click",function(){E(t);let r=_(2);return S(r.closeShipmentEditModal())}),d(37," \u53D6\u6D88 "),s(),l(38,"button",111),b("click",function(){E(t);let r=_(2);return S(r.saveShipmentEdit())}),d(39),s()()}if(n&2){let t=_(2);m(5),J("ngModel",t.editingShipmentItem().issueDate),m(4),J("ngModel",t.editingShipmentItem().vendorName),m(4),J("ngModel",t.editingShipmentItem().itemName),m(5),J("ngModel",t.editingShipmentItem().qty),m(4),J("ngModel",t.editingShipmentItem().unit),m(4),J("ngModel",t.editingShipmentItem().unitPrice),m(4),J("ngModel",t.editingShipmentItem().lineAmount),m(4),J("ngModel",t.editingShipmentItem().remark),m(4),I("disabled",t.isLoadingShipments()),m(),N(" ",t.isLoadingShipments()?"\u4FDD\u5B58\u4E2D...":"\u4FDD\u5B58"," ")}}function h$(n,e){if(n&1){let t=B();l(0,"div",25)(1,"div",71)(2,"div",72)(3,"h3",73),d(4,"\u7DE8\u8F2F\u9032\u8CA8\u55AE\u9805\u76EE"),s(),l(5,"button",74),b("click",function(){E(t);let r=_();return S(r.closeShipmentEditModal())}),x(6,"ion-icon",75),s()(),l(7,"div",76),M(8,g$,40,10),s()()()}if(n&2){let t=_();m(8),A(t.editingShipmentItem()?8:-1)}}var ts=class ts{constructor(){this.dataService=k(zn);this.apiService=k(we);this.fb=k(qe);this.isModalOpen=D(!1);this.isEditModalOpen=D(!1);this.editingShipmentItem=D(null);this.allVendors=D([]);this.allPOs=D([]);this.editingPO=D(null);this.shipmentItems=D([]);this.isLoadingShipments=D(!1);this.shipmentError=D(null);this.poForm=this.fb.group({id:[""],poNumber:["",U.required],vendorId:["",U.required],date:["",U.required],items:this.fb.array([]),totalAmount:[0]});this.poSearchTerm=D("");this.selectedPOVendor=D("");this.today=new Date;this.firstDayOfMonth=new Date(this.today.getFullYear(),this.today.getMonth(),1);this.poStartDate=D(this.formatDateToISO(this.firstDayOfMonth));this.poEndDate=D(this.formatDateToISO(this.today));this.currentTab=D("api");this.shipmentPage=D(1);this.pageSize=20;this.pagedShipments=$(()=>{let e=this.filteredShipments(),t=(this.shipmentPage()-1)*this.pageSize;return e.slice(t,t+this.pageSize)});this.shipmentTotalPages=$(()=>{let e=this.filteredShipments().length;return Math.max(1,Math.ceil(e/this.pageSize))});this.filteredPOs=$(()=>{let e=this.poSearchTerm().toLowerCase(),t=this.selectedPOVendor(),i=this.poStartDate(),r=this.poEndDate(),o=this.allPOs();return t&&(o=o.filter(a=>a.vendorId===t)),i&&(o=o.filter(a=>a.date>=i)),r&&(o=o.filter(a=>a.date<=r)),e&&(o=o.filter(a=>a.poNumber.toLowerCase().includes(e)||this.getVendorName(a.vendorId).toLowerCase().includes(e))),o});this.filteredShipments=$(()=>{let e=this.poSearchTerm().toLowerCase(),t=this.selectedPOVendor(),i=this.poStartDate(),r=this.poEndDate(),o=this.shipmentItems();return t&&(o=o.filter(a=>a.vendorId.toString()===t)),i&&(o=o.filter(a=>a.issueDate>=i)),r&&(o=o.filter(a=>a.issueDate<=r)),e&&(o=o.filter(a=>(a.documentNo?.toLowerCase().includes(e)??!1)||a.itemName.toLowerCase().includes(e)||a.vendorName.toLowerCase().includes(e))),o});this.shipmentStats=$(()=>{let e=this.filteredShipments(),t=e.reduce((r,o)=>r+Number(o.lineAmount||0),0),i={};return e.forEach(r=>{let o=r.vendorName;i[o]=(i[o]||0)+Number(r.lineAmount||0)}),{totalAmount:t,totalItems:e.length,vendorAmounts:i}});this.pieChartData=$(()=>{let e=this.shipmentStats(),t=Object.keys(e.vendorAmounts).sort(),i=e.totalAmount;return t.map(r=>({name:r,amount:e.vendorAmounts[r],percentage:i>0?e.vendorAmounts[r]/i*100:0}))});this.hoveredVendor=D(null);this.vendorAmountEntries=$(()=>{let e=this.shipmentStats();return Object.entries(e.vendorAmounts).map(([t,i])=>({name:t,amount:i})).sort((t,i)=>i.amount-t.amount)});this.loadData(),this.loadShipments(),this.poItems.valueChanges.subscribe(e=>{let t=e.reduce((i,r)=>i+(r.quantity||0)*(r.unitPrice||0),0);this.poForm.get("totalAmount")?.setValue(t,{emitEvent:!1})})}setShipmentPage(e){e<1||e>this.shipmentTotalPages()||this.shipmentPage.set(e)}setTab(e){this.currentTab.set(e)}loadData(){this.allVendors.set(this.dataService.getVendors()),this.allPOs.set(this.dataService.getPurchaseOrders())}async loadShipments(){this.isLoadingShipments.set(!0),this.shipmentError.set(null);try{let e={limit:1e3,offset:0};this.poStartDate()&&(e.startDate=this.poStartDate()),this.poEndDate()&&(e.endDate=this.poEndDate());let t=await this.apiService.getShipmentItems(e);t.success&&t.data?this.shipmentItems.set(t.data):this.shipmentError.set(t.error||"\u7121\u6CD5\u7372\u53D6\u9032\u8CA8\u55AE\u8CC7\u6599")}catch(e){console.error("Error loading shipments:",e),this.shipmentError.set("\u8F09\u5165\u9032\u8CA8\u55AE\u8CC7\u6599\u5931\u6557\uFF0C\u8ACB\u7A0D\u5F8C\u91CD\u8A66")}finally{this.isLoadingShipments.set(!1)}}async applyShipmentFilter(){await this.loadShipments(),this.shipmentPage.set(1)}resetPOFilters(){this.poSearchTerm.set(""),this.selectedPOVendor.set(""),this.poStartDate.set(""),this.poEndDate.set("")}openModal(e=null){this.editingPO.set(e),this.poForm.reset({totalAmount:0}),this.poItems.clear(),e&&(this.poForm.patchValue(e),e.items.forEach(t=>this.addItem(t.productName,t.quantity,t.unitPrice))),this.isModalOpen.set(!0)}closeModal(){this.isModalOpen.set(!1),this.editingPO.set(null)}openShipmentEditModal(e){this.editingShipmentItem.set(e),this.isEditModalOpen.set(!0)}closeShipmentEditModal(){this.isEditModalOpen.set(!1),this.editingShipmentItem.set(null)}async saveShipmentEdit(){let e=this.editingShipmentItem();if(e)try{this.isLoadingShipments.set(!0);let t=await this.apiService.updateShipmentItem(e.shipment_id,{itemName:e.itemName,qty:e.qty||void 0,unitPrice:e.unitPrice||void 0,unit:e.unit||void 0,remark:e.remark||void 0});if(t.success&&t.data){let i=this.shipmentItems().map(r=>r.shipment_id===e.shipment_id?t.data:r);this.shipmentItems.set(i),this.shipmentPage.set(1),this.closeShipmentEditModal(),alert("\u9032\u8CA8\u55AE\u9805\u76EE\u5DF2\u6210\u529F\u66F4\u65B0")}else throw new Error(t.error||"\u66F4\u65B0\u5931\u6557")}catch(t){console.error("Error saving shipment item:",t),alert("\u4FDD\u5B58\u9032\u8CA8\u55AE\u9805\u76EE\u5931\u6557\uFF1A"+(t instanceof Error?t.message:"\u672A\u77E5\u932F\u8AA4"))}finally{this.isLoadingShipments.set(!1)}}createItem(e="",t=1,i=0){let r=this.fb.group({productName:[e,U.required],quantity:[t,[U.required,U.min(1)]],unitPrice:[i,[U.required,U.min(0)]],total:[t*i]});return r.get("quantity")?.valueChanges.subscribe(()=>this.updateItemTotal(r)),r.get("unitPrice")?.valueChanges.subscribe(()=>this.updateItemTotal(r)),r}updateItemTotal(e){let t=e.get("quantity")?.value||0,i=e.get("unitPrice")?.value||0;e.get("total")?.setValue(t*i,{emitEvent:!1})}addItem(e="",t=1,i=0){this.poItems.push(this.createItem(e,t,i))}removeItem(e){this.poItems.removeAt(e)}handlePOSubmit(){if(this.poForm.invalid)return;let e=this.poForm.getRawValue(),t={poNumber:e.poNumber,vendorId:e.vendorId,date:e.date,items:e.items,totalAmount:e.totalAmount};this.editingPO()?this.dataService.updatePurchaseOrder(G(O({},t),{id:this.editingPO().id})):this.dataService.addPurchaseOrder(t),this.loadData(),this.closeModal()}deletePurchaseOrder(e){confirm("\u78BA\u5B9A\u8981\u522A\u9664\u6B64\u9032\u8CA8\u55AE\u55CE\uFF1F")&&(this.dataService.deletePurchaseOrder(e),this.loadData())}getVendorName(e){let t=e.toString();return this.allVendors().find(i=>i.id===t)?.name||"N/A"}formatCurrency(e){return e==null?"":e.toLocaleString("zh-TW",{style:"currency",currency:"TWD",minimumFractionDigits:0})}formatDate(e){if(!e)return"";if(/^\d{4}-\d{2}-\d{2}$/.test(e))return e;let t=new Date(e);return Number.isNaN(t.getTime())?"":this.formatDateToISO(t)}formatDateToISO(e){let t=e.getFullYear(),i=String(e.getMonth()+1).padStart(2,"0"),r=String(e.getDate()).padStart(2,"0");return`${t}-${i}-${r}`}get poItems(){return this.poForm.get("items")}getPieColor(e,t){let i=["#3B82F6","#EF4444","#10B981","#F59E0B","#8B5CF6","#EC4899","#14B8A6","#F97316","#6366F1","#06B6D4","#84CC16","#D946EF"];return i[e%i.length]}getVendorColor(e){let t=this.pieChartData(),i=t.findIndex(r=>r.name===e);return i<0?"#9CA3AF":this.getPieColor(i,t.length)}getPieSlicePath(e,t){let a=0;for(let F=0;F<e;F++)a+=t[F].percentage*360/100;let u=t[e].percentage*360/100,c=a+u,p=a*Math.PI/180,g=c*Math.PI/180,y=200+120*Math.cos(p),v=200+120*Math.sin(p),C=200+120*Math.cos(g),T=200+120*Math.sin(g),R=u>180?1:0;return`M 200 200 L ${y} ${v} A 120 120 0 ${R} 1 ${C} ${T} Z`}};ts.\u0275fac=function(t){return new(t||ts)},ts.\u0275cmp=re({type:ts,selectors:[["app-purchase-orders"]],decls:39,vars:17,consts:[[1,"space-y-6"],[1,"flex","flex-wrap","items-center","justify-between","gap-4"],[1,"text-3xl","font-bold","text-gray-900"],[1,"bg-white","p-6","rounded-xl","shadow-md"],[1,"space-y-4"],[1,"flex","border-b","border-gray-200","gap-2","mb-4"],["type","button",1,"pb-2","px-4","font-medium","border-b-2","border-transparent","hover:text-indigo-600",3,"click"],[1,"grid","grid-cols-1","md:grid-cols-2","lg:grid-cols-4","gap-4","p-4","bg-gray-50","rounded-lg"],[1,"lg:col-span-4"],["type","text","placeholder","\u641C\u5C0B\u9032\u8CA8\u55AE\u865F\u3001\u54C1\u9805\u6216\u5EE0\u5546...",1,"w-full","border-gray-300","rounded-lg","shadow-sm","focus:ring-indigo-500","focus:border-indigo-500","text-sm","p-2","bg-white",3,"ngModelChange","ngModel"],[1,"flex","items-center","gap-2"],["for","poStartDate",1,"text-sm","font-medium","text-gray-600","shrink-0"],["type","date","id","poStartDate",1,"w-full","border-gray-300","rounded-lg","shadow-sm","focus:ring-indigo-500","focus:border-indigo-500","text-sm","p-2","bg-white",3,"ngModelChange","ngModel"],["for","poEndDate",1,"text-sm","font-medium","text-gray-600","shrink-0"],["type","date","id","poEndDate",1,"w-full","border-gray-300","rounded-lg","shadow-sm","focus:ring-indigo-500","focus:border-indigo-500","text-sm","p-2","bg-white",3,"ngModelChange","ngModel"],[1,"lg:col-span-2"],[1,"w-full","border-gray-300","rounded-lg","shadow-sm","focus:ring-indigo-500","focus:border-indigo-500","text-sm","p-2","bg-white",3,"ngModelChange","ngModel"],["value",""],[3,"value"],[1,"flex","items-center","gap-2","lg:col-span-4","justify-end","gap-2"],["title","\u5957\u7528\u7BE9\u9078",1,"bg-indigo-600","text-white","px-3","py-1","rounded","text-sm","hover:bg-indigo-700","transition-colors","flex","items-center","gap-1",3,"click"],["name","checkmark-outline"],["title","\u91CD\u8A2D\u7BE9\u9078",1,"text-gray-500","hover:text-gray-800","transition-colors","p-2","rounded-full","bg-gray-100","hover:bg-gray-200",3,"click"],["name","refresh-outline",1,"text-xl"],[1,"flex","flex-col","sm:flex-row","justify-between","items-center","gap-3","mt-4"],[1,"fixed","inset-0","bg-black","bg-opacity-50","flex","items-center","justify-center","z-50"],[1,"flex","items-center","justify-center","py-12","text-gray-500"],[1,"bg-red-50","border","border-red-200","rounded-lg","p-4","text-red-700"],[1,"overflow-x-auto"],[1,"w-full","text-sm","text-left","whitespace-nowrap"],[1,"text-xs","text-gray-700","uppercase","bg-gray-100"],[1,"px-4","py-3"],[1,"px-4","py-3","text-right"],[1,"border-b","hover:bg-gray-50","cursor-pointer"],["name","refresh-outline",1,"text-3xl","animate-spin","mr-2"],["name","alert-circle-outline",1,"text-xl"],[1,"border-b","hover:bg-gray-50","cursor-pointer",3,"click"],[1,"px-4","py-2"],[1,"px-4","py-2","font-medium"],[1,"px-4","py-2","text-right"],[1,"px-4","py-2","text-right","font-semibold"],[1,"px-4","py-2","text-gray-600","text-xs"],["colspan","8",1,"text-center","py-8","text-gray-500"],[1,"text-center","py-8","text-gray-500"],[1,"grid","grid-cols-2","gap-4","mb-4"],[1,"bg-blue-50","p-3","rounded-lg"],[1,"text-xs","text-blue-600","font-medium"],[1,"text-xl","font-bold","text-blue-900"],[1,"bg-purple-50","p-3","rounded-lg"],[1,"text-xs","text-purple-600","font-medium"],[1,"text-xl","font-bold","text-purple-900"],[1,"bg-gray-50","p-4","rounded-lg"],[1,"text-xs","text-gray-600","font-medium","mb-4"],[1,"grid","grid-cols-1","lg:grid-cols-3","gap-4","items-center"],[1,"flex","items-center","justify-center","lg:col-span-2"],["viewBox","0 0 400 400",1,"w-64","h-64"],[1,"lg:col-span-1"],[1,"text-sm","text-gray-500"],[1,"mt-4","grid","grid-cols-2","md:grid-cols-3","gap-2","text-xs"],[3,"mouseenter","mouseleave"],["stroke-width","2",1,"cursor-pointer","transition-opacity"],[1,"bg-white","border","border-gray-200","rounded-lg","p-3","shadow-sm"],[1,"text-sm","font-medium","text-gray-900"],[1,"text-lg","font-bold","text-blue-600"],[1,"text-sm","text-gray-600"],[1,"w-3","h-3","rounded-full"],[1,"truncate"],[1,"font-medium"],[1,"text-gray-600"],["class","flex flex-col sm:flex-row justify-between items-center gap-3 mt-4",4,"ngIf"],[1,"px-2","py-1","rounded","border","text-sm",3,"click","disabled"],[1,"bg-white","rounded-xl","shadow-2xl","w-full","max-w-2xl","max-h-[90vh]","flex","flex-col"],[1,"flex","justify-between","items-center","p-4","border-b"],[1,"text-lg","font-semibold"],[1,"text-gray-400","hover:text-gray-600",3,"click"],["name","close-outline",1,"text-2xl"],[1,"p-6","overflow-y-auto"],[1,"space-y-4",3,"ngSubmit","formGroup"],[1,"grid","grid-cols-1","md:grid-cols-2","gap-4"],[1,"block"],[1,"text-gray-700"],["formControlName","poNumber",1,"mt-1","block","w-full","rounded-md","border-gray-300","shadow-sm","bg-gray-50","p-2"],["type","date","formControlName","date",1,"mt-1","block","w-full","rounded-md","border-gray-300","shadow-sm","bg-gray-50","p-2"],["formControlName","vendorId",1,"mt-1","block","w-full","rounded-md","border-gray-300","shadow-sm","bg-gray-50","p-2"],["value","","disabled",""],[1,"font-semibold","pt-4","border-t"],[1,"grid","grid-cols-12","gap-2","px-2","pb-1","text-xs","font-medium","text-gray-500"],[1,"col-span-5"],[1,"col-span-2","text-right"],[1,"col-span-1"],["formArrayName","items",1,"space-y-2"],[1,"grid","grid-cols-12","gap-2","items-center","p-2","rounded-md","bg-gray-50",3,"formGroupName"],["type","button",1,"text-indigo-600","text-sm",3,"click"],[1,"text-right","font-bold","text-lg"],[1,"flex","justify-end","gap-4","pt-4","border-t","mt-4"],["type","button",1,"px-4","py-2","border","rounded-md",3,"click"],["type","submit",1,"px-4","py-2","bg-indigo-600","text-white","rounded-md"],["formControlName","productName","placeholder","\u54C1\u9805\u540D\u7A31",1,"col-span-5","p-1","border","border-gray-300","bg-white","rounded-md","shadow-sm"],["type","number","formControlName","quantity","placeholder","\u6578\u91CF",1,"col-span-2","p-1","border","border-gray-300","bg-white","rounded-md","shadow-sm","text-right"],["type","number","formControlName","unitPrice","placeholder","\u55AE\u50F9",1,"col-span-2","p-1","border","border-gray-300","bg-white","rounded-md","shadow-sm","text-right"],["type","button",1,"col-span-1","text-red-500",3,"click"],["name","remove-circle-outline"],[1,"text-gray-700","text-sm"],["type","date","disabled","",1,"mt-1","block","w-full","border","border-gray-300","rounded-md","shadow-sm","bg-gray-100","p-2","cursor-not-allowed","text-gray-600",3,"ngModelChange","ngModel"],["type","text","disabled","",1,"mt-1","block","w-full","border","border-gray-300","rounded-md","shadow-sm","bg-gray-100","p-2","cursor-not-allowed","text-gray-600",3,"ngModelChange","ngModel"],["type","text",1,"mt-1","block","w-full","border","border-gray-300","rounded-md","shadow-sm","bg-white","p-2",3,"ngModelChange","ngModel"],[1,"grid","grid-cols-1","md:grid-cols-3","gap-4"],["type","number",1,"mt-1","block","w-full","border","border-gray-300","rounded-md","shadow-sm","bg-white","p-2","text-right",3,"ngModelChange","ngModel"],["type","number","disabled","",1,"mt-1","block","w-full","border","border-gray-300","rounded-md","shadow-sm","bg-gray-100","p-2","text-right","cursor-not-allowed","text-gray-600",3,"ngModelChange","ngModel"],["rows","3",1,"mt-1","block","w-full","border","border-gray-300","rounded-md","shadow-sm","bg-white","p-2",3,"ngModelChange","ngModel"],["type","button",1,"px-4","py-2","border","border-gray-300","rounded-md","hover:bg-gray-50",3,"click"],["type","button",1,"px-4","py-2","bg-indigo-600","text-white","rounded-md","hover:bg-indigo-700","disabled:opacity-50","disabled:cursor-not-allowed",3,"click","disabled"]],template:function(t,i){t&1&&(l(0,"div",0)(1,"div",1)(2,"h1",2),d(3,"\u9032\u8CA8\u55AE\u7BA1\u7406"),s()(),l(4,"div",3)(5,"div",4)(6,"div",5)(7,"button",6),b("click",function(){return i.setTab("api")}),d(8," \u9032\u8CA8\u55AE\u8CC7\u6599 "),s(),l(9,"button",6),b("click",function(){return i.setTab("analysis")}),d(10," \u9032\u8CA8\u5206\u6790 "),s()(),l(11,"div",7)(12,"div",8)(13,"input",9),b("ngModelChange",function(o){return i.poSearchTerm.set(o)}),s()(),l(14,"div",10)(15,"label",11),d(16,"\u5F9E:"),s(),l(17,"input",12),b("ngModelChange",function(o){return i.poStartDate.set(o)}),s()(),l(18,"div",10)(19,"label",13),d(20,"\u81F3:"),s(),l(21,"input",14),b("ngModelChange",function(o){return i.poEndDate.set(o)}),s()(),l(22,"div",15)(23,"select",16),b("ngModelChange",function(o){return i.selectedPOVendor.set(o)}),l(24,"option",17),d(25,"\u6240\u6709\u5EE0\u5546"),s(),V(26,$U,2,2,"option",18,_S),s()(),l(28,"div",19)(29,"button",20),b("click",function(){return i.applyShipmentFilter()}),x(30,"ion-icon",21),d(31," \u5957\u7528 "),s(),l(32,"button",22),b("click",function(){return i.resetPOFilters()}),x(33,"ion-icon",23),s()()(),M(34,ZU,27,3,"div",4),M(35,u$,3,1,"div",4),M(36,c$,1,1,"div",24),s()()(),M(37,f$,50,3,"div",25),M(38,h$,9,1,"div",25)),t&2&&(m(7),j("border-indigo-600",i.currentTab()==="api")("text-indigo-600",i.currentTab()==="api"),m(2),j("border-indigo-600",i.currentTab()==="analysis")("text-indigo-600",i.currentTab()==="analysis"),m(4),I("ngModel",i.poSearchTerm()),m(4),I("ngModel",i.poStartDate()),m(4),I("ngModel",i.poEndDate()),m(2),I("ngModel",i.selectedPOVendor()),m(3),L(i.allVendors()),m(8),A(i.currentTab()==="api"?34:-1),m(),A(i.currentTab()==="analysis"?35:-1),m(),A(i.currentTab()==="api"?36:-1),m(),A(i.isModalOpen()?37:-1),m(),A(i.isEditModalOpen()?38:-1))},dependencies:[se,Ji,Be,Ve,He,Ge,be,Bt,Oe,fe,ke,Le,Ue,qn,Wn,De,Ie,dl],encapsulation:2,changeDetection:0});var bp=ts;var y$=()=>[1,2,3,4,5,6,7,8,9,10,11,12],CS=(n,e)=>e.employee_id,vS=(n,e)=>e.gl_account_id,_$=(n,e)=>e.record_id,v$=(n,e)=>e.payable_id;function C$(n,e){if(n&1&&(l(0,"option",16),d(1),s()),n&2){let t=e.$implicit;I("value",t),m(),N("",t,"\u6708")}}function x$(n,e){if(n&1){let t=B();l(0,"div",3)(1,"div",10)(2,"label",11),d(3,"\u6642\u9593:"),s(),l(4,"select",12),K("ngModelChange",function(r){E(t);let o=_();return Q(o.selectedYear,r)||(o.selectedYear=r),S(r)}),b("change",function(){E(t);let r=_();return S(r.onMonthChange())}),l(5,"option",13),d(6,"2024\u5E74"),s(),l(7,"option",14),d(8,"2025\u5E74"),s(),l(9,"option",15),d(10,"2026\u5E74"),s()(),l(11,"select",12),K("ngModelChange",function(r){E(t);let o=_();return Q(o.selectedMonth,r)||(o.selectedMonth=r),S(r)}),b("change",function(){E(t);let r=_();return S(r.onMonthChange())}),V(12,C$,2,2,"option",16,Y),s()(),l(14,"div",17)(15,"button",18),b("click",function(){E(t);let r=_();return S(r.resetFilter())}),x(16,"ion-icon",19),s()()()}if(n&2){let t=_();m(4),J("ngModel",t.selectedYear),m(7),J("ngModel",t.selectedMonth),m(),L(Ke(2,y$))}}function b$(n,e){n&1&&(l(0,"div",31)(1,"p",35),d(2,"\u8F09\u5165\u4E2D..."),s()())}function E$(n,e){if(n&1&&(l(0,"div",32)(1,"p",36),d(2),s()()),n&2){let t=_(2);m(2),w(t.monthlyError())}}function S$(n,e){n&1&&(l(0,"span",50),x(1,"ion-icon",59),d(2," \u5DF2\u6838\u5C0D "),s())}function D$(n,e){n&1&&(l(0,"span",50),x(1,"ion-icon",59),d(2," \u5DF2\u6838\u5C0D "),s())}function w$(n,e){if(n&1){let t=B();l(0,"button",60),b("click",function(r){E(t);let o=_().$implicit;return _(3).verifyMonthlyShareholder(o),S(r.stopPropagation())}),d(1," \u6838\u5C0D "),s()}}function T$(n,e){if(n&1&&(l(0,"span",52),x(1,"ion-icon",61),d(2),s()),n&2){let t=_().$implicit,i=_(3);m(2),N(" ",i.getMonthlyReleaseStatusLabel(t)," ")}}function I$(n,e){if(n&1&&(l(0,"span",53),x(1,"ion-icon",62),d(2),s()),n&2){let t=_().$implicit,i=_(3);m(2),N(" ",i.getMonthlyReleaseStatusLabel(t)," ")}}function M$(n,e){if(n&1&&(l(0,"span",54),x(1,"ion-icon",63),d(2),s()),n&2){let t=_().$implicit,i=_(3);m(2),N(" ",i.getMonthlyReleaseStatusLabel(t)," ")}}function A$(n,e){if(n&1){let t=B();l(0,"button",64),b("click",function(r){E(t);let o=_().$implicit,a=_(3);return r.stopPropagation(),S(a.openLedgerEditModal(o.entry_id))}),x(1,"ion-icon",65),d(2),s()}if(n&2){let t=_().$implicit;m(2),N(" #",t.entry_id," ")}}function R$(n,e){n&1&&(l(0,"span",56),d(1,"-"),s())}function N$(n,e){n&1&&(l(0,"span",58),x(1,"ion-icon",66),d(2," \u4E0B\u8F09\u4E2D "),s())}function F$(n,e){n&1&&(l(0,"span",58),x(1,"ion-icon",67),d(2," \u52DE\u5831\u55AE "),s())}function P$(n,e){if(n&1){let t=B();l(0,"tr",44),b("click",function(){let r=E(t).$implicit,o=_(3);return S(o.openMonthlyDetail(r))}),l(1,"td",45),d(2),s(),l(3,"td",46),d(4),s(),l(5,"td",47),d(6),s(),l(7,"td",48),d(8),s(),l(9,"td",49),M(10,S$,3,0,"span",50)(11,D$,3,0,"span",50)(12,w$,2,0,"button",51),s(),l(13,"td",49),M(14,T$,3,1,"span",52)(15,I$,3,1,"span",53)(16,M$,3,1,"span",54),s(),l(17,"td",49),M(18,A$,3,1,"button",55)(19,R$,2,0,"span",56),s(),l(20,"td",49)(21,"button",57),b("click",function(r){let o=E(t).$implicit,a=_(3);return S(a.downloadLaborReport(o,r))}),M(22,N$,3,0,"span",58)(23,F$,3,0,"span",58),s()()()}if(n&2){let t=e.$implicit,i=_(3);m(2),w(i.formatYearMonth(t.due_month)),m(2),w(t.employee_name),m(2),w(t.phone),m(2),w(i.formatCurrency(t.total_rebate)),m(2),A(i.isMonthlyReleased(t)?10:i.isMonthlyVerified(t)?11:12),m(4),A(i.getMonthlyReleaseStatus(t)==="released"?14:i.getMonthlyReleaseStatus(t)==="partial"?15:16),m(4),A(t.entry_id?18:19),m(3),j("bg-green-600",!i.isDownloadingReport(t))("text-white",!i.isDownloadingReport(t))("hover:bg-green-700",!i.isDownloadingReport(t))("bg-gray-300",i.isDownloadingReport(t))("text-gray-600",i.isDownloadingReport(t))("cursor-not-allowed",i.isDownloadingReport(t)),I("disabled",i.isDownloadingReport(t)),m(),A(i.isDownloadingReport(t)?22:23)}}function k$(n,e){if(n&1&&(l(0,"div",33)(1,"div",37)(2,"table",38)(3,"thead",39)(4,"tr")(5,"th",40),d(6,"\u6708\u4EFD"),s(),l(7,"th",40),d(8,"\u80A1\u6771\u540D\u7A31"),s(),l(9,"th",41),d(10,"\u96FB\u8A71"),s(),l(11,"th",42),d(12,"\u7E3D\u56DE\u994B\u91D1"),s(),l(13,"th",41),d(14,"\u6838\u5C0D"),s(),l(15,"th",41),d(16,"\u767C\u653E"),s(),l(17,"th",41),d(18,"\u6D41\u6C34\u5E33"),s(),l(19,"th",41),d(20,"\u52DE\u5831\u55AE"),s()()(),l(21,"tbody"),V(22,P$,24,21,"tr",43,CS),s()()()()),n&2){let t=_(2);m(22),L(t.monthlySummaries())}}function V$(n,e){n&1&&(l(0,"div",34)(1,"p",35),d(2,"\u6B64\u6708\u4EFD\u7121\u80A1\u6771\u56DE\u994B\u91D1\u8CC7\u6599"),s()())}function L$(n,e){if(n&1&&(l(0,"div",0)(1,"div",20)(2,"div",21)(3,"div",22),x(4,"ion-icon",23),s(),l(5,"div")(6,"p",24),d(7,"\u4EBA\u6578"),s(),l(8,"p",25),d(9),s()()(),l(10,"div",21)(11,"div",22),x(12,"ion-icon",26),s(),l(13,"div")(14,"p",24),d(15,"\u7E3D\u56DE\u994B\u91D1"),s(),l(16,"p",25),d(17),s()()(),l(18,"div",21)(19,"div",27),x(20,"ion-icon",28),s(),l(21,"div")(22,"p",24),d(23,"\u5DF2\u6838\u5C0D"),s(),l(24,"p",25),d(25),s()()(),l(26,"div",21)(27,"div",29),x(28,"ion-icon",30),s(),l(29,"div")(30,"p",24),d(31,"\u5DF2\u767C\u653E"),s(),l(32,"p",25),d(33),s()()()(),M(34,b$,3,0,"div",31),M(35,E$,3,1,"div",32),M(36,k$,24,0,"div",33),M(37,V$,3,0,"div",34),s()),n&2){let t=_();m(9),w(t.monthlyStats().transaction_count),m(8),w(t.formatCurrency(t.monthlyStats().total_rebate)),m(8),w(t.monthlyStats().verified_count),m(8),w(t.monthlyStats().released_count),m(),A(t.monthlyLoading()?34:-1),m(),A(t.monthlyError()?35:-1),m(),A(!t.monthlyLoading()&&t.monthlySummaries().length>0?36:-1),m(),A(!t.monthlyLoading()&&t.monthlySummaries().length===0?37:-1)}}function O$(n,e){n&1&&(l(0,"div",31)(1,"p",35),d(2,"\u8F09\u5165\u4E2D..."),s()())}function B$(n,e){if(n&1&&(l(0,"div",32)(1,"p",36),d(2),s()()),n&2){let t=_(2);m(2),w(t.payablesError())}}function U$(n,e){if(n&1){let t=B();l(0,"tr",73)(1,"td",46),d(2),s(),l(3,"td",47),d(4),s(),l(5,"td",48),d(6),s(),l(7,"td",74),d(8),s(),l(9,"td",75),d(10),s(),l(11,"td",49)(12,"div",76)(13,"button",77),b("click",function(){let r=E(t).$implicit,o=_(3);return S(o.openPayablesPayModal(r))}),d(14," \u652F\u4ED8\u56DE\u994B\u91D1 "),s(),l(15,"button",78),b("click",function(){let r=E(t).$implicit,o=_(3);return S(o.openPayablesDetail(r))}),d(16," \u6708\u5EA6\u660E\u7D30 "),s()()()()}if(n&2){let t=e.$implicit,i=_(3);m(2),w(t.employee_name),m(2),w(t.phone),m(2),w(i.formatCurrency(t.total_payable)),m(2),w(i.formatCurrency(t.pending_amount)),m(2),w(i.formatCurrency(t.paid_amount)),m(3),I("disabled",t.pending_amount<=0)}}function $$(n,e){if(n&1&&(l(0,"div",33)(1,"div",37)(2,"table",38)(3,"thead",39)(4,"tr")(5,"th",40),d(6,"\u80A1\u6771\u540D\u7A31"),s(),l(7,"th",41),d(8,"\u96FB\u8A71"),s(),l(9,"th",42),d(10,"\u7D2F\u7A4D\u61C9\u4ED8\u56DE\u994B\u91D1"),s(),l(11,"th",42),d(12,"\u5F85\u767C\u653E"),s(),l(13,"th",42),d(14,"\u5DF2\u767C\u653E"),s(),l(15,"th",41),d(16,"\u64CD\u4F5C"),s()()(),l(17,"tbody"),V(18,U$,17,6,"tr",73,CS),s()()()()),n&2){let t=_(2);m(18),L(t.payablesSummary().employees)}}function H$(n,e){n&1&&(l(0,"div",34)(1,"p",35),d(2,"\u76EE\u524D\u7121\u61C9\u4ED8\u56DE\u994B\u91D1"),s()())}function G$(n,e){if(n&1&&(l(0,"div",0)(1,"div",68)(2,"div",69)(3,"div")(4,"p",70),d(5,"\u61C9\u4ED8\u56DE\u994B\u91D1\u7E3D\u984D"),s(),l(6,"p",2),d(7),s()(),l(8,"div",71),x(9,"ion-icon",72),s()()(),M(10,O$,3,0,"div",31),M(11,B$,3,1,"div",32),M(12,$$,20,0,"div",33),M(13,H$,3,0,"div",34),s()),n&2){let t=_();m(7),w(t.formatCurrency(t.pendingPayablesTotal())),m(3),A(t.payablesLoading()?10:-1),m(),A(t.payablesError()?11:-1),m(),A(!t.payablesLoading()&&t.payablesSummary().employees.length>0?12:-1),m(),A(!t.payablesLoading()&&t.payablesSummary().employees.length===0?13:-1)}}function q$(n,e){n&1&&(l(0,"div",85),d(1,"\u8F09\u5165\u4E2D..."),s())}function W$(n,e){if(n&1&&(l(0,"option",16),d(1),s()),n&2){let t=e.$implicit;I("value",t.account_name),m(),w(t.account_name)}}function j$(n,e){if(n&1&&(l(0,"option",16),d(1),s()),n&2){let t=e.$implicit;I("value",t.account_name),m(),w(t.account_name)}}function z$(n,e){if(n&1&&(l(0,"div",98)(1,"p",36),d(2),s()()),n&2){let t=_(3);m(2),w(t.ledgerEditError())}}function Y$(n,e){n&1&&d(0," \u5132\u5B58\u4E2D... ")}function J$(n,e){n&1&&d(0," \u4FEE\u6539 ")}function K$(n,e){if(n&1){let t=B();l(0,"form",87),b("ngSubmit",function(){E(t);let r=_(2);return S(r.submitLedgerEdit())}),l(1,"div",88)(2,"div")(3,"label",89),d(4,"\u65E5\u671F*"),s(),x(5,"input",90),s(),l(6,"div")(7,"label",89),d(8,"\u9805\u76EE*"),s(),l(9,"select",91)(10,"option",92),d(11,"\u8ACB\u9078\u64C7\u9805\u76EE"),s(),V(12,W$,2,2,"option",16,vS),s()(),l(14,"div")(15,"label",89),d(16,"\u79D1\u76EE*"),s(),l(17,"select",93)(18,"option",92),d(19,"\u8ACB\u9078\u64C7\u79D1\u76EE"),s(),V(20,j$,2,2,"option",16,vS),s()(),l(22,"div")(23,"label",89),d(24,"\u91D1\u984D*"),s(),x(25,"input",94),s(),l(26,"div")(27,"label",89),d(28,"\u767C\u7968\u865F\u78BC"),s(),x(29,"input",95),s(),l(30,"div",96)(31,"label",89),d(32,"\u5099\u8A3B"),s(),x(33,"textarea",97),s()(),M(34,z$,3,1,"div",98),l(35,"div",99)(36,"button",100),b("click",function(){E(t);let r=_(2);return S(r.closeLedgerEditModal())}),d(37,"\u53D6\u6D88"),s(),l(38,"button",101),M(39,Y$,1,0)(40,J$,1,0),s()()()}if(n&2){let t=_(2);I("formGroup",t.ledgerEditForm),m(5),j("border-red-500",t.isLedgerEditInvalid("entry_date")),m(4),j("border-red-500",t.isLedgerEditInvalid("item_group")),m(3),L(t.ledgerTopLevelAccounts()),m(5),j("border-red-500",t.isLedgerEditInvalid("subject_name")),m(3),L(t.ledgerSubAccounts()),m(5),j("border-red-500",t.isLedgerEditInvalid("amount")),m(9),A(t.ledgerEditError()?34:-1),m(2),I("disabled",t.ledgerEditSaving()),m(2),I("disabled",t.ledgerEditSaving()),m(),A(t.ledgerEditSaving()?39:40)}}function Q$(n,e){if(n&1){let t=B();l(0,"div",8)(1,"div",79)(2,"div",80)(3,"h3",81),d(4),s(),l(5,"button",82),b("click",function(){E(t);let r=_();return S(r.closeLedgerEditModal())}),x(6,"ion-icon",83),s()(),l(7,"div",84),M(8,q$,2,0,"div",85)(9,K$,41,13,"form",86),s()()()}if(n&2){let t=_();m(4),N("\u4FEE\u6539\u6D41\u6C34\u5E33 ID\uFF1A",t.editingLedgerEntryId()),m(4),A(t.ledgerEditLoading()?8:9)}}function Z$(n,e){if(n&1&&(l(0,"div",118)(1,"div",124),x(2,"ion-icon",125),l(3,"p",126),d(4),s()()()),n&2){let t=_(),i=_();m(4),Qe(" \u672C\u6B21\u652F\u4ED8 ",i.formatCurrency(i.toNumber(i.payablesPayAmount)),"\uFF0C\u5269\u9918 ",i.formatCurrency(t.pending_amount-i.toNumber(i.payablesPayAmount))," \u5C07\u7DAD\u6301\u5F85\u652F\u4ED8\u3002 ")}}function X$(n,e){if(n&1&&(l(0,"div",119)(1,"div",124),x(2,"ion-icon",127),l(3,"p",128),d(4),s()()()),n&2){let t=_(2);m(4),w(t.payablesPayError())}}function eH(n,e){n&1&&(l(0,"span",123),d(1,"\u23F3"),s())}function tH(n,e){if(n&1){let t=B();l(0,"div",8)(1,"div",102)(2,"div",103)(3,"h3",104),x(4,"ion-icon",105),d(5," \u652F\u4ED8\u80A1\u6771\u56DE\u994B\u91D1 "),s()(),l(6,"div",106)(7,"div",107)(8,"div",108)(9,"div")(10,"span",109),d(11,"\u80A1\u6771\uFF1A"),s(),l(12,"span",110),d(13),s()(),l(14,"div")(15,"span",109),d(16,"\u96FB\u8A71\uFF1A"),s(),l(17,"span",110),d(18),s()(),l(19,"div",111)(20,"span",109),d(21,"\u5F85\u652F\u4ED8\u56DE\u994B\u91D1\u7E3D\u984D\uFF1A"),s(),l(22,"span",112),d(23),s()()()(),l(24,"div")(25,"label",113),d(26," \u652F\u4ED8\u91D1\u984D "),l(27,"span",114),d(28,"*"),s()(),l(29,"input",115),K("ngModelChange",function(r){E(t);let o=_();return Q(o.payablesPayAmount,r)||(o.payablesPayAmount=r),S(r)}),s(),l(30,"p",116),d(31),s()(),l(32,"div")(33,"label",113),d(34,"\u5099\u8A3B"),s(),l(35,"textarea",117),K("ngModelChange",function(r){E(t);let o=_();return Q(o.payablesPayRemark,r)||(o.payablesPayRemark=r),S(r)}),s()(),M(36,Z$,5,2,"div",118),M(37,X$,5,1,"div",119),s(),l(38,"div",120)(39,"button",121),b("click",function(){E(t);let r=_();return S(r.closePayablesPayModal())}),d(40," \u53D6\u6D88 "),s(),l(41,"button",122),b("click",function(){E(t);let r=_();return S(r.submitPayablesPayment())}),M(42,eH,2,0,"span",123),d(43," \u78BA\u8A8D\u652F\u4ED8 "),s()()()()}if(n&2){let t=e,i=_();m(13),w(t.employee_name),m(5),w(t.phone),m(5),w(i.formatCurrency(t.pending_amount)),m(6),J("ngModel",i.payablesPayAmount),I("max",t.pending_amount),m(2),N(" \u53EF\u8F38\u5165\u7BC4\u570D\uFF1A0 ~ ",i.formatCurrency(t.pending_amount)," "),m(4),J("ngModel",i.payablesPayRemark),m(),A(i.toNumber(i.payablesPayAmount)>0&&i.toNumber(i.payablesPayAmount)<t.pending_amount?36:-1),m(),A(i.payablesPayError()?37:-1),m(2),I("disabled",i.payingPayables()),m(2),I("disabled",i.payingPayables()||t.pending_amount<=0||i.toNumber(i.payablesPayAmount)<=0),m(),A(i.payingPayables()?42:-1)}}function nH(n,e){n&1&&(l(0,"div",31)(1,"p",35),d(2,"\u8F09\u5165\u4E2D..."),s()())}function iH(n,e){n&1&&d(0," \u65B0\u589E\u4E2D ")}function rH(n,e){n&1&&d(0," \u78BA\u5B9A ")}function oH(n,e){if(n&1){let t=B();l(0,"div",135)(1,"div",139)(2,"div")(3,"label",140),d(4,"\u7D50\u5E33\u6642\u9593"),s(),l(5,"input",141),K("ngModelChange",function(r){E(t);let o=_(2);return Q(o.newDetailCheckoutAt,r)||(o.newDetailCheckoutAt=r),S(r)}),s()(),l(6,"div")(7,"label",140),d(8,"\u767C\u7968\u865F\u78BC (\u9078\u586B)"),s(),l(9,"input",142),K("ngModelChange",function(r){E(t);let o=_(2);return Q(o.newDetailInvoiceNo,r)||(o.newDetailInvoiceNo=r),S(r)}),s()(),l(10,"div")(11,"label",140),d(12,"\u6298\u6263\u91D1\u984D"),s(),l(13,"input",143),K("ngModelChange",function(r){E(t);let o=_(2);return Q(o.newDetailDiscountAmount,r)||(o.newDetailDiscountAmount=r),S(r)}),s()(),l(14,"div")(15,"label",140),d(16,"\u767C\u7968\u91D1\u984D"),s(),l(17,"input",144),K("ngModelChange",function(r){E(t);let o=_(2);return Q(o.newDetailInvoiceAmount,r)||(o.newDetailInvoiceAmount=r),S(r)}),s()(),l(18,"div")(19,"label",140),d(20,"\u56DE\u994B%"),s(),l(21,"input",145),K("ngModelChange",function(r){E(t);let o=_(2);return Q(o.newDetailRebateRate,r)||(o.newDetailRebateRate=r),S(r)}),s()(),l(22,"div")(23,"label",140),d(24,"\u4F7F\u7528\u6298\u6263"),s(),l(25,"input",146),K("ngModelChange",function(r){E(t);let o=_(2);return Q(o.newDetailDiscountNote,r)||(o.newDetailDiscountNote=r),S(r)}),s()(),l(26,"div",147)(27,"button",148),b("click",function(){E(t);let r=_(2);return S(r.submitAddDetail())}),M(28,iH,1,0)(29,rH,1,0),s(),l(30,"button",149),b("click",function(){E(t);let r=_(2);return S(r.closeAddDetail())}),d(31," \u53D6\u6D88 "),s()()()()}if(n&2){let t=_(2);m(5),J("ngModel",t.newDetailCheckoutAt),m(4),J("ngModel",t.newDetailInvoiceNo),m(4),J("ngModel",t.newDetailDiscountAmount),m(4),J("ngModel",t.newDetailInvoiceAmount),m(4),J("ngModel",t.newDetailRebateRate),m(4),J("ngModel",t.newDetailDiscountNote),m(2),I("disabled",t.addDetailSaving()),m(),A(t.addDetailSaving()?28:29)}}function aH(n,e){if(n&1&&(l(0,"div",136)(1,"p",36),d(2),s()()),n&2){let t=_(2);m(2),w(t.addDetailError())}}function sH(n,e){if(n&1&&(l(0,"div",136)(1,"p",36),d(2),s()()),n&2){let t=_(2);m(2),w(t.detailSaveError())}}function lH(n,e){n&1&&d(0," \u5132\u5B58\u4E2D ")}function uH(n,e){n&1&&d(0," \u5132\u5B58 ")}function dH(n,e){n&1&&d(0," \u522A\u9664\u4E2D ")}function cH(n,e){n&1&&d(0," \u522A\u9664 ")}function mH(n,e){if(n&1){let t=B();l(0,"tr",154)(1,"td",158),d(2),s(),l(3,"td",159),d(4),s(),l(5,"td",160),d(6),s(),l(7,"td",161)(8,"input",162),b("ngModelChange",function(r){let o=E(t).$implicit,a=_(3);return S(a.updateDetailInvoiceAmount(o,r))}),s()(),l(9,"td",163)(10,"div",164)(11,"input",165),b("ngModelChange",function(r){let o=E(t).$implicit,a=_(3);return S(a.updateDetailRebateRate(o,r))}),s(),l(12,"span",109),d(13,"%"),s()()(),l(14,"td",166),d(15),s(),l(16,"td",167),d(17),s(),l(18,"td",168)(19,"input",169),b("ngModelChange",function(r){let o=E(t).$implicit,a=_(3);return S(a.updateDetailRemark(o,r))}),s()(),l(20,"td",163)(21,"div",76)(22,"button",170),b("click",function(){let r=E(t).$implicit,o=_(3);return S(o.saveDetailRebate(r))}),M(23,lH,1,0)(24,uH,1,0),s(),l(25,"button",171),b("click",function(){let r=E(t).$implicit,o=_(3);return S(o.deleteDetail(r))}),M(26,dH,1,0)(27,cH,1,0),s()()()()}if(n&2){let t=e.$implicit,i=_(3);m(2),w(i.formatDate(t.checkout_at)),m(2),w(t.invoice_no),m(2),w(i.formatCurrency(t.discount_amount)),m(2),I("ngModel",t.invoice_amount),m(3),I("ngModel",t.rebate_rate),m(4),w(i.formatCurrency(t.rebate_amount)),m(2),w(t.discount_note),m(2),I("ngModel",t.remark||""),m(3),I("disabled",t.record_id<0||i.isDetailSaving(t.record_id)),m(),A(i.isDetailSaving(t.record_id)?23:24),m(2),I("disabled",i.isDetailDeleting(t.record_id)),m(),A(i.isDetailDeleting(t.record_id)?26:27)}}function pH(n,e){if(n&1&&(l(0,"div",37)(1,"table",38)(2,"thead",150)(3,"tr")(4,"th",151),d(5,"\u7D50\u5E33\u6642\u9593"),s(),l(6,"th",151),d(7,"\u767C\u7968\u865F\u78BC"),s(),l(8,"th",152),d(9,"\u6298\u6263\u91D1\u984D"),s(),l(10,"th",152),d(11,"\u767C\u7968\u91D1\u984D"),s(),l(12,"th",153),d(13,"\u56DE\u994B%"),s(),l(14,"th",152),d(15,"\u56DE\u994B\u91D1"),s(),l(16,"th",151),d(17,"\u4F7F\u7528\u6298\u6263"),s(),l(18,"th",151),d(19,"\u5099\u8A3B"),s(),l(20,"th",153),d(21,"\u64CD\u4F5C"),s()()(),l(22,"tbody"),V(23,mH,28,12,"tr",154,_$),s(),l(25,"tfoot",155)(26,"tr")(27,"td",156),d(28,"\u5C0F\u8A08:"),s(),l(29,"td",157),d(30),s(),x(31,"td")(32,"td")(33,"td"),s()()()()),n&2){let t=_(2);m(23),L(t.monthlyDetails()),m(7),N(" ",t.formatCurrency(t.monthlyDetailsTotal())," ")}}function fH(n,e){n&1&&(l(0,"div",31)(1,"p",35),d(2,"\u6B64\u6708\u4EFD\u7121\u56DE\u994B\u91D1\u660E\u7D30"),s()())}function gH(n,e){if(n&1){let t=B();l(0,"div",9)(1,"div",129)(2,"div",130)(3,"h2",131),d(4),s(),l(5,"div",10)(6,"button",132),b("click",function(){E(t);let r=_();return S(r.openAddDetail())}),d(7," \u65B0\u589E\u7D30\u9805 "),s(),l(8,"button",133),b("click",function(){E(t);let r=_();return S(r.closeMonthlyDetail())}),x(9,"ion-icon",83),s()()(),l(10,"div",134),M(11,nH,3,0,"div",31),M(12,oH,32,8,"div",135),M(13,aH,3,1,"div",136),M(14,sH,3,1,"div",136),M(15,pH,34,1,"div",37),M(16,fH,3,0,"div",31),s(),l(17,"div",137)(18,"button",138),b("click",function(){E(t);let r=_();return S(r.closeMonthlyDetail())}),d(19," \u95DC\u9589 "),s()()()()}if(n&2){let t=e,i=_();m(4),Qe("\u56DE\u994B\u91D1\u7D30\u9805 - ",t.employee_name," (",i.formatYearMonth(t.due_month),")"),m(7),A(i.monthlyDetailLoading()?11:-1),m(),A(i.addDetailVisible()?12:-1),m(),A(i.addDetailError()?13:-1),m(),A(i.detailSaveError()?14:-1),m(),A(!i.monthlyDetailLoading()&&i.monthlyDetails().length>0?15:-1),m(),A(!i.monthlyDetailLoading()&&i.monthlyDetails().length===0?16:-1)}}function hH(n,e){n&1&&(l(0,"div",31)(1,"p",35),d(2,"\u8F09\u5165\u4E2D..."),s()())}function yH(n,e){n&1&&(l(0,"span",176),d(1,"\u5DF2\u767C\u653E"),s())}function _H(n,e){n&1&&(l(0,"span",177),d(1,"\u5F85\u767C\u653E"),s())}function vH(n,e){if(n&1&&(l(0,"span",178),d(1),s()),n&2){let t=_().$implicit;m(),w(t.status)}}function CH(n,e){if(n&1&&(l(0,"tr",154)(1,"td",159),d(2),s(),l(3,"td",166),d(4),s(),l(5,"td",174),d(6),s(),l(7,"td",175),d(8),s(),l(9,"td",163),M(10,yH,2,0,"span",176)(11,_H,2,0,"span",177)(12,vH,2,1,"span",178),s()()),n&2){let t=e.$implicit,i=_(3);m(2),w(i.formatYearMonth(t.due_month)),m(2),w(i.formatCurrency(t.rebate_amount)),m(2),w(i.formatCurrency(t.actual_paid)),m(),j("text-yellow-600",t.pending_balance>0)("text-gray-600",t.pending_balance<=0),m(),N(" ",i.formatCurrency(t.pending_balance)," "),m(2),A(t.status==="paid"?10:t.status==="pending"?11:12)}}function xH(n,e){if(n&1&&(l(0,"div",37)(1,"table",38)(2,"thead",150)(3,"tr")(4,"th",151),d(5,"\u65E5\u671F"),s(),l(6,"th",152),d(7,"\u56DE\u994B\u91D1\u984D"),s(),l(8,"th",152),d(9,"\u5BE6\u969B\u4ED8\u6B3E"),s(),l(10,"th",152),d(11,"\u61C9\u4ED8\u9918\u984D"),s(),l(12,"th",153),d(13,"\u72C0\u614B"),s()()(),l(14,"tbody"),V(15,CH,13,9,"tr",154,v$),s(),l(17,"tfoot",155)(18,"tr")(19,"td",166),d(20,"\u5408\u8A08:"),s(),l(21,"td",157),d(22),s(),l(23,"td",172),d(24),s(),l(25,"td",173),d(26),s(),x(27,"td"),s()()()()),n&2){let t=_(2);m(15),L(t.payablesDetails()),m(7),N(" ",t.formatCurrency(t.payablesDetailsRebateAmount())," "),m(2),N(" ",t.formatCurrency(t.payablesDetailsActualPaid())," "),m(2),N(" ",t.formatCurrency(t.payablesDetailsPendingBalance())," ")}}function bH(n,e){n&1&&(l(0,"div",31)(1,"p",35),d(2,"\u6B64\u54E1\u5DE5\u7121\u61C9\u4ED8\u56DE\u994B\u91D1\u8A18\u9304"),s()())}function EH(n,e){if(n&1){let t=B();l(0,"div",9)(1,"div",129)(2,"div",130)(3,"h2",131),d(4),s(),l(5,"button",133),b("click",function(){E(t);let r=_();return S(r.closePayablesDetail())}),x(6,"ion-icon",83),s()(),l(7,"div",134),M(8,hH,3,0,"div",31),M(9,xH,28,3,"div",37),M(10,bH,3,0,"div",31),s(),l(11,"div",137)(12,"button",138),b("click",function(){E(t);let r=_();return S(r.closePayablesDetail())}),d(13," \u95DC\u9589 "),s()()()()}if(n&2){let t=_();m(4),N("\u61C9\u4ED8\u56DE\u994B\u91D1\u6708\u5EA6\u660E\u7D30 - ",e.employee_name),m(4),A(t.payablesDetailLoading()?8:-1),m(),A(!t.payablesDetailLoading()&&t.payablesDetails().length>0?9:-1),m(),A(!t.payablesDetailLoading()&&t.payablesDetails().length===0?10:-1)}}function SH(n,e){if(n&1&&(l(0,"div",118)(1,"div",124),x(2,"ion-icon",125),l(3,"div",126)(4,"p",183),d(5,"\u90E8\u5206\u767C\u653E\u901A\u77E5"),s(),l(6,"p",184),d(7),s()()()()),n&2){let t=_(),i=_(2);m(7),Qe(" \u5C07\u767C\u653E ",i.formatCurrency(i.toNumber(i.releaseAmount)),"\uFF0C\u5269\u9918\u672A\u4ED8 ",i.formatCurrency(t.total_rebate-i.toNumber(i.releaseAmount))," \u5C07\u8A18\u9304\u70BA\u61C9\u4ED8\u56DE\u994B\u91D1\u3002 ")}}function DH(n,e){if(n&1&&(l(0,"div",119)(1,"div",124),x(2,"ion-icon",127),l(3,"p",128),d(4),s()()()),n&2){let t=_(3);m(4),w(t.releaseError())}}function wH(n,e){if(n&1){let t=B();l(0,"div",181)(1,"div",107)(2,"div",108)(3,"div")(4,"span",109),d(5,"\u54E1\u5DE5\u59D3\u540D\uFF1A"),s(),l(6,"span",110),d(7),s()(),l(8,"div")(9,"span",109),d(10,"\u6708\u4EFD\uFF1A"),s(),l(11,"span",110),d(12),s()(),l(13,"div",111)(14,"span",109),d(15,"\u56DE\u994B\u91D1\u7E3D\u984D\uFF1A"),s(),l(16,"span",112),d(17),s()()()(),l(18,"div")(19,"label",113),d(20," \u767C\u653E\u91D1\u984D "),l(21,"span",114),d(22,"*"),s()(),l(23,"input",182),K("ngModelChange",function(r){E(t);let o=_(2);return Q(o.releaseAmount,r)||(o.releaseAmount=r),S(r)}),s(),l(24,"p",116),d(25),s()(),M(26,SH,8,2,"div",118),M(27,DH,5,1,"div",119),s()}if(n&2){let t=e,i=_(2);m(7),w(t.employee_name),m(5),w(i.formatYearMonth(t.due_month)),m(5),w(i.formatCurrency(t.total_rebate)),m(6),J("ngModel",i.releaseAmount),I("max",t.total_rebate),m(2),N(" \u53EF\u767C\u653E\u91D1\u984D\u6700\u591A\u70BA ",i.formatCurrency(t.total_rebate)," "),m(),A(i.toNumber(i.releaseAmount)<t.total_rebate&&i.toNumber(i.releaseAmount)>0?26:-1),m(),A(i.releaseError()?27:-1)}}function TH(n,e){n&1&&(l(0,"span",123),d(1,"\u23F3"),s())}function IH(n,e){if(n&1){let t=B();l(0,"div",8)(1,"div",102)(2,"div",103)(3,"h3",104),x(4,"ion-icon",179),d(5," \u767C\u653E\u80A1\u6771\u56DE\u994B\u91D1 "),s()(),l(6,"div",180),M(7,wH,28,8,"div",181),s(),l(8,"div",120)(9,"button",121),b("click",function(){E(t);let r=_();return S(r.closeReleaseModal())}),d(10," \u53D6\u6D88 "),s(),l(11,"button",122),b("click",function(){E(t);let r=_();return S(r.submitRelease())}),M(12,TH,2,0,"span",123),d(13," \u78BA\u8A8D\u767C\u653E "),s()()()()}if(n&2){let t,i=_();m(7),A((t=i.releasingMonthlySummary())?7:-1,t),m(2),I("disabled",i.releasing()),m(2),I("disabled",i.releasing()),m(),A(i.releasing()?12:-1)}}var ns=class ns{constructor(){this.apiService=k(we);this.fb=k(qe);this.activeTab=D("monthly");this.currentDate=new Date;this.previousMonth=this.getPreviousMonth();this.selectedYear=D(this.previousMonth.year);this.selectedMonth=D(this.previousMonth.month);this.monthlySummaries=D([]);this.monthlyLoading=D(!1);this.monthlyError=D("");this.monthlyStats=D({transaction_count:0,total_rebate:0,verified_count:0,released_count:0});this.monthlyDetailModalVisible=D(!1);this.currentMonthlySummary=D(null);this.monthlyDetails=D([]);this.monthlyDetailLoading=D(!1);this.addDetailVisible=D(!1);this.detailSavingIds=D([]);this.detailDeletingIds=D([]);this.detailSaveError=D("");this.addDetailError=D("");this.addDetailSaving=D(!1);this.newDetailCheckoutAt="";this.newDetailInvoiceNo="";this.newDetailDiscountAmount="";this.newDetailInvoiceAmount="";this.newDetailRebateRate="";this.newDetailDiscountNote="";this.monthlyDetailsTotal=$(()=>this.monthlyDetails().reduce((e,t)=>e+Number(t.rebate_amount||0),0));this.releaseModalVisible=D(!1);this.releasingMonthlySummary=D(null);this.releaseAmount="";this.releasing=D(!1);this.releaseError=D("");this.downloadingReports=D(new Set);this.ledgerEditModalVisible=D(!1);this.editingLedgerEntryId=D(null);this.ledgerEditLoading=D(!1);this.ledgerEditSaving=D(!1);this.ledgerEditError=D("");this.ledgerGlAccounts=D([]);this.ledgerFormItemGroup=D("");this.ledgerEditForm=this.fb.group({entry_date:["",U.required],item_group:["",U.required],subject_name:["",U.required],amount:["",U.required],invoice_no:[""],description:[""]});this.ledgerTopLevelAccounts=$(()=>this.ledgerGlAccounts().filter(e=>e.parent_account_id===null).sort((e,t)=>e.gl_account_id-t.gl_account_id));this.ledgerSubAccounts=$(()=>{let e=this.ledgerFormItemGroup();if(!e)return[];let t=this.ledgerGlAccounts().find(i=>i.parent_account_id===null&&i.account_name===e);return t?this.ledgerGlAccounts().filter(i=>i.parent_account_id===t.gl_account_id).sort((i,r)=>i.gl_account_id-r.gl_account_id):[]});this.payablesSummary=D({total_payable:0,employees:[]});this.pendingPayablesTotal=$(()=>this.payablesSummary().employees.reduce((e,t)=>e+Number(t.pending_amount||0),0));this.payablesLoading=D(!1);this.payablesError=D("");this.payablesDetailModalVisible=D(!1);this.currentPayableEmployee=D(null);this.payablesDetails=D([]);this.payablesDetailLoading=D(!1);this.payablesPayModalVisible=D(!1);this.payingPayableEmployee=D(null);this.payablesPayAmount="";this.payablesPayRemark="";this.payingPayables=D(!1);this.payablesPayError=D("");this.payablesDetailsRebateAmount=$(()=>this.payablesDetails().reduce((e,t)=>e+Number(t.rebate_amount||0),0));this.payablesDetailsActualPaid=$(()=>this.payablesDetails().reduce((e,t)=>e+Number(t.actual_paid||0),0));this.payablesDetailsPendingBalance=$(()=>this.payablesDetails().reduce((e,t)=>e+Number(t.pending_balance||0),0));Bn(()=>{let e=this.activeTab();e==="monthly"?this.loadMonthlySummary():e==="payables"&&this.loadPayablesSummary()}),this.ledgerEditForm.get("item_group")?.valueChanges.subscribe(e=>{this.ledgerFormItemGroup.set(e||"");let t=this.ledgerEditForm.get("subject_name")?.value||"";t&&!this.ledgerSubAccounts().some(i=>i.account_name===t)&&this.ledgerEditForm.patchValue({subject_name:""},{emitEvent:!1})})}async loadMonthlySummary(){this.monthlyLoading.set(!0),this.monthlyError.set("");try{let e=await this.apiService.getShareholderMonthlySummary({year:this.selectedYear(),month:this.selectedMonth()});e.success&&e.data?this.monthlySummaries.set(e.data):this.monthlyError.set(e.error||"\u8F09\u5165\u8CC7\u6599\u5931\u6557");let t=await this.apiService.getShareholderMonthlyStats({year:this.selectedYear(),month:this.selectedMonth()});t.success&&t.data&&this.monthlyStats.set(t.data)}catch(e){this.monthlyError.set(e?.message||"\u8F09\u5165\u5931\u6557"),console.error("Error loading monthly summary:",e)}finally{this.monthlyLoading.set(!1)}}async openMonthlyDetail(e){this.currentMonthlySummary.set(e),this.monthlyDetailModalVisible.set(!0),this.monthlyDetailLoading.set(!0),this.addDetailVisible.set(!1);try{let t=await this.apiService.getShareholderMonthlyDetail(e.employee_id,{year:this.selectedYear(),month:this.selectedMonth()});if(t.success&&t.data){let i=[...t.data].sort((r,o)=>{let a=new Date(r.checkout_at).getTime(),u=new Date(o.checkout_at).getTime();return a-u});this.monthlyDetails.set(i)}}catch(t){console.error("Error loading monthly details:",t)}finally{this.monthlyDetailLoading.set(!1)}}closeMonthlyDetail(){this.monthlyDetailModalVisible.set(!1),this.currentMonthlySummary.set(null),this.monthlyDetails.set([]),this.addDetailVisible.set(!1)}openAddDetail(){this.newDetailCheckoutAt=this.formatDateTimeLocal(new Date),this.newDetailInvoiceNo="",this.newDetailDiscountAmount="",this.newDetailInvoiceAmount="",this.newDetailRebateRate="",this.newDetailDiscountNote="",this.addDetailError.set(""),this.addDetailSaving.set(!1),this.addDetailVisible.set(!0)}closeAddDetail(){this.addDetailVisible.set(!1)}async submitAddDetail(){let e=this.newDetailCheckoutAt,t=this.newDetailInvoiceNo.trim(),i=Number(String(this.newDetailDiscountAmount).replace(/,/g,"")),r=Number(String(this.newDetailInvoiceAmount).replace(/,/g,"")),o=Number(this.newDetailRebateRate);if(!e){this.addDetailError.set("\u8ACB\u586B\u5BEB\u7D50\u5E33\u6642\u9593");return}if(Number.isNaN(r)){this.addDetailError.set("\u8ACB\u586B\u5BEB\u6709\u6548\u7684\u767C\u7968\u91D1\u984D");return}this.addDetailError.set(""),this.addDetailSaving.set(!0);let a=new Date(e).toISOString(),u=Number.isNaN(i)?0:i,c=Number.isNaN(o)?0:o,p={employee_id:this.currentMonthlySummary()?.employee_id||0,checkout_at:a,invoice_no:t||null,invoice_amount:r,taxable_amount:r,discount_amount:u,discount_note:this.newDetailDiscountNote.trim()||"\u7121",rebate_rate:c,rebate_amount:this.roundTo2(r*(c/100))};try{if(!p.employee_id){this.addDetailError.set("\u627E\u4E0D\u5230\u54E1\u5DE5\u8CC7\u6599\uFF0C\u7121\u6CD5\u65B0\u589E");return}let g=await this.apiService.createShareholderRebateRecord(p);if(g.success&&g.data){let y=this.currentMonthlySummary();y&&await this.openMonthlyDetail(y),this.addDetailVisible.set(!1)}else this.addDetailError.set(g.error||"\u65B0\u589E\u5931\u6557")}catch(g){this.addDetailError.set(g?.message||"\u65B0\u589E\u5931\u6557"),console.error("Error creating rebate detail:",g)}finally{this.addDetailSaving.set(!1)}}updateDetailRebateRate(e,t){let i=Number(t),r=Number(e.invoice_amount||0),o=Number.isNaN(i)?0:i;e.rebate_rate=o,e.rebate_amount=this.roundTo2(r*(o/100)),this.monthlyDetails.set([...this.monthlyDetails()])}updateDetailInvoiceAmount(e,t){let i=Number(t),r=Number.isNaN(i)?0:i,o=Number(e.rebate_rate||0);e.invoice_amount=r,e.rebate_amount=this.roundTo2(r*(o/100)),this.monthlyDetails.set([...this.monthlyDetails()])}updateDetailRemark(e,t){e.remark=t,this.monthlyDetails.set([...this.monthlyDetails()])}isDetailSaving(e){return this.detailSavingIds().includes(e)}isDetailDeleting(e){return this.detailDeletingIds().includes(e)}async saveDetailRebate(e){if(!e.record_id||e.record_id<0)return;let t=Number(e.rebate_rate||0),i=Number(e.rebate_amount||0),r=Number(e.invoice_amount||0);if(Number.isNaN(t)||t<0||t>100){this.detailSaveError.set("\u56DE\u994B% \u5FC5\u9808\u4ECB\u65BC 0 \u5230 100");return}if(Number.isNaN(r)||r<0){this.detailSaveError.set("\u767C\u7968\u91D1\u984D\u5FC5\u9808\u70BA\u6B63\u6578");return}this.detailSaveError.set(""),this.detailSavingIds.set([...this.detailSavingIds(),e.record_id]);try{let o=await this.apiService.updateShareholderRebateRecord(e.record_id,{rebate_rate:t,rebate_amount:i,invoice_amount:r,remark:e.remark||null});if(o.success&&o.data){let a=o.data,u=this.monthlyDetails().map(c=>c.record_id===e.record_id?G(O({},c),{rebate_rate:Number(a.rebate_rate??c.rebate_rate),rebate_amount:Number(a.rebate_amount??c.rebate_amount),invoice_amount:Number(a.invoice_amount??c.invoice_amount),remark:a.remark??c.remark}):c);this.monthlyDetails.set(u)}else this.detailSaveError.set(o.error||"\u5132\u5B58\u5931\u6557")}catch(o){this.detailSaveError.set(o?.message||"\u5132\u5B58\u5931\u6557"),console.error("Error saving rebate detail:",o)}finally{this.detailSavingIds.set(this.detailSavingIds().filter(o=>o!==e.record_id))}}async deleteDetail(e){if(!(!e.record_id||!window.confirm("\u78BA\u5B9A\u8981\u522A\u9664\u9019\u7B46\u56DE\u994B\u91D1\u7D30\u9805\u55CE\uFF1F"))){if(e.record_id<0){this.monthlyDetails.set(this.monthlyDetails().filter(i=>i.record_id!==e.record_id));return}this.detailSaveError.set(""),this.detailDeletingIds.set([...this.detailDeletingIds(),e.record_id]);try{let i=await this.apiService.deleteShareholderRebateRecord(e.record_id);if(i.success){let r=this.currentMonthlySummary();r?await this.openMonthlyDetail(r):this.monthlyDetails.set(this.monthlyDetails().filter(o=>o.record_id!==e.record_id))}else this.detailSaveError.set(i.error||"\u522A\u9664\u5931\u6557")}catch(i){this.detailSaveError.set(i?.message||"\u522A\u9664\u5931\u6557"),console.error("Error deleting rebate detail:",i)}finally{this.detailDeletingIds.set(this.detailDeletingIds().filter(i=>i!==e.record_id))}}}onMonthChange(){this.activeTab()==="monthly"&&this.loadMonthlySummary()}async loadPayablesSummary(){this.payablesLoading.set(!0),this.payablesError.set("");try{let e=await this.apiService.getShareholderPayablesSummary();e.success&&e.data?this.payablesSummary.set({total_payable:e.data.total_payable||0,employees:e.data.employees||[]}):this.payablesError.set(e.error||"\u8F09\u5165\u8CC7\u6599\u5931\u6557")}catch(e){this.payablesError.set(e?.message||"\u8F09\u5165\u5931\u6557"),console.error("Error loading payables summary:",e)}finally{this.payablesLoading.set(!1)}}async openPayablesDetail(e){this.currentPayableEmployee.set(e),this.payablesDetailModalVisible.set(!0),this.payablesDetailLoading.set(!0);try{let t=await this.apiService.getShareholderPayablesDetail(e.employee_id);t.success&&t.data&&this.payablesDetails.set(t.data)}catch(t){console.error("Error loading payables details:",t)}finally{this.payablesDetailLoading.set(!1)}}closePayablesDetail(){this.payablesDetailModalVisible.set(!1),this.currentPayableEmployee.set(null),this.payablesDetails.set([])}openPayablesPayModal(e){this.payingPayableEmployee.set(e),this.payablesPayAmount="0",this.payablesPayRemark="",this.payablesPayError.set(""),this.payingPayables.set(!1),this.payablesPayModalVisible.set(!0)}closePayablesPayModal(){this.payablesPayModalVisible.set(!1),this.payingPayableEmployee.set(null),this.payablesPayAmount="",this.payablesPayRemark="",this.payablesPayError.set("")}async submitPayablesPayment(){let e=this.payingPayableEmployee();if(!e)return;let t=Number(e.pending_amount||0);if(t<=0){this.payablesPayError.set("\u6B64\u80A1\u6771\u76EE\u524D\u7121\u5F85\u652F\u4ED8\u56DE\u994B\u91D1");return}let i=Number(String(this.payablesPayAmount).replace(/,/g,""));if(Number.isNaN(i)||i<0){this.payablesPayError.set("\u8ACB\u8F38\u5165\u6709\u6548\u7684\u652F\u4ED8\u91D1\u984D");return}if(i>t){this.payablesPayError.set("\u652F\u4ED8\u91D1\u984D\u4E0D\u53EF\u5927\u65BC\u5F85\u652F\u4ED8\u56DE\u994B\u91D1\u7E3D\u984D");return}if(i<=0){this.payablesPayError.set("\u652F\u4ED8\u91D1\u984D\u9700\u5927\u65BC 0");return}this.payablesPayError.set(""),this.payingPayables.set(!0);let r=this.payablesPayRemark.trim();try{let o=await this.apiService.payShareholderRebatePayables({employee_id:e.employee_id,employee_name:e.employee_name,pay_amount:i,remark:r||void 0});if(o.success){this.closePayablesPayModal(),await this.loadPayablesSummary();let a=this.currentPayableEmployee();a&&a.employee_id===e.employee_id&&await this.openPayablesDetail(a)}else this.payablesPayError.set(o.error||"\u652F\u4ED8\u5931\u6557")}catch(o){this.payablesPayError.set(o?.message||"\u652F\u4ED8\u5931\u6557"),console.error("Error paying shareholder rebate payables:",o)}finally{this.payingPayables.set(!1)}}resetFilter(){this.selectedYear.set(new Date().getFullYear()),this.selectedMonth.set(new Date().getMonth()+1),this.onMonthChange()}formatCurrency(e){return new Intl.NumberFormat("zh-TW",{style:"currency",currency:"TWD",minimumFractionDigits:0,maximumFractionDigits:0}).format(e||0)}formatDate(e){return e?new Date(e).toLocaleDateString("zh-TW",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"}):"-"}formatYearMonth(e){return e?new Date(e).toLocaleDateString("zh-TW",{year:"numeric",month:"2-digit"}):"-"}roundTo2(e){return Math.round((e+Number.EPSILON)*100)/100}formatDateTimeLocal(e){let t=c=>String(c).padStart(2,"0"),i=e.getFullYear(),r=t(e.getMonth()+1),o=t(e.getDate()),a=t(e.getHours()),u=t(e.getMinutes());return`${i}-${r}-${o}T${a}:${u}`}toNumber(e){return Number(e)}getPreviousMonth(){let e=new Date,t=e.getMonth()+1,i=e.getFullYear();return t===1?(t=12,i--):t--,{year:i,month:t}}async verifyMonthlyShareholder(e){if(confirm(`\u78BA\u5B9A\u8981\u6838\u5C0D ${e.employee_name} (${this.formatYearMonth(e.due_month)}) \u7684\u56DE\u994B\u91D1\u55CE\uFF1F`))try{let t=await this.apiService.verifyShareholderRebate({employee_id:e.employee_id,year:this.selectedYear(),month:this.selectedMonth(),employee_name:e.employee_name,total_rebate:e.total_rebate});t.success?(alert("\u6838\u5C0D\u6210\u529F"),await this.loadMonthlySummary()):alert("\u6838\u5C0D\u5931\u6557: "+(t.error||"\u672A\u77E5\u932F\u8AA4"))}catch(t){console.error("Error verifying monthly rebate:",t),alert("\u6838\u5C0D\u5931\u6557: "+(t?.message||"\u672A\u77E5\u932F\u8AA4"))}}async releaseMonthlyShareholder(e){this.openReleaseModal(e)}isMonthlyVerified(e){return e.is_verified===!0}isMonthlyReleased(e){return e.is_released===!0}getMonthlyReleaseStatus(e){let t=Number(e.total_rebate||0),i=Number(e.released_amount||0);return t<=0||i<=0?"unreleased":i>=t?"released":"partial"}getMonthlyReleaseStatusLabel(e){let t=this.getMonthlyReleaseStatus(e);return t==="released"?"\u5DF2\u767C\u653E":t==="partial"?"\u90E8\u5206\u767C\u653E":"\u672A\u767C\u653E"}openReleaseModal(e){this.releasingMonthlySummary.set(e),this.releaseAmount=String(e.total_rebate),this.releaseError.set(""),this.releasing.set(!1),this.releaseModalVisible.set(!0)}closeReleaseModal(){this.releaseModalVisible.set(!1),this.releasingMonthlySummary.set(null),this.releaseAmount="",this.releaseError.set("")}async submitRelease(){let e=this.releasingMonthlySummary();if(!e)return;let t=Number(String(this.releaseAmount).replace(/,/g,""));if(Number.isNaN(t)||t<0){this.releaseError.set("\u8ACB\u8F38\u5165\u6709\u6548\u7684\u767C\u653E\u91D1\u984D");return}if(t>e.total_rebate){this.releaseError.set("\u767C\u653E\u91D1\u984D\u4E0D\u53EF\u5927\u65BC\u7E3D\u56DE\u994B\u91D1");return}this.releaseError.set(""),this.releasing.set(!0);try{let i=await this.apiService.releaseShareholderRebate({employee_id:e.employee_id,year:this.selectedYear(),month:this.selectedMonth(),employee_name:e.employee_name,total_rebate:e.total_rebate,release_amount:t});i.success?(this.closeReleaseModal(),await this.loadMonthlySummary()):this.releaseError.set(i.error||"\u767C\u653E\u5931\u6557")}catch(i){this.releaseError.set(i?.message||"\u767C\u653E\u5931\u6557"),console.error("Error releasing rebate:",i)}finally{this.releasing.set(!1)}}async downloadLaborReport(e,t){t.stopPropagation();let i=`${e.employee_id}-${this.selectedYear()}-${this.selectedMonth()}`;if(this.downloadingReports().has(i))return;let r=new Set(this.downloadingReports());r.add(i),this.downloadingReports.set(r);try{let o=`${this.selectedYear()}-${String(this.selectedMonth()).padStart(2,"0")}`,a=await this.apiService.downloadLaborReportByEmployeeId(e.employee_id,o),u=a.body||new Blob,c=a.headers.get("Content-Disposition")||"",p=c.match(/filename\*=UTF-8''([^;]+)/i),g=c.match(/filename="?([^";]+)"?/i),y="labor-report.zip";if(p?.[1])try{y=decodeURIComponent(p[1])}catch{y=p[1]}else g?.[1]&&(y=g[1]);let v=window.URL.createObjectURL(u),C=document.createElement("a");C.href=v,C.download=y,document.body.appendChild(C),C.click(),document.body.removeChild(C),window.URL.revokeObjectURL(v)}catch(o){alert("\u4E0B\u8F09\u52DE\u5831\u55AE\u5931\u6557: "+(o?.message||"\u672A\u77E5\u932F\u8AA4")),console.error("Error downloading labor report:",o)}finally{let o=new Set(this.downloadingReports());o.delete(i),this.downloadingReports.set(o)}}isDownloadingReport(e){let t=`${e.employee_id}-${this.selectedYear()}-${this.selectedMonth()}`;return this.downloadingReports().has(t)}async openLedgerEditModal(e){let t=Number(e);if(!(Number.isNaN(t)||t<=0)){this.ledgerEditModalVisible.set(!0),this.editingLedgerEntryId.set(t),this.ledgerEditLoading.set(!0),this.ledgerEditSaving.set(!1),this.ledgerEditError.set("");try{await this.ensureLedgerGlAccountsLoaded();let i=await this.apiService.getLedgerEntries({entryId:t,page:1,limit:1});if(!i.success||!i.data||i.data.length===0){this.ledgerEditError.set(i.error||"\u67E5\u7121\u6B64\u6D41\u6C34\u5E33\u8CC7\u6599");return}let r=i.data[0];this.ledgerEditForm.patchValue({entry_date:this.normalizeDateInput(r.entry_date),item_group:r.item_group||"",subject_name:r.subject_name||"",amount:r.amount!==null&&r.amount!==void 0?String(r.amount):"",invoice_no:r.invoice_no||"",description:r.description||""})}catch(i){this.ledgerEditError.set(i?.message||"\u8F09\u5165\u6D41\u6C34\u5E33\u8CC7\u6599\u5931\u6557"),console.error("Error opening ledger edit modal:",i)}finally{this.ledgerEditLoading.set(!1)}}}closeLedgerEditModal(){this.ledgerEditModalVisible.set(!1),this.editingLedgerEntryId.set(null),this.ledgerEditLoading.set(!1),this.ledgerEditSaving.set(!1),this.ledgerEditError.set(""),this.ledgerEditForm.reset({entry_date:"",item_group:"",subject_name:"",amount:"",invoice_no:"",description:""}),this.ledgerFormItemGroup.set("")}async submitLedgerEdit(){let e=this.editingLedgerEntryId();if(!e){this.ledgerEditError.set("\u7F3A\u5C11\u6D41\u6C34\u5E33 ID");return}if(this.ledgerEditForm.invalid){this.ledgerEditForm.markAllAsTouched(),this.ledgerEditError.set("\u8ACB\u586B\u5BEB\u5FC5\u8981\u6B04\u4F4D");return}let t=this.ledgerEditForm.value,i=Number(t.amount);if(Number.isNaN(i)){this.ledgerEditError.set("\u91D1\u984D\u683C\u5F0F\u4E0D\u6B63\u78BA");return}let r=null;t.item_group&&t.subject_name&&(r=this.ledgerSubAccounts().find(a=>a.account_name===t.subject_name)?.gl_account_id||null),this.ledgerEditSaving.set(!0),this.ledgerEditError.set("");try{let o=await this.apiService.updateLedgerEntry({entry_id:e,entry_date:t.entry_date||void 0,item_group:t.item_group||void 0,subject_name:t.subject_name||void 0,amount:i,invoice_no:t.invoice_no||void 0,description:t.description||void 0,gl_account_id:r||void 0});o.success?(this.closeLedgerEditModal(),await this.loadMonthlySummary()):this.ledgerEditError.set(o.error||"\u4FEE\u6539\u6D41\u6C34\u5E33\u5931\u6557")}catch(o){this.ledgerEditError.set(o?.message||"\u4FEE\u6539\u6D41\u6C34\u5E33\u5931\u6557"),console.error("Error saving ledger edit:",o)}finally{this.ledgerEditSaving.set(!1)}}isLedgerEditInvalid(e){let t=this.ledgerEditForm.get(e);return!!t&&t.invalid&&t.touched}async ensureLedgerGlAccountsLoaded(){if(this.ledgerGlAccounts().length>0)return;let e=await this.apiService.getGLAccounts();e.success&&e.data&&this.ledgerGlAccounts.set(e.data.map(t=>({gl_account_id:t.gl_account_id,parent_account_id:t.parent_account_id,account_name:t.account_name})))}normalizeDateInput(e){if(!e)return"";if(/^\d{4}-\d{2}-\d{2}$/.test(e))return e;let t=new Date(e);if(Number.isNaN(t.getTime()))return"";let i=t.getFullYear(),r=String(t.getMonth()+1).padStart(2,"0"),o=String(t.getDate()).padStart(2,"0");return`${i}-${r}-${o}`}};ns.\u0275fac=function(t){return new(t||ns)},ns.\u0275cmp=re({type:ns,selectors:[["app-shareholder-rebates"]],decls:19,vars:20,consts:[[1,"space-y-6"],[1,"flex","flex-wrap","items-start","justify-between","gap-4"],[1,"text-3xl","font-bold","text-gray-900"],[1,"flex","flex-col","sm:flex-row","items-center","gap-2","bg-white","p-3","rounded-xl","shadow-md","border","border-gray-200"],[1,"flex","gap-4","border-b","border-gray-200"],[1,"px-4","py-3","text-sm","font-medium","text-gray-600","hover:text-gray-900","transition-colors",3,"click"],["name","calendar-outline",1,"text-base","align-middle","mr-2"],["name","wallet-outline",1,"text-base","align-middle","mr-2"],[1,"fixed","inset-0","bg-black","bg-opacity-50","z-50","flex","items-center","justify-center","p-4"],[1,"fixed","inset-0","bg-black","bg-opacity-50","flex","items-center","justify-center","z-50","p-4"],[1,"flex","items-center","gap-2"],[1,"text-sm","font-medium","text-gray-600"],[1,"border-gray-300","rounded-lg","shadow-sm","focus:ring-indigo-500","focus:border-indigo-500","text-sm","p-2","bg-gray-100","pr-8",3,"ngModelChange","change","ngModel"],["value","2024"],["value","2025"],["value","2026"],[3,"value"],[1,"flex","items-center","gap-2","mt-2","sm:mt-0"],["title","\u91CD\u8A2D\u7BE9\u9078",1,"text-gray-500","hover:text-gray-800","transition-colors","p-2","rounded-full","bg-gray-100","hover:bg-gray-200",3,"click"],["name","refresh-outline",1,"text-xl"],[1,"grid","grid-cols-1","md:grid-cols-4","gap-6"],[1,"bg-white","p-6","rounded-xl","shadow-md","flex","items-center","space-x-4"],[1,"bg-green-100","p-3","rounded-full"],["name","people-outline",1,"text-2xl","text-green-600"],[1,"text-sm","text-gray-500"],[1,"text-2xl","font-semibold","text-gray-900"],["name","cash-outline",1,"text-2xl","text-green-600"],[1,"bg-yellow-100","p-3","rounded-full"],["name","checkmark-circle-outline",1,"text-2xl","text-yellow-600"],[1,"bg-indigo-100","p-3","rounded-full"],["name","send-outline",1,"text-2xl","text-indigo-600"],[1,"text-center","py-8"],[1,"bg-red-50","border","border-red-200","rounded-lg","p-4"],[1,"bg-white","rounded-lg","shadow-md","overflow-hidden"],[1,"bg-gray-50","rounded-lg","p-8","text-center"],[1,"text-gray-500"],[1,"text-sm","text-red-700"],[1,"overflow-x-auto"],[1,"w-full","text-sm"],[1,"bg-gray-100","border-b","border-gray-200"],[1,"px-4","py-3","text-left","font-semibold","text-gray-700"],[1,"px-4","py-3","text-center","font-semibold","text-gray-700"],[1,"px-4","py-3","text-right","font-semibold","text-gray-700"],["title","\u9EDE\u64CA\u67E5\u770B\u660E\u7D30",1,"border-b","border-gray-200","hover:bg-indigo-50","transition-colors","cursor-pointer"],["title","\u9EDE\u64CA\u67E5\u770B\u660E\u7D30",1,"border-b","border-gray-200","hover:bg-indigo-50","transition-colors","cursor-pointer",3,"click"],[1,"px-4","py-3","text-gray-700"],[1,"px-4","py-3","font-medium","text-gray-900"],[1,"px-4","py-3","text-center","text-gray-600"],[1,"px-4","py-3","text-right","font-semibold","text-gray-900"],[1,"px-4","py-3","text-center"],[1,"inline-flex","items-center","px-2","py-1","rounded-full","text-xs","font-medium","bg-green-100","text-green-800"],["title","\u6838\u5C0D\u6B64\u80A1\u6771\u4E0A\u6708\u56DE\u994B\u91D1",1,"px-3","py-1","bg-green-600","text-white","rounded","text-xs","hover:bg-green-700","transition-colors"],[1,"inline-flex","items-center","px-2","py-1","rounded-full","text-xs","font-medium","bg-blue-100","text-blue-800"],[1,"inline-flex","items-center","px-2","py-1","rounded-full","text-xs","font-medium","bg-yellow-100","text-yellow-800"],[1,"inline-flex","items-center","px-2","py-1","rounded-full","text-xs","font-medium","bg-gray-100","text-gray-700"],["type","button","title","\u4FEE\u6539\u6D41\u6C34\u5E33",1,"text-indigo-600","hover:text-indigo-800","hover:underline","text-sm","inline-flex","items-center"],[1,"text-gray-400","text-sm"],["title","\u4E0B\u8F09\u52DE\u5831\u55AE\uFF08\u542B Word \u8207 PDF\uFF09",1,"px-3","py-1","rounded","text-xs","transition-colors",3,"click","disabled"],[1,"inline-flex","items-center"],["name","checkmark-done-outline",1,"mr-1"],["title","\u6838\u5C0D\u6B64\u80A1\u6771\u4E0A\u6708\u56DE\u994B\u91D1",1,"px-3","py-1","bg-green-600","text-white","rounded","text-xs","hover:bg-green-700","transition-colors",3,"click"],["name","cash-outline",1,"mr-1"],["name","remove-circle-outline",1,"mr-1"],["name","ellipse-outline",1,"mr-1"],["type","button","title","\u4FEE\u6539\u6D41\u6C34\u5E33",1,"text-indigo-600","hover:text-indigo-800","hover:underline","text-sm","inline-flex","items-center",3,"click"],["name","link-outline",1,"text-lg","mr-1"],["name","hourglass-outline",1,"animate-spin","mr-1"],["name","download-outline",1,"mr-1"],[1,"bg-white","p-6","rounded-xl","shadow-md"],[1,"flex","items-center","justify-between"],[1,"text-sm","text-gray-500","mb-2"],[1,"bg-red-100","p-4","rounded-full"],["name","wallet-outline",1,"text-4xl","text-red-600"],[1,"border-b","border-gray-200","hover:bg-gray-50","transition-colors"],[1,"px-4","py-3","text-right","text-yellow-600","font-semibold"],[1,"px-4","py-3","text-right","text-green-600","font-semibold"],[1,"flex","items-center","justify-center","gap-2"],[1,"px-3","py-1","bg-indigo-600","text-white","rounded","text-xs","hover:bg-indigo-700","disabled:bg-gray-300","disabled:cursor-not-allowed","transition-colors",3,"click","disabled"],[1,"text-indigo-600","hover:text-indigo-800","hover:underline","text-sm","font-medium",3,"click"],[1,"bg-white","rounded-lg","shadow-xl","w-full","max-w-2xl","max-h-[90vh]","flex","flex-col"],[1,"flex","justify-between","items-center","p-4","border-b"],[1,"text-lg","font-semibold"],[1,"text-gray-400","hover:text-gray-600",3,"click"],["name","close-outline",1,"text-2xl"],[1,"p-6","overflow-y-auto"],[1,"text-center","py-8","text-gray-500"],["novalidate","",1,"space-y-6",3,"formGroup"],["novalidate","",1,"space-y-6",3,"ngSubmit","formGroup"],[1,"grid","grid-cols-1","md:grid-cols-2","gap-6"],[1,"block","text-sm","font-medium","text-gray-700"],["type","date","formControlName","entry_date",1,"mt-1","block","w-full","border","bg-gray-50","rounded-md","shadow-sm","p-2"],["formControlName","item_group",1,"mt-1","block","w-full","border","bg-gray-50","rounded-md","shadow-sm","p-2"],["value",""],["formControlName","subject_name",1,"mt-1","block","w-full","border","bg-gray-50","rounded-md","shadow-sm","p-2"],["type","number","formControlName","amount",1,"mt-1","block","w-full","border","bg-gray-50","rounded-md","shadow-sm","p-2","text-right"],["type","text","formControlName","invoice_no",1,"mt-1","block","w-full","border","bg-gray-50","rounded-md","shadow-sm","p-2"],[1,"md:col-span-2"],["formControlName","description","rows","3",1,"mt-1","block","w-full","border","bg-gray-50","rounded-md","shadow-sm","p-2"],[1,"bg-red-50","border","border-red-200","rounded-lg","p-3"],[1,"flex","justify-end","gap-4","pt-4","border-t"],["type","button",1,"px-4","py-2","border","border-gray-300","rounded-md","text-sm","font-medium","text-gray-700","bg-white","hover:bg-gray-50","disabled:opacity-50",3,"click","disabled"],["type","submit",1,"px-4","py-2","border","border-transparent","rounded-md","text-sm","font-medium","text-white","bg-indigo-600","hover:bg-indigo-700","disabled:opacity-50",3,"disabled"],[1,"bg-white","rounded-lg","shadow-xl","w-full","max-w-md"],[1,"border-b","p-4","bg-indigo-600","text-white","rounded-t-lg"],[1,"text-lg","font-semibold","flex","items-center"],["name","wallet-outline",1,"text-xl","mr-2"],[1,"p-6","space-y-4"],[1,"bg-gray-50","rounded-lg","p-4"],[1,"grid","grid-cols-2","gap-3","text-sm"],[1,"text-gray-600"],[1,"font-medium","text-gray-900"],[1,"col-span-2"],[1,"font-semibold","text-lg","text-indigo-600"],[1,"block","text-sm","font-medium","text-gray-700","mb-2"],[1,"text-red-500"],["type","number","placeholder","\u8ACB\u8F38\u5165\u652F\u4ED8\u91D1\u984D","min","0","step","1",1,"w-full","px-3","py-2","border","border-gray-300","rounded-lg","focus:outline-none","focus:ring-2","focus:ring-indigo-500",3,"ngModelChange","ngModel","max"],[1,"mt-1","text-xs","text-gray-500"],["rows","3","placeholder","\u8ACB\u8F38\u5165\u5099\u8A3B\uFF08\u53EF\u9078\uFF09",1,"w-full","px-3","py-2","border","border-gray-300","rounded-lg","focus:outline-none","focus:ring-2","focus:ring-indigo-500",3,"ngModelChange","ngModel"],[1,"bg-yellow-50","border-l-4","border-yellow-400","p-3"],[1,"bg-red-50","border-l-4","border-red-400","p-3"],[1,"border-t","p-4","bg-gray-50","flex","justify-end","space-x-3","rounded-b-lg"],[1,"px-4","py-2","bg-gray-300","text-gray-800","rounded-lg","font-medium","hover:bg-gray-400","disabled:opacity-50","disabled:cursor-not-allowed","transition-colors",3,"click","disabled"],[1,"px-4","py-2","bg-indigo-600","text-white","rounded-lg","font-medium","hover:bg-indigo-700","disabled:opacity-50","disabled:cursor-not-allowed","transition-colors","flex","items-center",3,"click","disabled"],[1,"inline-block","animate-spin","mr-2"],[1,"flex","items-start"],["name","warning-outline",1,"text-yellow-600","text-xl","mr-2","flex-shrink-0","mt-0.5"],[1,"text-sm","text-yellow-800"],["name","alert-circle-outline",1,"text-red-600","text-xl","mr-2","flex-shrink-0","mt-0.5"],[1,"text-sm","text-red-800"],[1,"bg-white","rounded-lg","shadow-lg","max-w-5xl","w-full","max-h-[90vh]","flex","flex-col"],[1,"bg-white","border-b","p-4","flex","justify-between","items-center","sticky","top-0","z-10"],[1,"text-lg","font-semibold","text-gray-900"],[1,"px-3","py-2","bg-indigo-600","text-white","rounded","text-sm","hover:bg-indigo-700","transition-colors",3,"click"],[1,"text-gray-400","hover:text-gray-600","p-2",3,"click"],[1,"overflow-y-auto","flex-1","p-4"],[1,"mb-4","bg-gray-50","border","border-gray-200","rounded-lg","p-4"],[1,"mb-4","bg-red-50","border","border-red-200","rounded-lg","p-3"],[1,"border-t","p-4","bg-gray-50","flex","justify-end"],[1,"bg-gray-300","text-gray-800","px-4","py-2","rounded-lg","font-medium","hover:bg-gray-400","transition-colors",3,"click"],[1,"grid","grid-cols-1","md:grid-cols-6","gap-3","items-end"],[1,"block","text-xs","font-medium","text-gray-600","mb-1"],["type","datetime-local",1,"w-full","border-gray-300","rounded-lg","text-sm","p-2",3,"ngModelChange","ngModel"],["type","text","placeholder","\u767C\u7968\u865F\u78BC",1,"w-full","border-gray-300","rounded-lg","text-sm","p-2",3,"ngModelChange","ngModel"],["type","number","placeholder","\u6298\u6263\u91D1\u984D",1,"w-full","border-gray-300","rounded-lg","text-sm","p-2",3,"ngModelChange","ngModel"],["type","number","placeholder","\u767C\u7968\u91D1\u984D",1,"w-full","border-gray-300","rounded-lg","text-sm","p-2",3,"ngModelChange","ngModel"],["type","number","min","0","placeholder","\u56DE\u994B%",1,"w-full","border-gray-300","rounded-lg","text-sm","p-2",3,"ngModelChange","ngModel"],["type","text","placeholder","\u4F7F\u7528\u6298\u6263",1,"w-full","border-gray-300","rounded-lg","text-sm","p-2",3,"ngModelChange","ngModel"],[1,"md:col-span-6","flex","gap-2","justify-end"],[1,"px-4","py-2","bg-green-600","text-white","rounded-lg","text-sm","hover:bg-green-700","disabled:bg-gray-300","disabled:cursor-not-allowed","transition-colors",3,"click","disabled"],[1,"px-4","py-2","bg-gray-200","text-gray-700","rounded-lg","text-sm","hover:bg-gray-300","transition-colors",3,"click"],[1,"bg-gray-50","border-b","border-gray-200","sticky","top-0"],[1,"px-3","py-2","text-left","font-semibold","text-gray-700"],[1,"px-3","py-2","text-right","font-semibold","text-gray-700"],[1,"px-3","py-2","text-center","font-semibold","text-gray-700"],[1,"border-b","border-gray-200","hover:bg-gray-50"],[1,"bg-gray-50","border-t-2","border-gray-200"],["colspan","5",1,"px-3","py-2","text-right","font-semibold","text-gray-900"],[1,"px-3","py-2","text-right","font-bold","text-gray-900","text-base"],[1,"px-3","py-2","text-gray-600","text-xs"],[1,"px-3","py-2","font-medium","text-gray-900"],[1,"px-3","py-2","text-right","text-gray-600"],[1,"px-3","py-2","text-right"],["type","number","min","0","step","0.01",1,"w-24","border-gray-300","rounded-md","text-sm","p-1","text-right","font-semibold",3,"ngModelChange","ngModel"],[1,"px-3","py-2","text-center"],[1,"flex","items-center","justify-center","gap-1"],["type","number","min","0",1,"w-20","border-gray-300","rounded-md","text-sm","p-1","text-center",3,"ngModelChange","ngModel"],[1,"px-3","py-2","text-right","font-semibold","text-gray-900"],[1,"px-3","py-2","text-sm","text-gray-600"],[1,"px-3","py-2"],["type","text","placeholder","\u8F38\u5165\u5099\u8A3B",1,"w-full","border-gray-300","rounded-md","text-sm","p-1",3,"ngModelChange","ngModel"],[1,"px-3","py-1","rounded","text-xs","font-medium","bg-indigo-600","text-white","hover:bg-indigo-700","disabled:bg-gray-300","disabled:cursor-not-allowed","transition-colors",3,"click","disabled"],[1,"px-3","py-1","rounded","text-xs","font-medium","bg-red-600","text-white","hover:bg-red-700","disabled:bg-gray-300","disabled:cursor-not-allowed","transition-colors",3,"click","disabled"],[1,"px-3","py-2","text-right","font-bold","text-green-600","text-base"],[1,"px-3","py-2","text-right","font-bold","text-yellow-600","text-base"],[1,"px-3","py-2","text-right","text-green-600","font-semibold"],[1,"px-3","py-2","text-right","font-semibold"],[1,"inline-block","bg-green-100","text-green-800","px-2","py-1","rounded","text-xs","font-semibold"],[1,"inline-block","bg-yellow-100","text-yellow-800","px-2","py-1","rounded","text-xs","font-semibold"],[1,"inline-block","bg-gray-100","text-gray-800","px-2","py-1","rounded","text-xs","font-semibold"],["name","cash-outline",1,"text-xl","mr-2"],[1,"p-6"],[1,"space-y-4"],["type","number","placeholder","\u8ACB\u8F38\u5165\u767C\u653E\u91D1\u984D","min","0","step","1",1,"w-full","px-3","py-2","border","border-gray-300","rounded-lg","focus:outline-none","focus:ring-2","focus:ring-indigo-500",3,"ngModelChange","ngModel","max"],[1,"font-medium"],[1,"mt-1"]],template:function(t,i){if(t&1&&(l(0,"div",0)(1,"div",1)(2,"h1",2),d(3,"\u80A1\u6771\u56DE\u994B\u91D1"),s(),M(4,x$,17,3,"div",3),s(),l(5,"div",4)(6,"button",5),b("click",function(){return i.activeTab.set("monthly")}),x(7,"ion-icon",6),d(8," \u6BCF\u6708\u56DE\u994B\u91D1 "),s(),l(9,"button",5),b("click",function(){return i.activeTab.set("payables")}),x(10,"ion-icon",7),d(11," \u61C9\u4ED8\u56DE\u994B\u91D1 "),s()(),M(12,L$,38,8,"div",0),M(13,G$,14,5,"div",0),s(),M(14,Q$,10,2,"div",8),M(15,tH,44,12,"div",8),M(16,gH,20,8,"div",9),M(17,EH,14,4,"div",9),M(18,IH,14,4,"div",8)),t&2){let r,o,a;m(4),A(i.activeTab()==="monthly"?4:-1),m(2),j("border-b-2",i.activeTab()==="monthly")("border-indigo-600",i.activeTab()==="monthly")("text-indigo-600",i.activeTab()==="monthly"),m(3),j("border-b-2",i.activeTab()==="payables")("border-indigo-600",i.activeTab()==="payables")("text-indigo-600",i.activeTab()==="payables"),m(3),A(i.activeTab()==="monthly"?12:-1),m(),A(i.activeTab()==="payables"?13:-1),m(),A(i.ledgerEditModalVisible()?14:-1),m(),A((r=i.payablesPayModalVisible()&&i.payingPayableEmployee())?15:-1,r),m(),A((o=i.monthlyDetailModalVisible()&&i.currentMonthlySummary())?16:-1,o),m(),A((a=i.payablesDetailModalVisible()&&i.currentPayableEmployee())?17:-1,a),m(),A(i.releaseModalVisible()?18:-1)}},dependencies:[se,De,Ve,He,Ge,be,Bt,Oe,fe,ke,_o,Kl,Ie,Be,Le,Ue],encapsulation:2,changeDetection:0});var Ep=ns;var MH=["notesArea"],AH=["actionItemsArea"],xS=(n,e)=>e.id;function RH(n,e){n&1&&(l(0,"div",7),x(1,"ion-icon",13),l(2,"span"),d(3,"\u8F09\u5165\u4E2D..."),s()())}function NH(n,e){n&1&&(l(0,"div",8),x(1,"ion-icon",13),l(2,"span"),d(3,"\u8655\u7406\u4E2D..."),s()())}function FH(n,e){if(n&1&&(l(0,"div",33)(1,"h4",36),x(2,"ion-icon",37),d(3,"\u884C\u52D5\u4E8B\u9805"),s(),x(4,"div",38),s()),n&2){let t=_(2).$implicit;m(4),I("innerHTML",t.actionItems,Gi)}}function PH(n,e){if(n&1&&(l(0,"div",27)(1,"div",28)(2,"div",29)(3,"h4",30),x(4,"ion-icon",31),d(5,"\u8207\u6703\u4EBA\u54E1"),s(),l(6,"p",32),d(7),s()(),M(8,FH,5,1,"div",33),l(9,"div",29)(10,"h4",30),x(11,"ion-icon",34),d(12,"\u6703\u8B70\u8A18\u9304"),s(),x(13,"div",35),s()()()),n&2){let t=_().$implicit;m(7),w(t.attendees),m(),A(t.actionItems?8:-1),m(5),I("innerHTML",t.notes,Gi)}}function kH(n,e){if(n&1){let t=B();l(0,"div",10)(1,"div",14),b("click",function(){let r=E(t).$implicit,o=_();return S(o.toggleMeeting(r.id))}),l(2,"div",15)(3,"div",16)(4,"p",17),d(5),jt(6,"date"),s(),l(7,"p",18),d(8),jt(9,"date"),s()(),l(10,"div")(11,"p",19),d(12),jt(13,"date"),s(),l(14,"h3",20),d(15),s()()(),l(16,"div",21)(17,"button",22),b("click",function(r){let o=E(t).$implicit,a=_();return r.stopPropagation(),S(a.openModal(o))}),x(18,"ion-icon",23),s(),l(19,"button",24),b("click",function(r){let o=E(t).$implicit,a=_();return r.stopPropagation(),S(a.requestDelete(o))}),x(20,"ion-icon",25),s(),x(21,"ion-icon",26),s()(),M(22,PH,14,3,"div",27),s()}if(n&2){let t=e.$implicit,i=_();m(5),w(un(6,7,t.date,"MMM")),m(3),w(un(9,10,t.date,"dd")),m(4),w(un(13,13,t.date,"fullDate")),m(3),w(t.title),m(6),j("rotate-180",i.openMeetingId()===t.id),m(),A(i.openMeetingId()===t.id?22:-1)}}function VH(n,e){n&1&&(l(0,"div",11),d(1," \u5C1A\u7121\u6703\u8B70\u7D00\u9304\uFF0C\u9EDE\u64CA\u300C\u65B0\u589E\u6BCF\u5468\u6703\u8B70\u300D\u4F86\u5EFA\u7ACB\u7B2C\u4E00\u7B46\u7D00\u9304\u3002 "),s())}function LH(n,e){if(n&1){let t=B();l(0,"label",53)(1,"input",72),b("change",function(r){let o=E(t).$implicit,a=_(2);return S(a.toggleAttendee(o.id,r.target.checked))}),s(),l(2,"span"),d(3),s()()}if(n&2){let t=e.$implicit,i=_(2);m(),I("checked",i.isAttendeeSelected(t.id)),m(2),w(t.name)}}function OH(n,e){n&1&&x(0,"ion-icon",13)}function BH(n,e){if(n&1){let t=B();l(0,"div",12)(1,"div",39)(2,"div",40)(3,"h3",41),d(4),s(),l(5,"button",42),b("click",function(){E(t);let r=_();return S(r.closeModal())}),x(6,"ion-icon",43),s()(),l(7,"div",44)(8,"form",45),b("ngSubmit",function(){E(t);let r=_();return S(r.handleFormSubmit())}),l(9,"div",28)(10,"div")(11,"label",46),d(12,"\u65E5\u671F*"),s(),x(13,"input",47),s(),l(14,"div",48)(15,"label",49),d(16,"\u6A19\u984C*"),s(),x(17,"input",50),s()(),l(18,"div")(19,"label",51),d(20,"\u8207\u6703\u4EBA\u54E1*"),s(),l(21,"div",52),V(22,LH,4,2,"label",53,xS),s()(),l(24,"div")(25,"label",54),d(26,"\u6703\u8B70\u8A18\u9304*"),s(),l(27,"div",55)(28,"button",56),b("click",function(){E(t);let r=oe(39),o=_();return S(o.applyTextFormat("notes","bold",r))}),x(29,"ion-icon",57),s(),l(30,"button",58),b("click",function(){E(t);let r=oe(39),o=_();return S(o.applyTextFormat("notes","italic",r))}),x(31,"ion-icon",59),s(),l(32,"button",60),b("click",function(){E(t);let r=oe(39),o=_();return S(o.applyTextFormat("notes","underline",r))}),x(33,"ion-icon",61),s(),l(34,"button",62),b("click",function(){E(t);let r=oe(39),o=_();return S(o.applyTextFormat("notes","bullet",r))}),x(35,"ion-icon",63),s(),l(36,"button",64),b("click",function(){E(t);let r=oe(39),o=_();return S(o.applyTextFormat("notes","numbered",r))}),x(37,"ion-icon",65),s()(),l(38,"div",66,0),b("input",function(){E(t);let r=oe(39),o=_();return S(o.onEditorInput("notes",r))}),s()(),l(40,"div")(41,"label",67),d(42,"\u884C\u52D5\u4E8B\u9805"),s(),l(43,"div",55)(44,"button",56),b("click",function(){E(t);let r=oe(55),o=_();return S(o.applyTextFormat("actionItems","bold",r))}),x(45,"ion-icon",57),s(),l(46,"button",58),b("click",function(){E(t);let r=oe(55),o=_();return S(o.applyTextFormat("actionItems","italic",r))}),x(47,"ion-icon",59),s(),l(48,"button",60),b("click",function(){E(t);let r=oe(55),o=_();return S(o.applyTextFormat("actionItems","underline",r))}),x(49,"ion-icon",61),s(),l(50,"button",62),b("click",function(){E(t);let r=oe(55),o=_();return S(o.applyTextFormat("actionItems","bullet",r))}),x(51,"ion-icon",63),s(),l(52,"button",64),b("click",function(){E(t);let r=oe(55),o=_();return S(o.applyTextFormat("actionItems","numbered",r))}),x(53,"ion-icon",65),s()(),l(54,"div",68,1),b("input",function(){E(t);let r=oe(55),o=_();return S(o.onEditorInput("actionItems",r))}),s()(),l(56,"div",69)(57,"button",70),b("click",function(){E(t);let r=_();return S(r.closeModal())}),d(58,"\u53D6\u6D88"),s(),l(59,"button",71),M(60,OH,1,0,"ion-icon",13),l(61,"span"),d(62,"\u5132\u5B58"),s()()()()()()()}if(n&2){let t=_();m(4),w(t.editingMeeting()?"\u7DE8\u8F2F\u6BCF\u5468\u6703\u8B70":"\u65B0\u589E\u6BCF\u5468\u6703\u8B70"),m(4),I("formGroup",t.meetingForm),m(14),L(t.employees()),m(37),I("disabled",t.meetingForm.invalid||t.processing()),m(),A(t.processing()?60:-1)}}function UH(n,e){n&1&&x(0,"ion-icon",13)}function $H(n,e){if(n&1){let t=B();l(0,"div",12)(1,"div",73)(2,"div",74)(3,"div",75),x(4,"ion-icon",76),s(),l(5,"h3",77),d(6,"\u78BA\u5B9A\u8981\u522A\u9664\u55CE\uFF1F"),s(),l(7,"p",78),d(8),s()(),l(9,"div",79)(10,"button",70),b("click",function(){E(t);let r=_();return S(r.cancelDelete())}),d(11,"\u53D6\u6D88"),s(),l(12,"button",80),b("click",function(){E(t);let r=_();return S(r.confirmDelete())}),M(13,UH,1,0,"ion-icon",13),l(14,"span"),d(15,"\u78BA\u8A8D\u522A\u9664"),s()()()()()}if(n&2){let t=_();m(8),N("\u60A8\u78BA\u5B9A\u8981\u522A\u9664\u6BCF\u5468\u6703\u8B70\u7D00\u9304\u300C",e.title,"\u300D\u55CE\uFF1F\u6B64\u64CD\u4F5C\u7121\u6CD5\u5FA9\u539F\u3002"),m(4),I("disabled",t.processing()),m(),A(t.processing()?13:-1)}}var is=class is{constructor(){this.apiService=k(we);this.fb=k(qe);this.isModalOpen=D(!1);this.editingMeeting=D(null);this.openMeetingId=D(null);this.meetingToDelete=D(null);this.loading=D(!1);this.processing=D(!1);this.meetings=D([]);this.employees=D([]);this.sortedMeetings=$(()=>this.meetings().slice().sort((e,t)=>new Date(t.date).getTime()-new Date(e.date).getTime()));this.meetingForm=this.fb.group({date:["",U.required],title:["",U.required],attendees:[[],U.required],notes:["",U.required],actionItems:[""]});this.loadMeetings()}async loadMeetings(){this.loading.set(!0);try{let[e,t]=await Promise.all([this.apiService.getCollaborationMeetings(),this.apiService.getEmployeeInfo()]);t.success&&t.data&&this.employees.set(t.data.map(o=>({id:Number(o.id),name:o.employee_name})));let i=e;if(!i.success||!i.data)throw new Error(i.error||"\u8F09\u5165\u6703\u8B70\u5931\u6557");let r=i.data.map(o=>({id:Number(o.id),date:o.meetingDate?String(o.meetingDate).split("T")[0]:"",title:o.topic||"",attendees:(o.attendees||[]).map(a=>a.attendeeEmployeeName||String(a.attendeeEmployeeId)).join(", "),attendeeIds:(o.attendees||[]).map(a=>Number(a.attendeeEmployeeId)).filter(a=>Number.isFinite(a)),notes:o.meetingNotes||"",actionItems:o.actionItems||""}));this.meetings.set(r)}catch(e){console.error(e),alert(e?.message||"\u8F09\u5165\u6703\u8B70\u5931\u6557")}finally{this.loading.set(!1)}}onEditorInput(e,t){this.meetingForm.patchValue({[e]:t.innerHTML||""})}syncEditorContents(){let e=this.meetingForm.get("notes")?.value||"",t=this.meetingForm.get("actionItems")?.value||"";this.notesAreaRef?.nativeElement&&(this.notesAreaRef.nativeElement.innerHTML=String(e)),this.actionItemsAreaRef?.nativeElement&&(this.actionItemsAreaRef.nativeElement.innerHTML=String(t))}applyTextFormat(e,t,i){let r={bold:"bold",italic:"italic",underline:"underline",bullet:"insertUnorderedList",numbered:"insertOrderedList"};i.focus(),document.execCommand(r[t],!1),this.onEditorInput(e,i)}isAttendeeSelected(e){let t=this.meetingForm.get("attendees")?.value;return Array.isArray(t)&&t.includes(e)}toggleAttendee(e,t){let i=this.meetingForm.get("attendees")?.value||[],r=new Set(i);t?r.add(e):r.delete(e),this.meetingForm.patchValue({attendees:Array.from(r)}),this.meetingForm.get("attendees")?.markAsDirty(),this.meetingForm.get("attendees")?.updateValueAndValidity()}toggleMeeting(e){this.openMeetingId.update(t=>t===e?null:e)}openModal(e=null){this.editingMeeting.set(e),e?this.meetingForm.patchValue({date:e.date,title:e.title,attendees:e.attendeeIds,notes:e.notes,actionItems:e.actionItems}):this.meetingForm.reset({date:new Date().toISOString().split("T")[0]}),this.isModalOpen.set(!0),setTimeout(()=>this.syncEditorContents(),0)}closeModal(){this.isModalOpen.set(!1),this.editingMeeting.set(null)}async handleFormSubmit(){if(this.meetingForm.invalid)return;let e=this.meetingForm.value,t=this.editingMeeting(),i=(e.attendees||[]).map(r=>Number(r)).filter(r=>Number.isFinite(r)&&r>0);this.processing.set(!0);try{if(t){let r=await this.apiService.updateCollaborationMeeting({id:t.id,meetingDate:e.date,topic:e.title,meetingNotes:e.notes,actionItems:e.actionItems||"",decisions:"",attendeeEmployeeIds:i});if(!r.success)throw new Error(r.error||"\u66F4\u65B0\u5931\u6557")}else{let r=await this.apiService.createCollaborationMeeting({meetingDate:e.date,topic:e.title,meetingNotes:e.notes,actionItems:e.actionItems||"",decisions:"",attendeeEmployeeIds:i});if(!r.success)throw new Error(r.error||"\u65B0\u589E\u5931\u6557")}await this.loadMeetings(),this.closeModal()}catch(r){alert(r?.message||"\u5132\u5B58\u5931\u6557")}finally{this.processing.set(!1)}}requestDelete(e){this.meetingToDelete.set(e)}async confirmDelete(){if(this.meetingToDelete()){this.processing.set(!0);try{let e=this.meetingToDelete().id,t=await this.apiService.deleteCollaborationMeeting(e);if(!t.success)throw new Error(t.error||"\u522A\u9664\u5931\u6557");await this.loadMeetings(),this.cancelDelete()}catch(e){alert(e?.message||"\u522A\u9664\u5931\u6557")}finally{this.processing.set(!1)}}}cancelDelete(){this.meetingToDelete.set(null)}};is.\u0275fac=function(t){return new(t||is)},is.\u0275cmp=re({type:is,selectors:[["app-meeting"]],viewQuery:function(t,i){if(t&1&&(ut(MH,5),ut(AH,5)),t&2){let r;tt(r=nt())&&(i.notesAreaRef=r.first),tt(r=nt())&&(i.actionItemsAreaRef=r.first)}},decls:16,vars:5,consts:[["notesArea",""],["actionItemsArea",""],[1,"space-y-6"],[1,"flex","flex-wrap","items-center","justify-between","gap-4"],[1,"text-3xl","font-bold","text-gray-900"],[1,"bg-indigo-600","text-white","px-4","py-2","rounded-lg","font-medium","hover:bg-indigo-700","transition-colors","flex","items-center","gap-2","text-sm",3,"click"],["name","add-outline"],[1,"flex","items-center","gap-2","text-sm","text-indigo-600"],[1,"flex","items-center","gap-2","text-sm","text-amber-600"],[1,"space-y-4"],[1,"bg-white","rounded-xl","shadow-md","overflow-hidden","transition-shadow","hover:shadow-lg"],[1,"bg-white","p-6","rounded-xl","shadow-md","text-center","text-gray-500"],[1,"fixed","inset-0","bg-black","bg-opacity-50","flex","items-center","justify-center","z-50"],["name","reload-outline",1,"animate-spin"],[1,"p-4","flex","justify-between","items-center","cursor-pointer","hover:bg-gray-50",3,"click"],[1,"flex","items-center","gap-4"],[1,"text-center","w-12"],[1,"text-sm","font-semibold","text-red-600"],[1,"text-2xl","font-bold","text-gray-800"],[1,"font-semibold","text-gray-500","text-sm"],[1,"text-lg","font-bold","text-gray-800"],[1,"flex","items-center","gap-2"],["title","\u7DE8\u8F2F",1,"text-gray-500","hover:text-indigo-600","p-2","rounded-full","hover:bg-gray-100",3,"click"],["name","create-outline"],["title","\u522A\u9664",1,"text-gray-500","hover:text-red-600","p-2","rounded-full","hover:bg-gray-100",3,"click"],["name","trash-outline"],["name","chevron-down-outline",1,"text-gray-500","transition-transform"],[1,"p-6","border-t","bg-slate-50","space-y-4","text-sm"],[1,"grid","grid-cols-1","md:grid-cols-2","gap-4"],[1,"bg-white","p-4","rounded-lg","border"],[1,"font-semibold","text-gray-600","mb-2","flex","items-center","gap-2"],["name","people-outline"],[1,"text-gray-800","pl-8"],[1,"bg-yellow-50","p-4","rounded-lg","border","border-yellow-200","md:row-span-2"],["name","document-text-outline"],[1,"text-gray-800","pl-8","[&_ul]:list-disc","[&_ul]:pl-6","[&_ol]:list-decimal","[&_ol]:pl-6",3,"innerHTML"],[1,"font-semibold","text-yellow-800","mb-2","flex","items-center","gap-2"],["name","checkbox-outline"],[1,"text-yellow-900","pl-8","[&_ul]:list-disc","[&_ul]:pl-6","[&_ol]:list-decimal","[&_ol]:pl-6",3,"innerHTML"],[1,"bg-white","rounded-xl","shadow-2xl","w-full","max-w-2xl","max-h-[90vh]","flex","flex-col","m-4"],[1,"flex","justify-between","items-center","p-4","border-b"],[1,"text-lg","font-semibold"],[1,"text-gray-400","hover:text-gray-600",3,"click"],["name","close-outline",1,"text-2xl"],[1,"p-6","overflow-y-auto"],[1,"space-y-4",3,"ngSubmit","formGroup"],["for","date",1,"block","text-sm","font-medium","text-gray-700"],["type","date","id","date","formControlName","date",1,"mt-1","block","w-full","rounded-md","border-gray-300","shadow-sm","bg-gray-50","p-2"],[1,"md:col-span-2"],["for","title",1,"block","text-sm","font-medium","text-gray-700"],["type","text","id","title","formControlName","title",1,"mt-1","block","w-full","rounded-md","border-gray-300","shadow-sm","bg-gray-50","p-2"],["for","attendees",1,"block","text-sm","font-medium","text-gray-700"],[1,"mt-1","max-h-40","overflow-y-auto","rounded-md","border","border-gray-300","bg-gray-50","p-3","grid","grid-cols-1","md:grid-cols-2","gap-2"],[1,"flex","items-center","gap-2","text-sm","text-gray-700","cursor-pointer"],["for","notes",1,"block","text-sm","font-medium","text-gray-700"],[1,"mt-1","flex","items-center","gap-2","text-xs"],["type","button","title","\u7C97\u9AD4",1,"h-8","w-8","border","rounded","bg-white","flex","items-center","justify-center",3,"click"],["name","text-outline",1,"text-base"],["type","button","title","\u659C\u9AD4",1,"h-8","w-8","border","rounded","bg-white","flex","items-center","justify-center",3,"click"],["name","code-slash-outline",1,"text-base"],["type","button","title","\u5E95\u7DDA",1,"h-8","w-8","border","rounded","bg-white","flex","items-center","justify-center",3,"click"],["name","remove-outline",1,"text-base"],["type","button","title","\u9805\u76EE\u7B26\u865F",1,"h-8","w-8","border","rounded","bg-white","flex","items-center","justify-center",3,"click"],["name","list-outline",1,"text-base"],["type","button","title","\u9805\u76EE\u7DE8\u865F",1,"h-8","w-8","border","rounded","bg-white","flex","items-center","justify-center",3,"click"],["name","list-circle-outline",1,"text-base"],["id","notes","contenteditable","true",1,"mt-2","block","w-full","min-h-[120px]","rounded-md","border","border-gray-300","shadow-sm","bg-gray-50","p-2","[&_ul]:list-disc","[&_ul]:pl-6","[&_ol]:list-decimal","[&_ol]:pl-6",3,"input"],["for","actionItems",1,"block","text-sm","font-medium","text-gray-700"],["id","actionItems","contenteditable","true",1,"mt-2","block","w-full","min-h-[90px]","rounded-md","border","border-gray-300","shadow-sm","bg-gray-50","p-2","[&_ul]:list-disc","[&_ul]:pl-6","[&_ol]:list-decimal","[&_ol]:pl-6",3,"input"],[1,"flex","justify-end","gap-4","pt-4","border-t","mt-4"],["type","button",1,"px-4","py-2","border","rounded-md",3,"click"],["type","submit",1,"px-4","py-2","bg-indigo-600","text-white","rounded-md","disabled:bg-indigo-300","flex","items-center","gap-2",3,"disabled"],["type","checkbox",1,"h-4","w-4","rounded","border-gray-300","text-indigo-600","focus:ring-indigo-500",3,"change","checked"],[1,"bg-white","rounded-xl","shadow-2xl","w-full","max-w-md","m-4"],[1,"p-6","text-center"],[1,"mx-auto","flex","items-center","justify-center","h-12","w-12","rounded-full","bg-red-100"],["name","warning-outline",1,"h-6","w-6","text-red-600"],[1,"mt-4","text-lg","font-semibold","text-gray-900"],[1,"mt-2","text-sm","text-gray-500"],[1,"flex","justify-center","gap-4","bg-gray-50","px-6","py-4","rounded-b-xl"],["type","button",1,"px-4","py-2","bg-red-600","text-white","rounded-md","hover:bg-red-700","disabled:bg-red-300","flex","items-center","gap-2",3,"click","disabled"]],template:function(t,i){if(t&1&&(l(0,"div",2)(1,"div",3)(2,"h1",4),d(3,"\u6BCF\u5468\u6703\u8B70\u7D00\u9304"),s(),l(4,"button",5),b("click",function(){return i.openModal(null)}),x(5,"ion-icon",6),l(6,"span"),d(7,"\u65B0\u589E\u6BCF\u5468\u6703\u8B70"),s()()(),M(8,RH,4,0,"div",7),M(9,NH,4,0,"div",8),l(10,"div",9),V(11,kH,23,16,"div",10,xS,!1,VH,2,0,"div",11),s()(),M(14,BH,63,4,"div",12),M(15,$H,16,3,"div",12)),t&2){let r;m(8),A(i.loading()?8:-1),m(),A(i.processing()?9:-1),m(2),L(i.sortedMeetings()),m(3),A(i.isModalOpen()?14:-1),m(),A((r=i.meetingToDelete())?15:-1,r)}},dependencies:[se,Be,Ve,be,fe,ke,Le,Ue,ao],encapsulation:2,changeDetection:0});var Sp=is;var HH=["meetingNotesArea"],GH=["meetingActionItemsArea"],lu=(n,e)=>e.id;function qH(n,e){n&1&&(l(0,"div",10),x(1,"ion-icon",27),l(2,"span"),d(3,"\u8F09\u5165\u4E2D..."),s()())}function WH(n,e){n&1&&(l(0,"div",11),x(1,"ion-icon",27),l(2,"span"),d(3,"\u8655\u7406\u4E2D..."),s()())}function jH(n,e){if(n&1&&(l(0,"option",17),d(1),s()),n&2){let t=e.$implicit;I("value",t),m(),w(t)}}function zH(n,e){if(n&1&&(l(0,"option",17),d(1),s()),n&2){let t=e.$implicit;I("value",t.id),m(),w(t.name)}}function YH(n,e){if(n&1&&(l(0,"p",30),d(1),s()),n&2){let t=_().$implicit;m(),w(t.topic)}}function JH(n,e){if(n&1){let t=B();l(0,"div",40)(1,"div",42)(2,"span",43),d(3),s(),l(4,"div",44)(5,"button",45),b("click",function(){let r=E(t).$implicit,o=_(2).$implicit,a=_();return S(a.openRecordModal(o.id,r))}),x(6,"ion-icon",34),s(),l(7,"button",46),b("click",function(){let r=E(t).$implicit,o=_(2).$implicit,a=_();return S(a.requestDeleteRecord(o.id,r))}),x(8,"ion-icon",36),s()()(),l(9,"div",47)(10,"div",48),x(11,"ion-icon",49),l(12,"p",50),d(13),s()(),l(14,"div",51),x(15,"ion-icon",52),l(16,"p",53),d(17),s()()(),l(18,"div",54)(19,"div",5),x(20,"img",55),l(21,"span",56),d(22),s()(),l(23,"span",57),d(24),s()()()}if(n&2){let t=e.$implicit,i=_(3);m(2),Te(i.getCategoryClass(t.category)),m(),w(t.category),m(10),w(t.goal),m(4),w(t.progress),m(3),I("src",i.getShareholderAvatarUrl(t.assigneeId),qt),m(2),w(i.getShareholderName(t.assigneeId)),m(2),w(t.lastUpdated.split(" ")[0])}}function KH(n,e){n&1&&(l(0,"div",41),d(1,"\u6B64\u65E5\u671F\u5C1A\u7121\u9032\u5EA6\u5831\u544A\uFF0C\u9EDE\u64CA\u300C\u65B0\u589E\u9032\u5EA6\u300D\u4F86\u5EFA\u7ACB\u7B2C\u4E00\u7B46\u3002"),s())}function QH(n,e){if(n&1&&(l(0,"div",38)(1,"div",39),V(2,JH,25,8,"div",40,lu,!1,KH,2,0,"div",41),s()()),n&2){let t=_().$implicit;m(2),L(t.records)}}function ZH(n,e){if(n&1){let t=B();l(0,"div",24)(1,"div",28),b("click",function(){let r=E(t).$implicit,o=_();return S(o.toggleMeeting(r.id))}),l(2,"div")(3,"h3",29),d(4),s(),M(5,YH,2,1,"p",30),s(),l(6,"div",5)(7,"button",31),b("click",function(r){let o=E(t).$implicit,a=_();return r.stopPropagation(),S(a.openRecordModal(o.id,null))}),x(8,"ion-icon",32),l(9,"span"),d(10,"\u65B0\u589E\u9032\u5EA6"),s()(),l(11,"button",33),b("click",function(r){let o=E(t).$implicit,a=_();return r.stopPropagation(),S(a.openMeetingModal(o))}),x(12,"ion-icon",34),s(),l(13,"button",35),b("click",function(r){let o=E(t).$implicit,a=_();return r.stopPropagation(),S(a.requestDeleteMeeting(o))}),x(14,"ion-icon",36),s(),x(15,"ion-icon",37),s()(),M(16,QH,5,1,"div",38),s()}if(n&2){let t=e.$implicit,i=_();m(4),w(t.date),m(),A(t.topic?5:-1),m(10),j("rotate-180",i.openMeetingId()===t.id),m(),A(i.openMeetingId()===t.id?16:-1)}}function XH(n,e){n&1&&(l(0,"div",25),d(1,"\u7121\u7B26\u5408\u7BE9\u9078\u689D\u4EF6\u7684\u6703\u8B70\u7D00\u9304\u3002"),s())}function eG(n,e){if(n&1){let t=B();l(0,"label",71)(1,"input",90),b("change",function(r){let o=E(t).$implicit,a=_(2);return S(a.toggleMeetingAttendee(+o.id,r.target.checked))}),s(),l(2,"span"),d(3),s()()}if(n&2){let t=e.$implicit,i=_(2);m(),I("checked",i.isMeetingAttendeeSelected(+t.id)),m(2),w(t.name)}}function tG(n,e){n&1&&x(0,"ion-icon",27)}function nG(n,e){if(n&1){let t=B();l(0,"div",26)(1,"div",58)(2,"div",59)(3,"h3",60),d(4),s(),l(5,"button",61),b("click",function(){E(t);let r=_();return S(r.closeMeetingModal())}),x(6,"ion-icon",62),s()(),l(7,"div",63)(8,"form",64),b("ngSubmit",function(){E(t);let r=_();return S(r.handleMeetingSubmit())}),l(9,"div")(10,"label",65),d(11,"\u65E5\u671F*"),s(),x(12,"input",66),s(),l(13,"div")(14,"label",67),d(15,"\u4E3B\u984C*"),s(),x(16,"input",68),s(),l(17,"div")(18,"label",69),d(19,"\u8207\u6703\u8005*"),s(),l(20,"div",70),V(21,eG,4,2,"label",71,lu),s()(),l(23,"div")(24,"label",72),d(25,"\u6703\u8B70\u8A18\u9304*"),s(),l(26,"div",73)(27,"button",74),b("click",function(){E(t);let r=oe(38),o=_();return S(o.applyMeetingTextFormat("meetingNotes","bold",r))}),x(28,"ion-icon",75),s(),l(29,"button",76),b("click",function(){E(t);let r=oe(38),o=_();return S(o.applyMeetingTextFormat("meetingNotes","italic",r))}),x(30,"ion-icon",77),s(),l(31,"button",78),b("click",function(){E(t);let r=oe(38),o=_();return S(o.applyMeetingTextFormat("meetingNotes","underline",r))}),x(32,"ion-icon",79),s(),l(33,"button",80),b("click",function(){E(t);let r=oe(38),o=_();return S(o.applyMeetingTextFormat("meetingNotes","bullet",r))}),x(34,"ion-icon",81),s(),l(35,"button",82),b("click",function(){E(t);let r=oe(38),o=_();return S(o.applyMeetingTextFormat("meetingNotes","numbered",r))}),x(36,"ion-icon",83),s()(),l(37,"div",84,0),b("input",function(){E(t);let r=oe(38),o=_();return S(o.onMeetingEditorInput("meetingNotes",r))}),s()(),l(39,"div")(40,"label",85),d(41,"\u884C\u52D5\u4E8B\u9805*"),s(),l(42,"div",73)(43,"button",74),b("click",function(){E(t);let r=oe(54),o=_();return S(o.applyMeetingTextFormat("actionItems","bold",r))}),x(44,"ion-icon",75),s(),l(45,"button",76),b("click",function(){E(t);let r=oe(54),o=_();return S(o.applyMeetingTextFormat("actionItems","italic",r))}),x(46,"ion-icon",77),s(),l(47,"button",78),b("click",function(){E(t);let r=oe(54),o=_();return S(o.applyMeetingTextFormat("actionItems","underline",r))}),x(48,"ion-icon",79),s(),l(49,"button",80),b("click",function(){E(t);let r=oe(54),o=_();return S(o.applyMeetingTextFormat("actionItems","bullet",r))}),x(50,"ion-icon",81),s(),l(51,"button",82),b("click",function(){E(t);let r=oe(54),o=_();return S(o.applyMeetingTextFormat("actionItems","numbered",r))}),x(52,"ion-icon",83),s()(),l(53,"div",86,1),b("input",function(){E(t);let r=oe(54),o=_();return S(o.onMeetingEditorInput("actionItems",r))}),s()(),l(55,"div",87)(56,"button",88),b("click",function(){E(t);let r=_();return S(r.closeMeetingModal())}),d(57,"\u53D6\u6D88"),s(),l(58,"button",89),M(59,tG,1,0,"ion-icon",27),l(60,"span"),d(61,"\u5132\u5B58"),s()()()()()()()}if(n&2){let t=_();m(4),w(t.editingMeeting()?"\u7DE8\u8F2F\u7D00\u9304\u65E5\u671F":"\u65B0\u589E\u7D00\u9304\u65E5\u671F"),m(4),I("formGroup",t.meetingForm),m(13),L(t.shareholders()),m(37),I("disabled",t.meetingForm.invalid||t.processing()),m(),A(t.processing()?59:-1)}}function iG(n,e){if(n&1&&(l(0,"option",17),d(1),s()),n&2){let t=e.$implicit;I("value",t),m(),w(t)}}function rG(n,e){if(n&1&&(l(0,"option",17),d(1),s()),n&2){let t=e.$implicit;I("value",t.id),m(),w(t.name)}}function oG(n,e){n&1&&x(0,"ion-icon",27)}function aG(n,e){if(n&1){let t=B();l(0,"div",26)(1,"div",91)(2,"div",59)(3,"h3",60),d(4),s(),l(5,"button",61),b("click",function(){E(t);let r=_();return S(r.closeRecordModal())}),x(6,"ion-icon",62),s()(),l(7,"div",63)(8,"form",64),b("ngSubmit",function(){E(t);let r=_();return S(r.handleRecordFormSubmit())}),l(9,"div")(10,"label",92),d(11,"\u5206\u985E*"),s(),l(12,"select",93)(13,"option",94),d(14,"\u8ACB\u9078\u64C7\u5206\u985E"),s(),V(15,iG,2,2,"option",17,Y),s()(),l(17,"div")(18,"label",95),d(19,"\u76EE\u6A19*"),s(),x(20,"textarea",96),s(),l(21,"div")(22,"label",97),d(23,"\u9032\u5EA6*"),s(),x(24,"textarea",98),s(),l(25,"div")(26,"label",99),d(27,"\u8CA0\u8CAC\u4EBA*"),s(),l(28,"select",100)(29,"option",94),d(30,"\u8ACB\u9078\u64C7"),s(),V(31,rG,2,2,"option",17,lu),s()(),l(33,"div",87)(34,"button",88),b("click",function(){E(t);let r=_();return S(r.closeRecordModal())}),d(35,"\u53D6\u6D88"),s(),l(36,"button",89),M(37,oG,1,0,"ion-icon",27),l(38,"span"),d(39,"\u5132\u5B58"),s()()()()()()()}if(n&2){let t,i=_();m(4),w((t=i.editingRecord())!=null&&t.record?"\u7DE8\u8F2F\u9032\u5EA6":"\u65B0\u589E\u9032\u5EA6"),m(4),I("formGroup",i.recordForm),m(7),L(i.recordCategories),m(16),L(i.shareholders()),m(5),I("disabled",i.recordForm.invalid||i.processing()),m(),A(i.processing()?37:-1)}}function sG(n,e){if(n&1){let t=B();l(0,"div",104),x(1,"input",108),l(2,"button",109),b("click",function(){let r=E(t).$index,o=_(2);return S(o.removeShareholder(r))}),x(3,"ion-icon",110),s()()}if(n&2){let t=e.$index;I("formGroupName",t)}}function lG(n,e){if(n&1){let t=B();l(0,"div",26)(1,"div",101)(2,"div",59)(3,"h3",60),d(4,"\u7BA1\u7406\u4EBA\u54E1"),s(),l(5,"button",61),b("click",function(){E(t);let r=_();return S(r.closeShareholderModal())}),x(6,"ion-icon",62),s()(),l(7,"div",63)(8,"form",102),b("ngSubmit",function(){E(t);let r=_();return S(r.saveShareholders())}),l(9,"div",103),V(10,sG,4,1,"div",104,sn),s(),l(12,"button",105),b("click",function(){E(t);let r=_();return S(r.addShareholder())}),d(13,"+ \u65B0\u589E\u4EBA\u54E1"),s(),l(14,"div",106)(15,"button",88),b("click",function(){E(t);let r=_();return S(r.closeShareholderModal())}),d(16,"\u53D6\u6D88"),s(),l(17,"button",107),d(18,"\u5132\u5B58\u8B8A\u66F4"),s()()()()()()}if(n&2){let t=_();m(8),I("formGroup",t.shareholderForm),m(2),L(t.shareholderControls),m(7),I("disabled",t.shareholderForm.invalid)}}function uG(n,e){n&1&&x(0,"ion-icon",27)}function dG(n,e){if(n&1){let t=B();l(0,"div",26)(1,"div",111)(2,"div",112)(3,"div",113),x(4,"ion-icon",114),s(),l(5,"h3",115),d(6,"\u78BA\u5B9A\u8981\u522A\u9664\u55CE\uFF1F"),s(),l(7,"p",116),d(8),s()(),l(9,"div",117)(10,"button",88),b("click",function(){E(t);let r=_();return S(r.cancelDeleteMeeting())}),d(11,"\u53D6\u6D88"),s(),l(12,"button",118),b("click",function(){E(t);let r=_();return S(r.confirmDeleteMeeting())}),M(13,uG,1,0,"ion-icon",27),l(14,"span"),d(15,"\u78BA\u8A8D\u522A\u9664"),s()()()()()}if(n&2){let t=_();m(8),N("\u60A8\u78BA\u5B9A\u8981\u522A\u9664\u65E5\u671F\u70BA\u300C",e.date,"\u300D\u7684\u7D00\u9304\u53CA\u5176\u6240\u6709\u9032\u5EA6\u5831\u544A\u55CE\uFF1F\u6B64\u64CD\u4F5C\u7121\u6CD5\u5FA9\u539F\u3002"),m(4),I("disabled",t.processing()),m(),A(t.processing()?13:-1)}}function cG(n,e){n&1&&x(0,"ion-icon",27)}function mG(n,e){if(n&1){let t=B();l(0,"div",26)(1,"div",111)(2,"div",112)(3,"div",113),x(4,"ion-icon",114),s(),l(5,"h3",115),d(6,"\u78BA\u5B9A\u8981\u522A\u9664\u55CE\uFF1F"),s(),l(7,"p",116),d(8),s()(),l(9,"div",117)(10,"button",88),b("click",function(){E(t);let r=_();return S(r.cancelDeleteRecord())}),d(11,"\u53D6\u6D88"),s(),l(12,"button",118),b("click",function(){E(t);let r=_();return S(r.confirmDeleteRecord())}),M(13,cG,1,0,"ion-icon",27),l(14,"span"),d(15,"\u78BA\u8A8D\u522A\u9664"),s()()()()()}if(n&2){let t=_();m(8),N("\u60A8\u78BA\u5B9A\u8981\u522A\u9664\u76EE\u6A19\u70BA\u300C",e.record.goal,"\u300D\u7684\u9019\u7B46\u9032\u5EA6\u5831\u544A\u55CE\uFF1F\u6B64\u64CD\u4F5C\u7121\u6CD5\u5FA9\u539F\u3002"),m(4),I("disabled",t.processing()),m(),A(t.processing()?13:-1)}}var rs=class rs{constructor(){this.apiService=k(we);this.fb=k(qe);this.isRecordModalOpen=D(!1);this.isShareholderModalOpen=D(!1);this.isMeetingModalOpen=D(!1);this.editingRecord=D(null);this.editingMeeting=D(null);this.openMeetingId=D(null);this.categoryFilter=D("");this.assigneeFilter=D("");this.loading=D(!1);this.processing=D(!1);this.shareholders=D([]);this.meetingProgresses=D([]);this.recordCategories=["\u5E97\u5167","\u8CA1\u52D9","\u6D3B\u52D5","\u884C\u92B7","\u7CFB\u7D71","\u6703\u54E1","\u52A0\u76DF"];this.categories=$(()=>{let e=this.meetingProgresses().flatMap(t=>t.records);return[...new Set(e.map(t=>t.category))].sort()});this.sortedMeetings=$(()=>this.meetingProgresses().slice().sort((e,t)=>new Date(t.date).getTime()-new Date(e.date).getTime()));this.filteredMeetings=$(()=>{let e=this.categoryFilter(),t=this.assigneeFilter(),i=this.sortedMeetings();return!e&&!t?i:i.map(r=>G(O({},r),{records:r.records.filter(o=>!e||o.category===e).filter(o=>!t||o.assigneeId===t)})).filter(r=>r.records.length>0)});this.meetingForm=this.fb.group({date:["",U.required],topic:["",U.required],attendees:[[],U.required],meetingNotes:["",U.required],actionItems:["",U.required]});this.recordForm=this.fb.group({category:["",U.required],goal:["",U.required],progress:["",U.required],assigneeId:["",U.required]});this.meetingToDelete=D(null);this.recordToDelete=D(null);this.shareholderForm=this.fb.group({shareholders:this.fb.array([])});this.loadData()}formatDateTime(e){if(!e)return"";let t=new Date(e);return Number.isNaN(t.getTime())?String(e):t.toLocaleString("zh-TW",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit",hour12:!1}).replace(/\//g,"-")}parseCategory(e){let t=e||"",i=t.match(/^\[(.+?)\]\s*(.*)$/);return i?{category:i[1],progress:i[2]||""}:{category:"\u5176\u4ED6",progress:t}}buildSummary(e,t){return`[${e}] ${t}`.trim()}parseMeetingBlockers(e){let t=String(e||""),i=t.match(/ATTENDEES:([^\n]*)/),r=t.match(/ACTION_ITEMS:\n([\s\S]*)$/);return{attendeeIds:(i?.[1]||"").split(",").map(a=>Number(a.trim())).filter(a=>Number.isFinite(a)&&a>0),actionItems:(r?.[1]||"").trim()}}buildMeetingBlockers(e,t){return`ATTENDEES:${e.join(",")}
ACTION_ITEMS:
${t||""}`.trim()}onMeetingEditorInput(e,t){this.meetingForm.patchValue({[e]:t.innerHTML||""})}syncMeetingEditorContents(){let e=this.meetingForm.get("meetingNotes")?.value||"",t=this.meetingForm.get("actionItems")?.value||"";this.meetingNotesAreaRef?.nativeElement&&(this.meetingNotesAreaRef.nativeElement.innerHTML=String(e)),this.meetingActionItemsAreaRef?.nativeElement&&(this.meetingActionItemsAreaRef.nativeElement.innerHTML=String(t))}applyMeetingTextFormat(e,t,i){let r={bold:"bold",italic:"italic",underline:"underline",bullet:"insertUnorderedList",numbered:"insertOrderedList"};i.focus(),document.execCommand(r[t],!1),this.onMeetingEditorInput(e,i)}getWeekEndDate(e){let t=new Date(e);return t.setDate(t.getDate()+6),t.toISOString().split("T")[0]}async loadData(){this.loading.set(!0);try{let[e,t]=await Promise.all([this.apiService.getEmployeeInfo(),this.apiService.getCollaborationWeeklyProgress()]);if(e.success&&e.data&&this.shareholders.set(e.data.map(i=>({id:String(i.id),name:i.employee_name}))),t.success&&t.data){let i=t.data,r=new Map;i.forEach(o=>{let a=o.weekStartDate?String(o.weekStartDate).split("T")[0]:"",u=this.parseCategory(o.progressSummary);r.has(a)||r.set(a,{id:a,date:a,topic:"",attendeeIds:[],meetingNotes:"",actionItems:"",metaRecordId:null,records:[]});let c=r.get(a);if(u.category==="\u6703\u8B70\u7D00\u9304"){let g=this.parseMeetingBlockers(o.blockers);c.topic=o.nextWeekPlan||"",c.meetingNotes=u.progress||"",c.actionItems=g.actionItems,c.attendeeIds=g.attendeeIds,c.metaRecordId=Number(o.id);return}let p={id:String(o.id),weeklyId:Number(o.id),category:u.category,goal:o.nextWeekPlan||"",progress:u.progress,assigneeId:String(o.ownerEmployeeId),lastUpdated:this.formatDateTime(o.updatedAt||o.createdAt)};c.records.push(p)}),this.meetingProgresses.set(Array.from(r.values()))}}catch(e){console.error(e),alert(e?.message||"\u8F09\u5165\u6BCF\u5468\u9032\u5EA6\u5931\u6557")}finally{this.loading.set(!1)}}getShareholderName(e){return this.shareholders().find(t=>t.id===e)?.name||"\u672A\u77E5"}getShareholderAvatarUrl(e){let t=this.getShareholderName(e);return`https://ui-avatars.com/api/?name=${encodeURIComponent(t)}&background=random&color=fff&font-size=0.5`}getCategoryClass(e){return{\u8CA1\u52D9:"bg-blue-100 text-blue-800",\u516C\u95DC:"bg-purple-100 text-purple-800",\u71DF\u904B:"bg-green-100 text-green-800",\u6D3B\u52D5:"bg-yellow-100 text-yellow-800"}[e]||"bg-gray-100 text-gray-800"}toggleMeeting(e){this.openMeetingId.update(t=>t===e?null:e)}isMeetingAttendeeSelected(e){let t=this.meetingForm.get("attendees")?.value;return Array.isArray(t)&&t.includes(e)}toggleMeetingAttendee(e,t){let i=this.meetingForm.get("attendees")?.value||[],r=new Set(i);t?r.add(e):r.delete(e),this.meetingForm.patchValue({attendees:Array.from(r)}),this.meetingForm.get("attendees")?.markAsDirty(),this.meetingForm.get("attendees")?.updateValueAndValidity()}openMeetingModal(e=null){this.editingMeeting.set(e),e?this.meetingForm.patchValue({date:e.date,topic:e.topic,attendees:e.attendeeIds,meetingNotes:e.meetingNotes,actionItems:e.actionItems}):this.meetingForm.reset({date:new Date().toISOString().split("T")[0],topic:"",attendees:[],meetingNotes:"",actionItems:""}),this.isMeetingModalOpen.set(!0),setTimeout(()=>this.syncMeetingEditorContents(),0)}closeMeetingModal(){this.isMeetingModalOpen.set(!1)}async handleMeetingSubmit(){if(this.meetingForm.invalid)return;let e=this.meetingForm.value,t=this.editingMeeting(),i=(e.attendees||[]).map(r=>Number(r)).filter(r=>Number.isFinite(r)&&r>0);this.processing.set(!0);try{if(t){t.metaRecordId?await this.apiService.updateCollaborationWeeklyProgress({id:t.metaRecordId,ownerEmployeeId:i[0]||Number(this.shareholders()[0]?.id||0),weekStartDate:e.date,weekEndDate:this.getWeekEndDate(e.date),progressSummary:this.buildSummary("\u6703\u8B70\u7D00\u9304",e.meetingNotes||""),blockers:this.buildMeetingBlockers(i,e.actionItems||""),nextWeekPlan:e.topic||"",completionRate:0}):await this.apiService.createCollaborationWeeklyProgress({ownerEmployeeId:i[0]||Number(this.shareholders()[0]?.id||0),weekStartDate:e.date,weekEndDate:this.getWeekEndDate(e.date),progressSummary:this.buildSummary("\u6703\u8B70\u7D00\u9304",e.meetingNotes||""),blockers:this.buildMeetingBlockers(i,e.actionItems||""),nextWeekPlan:e.topic||"",completionRate:0});for(let r of t.records)await this.apiService.updateCollaborationWeeklyProgress({id:r.weeklyId,weekStartDate:e.date,weekEndDate:this.getWeekEndDate(e.date)});await this.loadData()}else if(!this.meetingProgresses().some(o=>o.date===e.date)){let o=i[0]||Number(this.shareholders()[0]?.id||0);if(!o)throw new Error("\u67E5\u7121\u53EF\u7528\u4EBA\u54E1\uFF0C\u8ACB\u5148\u5EFA\u7ACB\u4EBA\u54E1\u8CC7\u6599");await this.apiService.createCollaborationWeeklyProgress({ownerEmployeeId:Number(o),weekStartDate:e.date,weekEndDate:this.getWeekEndDate(e.date),progressSummary:this.buildSummary("\u6703\u8B70\u7D00\u9304",e.meetingNotes||""),blockers:this.buildMeetingBlockers(i,e.actionItems||""),nextWeekPlan:e.topic||"",completionRate:0}),await this.loadData(),this.openMeetingId.set(e.date)}}catch(r){alert(r?.message||"\u5132\u5B58\u65E5\u671F\u5931\u6557")}finally{this.processing.set(!1)}this.closeMeetingModal()}openRecordModal(e,t=null){t?(this.editingRecord.set({record:t,meetingId:e}),this.recordForm.patchValue(t)):(this.editingRecord.set({record:null,meetingId:e}),this.recordForm.reset({assigneeId:""})),this.isRecordModalOpen.set(!0)}closeRecordModal(){this.isRecordModalOpen.set(!1),this.editingRecord.set(null)}async handleRecordFormSubmit(){if(this.recordForm.invalid)return;let e=this.editingRecord();if(!e)return;let{record:t,meetingId:i}=e,r=this.recordForm.value,o={category:r.category,goal:r.goal,progress:r.progress,assigneeId:r.assigneeId,lastUpdated:new Date().toLocaleString("zh-TW",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit",hour12:!1}).replace(/\//g,"-")};this.processing.set(!0);try{t?await this.apiService.updateCollaborationWeeklyProgress({id:Number(t.id),ownerEmployeeId:Number(o.assigneeId),weekStartDate:i,weekEndDate:this.getWeekEndDate(i),progressSummary:this.buildSummary(o.category,o.progress),nextWeekPlan:o.goal}):await this.apiService.createCollaborationWeeklyProgress({ownerEmployeeId:Number(o.assigneeId),weekStartDate:i,weekEndDate:this.getWeekEndDate(i),progressSummary:this.buildSummary(o.category,o.progress),nextWeekPlan:o.goal,completionRate:0}),await this.loadData(),this.openMeetingId.set(i),this.closeRecordModal()}catch(a){alert(a?.message||"\u5132\u5B58\u9032\u5EA6\u5931\u6557")}finally{this.processing.set(!1)}}resetFilters(){this.categoryFilter.set(""),this.assigneeFilter.set("")}requestDeleteMeeting(e){this.meetingToDelete.set(e)}async confirmDeleteMeeting(){if(this.meetingToDelete()){this.processing.set(!0);try{let e=this.meetingToDelete();for(let t of e.records)await this.apiService.deleteCollaborationWeeklyProgress(t.weeklyId);await this.loadData(),this.cancelDeleteMeeting()}catch(e){alert(e?.message||"\u522A\u9664\u5931\u6557")}finally{this.processing.set(!1)}}}cancelDeleteMeeting(){this.meetingToDelete.set(null)}requestDeleteRecord(e,t){this.recordToDelete.set({meetingId:e,record:t})}async confirmDeleteRecord(){if(this.recordToDelete()){this.processing.set(!0);try{let{meetingId:e,record:t}=this.recordToDelete();await this.apiService.deleteCollaborationWeeklyProgress(t.weeklyId),await this.loadData(),this.openMeetingId.set(e),this.cancelDeleteRecord()}catch(e){alert(e?.message||"\u522A\u9664\u5931\u6557")}finally{this.processing.set(!1)}}}cancelDeleteRecord(){this.recordToDelete.set(null)}get shareholderControls(){return this.shareholderForm.get("shareholders").controls}openShareholderModal(){let e=this.shareholderForm.get("shareholders");e.clear(),this.shareholders().map(i=>this.fb.group({id:[i.id],name:[i.name,U.required]})).forEach(i=>e.push(i)),this.isShareholderModalOpen.set(!0)}closeShareholderModal(){this.isShareholderModalOpen.set(!1)}addShareholder(){this.shareholderForm.get("shareholders").push(this.fb.group({id:[`sh${Date.now()}`],name:["",U.required]}))}removeShareholder(e){this.shareholderForm.get("shareholders").removeAt(e)}saveShareholders(){this.shareholderForm.invalid||(this.shareholders.set(this.shareholderForm.value.shareholders),this.closeShareholderModal())}};rs.\u0275fac=function(t){return new(t||rs)},rs.\u0275cmp=re({type:rs,selectors:[["app-shareholder-records"]],viewQuery:function(t,i){if(t&1&&(ut(HH,5),ut(GH,5)),t&2){let r;tt(r=nt())&&(i.meetingNotesAreaRef=r.first),tt(r=nt())&&(i.meetingActionItemsAreaRef=r.first)}},decls:45,vars:10,consts:[["meetingNotesArea",""],["meetingActionItemsArea",""],[1,"space-y-6"],[1,"flex","flex-wrap","items-center","justify-between","gap-4"],[1,"text-3xl","font-bold","text-gray-900"],[1,"flex","items-center","gap-2"],[1,"bg-indigo-600","text-white","px-4","py-2","rounded-lg","font-medium","hover:bg-indigo-700","transition-colors","flex","items-center","gap-2","text-sm",3,"click"],["name","calendar-outline"],[1,"bg-gray-700","text-white","px-4","py-2","rounded-lg","font-medium","hover:bg-gray-800","transition-colors","flex","items-center","gap-2","text-sm",3,"click"],["name","people-outline"],[1,"flex","items-center","gap-2","text-sm","text-indigo-600"],[1,"flex","items-center","gap-2","text-sm","text-amber-600"],[1,"bg-white","p-6","rounded-xl","shadow-md"],[1,"grid","grid-cols-1","md:grid-cols-3","gap-4","p-4","bg-gray-50","rounded-lg","mb-6"],["for","categoryFilter",1,"text-sm","font-medium","text-gray-600"],["id","categoryFilter",1,"w-full","mt-1","border-gray-300","rounded-lg","shadow-sm","focus:ring-indigo-500","focus:border-indigo-500","text-sm","p-2","bg-white",3,"ngModelChange","ngModel"],["value",""],[3,"value"],["for","assigneeFilter",1,"text-sm","font-medium","text-gray-600"],["id","assigneeFilter",1,"w-full","mt-1","border-gray-300","rounded-lg","shadow-sm","focus:ring-indigo-500","focus:border-indigo-500","text-sm","p-2","bg-white",3,"ngModelChange","ngModel"],[1,"flex","items-end","justify-end"],["title","\u91CD\u8A2D\u7BE9\u9078",1,"text-gray-500","hover:text-gray-800","transition-colors","p-2","rounded-full","bg-gray-100","hover:bg-gray-200",3,"click"],["name","refresh-outline",1,"text-xl"],[1,"space-y-4"],[1,"bg-white","rounded-xl","border","border-gray-200","overflow-hidden","transition-shadow","hover:shadow-md"],[1,"text-center","py-8","text-gray-500"],[1,"fixed","inset-0","bg-black","bg-opacity-50","flex","items-center","justify-center","z-50"],["name","reload-outline",1,"animate-spin"],[1,"p-4","flex","justify-between","items-center","cursor-pointer","hover:bg-gray-50",3,"click"],[1,"text-lg","font-bold","text-gray-800"],[1,"text-sm","text-gray-500","mt-0.5"],[1,"bg-indigo-500","text-white","px-3","py-1","rounded-md","font-medium","hover:bg-indigo-600","flex","items-center","gap-1","text-xs",3,"click"],["name","add-outline"],["title","\u7DE8\u8F2F\u65E5\u671F",1,"text-gray-500","hover:text-indigo-600","p-2","rounded-full","hover:bg-gray-200",3,"click"],["name","create-outline"],["title","\u522A\u9664\u6B64\u65E5\u671F\u6240\u6709\u7D00\u9304",1,"text-gray-500","hover:text-red-600","p-2","rounded-full","hover:bg-gray-200",3,"click"],["name","trash-outline"],["name","chevron-down-outline",1,"text-gray-500","transition-transform"],[1,"p-4","bg-slate-50","border-t"],[1,"grid","grid-cols-1","md:grid-cols-2","lg:grid-cols-3","gap-4"],[1,"bg-white","rounded-lg","border","p-4","flex","flex-col","group","relative","hover:border-indigo-300","transition-colors","duration-200"],[1,"md:col-span-2","lg:col-span-3","text-center","py-6","text-gray-500"],[1,"flex","justify-between","items-start"],[1,"px-2","py-1","text-xs","font-semibold","rounded-full"],[1,"flex","items-center","gap-1","opacity-0","group-hover:opacity-100","transition-opacity"],["title","\u7DE8\u8F2F",1,"text-gray-400","hover:text-indigo-600","p-1.5","rounded-full","hover:bg-gray-100",3,"click"],["title","\u522A\u9664",1,"text-gray-400","hover:text-red-600","p-1.5","rounded-full","hover:bg-gray-100",3,"click"],[1,"mt-3","flex-grow"],[1,"flex","items-start","gap-2"],["name","golf-outline",1,"text-indigo-500","mt-1"],[1,"font-semibold","text-gray-800"],[1,"flex","items-start","gap-2","mt-2"],["name","analytics-outline",1,"text-gray-500","mt-1"],[1,"text-gray-600","text-sm","flex-grow"],[1,"flex","justify-between","items-center","mt-4","pt-3","border-t"],["alt","avatar",1,"w-6","h-6","rounded-full",3,"src"],[1,"text-xs","font-medium","text-gray-700"],[1,"text-xs","text-gray-400"],[1,"bg-white","rounded-xl","shadow-2xl","w-full","max-w-2xl","max-h-[90vh]","flex","flex-col","m-4"],[1,"flex","justify-between","items-center","p-4","border-b"],[1,"text-lg","font-semibold"],[1,"text-gray-400","hover:text-gray-600",3,"click"],["name","close-outline",1,"text-2xl"],[1,"p-6","overflow-y-auto"],[1,"space-y-4",3,"ngSubmit","formGroup"],["for","date",1,"block","text-sm","font-medium","text-gray-700"],["type","date","id","date","formControlName","date",1,"mt-1","block","w-full","rounded-md","border-gray-300","shadow-sm","bg-gray-50","p-2"],["for","topic",1,"block","text-sm","font-medium","text-gray-700"],["type","text","id","topic","formControlName","topic",1,"mt-1","block","w-full","rounded-md","border-gray-300","shadow-sm","bg-gray-50","p-2"],[1,"block","text-sm","font-medium","text-gray-700"],[1,"mt-1","max-h-40","overflow-y-auto","rounded-md","border","border-gray-300","bg-gray-50","p-3","grid","grid-cols-1","md:grid-cols-2","gap-2"],[1,"flex","items-center","gap-2","text-sm","text-gray-700","cursor-pointer"],["for","meetingNotes",1,"block","text-sm","font-medium","text-gray-700"],[1,"mt-1","flex","items-center","gap-2","text-xs"],["type","button","title","\u7C97\u9AD4",1,"h-8","w-8","border","rounded","bg-white","flex","items-center","justify-center",3,"click"],["name","text-outline",1,"text-base"],["type","button","title","\u659C\u9AD4",1,"h-8","w-8","border","rounded","bg-white","flex","items-center","justify-center",3,"click"],["name","code-slash-outline",1,"text-base"],["type","button","title","\u5E95\u7DDA",1,"h-8","w-8","border","rounded","bg-white","flex","items-center","justify-center",3,"click"],["name","remove-outline",1,"text-base"],["type","button","title","\u9805\u76EE\u7B26\u865F",1,"h-8","w-8","border","rounded","bg-white","flex","items-center","justify-center",3,"click"],["name","list-outline",1,"text-base"],["type","button","title","\u9805\u76EE\u7DE8\u865F",1,"h-8","w-8","border","rounded","bg-white","flex","items-center","justify-center",3,"click"],["name","list-circle-outline",1,"text-base"],["id","meetingNotes","contenteditable","true",1,"mt-2","block","w-full","min-h-[110px]","rounded-md","border","border-gray-300","shadow-sm","bg-gray-50","p-2","[&_ul]:list-disc","[&_ul]:pl-6","[&_ol]:list-decimal","[&_ol]:pl-6",3,"input"],["for","meetingActionItems",1,"block","text-sm","font-medium","text-gray-700"],["id","meetingActionItems","contenteditable","true",1,"mt-2","block","w-full","min-h-[110px]","rounded-md","border","border-gray-300","shadow-sm","bg-gray-50","p-2","[&_ul]:list-disc","[&_ul]:pl-6","[&_ol]:list-decimal","[&_ol]:pl-6",3,"input"],[1,"flex","justify-end","gap-4","pt-4","border-t","mt-4"],["type","button",1,"px-4","py-2","border","rounded-md",3,"click"],["type","submit",1,"px-4","py-2","bg-indigo-600","text-white","rounded-md","disabled:bg-indigo-300","flex","items-center","gap-2",3,"disabled"],["type","checkbox",1,"h-4","w-4","rounded","border-gray-300","text-indigo-600","focus:ring-indigo-500",3,"change","checked"],[1,"bg-white","rounded-xl","shadow-2xl","w-full","max-w-lg","max-h-[90vh]","flex","flex-col","m-4"],["for","category",1,"block","text-sm","font-medium","text-gray-700"],["id","category","formControlName","category",1,"mt-1","block","w-full","rounded-md","border-gray-300","shadow-sm","bg-gray-50","p-2"],["value","","disabled",""],["for","goal",1,"block","text-sm","font-medium","text-gray-700"],["id","goal","formControlName","goal","rows","2",1,"mt-1","block","w-full","rounded-md","border-gray-300","shadow-sm","bg-gray-50","p-2"],["for","progress",1,"block","text-sm","font-medium","text-gray-700"],["id","progress","formControlName","progress","rows","3",1,"mt-1","block","w-full","rounded-md","border-gray-300","shadow-sm","bg-gray-50","p-2"],["for","assigneeId",1,"block","text-sm","font-medium","text-gray-700"],["id","assigneeId","formControlName","assigneeId",1,"mt-1","block","w-full","rounded-md","border-gray-300","shadow-sm","bg-gray-50","p-2"],[1,"bg-white","rounded-xl","shadow-2xl","w-full","max-w-md","max-h-[90vh]","flex","flex-col","m-4"],[3,"ngSubmit","formGroup"],["formArrayName","shareholders",1,"space-y-3"],[1,"flex","items-center","gap-2",3,"formGroupName"],["type","button",1,"mt-4","text-sm","text-indigo-600","font-medium",3,"click"],[1,"flex","justify-end","gap-4","pt-4","border-t","mt-6"],["type","submit",1,"px-4","py-2","bg-indigo-600","text-white","rounded-md","disabled:bg-indigo-300",3,"disabled"],["formControlName","name",1,"flex-grow","rounded-md","border-gray-300","shadow-sm","bg-gray-50","p-2"],["type","button","title","\u522A\u9664",1,"text-red-500","p-1","hover:bg-red-100","rounded-full",3,"click"],["name","trash-outline",1,"text-lg"],[1,"bg-white","rounded-xl","shadow-2xl","w-full","max-w-md","m-4"],[1,"p-6","text-center"],[1,"mx-auto","flex","items-center","justify-center","h-12","w-12","rounded-full","bg-red-100"],["name","warning-outline",1,"h-6","w-6","text-red-600"],[1,"mt-4","text-lg","font-semibold","text-gray-900"],[1,"mt-2","text-sm","text-gray-500"],[1,"flex","justify-center","gap-4","bg-gray-50","px-6","py-4","rounded-b-xl"],["type","button",1,"px-4","py-2","bg-red-600","text-white","rounded-md","hover:bg-red-700","disabled:bg-red-300","flex","items-center","gap-2",3,"click","disabled"]],template:function(t,i){if(t&1&&(l(0,"div",2)(1,"div",3)(2,"h1",4),d(3,"\u500B\u4EBA\u6BCF\u5468\u9032\u5EA6\u7D00\u9304"),s(),l(4,"div",5)(5,"button",6),b("click",function(){return i.openMeetingModal(null)}),x(6,"ion-icon",7),l(7,"span"),d(8,"\u65B0\u589E\u7D00\u9304\u65E5\u671F"),s()(),l(9,"button",8),b("click",function(){return i.openShareholderModal()}),x(10,"ion-icon",9),l(11,"span"),d(12,"\u7BA1\u7406\u4EBA\u54E1"),s()()()(),M(13,qH,4,0,"div",10),M(14,WH,4,0,"div",11),l(15,"div",12)(16,"div",13)(17,"div")(18,"label",14),d(19,"\u9032\u5EA6\u5206\u985E"),s(),l(20,"select",15),K("ngModelChange",function(o){return Q(i.categoryFilter,o)||(i.categoryFilter=o),o}),l(21,"option",16),d(22,"\u6240\u6709\u5206\u985E"),s(),V(23,jH,2,2,"option",17,Y),s()(),l(25,"div")(26,"label",18),d(27,"\u8CA0\u8CAC\u4EBA"),s(),l(28,"select",19),K("ngModelChange",function(o){return Q(i.assigneeFilter,o)||(i.assigneeFilter=o),o}),l(29,"option",16),d(30,"\u6240\u6709\u8CA0\u8CAC\u4EBA"),s(),V(31,zH,2,2,"option",17,lu),s()(),l(33,"div",20)(34,"button",21),b("click",function(){return i.resetFilters()}),x(35,"ion-icon",22),s()()(),l(36,"div",23),V(37,ZH,17,5,"div",24,lu,!1,XH,2,0,"div",25),s()()(),M(40,nG,62,4,"div",26),M(41,aG,40,4,"div",26),M(42,lG,19,2,"div",26),M(43,dG,16,3,"div",26),M(44,mG,16,3,"div",26)),t&2){let r,o;m(13),A(i.loading()?13:-1),m(),A(i.processing()?14:-1),m(6),J("ngModel",i.categoryFilter),m(3),L(i.categories()),m(5),J("ngModel",i.assigneeFilter),m(3),L(i.shareholders()),m(6),L(i.filteredMeetings()),m(3),A(i.isMeetingModalOpen()?40:-1),m(),A(i.isRecordModalOpen()?41:-1),m(),A(i.isShareholderModalOpen()?42:-1),m(),A((r=i.meetingToDelete())?43:-1,r),m(),A((o=i.recordToDelete())?44:-1,o)}},dependencies:[se,Be,Ve,He,Ge,be,Oe,fe,ke,Le,Ue,qn,Wn,De,Ie],encapsulation:2,changeDetection:0});var Dp=rs;var pG=["backgroundArea"],fG=["contentArea"],gG=["rationaleArea"],hG=["finalDecisionArea"],bS=(n,e)=>e.id;function yG(n,e){n&1&&(l(0,"div",9),x(1,"ion-icon",15),l(2,"span"),d(3,"\u8F09\u5165\u4E2D..."),s()())}function _G(n,e){n&1&&(l(0,"div",10),x(1,"ion-icon",15),l(2,"span"),d(3,"\u8655\u7406\u4E2D..."),s()())}function vG(n,e){if(n&1){let t=B();l(0,"div",17)(1,"div",18),x(2,"ion-icon",19),s(),l(3,"div",20)(4,"div",21)(5,"div",22)(6,"div")(7,"p",23),d(8),s(),l(9,"h3",24),d(10),s()(),l(11,"div",25)(12,"button",26),b("click",function(){let r=E(t).$implicit,o=_(2);return S(o.openModal(r))}),x(13,"ion-icon",27),s(),l(14,"button",28),b("click",function(){let r=E(t).$implicit,o=_(2);return S(o.requestDelete(r))}),x(15,"ion-icon",29),s()()(),l(16,"div",30)(17,"div",31)(18,"div",32)(19,"h4",33),x(20,"ion-icon",34),d(21,"\u76F8\u95DC\u4EBA\u54E1"),s(),l(22,"p",35),d(23),s()(),l(24,"div",36)(25,"h4",33),x(26,"ion-icon",37),d(27,"\u80CC\u666F"),s(),x(28,"div",38),s(),l(29,"div",32)(30,"h4",33),x(31,"ion-icon",39),d(32,"\u5167\u5BB9"),s(),x(33,"div",38),s(),l(34,"div",32)(35,"h4",33),x(36,"ion-icon",40),d(37,"\u7406\u7531"),s(),x(38,"div",38),s()(),l(39,"div",41)(40,"h4",42),x(41,"ion-icon",43),d(42,"\u6700\u7D42\u6C7A\u5B9A"),s(),x(43,"div",44),s()()()()()}if(n&2){let t=e.$implicit;m(8),w(t.date),m(2),w(t.title),m(13),w(t.stakeholders),m(5),I("innerHTML",t.background,Gi),m(5),I("innerHTML",t.content,Gi),m(5),I("innerHTML",t.rationale,Gi),m(5),I("innerHTML",t.finalDecision,Gi)}}function CG(n,e){if(n&1&&(l(0,"div",12),x(1,"div",16),V(2,vG,44,7,"div",17,bS),s()),n&2){let t=_();m(2),L(t.sortedDecisions())}}function xG(n,e){n&1&&(l(0,"div",13),d(1," \u5C1A\u7121\u4F48\u9054\u4E8B\u9805\uFF0C\u9EDE\u64CA\u6309\u9215\u4F86\u5EFA\u7ACB\u7B2C\u4E00\u7B46\u7D00\u9304\u3002 "),s())}function bG(n,e){if(n&1){let t=B();l(0,"label",59)(1,"input",82),b("change",function(r){let o=E(t).$implicit,a=_(2);return S(a.toggleStakeholder(o.id,r.target.checked))}),s(),l(2,"span"),d(3),s()()}if(n&2){let t=e.$implicit,i=_(2);m(),I("checked",i.isStakeholderSelected(t.id)),m(2),w(t.name)}}function EG(n,e){n&1&&x(0,"ion-icon",15)}function SG(n,e){if(n&1){let t=B();l(0,"div",14)(1,"div",45)(2,"div",46)(3,"h3",47),d(4),s(),l(5,"button",48),b("click",function(){E(t);let r=_();return S(r.closeModal())}),x(6,"ion-icon",49),s()(),l(7,"div",50)(8,"form",51),b("ngSubmit",function(){E(t);let r=_();return S(r.handleFormSubmit())}),l(9,"div",52)(10,"div")(11,"label",53),d(12,"\u65E5\u671F*"),s(),x(13,"input",54),s(),l(14,"div")(15,"label",55),d(16,"\u6A19\u984C*"),s(),x(17,"input",56),s()(),l(18,"div")(19,"label",57),d(20,"\u76F8\u95DC\u4EBA\u54E1*"),s(),l(21,"div",58),V(22,bG,4,2,"label",59,bS),s()(),l(24,"div")(25,"label",60),d(26,"\u80CC\u666F*"),s(),l(27,"div",61)(28,"button",62),b("click",function(){E(t);let r=oe(39),o=_();return S(o.applyTextFormat("background","bold",r))}),x(29,"ion-icon",63),s(),l(30,"button",64),b("click",function(){E(t);let r=oe(39),o=_();return S(o.applyTextFormat("background","italic",r))}),x(31,"ion-icon",65),s(),l(32,"button",66),b("click",function(){E(t);let r=oe(39),o=_();return S(o.applyTextFormat("background","underline",r))}),x(33,"ion-icon",67),s(),l(34,"button",68),b("click",function(){E(t);let r=oe(39),o=_();return S(o.applyTextFormat("background","bullet",r))}),x(35,"ion-icon",69),s(),l(36,"button",70),b("click",function(){E(t);let r=oe(39),o=_();return S(o.applyTextFormat("background","numbered",r))}),x(37,"ion-icon",71),s()(),l(38,"div",72,0),b("input",function(){E(t);let r=oe(39),o=_();return S(o.onEditorInput("background",r))}),s()(),l(40,"div")(41,"label",73),d(42,"\u5167\u5BB9*"),s(),l(43,"div",61)(44,"button",62),b("click",function(){E(t);let r=oe(55),o=_();return S(o.applyTextFormat("content","bold",r))}),x(45,"ion-icon",63),s(),l(46,"button",64),b("click",function(){E(t);let r=oe(55),o=_();return S(o.applyTextFormat("content","italic",r))}),x(47,"ion-icon",65),s(),l(48,"button",66),b("click",function(){E(t);let r=oe(55),o=_();return S(o.applyTextFormat("content","underline",r))}),x(49,"ion-icon",67),s(),l(50,"button",68),b("click",function(){E(t);let r=oe(55),o=_();return S(o.applyTextFormat("content","bullet",r))}),x(51,"ion-icon",69),s(),l(52,"button",70),b("click",function(){E(t);let r=oe(55),o=_();return S(o.applyTextFormat("content","numbered",r))}),x(53,"ion-icon",71),s()(),l(54,"div",74,1),b("input",function(){E(t);let r=oe(55),o=_();return S(o.onEditorInput("content",r))}),s()(),l(56,"div")(57,"label",75),d(58,"\u7406\u7531*"),s(),l(59,"div",61)(60,"button",62),b("click",function(){E(t);let r=oe(71),o=_();return S(o.applyTextFormat("rationale","bold",r))}),x(61,"ion-icon",63),s(),l(62,"button",64),b("click",function(){E(t);let r=oe(71),o=_();return S(o.applyTextFormat("rationale","italic",r))}),x(63,"ion-icon",65),s(),l(64,"button",66),b("click",function(){E(t);let r=oe(71),o=_();return S(o.applyTextFormat("rationale","underline",r))}),x(65,"ion-icon",67),s(),l(66,"button",68),b("click",function(){E(t);let r=oe(71),o=_();return S(o.applyTextFormat("rationale","bullet",r))}),x(67,"ion-icon",69),s(),l(68,"button",70),b("click",function(){E(t);let r=oe(71),o=_();return S(o.applyTextFormat("rationale","numbered",r))}),x(69,"ion-icon",71),s()(),l(70,"div",76,2),b("input",function(){E(t);let r=oe(71),o=_();return S(o.onEditorInput("rationale",r))}),s()(),l(72,"div")(73,"label",77),d(74,"\u6700\u7D42\u6C7A\u5B9A*"),s(),l(75,"div",61)(76,"button",62),b("click",function(){E(t);let r=oe(87),o=_();return S(o.applyTextFormat("finalDecision","bold",r))}),x(77,"ion-icon",63),s(),l(78,"button",64),b("click",function(){E(t);let r=oe(87),o=_();return S(o.applyTextFormat("finalDecision","italic",r))}),x(79,"ion-icon",65),s(),l(80,"button",66),b("click",function(){E(t);let r=oe(87),o=_();return S(o.applyTextFormat("finalDecision","underline",r))}),x(81,"ion-icon",67),s(),l(82,"button",68),b("click",function(){E(t);let r=oe(87),o=_();return S(o.applyTextFormat("finalDecision","bullet",r))}),x(83,"ion-icon",69),s(),l(84,"button",70),b("click",function(){E(t);let r=oe(87),o=_();return S(o.applyTextFormat("finalDecision","numbered",r))}),x(85,"ion-icon",71),s()(),l(86,"div",78,3),b("input",function(){E(t);let r=oe(87),o=_();return S(o.onEditorInput("finalDecision",r))}),s()(),l(88,"div",79)(89,"button",80),b("click",function(){E(t);let r=_();return S(r.closeModal())}),d(90,"\u53D6\u6D88"),s(),l(91,"button",81),M(92,EG,1,0,"ion-icon",15),l(93,"span"),d(94,"\u5132\u5B58"),s()()()()()()()}if(n&2){let t=_();m(4),w(t.editingDecision()?"\u7DE8\u8F2F\u4F48\u9054":"\u65B0\u589E\u4F48\u9054"),m(4),I("formGroup",t.decisionForm),m(14),L(t.employees()),m(69),I("disabled",t.decisionForm.invalid||t.processing()),m(),A(t.processing()?92:-1)}}function DG(n,e){n&1&&x(0,"ion-icon",15)}function wG(n,e){if(n&1){let t=B();l(0,"div",14)(1,"div",83)(2,"div",84)(3,"div",85),x(4,"ion-icon",86),s(),l(5,"h3",87),d(6,"\u78BA\u5B9A\u8981\u522A\u9664\u55CE\uFF1F"),s(),l(7,"p",88),d(8),s()(),l(9,"div",89)(10,"button",80),b("click",function(){E(t);let r=_();return S(r.cancelDelete())}),d(11,"\u53D6\u6D88"),s(),l(12,"button",90),b("click",function(){E(t);let r=_();return S(r.confirmDelete())}),M(13,DG,1,0,"ion-icon",15),l(14,"span"),d(15,"\u78BA\u8A8D\u522A\u9664"),s()()()()()}if(n&2){let t=_();m(8),N("\u60A8\u78BA\u5B9A\u8981\u522A\u9664\u4F48\u9054\u4E8B\u9805\u300C",e.title,"\u300D\u55CE\uFF1F\u6B64\u64CD\u4F5C\u7121\u6CD5\u5FA9\u539F\u3002"),m(4),I("disabled",t.processing()),m(),A(t.processing()?13:-1)}}var os=class os{constructor(){this.apiService=k(we);this.fb=k(qe);this.isModalOpen=D(!1);this.editingDecision=D(null);this.decisionToDelete=D(null);this.loading=D(!1);this.processing=D(!1);this.decisions=D([]);this.employees=D([]);this.sortedDecisions=$(()=>this.decisions().sort((e,t)=>new Date(t.date).getTime()-new Date(e.date).getTime()));this.decisionForm=this.fb.group({date:["",U.required],title:["",U.required],stakeholders:[[],U.required],background:["",U.required],content:["",U.required],rationale:["",U.required],finalDecision:["",U.required]});this.loadDecisions()}parseContent(e){try{let t=JSON.parse(e);if(t&&typeof t=="object")return{background:t.background||"",content:t.content||t.decision||"",rationale:t.rationale||"",finalDecision:t.finalDecision||t.decision||""}}catch{}return{background:"",content:e||"",rationale:"",finalDecision:""}}stringifyContent(e,t,i,r){return JSON.stringify({background:e,content:t,rationale:i,finalDecision:r})}onEditorInput(e,t){this.decisionForm.patchValue({[e]:t.innerHTML||""})}syncEditorContents(){let e=this.decisionForm.get("background")?.value||"",t=this.decisionForm.get("content")?.value||"",i=this.decisionForm.get("rationale")?.value||"",r=this.decisionForm.get("finalDecision")?.value||"";this.backgroundAreaRef?.nativeElement&&(this.backgroundAreaRef.nativeElement.innerHTML=String(e)),this.contentAreaRef?.nativeElement&&(this.contentAreaRef.nativeElement.innerHTML=String(t)),this.rationaleAreaRef?.nativeElement&&(this.rationaleAreaRef.nativeElement.innerHTML=String(i)),this.finalDecisionAreaRef?.nativeElement&&(this.finalDecisionAreaRef.nativeElement.innerHTML=String(r))}applyTextFormat(e,t,i){let r={bold:"bold",italic:"italic",underline:"underline",bullet:"insertUnorderedList",numbered:"insertOrderedList"};i.focus(),document.execCommand(r[t],!1),this.onEditorInput(e,i)}isStakeholderSelected(e){let t=this.decisionForm.get("stakeholders")?.value;return Array.isArray(t)&&t.includes(e)}toggleStakeholder(e,t){let i=this.decisionForm.get("stakeholders")?.value||[],r=new Set(i);t?r.add(e):r.delete(e),this.decisionForm.patchValue({stakeholders:Array.from(r)}),this.decisionForm.get("stakeholders")?.markAsDirty(),this.decisionForm.get("stakeholders")?.updateValueAndValidity()}async loadDecisions(){this.loading.set(!0);try{let[e,t]=await Promise.all([this.apiService.getCollaborationAnnouncements(),this.apiService.getEmployeeInfo()]);t.success&&t.data&&this.employees.set(t.data.map(o=>({id:Number(o.id),name:o.employee_name})));let i=e;if(!i.success||!i.data)throw new Error(i.error||"\u8F09\u5165\u91CD\u5927\u4E8B\u9805\u5931\u6557");let r=i.data.map(o=>{let a=this.parseContent(o.content||""),u=(o.attendees||[]).map(p=>Number(p.attendeeEmployeeId)).filter(p=>Number.isFinite(p)),c=(o.attendees||[]).map(p=>p.attendeeEmployeeName||String(p.attendeeEmployeeId)).join(", ");return{id:Number(o.id),date:o.announcedAt?String(o.announcedAt).split("T")[0]:"",title:o.title||"",background:a.background,content:a.content,rationale:a.rationale,finalDecision:a.finalDecision,stakeholders:c,attendeeIds:u}});this.decisions.set(r)}catch(e){console.error(e),alert(e?.message||"\u8F09\u5165\u91CD\u5927\u4E8B\u9805\u5931\u6557")}finally{this.loading.set(!1)}}openModal(e=null){this.editingDecision.set(e),e?this.decisionForm.patchValue({date:e.date,title:e.title,stakeholders:e.attendeeIds,background:e.background,content:e.content,rationale:e.rationale,finalDecision:e.finalDecision}):this.decisionForm.reset({date:new Date().toISOString().split("T")[0]}),this.isModalOpen.set(!0),setTimeout(()=>this.syncEditorContents(),0)}closeModal(){this.isModalOpen.set(!1),this.editingDecision.set(null)}async handleFormSubmit(){if(this.decisionForm.invalid)return;let e=this.decisionForm.value,t=this.editingDecision(),i=(e.stakeholders||[]).map(o=>Number(o)).filter(o=>Number.isFinite(o)&&o>0),r={title:e.title,content:this.stringifyContent(e.background,e.content,e.rationale,e.finalDecision),announcedAt:e.date,attendeeEmployeeIds:i};this.processing.set(!0);try{if(t){let o=await this.apiService.updateCollaborationAnnouncement(O({id:t.id},r));if(!o.success)throw new Error(o.error||"\u66F4\u65B0\u5931\u6557")}else{let o=await this.apiService.createCollaborationAnnouncement(r);if(!o.success)throw new Error(o.error||"\u65B0\u589E\u5931\u6557")}await this.loadDecisions(),this.closeModal()}catch(o){alert(o?.message||"\u5132\u5B58\u5931\u6557")}finally{this.processing.set(!1)}}requestDelete(e){this.decisionToDelete.set(e)}async confirmDelete(){if(this.decisionToDelete()){this.processing.set(!0);try{let e=this.decisionToDelete().id,t=await this.apiService.deleteCollaborationAnnouncement(e);if(!t.success)throw new Error(t.error||"\u522A\u9664\u5931\u6557");await this.loadDecisions(),this.cancelDelete()}catch(e){alert(e?.message||"\u522A\u9664\u5931\u6557")}finally{this.processing.set(!1)}}}cancelDelete(){this.decisionToDelete.set(null)}};os.\u0275fac=function(t){return new(t||os)},os.\u0275cmp=re({type:os,selectors:[["app-decision-log"]],viewQuery:function(t,i){if(t&1&&(ut(pG,5),ut(fG,5),ut(gG,5),ut(hG,5)),t&2){let r;tt(r=nt())&&(i.backgroundAreaRef=r.first),tt(r=nt())&&(i.contentAreaRef=r.first),tt(r=nt())&&(i.rationaleAreaRef=r.first),tt(r=nt())&&(i.finalDecisionAreaRef=r.first)}},decls:15,vars:5,consts:[["backgroundArea",""],["contentArea",""],["rationaleArea",""],["finalDecisionArea",""],[1,"space-y-6"],[1,"flex","flex-wrap","items-center","justify-between","gap-4"],[1,"text-3xl","font-bold","text-gray-900"],[1,"bg-indigo-600","text-white","px-4","py-2","rounded-lg","font-medium","hover:bg-indigo-700","transition-colors","flex","items-center","gap-2","text-sm",3,"click"],["name","add-outline"],[1,"flex","items-center","gap-2","text-sm","text-indigo-600"],[1,"flex","items-center","gap-2","text-sm","text-amber-600"],[1,"max-w-4xl","mx-auto"],[1,"relative","pl-8"],[1,"bg-white","p-6","rounded-xl","shadow-md","text-center","text-gray-500"],[1,"fixed","inset-0","bg-black","bg-opacity-50","flex","items-center","justify-center","z-50"],["name","reload-outline",1,"animate-spin"],[1,"absolute","left-3","top-2","h-full","w-0.5","bg-gray-200"],[1,"relative","mb-8","group"],[1,"absolute","-left-0.5","top-2.5","w-7","h-7","bg-white","border-4","border-indigo-600","rounded-full","flex","items-center","justify-center","transition-transform","group-hover:scale-110"],["name","flag-outline",1,"text-indigo-600"],[1,"ml-12","bg-white","rounded-xl","shadow-md","overflow-hidden","transition-shadow","hover:shadow-lg"],[1,"p-5"],[1,"flex","justify-between","items-start"],[1,"font-semibold","text-indigo-700"],[1,"text-lg","font-bold","text-gray-800"],[1,"flex","items-center","gap-1","opacity-0","group-hover:opacity-100","transition-opacity"],["title","\u7DE8\u8F2F",1,"text-gray-400","hover:text-indigo-600","p-1.5","rounded-full","hover:bg-gray-100",3,"click"],["name","create-outline"],["title","\u522A\u9664",1,"text-gray-400","hover:text-red-600","p-1.5","rounded-full","hover:bg-gray-100",3,"click"],["name","trash-outline"],[1,"mt-4","space-y-4","text-sm"],[1,"grid","grid-cols-1","xl:grid-cols-2","gap-4"],[1,"bg-slate-50","p-3","rounded-lg","border"],[1,"font-semibold","text-slate-600","mb-1","flex","items-center","gap-2"],["name","people-outline"],[1,"text-slate-800","pl-8"],[1,"bg-slate-50","p-3","rounded-lg","border","xl:row-span-2"],["name","information-circle-outline"],[1,"text-slate-800","pl-8","[&_ul]:list-disc","[&_ul]:pl-6","[&_ol]:list-decimal","[&_ol]:pl-6",3,"innerHTML"],["name","document-text-outline"],["name","bulb-outline"],[1,"bg-indigo-50","p-4","rounded-lg","border","border-indigo-200"],[1,"font-semibold","text-indigo-800","mb-1","flex","items-center","gap-2"],["name","checkmark-done-circle-outline"],[1,"text-indigo-900","pl-8","font-medium","text-base","[&_ul]:list-disc","[&_ul]:pl-6","[&_ol]:list-decimal","[&_ol]:pl-6",3,"innerHTML"],[1,"bg-white","rounded-xl","shadow-2xl","w-full","max-w-2xl","max-h-[90vh]","flex","flex-col","m-4"],[1,"flex","justify-between","items-center","p-4","border-b"],[1,"text-lg","font-semibold"],[1,"text-gray-400","hover:text-gray-600",3,"click"],["name","close-outline",1,"text-2xl"],[1,"p-6","overflow-y-auto"],[1,"space-y-4",3,"ngSubmit","formGroup"],[1,"grid","grid-cols-1","md:grid-cols-2","gap-4"],["for","date",1,"block","text-sm","font-medium","text-gray-700"],["type","date","id","date","formControlName","date",1,"mt-1","block","w-full","rounded-md","border-gray-300","shadow-sm","bg-gray-50","p-2"],["for","title",1,"block","text-sm","font-medium","text-gray-700"],["type","text","id","title","formControlName","title",1,"mt-1","block","w-full","rounded-md","border-gray-300","shadow-sm","bg-gray-50","p-2"],["for","stakeholders",1,"block","text-sm","font-medium","text-gray-700"],[1,"mt-1","max-h-40","overflow-y-auto","rounded-md","border","border-gray-300","bg-gray-50","p-3","grid","grid-cols-1","md:grid-cols-2","gap-2"],[1,"flex","items-center","gap-2","text-sm","text-gray-700","cursor-pointer"],["for","background",1,"block","text-sm","font-medium","text-gray-700"],[1,"mt-1","flex","items-center","gap-2","text-xs"],["type","button","title","\u7C97\u9AD4",1,"h-8","w-8","border","rounded","bg-white","flex","items-center","justify-center",3,"click"],["name","text-outline",1,"text-base"],["type","button","title","\u659C\u9AD4",1,"h-8","w-8","border","rounded","bg-white","flex","items-center","justify-center",3,"click"],["name","code-slash-outline",1,"text-base"],["type","button","title","\u5E95\u7DDA",1,"h-8","w-8","border","rounded","bg-white","flex","items-center","justify-center",3,"click"],["name","remove-outline",1,"text-base"],["type","button","title","\u9805\u76EE\u7B26\u865F",1,"h-8","w-8","border","rounded","bg-white","flex","items-center","justify-center",3,"click"],["name","list-outline",1,"text-base"],["type","button","title","\u9805\u76EE\u7DE8\u865F",1,"h-8","w-8","border","rounded","bg-white","flex","items-center","justify-center",3,"click"],["name","list-circle-outline",1,"text-base"],["id","background","contenteditable","true",1,"mt-2","block","w-full","min-h-[90px]","rounded-md","border","border-gray-300","shadow-sm","bg-gray-50","p-2","[&_ul]:list-disc","[&_ul]:pl-6","[&_ol]:list-decimal","[&_ol]:pl-6",3,"input"],["for","content",1,"block","text-sm","font-medium","text-gray-700"],["id","content","contenteditable","true",1,"mt-2","block","w-full","min-h-[110px]","rounded-md","border","border-gray-300","shadow-sm","bg-gray-50","p-2","[&_ul]:list-disc","[&_ul]:pl-6","[&_ol]:list-decimal","[&_ol]:pl-6",3,"input"],["for","rationale",1,"block","text-sm","font-medium","text-gray-700"],["id","rationale","contenteditable","true",1,"mt-2","block","w-full","min-h-[90px]","rounded-md","border","border-gray-300","shadow-sm","bg-gray-50","p-2","[&_ul]:list-disc","[&_ul]:pl-6","[&_ol]:list-decimal","[&_ol]:pl-6",3,"input"],["for","finalDecision",1,"block","text-sm","font-medium","text-gray-700"],["id","finalDecision","contenteditable","true",1,"mt-2","block","w-full","min-h-[90px]","rounded-md","border","border-gray-300","shadow-sm","bg-gray-50","p-2","[&_ul]:list-disc","[&_ul]:pl-6","[&_ol]:list-decimal","[&_ol]:pl-6",3,"input"],[1,"flex","justify-end","gap-4","pt-4","border-t","mt-4"],["type","button",1,"px-4","py-2","border","rounded-md",3,"click"],["type","submit",1,"px-4","py-2","bg-indigo-600","text-white","rounded-md","disabled:bg-indigo-300","flex","items-center","gap-2",3,"disabled"],["type","checkbox",1,"h-4","w-4","rounded","border-gray-300","text-indigo-600","focus:ring-indigo-500",3,"change","checked"],[1,"bg-white","rounded-xl","shadow-2xl","w-full","max-w-md","m-4"],[1,"p-6","text-center"],[1,"mx-auto","flex","items-center","justify-center","h-12","w-12","rounded-full","bg-red-100"],["name","warning-outline",1,"h-6","w-6","text-red-600"],[1,"mt-4","text-lg","font-semibold","text-gray-900"],[1,"mt-2","text-sm","text-gray-500"],[1,"flex","justify-center","gap-4","bg-gray-50","px-6","py-4","rounded-b-xl"],["type","button",1,"px-4","py-2","bg-red-600","text-white","rounded-md","hover:bg-red-700","disabled:bg-red-300","flex","items-center","gap-2",3,"click","disabled"]],template:function(t,i){if(t&1&&(l(0,"div",4)(1,"div",5)(2,"h1",6),d(3,"\u91CD\u5927\u4E8B\u9805\u4F48\u9054"),s(),l(4,"button",7),b("click",function(){return i.openModal(null)}),x(5,"ion-icon",8),l(6,"span"),d(7,"\u65B0\u589E\u4F48\u9054"),s()()(),M(8,yG,4,0,"div",9),M(9,_G,4,0,"div",10),l(10,"div",11),M(11,CG,4,0,"div",12)(12,xG,2,0,"div",13),s()(),M(13,SG,95,4,"div",14),M(14,wG,16,3,"div",14)),t&2){let r;m(8),A(i.loading()?8:-1),m(),A(i.processing()?9:-1),m(2),A(i.sortedDecisions().length>0?11:12),m(2),A(i.isModalOpen()?13:-1),m(),A((r=i.decisionToDelete())?14:-1,r)}},dependencies:[se,Be,Ve,be,fe,ke,Le,Ue],encapsulation:2,changeDetection:0});var wp=os;var ss=(n,e)=>e.id;function TG(n,e){n&1&&(l(0,"div",5),x(1,"ion-icon",30),l(2,"span"),d(3,"\u8F09\u5165\u4E2D..."),s()())}function IG(n,e){n&1&&(l(0,"div",6),x(1,"ion-icon",30),l(2,"span"),d(3,"\u8655\u7406\u4E2D..."),s()())}function MG(n,e){if(n&1&&(l(0,"option",17),d(1),s()),n&2){let t=e.$implicit;I("value",t.id),m(),w(t.name)}}function AG(n,e){if(n&1&&x(0,"div",54),n&2){let t=_().$implicit;Xt("width",t.progress,"%")}}function RG(n,e){if(n&1&&x(0,"div",55),n&2){let t=_().$implicit;Xt("width",t.progress,"%")}}function NG(n,e){if(n&1){let t=B();l(0,"label",52)(1,"input",56),b("change",function(r){let o=E(t).$index,a=_().$implicit,u=_();return S(u.updateProgress(a,o,r))}),s(),l(2,"span",57),d(3),s()()}if(n&2){let t=e.$implicit;m(),I("checked",t.isCompleted),m(),j("line-through",t.isCompleted)("text-gray-400",t.isCompleted),m(),w(t.description)}}function FG(n,e){n&1&&(l(0,"p",53),d(1,"\u5C1A\u7121\u95DC\u9375\u6210\u679C"),s())}function PG(n,e){if(n&1){let t=B();l(0,"div",25)(1,"div",31)(2,"div",32)(3,"div",33),x(4,"img",34),l(5,"div")(6,"p",35),d(7),s(),l(8,"p",36),d(9),s()()(),l(10,"div",37)(11,"button",38),b("click",function(){let r=E(t).$implicit,o=_();return S(o.openModal(r))}),x(12,"ion-icon",39),s(),l(13,"button",40),b("click",function(){let r=E(t).$implicit,o=_();return S(o.requestDelete(r))}),x(14,"ion-icon",41),s()()(),l(15,"h3",42),d(16),s()(),l(17,"div",43)(18,"div",44)(19,"span",45),d(20),s(),l(21,"span",46),d(22),s()(),l(23,"div",47),M(24,AG,1,2,"div",48)(25,RG,1,2,"div",49),s(),l(26,"div",50)(27,"h4",51),d(28,"\u95DC\u9375\u6210\u679C"),s(),V(29,NG,4,6,"label",52,ss,!1,FG,2,0,"p",53),s()()()}if(n&2){let t=e.$implicit,i=_();m(4),I("src",i.getOwnerAvatarUrl(t.ownerId),qt),m(3),w(i.getOwnerName(t.ownerId)),m(2),N("\u622A\u6B62\u65BC ",t.dueDate),m(7),w(t.title),m(3),I("ngClass",i.getStatusClass(t.status)),m(),w(t.status),m(2),N("",t.progress,"%"),m(2),A(t.progress<100?24:25),m(5),L(t.keyResults)}}function kG(n,e){n&1&&(l(0,"div",26),x(1,"ion-icon",58),l(2,"p",59),d(3,"\u7121\u7B26\u5408\u689D\u4EF6\u7684\u6BCF\u9031\u76EE\u6A19\u3002"),s()())}function VG(n,e){if(n&1&&x(0,"div",61),n&2){let t=_().$implicit;Xt("width",t.progress,"%")}}function LG(n,e){if(n&1&&x(0,"div",55),n&2){let t=_().$implicit;Xt("width",t.progress,"%")}}function OG(n,e){if(n&1){let t=B();l(0,"label",52)(1,"input",62),b("change",function(r){let o=E(t).$index,a=_().$implicit,u=_();return S(u.updateProgress(a,o,r))}),s(),l(2,"span",57),d(3),s()()}if(n&2){let t=e.$implicit;m(),I("checked",t.isCompleted),m(),j("line-through",t.isCompleted)("text-gray-400",t.isCompleted),m(),w(t.description)}}function BG(n,e){n&1&&(l(0,"p",53),d(1,"\u5C1A\u7121\u95DC\u9375\u6210\u679C"),s())}function UG(n,e){if(n&1){let t=B();l(0,"div",25)(1,"div",31)(2,"div",32)(3,"div",33),x(4,"img",34),l(5,"div")(6,"p",35),d(7),s(),l(8,"p",36),d(9),s()()(),l(10,"div",37)(11,"button",38),b("click",function(){let r=E(t).$implicit,o=_();return S(o.openModal(r))}),x(12,"ion-icon",39),s(),l(13,"button",40),b("click",function(){let r=E(t).$implicit,o=_();return S(o.requestDelete(r))}),x(14,"ion-icon",41),s()()(),l(15,"h3",42),d(16),s()(),l(17,"div",43)(18,"div",44)(19,"span",45),d(20),s(),l(21,"span",46),d(22),s()(),l(23,"div",47),M(24,VG,1,2,"div",60)(25,LG,1,2,"div",49),s(),l(26,"div",50)(27,"h4",51),d(28,"\u95DC\u9375\u6210\u679C"),s(),V(29,OG,4,6,"label",52,ss,!1,BG,2,0,"p",53),s()()()}if(n&2){let t=e.$implicit,i=_();m(4),I("src",i.getOwnerAvatarUrl(t.ownerId),qt),m(3),w(i.getOwnerName(t.ownerId)),m(2),N("\u622A\u6B62\u65BC ",t.dueDate),m(7),w(t.title),m(3),I("ngClass",i.getStatusClass(t.status)),m(),w(t.status),m(2),N("",t.progress,"%"),m(2),A(t.progress<100?24:25),m(5),L(t.keyResults)}}function $G(n,e){n&1&&(l(0,"div",26),x(1,"ion-icon",58),l(2,"p",59),d(3,"\u7121\u7B26\u5408\u689D\u4EF6\u7684\u6708\u5EA6\u76EE\u6A19\u3002"),s()())}function HG(n,e){if(n&1&&(l(0,"option",17),d(1),s()),n&2){let t=e.$implicit;I("value",t.id),m(),w(t.name)}}function GG(n,e){if(n&1){let t=B();l(0,"div",87),x(1,"input",92),l(2,"button",93),b("click",function(){let r=E(t).$index,o=_(2);return S(o.removeKeyResult(r))}),x(3,"ion-icon",41),s()()}if(n&2){let t=e.$index;I("formGroupName",t)}}function qG(n,e){n&1&&x(0,"ion-icon",30)}function WG(n,e){if(n&1){let t=B();l(0,"div",29)(1,"div",63)(2,"div",64)(3,"h3",65),d(4),s(),l(5,"button",66),b("click",function(){E(t);let r=_();return S(r.closeModal())}),x(6,"ion-icon",67),s()(),l(7,"div",68)(8,"form",69),b("ngSubmit",function(){E(t);let r=_();return S(r.handleFormSubmit())}),l(9,"div")(10,"label",70),d(11,"\u76EE\u6A19*"),s(),x(12,"input",71),s(),l(13,"div",72)(14,"div")(15,"label",73),d(16,"\u8CA0\u8CAC\u4EBA*"),s(),l(17,"select",74)(18,"option",75),d(19,"\u8ACB\u9078\u64C7"),s(),V(20,HG,2,2,"option",17,ss),s()(),l(22,"div")(23,"label",76),d(24,"\u622A\u6B62\u65E5\u671F*"),s(),x(25,"input",77),s()(),l(26,"div",72)(27,"div")(28,"label",78),d(29,"\u9031\u671F*"),s(),l(30,"select",79)(31,"option",80),d(32,"\u6708\u5EA6"),s(),l(33,"option",81),d(34,"\u6BCF\u9031"),s()()(),l(35,"div")(36,"label",82),d(37,"\u72C0\u614B*"),s(),l(38,"select",83)(39,"option",11),d(40,"\u9032\u884C\u4E2D"),s(),l(41,"option",12),d(42,"\u5DF2\u5B8C\u6210"),s(),l(43,"option",13),d(44,"\u843D\u5F8C"),s(),l(45,"option",14),d(46,"\u5DF2\u64F1\u7F6E"),s()()()(),l(47,"div",84)(48,"h4",85),d(49,"\u95DC\u9375\u6210\u679C"),s(),l(50,"div",86),V(51,GG,4,1,"div",87,sn),s(),l(53,"button",88),b("click",function(){E(t);let r=_();return S(r.addKeyResult())}),d(54,"+ \u65B0\u589E\u95DC\u9375\u6210\u679C"),s()(),l(55,"div",89)(56,"button",90),b("click",function(){E(t);let r=_();return S(r.closeModal())}),d(57,"\u53D6\u6D88"),s(),l(58,"button",91),M(59,qG,1,0,"ion-icon",30),l(60,"span"),d(61,"\u5132\u5B58"),s()()()()()()()}if(n&2){let t=_();m(4),w(t.editingGoal()?"\u7DE8\u8F2F\u500B\u4EBA\u76EE\u6A19":"\u65B0\u589E\u500B\u4EBA\u76EE\u6A19"),m(4),I("formGroup",t.goalForm),m(12),L(t.shareholders()),m(31),L(t.keyResults.controls),m(7),I("disabled",t.goalForm.invalid||t.processing()),m(),A(t.processing()?59:-1)}}function jG(n,e){n&1&&x(0,"ion-icon",30)}function zG(n,e){if(n&1){let t=B();l(0,"div",29)(1,"div",94)(2,"div",95)(3,"div",96),x(4,"ion-icon",97),s(),l(5,"h3",98),d(6,"\u78BA\u5B9A\u8981\u522A\u9664\u76EE\u6A19\u55CE\uFF1F"),s(),l(7,"p",99),d(8),s()(),l(9,"div",100)(10,"button",90),b("click",function(){E(t);let r=_();return S(r.cancelDelete())}),d(11,"\u53D6\u6D88"),s(),l(12,"button",101),b("click",function(){E(t);let r=_();return S(r.confirmDelete())}),M(13,jG,1,0,"ion-icon",30),l(14,"span"),d(15,"\u78BA\u8A8D\u522A\u9664"),s()()()()()}if(n&2){let t=_();m(8),N("\u60A8\u78BA\u5B9A\u8981\u522A\u9664\u76EE\u6A19\u300C",e.title,"\u300D\u55CE\uFF1F\u6B64\u64CD\u4F5C\u7121\u6CD5\u5FA9\u539F\u3002"),m(4),I("disabled",t.processing()),m(),A(t.processing()?13:-1)}}var as=class as{constructor(){this.apiService=k(we);this.fb=k(qe);this.isModalOpen=D(!1);this.editingGoal=D(null);this.goalToDelete=D(null);this.statusFilter=D("");this.ownerFilter=D("");this.shareholders=D([]);this.goals=D([]);this.loading=D(!1);this.processing=D(!1);this.baseFilteredGoals=$(()=>{let e=this.statusFilter(),t=this.ownerFilter();return this.goals().filter(i=>!e||i.status===e).filter(i=>!t||i.ownerId===t).sort((i,r)=>new Date(r.dueDate).getTime()-new Date(i.dueDate).getTime())});this.monthlyGoals=$(()=>this.baseFilteredGoals().filter(e=>e.period==="monthly"));this.weeklyGoals=$(()=>this.baseFilteredGoals().filter(e=>e.period==="weekly"));this.goalForm=this.fb.group({title:["",U.required],ownerId:["",U.required],dueDate:["",U.required],period:["monthly",U.required],status:["\u9032\u884C\u4E2D",U.required],keyResults:this.fb.array([])});this.loadData()}get keyResults(){return this.goalForm.get("keyResults")}toUiStatus(e){return e==="completed"?"\u5DF2\u5B8C\u6210":e==="on_hold"?"\u5DF2\u64F1\u7F6E":e==="cancelled"?"\u843D\u5F8C":"\u9032\u884C\u4E2D"}toDbStatus(e){return e==="\u5DF2\u5B8C\u6210"?"completed":e==="\u5DF2\u64F1\u7F6E"?"on_hold":e==="\u843D\u5F8C"?"cancelled":"in_progress"}toPeriod(e,t){if(!e||!t)return"monthly";let i=new Date(e),r=new Date(t);return Math.ceil((r.getTime()-i.getTime())/(1e3*60*60*24))<=10?"weekly":"monthly"}async loadData(){this.loading.set(!0);try{let[e,t]=await Promise.all([this.apiService.getEmployeeInfo(),this.apiService.getCollaborationGoals({includeKeyResults:!0})]);if(e.success&&e.data&&this.shareholders.set(e.data.map(i=>({id:String(i.id),name:i.employee_name}))),t.success&&t.data){let i=t.data.map(r=>{let o=(r.keyResults||[]).filter(a=>a.resultName!=="__AUTO_PROGRESS__").map(a=>({id:String(a.id),description:a.resultName||"",isCompleted:a.resultType==="boolean"?!!a.isAchieved:Number(a.achievementRate||0)>=100}));return{id:String(r.id),title:r.goalName,ownerId:String(r.ownerEmployeeId),dueDate:r.dueDate?String(r.dueDate).split("T")[0]:new Date().toISOString().split("T")[0],status:this.toUiStatus(r.status),progress:Number(r.achievementRate||0),period:this.toPeriod(r.startDate,r.dueDate),keyResults:o}});this.goals.set(i)}}catch(e){console.error("Error loading goal progress data:",e),alert("\u8F09\u5165\u8CC7\u6599\u5931\u6557")}finally{this.loading.set(!1)}}getOwnerName(e){return this.shareholders().find(t=>t.id===e)?.name||"\u672A\u77E5"}getOwnerAvatarUrl(e){let t=this.getOwnerName(e);return`https://ui-avatars.com/api/?name=${encodeURIComponent(t)}&background=random&color=fff&font-size=0.5`}getStatusClass(e){return{"bg-blue-100 text-blue-800":e==="\u9032\u884C\u4E2D","bg-green-100 text-green-800":e==="\u5DF2\u5B8C\u6210","bg-yellow-100 text-yellow-800":e==="\u843D\u5F8C","bg-gray-100 text-gray-800":e==="\u5DF2\u64F1\u7F6E"}}resetFilters(){this.statusFilter.set(""),this.ownerFilter.set("")}openModal(e=null){this.editingGoal.set(e),this.goalForm.reset({status:"\u9032\u884C\u4E2D",period:"monthly"}),this.keyResults.clear(),e?(this.goalForm.patchValue(e),e.keyResults.forEach(t=>this.addKeyResult(t.description,t.isCompleted,t.id))):this.goalForm.patchValue({dueDate:new Date().toISOString().split("T")[0],ownerId:this.shareholders()[0]?.id||""}),this.isModalOpen.set(!0)}closeModal(){this.isModalOpen.set(!1)}addKeyResult(e="",t=!1,i=""){let r=this.fb.group({id:[i],description:[e,U.required],isCompleted:[t]});this.keyResults.push(r)}removeKeyResult(e){this.keyResults.removeAt(e)}async handleFormSubmit(){if(this.goalForm.invalid)return;let e=this.goalForm.value,t=this.editingGoal(),i=e.keyResults.map(a=>({id:a.id||"",description:a.description,isCompleted:a.isCompleted})),r=i.length>0?i.filter(a=>a.isCompleted).length/i.length*100:0,o={title:e.title,ownerId:e.ownerId,dueDate:e.dueDate,status:e.status,period:e.period,keyResults:i,progress:Math.round(r)};this.processing.set(!0);try{let a=o.period==="weekly"?o.dueDate:new Date(new Date(o.dueDate).getFullYear(),new Date(o.dueDate).getMonth(),1).toISOString().split("T")[0],u=0;if(t){u=Number(t.id);let g=await this.apiService.updateCollaborationGoal({id:u,goalName:o.title,ownerEmployeeId:Number(o.ownerId),startDate:a,dueDate:o.dueDate,status:this.toDbStatus(o.status)});if(!g.success)throw new Error(g.error||"\u66F4\u65B0\u76EE\u6A19\u5931\u6557")}else{let g=await this.apiService.createCollaborationGoal({goalName:o.title,ownerEmployeeId:Number(o.ownerId),startDate:a,dueDate:o.dueDate,status:this.toDbStatus(o.status)});if(!g.success||!g.data?.id)throw new Error(g.error||"\u65B0\u589E\u76EE\u6A19\u5931\u6557");u=Number(g.data.id)}let c=new Set((t?.keyResults||[]).map(g=>Number(g.id)).filter(g=>Number.isFinite(g)&&g>0)),p=new Set;for(let g of i){let y=Number(g.id);y?(p.add(y),await this.apiService.updateCollaborationKeyResult({id:y,resultName:g.description,resultType:"boolean",unit:"\u662F\u5426",targetValue:1,currentValue:g.isCompleted?1:0,isAchieved:g.isCompleted,status:g.isCompleted?"completed":"in_progress"})):await this.apiService.createCollaborationKeyResult({goalId:u,resultName:g.description,resultType:"boolean",unit:"\u662F\u5426",targetValue:1,currentValue:g.isCompleted?1:0,isAchieved:g.isCompleted,status:g.isCompleted?"completed":"in_progress"})}for(let g of c)p.has(g)||await this.apiService.deleteCollaborationKeyResult(g);await this.loadData(),this.closeModal()}catch(a){console.error(a),alert(a?.message||"\u5132\u5B58\u5931\u6557")}finally{this.processing.set(!1)}}async updateProgress(e,t,i){let r=i.target.checked,o=e.keyResults[t],a=Number(o.id);if(a)try{await this.apiService.updateCollaborationKeyResult({id:a,targetValue:1,currentValue:r?1:0,isAchieved:r,resultType:"boolean",unit:"\u662F\u5426",status:r?"completed":"in_progress"}),await this.loadData()}catch(u){alert(u?.message||"\u66F4\u65B0\u9032\u5EA6\u5931\u6557")}}requestDelete(e){this.goalToDelete.set(e)}async confirmDelete(){if(this.goalToDelete()){this.processing.set(!0);try{await this.apiService.deleteCollaborationGoal(Number(this.goalToDelete().id)),await this.loadData(),this.cancelDelete()}catch(e){alert(e?.message||"\u522A\u9664\u5931\u6557")}finally{this.processing.set(!1)}}}cancelDelete(){this.goalToDelete.set(null)}};as.\u0275fac=function(t){return new(t||as)},as.\u0275cmp=re({type:as,selectors:[["app-goal-progress"]],decls:55,vars:8,consts:[[1,"space-y-6"],[1,"flex","flex-wrap","items-center","justify-between","gap-4"],[1,"text-3xl","font-bold","text-gray-900"],[1,"bg-indigo-600","text-white","px-4","py-2","rounded-lg","font-medium","hover:bg-indigo-700","transition-colors","flex","items-center","gap-2","text-sm",3,"click"],["name","add-outline"],[1,"flex","items-center","gap-2","text-sm","text-indigo-600"],[1,"flex","items-center","gap-2","text-sm","text-amber-600"],[1,"grid","grid-cols-1","md:grid-cols-3","gap-4","p-4","bg-white","rounded-xl","shadow-md"],["for","statusFilter",1,"text-sm","font-medium","text-gray-600"],["id","statusFilter",1,"w-full","mt-1","border-gray-300","rounded-lg","shadow-sm","focus:ring-indigo-500","focus:border-indigo-500","text-sm","p-2","bg-gray-50",3,"ngModelChange","ngModel"],["value",""],["value","\u9032\u884C\u4E2D"],["value","\u5DF2\u5B8C\u6210"],["value","\u843D\u5F8C"],["value","\u5DF2\u64F1\u7F6E"],["for","ownerFilter",1,"text-sm","font-medium","text-gray-600"],["id","ownerFilter",1,"w-full","mt-1","border-gray-300","rounded-lg","shadow-sm","focus:ring-indigo-500","focus:border-indigo-500","text-sm","p-2","bg-gray-50",3,"ngModelChange","ngModel"],[3,"value"],[1,"flex","items-end","justify-end"],["title","\u91CD\u8A2D\u7BE9\u9078",1,"text-gray-500","hover:text-gray-800","transition-colors","p-2","rounded-full","bg-gray-100","hover:bg-gray-200",3,"click"],["name","refresh-outline",1,"text-xl"],[1,"grid","grid-cols-1","lg:grid-cols-2","gap-8","pt-4"],[1,"text-2xl","font-bold","text-gray-800","mb-4","pb-2","border-b-2","border-teal-500","flex","items-center","gap-2"],["name","today-outline"],[1,"space-y-4"],[1,"bg-white","rounded-xl","shadow-md","border","flex","flex-col","group","transition-all","duration-300","hover:shadow-lg","hover:-translate-y-1"],[1,"bg-white","p-6","rounded-xl","border","text-center","text-gray-500"],[1,"text-2xl","font-bold","text-gray-800","mb-4","pb-2","border-b-2","border-indigo-500","flex","items-center","gap-2"],["name","calendar-outline"],[1,"fixed","inset-0","bg-black","bg-opacity-50","flex","items-center","justify-center","z-50"],["name","reload-outline",1,"animate-spin"],[1,"p-4"],[1,"flex","justify-between","items-start"],[1,"flex","items-center","gap-3"],["alt","avatar",1,"w-10","h-10","rounded-full",3,"src"],[1,"font-semibold","text-gray-800"],[1,"text-xs","text-gray-500"],[1,"flex","items-center","gap-1","shrink-0","opacity-0","group-hover:opacity-100","transition-opacity"],["title","\u7DE8\u8F2F",1,"text-gray-400","hover:text-indigo-600","p-1.5","rounded-full","hover:bg-gray-100",3,"click"],["name","create-outline"],["title","\u522A\u9664",1,"text-gray-400","hover:text-red-600","p-1.5","rounded-full","hover:bg-gray-100",3,"click"],["name","trash-outline"],[1,"text-base","font-bold","text-gray-800","mt-3"],[1,"p-4","flex-grow","flex","flex-col","justify-end"],[1,"flex","items-center","justify-between","mb-1"],[1,"text-xs","font-semibold","px-2","py-1","rounded-full",3,"ngClass"],[1,"text-sm","font-semibold"],[1,"w-full","bg-slate-100","rounded-full","h-3.5"],[1,"bg-teal-600","h-3.5","rounded-full","transition-all","duration-500",2,"background-image","linear-gradient(to right, #5eead4, #0d9488)",3,"width"],[1,"bg-green-500","h-3.5","rounded-full","transition-all","duration-500",2,"background-image","linear-gradient(to right, #4ade80, #16a34a)",3,"width"],[1,"mt-4","space-y-1","border-t","pt-4"],[1,"text-xs","font-semibold","text-gray-500","uppercase","px-2"],[1,"flex","items-start","gap-3","text-sm","text-gray-700","cursor-pointer","p-2","rounded-lg","hover:bg-slate-50"],[1,"text-xs","text-gray-400","px-2"],[1,"bg-teal-600","h-3.5","rounded-full","transition-all","duration-500",2,"background-image","linear-gradient(to right, #5eead4, #0d9488)"],[1,"bg-green-500","h-3.5","rounded-full","transition-all","duration-500",2,"background-image","linear-gradient(to right, #4ade80, #16a34a)"],["type","checkbox",1,"mt-1","h-4","w-4","rounded","border-gray-300","text-teal-600","focus:ring-teal-500","shrink-0",3,"change","checked"],[1,"transition-colors","flex-1"],["name","flag-outline",1,"text-4xl","text-gray-400"],[1,"mt-2"],[1,"bg-indigo-600","h-3.5","rounded-full","transition-all","duration-500",2,"background-image","linear-gradient(to right, #818cf8, #4f46e5)",3,"width"],[1,"bg-indigo-600","h-3.5","rounded-full","transition-all","duration-500",2,"background-image","linear-gradient(to right, #818cf8, #4f46e5)"],["type","checkbox",1,"mt-1","h-4","w-4","rounded","border-gray-300","text-indigo-600","focus:ring-indigo-500","shrink-0",3,"change","checked"],[1,"bg-white","rounded-xl","shadow-2xl","w-full","max-w-2xl","max-h-[90vh]","flex","flex-col","m-4"],[1,"flex","justify-between","items-center","p-4","border-b"],[1,"text-lg","font-semibold"],[1,"text-gray-400","hover:text-gray-600",3,"click"],["name","close-outline",1,"text-2xl"],[1,"p-6","overflow-y-auto"],[1,"space-y-4",3,"ngSubmit","formGroup"],["for","title",1,"block","text-sm","font-medium","text-gray-700"],["id","title","formControlName","title",1,"mt-1","block","w-full","rounded-md","border-gray-300","shadow-sm","bg-gray-50","p-2"],[1,"grid","grid-cols-1","md:grid-cols-2","gap-4"],["for","ownerId",1,"block","text-sm","font-medium","text-gray-700"],["id","ownerId","formControlName","ownerId",1,"mt-1","block","w-full","rounded-md","border-gray-300","shadow-sm","bg-gray-50","p-2"],["value","","disabled",""],["for","dueDate",1,"block","text-sm","font-medium","text-gray-700"],["type","date","id","dueDate","formControlName","dueDate",1,"mt-1","block","w-full","rounded-md","border-gray-300","shadow-sm","bg-gray-50","p-2"],["for","period",1,"block","text-sm","font-medium","text-gray-700"],["id","period","formControlName","period",1,"mt-1","block","w-full","rounded-md","border-gray-300","shadow-sm","bg-gray-50","p-2"],["value","monthly"],["value","weekly"],["for","status",1,"block","text-sm","font-medium","text-gray-700"],["id","status","formControlName","status",1,"mt-1","block","w-full","rounded-md","border-gray-300","shadow-sm","bg-gray-50","p-2"],[1,"space-y-2","pt-2"],[1,"text-sm","font-medium","text-gray-700"],["formArrayName","keyResults",1,"space-y-2"],[1,"flex","items-center","gap-2",3,"formGroupName"],["type","button",1,"text-sm","font-medium","text-indigo-600","hover:text-indigo-800",3,"click"],[1,"flex","justify-end","gap-4","pt-4","border-t","mt-4"],["type","button",1,"px-4","py-2","border","rounded-md",3,"click"],["type","submit",1,"px-4","py-2","bg-indigo-600","text-white","rounded-md","disabled:bg-indigo-300","flex","items-center","gap-2",3,"disabled"],["formControlName","description","placeholder","\u8F38\u5165\u95DC\u9375\u6210\u679C\u63CF\u8FF0...",1,"flex-grow","rounded-md","border-gray-300","shadow-sm","bg-gray-50","p-2","text-sm"],["type","button","title","\u522A\u9664",1,"text-red-500","hover:text-red-700","p-1.5","rounded-full","hover:bg-red-100",3,"click"],[1,"bg-white","rounded-xl","shadow-2xl","w-full","max-w-md","m-4"],[1,"p-6","text-center"],[1,"mx-auto","flex","items-center","justify-center","h-12","w-12","rounded-full","bg-red-100"],["name","warning-outline",1,"h-6","w-6","text-red-600"],[1,"mt-4","text-lg","font-semibold","text-gray-900"],[1,"mt-2","text-sm","text-gray-500"],[1,"flex","justify-center","gap-4","bg-gray-50","px-6","py-4","rounded-b-xl"],["type","button",1,"px-4","py-2","bg-red-600","text-white","rounded-md","hover:bg-red-700","disabled:bg-red-300","flex","items-center","gap-2",3,"click","disabled"]],template:function(t,i){if(t&1&&(l(0,"div",0)(1,"div",1)(2,"h1",2),d(3,"\u500B\u4EBA\u76EE\u6A19\u9032\u5EA6"),s(),l(4,"button",3),b("click",function(){return i.openModal(null)}),x(5,"ion-icon",4),l(6,"span"),d(7,"\u65B0\u589E\u500B\u4EBA\u76EE\u6A19"),s()()(),M(8,TG,4,0,"div",5),M(9,IG,4,0,"div",6),l(10,"div",7)(11,"div")(12,"label",8),d(13,"\u72C0\u614B"),s(),l(14,"select",9),K("ngModelChange",function(o){return Q(i.statusFilter,o)||(i.statusFilter=o),o}),l(15,"option",10),d(16,"\u6240\u6709\u72C0\u614B"),s(),l(17,"option",11),d(18,"\u9032\u884C\u4E2D"),s(),l(19,"option",12),d(20,"\u5DF2\u5B8C\u6210"),s(),l(21,"option",13),d(22,"\u843D\u5F8C"),s(),l(23,"option",14),d(24,"\u5DF2\u64F1\u7F6E"),s()()(),l(25,"div")(26,"label",15),d(27,"\u8CA0\u8CAC\u4EBA"),s(),l(28,"select",16),K("ngModelChange",function(o){return Q(i.ownerFilter,o)||(i.ownerFilter=o),o}),l(29,"option",10),d(30,"\u6240\u6709\u8CA0\u8CAC\u4EBA"),s(),V(31,MG,2,2,"option",17,ss),s()(),l(33,"div",18)(34,"button",19),b("click",function(){return i.resetFilters()}),x(35,"ion-icon",20),s()()(),l(36,"div",21)(37,"div")(38,"h2",22),x(39,"ion-icon",23),d(40," \u6BCF\u9031\u76EE\u6A19 "),s(),l(41,"div",24),V(42,PG,32,9,"div",25,ss,!1,kG,4,0,"div",26),s()(),l(45,"div")(46,"h2",27),x(47,"ion-icon",28),d(48," \u6708\u5EA6\u76EE\u6A19 "),s(),l(49,"div",24),V(50,UG,32,9,"div",25,ss,!1,$G,4,0,"div",26),s()()()(),M(53,WG,62,4,"div",29),M(54,zG,16,3,"div",29)),t&2){let r;m(8),A(i.loading()?8:-1),m(),A(i.processing()?9:-1),m(5),J("ngModel",i.statusFilter),m(14),J("ngModel",i.ownerFilter),m(3),L(i.shareholders()),m(11),L(i.weeklyGoals()),m(8),L(i.monthlyGoals()),m(3),A(i.isModalOpen()?53:-1),m(),A((r=i.goalToDelete())?54:-1,r)}},dependencies:[se,rh,Be,Ve,He,Ge,be,Oe,fe,ke,Le,Ue,qn,Wn,De,Ie],encapsulation:2,changeDetection:0});var Tp=as;var YG=(n,e)=>e.id;function JG(n,e){if(n&1&&(l(0,"option",11),d(1),s()),n&2){let t=e.$implicit;I("value",t),m(),w(t)}}function KG(n,e){if(n&1&&(l(0,"option",11),d(1),s()),n&2){let t=e.$implicit;I("value",t),m(),w(t)}}function QG(n,e){if(n&1){let t=B();l(0,"tr",19)(1,"td",21),d(2),s(),l(3,"td",22),d(4),s(),l(5,"td",22)(6,"span",23),d(7),s()(),l(8,"td",22)(9,"span",23),d(10),s()(),l(11,"td",24),d(12),s(),l(13,"td",22)(14,"div",25)(15,"button",26),b("click",function(){let r=E(t).$implicit,o=_();return S(o.openModal(r))}),x(16,"ion-icon",27),s(),l(17,"button",28),b("click",function(){let r=E(t).$implicit,o=_();return S(o.requestDelete(r))}),x(18,"ion-icon",29),s()()()()}if(n&2){let t=e.$implicit,i=_();m(2),w(t.name),m(2),w(t.email),m(2),Te(i.getRoleClass(t.role)),m(),w(t.role),m(2),Te(i.getStatusClass(t.status)),m(),w(t.status),m(2),w(t.lastLogin),m(3),I("disabled",!i.canUpdateUsers()),m(2),I("disabled",!i.canDeleteUsers())}}function ZG(n,e){n&1&&(l(0,"tr")(1,"td",30),d(2,"\u7121\u7B26\u5408\u689D\u4EF6\u7684\u4F7F\u7528\u8005\u3002"),s()())}function XG(n,e){if(n&1&&(l(0,"option",11),d(1),s()),n&2){let t=e.$implicit;I("value",t),m(),w(t)}}function eq(n,e){if(n&1&&(l(0,"option",11),d(1),s()),n&2){let t=e.$implicit;I("value",t),m(),w(t)}}function tq(n,e){if(n&1){let t=B();l(0,"div",20)(1,"div",31)(2,"div",32)(3,"h3",33),d(4),s(),l(5,"button",34),b("click",function(){E(t);let r=_();return S(r.closeModal())}),x(6,"ion-icon",35),s()(),l(7,"div",36)(8,"form",37),b("ngSubmit",function(){E(t);let r=_();return S(r.handleFormSubmit())}),l(9,"label",38)(10,"span",39),d(11,"\u540D\u7A31*"),s(),x(12,"input",40),s(),l(13,"label",38)(14,"span",39),d(15,"Email*"),s(),x(16,"input",41),s(),l(17,"div",42)(18,"label",38)(19,"span",39),d(20,"\u89D2\u8272*"),s(),l(21,"select",43),V(22,XG,2,2,"option",11,Y),s()(),l(24,"label",38)(25,"span",39),d(26,"\u72C0\u614B*"),s(),l(27,"select",44),V(28,eq,2,2,"option",11,Y),s()()(),l(30,"div",45)(31,"button",46),b("click",function(){E(t);let r=_();return S(r.closeModal())}),d(32,"\u53D6\u6D88"),s(),l(33,"button",47),d(34,"\u5132\u5B58"),s()()()()()()}if(n&2){let t=_();m(4),w(t.editingUser()?"\u7DE8\u8F2F\u4F7F\u7528\u8005":"\u65B0\u589E\u4F7F\u7528\u8005"),m(4),I("formGroup",t.userForm),m(14),L(t.roles()),m(6),L(t.statuses()),m(5),I("disabled",t.userForm.invalid||(t.editingUser()?!t.canUpdateUsers():!t.canCreateUsers()))}}function nq(n,e){if(n&1){let t=B();l(0,"div",20)(1,"div",48)(2,"div",49)(3,"div",50),x(4,"ion-icon",51),s(),l(5,"h3",52),d(6,"\u78BA\u5B9A\u8981\u522A\u9664\u4F7F\u7528\u8005\u55CE\uFF1F"),s(),l(7,"p",53),d(8),s()(),l(9,"div",54)(10,"button",46),b("click",function(){E(t);let r=_();return S(r.cancelDelete())}),d(11,"\u53D6\u6D88"),s(),l(12,"button",55),b("click",function(){E(t);let r=_();return S(r.confirmDelete())}),d(13,"\u78BA\u8A8D\u522A\u9664"),s()()()()}if(n&2){let t=_();m(8),N("\u60A8\u78BA\u5B9A\u8981\u522A\u9664\u300C",e.name,"\u300D\u55CE\uFF1F\u6B64\u64CD\u4F5C\u7121\u6CD5\u5FA9\u539F\u3002"),m(4),I("disabled",!t.canDeleteUsers())}}var ls=class ls{constructor(){this.baseUrl=`${Gn.apiUrl}/admin`;this.authService=k(st);this.fb=k(qe);this.http=k(Hn);this.isModalOpen=D(!1);this.editingUser=D(null);this.userToDelete=D(null);this.searchTerm=D("");this.roleFilter=D("");this.statusFilter=D("");this.users=D([]);this.roleOptions=D([]);this.roles=D(["\u8D85\u7D1A\u7BA1\u7406\u54E1","\u7BA1\u7406\u54E1","\u8CA1\u52D9","\u71DF\u904B"]);this.statuses=D(["\u555F\u7528","\u505C\u7528"]);this.isLoading=D(!1);this.error=D(null);this.canCreateUsers=D(!1);this.canUpdateUsers=D(!1);this.canDeleteUsers=D(!1);this.userForm=this.fb.group({name:["",U.required],email:["",[U.required,U.email]],role:["\u71DF\u904B",U.required],status:["\u555F\u7528",U.required]});this.filteredUsers=$(()=>{let e=this.searchTerm().toLowerCase(),t=this.roleFilter(),i=this.statusFilter();return this.users().filter(r=>!t||r.role===t).filter(r=>!i||r.status===i).filter(r=>!e||r.name.toLowerCase().includes(e)||r.email.toLowerCase().includes(e))})}resetFilters(){this.searchTerm.set(""),this.roleFilter.set(""),this.statusFilter.set("")}ngOnInit(){let e=this.authService.hasRole("viewer"),t=this.authService.hasPermission("manage_admins")||this.authService.hasRole("super_admin");this.canCreateUsers.set(!e&&(this.authService.hasPermission("create_admins")||t)),this.canUpdateUsers.set(!e&&(this.authService.hasPermission("update_admins")||t)),this.canDeleteUsers.set(!e&&(this.authService.hasPermission("delete_admins")||t)),this.loadRoles(),this.loadUsers()}loadRoles(){let e=this.getAuthHeaders();e&&this.http.get(`${this.baseUrl}/roles?limit=100`,{headers:e}).subscribe({next:t=>{let i=t?.data||[];if(this.roleOptions.set(i),i.length>0){let r=Array.from(new Set(i.map(o=>String(o.display_name||o.role_name||"").trim()).filter(o=>!!o)));this.roles.set(r.length>0?r:["\u8D85\u7D1A\u7BA1\u7406\u54E1","\u7BA1\u7406\u54E1","\u8CA1\u52D9","\u71DF\u904B"])}},error:()=>{}})}loadUsers(){let e=this.getAuthHeaders();if(!e){this.error.set("\u5C1A\u672A\u767B\u5165");return}this.isLoading.set(!0),this.error.set(null);let t=[];this.searchTerm()&&t.push(`search=${encodeURIComponent(this.searchTerm())}`);let i=this.mapRoleToCode(this.roleFilter()||void 0);i&&t.push(`role=${encodeURIComponent(i)}`);let r=t.length?`?${t.join("&")}`:"";this.http.get(`${this.baseUrl}/users${r}`,{headers:e}).subscribe({next:o=>{let u=(o?.data||[]).map(c=>this.mapUser(c));this.users.set(u),this.isLoading.set(!1)},error:o=>{this.error.set(o.error?.error||"\u8F09\u5165\u4F7F\u7528\u8005\u5931\u6557"),this.isLoading.set(!1)}})}openModal(e=null){if(!(e?this.canUpdateUsers():this.canCreateUsers())){this.error.set(e?"\u60A8\u6C92\u6709\u7DE8\u8F2F\u4F7F\u7528\u8005\u7684\u6B0A\u9650":"\u60A8\u6C92\u6709\u65B0\u589E\u4F7F\u7528\u8005\u7684\u6B0A\u9650");return}this.editingUser.set(e),this.userForm.reset({role:"\u71DF\u904B",status:"\u555F\u7528"}),e&&(e.role&&!this.roles().includes(e.role)&&this.roles.update(i=>[...i,e.role]),this.userForm.patchValue(e)),this.userForm.updateValueAndValidity(),this.isModalOpen.set(!0)}closeModal(){this.isModalOpen.set(!1)}handleFormSubmit(){if(!(this.editingUser()?this.canUpdateUsers():this.canCreateUsers())){this.error.set(this.editingUser()?"\u60A8\u6C92\u6709\u7DE8\u8F2F\u4F7F\u7528\u8005\u7684\u6B0A\u9650":"\u60A8\u6C92\u6709\u65B0\u589E\u4F7F\u7528\u8005\u7684\u6B0A\u9650");return}if(this.userForm.invalid)return;let t=this.getAuthHeaders();if(!t){this.error.set("\u5C1A\u672A\u767B\u5165");return}let i=this.userForm.value,r=this.mapRoleToId(i.role),o={name:i.name,email:i.email,status:this.mapStatusToApi(i.status),roleIds:r?[r]:[]};if(this.editingUser()){let a=this.editingUser().id;this.http.put(`${this.baseUrl}/users/${a}`,o,{headers:t}).subscribe({next:()=>{this.closeModal(),this.loadUsers()},error:u=>{this.error.set(u.error?.error||"\u66F4\u65B0\u4F7F\u7528\u8005\u5931\u6557")}});return}this.http.post(`${this.baseUrl}/users`,o,{headers:t}).subscribe({next:()=>{this.closeModal(),this.loadUsers()},error:a=>{this.error.set(a.error?.error||"\u65B0\u589E\u4F7F\u7528\u8005\u5931\u6557")}})}requestDelete(e){if(!this.canDeleteUsers()){this.error.set("\u60A8\u6C92\u6709\u522A\u9664\u4F7F\u7528\u8005\u7684\u6B0A\u9650");return}this.userToDelete.set(e)}confirmDelete(){if(!this.canDeleteUsers()){this.error.set("\u60A8\u6C92\u6709\u522A\u9664\u4F7F\u7528\u8005\u7684\u6B0A\u9650");return}if(!this.userToDelete())return;let e=this.getAuthHeaders();if(!e){this.error.set("\u5C1A\u672A\u767B\u5165");return}let t=this.userToDelete().id;this.http.delete(`${this.baseUrl}/users/${t}`,{headers:e}).subscribe({next:()=>{this.cancelDelete(),this.loadUsers()},error:i=>{this.error.set(i.error?.error||"\u522A\u9664\u4F7F\u7528\u8005\u5931\u6557")}})}cancelDelete(){this.userToDelete.set(null)}getRoleClass(e){switch(e){case"\u7BA1\u7406\u54E1":return"bg-red-100 text-red-800";case"\u8CA1\u52D9":return"bg-blue-100 text-blue-800";case"\u71DF\u904B":return"bg-green-100 text-green-800";default:return"bg-gray-100 text-gray-800"}}getStatusClass(e){return e==="\u555F\u7528"?"bg-green-100 text-green-800":"bg-gray-100 text-gray-800"}getAuthHeaders(){let e=this.authService.getToken();return e?new tn({Authorization:`Bearer ${e}`,"Content-Type":"application/json"}):null}mapUser(e){let t=String(e.role_names&&e.role_names[0]||"").trim(),i=String(e.role_codes&&e.role_codes[0]||"").trim(),r=t||i||"\u71DF\u904B",o=this.mapStatusFromApi(e.status);return{id:String(e.admin_id),name:e.name,email:e.email,role:r,status:o,lastLogin:this.formatDate(e.last_login_at)}}mapRoleToId(e){if(!e)return null;let t=String(e).trim();return this.roleOptions().find(r=>r.display_name===t||r.role_name===t)?.role_id??null}mapRoleToCode(e){if(!e)return null;let t=String(e).trim();return this.roleOptions().find(r=>r.display_name===t||r.role_name===t)?.role_name??null}mapStatusToApi(e){if(e)return e==="\u555F\u7528"?"active":"inactive"}mapStatusFromApi(e){return e==="active"?"\u555F\u7528":"\u505C\u7528"}formatDate(e){return e?new Date(e).toLocaleDateString("zh-TW",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"}):"-"}};ls.\u0275fac=function(t){return new(t||ls)},ls.\u0275cmp=re({type:ls,selectors:[["app-user-management"]],decls:49,vars:7,consts:[[1,"space-y-6"],[1,"flex","flex-wrap","items-center","justify-between","gap-4"],[1,"text-3xl","font-bold","text-gray-900"],[1,"bg-indigo-600","text-white","px-4","py-2","rounded-lg","font-medium","hover:bg-indigo-700","transition-colors","flex","items-center","gap-2","text-sm","disabled:bg-indigo-300","disabled:cursor-not-allowed",3,"click","disabled"],["name","add-outline"],[1,"bg-white","p-6","rounded-xl","shadow-md"],[1,"grid","grid-cols-1","md:grid-cols-4","gap-4","p-4","bg-gray-50","rounded-lg","mb-6"],[1,"md:col-span-2"],["type","text","placeholder","\u641C\u5C0B\u540D\u7A31\u6216 Email...",1,"w-full","border-gray-300","rounded-lg","shadow-sm","focus:ring-indigo-500","focus:border-indigo-500","text-sm","p-2","bg-white",3,"ngModelChange","ngModel"],[1,"w-full","border-gray-300","rounded-lg","shadow-sm","focus:ring-indigo-500","focus:border-indigo-500","text-sm","p-2","bg-white",3,"ngModelChange","ngModel"],["value",""],[3,"value"],[1,"flex","items-center","gap-2","md:col-span-4","justify-end"],["title","\u91CD\u8A2D\u7BE9\u9078",1,"text-gray-500","hover:text-gray-800","transition-colors","p-2","rounded-full","bg-gray-100","hover:bg-gray-200",3,"click"],["name","refresh-outline",1,"text-xl"],[1,"overflow-x-auto"],[1,"w-full","text-sm","text-left","whitespace-nowrap"],[1,"text-xs","text-gray-700","uppercase","bg-gray-100"],[1,"px-4","py-3"],[1,"border-b","hover:bg-gray-50"],[1,"fixed","inset-0","bg-black","bg-opacity-50","flex","items-center","justify-center","z-50"],[1,"px-4","py-2","font-medium"],[1,"px-4","py-2"],[1,"px-2","py-1","text-xs","font-semibold","rounded-full"],[1,"px-4","py-2","text-gray-500"],[1,"flex","items-center","gap-2"],["title","\u7DE8\u8F2F",1,"text-indigo-600","hover:text-indigo-800","p-1","disabled:text-gray-300","disabled:cursor-not-allowed",3,"click","disabled"],["name","create-outline",1,"text-lg"],["title","\u522A\u9664",1,"text-red-500","hover:text-red-700","p-1","disabled:text-gray-300","disabled:cursor-not-allowed",3,"click","disabled"],["name","trash-outline",1,"text-lg"],["colspan","6",1,"text-center","py-8","text-gray-500"],[1,"bg-white","rounded-xl","shadow-2xl","w-full","max-w-lg","m-4"],[1,"flex","justify-between","items-center","p-4","border-b"],[1,"text-lg","font-semibold"],[1,"text-gray-400","hover:text-gray-600",3,"click"],["name","close-outline",1,"text-2xl"],[1,"p-6"],[1,"space-y-4",3,"ngSubmit","formGroup"],[1,"block"],[1,"text-gray-700"],["formControlName","name",1,"mt-1","block","w-full","rounded-md","border-gray-300","shadow-sm","bg-gray-50","p-2"],["type","email","formControlName","email",1,"mt-1","block","w-full","rounded-md","border-gray-300","shadow-sm","bg-gray-50","p-2"],[1,"grid","grid-cols-2","gap-4"],["formControlName","role",1,"mt-1","block","w-full","rounded-md","border-gray-300","shadow-sm","bg-gray-50","p-2"],["formControlName","status",1,"mt-1","block","w-full","rounded-md","border-gray-300","shadow-sm","bg-gray-50","p-2"],[1,"flex","justify-end","gap-4","pt-4","border-t","mt-4"],["type","button",1,"px-4","py-2","border","rounded-md",3,"click"],["type","submit",1,"px-4","py-2","bg-indigo-600","text-white","rounded-md","disabled:bg-indigo-300",3,"disabled"],[1,"bg-white","rounded-xl","shadow-2xl","w-full","max-w-md","m-4"],[1,"p-6","text-center"],[1,"mx-auto","flex","items-center","justify-center","h-12","w-12","rounded-full","bg-red-100"],["name","warning-outline",1,"h-6","w-6","text-red-600"],[1,"mt-4","text-lg","font-semibold","text-gray-900"],[1,"mt-2","text-sm","text-gray-500"],[1,"flex","justify-center","gap-4","bg-gray-50","px-6","py-4","rounded-b-xl"],["type","button",1,"px-4","py-2","bg-red-600","text-white","rounded-md","hover:bg-red-700","disabled:bg-red-300","disabled:cursor-not-allowed",3,"click","disabled"]],template:function(t,i){if(t&1&&(l(0,"div",0)(1,"div",1)(2,"h1",2),d(3,"\u4F7F\u7528\u8005\u7BA1\u7406"),s(),l(4,"button",3),b("click",function(){return i.openModal(null)}),x(5,"ion-icon",4),l(6,"span"),d(7,"\u65B0\u589E\u4F7F\u7528\u8005"),s()()(),l(8,"div",5)(9,"div",6)(10,"div",7)(11,"input",8),b("ngModelChange",function(o){return i.searchTerm.set(o)}),s()(),l(12,"div")(13,"select",9),b("ngModelChange",function(o){return i.roleFilter.set(o)}),l(14,"option",10),d(15,"\u6240\u6709\u89D2\u8272"),s(),V(16,JG,2,2,"option",11,Y),s()(),l(18,"div")(19,"select",9),b("ngModelChange",function(o){return i.statusFilter.set(o)}),l(20,"option",10),d(21,"\u6240\u6709\u72C0\u614B"),s(),V(22,KG,2,2,"option",11,Y),s()(),l(24,"div",12)(25,"button",13),b("click",function(){return i.resetFilters()}),x(26,"ion-icon",14),s()()(),l(27,"div",15)(28,"table",16)(29,"thead",17)(30,"tr")(31,"th",18),d(32,"\u540D\u7A31"),s(),l(33,"th",18),d(34,"Email"),s(),l(35,"th",18),d(36,"\u89D2\u8272"),s(),l(37,"th",18),d(38,"\u72C0\u614B"),s(),l(39,"th",18),d(40,"\u6700\u5F8C\u767B\u5165"),s(),l(41,"th",18),d(42,"\u64CD\u4F5C"),s()()(),l(43,"tbody"),V(44,QG,19,11,"tr",19,YG,!1,ZG,3,0,"tr"),s()()()()(),M(47,tq,35,3,"div",20),M(48,nq,14,2,"div",20)),t&2){let r;m(4),I("disabled",!i.canCreateUsers()),m(7),I("ngModel",i.searchTerm()),m(2),I("ngModel",i.roleFilter()),m(3),L(i.roles()),m(3),I("ngModel",i.statusFilter()),m(3),L(i.statuses()),m(22),L(i.filteredUsers()),m(3),A(i.isModalOpen()?47:-1),m(),A((r=i.userToDelete())?48:-1,r)}},dependencies:[se,Be,Ve,He,Ge,be,Oe,fe,ke,Le,Ue,De,Ie],encapsulation:2,changeDetection:0});var Ip=ls;var ds=(n,e)=>e.id;function iq(n,e){n&1&&(l(0,"div",5),x(1,"ion-icon",29),l(2,"span"),d(3,"\u8F09\u5165\u4E2D..."),s()())}function rq(n,e){n&1&&(l(0,"div",6),x(1,"ion-icon",29),l(2,"span"),d(3,"\u8655\u7406\u4E2D..."),s()())}function oq(n,e){if(n&1&&(l(0,"option",11),d(1),s()),n&2){let t=e.$implicit;I("value",t),m(),w(t)}}function aq(n,e){if(n&1&&(l(0,"option",11),d(1),s()),n&2){let t=e.$implicit;I("value",t),m(),w(t)}}function sq(n,e){if(n&1&&(l(0,"option",11),d(1),s()),n&2){let t=e.$implicit;I("value",t.id),m(),w(t.name)}}function lq(n,e){if(n&1&&(l(0,"div",53),x(1,"ion-icon",54),l(2,"span"),d(3),s()()),n&2){let t=e,i=_(2);Te(i.getDaysLeftClass(t.days,t.label)),m(3),w(t.label==="\u5DF2\u903E\u671F"?t.label+" "+t.days+" \u5929":t.days+" "+t.label)}}function uq(n,e){if(n&1&&x(0,"img",35),n&2){let t=_().$implicit,i=_();I("src",i.getAssigneeAvatarUrl(t.assigneeId),qt)}}function dq(n,e){n&1&&(l(0,"div",36),x(1,"ion-icon",55),s())}function cq(n,e){if(n&1&&x(0,"div",56),n&2){let t=_().$implicit,i=_();Xt("width",i.getProgressBarWidth(t),"%")}}function mq(n,e){if(n&1&&x(0,"div",57),n&2){let t=_().$implicit,i=_();Xt("width",i.getProgressBarWidth(t),"%")}}function pq(n,e){if(n&1){let t=B();l(0,"div",58)(1,"div",60)(2,"span"),d(3),s(),l(4,"span"),d(5),s()(),l(6,"div",61)(7,"input",62),b("input",function(r){E(t);let o=_().$implicit,a=_(2);return S(a.setKrCurrentDraft(o.id,r.target.value))}),s(),l(8,"button",63),b("click",function(){E(t);let r=_().$implicit,o=_(2);return S(o.confirmKrCurrentValue(r))}),d(9,"\u78BA\u5B9A"),s()(),l(10,"div",64),x(11,"div",65),s()()}if(n&2){let t=_().$implicit,i=_(2);m(3),w(t.resultName),m(2),Lt("",i.formatNumber(t.currentValue||0)," / ",i.formatNumber(t.targetValue||0)," ",t.unit),m(2),I("value",i.getKrCurrentDraft(t)),m(4),Xt("width",i.getKrProgress(t),"%")}}function fq(n,e){if(n&1){let t=B();l(0,"label",59)(1,"input",66),b("change",function(r){E(t);let o=_().$implicit,a=_(2);return S(a.toggleKrCheckbox(o.id,r.target.checked))}),s(),l(2,"span"),d(3),s()()}if(n&2){let t=_().$implicit,i=_(2);m(),I("checked",i.isKrChecked(t)),m(2),w(t.resultName)}}function gq(n,e){if(n&1&&M(0,pq,12,7,"div",58)(1,fq,4,2,"label",59),n&2){let t=e.$implicit,i=_(2);A(i.isKrWithTarget(t)?0:1)}}function hq(n,e){n&1&&(l(0,"p",47),d(1,"\u5C1A\u7121\u95DC\u9375\u6210\u679C"),s())}function yq(n,e){if(n&1){let t=B();l(0,"div",23)(1,"div",30)(2,"h3",31),d(3),s(),M(4,lq,4,3,"div",32),s(),l(5,"div",33)(6,"div",34),M(7,uq,1,1,"img",35)(8,dq,2,0,"div",36),l(9,"span",37),d(10),s()(),l(11,"span",38),d(12),s(),l(13,"span",39),d(14),s()(),l(15,"div",40)(16,"div",41)(17,"div",42),d(18),s(),l(19,"span"),d(20),s()(),l(21,"div",43),M(22,cq,1,2,"div",44)(23,mq,1,2,"div",45),s()(),l(24,"div",46),V(25,gq,2,1,null,null,ds,!1,hq,2,0,"p",47),s(),l(28,"div",48)(29,"button",49),b("click",function(){let r=E(t).$implicit,o=_();return S(o.openModal(r))}),x(30,"ion-icon",50),s(),l(31,"button",51),b("click",function(){let r=E(t).$implicit,o=_();return S(o.requestDelete(r))}),x(32,"ion-icon",52),s()()()}if(n&2){let t,i=e.$implicit,r=_();m(3),w(i.title),m(),A((t=r.getDaysLeft(i.endDate))?4:-1,t),m(3),A(i.assigneeId?7:8),m(3),w(r.getAssigneeName(i.assigneeId)),m(),Te(r.getTypeClass(i.type)),m(),w(i.type),m(),Te(r.getStatusClass(i.status)),m(),w(i.status),m(4),N("\u95DC\u9375\u6210\u679C ",i.keyResults.length," \u9805"),m(),Te(r.getProgressBarWidth(i)<100?"text-indigo-600":"text-green-600"),m(),N("",r.getProgressBarWidth(i).toFixed(0),"%"),m(2),A(r.getProgressBarWidth(i)<100?22:23),m(3),L(i.keyResults)}}function _q(n,e){n&1&&(l(0,"div",24),x(1,"ion-icon",67),l(2,"p",68),d(3,"\u7121\u7B26\u5408\u689D\u4EF6\u7684\u6708\u5EA6\u76EE\u6A19\u3002"),s()())}function vq(n,e){if(n&1&&(l(0,"div",53),x(1,"ion-icon",54),l(2,"span"),d(3),s()()),n&2){let t=e,i=_(2);Te(i.getDaysLeftClass(t.days,t.label)),m(3),w(t.label==="\u5DF2\u903E\u671F"?t.label+" "+t.days+" \u5929":t.days+" "+t.label)}}function Cq(n,e){if(n&1&&x(0,"img",35),n&2){let t=_().$implicit,i=_();I("src",i.getAssigneeAvatarUrl(t.assigneeId),qt)}}function xq(n,e){n&1&&(l(0,"div",36),x(1,"ion-icon",55),s())}function bq(n,e){if(n&1&&x(0,"div",72),n&2){let t=_().$implicit,i=_();Xt("width",i.getProgressBarWidth(t),"%")}}function Eq(n,e){if(n&1&&x(0,"div",57),n&2){let t=_().$implicit,i=_();Xt("width",i.getProgressBarWidth(t),"%")}}function Sq(n,e){if(n&1){let t=B();l(0,"div",58)(1,"div",60)(2,"span"),d(3),s(),l(4,"span"),d(5),s()(),l(6,"div",61)(7,"input",62),b("input",function(r){E(t);let o=_().$implicit,a=_(2);return S(a.setKrCurrentDraft(o.id,r.target.value))}),s(),l(8,"button",73),b("click",function(){E(t);let r=_().$implicit,o=_(2);return S(o.confirmKrCurrentValue(r))}),d(9,"\u78BA\u5B9A"),s()(),l(10,"div",64),x(11,"div",74),s()()}if(n&2){let t=_().$implicit,i=_(2);m(3),w(t.resultName),m(2),Lt("",i.formatNumber(t.currentValue||0)," / ",i.formatNumber(t.targetValue||0)," ",t.unit),m(2),I("value",i.getKrCurrentDraft(t)),m(4),Xt("width",i.getKrProgress(t),"%")}}function Dq(n,e){if(n&1){let t=B();l(0,"label",59)(1,"input",75),b("change",function(r){E(t);let o=_().$implicit,a=_(2);return S(a.toggleKrCheckbox(o.id,r.target.checked))}),s(),l(2,"span"),d(3),s()()}if(n&2){let t=_().$implicit,i=_(2);m(),I("checked",i.isKrChecked(t)),m(2),w(t.resultName)}}function wq(n,e){if(n&1&&M(0,Sq,12,7,"div",58)(1,Dq,4,2,"label",59),n&2){let t=e.$implicit,i=_(2);A(i.isKrWithTarget(t)?0:1)}}function Tq(n,e){n&1&&(l(0,"p",47),d(1,"\u5C1A\u7121\u95DC\u9375\u6210\u679C"),s())}function Iq(n,e){if(n&1){let t=B();l(0,"div",27)(1,"div",30)(2,"h3",69),d(3),s(),M(4,vq,4,3,"div",32),s(),l(5,"div",33)(6,"div",34),M(7,Cq,1,1,"img",35)(8,xq,2,0,"div",36),l(9,"span",37),d(10),s()(),l(11,"span",38),d(12),s(),l(13,"span",39),d(14),s()(),l(15,"div",40)(16,"div",41)(17,"div",42),d(18),s(),l(19,"span"),d(20),s()(),l(21,"div",43),M(22,bq,1,2,"div",70)(23,Eq,1,2,"div",45),s()(),l(24,"div",46),V(25,wq,2,1,null,null,ds,!1,Tq,2,0,"p",47),s(),l(28,"div",48)(29,"button",71),b("click",function(){let r=E(t).$implicit,o=_();return S(o.openModal(r))}),x(30,"ion-icon",50),s(),l(31,"button",51),b("click",function(){let r=E(t).$implicit,o=_();return S(o.requestDelete(r))}),x(32,"ion-icon",52),s()()()}if(n&2){let t,i=e.$implicit,r=_();m(3),w(i.title),m(),A((t=r.getDaysLeft(i.endDate))?4:-1,t),m(3),A(i.assigneeId?7:8),m(3),w(r.getAssigneeName(i.assigneeId)),m(),Te(r.getTypeClass(i.type)),m(),w(i.type),m(),Te(r.getStatusClass(i.status)),m(),w(i.status),m(4),N("\u95DC\u9375\u6210\u679C ",i.keyResults.length," \u9805"),m(),Te(r.getProgressBarWidth(i)<100?"text-teal-600":"text-green-600"),m(),N("",r.getProgressBarWidth(i).toFixed(0),"%"),m(2),A(r.getProgressBarWidth(i)<100?22:23),m(3),L(i.keyResults)}}function Mq(n,e){n&1&&(l(0,"div",24),x(1,"ion-icon",67),l(2,"p",68),d(3,"\u7121\u7B26\u5408\u689D\u4EF6\u7684\u5E74\u5EA6\u76EE\u6A19\u3002"),s()())}function Aq(n,e){if(n&1&&(l(0,"option",11),d(1),s()),n&2){let t=e.$implicit;I("value",t),m(),w(t)}}function Rq(n,e){if(n&1&&(l(0,"option",11),d(1),s()),n&2){let t=e.$implicit;I("value",t.id),m(),w(t.name)}}function Nq(n,e){n&1&&(l(0,"div",114)(1,"div")(2,"label",110),d(3,"\u76EE\u524D\u9032\u5EA6*"),s(),x(4,"input",115),s(),l(5,"div")(6,"label",110),d(7,"\u76EE\u6A19\u503C*"),s(),x(8,"input",116),s(),l(9,"div")(10,"label",110),d(11,"\u55AE\u4F4D*"),s(),x(12,"input",117),s()())}function Fq(n,e){if(n&1){let t=B();l(0,"div",102)(1,"div",107)(2,"span",108),d(3),s(),l(4,"button",109),b("click",function(){let r=E(t).$index,o=_(2);return S(o.removeKeyResult(r))}),x(5,"ion-icon",52),s()(),l(6,"div")(7,"label",110),d(8,"\u6A19\u984C*"),s(),x(9,"input",111),s(),l(10,"label",112)(11,"input",113),b("change",function(){let r=E(t).$index,o=_(2);return S(o.onToggleSetTarget(r))}),s(),l(12,"span"),d(13,"\u8A2D\u5B9A\u76EE\u6A19\u503C"),s()(),M(14,Nq,13,0,"div",114),s()}if(n&2){let t,i=e.$implicit,r=e.$index;I("formGroupName",r),m(3),N("\u95DC\u9375\u6210\u679C #",r+1),m(11),A((t=i.get("setTarget"))!=null&&t.value?14:-1)}}function Pq(n,e){n&1&&x(0,"ion-icon",29)}function kq(n,e){if(n&1){let t=B();l(0,"div",28)(1,"div",76)(2,"div",77)(3,"h3",78),d(4),s(),l(5,"button",79),b("click",function(){E(t);let r=_();return S(r.closeModal())}),x(6,"ion-icon",80),s()(),l(7,"div",81)(8,"form",82),b("ngSubmit",function(){E(t);let r=_();return S(r.handleFormSubmit())}),l(9,"div")(10,"label",83),d(11,"\u76EE\u6A19\u540D\u7A31*"),s(),x(12,"input",84),s(),l(13,"div",85)(14,"div")(15,"label",86),d(16,"\u985E\u578B*"),s(),l(17,"select",87),V(18,Aq,2,2,"option",11,Y),s()(),l(20,"div")(21,"label",88),d(22,"\u9031\u671F*"),s(),l(23,"select",89)(24,"option",90),d(25,"\u6708\u5EA6"),s(),l(26,"option",91),d(27,"\u5E74\u5EA6"),s()()()(),l(28,"div",85)(29,"div")(30,"label",92),d(31,"\u958B\u59CB\u65E5\u671F*"),s(),x(32,"input",93),s(),l(33,"div")(34,"label",94),d(35,"\u7D50\u675F\u65E5\u671F*"),s(),x(36,"input",95),s()(),l(37,"div")(38,"label",96),d(39,"\u8CA0\u8CAC\u4EBA*"),s(),l(40,"select",97)(41,"option",98),d(42,"\u8ACB\u9078\u64C7\u8CA0\u8CAC\u4EBA"),s(),V(43,Rq,2,2,"option",11,ds),s()(),l(45,"div",99)(46,"h4",100),d(47,"\u95DC\u9375\u6210\u679C"),s(),l(48,"div",101),V(49,Fq,15,3,"div",102,sn),s(),l(51,"button",103),b("click",function(){E(t);let r=_();return S(r.addKeyResult())}),d(52,"+ \u65B0\u589E\u95DC\u9375\u6210\u679C"),s()(),l(53,"div",104)(54,"button",105),b("click",function(){E(t);let r=_();return S(r.closeModal())}),d(55,"\u53D6\u6D88"),s(),l(56,"button",106),M(57,Pq,1,0,"ion-icon",29),l(58,"span"),d(59,"\u5132\u5B58"),s()()()()()()()}if(n&2){let t=_();m(4),w(t.editingGoal()?"\u7DE8\u8F2F\u5718\u968A\u76EE\u6A19":"\u65B0\u589E\u5718\u968A\u76EE\u6A19"),m(4),I("formGroup",t.goalForm),m(10),L(t.goalTypes),m(25),L(t.users()),m(6),L(t.keyResults.controls),m(7),I("disabled",t.goalForm.invalid||t.processing()),m(),A(t.processing()?57:-1)}}function Vq(n,e){n&1&&x(0,"ion-icon",29)}function Lq(n,e){if(n&1){let t=B();l(0,"div",28)(1,"div",118)(2,"div",119)(3,"div",120),x(4,"ion-icon",121),s(),l(5,"h3",122),d(6,"\u78BA\u5B9A\u8981\u522A\u9664\u5718\u968A\u76EE\u6A19\u55CE\uFF1F"),s(),l(7,"p",123),d(8),s()(),l(9,"div",124)(10,"button",105),b("click",function(){E(t);let r=_();return S(r.cancelDelete())}),d(11,"\u53D6\u6D88"),s(),l(12,"button",125),b("click",function(){E(t);let r=_();return S(r.confirmDelete())}),M(13,Vq,1,0,"ion-icon",29),l(14,"span"),d(15,"\u78BA\u8A8D\u522A\u9664"),s()()()()()}if(n&2){let t=_();m(8),N("\u60A8\u78BA\u5B9A\u8981\u522A\u9664\u5718\u968A\u76EE\u6A19\u300C",e.title,"\u300D\u55CE\uFF1F\u6B64\u64CD\u4F5C\u7121\u6CD5\u5FA9\u539F\u3002"),m(4),I("disabled",t.processing()),m(),A(t.processing()?13:-1)}}var us=class us{constructor(){this.apiService=k(we);this.fb=k(qe);this.isModalOpen=D(!1);this.editingGoal=D(null);this.goalToDelete=D(null);this.editingProgressId=D(null);this.krCurrentDraft=D({});this.loading=D(!1);this.processing=D(!1);this.statusFilter=D("");this.typeFilter=D("");this.assigneeFilter=D("");this.allGoals=D([]);this.users=D([]);this.goalTypes=["\u5E97\u5167","\u8CA1\u52D9","\u6D3B\u52D5","\u884C\u92B7","\u7CFB\u7D71","\u6703\u54E1","\u52A0\u76DF"];this.goalStatuses=["\u9032\u884C\u4E2D","\u5DF2\u9054\u6210","\u672A\u9054\u6210"];this.goalForm=this.fb.group({title:["",U.required],type:["\u5E97\u5167",U.required],period:["monthly",U.required],startDate:["",U.required],endDate:["",U.required],assigneeId:["",U.required],keyResults:this.fb.array([])});this.baseFilteredGoals=$(()=>{let e=this.statusFilter(),t=this.typeFilter(),i=this.assigneeFilter();return this.allGoals().filter(r=>!e||r.status===e).filter(r=>!t||r.type===t).filter(r=>!i||i==="all"||r.assigneeId===i).sort((r,o)=>new Date(o.startDate).getTime()-new Date(r.startDate).getTime())});this.monthlyGoals=$(()=>this.baseFilteredGoals().filter(e=>e.period==="monthly"));this.yearlyGoals=$(()=>this.baseFilteredGoals().filter(e=>e.period==="yearly"));this.loadData()}get keyResults(){return this.goalForm.get("keyResults")}toUiStatus(e){return e==="completed"?"\u5DF2\u9054\u6210":e==="cancelled"?"\u672A\u9054\u6210":"\u9032\u884C\u4E2D"}toDbStatus(e){return e==="\u5DF2\u9054\u6210"?"completed":e==="\u672A\u9054\u6210"?"cancelled":"in_progress"}parseGoalType(e){let i=String(e||"").match(/^:(.+)$/)?.[1];return i&&this.goalTypes.includes(i)?i:"\u5E97\u5167"}getPeriod(e,t){if(!e||!t)return"monthly";let i=new Date(e),r=new Date(t);return Math.ceil((r.getTime()-i.getTime())/(1e3*60*60*24))>180?"yearly":"monthly"}async loadData(){this.loading.set(!0);try{let[e,t]=await Promise.all([this.apiService.getEmployeeInfo(),this.apiService.getCollaborationGoals({includeKeyResults:!0})]);if(e.success&&e.data){let i=e.data.map(r=>({id:String(r.id),name:r.employee_name,email:r.email||"",role:"\u71DF\u904B",status:r.is_active?"\u555F\u7528":"\u505C\u7528",lastLogin:""}));this.users.set(i)}if(t.success&&t.data){let i=t.data.map(r=>{let o=(Array.isArray(r.keyResults)?r.keyResults:[]).filter(g=>g.resultName!=="__AUTO_PROGRESS__").map(g=>({id:Number(g.id),resultName:g.resultName||"",resultType:g.resultType==="boolean"?"boolean":"numeric",unit:g.unit||"",targetValue:g.targetValue!==null?Number(g.targetValue):null,currentValue:g.currentValue!==null?Number(g.currentValue):null,isAchieved:g.isAchieved??null,achievementRate:Number(g.achievementRate||0)})),a=o.filter(g=>g.resultType==="numeric").reduce((g,y)=>g+Number(y.targetValue||0),0),u=o.filter(g=>g.resultType==="numeric").reduce((g,y)=>g+Number(y.currentValue||0),0),c=o[0]?.unit||"",p=this.parseGoalType(r.goalDescription);return{id:String(r.id),title:r.goalName||"",type:p,targetValue:a,currentValue:u,startDate:r.startDate?String(r.startDate).split("T")[0]:new Date().toISOString().split("T")[0],endDate:r.dueDate?String(r.dueDate).split("T")[0]:new Date().toISOString().split("T")[0],status:this.toUiStatus(r.status),unit:c,assigneeId:r.ownerEmployeeId?String(r.ownerEmployeeId):void 0,period:this.getPeriod(r.startDate,r.dueDate),ownerEmployeeId:Number(r.ownerEmployeeId),keyResults:o,achievementRate:Number(r.achievementRate||0)}});this.allGoals.set(i)}}catch(e){console.error("Error loading collaboration goals:",e),alert("\u8F09\u5165\u8CC7\u6599\u5931\u6557")}finally{this.loading.set(!1)}}resetFilters(){this.statusFilter.set(""),this.typeFilter.set(""),this.assigneeFilter.set("")}openModal(e=null){if(this.editingGoal.set(e),this.keyResults.clear(),e)this.goalForm.patchValue({title:e.title,type:e.type,period:e.period,startDate:e.startDate,endDate:e.endDate,assigneeId:e.assigneeId||""}),e.keyResults.forEach(t=>this.addKeyResult({id:String(t.id),title:t.resultName,setTarget:t.resultType==="numeric",currentValue:t.currentValue,targetValue:t.targetValue,unit:t.unit,isAchieved:t.isAchieved}));else{let t=new Date,i=new Date(t.getFullYear(),t.getMonth(),1).toISOString().split("T")[0],r=new Date(t.getFullYear(),t.getMonth()+1,0).toISOString().split("T")[0],o=this.users()[0]?.id||"";this.goalForm.reset({title:"",type:"\u5E97\u5167",period:"monthly",startDate:i,endDate:r,assigneeId:o}),this.addKeyResult()}this.isModalOpen.set(!0)}closeModal(){this.isModalOpen.set(!1)}addKeyResult(e){this.keyResults.push(this.fb.group({id:[e?.id||""],title:[e?.title||"",U.required],setTarget:[e?.setTarget??!1],currentValue:[e?.currentValue??0],targetValue:[e?.targetValue??1],unit:[e?.unit||"\u662F\u5426"],isAchieved:[e?.isAchieved??!1]}))}onToggleSetTarget(e){let t=this.keyResults.at(e);!!t.get("setTarget")?.value||t.patchValue({currentValue:0,targetValue:1,unit:"\u662F\u5426",isAchieved:!1},{emitEvent:!1})}removeKeyResult(e){this.keyResults.removeAt(e)}async handleFormSubmit(){if(this.goalForm.invalid)return;let e=this.goalForm.value,t=this.editingGoal(),i=e.keyResults||[];if(i.length===0){alert("\u8ACB\u81F3\u5C11\u65B0\u589E\u4E00\u7B46\u95DC\u9375\u6210\u679C");return}for(let u of i)if(u.setTarget&&(u.currentValue===void 0||u.targetValue===void 0||Number(u.targetValue)<=0||!String(u.unit||"").trim())){alert("\u6709\u52FE\u9078\u300C\u8A2D\u5B9A\u76EE\u6A19\u503C\u300D\u7684\u95DC\u9375\u6210\u679C\uFF0C\u8ACB\u5B8C\u6574\u586B\u5BEB\u76EE\u524D\u9032\u5EA6\u3001\u76EE\u6A19\u503C\u8207\u55AE\u4F4D");return}let o=i.filter(u=>u.setTarget?Number(u.currentValue||0)>=Number(u.targetValue||0):!!u.isAchieved).length===i.length?"\u5DF2\u9054\u6210":"\u9032\u884C\u4E2D",a={goalName:e.title,goalDescription:e.type?`\u985E\u578B:${e.type}`:null,ownerEmployeeId:Number(e.assigneeId),startDate:e.startDate,dueDate:e.endDate,status:this.toDbStatus(o)};this.processing.set(!0);try{let u=0;if(t){let g=await this.apiService.updateCollaborationGoal(O({id:Number(t.id)},a));if(!g.success)throw new Error(g.error||"\u66F4\u65B0\u5931\u6557");u=Number(t.id)}else{let g=await this.apiService.createCollaborationGoal(a);if(!g.success||!g.data?.id)throw new Error(g.error||"\u65B0\u589E\u5931\u6557");u=Number(g.data.id)}let c=new Set((t?.keyResults||[]).map(g=>Number(g.id)).filter(g=>Number.isFinite(g)&&g>0)),p=new Set;for(let g of i){let y=!!g.setTarget,v=y?Number(g.targetValue||0):1,C=y?Number(g.currentValue||0):0,T=y?null:Number(C)>=Number(v),R=y?Number(C||0)>=Number(v||0)?"completed":"in_progress":Number(C)>=Number(v)?"completed":"in_progress",F=Number(g.id||0);F?(p.add(F),await this.apiService.updateCollaborationKeyResult({id:F,resultName:g.title||"",resultType:y?"numeric":"boolean",unit:y?g.unit||"":"\u662F\u5426",targetValue:v,currentValue:C,isAchieved:T,status:R})):await this.apiService.createCollaborationKeyResult({goalId:u,resultName:g.title||"",resultType:y?"numeric":"boolean",unit:y?g.unit||"":"\u662F\u5426",targetValue:v,currentValue:C,isAchieved:T,status:R})}for(let g of c)p.has(g)||await this.apiService.deleteCollaborationKeyResult(g);await this.loadData(),this.closeModal()}catch(u){console.error(u),alert(u?.message||"\u5132\u5B58\u5931\u6557")}finally{this.processing.set(!1)}}startEditingProgress(){}finishEditingProgress(){}requestDelete(e){this.goalToDelete.set(e)}async confirmDelete(){if(this.goalToDelete()){this.processing.set(!0);try{await this.apiService.deleteCollaborationGoal(Number(this.goalToDelete().id)),await this.loadData(),this.cancelDelete()}catch(e){alert(e?.message||"\u522A\u9664\u5931\u6557")}finally{this.processing.set(!1)}}}cancelDelete(){this.goalToDelete.set(null)}getProgressBarWidth(e){return Math.max(0,Math.min(100,e.achievementRate||0))}getAssigneeName(e){return e?this.users().find(t=>t.id===e)?.name||"\u672A\u77E5\u4F7F\u7528\u8005":"\u672A\u6307\u5B9A"}getAssigneeAvatarUrl(e){let t=this.getAssigneeName(e);return`https://ui-avatars.com/api/?name=${encodeURIComponent(t)}&background=random&color=fff&font-size=0.5`}getDaysLeft(e){let t=new Date(e),i=new Date;t.setHours(0,0,0,0),i.setHours(0,0,0,0);let r=t.getTime()-i.getTime(),o=Math.ceil(r/(1e3*60*60*24));return o<0?{days:Math.abs(o),label:"\u5DF2\u903E\u671F"}:{days:o,label:"\u5929\u5269\u9918"}}getDaysLeftClass(e,t){return t==="\u5DF2\u903E\u671F"?"text-red-500":e<=7?"text-yellow-600":"text-gray-500"}getTypeClass(e){switch(e){case"\u5E97\u5167":return"bg-blue-100 text-blue-800";case"\u8CA1\u52D9":return"bg-green-100 text-green-800";case"\u6D3B\u52D5":return"bg-purple-100 text-purple-800";case"\u884C\u92B7":return"bg-pink-100 text-pink-800";case"\u7CFB\u7D71":return"bg-slate-100 text-slate-800";case"\u6703\u54E1":return"bg-amber-100 text-amber-800";case"\u52A0\u76DF":return"bg-cyan-100 text-cyan-800"}}getStatusClass(e){switch(e){case"\u9032\u884C\u4E2D":return"bg-blue-100 text-blue-800";case"\u5DF2\u9054\u6210":return"bg-green-100 text-green-800";case"\u672A\u9054\u6210":return"bg-red-100 text-red-800";default:return"bg-gray-100 text-gray-800"}}formatNumber(e){return e.toLocaleString("en-US")}getKrCurrentDraft(e){let i=this.krCurrentDraft()[e.id];return i!==void 0?i:String(e.currentValue??0)}setKrCurrentDraft(e,t){this.krCurrentDraft.update(i=>G(O({},i),{[e]:t}))}getKrProgress(e){if(!this.isKrWithTarget(e))return this.isKrChecked(e)?100:0;let t=Number(e.targetValue||0);return t<=0?0:Math.max(0,Math.min(100,Number(e.currentValue||0)/t*100))}isKrWithTarget(e){return e.resultType==="numeric"&&e.targetValue!==null}isKrChecked(e){return this.isKrWithTarget(e)?Number(e.currentValue||0)>=Number(e.targetValue||0):Number(e.currentValue||0)>=Number(e.targetValue||1)||!!e.isAchieved}async toggleKrCheckbox(e,t){this.processing.set(!0);try{let i=await this.apiService.updateCollaborationKeyResult({id:e,resultType:"boolean",targetValue:1,currentValue:t?1:0,isAchieved:t,status:t?"completed":"in_progress"});if(!i.success)throw new Error(i.error||"\u66F4\u65B0\u95DC\u9375\u6210\u679C\u72C0\u614B\u5931\u6557");await this.loadData()}catch(i){alert(i?.message||"\u66F4\u65B0\u95DC\u9375\u6210\u679C\u72C0\u614B\u5931\u6557")}finally{this.processing.set(!1)}}async confirmKrCurrentValue(e){if(!this.isKrWithTarget(e))return;let t=this.getKrCurrentDraft(e).trim(),i=Number(t);if(!Number.isFinite(i)||i<0){alert("\u8ACB\u8F38\u5165\u6709\u6548\u7684\u76EE\u524D\u9032\u5EA6\u6578\u5B57");return}this.processing.set(!0);try{let r=Number(e.targetValue||0),o=await this.apiService.updateCollaborationKeyResult({id:e.id,resultType:"numeric",currentValue:i,targetValue:r,status:i>=r?"completed":"in_progress"});if(!o.success)throw new Error(o.error||"\u66F4\u65B0\u76EE\u524D\u9032\u5EA6\u5931\u6557");await this.loadData()}catch(r){alert(r?.message||"\u66F4\u65B0\u76EE\u524D\u9032\u5EA6\u5931\u6557")}finally{this.processing.set(!1)}}};us.\u0275fac=function(t){return new(t||us)},us.\u0275cmp=re({type:us,selectors:[["app-goal-setting"]],decls:57,vars:9,consts:[[1,"space-y-6"],[1,"flex","flex-wrap","items-center","justify-between","gap-4"],[1,"text-3xl","font-bold","text-gray-900"],[1,"bg-indigo-600","text-white","px-4","py-2","rounded-lg","font-medium","hover:bg-indigo-700","transition-colors","flex","items-center","gap-2","text-sm",3,"click"],["name","add-outline"],[1,"flex","items-center","gap-2","text-sm","text-indigo-600"],[1,"flex","items-center","gap-2","text-sm","text-amber-600"],[1,"grid","grid-cols-1","md:grid-cols-4","gap-4","p-4","bg-white","rounded-xl","shadow-md"],["for","typeFilter",1,"text-sm","font-medium","text-gray-600"],["id","typeFilter",1,"w-full","mt-1","border-gray-300","rounded-lg","shadow-sm","focus:ring-indigo-500","focus:border-indigo-500","text-sm","p-2","bg-gray-50",3,"ngModelChange","ngModel"],["value",""],[3,"value"],["for","statusFilter",1,"text-sm","font-medium","text-gray-600"],["id","statusFilter",1,"w-full","mt-1","border-gray-300","rounded-lg","shadow-sm","focus:ring-indigo-500","focus:border-indigo-500","text-sm","p-2","bg-gray-50",3,"ngModelChange","ngModel"],["for","assigneeFilter",1,"text-sm","font-medium","text-gray-600"],["id","assigneeFilter",1,"w-full","mt-1","border-gray-300","rounded-lg","shadow-sm","focus:ring-indigo-500","focus:border-indigo-500","text-sm","p-2","bg-gray-50",3,"ngModelChange","ngModel"],[1,"flex","items-end","justify-end"],["title","\u91CD\u8A2D\u7BE9\u9078",1,"text-gray-500","hover:text-gray-800","transition-colors","p-2","rounded-full","bg-gray-100","hover:bg-gray-200",3,"click"],["name","refresh-outline",1,"text-xl"],[1,"grid","grid-cols-1","lg:grid-cols-2","gap-8","pt-4"],[1,"text-2xl","font-bold","text-gray-800","mb-4","pb-2","border-b-2","border-indigo-500","flex","items-center","gap-2"],["name","calendar-outline"],[1,"space-y-4"],[1,"bg-white","rounded-lg","shadow-sm","border","p-4","flex","flex-col","group","relative","transition-all","duration-300","hover:shadow-md","hover:border-indigo-300"],[1,"bg-white","p-6","rounded-xl","border","text-center","text-gray-500"],[1,"text-2xl","font-bold","text-gray-800","mb-4","pb-2","border-b-2","border-teal-500","flex","items-center","gap-2"],["name","podium-outline"],[1,"bg-white","rounded-lg","shadow-sm","border","p-4","flex","flex-col","group","relative","transition-all","duration-300","hover:shadow-md","hover:border-teal-300"],[1,"fixed","inset-0","bg-black","bg-opacity-50","flex","items-center","justify-center","z-50"],["name","reload-outline",1,"animate-spin"],[1,"flex","justify-between","items-start","gap-2"],[1,"font-bold","text-gray-800","group-hover:text-indigo-600","transition-colors"],[1,"flex","items-center","text-xs","font-medium","shrink-0",3,"class"],[1,"flex","items-center","gap-4","text-sm","text-gray-500","mt-2"],[1,"flex","items-center","gap-2"],["alt","avatar",1,"w-5","h-5","rounded-full",3,"src"],[1,"w-5","h-5","rounded-full","bg-gray-200","flex","items-center","justify-center"],[1,"font-medium","text-xs"],[1,"text-xs","font-semibold","px-2","py-0.5","rounded-full"],[1,"text-xs","font-semibold","px-2","py-1","rounded-full"],[1,"mt-3"],[1,"flex","justify-between","items-center","mb-1","text-xs","font-medium"],[1,"text-gray-600"],[1,"w-full","bg-slate-100","rounded-full","h-1.5"],[1,"bg-indigo-600","h-1.5","rounded-full","transition-all","duration-500",2,"background-image","linear-gradient(to right, #818cf8, #4f46e5)",3,"width"],[1,"bg-green-500","h-1.5","rounded-full","transition-all","duration-500",2,"background-image","linear-gradient(to right, #4ade80, #16a34a)",3,"width"],[1,"mt-3","space-y-1","border-t","pt-3"],[1,"text-xs","text-gray-400"],[1,"absolute","top-2","right-2","flex","items-center","gap-1","bg-white/50","backdrop-blur-sm","rounded-full","p-1","opacity-0","group-hover:opacity-100","transition-opacity","duration-300"],["title","\u7DE8\u8F2F",1,"text-gray-500","hover:text-indigo-600","p-1.5","rounded-full","hover:bg-gray-100",3,"click"],["name","create-outline"],["title","\u522A\u9664",1,"text-gray-500","hover:text-red-600","p-1.5","rounded-full","hover:bg-gray-100",3,"click"],["name","trash-outline"],[1,"flex","items-center","text-xs","font-medium","shrink-0"],["name","time-outline",1,"mr-1"],["name","people-outline",1,"text-gray-500","text-xs"],[1,"bg-indigo-600","h-1.5","rounded-full","transition-all","duration-500",2,"background-image","linear-gradient(to right, #818cf8, #4f46e5)"],[1,"bg-green-500","h-1.5","rounded-full","transition-all","duration-500",2,"background-image","linear-gradient(to right, #4ade80, #16a34a)"],[1,"text-xs","text-gray-700","bg-gray-50","rounded","px-2","py-2"],[1,"text-xs","text-gray-700","flex","items-center","gap-2","bg-gray-50","rounded","px-2","py-1"],[1,"flex","items-center","justify-between"],[1,"mt-2","flex","items-center","justify-end","gap-2"],["type","number","min","0",1,"w-24","rounded","border-gray-300","px-2","py-1","text-xs",3,"input","value"],["type","button",1,"rounded","bg-indigo-600","px-2","py-1","text-white","text-xs","hover:bg-indigo-700",3,"click"],[1,"mt-1","w-full","bg-slate-200","rounded-full","h-1.5"],[1,"bg-indigo-600","h-1.5","rounded-full","transition-all","duration-300"],["type","checkbox",1,"h-3.5","w-3.5","rounded","border-gray-300","text-indigo-600",3,"change","checked"],["name","trophy-outline",1,"text-4xl","text-gray-400"],[1,"mt-2"],[1,"font-bold","text-gray-800","group-hover:text-teal-600","transition-colors"],[1,"bg-teal-600","h-1.5","rounded-full","transition-all","duration-500",2,"background-image","linear-gradient(to right, #5eead4, #0d9488)",3,"width"],["title","\u7DE8\u8F2F",1,"text-gray-500","hover:text-teal-600","p-1.5","rounded-full","hover:bg-gray-100",3,"click"],[1,"bg-teal-600","h-1.5","rounded-full","transition-all","duration-500",2,"background-image","linear-gradient(to right, #5eead4, #0d9488)"],["type","button",1,"rounded","bg-teal-600","px-2","py-1","text-white","text-xs","hover:bg-teal-700",3,"click"],[1,"bg-teal-600","h-1.5","rounded-full","transition-all","duration-300"],["type","checkbox",1,"h-3.5","w-3.5","rounded","border-gray-300","text-teal-600",3,"change","checked"],[1,"bg-white","rounded-xl","shadow-2xl","w-full","max-w-lg","max-h-[90vh]","flex","flex-col","m-4"],[1,"flex","justify-between","items-center","p-4","border-b"],[1,"text-lg","font-semibold"],[1,"text-gray-400","hover:text-gray-600",3,"click"],["name","close-outline",1,"text-2xl"],[1,"p-6","overflow-y-auto"],[1,"space-y-4",3,"ngSubmit","formGroup"],["for","title",1,"block","text-sm","font-medium","text-gray-700"],["id","title","formControlName","title",1,"mt-1","block","w-full","rounded-md","border-gray-300","shadow-sm","bg-gray-50","p-2"],[1,"grid","grid-cols-1","md:grid-cols-2","gap-4"],["for","type",1,"block","text-sm","font-medium","text-gray-700"],["id","type","formControlName","type",1,"mt-1","block","w-full","rounded-md","border-gray-300","shadow-sm","bg-gray-50","p-2"],["for","period",1,"block","text-sm","font-medium","text-gray-700"],["id","period","formControlName","period",1,"mt-1","block","w-full","rounded-md","border-gray-300","shadow-sm","bg-gray-50","p-2"],["value","monthly"],["value","yearly"],["for","startDate",1,"block","text-sm","font-medium","text-gray-700"],["type","date","id","startDate","formControlName","startDate",1,"mt-1","block","w-full","rounded-md","border-gray-300","shadow-sm","bg-gray-50","p-2"],["for","endDate",1,"block","text-sm","font-medium","text-gray-700"],["type","date","id","endDate","formControlName","endDate",1,"mt-1","block","w-full","rounded-md","border-gray-300","shadow-sm","bg-gray-50","p-2"],["for","assigneeId",1,"block","text-sm","font-medium","text-gray-700"],["id","assigneeId","formControlName","assigneeId",1,"mt-1","block","w-full","rounded-md","border-gray-300","shadow-sm","bg-gray-50","p-2"],["value","","disabled",""],[1,"space-y-2","pt-2"],[1,"text-sm","font-medium","text-gray-700"],["formArrayName","keyResults",1,"space-y-3"],[1,"p-3","rounded-lg","border","bg-gray-50","space-y-2",3,"formGroupName"],["type","button",1,"text-sm","font-medium","text-indigo-600","hover:text-indigo-800",3,"click"],[1,"flex","justify-end","gap-4","pt-4","border-t","mt-4"],["type","button",1,"px-4","py-2","border","rounded-md",3,"click"],["type","submit",1,"px-4","py-2","bg-indigo-600","text-white","rounded-md","disabled:bg-indigo-300","flex","items-center","gap-2",3,"disabled"],[1,"flex","justify-between","items-center"],[1,"text-xs","font-semibold","text-gray-600"],["type","button","title","\u522A\u9664",1,"text-red-500","hover:text-red-700","p-1","rounded-full","hover:bg-red-100",3,"click"],[1,"block","text-sm","font-medium","text-gray-700"],["formControlName","title",1,"mt-1","block","w-full","rounded-md","border-gray-300","shadow-sm","bg-white","p-2"],[1,"flex","items-center","gap-2","text-sm","text-gray-700"],["type","checkbox","formControlName","setTarget",1,"h-4","w-4","rounded","border-gray-300","text-indigo-600","focus:ring-indigo-500",3,"change"],[1,"grid","grid-cols-1","md:grid-cols-3","gap-2"],["type","number","formControlName","currentValue",1,"mt-1","block","w-full","rounded-md","border-gray-300","shadow-sm","bg-white","p-2"],["type","number","formControlName","targetValue",1,"mt-1","block","w-full","rounded-md","border-gray-300","shadow-sm","bg-white","p-2"],["formControlName","unit",1,"mt-1","block","w-full","rounded-md","border-gray-300","shadow-sm","bg-white","p-2"],[1,"bg-white","rounded-xl","shadow-2xl","w-full","max-w-md","m-4"],[1,"p-6","text-center"],[1,"mx-auto","flex","items-center","justify-center","h-12","w-12","rounded-full","bg-red-100"],["name","warning-outline",1,"h-6","w-6","text-red-600"],[1,"mt-4","text-lg","font-semibold","text-gray-900"],[1,"mt-2","text-sm","text-gray-500"],[1,"flex","justify-center","gap-4","bg-gray-50","px-6","py-4","rounded-b-xl"],["type","button",1,"px-4","py-2","bg-red-600","text-white","rounded-md","hover:bg-red-700","disabled:bg-red-300","flex","items-center","gap-2",3,"click","disabled"]],template:function(t,i){if(t&1&&(l(0,"div",0)(1,"div",1)(2,"h1",2),d(3,"\u5718\u968A\u76EE\u6A19\u8A2D\u5B9A"),s(),l(4,"button",3),b("click",function(){return i.openModal(null)}),x(5,"ion-icon",4),l(6,"span"),d(7,"\u65B0\u589E\u5718\u968A\u76EE\u6A19"),s()()(),M(8,iq,4,0,"div",5),M(9,rq,4,0,"div",6),l(10,"div",7)(11,"div")(12,"label",8),d(13,"\u985E\u578B"),s(),l(14,"select",9),K("ngModelChange",function(o){return Q(i.typeFilter,o)||(i.typeFilter=o),o}),l(15,"option",10),d(16,"\u6240\u6709\u985E\u578B"),s(),V(17,oq,2,2,"option",11,Y),s()(),l(19,"div")(20,"label",12),d(21,"\u72C0\u614B"),s(),l(22,"select",13),K("ngModelChange",function(o){return Q(i.statusFilter,o)||(i.statusFilter=o),o}),l(23,"option",10),d(24,"\u6240\u6709\u72C0\u614B"),s(),V(25,aq,2,2,"option",11,Y),s()(),l(27,"div")(28,"label",14),d(29,"\u8CA0\u8CAC\u4EBA"),s(),l(30,"select",15),K("ngModelChange",function(o){return Q(i.assigneeFilter,o)||(i.assigneeFilter=o),o}),l(31,"option",10),d(32,"\u6240\u6709\u4EBA"),s(),V(33,sq,2,2,"option",11,ds),s()(),l(35,"div",16)(36,"button",17),b("click",function(){return i.resetFilters()}),x(37,"ion-icon",18),s()()(),l(38,"div",19)(39,"div")(40,"h2",20),x(41,"ion-icon",21),d(42," \u6708\u5EA6\u76EE\u6A19 "),s(),l(43,"div",22),V(44,yq,33,16,"div",23,ds,!1,_q,4,0,"div",24),s()(),l(47,"div")(48,"h2",25),x(49,"ion-icon",26),d(50," \u5E74\u5EA6\u76EE\u6A19 "),s(),l(51,"div",22),V(52,Iq,33,16,"div",27,ds,!1,Mq,4,0,"div",24),s()()()(),M(55,kq,60,4,"div",28),M(56,Lq,16,3,"div",28)),t&2){let r;m(8),A(i.loading()?8:-1),m(),A(i.processing()?9:-1),m(5),J("ngModel",i.typeFilter),m(3),L(i.goalTypes),m(5),J("ngModel",i.statusFilter),m(3),L(i.goalStatuses),m(5),J("ngModel",i.assigneeFilter),m(3),L(i.users()),m(11),L(i.monthlyGoals()),m(8),L(i.yearlyGoals()),m(3),A(i.isModalOpen()?55:-1),m(),A((r=i.goalToDelete())?56:-1,r)}},dependencies:[se,Be,Ve,He,Ge,be,Bt,Xi,Oe,fe,ke,Le,Ue,qn,Wn,De,Ie],encapsulation:2,changeDetection:0});var Mp=us;var Oq=(n,e)=>e.targetId;function Bq(n,e){if(n&1&&(l(0,"div",5)(1,"div",12),x(2,"ion-icon",13),l(3,"p",14),d(4),s()()()),n&2){let t=_();m(4),w(t.successMessage())}}function Uq(n,e){if(n&1&&(l(0,"div",6)(1,"div",12),x(2,"ion-icon",15),l(3,"p",16),d(4),s()()()),n&2){let t=_();m(4),w(t.error())}}function $q(n,e){n&1&&(l(0,"div",8)(1,"div",17),x(2,"div",18),l(3,"p",19),d(4,"\u8F09\u5165\u8CC7\u6599\u4E2D..."),s()()())}function Hq(n,e){if(n&1){let t=B();l(0,"tr",25)(1,"td",26),d(2),s(),l(3,"td",23),d(4),s(),l(5,"td",23),d(6),s(),l(7,"td",27),d(8),s(),l(9,"td",28),d(10),s(),l(11,"td",29),d(12),s(),l(13,"td",22)(14,"div",30)(15,"button",31),b("click",function(){let r=E(t).$implicit,o=_(2);return S(o.openEditForm(r))}),x(16,"ion-icon",32),s(),l(17,"button",33),b("click",function(){let r=E(t).$implicit,o=_(2);return S(o.deleteTarget(r))}),x(18,"ion-icon",34),s()()()()}if(n&2){let t=e.$implicit,i=_(2);m(2),N(" ",i.formatMonth(t.targetMonth)," "),m(2),N(" ",i.formatCurrency(t.monthlyRevenueTarget)," "),m(2),N(" ",i.formatCurrency(t.eventRevenueTarget)," "),m(2),N(" ",i.formatCurrency(t.totalTarget)," "),m(2),N(" ",i.formatCurrency(t.dailyAvgTarget)," "),m(2),N(" ",t.remark||"-"," ")}}function Gq(n,e){n&1&&(l(0,"tr")(1,"td",35),d(2," \u5C1A\u7121\u8CC7\u6599 "),s()())}function qq(n,e){if(n&1&&(l(0,"div",9)(1,"table",20)(2,"thead",21)(3,"tr")(4,"th",22),d(5,"\u6708\u4EFD"),s(),l(6,"th",23),d(7,"\u6708\u71DF\u696D\u76EE\u6A19"),s(),l(8,"th",23),d(9,"\u6D3B\u52D5\u71DF\u6536\u76EE\u6A19"),s(),l(10,"th",23),d(11,"\u7E3D\u76EE\u6A19"),s(),l(12,"th",23),d(13,"\u65E5\u5747\u76EE\u6A19"),s(),l(14,"th",22),d(15,"\u5099\u8A3B"),s(),l(16,"th",24),d(17,"\u64CD\u4F5C"),s()()(),l(18,"tbody"),V(19,Hq,19,6,"tr",25,Oq,!1,Gq,3,0,"tr"),s()()()),n&2){let t=_();m(19),L(t.targets())}}function Wq(n,e){n&1&&(l(0,"div",10),x(1,"ion-icon",36),l(2,"p",37),d(3,"\u5C1A\u7121\u71DF\u6536\u76EE\u6A19\u8CC7\u6599"),s(),l(4,"p",38),d(5,"\u9EDE\u64CA\u4E0A\u65B9\u300C\u65B0\u589E\u76EE\u6A19\u300D\u6309\u9215\u958B\u59CB\u8A2D\u5B9A"),s()())}function jq(n,e){if(n&1&&(l(0,"div",6)(1,"div",12),x(2,"ion-icon",57),l(3,"p",58),d(4),s()()()),n&2){let t=_(2);m(4),w(t.formError())}}function zq(n,e){n&1&&(l(0,"p",48),d(1,"\u6708\u4EFD\u4E0D\u53EF\u4FEE\u6539"),s())}function Yq(n,e){n&1&&(x(0,"div",59),l(1,"span"),d(2,"\u8655\u7406\u4E2D..."),s())}function Jq(n,e){if(n&1&&(x(0,"ion-icon",60),l(1,"span"),d(2),s()),n&2){let t=_(2);m(2),w(t.isEditing()?"\u66F4\u65B0":"\u65B0\u589E")}}function Kq(n,e){if(n&1){let t=B();l(0,"div",11)(1,"div",39)(2,"div",40)(3,"h2",41),d(4),s(),l(5,"button",42),b("click",function(){E(t);let r=_();return S(r.closeForm())}),x(6,"ion-icon",43),s()(),l(7,"div",44),M(8,jq,5,1,"div",6),l(9,"div")(10,"label",45),d(11," \u6708\u4EFD "),l(12,"span",46),d(13,"*"),s()(),l(14,"input",47),b("ngModelChange",function(r){E(t);let o=_();return S(o.updateTargetMonth(r))}),s(),M(15,zq,2,0,"p",48),s(),l(16,"div")(17,"label",45),d(18," \u6708\u71DF\u696D\u76EE\u6A19 "),l(19,"span",46),d(20,"*"),s()(),l(21,"div",49)(22,"span",50),d(23,"NT$"),s(),l(24,"input",51),b("ngModelChange",function(r){E(t);let o=_();return S(o.updateMonthlyRevenueTarget(r))}),s()()(),l(25,"div")(26,"label",45),d(27," \u6D3B\u52D5\u71DF\u6536\u76EE\u6A19 "),s(),l(28,"div",49)(29,"span",50),d(30,"NT$"),s(),l(31,"input",52),b("ngModelChange",function(r){E(t);let o=_();return S(o.updateEventRevenueTarget(r))}),s()(),l(32,"p",48),d(33,"\u7279\u6B8A\u6D3B\u52D5\u6216\u4FC3\u92B7\u7684\u9810\u671F\u71DF\u6536\uFF08\u53EF\u9078\uFF09"),s()(),l(34,"div")(35,"label",45),d(36," \u5099\u8A3B "),s(),l(37,"textarea",53),b("ngModelChange",function(r){E(t);let o=_();return S(o.updateRemark(r))}),s()()(),l(38,"div",54)(39,"button",55),b("click",function(){E(t);let r=_();return S(r.closeForm())}),d(40," \u53D6\u6D88 "),s(),l(41,"button",56),b("click",function(){E(t);let r=_();return S(r.submitForm())}),M(42,Yq,3,0)(43,Jq,3,1),s()()()()}if(n&2){let t=_();m(4),N(" ",t.isEditing()?"\u7DE8\u8F2F\u71DF\u6536\u76EE\u6A19":"\u65B0\u589E\u71DF\u6536\u76EE\u6A19"," "),m(4),A(t.formError()?8:-1),m(6),I("ngModel",t.formData().targetMonth)("disabled",t.isEditing()),m(),A(t.isEditing()?15:-1),m(9),I("ngModel",t.formData().monthlyRevenueTarget),m(7),I("ngModel",t.formData().eventRevenueTarget),m(6),I("ngModel",t.formData().remark),m(2),I("disabled",t.isSaving()),m(2),I("disabled",t.isSaving()),m(),A(t.isSaving()?42:43)}}var cs=class cs{constructor(){this.apiService=k(we);this.targets=D([]);this.isLoading=D(!1);this.error=D(null);this.showForm=D(!1);this.isEditing=D(!1);this.formData=D({targetId:null,targetMonth:"",monthlyRevenueTarget:0,eventRevenueTarget:0,remark:""});this.formError=D(null);this.isSaving=D(!1);this.successMessage=D(null)}ngOnInit(){this.loadTargets()}async loadTargets(){this.isLoading.set(!0),this.error.set(null);try{let e=await this.apiService.getMonthlyTargets();if(e.success)this.targets.set(e.data||[]),console.log("\u2713 \u8F09\u5165\u6708\u5EA6\u71DF\u6536\u76EE\u6A19\u6210\u529F:",e.data.length,"\u7B46\u8A18\u9304");else throw new Error(e.error||"\u8F09\u5165\u5931\u6557")}catch(e){console.error("\u274C \u8F09\u5165\u6708\u5EA6\u71DF\u6536\u76EE\u6A19\u5931\u6557:",e);let t=e instanceof Error?e.message:"\u8F09\u5165\u8CC7\u6599\u5931\u6557\uFF0C\u8ACB\u7A0D\u5F8C\u91CD\u8A66";this.error.set(t)}finally{this.isLoading.set(!1)}}openAddForm(){this.isEditing.set(!1),this.formData.set({targetId:null,targetMonth:"",monthlyRevenueTarget:0,eventRevenueTarget:0,remark:""}),this.formError.set(null),this.showForm.set(!0)}openEditForm(e){this.isEditing.set(!0),this.formData.set({targetId:e.targetId,targetMonth:e.targetMonth.substring(0,7),monthlyRevenueTarget:e.monthlyRevenueTarget,eventRevenueTarget:e.eventRevenueTarget,remark:e.remark||""}),this.formError.set(null),this.showForm.set(!0)}closeForm(){this.showForm.set(!1),this.formError.set(null),this.formData.set({targetId:null,targetMonth:"",monthlyRevenueTarget:0,eventRevenueTarget:0,remark:""})}validateForm(){let e=this.formData();return e.targetMonth?e.monthlyRevenueTarget<0?"\u6708\u71DF\u696D\u76EE\u6A19\u4E0D\u53EF\u70BA\u8CA0\u6578":e.eventRevenueTarget<0?"\u6D3B\u52D5\u71DF\u6536\u76EE\u6A19\u4E0D\u53EF\u70BA\u8CA0\u6578":null:"\u8ACB\u9078\u64C7\u6708\u4EFD"}async submitForm(){let e=this.validateForm();if(e){this.formError.set(e);return}this.isSaving.set(!0),this.formError.set(null),this.successMessage.set(null);try{let t=this.formData(),i={targetMonth:`${t.targetMonth}-01`,monthlyRevenueTarget:t.monthlyRevenueTarget,eventRevenueTarget:t.eventRevenueTarget,remark:t.remark||null},r;if(this.isEditing()&&t.targetId?(r=await this.apiService.updateMonthlyTarget(O({targetId:t.targetId},i)),this.successMessage.set("\u66F4\u65B0\u6210\u529F\uFF01")):(r=await this.apiService.createMonthlyTarget(i),this.successMessage.set("\u65B0\u589E\u6210\u529F\uFF01")),r.success)await this.loadTargets(),this.closeForm(),setTimeout(()=>this.successMessage.set(null),3e3);else throw new Error(r.error||"\u64CD\u4F5C\u5931\u6557")}catch(t){console.error("\u274C \u63D0\u4EA4\u8868\u55AE\u5931\u6557:",t);let i=t instanceof Error?t.message:"\u64CD\u4F5C\u5931\u6557\uFF0C\u8ACB\u7A0D\u5F8C\u91CD\u8A66";t.message?.includes("\u5DF2\u5B58\u5728")&&(i="\u8A72\u6708\u4EFD\u7684\u71DF\u6536\u76EE\u6A19\u5DF2\u5B58\u5728\uFF0C\u8ACB\u4F7F\u7528\u7DE8\u8F2F\u529F\u80FD\u9032\u884C\u4FEE\u6539"),this.formError.set(i)}finally{this.isSaving.set(!1)}}async deleteTarget(e){if(confirm(`\u78BA\u5B9A\u8981\u522A\u9664 ${this.formatMonth(e.targetMonth)} \u7684\u71DF\u6536\u76EE\u6A19\u55CE\uFF1F`)){this.isLoading.set(!0),this.error.set(null),this.successMessage.set(null);try{let i=await this.apiService.deleteMonthlyTarget(e.targetId);if(i.success)this.successMessage.set("\u522A\u9664\u6210\u529F\uFF01"),await this.loadTargets(),setTimeout(()=>this.successMessage.set(null),3e3);else throw new Error(i.error||"\u522A\u9664\u5931\u6557")}catch(i){console.error("\u274C \u522A\u9664\u5931\u6557:",i);let r=i instanceof Error?i.message:"\u522A\u9664\u5931\u6557\uFF0C\u8ACB\u7A0D\u5F8C\u91CD\u8A66";this.error.set(r)}finally{this.isLoading.set(!1)}}}formatMonth(e){if(!e)return"";let t=new Date(e),i=t.getFullYear(),r=t.getMonth()+1;return`${i}\u5E74${r}\u6708`}formatCurrency(e){return e==null?"NT$0":`NT$${e.toLocaleString("zh-TW",{minimumFractionDigits:0,maximumFractionDigits:0})}`}updateTargetMonth(e){this.formData.update(t=>G(O({},t),{targetMonth:e}))}updateMonthlyRevenueTarget(e){this.formData.update(t=>G(O({},t),{monthlyRevenueTarget:+e}))}updateEventRevenueTarget(e){this.formData.update(t=>G(O({},t),{eventRevenueTarget:+e}))}updateRemark(e){this.formData.update(t=>G(O({},t),{remark:e}))}};cs.\u0275fac=function(t){return new(t||cs)},cs.\u0275cmp=re({type:cs,selectors:[["app-monthly-targets"]],decls:15,vars:6,consts:[[1,"space-y-8"],[1,"flex","items-center","justify-between"],[1,"text-3xl","font-bold","text-gray-900"],[1,"bg-indigo-600","text-white","px-4","py-2","rounded-lg","font-medium","hover:bg-indigo-700","transition-colors","flex","items-center","gap-2",3,"click"],["name","add-outline",1,"text-xl"],[1,"bg-green-50","border-l-4","border-green-500","p-4","rounded-lg"],[1,"bg-red-50","border-l-4","border-red-500","p-4","rounded-lg"],[1,"bg-white","p-6","rounded-xl","shadow-md"],[1,"flex","items-center","justify-center","h-64"],[1,"overflow-x-auto"],[1,"flex","flex-col","items-center","justify-center","h-64","text-gray-500"],[1,"fixed","inset-0","bg-black","bg-opacity-50","flex","items-center","justify-center","z-50","p-4"],[1,"flex","items-center","gap-3"],["name","checkmark-circle",1,"text-2xl","text-green-600"],[1,"text-green-900","font-medium"],["name","alert-circle-outline",1,"text-2xl","text-red-600"],[1,"text-red-900","font-medium"],[1,"flex","flex-col","items-center","space-y-2"],[1,"w-8","h-8","border-3","border-indigo-200","border-t-indigo-600","rounded-full","animate-spin"],[1,"text-sm","text-gray-500"],[1,"w-full","text-sm","text-left"],[1,"text-xs","text-gray-700","uppercase","bg-gray-50"],[1,"py-3","px-4"],[1,"py-3","px-4","text-right"],[1,"py-3","px-4","text-center"],[1,"border-b","hover:bg-gray-50","transition-colors"],[1,"py-3","px-4","font-medium","text-gray-900"],[1,"py-3","px-4","text-right","font-semibold","text-indigo-600"],[1,"py-3","px-4","text-right","text-gray-600"],[1,"py-3","px-4","text-gray-600"],[1,"flex","items-center","justify-center","gap-2"],["title","\u7DE8\u8F2F",1,"text-indigo-600","hover:text-indigo-800","p-1","rounded","transition-colors",3,"click"],["name","create-outline",1,"text-xl"],["title","\u522A\u9664",1,"text-red-600","hover:text-red-800","p-1","rounded","transition-colors",3,"click"],["name","trash-outline",1,"text-xl"],["colspan","7",1,"py-8","text-center","text-gray-500"],["name","document-text-outline",1,"text-6xl","mb-4"],[1,"text-lg","font-medium"],[1,"text-sm","mt-2"],[1,"bg-white","rounded-xl","shadow-xl","max-w-2xl","w-full","max-h-[90vh]","overflow-y-auto"],[1,"flex","items-center","justify-between","p-6","border-b"],[1,"text-2xl","font-bold","text-gray-900"],[1,"text-gray-400","hover:text-gray-600","transition-colors",3,"click"],["name","close-outline",1,"text-3xl"],[1,"p-6","space-y-4"],[1,"block","text-sm","font-medium","text-gray-700","mb-2"],[1,"text-red-500"],["type","month","required","",1,"w-full","px-3","py-2","border","border-gray-300","rounded-lg","focus:ring-2","focus:ring-indigo-500","focus:border-indigo-500","disabled:bg-gray-100","disabled:cursor-not-allowed",3,"ngModelChange","ngModel","disabled"],[1,"mt-1","text-xs","text-gray-500"],[1,"relative"],[1,"absolute","left-3","top-1/2","-translate-y-1/2","text-gray-500"],["type","number","min","0","step","1000","placeholder","0","required","",1,"w-full","pl-12","pr-3","py-2","border","border-gray-300","rounded-lg","focus:ring-2","focus:ring-indigo-500","focus:border-indigo-500",3,"ngModelChange","ngModel"],["type","number","min","0","step","1000","placeholder","0",1,"w-full","pl-12","pr-3","py-2","border","border-gray-300","rounded-lg","focus:ring-2","focus:ring-indigo-500","focus:border-indigo-500",3,"ngModelChange","ngModel"],["rows","3","placeholder","\u8F38\u5165\u5099\u8A3B\uFF08\u53EF\u9078\uFF09",1,"w-full","px-3","py-2","border","border-gray-300","rounded-lg","focus:ring-2","focus:ring-indigo-500","focus:border-indigo-500","resize-none",3,"ngModelChange","ngModel"],[1,"flex","items-center","justify-end","gap-3","p-6","border-t","bg-gray-50"],[1,"px-4","py-2","text-gray-700","bg-white","border","border-gray-300","rounded-lg","hover:bg-gray-50","transition-colors","disabled:opacity-50","disabled:cursor-not-allowed",3,"click","disabled"],[1,"px-4","py-2","bg-indigo-600","text-white","rounded-lg","hover:bg-indigo-700","transition-colors","flex","items-center","gap-2","disabled:opacity-50","disabled:cursor-not-allowed",3,"click","disabled"],["name","alert-circle-outline",1,"text-2xl","text-red-600","flex-shrink-0"],[1,"text-red-900","text-sm"],[1,"w-4","h-4","border-2","border-white","border-t-transparent","rounded-full","animate-spin"],["name","checkmark-outline",1,"text-xl"]],template:function(t,i){t&1&&(l(0,"div",0)(1,"div",1)(2,"h1",2),d(3,"\u71DF\u6536\u76EE\u6A19"),s(),l(4,"button",3),b("click",function(){return i.openAddForm()}),x(5,"ion-icon",4),l(6,"span"),d(7,"\u65B0\u589E\u76EE\u6A19"),s()()(),M(8,Bq,5,1,"div",5),M(9,Uq,5,1,"div",6),l(10,"div",7),M(11,$q,5,0,"div",8),M(12,qq,22,1,"div",9),M(13,Wq,6,0,"div",10),s(),M(14,Kq,44,11,"div",11),s()),t&2&&(m(8),A(i.successMessage()?8:-1),m(),A(i.error()?9:-1),m(2),A(i.isLoading()?11:-1),m(),A(!i.isLoading()&&i.targets().length>0?12:-1),m(),A(!i.isLoading()&&i.targets().length===0&&!i.error()?13:-1),m(),A(i.showForm()?14:-1))},dependencies:[se,De,be,Bt,fe,sy,_o,Ie],encapsulation:2});var Ap=cs;function Qq(n,e){if(n&1&&(rt(0,"div",4),d(1),ot()),n&2){let t=_();m(),N(" ",t.error()," ")}}var ms=class ms{constructor(e,t){this.authService=e;this.router=t;this.error=D(null)}ngOnInit(){this.authService.isAuthenticated()&&this.router.navigate(["/dashboard"]),this.loadGoogleSignInScript()}loadGoogleSignInScript(){if(window.google){this.initializeGoogleSignIn();return}let e=document.createElement("script");e.src="https://accounts.google.com/gsi/client",e.async=!0,e.defer=!0,e.onload=()=>this.initializeGoogleSignIn(),document.head.appendChild(e)}initializeGoogleSignIn(){let e=Gn.googleClientId;if(!e||e.includes("YOUR_")){console.warn("Google Client ID not configured. Please set VITE_GOOGLE_CLIENT_ID environment variable."),this.error.set("\u7CFB\u7D71\u672A\u6B63\u78BA\u914D\u7F6E Google OAuth\u3002\u8ACB\u806F\u7D61\u7BA1\u7406\u54E1\u3002");return}try{window.google.accounts.id.initialize({client_id:e,callback:i=>this.handleGoogleLogin(i)});let t=document.getElementById("google-signin-button");if(t){let i=Math.max(240,Math.min(400,Math.floor(t.getBoundingClientRect().width||320)));window.google.accounts.id.renderButton(t,{theme:"outline",size:"large",width:i})}}catch(t){console.error("Failed to initialize Google Sign-In:",t),this.error.set("\u7121\u6CD5\u521D\u59CB\u5316 Google \u767B\u5165")}}async handleGoogleLogin(e){try{e.credential&&(await this.authService.loginWithGoogle(e.credential)?this.router.navigate(["/dashboard"]):this.error.set(this.authService.error()||"Google \u767B\u5165\u5931\u6557"))}catch(t){console.error("Login error:",t),this.error.set("\u767B\u5165\u5931\u6557\uFF0C\u8ACB\u7A0D\u5F8C\u91CD\u8A66")}}};ms.\u0275fac=function(t){return new(t||ms)(ee(st),ee(Fe))},ms.\u0275cmp=re({type:ms,selectors:[["app-login"]],decls:15,vars:1,consts:[[1,"login-container"],[1,"login-box"],[1,"login-header"],[1,"subtitle"],[1,"error-message"],[1,"login-method"],["id","google-signin-button",1,"google-button-container"],[1,"footer-info"]],template:function(t,i){t&1&&(rt(0,"div",0)(1,"div",1)(2,"div",2)(3,"h1"),d(4,"Galaxy House Finance"),ot(),rt(5,"p",3),d(6,"\u7BA1\u7406\u7CFB\u7D71\u767B\u5165"),ot()(),M(7,Qq,2,1,"div",4),rt(8,"div",5),Ti(9,"div",6),ot(),rt(10,"div",7)(11,"p"),d(12,"\u6B64\u7CFB\u7D71\u9700\u8981\u4F7F\u7528 Google \u5E33\u865F\u767B\u5165"),ot(),rt(13,"p"),d(14,"\u5982\u6709\u554F\u984C\uFF0C\u8ACB\u806F\u7D61\u7BA1\u7406\u54E1"),ot()()()()),t&2&&(m(7),A(i.error()?7:-1))},dependencies:[se,De],styles:[".login-container[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center;min-height:100vh;background:linear-gradient(135deg,#8c4f28,#000);font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,sans-serif;padding:20px}.login-box[_ngcontent-%COMP%]{background:#efd07f;padding:40px;border-radius:12px;box-shadow:0 10px 40px #0000001a;width:100%;max-width:400px}.login-header[_ngcontent-%COMP%]{text-align:center;margin-bottom:30px}h1[_ngcontent-%COMP%]{color:#333;margin:0 0 8px;font-size:28px;font-weight:700}.subtitle[_ngcontent-%COMP%]{color:#666;margin:0;font-size:14px}.login-method[_ngcontent-%COMP%]{margin-bottom:20px}.google-button-container[_ngcontent-%COMP%]{margin-bottom:15px}.google-login-btn[_ngcontent-%COMP%]{width:100%;padding:12px;border:1px solid #ddd;border-radius:6px;background:#fff;color:#333;font-size:14px;font-weight:500;cursor:pointer;display:flex;align-items:center;justify-content:center;gap:10px;transition:all .3s ease}.google-login-btn[_ngcontent-%COMP%]:hover:not(:disabled){background:#f8f8f8;border-color:#ccc;box-shadow:0 2px 8px #0000001a}.error-message[_ngcontent-%COMP%]{background-color:#fee;color:#c00;padding:12px;border-radius:6px;font-size:13px;margin-bottom:20px;border:1px solid #fcc}.footer-info[_ngcontent-%COMP%]{text-align:center;margin-top:30px;color:#999;font-size:12px;line-height:1.6}.footer-info[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:5px 0}"]});var Rp=ms;function Zq(n,e){if(n&1&&(l(0,"div",29),d(1),s()),n&2){let t=_();m(),N(" ",t.successMessage()," ")}}function Xq(n,e){if(n&1&&(l(0,"span",30),d(1),s()),n&2){let t=e.$implicit;m(),N(" ",t.display_name," ")}}function eW(n,e){if(n&1&&(l(0,"div",31)(1,"span",32),d(2),s()()),n&2){let t=e.$implicit;m(2),w(t)}}function tW(n,e){n&1&&(l(0,"div",33),d(1,"\u8F09\u5165\u4E2D..."),s())}function nW(n,e){if(n&1&&(l(0,"div",34),d(1),s()),n&2){let t=_();m(),w(t.error())}}var ps=class ps{constructor(e,t){this.http=e;this.authService=t;this.baseUrl=`${Gn.apiUrl}/admin`;this.fallbackAvatarUrl=this.buildFallbackAvatarUrl();this.blockedAvatarHosts=["via.placeholder.com","i.imgur.com","imgur.com"];this.profileData=D(null);this.isLoading=D(!1);this.isUpdating=D(!1);this.error=D(null);this.successMessage=D(null);this.formData={name:"",avatarUrl:""}}ngOnInit(){this.loadProfile()}loadProfile(){this.isLoading.set(!0),this.error.set(null);let e=this.getAuthHeaders();if(!e){this.error.set("\u5C1A\u672A\u767B\u5165\uFF0C\u8ACB\u91CD\u65B0\u767B\u5165"),this.isLoading.set(!1);return}this.http.get(`${this.baseUrl}/profile`,{headers:e}).subscribe({next:t=>{this.profileData.set(t.data),this.formData={name:t.data.name,avatarUrl:t.data.avatarUrl||""},this.isLoading.set(!1)},error:t=>{console.error("Profile load error:",t);let i="\u8F09\u5165\u500B\u4EBA\u8CC7\u6599\u5931\u6557";t.status===401?i="\u8A8D\u8B49\u5931\u6557\uFF0C\u8ACB\u91CD\u65B0\u767B\u5165":t.status===404?i="\u627E\u4E0D\u5230\u5E33\u865F\u8CC7\u8A0A":t.error?.error&&(i=t.error.error),this.error.set(i),this.isLoading.set(!1)}})}updateProfile(){this.isUpdating.set(!0),this.successMessage.set(null);let e=this.getAuthHeaders();if(!e){this.error.set("\u5C1A\u672A\u767B\u5165"),this.isUpdating.set(!1);return}this.http.put(`${this.baseUrl}/profile`,this.formData,{headers:e}).subscribe({next:()=>{this.successMessage.set("\u500B\u4EBA\u8CC7\u6599\u5DF2\u6210\u529F\u66F4\u65B0"),this.isUpdating.set(!1),this.loadProfile(),setTimeout(()=>{this.successMessage.set(null)},3e3)},error:t=>{this.error.set(t.error?.error||"\u66F4\u65B0\u5931\u6557"),this.isUpdating.set(!1)}})}getStatusLabel(e){return{active:"\u555F\u7528",inactive:"\u505C\u7528",suspended:"\u66AB\u505C"}[e||""]||e||"-"}formatDate(e){return e?new Date(e).toLocaleDateString("zh-TW",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"}):"-"}getAuthHeaders(){let e=this.authService.getToken();return e?new tn({Authorization:`Bearer ${e}`,"Content-Type":"application/json"}):null}resolveAvatarUrl(e){let t=String(e||"").trim();if(!t)return this.fallbackAvatarUrl;if(!/^https?:\/\//i.test(t))return this.fallbackAvatarUrl;try{let i=new URL(t);return this.blockedAvatarHosts.some(r=>i.hostname===r||i.hostname.endsWith(`.${r}`))?this.fallbackAvatarUrl:t}catch{return this.fallbackAvatarUrl}}handleAvatarError(e){let t=e.target;t&&t.src!==this.fallbackAvatarUrl&&(t.src=this.fallbackAvatarUrl)}buildFallbackAvatarUrl(){return`data:image/svg+xml;charset=UTF-8,${encodeURIComponent('<svg xmlns="http://www.w3.org/2000/svg" width="100" height="100" viewBox="0 0 100 100"><rect width="100" height="100" fill="#e5e7eb"/><circle cx="50" cy="38" r="18" fill="#9ca3af"/><path d="M20 88c5-17 16-25 30-25s25 8 30 25" fill="#9ca3af"/></svg>')}`}};ps.\u0275fac=function(t){return new(t||ps)(ee(Hn),ee(st))},ps.\u0275cmp=re({type:ps,selectors:[["app-account"]],decls:69,vars:20,consts:[[1,"account-container"],[1,"account-layout"],[1,"profile-section"],[1,"profile-header"],[1,"profile-avatar"],["alt","Avatar",3,"error","src"],[1,"profile-info"],[1,"status"],[1,"profile-details"],[1,"detail-row"],[1,"value"],[1,"edit-section"],[3,"ngSubmit"],[1,"form-group"],["type","text","name","name","placeholder","\u8F38\u5165\u60A8\u7684\u59D3\u540D",3,"ngModelChange","ngModel"],["type","url","name","avatarUrl","placeholder","https://...",3,"ngModelChange","ngModel"],["type","submit",3,"disabled"],["class","success-message",4,"ngIf"],[1,"roles-section"],[1,"roles-container"],[1,"role-list"],["class","role-badge",4,"ngFor","ngForOf"],[1,"permissions-container"],[1,"permissions-grid"],["class","permission-item",4,"ngFor","ngForOf"],[1,"activity-section"],[1,"activity-info"],["class","loading",4,"ngIf"],["class","error-message",4,"ngIf"],[1,"success-message"],[1,"role-badge"],[1,"permission-item"],[1,"permission-code"],[1,"loading"],[1,"error-message"]],template:function(t,i){if(t&1&&(l(0,"div",0)(1,"h2"),d(2,"\u6211\u7684\u5E33\u865F"),s(),l(3,"div",1)(4,"div",2)(5,"div",3)(6,"div",4)(7,"img",5),b("error",function(o){return i.handleAvatarError(o)}),s()(),l(8,"div",6)(9,"h3"),d(10),s(),l(11,"p"),d(12),s(),l(13,"p",7),d(14),s()()(),l(15,"div",8)(16,"div",9)(17,"label"),d(18,"\u5E33\u865F\u72C0\u614B\uFF1A"),s(),l(19,"span",10),d(20),s()(),l(21,"div",9)(22,"label"),d(23,"\u5EFA\u7ACB\u6642\u9593\uFF1A"),s(),l(24,"span",10),d(25),s()(),l(26,"div",9)(27,"label"),d(28,"\u6700\u5F8C\u767B\u5165\uFF1A"),s(),l(29,"span",10),d(30),s()()()(),l(31,"div",11)(32,"h3"),d(33,"\u7DE8\u8F2F\u500B\u4EBA\u8CC7\u6599"),s(),l(34,"form",12),b("ngSubmit",function(){return i.updateProfile()}),l(35,"div",13)(36,"label"),d(37,"\u59D3\u540D"),s(),l(38,"input",14),K("ngModelChange",function(o){return Q(i.formData.name,o)||(i.formData.name=o),o}),s()(),l(39,"div",13)(40,"label"),d(41,"\u982D\u50CF URL"),s(),l(42,"input",15),K("ngModelChange",function(o){return Q(i.formData.avatarUrl,o)||(i.formData.avatarUrl=o),o}),s()(),l(43,"button",16),d(44),s(),xt(45,Zq,2,1,"div",17),s()(),l(46,"div",18)(47,"h3"),d(48,"\u89D2\u8272\u548C\u6B0A\u9650"),s(),l(49,"div",19)(50,"h4"),d(51,"\u6211\u7684\u89D2\u8272"),s(),l(52,"div",20),xt(53,Xq,2,1,"span",21),s()(),l(54,"div",22)(55,"h4"),d(56,"\u6211\u7684\u6B0A\u9650"),s(),l(57,"div",23),xt(58,eW,3,1,"div",24),s()()(),l(59,"div",25)(60,"h3"),d(61,"\u6700\u8FD1\u6D3B\u52D5"),s(),l(62,"div",26)(63,"p"),d(64),s(),l(65,"p"),d(66),s()()()(),xt(67,tW,2,0,"div",27)(68,nW,2,1,"div",28),s()),t&2){let r,o,a,u,c,p,g,y,v,C,T,R;m(7),I("src",i.resolveAvatarUrl((r=i.profileData())==null?null:r.avatarUrl),qt),m(3),w((o=i.profileData())==null?null:o.name),m(2),w((a=i.profileData())==null?null:a.email),m(),Te("status-"+((u=i.profileData())==null?null:u.status)),m(),N(" ",i.getStatusLabel((c=i.profileData())==null?null:c.status)," "),m(6),w(i.getStatusLabel((p=i.profileData())==null?null:p.status)),m(5),w(i.formatDate((g=i.profileData())==null?null:g.createdAt)),m(5),w(i.formatDate((y=i.profileData())==null?null:y.lastLoginAt)),m(8),J("ngModel",i.formData.name),m(4),J("ngModel",i.formData.avatarUrl),m(),I("disabled",i.isUpdating()),m(),N(" ",i.isUpdating()?"\u4FDD\u5B58\u4E2D...":"\u4FDD\u5B58\u4FEE\u6539"," "),m(),I("ngIf",i.successMessage()),m(8),I("ngForOf",(v=i.profileData())==null?null:v.roles),m(5),I("ngForOf",(C=i.profileData())==null?null:C.permissions),m(6),N("\u6700\u5F8C\u767B\u5165\u6642\u9593\uFF1A",i.formatDate((T=i.profileData())==null?null:T.lastLoginAt)),m(2),N("\u5E33\u865F\u5EFA\u7ACB\u6642\u9593\uFF1A",i.formatDate((R=i.profileData())==null?null:R.createdAt)),m(),I("ngIf",i.isLoading()),m(),I("ngIf",i.error())}},dependencies:[se,la,Ji,De,Ve,be,fe,ke,Ie,Yl],styles:[".account-container[_ngcontent-%COMP%]{padding:20px;max-width:1000px;margin:0 auto}h2[_ngcontent-%COMP%]{margin-bottom:30px;color:#333}.account-layout[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(auto-fit,minmax(400px,1fr));gap:30px}.profile-section[_ngcontent-%COMP%]{background:#fff;padding:20px;border-radius:8px;box-shadow:0 2px 8px #0000001a}.profile-header[_ngcontent-%COMP%]{display:flex;gap:20px;margin-bottom:20px;padding-bottom:20px;border-bottom:1px solid #eee}.profile-avatar[_ngcontent-%COMP%]{width:100px;height:100px;border-radius:50%;overflow:hidden;flex-shrink:0}.profile-avatar[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:100%;height:100%;object-fit:cover}.profile-info[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{margin:0 0 5px;color:#333}.profile-info[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:0;color:#666;font-size:13px}.status[_ngcontent-%COMP%]{padding:4px 8px;border-radius:4px;font-size:12px;display:inline-block;margin-top:8px}.status-active[_ngcontent-%COMP%]{background-color:#d4edda;color:#155724}.status-inactive[_ngcontent-%COMP%]{background-color:#f8d7da;color:#721c24}.status-suspended[_ngcontent-%COMP%]{background-color:#fff3cd;color:#856404}.profile-details[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:10px}.detail-row[_ngcontent-%COMP%]{display:flex;justify-content:space-between}.detail-row[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{font-weight:600;color:#333}.detail-row[_ngcontent-%COMP%]   .value[_ngcontent-%COMP%]{color:#666}.edit-section[_ngcontent-%COMP%], .roles-section[_ngcontent-%COMP%], .activity-section[_ngcontent-%COMP%]{background:#fff;padding:20px;border-radius:8px;box-shadow:0 2px 8px #0000001a}h3[_ngcontent-%COMP%]{margin-top:0;margin-bottom:15px;color:#333;font-size:16px}h4[_ngcontent-%COMP%]{margin-bottom:10px;color:#333;font-size:14px}.form-group[_ngcontent-%COMP%]{margin-bottom:15px}.form-group[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{display:block;margin-bottom:5px;font-weight:600;color:#333;font-size:13px}.form-group[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{width:100%;padding:10px;border:1px solid #ddd;border-radius:4px;font-size:13px;box-sizing:border-box}.form-group[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]:focus{outline:none;border-color:#3f51b5;box-shadow:0 0 0 3px #3f51b51a}button[type=submit][_ngcontent-%COMP%]{background-color:#3f51b5;color:#fff;padding:10px 20px;border:none;border-radius:4px;cursor:pointer;font-size:13px;font-weight:600}button[type=submit][_ngcontent-%COMP%]:hover:not(:disabled){background-color:#303c7e}button[type=submit][_ngcontent-%COMP%]:disabled{opacity:.6;cursor:not-allowed}.role-badge[_ngcontent-%COMP%]{display:inline-block;background-color:#e0e7ff;color:#3f51b5;padding:6px 12px;border-radius:4px;font-size:12px;margin-right:8px;margin-bottom:8px}.role-list[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap;gap:8px}.permissions-grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(auto-fill,minmax(150px,1fr));gap:10px}.permission-item[_ngcontent-%COMP%]{background-color:#f5f5f5;padding:8px;border-radius:4px;border-left:3px solid #3f51b5;font-size:12px}.permission-code[_ngcontent-%COMP%]{font-family:Courier New,monospace;color:#333}.success-message[_ngcontent-%COMP%]{background-color:#d4edda;color:#155724;padding:10px;border-radius:4px;font-size:12px;margin-top:10px;border:1px solid #c3e6cb}.error-message[_ngcontent-%COMP%]{background-color:#f8d7da;color:#721c24;padding:10px;border-radius:4px;font-size:12px;margin-top:10px;border:1px solid #f5c6cb}.activity-info[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:8px}.activity-info[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:0;color:#666;font-size:13px}.loading[_ngcontent-%COMP%]{text-align:center;padding:40px;color:#666}@media (max-width: 768px){.account-layout[_ngcontent-%COMP%]{grid-template-columns:1fr}.profile-header[_ngcontent-%COMP%]{flex-direction:column;align-items:center;text-align:center}.permissions-grid[_ngcontent-%COMP%]{grid-template-columns:1fr}}"]});var Np=ps;var iW=(n,e)=>e.role_id,rW=(n,e)=>e.permission_id;function oW(n,e){if(n&1&&(l(0,"div",4)(1,"p",23),d(2),s()()),n&2){let t=_();m(2),w(t.error())}}function aW(n,e){if(n&1&&(l(0,"div",5)(1,"p",24),d(2),s()()),n&2){let t=_();m(2),w(t.successMessage())}}function sW(n,e){n&1&&(l(0,"div",18),d(1,"\u8F09\u5165\u4E2D..."),s())}function lW(n,e){n&1&&(l(0,"div",18),d(1,"\u6C92\u6709\u53EF\u7DE8\u8F2F\u7684\u89D2\u8272"),s())}function uW(n,e){if(n&1){let t=B();l(0,"div",26)(1,"div",27)(2,"button",28),b("click",function(){let r=E(t).$implicit,o=_(2);return S(o.selectRole(r))}),l(3,"div",29),d(4),s(),l(5,"div",30),d(6),s(),l(7,"div",31),d(8),s()(),l(9,"div",32)(10,"button",33),b("click",function(){let r=E(t).$implicit,o=_(2);return S(o.openEditRoleDialog(r))}),Ui(),l(11,"svg",34),x(12,"path",35),s()(),Yr(),l(13,"button",36),b("click",function(){let r=E(t).$implicit,o=_(2);return S(o.openDeleteDialog(r))}),Ui(),l(14,"svg",34),x(15,"path",37),s()()()()()}if(n&2){let t,i,r,o=e.$implicit,a=_(2);j("bg-blue-50",((t=a.selectedRole())==null?null:t.role_id)===o.role_id)("border-l-4",((i=a.selectedRole())==null?null:i.role_id)===o.role_id)("border-l-blue-500",((r=a.selectedRole())==null?null:r.role_id)===o.role_id),m(4),w(o.display_name),m(2),w(o.role_name),m(2),N(" ",o.permission_count||0," \u500B\u6B0A\u9650\u5DF2\u914D\u7F6E ")}}function dW(n,e){if(n&1&&V(0,uW,16,9,"div",25,iW),n&2){let t=_();L(t.filteredRoles())}}function cW(n,e){n&1&&(l(0,"div",20)(1,"p",38),d(2,"\u8ACB\u9078\u64C7\u4E00\u500B\u89D2\u8272\u958B\u59CB\u914D\u7F6E\u6B0A\u9650"),s()())}function mW(n,e){n&1&&(l(0,"div",48),d(1,"\u8F09\u5165\u6B0A\u9650\u4E2D..."),s())}function pW(n,e){n&1&&(l(0,"div",48),d(1,"\u6C92\u6709\u53EF\u7528\u7684\u6B0A\u9650"),s())}function fW(n,e){if(n&1){let t=B();l(0,"div",60)(1,"input",61),b("change",function(){let r=E(t).$implicit,o=_(5);return S(o.togglePermission(r.permission_id,o.selectedPermissions().has(r.permission_id)))}),s(),l(2,"div",62)(3,"label",63),d(4),s(),l(5,"p",64),d(6),s(),l(7,"code",65),d(8),s()()()}if(n&2){let t=e.$implicit,i=_(5);m(),I("checked",i.selectedPermissions().has(t.permission_id))("disabled",i.isSaving()),m(3),N(" ",t.display_name," "),m(2),N(" ",t.description," "),m(2),N(" ",t.permission_code," ")}}function gW(n,e){if(n&1&&V(0,fW,9,5,"div",60,rW),n&2){let t=_().$implicit,i=_(3);L(i.permissionsByCategory()[t])}}function hW(n,e){n&1&&(l(0,"div",59),d(1,"\u6B64\u5206\u985E\u6C92\u6709\u6B0A\u9650"),s())}function yW(n,e){if(n&1){let t=B();l(0,"div",52)(1,"div",53)(2,"div",54)(3,"input",55),b("change",function(){let r=E(t).$implicit,o=_(3);return S(o.isCategoryFullySelected(r)?o.deselectAllInCategory(r):o.selectAllInCategory(r))}),s(),l(4,"div")(5,"h3",56),d(6),s(),l(7,"p",57),d(8),s()()()(),l(9,"div",58),M(10,gW,2,0)(11,hW,2,0,"div",59),s()()}if(n&2){let t=e.$implicit,i=_(3);m(3),I("checked",i.isCategoryFullySelected(t)),m(3),N(" ",t," "),m(2),Qe(" ",i.getCategoryAssignedCount(t)," / ",i.permissionsByCategory()[t].length," "),m(2),A(i.permissionsByCategory()[t]&&i.permissionsByCategory()[t].length>0?10:11)}}function _W(n,e){if(n&1&&V(0,yW,12,5,"div",52,Y),n&2){let t=_(2);L(t.categoryCount().categories)}}function vW(n,e){if(n&1){let t=B();l(0,"div",8)(1,"div",39)(2,"div",10)(3,"div")(4,"h2",40),d(5),s(),l(6,"p",12),d(7),s()(),l(8,"div",41)(9,"div",42),d(10),s()()()(),l(11,"div",43)(12,"button",44),b("click",function(){E(t);let r=_();return S(r.selectAllPermissions())}),d(13," \u5168\u9078\u6240\u6709 "),s(),l(14,"button",45),b("click",function(){E(t);let r=_();return S(r.clearAllPermissions())}),d(15," \u5168\u4E0D\u9078 "),s(),l(16,"button",46),b("click",function(){E(t);let r=_();return S(r.resetPermissions())}),d(17," \u91CD\u7F6E "),s()(),l(18,"div",47),M(19,mW,2,0,"div",48)(20,pW,2,0,"div",48)(21,_W,2,0),s(),l(22,"div",49)(23,"button",50),b("click",function(){E(t);let r=_();return S(r.resetPermissions())}),d(24," \u53D6\u6D88 "),s(),l(25,"button",51),b("click",function(){E(t);let r=_();return S(r.savePermissions())}),d(26),s()()()}if(n&2){let t=_();m(5),N(" ",t.selectedRole().display_name," "),m(2),Qe(" \u5DF2\u914D\u7F6E ",t.assignedCount()," / ",t.categoryCount().total*5," \u500B\u6B0A\u9650 "),m(3),N(" ",(t.Object.keys(t.permissionsByCategory()).length>0?t.Math.round(t.assignedCount()/(t.Object.keys(t.permissionsByCategory()).length*5)*100):0)||0,"% "),m(6),I("disabled",t.isSaving()),m(3),A(t.isLoading()?19:t.Object.keys(t.permissionsByCategory()).length===0?20:21),m(4),I("disabled",t.isSaving()),m(2),I("disabled",t.isSaving()),m(),N(" ",t.isSaving()?"\u4FDD\u5B58\u4E2D...":"\u4FDD\u5B58\u6B0A\u9650"," ")}}function CW(n,e){if(n&1&&(l(0,"div",68)(1,"p",23),d(2),s()()),n&2){let t=_(2);m(2),w(t.error())}}function xW(n,e){if(n&1){let t=B();l(0,"div",21)(1,"div",66)(2,"div",39)(3,"h3",40),d(4),s()(),l(5,"div",67),M(6,CW,3,1,"div",68),l(7,"div")(8,"label",69),d(9," \u89D2\u8272\u540D\u7A31 "),l(10,"span",70),d(11,"*"),s()(),l(12,"input",71),b("input",function(r){E(t);let o=_();return S(o.updateRoleDisplayName(r.target.value))}),s()(),l(13,"div")(14,"label",69),d(15," \u8AAA\u660E "),s(),l(16,"textarea",72),b("input",function(r){E(t);let o=_();return S(o.updateRoleDescription(r.target.value))}),s()()(),l(17,"div",73)(18,"button",50),b("click",function(){E(t);let r=_();return S(r.closeRoleDialog())}),d(19," \u53D6\u6D88 "),s(),l(20,"button",74),b("click",function(){E(t);let r=_();return S(r.saveRole())}),d(21),s()()()()}if(n&2){let t=_();m(4),N(" ",t.editingRole()?"\u7DE8\u8F2F\u89D2\u8272":"\u65B0\u589E\u89D2\u8272"," "),m(2),A(t.error()?6:-1),m(6),I("value",t.roleFormData().displayName)("disabled",t.isSaving()),m(4),I("value",t.roleFormData().description)("disabled",t.isSaving()),m(2),I("disabled",t.isSaving()),m(2),I("disabled",t.isSaving()),m(),N(" ",t.isSaving()?"\u4FDD\u5B58\u4E2D...":"\u4FDD\u5B58"," ")}}function bW(n,e){if(n&1&&(l(0,"div",76)(1,"p",23),d(2),s()()),n&2){let t=_(2);m(2),w(t.error())}}function EW(n,e){if(n&1){let t=B();l(0,"div",21)(1,"div",66)(2,"div",39)(3,"h3",40),d(4,"\u522A\u9664\u89D2\u8272\u78BA\u8A8D"),s()(),l(5,"div",75),M(6,bW,3,1,"div",76),l(7,"p",77),d(8," \u78BA\u5B9A\u8981\u522A\u9664\u89D2\u8272 "),l(9,"strong",78),d(10),s(),d(11," \u55CE\uFF1F "),s(),l(12,"p",79),d(13," \u6CE8\u610F\uFF1A\u5982\u679C\u6B64\u89D2\u8272\u5DF2\u5206\u914D\u7D66\u4F7F\u7528\u8005\uFF0C\u5C07\u7121\u6CD5\u522A\u9664\u3002 "),s()(),l(14,"div",73)(15,"button",50),b("click",function(){E(t);let r=_();return S(r.closeDeleteDialog())}),d(16," \u53D6\u6D88 "),s(),l(17,"button",80),b("click",function(){E(t);let r=_();return S(r.deleteRole())}),d(18),s()()()()}if(n&2){let t,i=_();m(6),A(i.error()?6:-1),m(4),w((t=i.roleToDelete())==null?null:t.display_name),m(5),I("disabled",i.isSaving()),m(2),I("disabled",i.isSaving()),m(),N(" ",i.isSaving()?"\u522A\u9664\u4E2D...":"\u78BA\u5B9A\u522A\u9664"," ")}}function SW(n,e){if(n&1&&(rc(0),d(1),oc()),n&2){let t=_();m(),N(" ",t.Math,`
`)}}var fs=class fs{constructor(){this.baseUrl=`${Gn.apiUrl}/admin`;this.authService=k(st);this.http=k(Hn);this.roles=D([]);this.selectedRole=D(null);this.permissions=D({});this.selectedPermissions=D(new Set);this.isLoading=D(!1);this.isSaving=D(!1);this.error=D(null);this.successMessage=D(null);this.showRoleDialog=D(!1);this.showDeleteDialog=D(!1);this.editingRole=D(null);this.roleToDelete=D(null);this.roleFormData=D({displayName:"",description:""});this.searchTerm=D("");this.Object=Object;this.Math=Math;this.filteredRoles=$(()=>{let e=this.searchTerm().toLowerCase();return this.roles().filter(t=>t.role_name!=="super_admin").filter(t=>t.display_name.toLowerCase().includes(e))});this.permissionsByCategory=$(()=>this.permissions());this.categoryCount=$(()=>{let e=Object.keys(this.permissionsByCategory());return{total:e.length,categories:e}});this.assignedCount=$(()=>this.selectedPermissions().size)}ngOnInit(){this.loadRoles()}getAuthHeaders(){let e=this.authService.getToken();return e?new tn({Authorization:`Bearer ${e}`,"Content-Type":"application/json"}):(this.error.set("\u5C1A\u672A\u767B\u5165"),null)}handleHttpError(e,t){return e?.status===401?(this.error.set("\u767B\u5165\u5DF2\u5931\u6548\uFF0C\u8ACB\u91CD\u65B0\u767B\u5165"),this.authService.logout(),"\u767B\u5165\u5DF2\u5931\u6548\uFF0C\u8ACB\u91CD\u65B0\u767B\u5165"):e?.error?.error||e?.message||t}loadRoles(){let e=this.getAuthHeaders();if(!e)return;this.isLoading.set(!0),this.error.set(null);let t=`${this.baseUrl}/roles?limit=100`;console.log("Loading roles from:",t),console.log("Headers:",e),this.http.get(t,{headers:e}).subscribe({next:i=>{console.log("Roles response:",i);let r=i?.data||[];console.log("Filtered roles:",r),console.log("Non-system roles:",r.filter(a=>!a.is_system)),this.roles.set(r),this.isLoading.set(!1);let o=r.find(a=>!a.is_system);o?(console.log("Auto-selecting role:",o),this.selectRole(o)):console.warn("No editable roles found")},error:i=>{console.error("Error loading roles:",i);let r=this.handleHttpError(i,"\u8F09\u5165\u89D2\u8272\u5931\u6557");this.error.set(r),this.isLoading.set(!1)}})}selectRole(e){this.selectedRole.set(e),this.selectedPermissions.set(new Set),this.error.set(null);let t=this.getAuthHeaders();t&&(this.isLoading.set(!0),this.http.get(`${this.baseUrl}/role-permissions?roleId=${e.role_id}`,{headers:t}).subscribe({next:i=>{console.log("Role permissions response:",i);let r=i?.permissions||{};console.log("Permissions data:",r);let o=new Set;Object.values(r).forEach(a=>{console.log("Category perms:",a),a.forEach(u=>{console.log("Permission:",u,"is_assigned:",u.is_assigned,"type:",typeof u.is_assigned),u.is_assigned&&o.add(u.permission_id)})}),console.log("Assigned permissions:",o),this.permissions.set(r),this.selectedPermissions.set(o),this.isLoading.set(!1)},error:i=>{console.error("Error loading permissions:",i),this.error.set(this.handleHttpError(i,"\u8F09\u5165\u6B0A\u9650\u5931\u6557")),this.isLoading.set(!1)}}))}togglePermission(e,t){let i=new Set(this.selectedPermissions());t?i.delete(e):i.add(e),this.selectedPermissions.set(i)}selectAllInCategory(e){let t=this.permissions()[e]||[],i=new Set(this.selectedPermissions());t.forEach(r=>{i.add(r.permission_id)}),this.selectedPermissions.set(i)}deselectAllInCategory(e){let t=this.permissions()[e]||[],i=new Set(this.selectedPermissions());t.forEach(r=>{i.delete(r.permission_id)}),this.selectedPermissions.set(i)}getCategoryAssignedCount(e){let t=this.permissions()[e]||[],i=0;return t.forEach(r=>{this.selectedPermissions().has(r.permission_id)&&i++}),i}isCategoryFullySelected(e){let t=this.permissions()[e]||[];return t.length===0?!1:t.every(i=>this.selectedPermissions().has(i.permission_id))}savePermissions(){let e=this.selectedRole();if(!e){this.error.set("\u672A\u9078\u64C7\u89D2\u8272");return}let t=this.getAuthHeaders();if(!t)return;this.isSaving.set(!0),this.error.set(null),this.successMessage.set(null);let i={roleId:e.role_id,permissionIds:Array.from(this.selectedPermissions())};this.http.post(`${this.baseUrl}/role-permissions`,i,{headers:t}).subscribe({next:r=>{this.isSaving.set(!1),this.successMessage.set(`\u6210\u529F\u66F4\u65B0\u89D2\u8272 "${e.display_name}" \u7684\u6B0A\u9650 (${this.assignedCount()} \u500B\u6B0A\u9650)`),setTimeout(()=>{this.loadRoles()},1500)},error:r=>{this.isSaving.set(!1),this.error.set(this.handleHttpError(r,"\u4FDD\u5B58\u6B0A\u9650\u5931\u6557"))}})}resetPermissions(){let e=this.selectedRole();e&&this.selectRole(e)}selectAllPermissions(){let e=new Set;Object.values(this.permissions()).forEach(t=>{t.forEach(i=>{e.add(i.permission_id)})}),this.selectedPermissions.set(e)}clearAllPermissions(){this.selectedPermissions.set(new Set)}openCreateRoleDialog(){this.editingRole.set(null),this.roleFormData.set({displayName:"",description:""}),this.showRoleDialog.set(!0),this.error.set(null)}openEditRoleDialog(e){this.editingRole.set(e),this.roleFormData.set({displayName:e.display_name,description:e.description||""}),this.showRoleDialog.set(!0),this.error.set(null)}closeRoleDialog(){this.showRoleDialog.set(!1),this.editingRole.set(null),this.roleFormData.set({displayName:"",description:""}),this.error.set(null)}saveRole(){let e=this.roleFormData();if(!e.displayName.trim()){this.error.set("\u89D2\u8272\u540D\u7A31\u4E0D\u80FD\u70BA\u7A7A");return}let t=this.getAuthHeaders();if(!t)return;this.isSaving.set(!0),this.error.set(null);let i=this.editingRole();if(i)this.http.put(`${this.baseUrl}/roles/${i.role_id}`,{displayName:e.displayName.trim(),description:e.description.trim()||null},{headers:t}).subscribe({next:r=>{this.isSaving.set(!1),this.successMessage.set(`\u6210\u529F\u66F4\u65B0\u89D2\u8272 "${e.displayName}"`),this.closeRoleDialog(),this.loadRoles(),setTimeout(()=>{this.successMessage.set(null)},3e3)},error:r=>{this.isSaving.set(!1),this.error.set(this.handleHttpError(r,"\u66F4\u65B0\u89D2\u8272\u5931\u6557"))}});else{let r=new Date,o=r.getFullYear().toString()+(r.getMonth()+1).toString().padStart(2,"0")+r.getDate().toString().padStart(2,"0")+r.getHours().toString().padStart(2,"0")+r.getMinutes().toString().padStart(2,"0")+r.getSeconds().toString().padStart(2,"0"),a=Math.floor(Math.random()*65536).toString(16).padStart(4,"0"),u=`role_${o}_${a}`;this.http.post(`${this.baseUrl}/roles`,{roleName:u,displayName:e.displayName.trim(),description:e.description.trim()||null},{headers:t}).subscribe({next:c=>{this.isSaving.set(!1),this.successMessage.set(`\u6210\u529F\u5275\u5EFA\u89D2\u8272 "${e.displayName}"`),this.closeRoleDialog(),this.loadRoles(),setTimeout(()=>{this.successMessage.set(null)},3e3)},error:c=>{this.isSaving.set(!1),this.error.set(this.handleHttpError(c,"\u5275\u5EFA\u89D2\u8272\u5931\u6557"))}})}}openDeleteDialog(e){this.roleToDelete.set(e),this.showDeleteDialog.set(!0),this.error.set(null)}closeDeleteDialog(){this.showDeleteDialog.set(!1),this.roleToDelete.set(null),this.error.set(null)}deleteRole(){let e=this.roleToDelete();if(!e)return;let t=this.getAuthHeaders();t&&(this.isSaving.set(!0),this.error.set(null),this.http.delete(`${this.baseUrl}/roles/${e.role_id}`,{headers:t}).subscribe({next:i=>{this.isSaving.set(!1),this.successMessage.set(`\u6210\u529F\u522A\u9664\u89D2\u8272 "${e.display_name}"`),this.closeDeleteDialog(),this.selectedRole()?.role_id===e.role_id&&(this.selectedRole.set(null),this.permissions.set({}),this.selectedPermissions.set(new Set)),this.loadRoles(),setTimeout(()=>{this.successMessage.set(null)},3e3)},error:i=>{this.isSaving.set(!1),this.error.set(this.handleHttpError(i,"\u522A\u9664\u89D2\u8272\u5931\u6557"))}}))}updateRoleDisplayName(e){let t=this.roleFormData();this.roleFormData.set({displayName:e,description:t.description})}updateRoleDescription(e){let t=this.roleFormData();this.roleFormData.set({displayName:t.displayName,description:e})}};fs.\u0275fac=function(t){return new(t||fs)},fs.\u0275cmp=re({type:fs,selectors:[["app-role-permission-management"]],decls:33,vars:8,consts:[[1,"min-h-screen","bg-gray-50","p-4","sm:p-6"],[1,"mb-6","sm:mb-8"],[1,"text-2xl","sm:text-3xl","font-bold","text-gray-900"],[1,"mt-2","text-gray-600"],[1,"mb-6","rounded-md","bg-red-50","p-4","border","border-red-200"],[1,"mb-6","rounded-md","bg-green-50","p-4","border","border-green-200"],[1,"grid","grid-cols-1","gap-6","lg:grid-cols-3"],[1,"lg:col-span-1"],[1,"rounded-lg","bg-white","shadow"],[1,"border-b","border-gray-200","p-4"],[1,"flex","items-center","justify-between"],[1,"text-lg","font-semibold","text-gray-900"],[1,"mt-1","text-sm","text-gray-600"],["title","\u65B0\u589E\u89D2\u8272",1,"px-3","py-2","text-sm","font-medium","rounded-md","bg-blue-600","text-white","hover:bg-blue-700",3,"click"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-5","h-5"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M12 4v16m8-8H4"],["type","text","placeholder","\u641C\u5C0B\u89D2\u8272...",1,"block","w-full","rounded-md","border","border-gray-300","px-3","py-2","text-gray-900","placeholder-gray-500","focus:border-blue-500","focus:ring-blue-500",3,"input","value"],[1,"divide-y","divide-gray-200","max-h-96","overflow-y-auto"],[1,"p-4","text-center","text-gray-500"],[1,"lg:col-span-2"],[1,"rounded-lg","bg-white","shadow","p-12","text-center"],[1,"fixed","inset-0","bg-black","bg-opacity-50","flex","items-center","justify-center","z-50"],[4,"ngIf"],[1,"text-sm","font-medium","text-red-800"],[1,"text-sm","font-medium","text-green-800"],[1,"hover:bg-gray-50","transition",3,"bg-blue-50","border-l-4","border-l-blue-500"],[1,"hover:bg-gray-50","transition"],[1,"flex","items-center"],[1,"flex-1","text-left","p-4",3,"click"],[1,"font-semibold","text-gray-900"],[1,"text-sm","text-gray-600"],[1,"mt-1","text-xs","text-gray-500"],[1,"flex","gap-1","pr-2"],["title","\u7DE8\u8F2F\u89D2\u8272",1,"p-2","text-blue-600","hover:bg-blue-100","rounded",3,"click"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-4","h-4"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"],["title","\u522A\u9664\u89D2\u8272",1,"p-2","text-red-600","hover:bg-red-100","rounded",3,"click"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"],[1,"text-gray-600"],[1,"border-b","border-gray-200","p-6"],[1,"text-xl","font-semibold","text-gray-900"],[1,"text-right"],[1,"text-3xl","font-bold","text-blue-600"],[1,"border-b","border-gray-200","p-4","bg-gray-50","flex","flex-wrap","gap-2"],[1,"px-3","py-2","text-sm","font-medium","rounded-md","bg-blue-600","text-white","hover:bg-blue-700",3,"click"],[1,"px-3","py-2","text-sm","font-medium","rounded-md","bg-gray-400","text-white","hover:bg-gray-500",3,"click"],[1,"px-3","py-2","text-sm","font-medium","rounded-md","bg-gray-200","text-gray-900","hover:bg-gray-300","disabled:opacity-50",3,"click","disabled"],[1,"divide-y","divide-gray-200","max-h-screen","overflow-y-auto"],[1,"p-8","text-center","text-gray-500"],[1,"border-t","border-gray-200","p-6","bg-gray-50","flex","flex-col-reverse","sm:flex-row","gap-3","justify-end"],[1,"px-4","py-2","text-sm","font-medium","rounded-md","bg-gray-200","text-gray-900","hover:bg-gray-300","disabled:opacity-50",3,"click","disabled"],[1,"px-4","py-2","text-sm","font-medium","rounded-md","bg-green-600","text-white","hover:bg-green-700","disabled:opacity-50",3,"click","disabled"],[1,"border-b","border-gray-200"],[1,"bg-gray-50","p-4","flex","items-center","justify-between"],[1,"flex","items-center","gap-3","flex-1"],["type","checkbox",1,"w-5","h-5","text-blue-600","rounded","cursor-pointer",3,"change","checked"],[1,"font-semibold","text-gray-900","capitalize"],[1,"text-xs","text-gray-600"],[1,"p-4","space-y-3"],[1,"text-sm","text-gray-500","py-2"],[1,"flex","items-start","gap-3"],["type","checkbox",1,"w-5","h-5","text-blue-600","rounded","cursor-pointer","mt-0.5",3,"change","checked","disabled"],[1,"flex-1"],[1,"block","text-sm","font-medium","text-gray-900","cursor-pointer"],[1,"text-xs","text-gray-600","mt-1"],[1,"text-xs","bg-gray-100","px-2","py-1","rounded","text-gray-700","inline-block","mt-1"],[1,"bg-white","rounded-lg","shadow-xl","max-w-md","w-full","m-4"],[1,"p-6","space-y-4"],[1,"rounded-md","bg-red-50","p-4","border","border-red-200"],[1,"block","text-sm","font-medium","text-gray-900","mb-2"],[1,"text-red-500"],["type","text","placeholder","\u8ACB\u8F38\u5165\u89D2\u8272\u540D\u7A31",1,"block","w-full","rounded-md","border","border-gray-300","px-3","py-2","text-gray-900","placeholder-gray-500","focus:border-blue-500","focus:ring-blue-500",3,"input","value","disabled"],["placeholder","\u8ACB\u8F38\u5165\u89D2\u8272\u8AAA\u660E\uFF08\u9078\u586B\uFF09","rows","3",1,"block","w-full","rounded-md","border","border-gray-300","px-3","py-2","text-gray-900","placeholder-gray-500","focus:border-blue-500","focus:ring-blue-500",3,"input","value","disabled"],[1,"border-t","border-gray-200","p-6","flex","gap-3","justify-end"],[1,"px-4","py-2","text-sm","font-medium","rounded-md","bg-blue-600","text-white","hover:bg-blue-700","disabled:opacity-50",3,"click","disabled"],[1,"p-6"],[1,"rounded-md","bg-red-50","p-4","border","border-red-200","mb-4"],[1,"text-gray-700"],[1,"text-gray-900"],[1,"text-sm","text-red-600","mt-2"],[1,"px-4","py-2","text-sm","font-medium","rounded-md","bg-red-600","text-white","hover:bg-red-700","disabled:opacity-50",3,"click","disabled"]],template:function(t,i){t&1&&(l(0,"div",0)(1,"div",1)(2,"h1",2),d(3,"\u89D2\u8272\u6B0A\u9650\u63A7\u7BA1"),s(),l(4,"p",3),d(5,"\u8A2D\u5B9A\u6BCF\u500B\u89D2\u8272\u7684\u6B0A\u9650\uFF0C\u6C7A\u5B9A\u4ED6\u5011\u53EF\u4EE5\u57F7\u884C\u7684\u64CD\u4F5C"),s()(),M(6,oW,3,1,"div",4),M(7,aW,3,1,"div",5),l(8,"div",6)(9,"div",7)(10,"div",8)(11,"div",9)(12,"div",10)(13,"div")(14,"h2",11),d(15,"\u53EF\u7DE8\u8F2F\u7684\u89D2\u8272"),s(),l(16,"p",12),d(17," \u8D85\u7D1A\u7BA1\u7406\u54E1\u89D2\u8272\u7121\u6CD5\u7DE8\u8F2F "),s()(),l(18,"button",13),b("click",function(){return i.openCreateRoleDialog()}),Ui(),l(19,"svg",14),x(20,"path",15),s()()()(),Yr(),l(21,"div",9)(22,"input",16),b("input",function(o){return i.searchTerm.set(o.target.value)}),s()(),l(23,"div",17),M(24,sW,2,0,"div",18)(25,lW,2,0,"div",18)(26,dW,2,0),s()()(),l(27,"div",19),M(28,cW,3,0,"div",20)(29,vW,27,9,"div",8),s()()(),M(30,xW,22,9,"div",21),M(31,EW,19,5,"div",21),xt(32,SW,2,1,"ng-container",22)),t&2&&(m(6),A(i.error()?6:-1),m(),A(i.successMessage()?7:-1),m(15),I("value",i.searchTerm()),m(2),A(i.isLoading()?24:i.filteredRoles().length===0?25:26),m(4),A(i.selectedRole()?29:28),m(2),A(i.showRoleDialog()?30:-1),m(),A(i.showDeleteDialog()?31:-1),m(),I("ngIf",!1))},dependencies:[se,Ji,Be,De],styles:["[_nghost-%COMP%]{--color-primary: #3b82f6;--color-success: #10b981;--color-danger: #ef4444;--color-warning: #f59e0b;--color-gray-50: #f9fafb;--color-gray-100: #f3f4f6;--color-gray-200: #e5e7eb;--color-gray-300: #d1d5db;--color-gray-600: #4b5563;--color-gray-900: #111827}[_ngcontent-%COMP%]::-webkit-scrollbar{width:8px}[_ngcontent-%COMP%]::-webkit-scrollbar-track{background:var(--color-gray-100)}[_ngcontent-%COMP%]::-webkit-scrollbar-thumb{background:var(--color-gray-300);border-radius:4px}[_ngcontent-%COMP%]::-webkit-scrollbar-thumb:hover{background:var(--color-gray-400)}@keyframes _ngcontent-%COMP%_slideIn{0%{opacity:0;transform:translateY(-10px)}to{opacity:1;transform:translateY(0)}}[class*=bg-green-50][_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_slideIn .3s ease-out}button[_ngcontent-%COMP%], input[type=checkbox][_ngcontent-%COMP%]{transition:all .2s ease-out}.role-item[_ngcontent-%COMP%]:hover{transform:translate(2px)}"],changeDetection:0});var Fp=fs;var it=(n,e)=>{let t=k(st),i=k(Fe);if(!t.isAuthenticated())return i.navigate(["/login"],{queryParams:{returnUrl:e.url}}),!1;let r=t.getTokenExpiry(),o=new Date().getTime();return r&&o>=r?(t.logout(),i.navigate(["/login"],{queryParams:{returnUrl:e.url,expired:!0}}),!1):!0};var Do=class Do{constructor(){this.authService=k(st)}async checkSuperAdmin(){return this.authService.isAuthenticated()?this.authService.hasRole("super_admin"):!1}};Do.\u0275fac=function(t){return new(t||Do)},Do.\u0275prov=X({token:Do,factory:Do.\u0275fac,providedIn:"root"});var y_=Do,__=async(n,e)=>{let t=k(y_),i=k(Fe);return await t.checkSuperAdmin()?!0:(console.warn("Access denied: User is not a super admin"),i.navigate(["/dashboard"],{queryParams:{error:"insufficient-permissions"}}),!1)};var ES=()=>{let n=k(st),e=k(Fe);return n.hasRole("viewer")?(e.navigate(["/dashboard"],{queryParams:{error:"viewer-readonly"}}),!1):!0};var SS=[{path:"login",component:Rp,title:"\u767B\u5165"},{path:"dashboard",component:bm,title:"\u5100\u8868\u677F",canActivate:[it]},{path:"financial-statements",component:Em,title:"\u8CA1\u52D9\u5831\u8868",canActivate:[it]},{path:"customer-analysis",component:up,title:"\u9867\u5BA2\u7BA1\u7406",canActivate:[it]},{path:"product-analysis",component:dp,title:"\u5546\u54C1\u5206\u6790",canActivate:[it]},{path:"product-cost",component:Cp,title:"\u5546\u54C1\u6210\u672C",canActivate:[it]},{path:"ledger",component:cp,title:"\u6D41\u6C34\u5E33",canActivate:[it]},{path:"vendors",component:xp,title:"\u5EE0\u5546\u7BA1\u7406",canActivate:[it]},{path:"purchase-orders",component:bp,title:"\u9032\u8CA8\u55AE\u7BA1\u7406",canActivate:[it]},{path:"events",component:fp,title:"\u6D3B\u52D5\u7BA1\u7406",canActivate:[it]},{path:"events/new",component:au,title:"\u65B0\u589E\u6D3B\u52D5",canActivate:[it]},{path:"events/edit/:id",component:au,title:"\u7DE8\u8F2F\u6D3B\u52D5",canActivate:[it]},{path:"daily-revenue",component:gp,title:"\u7576\u65E5\u71DF\u6536",canActivate:[it]},{path:"daily-revenue/:date",component:hp,title:"\u7576\u65E5\u71DF\u6536\u660E\u7D30",canActivate:[it]},{path:"payroll",component:yp,title:"\u85AA\u8CC7\u7BA1\u7406",canActivate:[it]},{path:"payroll/:employeeId/:year/:month",component:_p,title:"\u85AA\u8CC7\u660E\u7D30",canActivate:[it]},{path:"company-profile",component:vp,title:"\u516C\u53F8\u500B\u4EBA\u8CC7\u6599",canActivate:[it,ES]},{path:"shareholder-rebates",component:Ep,title:"\u80A1\u6771\u56DE\u994B\u91D1",canActivate:[it]},{path:"meeting",component:Sp,title:"\u6BCF\u5468\u6703\u8B70\u7D00\u9304",canActivate:[it]},{path:"shareholder-records",component:Dp,title:"\u500B\u4EBA\u6BCF\u5468\u9032\u5EA6\u7D00\u9304",canActivate:[it]},{path:"goal-progress",component:Tp,title:"\u500B\u4EBA\u76EE\u6A19\u9032\u5EA6",canActivate:[it]},{path:"goal-setting",component:Mp,title:"\u5718\u968A\u76EE\u6A19\u8A2D\u5B9A",canActivate:[it]},{path:"monthly-targets",component:Ap,title:"\u71DF\u6536\u76EE\u6A19",canActivate:[it]},{path:"decision-log",component:wp,title:"\u91CD\u5927\u4E8B\u9805\u4F48\u9054",canActivate:[it]},{path:"user-management",component:Ip,title:"\u4F7F\u7528\u8005\u7BA1\u7406",canActivate:[it,__]},{path:"role-permissions",component:Fp,title:"\u89D2\u8272\u6B0A\u9650\u63A7\u7BA1",canActivate:[it,__]},{path:"account",component:Np,title:"\u5E33\u865F\u8A2D\u5B9A",canActivate:[it]},{path:"",redirectTo:"dashboard",pathMatch:"full"},{path:"**",redirectTo:"login"}];var DS=()=>{};var wS=async(n,e)=>{if(!(typeof window>"u"))return await DS(),x_([["ion-icon",[[1,"ion-icon",{mode:[1025],color:[1],ios:[1],md:[1],flipRtl:[4,"flip-rtl"],name:[513],src:[1],icon:[8],size:[1],lazy:[4],sanitize:[4],svgContent:[32],isVisible:[32]},null,{name:["loadIcon"],src:["loadIcon"],icon:["loadIcon"],ios:["loadIcon"],md:["loadIcon"]}]]]],e)};var wo=class wo{constructor(e,t){this.authService=e;this.router=t}intercept(e,t){let i=this.authService.getToken();if(i){let r=this.authService.getTokenExpiry(),o=new Date().getTime();if(r&&o>=r)return console.warn("Token \u5DF2\u8FC7\u671F\uFF0C\u5F3A\u5236\u91CD\u65B0\u767B\u5165"),this.authService.logout(),this.router.navigate(["/login"],{queryParams:{expired:!0}}),Jn(()=>new Error("Token expired"));e=this.addToken(e,i)}return t.handle(e).pipe(Qn(r=>{if(r.status===401){let o=this.authService.getTokenExpiry(),a=new Date().getTime();o&&a>=o?(console.warn("\u6536\u5230 401 Unauthorized \u4E14 Token \u5DF2\u8FC7\u671F\uFF0C\u5F3A\u5236\u91CD\u65B0\u767B\u5165"),this.authService.logout(),this.router.navigate(["/login"],{queryParams:{expired:!0,returnUrl:this.router.url}})):console.warn("\u6536\u5230 401 Unauthorized\uFF0C\u4F46 Token \u4ECD\u6709\u6548\uFF0C\u4FDD\u7559\u767B\u5165\u72C0\u614B")}return Jn(()=>r)}))}addToken(e,t){return e.clone({setHeaders:{Authorization:`Bearer ${t}`}})}};wo.\u0275fac=function(t){return new(t||wo)(ae(st),ae(Fe))},wo.\u0275prov=X({token:wo,factory:wo.\u0275fac});var Pp=wo;var To=class To{constructor(e){this.authService=e}intercept(e,t){if(!this.authService.isAuthenticated()||!this.authService.hasRole("viewer"))return t.handle(e);let i=(e.method||"").toUpperCase();return i==="GET"||i==="HEAD"||i==="OPTIONS"?t.handle(e):Jn(()=>new Er({status:403,statusText:"Forbidden",url:e.url,error:{success:!1,error:"\u6AA2\u8996\u8005\u50C5\u53EF\u8B80\u53D6\u8CC7\u6599\uFF0C\u7121\u6CD5\u57F7\u884C\u65B0\u589E\u3001\u7DE8\u8F2F\u6216\u522A\u9664\u64CD\u4F5C"}}))}};To.\u0275fac=function(t){return new(t||To)(ae(st))},To.\u0275prov=X({token:To,factory:To.\u0275fac});var kp=To;gh(lm,{providers:[Bg(),Yh(SS,Jh()),xh(bh()),{provide:vl,useClass:Pp,multi:!0},{provide:vl,useClass:kp,multi:!0}]}).catch(n=>console.error(n));wS(window);
